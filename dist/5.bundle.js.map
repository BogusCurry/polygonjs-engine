{"version":3,"sources":["webpack://POLY/./node_modules/three/src/textures/CompressedTexture.js","webpack://POLY/./modules/three/examples/jsm/loaders/BasisTextureLoader.js"],"names":["CompressedTexture","mipmaps","width","height","format","type","mapping","wrapS","wrapT","magFilter","minFilter","anisotropy","encoding","Texture","call","this","image","flipY","generateMipmaps","prototype","Object","create","constructor","isCompressedTexture","BasisTextureLoader","manager","Loader","transcoderPath","transcoderBinary","transcoderPending","workerLimit","workerPool","workerNextTaskID","workerSourceURL","workerConfig","astcSupported","bptcSupported","etcSupported","dxtSupported","pvrtcSupported","assign","setTranscoderPath","path","setWorkerLimit","detectSupport","renderer","config","extensions","get","BASIS_FORMAT","cTFASTC_4x4","cTFBC7_M5","cTFBC3","cTFPVRTC1_4_RGBA","Error","cTFETC1","load","url","onLoad","onProgress","onError","loader","FileLoader","setResponseType","buffer","_createTexture","then","catch","worker","taskID","taskCost","byteLength","texturePending","_allocateWorker","_worker","Promise","resolve","reject","_callbacks","postMessage","id","message","texture","cTFBC1","DXT_FORMAT_MAP","cTFPVRTC1_4_RGB","length","needsUpdate","finally","_taskLoad","_initTranscoder","jsLoader","setPath","jsContent","undefined","binaryLoader","binaryContent","all","fn","BasisWorker","toString","body","substring","indexOf","lastIndexOf","join","URL","createObjectURL","Blob","Worker","onmessage","e","data","console","error","push","sort","a","b","dispose","i","terminate","cTFETC2","cTFBC4","cTFBC5","cTFBC7_M6_OPAQUE_ONLY","cTFATC_RGB","cTFATC_RGBA_INTERPOLATED_ALPHA","cTFRGBA32","cTFRGB565","cTFBGR565","cTFRGBA4444","DXT_FORMAT","COMPRESSED_RGB_S3TC_DXT1_EXT","COMPRESSED_RGBA_S3TC_DXT1_EXT","COMPRESSED_RGBA_S3TC_DXT3_EXT","COMPRESSED_RGBA_S3TC_DXT5_EXT","_BasisFile","wasmBinary","BasisModule","onRuntimeInitialized","BASIS","BasisFile","initializeBasis","hasAlpha","basisFile","Uint8Array","getImageWidth","getImageHeight","levels","getNumLevels","getHasAlpha","cleanup","close","delete","startTranscoding","mip","mipWidth","mipHeight","dst","getImageTranscodedSizeInBytes","transcodeImage","transcode","buffers","self"],"mappings":"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","file":"5.bundle.js","sourcesContent":["/**\n * @author alteredq / http://alteredqualia.com/\n */\n\nimport { Texture } from './Texture.js';\n\nfunction CompressedTexture( mipmaps, width, height, format, type, mapping, wrapS, wrapT, magFilter, minFilter, anisotropy, encoding ) {\n\n\tTexture.call( this, null, mapping, wrapS, wrapT, magFilter, minFilter, format, type, anisotropy, encoding );\n\n\tthis.image = { width: width, height: height };\n\tthis.mipmaps = mipmaps;\n\n\t// no flipping for cube textures\n\t// (also flipping doesn't work for compressed textures )\n\n\tthis.flipY = false;\n\n\t// can't generate mipmaps for compressed textures\n\t// mips must be embedded in DDS files\n\n\tthis.generateMipmaps = false;\n\n}\n\nCompressedTexture.prototype = Object.create( Texture.prototype );\nCompressedTexture.prototype.constructor = CompressedTexture;\n\nCompressedTexture.prototype.isCompressedTexture = true;\n\n\nexport { CompressedTexture };\n","import {CompressedTexture} from 'three/src/textures/CompressedTexture';\nimport {FileLoader} from 'three/src/loaders/FileLoader';\nimport {LinearFilter} from 'three/src/constants';\nimport {LinearMipmapLinearFilter} from 'three/src/constants';\nimport {Loader} from 'three/src/loaders/Loader';\nimport {RGBA_ASTC_4x4_Format} from 'three/src/constants';\nimport {RGBA_BPTC_Format} from 'three/src/constants';\nimport {RGBA_PVRTC_4BPPV1_Format} from 'three/src/constants';\nimport {RGB_ETC1_Format} from 'three/src/constants';\nimport {RGB_PVRTC_4BPPV1_Format} from 'three/src/constants';\nimport {UnsignedByteType} from 'three/src/constants';\n/**\n * @author Don McCurdy / https://www.donmccurdy.com\n * @author Austin Eng / https://github.com/austinEng\n * @author Shrek Shao / https://github.com/shrekshao\n */\n\n\n/**\n * Loader for Basis Universal GPU Texture Codec.\n *\n * Basis Universal is a \"supercompressed\" GPU texture and texture video\n * compression system that outputs a highly compressed intermediate file format\n * (.basis) that can be quickly transcoded to a wide variety of GPU texture\n * compression formats.\n *\n * This loader parallelizes the transcoding process across a configurable number\n * of web workers, before transferring the transcoded compressed texture back\n * to the main thread.\n */\nvar BasisTextureLoader = function ( manager ) {\n\n\tLoader.call( this, manager );\n\n\tthis.transcoderPath = '';\n\tthis.transcoderBinary = null;\n\tthis.transcoderPending = null;\n\n\tthis.workerLimit = 4;\n\tthis.workerPool = [];\n\tthis.workerNextTaskID = 1;\n\tthis.workerSourceURL = '';\n\tthis.workerConfig = {\n\t\tformat: null,\n\t\tastcSupported: false,\n\t\tbptcSupported: false,\n\t\tetcSupported: false,\n\t\tdxtSupported: false,\n\t\tpvrtcSupported: false,\n\t};\n\n};\n\nBasisTextureLoader.prototype = Object.assign( Object.create( Loader.prototype ), {\n\n\tconstructor: BasisTextureLoader,\n\n\tsetTranscoderPath: function ( path ) {\n\n\t\tthis.transcoderPath = path;\n\n\t\treturn this;\n\n\t},\n\n\tsetWorkerLimit: function ( workerLimit ) {\n\n\t\tthis.workerLimit = workerLimit;\n\n\t\treturn this;\n\n\t},\n\n\tdetectSupport: function ( renderer ) {\n\n\t\tvar config = this.workerConfig;\n\n\t\tconfig.astcSupported = !! renderer.extensions.get( 'WEBGL_compressed_texture_astc' );\n\t\tconfig.bptcSupported = !! renderer.extensions.get( 'EXT_texture_compression_bptc' );\n\t\tconfig.etcSupported = !! renderer.extensions.get( 'WEBGL_compressed_texture_etc1' );\n\t\tconfig.dxtSupported = !! renderer.extensions.get( 'WEBGL_compressed_texture_s3tc' );\n\t\tconfig.pvrtcSupported = !! renderer.extensions.get( 'WEBGL_compressed_texture_pvrtc' )\n\t\t\t|| !! renderer.extensions.get( 'WEBKIT_WEBGL_compressed_texture_pvrtc' );\n\n\t\tif ( config.astcSupported ) {\n\n\t\t\tconfig.format = BasisTextureLoader.BASIS_FORMAT.cTFASTC_4x4;\n\n\t\t} else if ( config.bptcSupported ) {\n\n\t\t\tconfig.format = BasisTextureLoader.BASIS_FORMAT.cTFBC7_M5;\n\n\t\t} else if ( config.dxtSupported ) {\n\n\t\t\tconfig.format = BasisTextureLoader.BASIS_FORMAT.cTFBC3;\n\n\t\t} else if ( config.pvrtcSupported ) {\n\n\t\t\tconfig.format = BasisTextureLoader.BASIS_FORMAT.cTFPVRTC1_4_RGBA;\n\n\t\t} else if ( config.etcSupported ) {\n\n\t\t\tconfig.format = BasisTextureLoader.BASIS_FORMAT.cTFETC1;\n\n\t\t} else {\n\n\t\t\tthrow new Error( 'THREE.BasisTextureLoader: No suitable compressed texture format found.' );\n\n\t\t}\n\n\t\treturn this;\n\n\t},\n\n\tload: function ( url, onLoad, onProgress, onError ) {\n\n\t\tvar loader = new FileLoader( this.manager );\n\n\t\tloader.setResponseType( 'arraybuffer' );\n\n\t\tloader.load( url, ( buffer ) => {\n\n\t\t\tthis._createTexture( buffer )\n\t\t\t\t.then( onLoad )\n\t\t\t\t.catch( onError );\n\n\t\t}, onProgress, onError );\n\n\t},\n\n\t/**\n\t * @param  {ArrayBuffer} buffer\n\t * @return {Promise<CompressedTexture>}\n\t */\n\t_createTexture: function ( buffer ) {\n\n\t\tvar worker;\n\t\tvar taskID;\n\n\t\tvar taskCost = buffer.byteLength;\n\n\t\tvar texturePending = this._allocateWorker( taskCost )\n\t\t\t.then( ( _worker ) => {\n\n\t\t\t\tworker = _worker;\n\t\t\t\ttaskID = this.workerNextTaskID ++;\n\n\t\t\t\treturn new Promise( ( resolve, reject ) => {\n\n\t\t\t\t\tworker._callbacks[ taskID ] = { resolve, reject };\n\n\t\t\t\t\tworker.postMessage( { type: 'transcode', id: taskID, buffer }, [ buffer ] );\n\n\t\t\t\t} );\n\n\t\t\t} )\n\t\t\t.then( ( message ) => {\n\n\t\t\t\tvar config = this.workerConfig;\n\n\t\t\t\tvar { width, height, mipmaps, format } = message;\n\n\t\t\t\tvar texture;\n\n\t\t\t\tswitch ( format ) {\n\n\t\t\t\t\tcase BasisTextureLoader.BASIS_FORMAT.cTFASTC_4x4:\n\t\t\t\t\t\ttexture = new CompressedTexture( mipmaps, width, height, RGBA_ASTC_4x4_Format );\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase BasisTextureLoader.BASIS_FORMAT.cTFBC7_M5:\n\t\t\t\t\t\ttexture = new CompressedTexture( mipmaps, width, height, RGBA_BPTC_Format );\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase BasisTextureLoader.BASIS_FORMAT.cTFBC1:\n\t\t\t\t\tcase BasisTextureLoader.BASIS_FORMAT.cTFBC3:\n\t\t\t\t\t\ttexture = new CompressedTexture( mipmaps, width, height, BasisTextureLoader.DXT_FORMAT_MAP[ config.format ], UnsignedByteType );\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase BasisTextureLoader.BASIS_FORMAT.cTFETC1:\n\t\t\t\t\t\ttexture = new CompressedTexture( mipmaps, width, height, RGB_ETC1_Format );\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase BasisTextureLoader.BASIS_FORMAT.cTFPVRTC1_4_RGB:\n\t\t\t\t\t\ttexture = new CompressedTexture( mipmaps, width, height, RGB_PVRTC_4BPPV1_Format );\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase BasisTextureLoader.BASIS_FORMAT.cTFPVRTC1_4_RGBA:\n\t\t\t\t\t\ttexture = new CompressedTexture( mipmaps, width, height, RGBA_PVRTC_4BPPV1_Format );\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tthrow new Error( 'THREE.BasisTextureLoader: No supported format available.' );\n\n\t\t\t\t}\n\n\t\t\t\ttexture.minFilter = mipmaps.length === 1 ? LinearFilter : LinearMipmapLinearFilter;\n\t\t\t\ttexture.magFilter = LinearFilter;\n\t\t\t\ttexture.generateMipmaps = false;\n\t\t\t\ttexture.needsUpdate = true;\n\n\t\t\t\treturn texture;\n\n\t\t\t} );\n\n\t\ttexturePending\n\t\t\t.finally( () => {\n\n\t\t\t\tif ( worker && taskID ) {\n\n\t\t\t\t\tworker._taskLoad -= taskCost;\n\t\t\t\t\tdelete worker._callbacks[ taskID ];\n\n\t\t\t\t}\n\n\t\t\t} );\n\n\t\treturn texturePending;\n\n\t},\n\n\t_initTranscoder: function () {\n\n\t\tif ( ! this.transcoderPending ) {\n\n\t\t\t// Load transcoder wrapper.\n\t\t\tvar jsLoader = new FileLoader( this.manager );\n\t\t\tjsLoader.setPath( this.transcoderPath );\n\t\t\tvar jsContent = new Promise( ( resolve, reject ) => {\n\n\t\t\t\tjsLoader.load( 'basis_transcoder.js', resolve, undefined, reject );\n\n\t\t\t} );\n\n\t\t\t// Load transcoder WASM binary.\n\t\t\tvar binaryLoader = new FileLoader( this.manager );\n\t\t\tbinaryLoader.setPath( this.transcoderPath );\n\t\t\tbinaryLoader.setResponseType( 'arraybuffer' );\n\t\t\tvar binaryContent = new Promise( ( resolve, reject ) => {\n\n\t\t\t\tbinaryLoader.load( 'basis_transcoder.wasm', resolve, undefined, reject );\n\n\t\t\t} );\n\n\t\t\tthis.transcoderPending = Promise.all( [ jsContent, binaryContent ] )\n\t\t\t\t.then( ( [ jsContent, binaryContent ] ) => {\n\n\t\t\t\t\tvar fn = BasisTextureLoader.BasisWorker.toString();\n\n\t\t\t\t\tvar body = [\n\t\t\t\t\t\t'/* basis_transcoder.js */',\n\t\t\t\t\t\tjsContent,\n\t\t\t\t\t\t'/* worker */',\n\t\t\t\t\t\tfn.substring( fn.indexOf( '{' ) + 1, fn.lastIndexOf( '}' ) )\n\t\t\t\t\t].join( '\\n' );\n\n\t\t\t\t\tthis.workerSourceURL = URL.createObjectURL( new Blob( [ body ] ) );\n\t\t\t\t\tthis.transcoderBinary = binaryContent;\n\n\t\t\t\t} );\n\n\t\t}\n\n\t\treturn this.transcoderPending;\n\n\t},\n\n\t_allocateWorker: function ( taskCost ) {\n\n\t\treturn this._initTranscoder().then( () => {\n\n\t\t\tif ( this.workerPool.length < this.workerLimit ) {\n\n\t\t\t\tvar worker = new Worker( this.workerSourceURL );\n\n\t\t\t\tworker._callbacks = {};\n\t\t\t\tworker._taskLoad = 0;\n\n\t\t\t\tworker.postMessage( {\n\t\t\t\t\ttype: 'init',\n\t\t\t\t\tconfig: this.workerConfig,\n\t\t\t\t\ttranscoderBinary: this.transcoderBinary,\n\t\t\t\t} );\n\n\t\t\t\tworker.onmessage = function ( e ) {\n\n\t\t\t\t\tvar message = e.data;\n\n\t\t\t\t\tswitch ( message.type ) {\n\n\t\t\t\t\t\tcase 'transcode':\n\t\t\t\t\t\t\tworker._callbacks[ message.id ].resolve( message );\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tcase 'error':\n\t\t\t\t\t\t\tworker._callbacks[ message.id ].reject( message );\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\tconsole.error( 'THREE.BasisTextureLoader: Unexpected message, \"' + message.type + '\"' );\n\n\t\t\t\t\t}\n\n\t\t\t\t};\n\n\t\t\t\tthis.workerPool.push( worker );\n\n\t\t\t} else {\n\n\t\t\t\tthis.workerPool.sort( function ( a, b ) {\n\n\t\t\t\t\treturn a._taskLoad > b._taskLoad ? - 1 : 1;\n\n\t\t\t\t} );\n\n\t\t\t}\n\n\t\t\tvar worker = this.workerPool[ this.workerPool.length - 1 ];\n\n\t\t\tworker._taskLoad += taskCost;\n\n\t\t\treturn worker;\n\n\t\t} );\n\n\t},\n\n\tdispose: function () {\n\n\t\tfor ( var i = 0; i < this.workerPool.length; i ++ ) {\n\n\t\t\tthis.workerPool[ i ].terminate();\n\n\t\t}\n\n\t\tthis.workerPool.length = 0;\n\n\t\treturn this;\n\n\t}\n\n} );\n\n/* CONSTANTS */\n\nBasisTextureLoader.BASIS_FORMAT = {\n\tcTFETC1: 0,\n\tcTFETC2: 1,\n\tcTFBC1: 2,\n\tcTFBC3: 3,\n\tcTFBC4: 4,\n\tcTFBC5: 5,\n\tcTFBC7_M6_OPAQUE_ONLY: 6,\n\tcTFBC7_M5: 7,\n\tcTFPVRTC1_4_RGB: 8,\n\tcTFPVRTC1_4_RGBA: 9,\n\tcTFASTC_4x4: 10,\n\tcTFATC_RGB: 11,\n\tcTFATC_RGBA_INTERPOLATED_ALPHA: 12,\n\tcTFRGBA32: 13,\n\tcTFRGB565: 14,\n\tcTFBGR565: 15,\n\tcTFRGBA4444: 16,\n};\n\n// DXT formats, from:\n// http://www.khronos.org/registry/webgl/extensions/WEBGL_compressed_texture_s3tc/\nBasisTextureLoader.DXT_FORMAT = {\n\tCOMPRESSED_RGB_S3TC_DXT1_EXT: 0x83F0,\n\tCOMPRESSED_RGBA_S3TC_DXT1_EXT: 0x83F1,\n\tCOMPRESSED_RGBA_S3TC_DXT3_EXT: 0x83F2,\n\tCOMPRESSED_RGBA_S3TC_DXT5_EXT: 0x83F3,\n};\nBasisTextureLoader.DXT_FORMAT_MAP = {};\nBasisTextureLoader.DXT_FORMAT_MAP[ BasisTextureLoader.BASIS_FORMAT.cTFBC1 ] =\n\tBasisTextureLoader.DXT_FORMAT.COMPRESSED_RGB_S3TC_DXT1_EXT;\nBasisTextureLoader.DXT_FORMAT_MAP[ BasisTextureLoader.BASIS_FORMAT.cTFBC3 ] =\n\tBasisTextureLoader.DXT_FORMAT.COMPRESSED_RGBA_S3TC_DXT5_EXT;\n\n/* WEB WORKER */\n\nBasisTextureLoader.BasisWorker = function () {\n\n\tvar config;\n\tvar transcoderPending;\n\tvar _BasisFile;\n\n\tonmessage = function ( e ) {\n\n\t\tvar message = e.data;\n\n\t\tswitch ( message.type ) {\n\n\t\t\tcase 'init':\n\t\t\t\tconfig = message.config;\n\t\t\t\tinit( message.transcoderBinary );\n\t\t\t\tbreak;\n\n\t\t\tcase 'transcode':\n\t\t\t\ttranscoderPending.then( () => {\n\n\t\t\t\t\ttry {\n\n\t\t\t\t\t\tvar { width, height, hasAlpha, mipmaps, format } = transcode( message.buffer );\n\n\t\t\t\t\t\tvar buffers = [];\n\n\t\t\t\t\t\tfor ( var i = 0; i < mipmaps.length; ++ i ) {\n\n\t\t\t\t\t\t\tbuffers.push( mipmaps[ i ].data.buffer );\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tself.postMessage( { type: 'transcode', id: message.id, width, height, hasAlpha, mipmaps, format }, buffers );\n\n\t\t\t\t\t} catch ( error ) {\n\n\t\t\t\t\t\tconsole.error( error );\n\n\t\t\t\t\t\tself.postMessage( { type: 'error', id: message.id, error: error.message } );\n\n\t\t\t\t\t}\n\n\t\t\t\t} );\n\t\t\t\tbreak;\n\n\t\t}\n\n\t};\n\n\tfunction init( wasmBinary ) {\n\n\t\tvar BasisModule;\n\t\ttranscoderPending = new Promise( ( resolve ) => {\n\n\t\t\tBasisModule = { wasmBinary, onRuntimeInitialized: resolve };\n\t\t\tBASIS( BasisModule );\n\n\t\t} ).then( () => {\n\n\t\t\tvar { BasisFile, initializeBasis } = BasisModule;\n\n\t\t\t_BasisFile = BasisFile;\n\n\t\t\tinitializeBasis();\n\n\t\t} );\n\n\t}\n\n\tfunction transcode( buffer ) {\n\n\t\tvar basisFile = new _BasisFile( new Uint8Array( buffer ) );\n\n\t\tvar width = basisFile.getImageWidth( 0, 0 );\n\t\tvar height = basisFile.getImageHeight( 0, 0 );\n\t\tvar levels = basisFile.getNumLevels( 0 );\n\t\tvar hasAlpha = basisFile.getHasAlpha();\n\n\t\tfunction cleanup() {\n\n\t\t\tbasisFile.close();\n\t\t\tbasisFile.delete();\n\n\t\t}\n\n\t\tif ( ! hasAlpha ) {\n\n\t\t\tswitch ( config.format ) {\n\n\t\t\t\tcase 9: // Hardcoded: BasisTextureLoader.BASIS_FORMAT.cTFPVRTC1_4_RGBA\n\t\t\t\t\tconfig.format = 8; // Hardcoded: BasisTextureLoader.BASIS_FORMAT.cTFPVRTC1_4_RGB;\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tbreak;\n\n\t\t\t}\n\n\t\t}\n\n\t\tif ( ! width || ! height || ! levels ) {\n\n\t\t\tcleanup();\n\t\t\tthrow new Error( 'THREE.BasisTextureLoader:  Invalid .basis file' );\n\n\t\t}\n\n\t\tif ( ! basisFile.startTranscoding() ) {\n\n\t\t\tcleanup();\n\t\t\tthrow new Error( 'THREE.BasisTextureLoader: .startTranscoding failed' );\n\n\t\t}\n\n\t\tvar mipmaps = [];\n\n\t\tfor ( var mip = 0; mip < levels; mip ++ ) {\n\n\t\t\tvar mipWidth = basisFile.getImageWidth( 0, mip );\n\t\t\tvar mipHeight = basisFile.getImageHeight( 0, mip );\n\t\t\tvar dst = new Uint8Array( basisFile.getImageTranscodedSizeInBytes( 0, mip, config.format ) );\n\n\t\t\tvar status = basisFile.transcodeImage(\n\t\t\t\tdst,\n\t\t\t\t0,\n\t\t\t\tmip,\n\t\t\t\tconfig.format,\n\t\t\t\t0,\n\t\t\t\thasAlpha\n\t\t\t);\n\n\t\t\tif ( ! status ) {\n\n\t\t\t\tcleanup();\n\t\t\t\tthrow new Error( 'THREE.BasisTextureLoader: .transcodeImage failed.' );\n\n\t\t\t}\n\n\t\t\tmipmaps.push( { data: dst, width: mipWidth, height: mipHeight } );\n\n\t\t}\n\n\t\tcleanup();\n\n\t\treturn { width, height, hasAlpha, mipmaps, format: config.format };\n\n\t}\n\n};\n\nexport { BasisTextureLoader };\n"],"sourceRoot":""}