(window.webpackJsonpPOLY=window.webpackJsonpPOLY||[]).push([["vendors~Cop~Obj"],{502:function(e,t,r){"use strict";r.d(t,"a",(function(){return wt}));var a=r(4),n=r(10),i=r(122),o=r(430),s=r(29),l=r(431),u=r(12),d=r(2),p=r(36),c=r(126);function f(){var e=null,t=!1,r=null;function a(n,i){!1!==t&&(r(n,i),e.requestAnimationFrame(a))}return{start:function(){!0!==t&&null!==r&&(e.requestAnimationFrame(a),t=!0)},stop:function(){t=!1},setAnimationLoop:function(e){r=e},setContext:function(t){e=t}}}function h(e,t){var r=t.isWebGL2,a=new WeakMap;return{get:function(e){return e.isInterleavedBufferAttribute&&(e=e.data),a.get(e)},remove:function(t){t.isInterleavedBufferAttribute&&(t=t.data);var r=a.get(t);r&&(e.deleteBuffer(r.buffer),a.delete(t))},update:function(t,n){t.isInterleavedBufferAttribute&&(t=t.data);var i=a.get(t);void 0===i?a.set(t,function(t,r){var a=t.array,n=t.usage,i=e.createBuffer();e.bindBuffer(r,i),e.bufferData(r,a,n),t.onUploadCallback();var o=e.FLOAT;return a instanceof Float32Array?o=e.FLOAT:a instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):a instanceof Uint16Array?o=e.UNSIGNED_SHORT:a instanceof Int16Array?o=e.SHORT:a instanceof Uint32Array?o=e.UNSIGNED_INT:a instanceof Int32Array?o=e.INT:a instanceof Int8Array?o=e.BYTE:a instanceof Uint8Array&&(o=e.UNSIGNED_BYTE),{buffer:i,type:o,bytesPerElement:a.BYTES_PER_ELEMENT,version:t.version}}(t,n)):i.version<t.version&&(!function(t,a,n){var i=a.array,o=a.updateRange;e.bindBuffer(n,t),-1===o.count?e.bufferSubData(n,0,i):(r?e.bufferSubData(n,o.offset*i.BYTES_PER_ELEMENT,i,o.offset,o.count):e.bufferSubData(n,o.offset*i.BYTES_PER_ELEMENT,i.subarray(o.offset,o.offset+o.count)),o.count=-1)}(i.buffer,t,n),i.version=t.version)}}}var m=r(395),g=r(353),E=r(336),v=r(24),M=r(340),T=r(342),_=r(338);function b(e,t,r,n){var i,o,s=new v.a(0),l=0,u=null,d=0,p=null;function c(e,r){t.buffers.color.setClear(e.r,e.g,e.b,r,n)}return{getClearColor:function(){return s},setClearColor:function(e,t){s.set(e),c(s,l=void 0!==t?t:1)},getClearAlpha:function(){return l},setClearAlpha:function(e){c(s,l=e)},render:function(t,n,f,h){var v=n.background,b=e.xr,x=b.getSession&&b.getSession();if(x&&"additive"===x.environmentBlendMode&&(v=null),null===v?c(s,l):v&&v.isColor&&(c(v,1),h=!0),(e.autoClear||h)&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),v&&(v.isCubeTexture||v.isWebGLCubeRenderTarget||v.mapping===a.o)){void 0===o&&((o=new M.a(new m.a(1,1,1),new E.a({type:"BackgroundCubeMaterial",uniforms:Object(_.b)(T.a.cube.uniforms),vertexShader:T.a.cube.vertexShader,fragmentShader:T.a.cube.fragmentShader,side:a.h,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.deleteAttribute("normal"),o.geometry.deleteAttribute("uv"),o.onBeforeRender=function(e,t,r){this.matrixWorld.copyPosition(r.matrixWorld)},Object.defineProperty(o.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),r.update(o));var R=v.isWebGLCubeRenderTarget?v.texture:v;o.material.uniforms.envMap.value=R,o.material.uniforms.flipEnvMap.value=R.isCubeTexture?-1:1,u===v&&d===R.version&&p===e.toneMapping||(o.material.needsUpdate=!0,u=v,d=R.version,p=e.toneMapping),t.unshift(o,o.geometry,o.material,0,0,null)}else v&&v.isTexture&&(void 0===i&&((i=new M.a(new g.a(2,2),new E.a({type:"BackgroundMaterial",uniforms:Object(_.b)(T.a.background.uniforms),vertexShader:T.a.background.vertexShader,fragmentShader:T.a.background.fragmentShader,side:a.E,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.deleteAttribute("normal"),Object.defineProperty(i.material,"map",{get:function(){return this.uniforms.t2D.value}}),r.update(i)),i.material.uniforms.t2D.value=v,!0===v.matrixAutoUpdate&&v.updateMatrix(),i.material.uniforms.uvTransform.value.copy(v.matrix),u===v&&d===v.version&&p===e.toneMapping||(i.material.needsUpdate=!0,u=v,d=v.version,p=e.toneMapping),t.unshift(i,i.geometry,i.material,0,0,null))}}}function x(e,t,r,a){var n,i=a.isWebGL2;this.setMode=function(e){n=e},this.render=function(t,a){e.drawArrays(n,t,a),r.update(a,n)},this.renderInstances=function(a,o,s,l){if(0!==l){var u,d;if(i)u=e,d="drawArraysInstanced";else if(d="drawArraysInstancedANGLE",null===(u=t.get("ANGLE_instanced_arrays")))return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");u[d](n,o,s,l),r.update(s,n,l)}}}function R(e,t,r){var a;function n(t){if("highp"===t){if(e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.HIGH_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT).precision>0)return"highp";t="mediump"}return"mediump"===t&&e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.MEDIUM_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}var i="undefined"!=typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext||"undefined"!=typeof WebGL2ComputeRenderingContext&&e instanceof WebGL2ComputeRenderingContext,o=void 0!==r.precision?r.precision:"highp",s=n(o);s!==o&&(console.warn("THREE.WebGLRenderer:",o,"not supported, using",s,"instead."),o=s);var l=!0===r.logarithmicDepthBuffer,u=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),d=e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS),p=e.getParameter(e.MAX_TEXTURE_SIZE),c=e.getParameter(e.MAX_CUBE_MAP_TEXTURE_SIZE),f=e.getParameter(e.MAX_VERTEX_ATTRIBS),h=e.getParameter(e.MAX_VERTEX_UNIFORM_VECTORS),m=e.getParameter(e.MAX_VARYING_VECTORS),g=e.getParameter(e.MAX_FRAGMENT_UNIFORM_VECTORS),E=d>0,v=i||!!t.get("OES_texture_float");return{isWebGL2:i,getMaxAnisotropy:function(){if(void 0!==a)return a;var r=t.get("EXT_texture_filter_anisotropic");return a=null!==r?e.getParameter(r.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0},getMaxPrecision:n,precision:o,logarithmicDepthBuffer:l,maxTextures:u,maxVertexTextures:d,maxTextureSize:p,maxCubemapSize:c,maxAttributes:f,maxVertexUniforms:h,maxVaryings:m,maxFragmentUniforms:g,vertexTextures:E,floatFragmentTextures:v,floatVertexTextures:E&&v,maxSamples:i?e.getParameter(e.MAX_SAMPLES):0}}var S=r(38),A=r(142);function w(){var e=this,t=null,r=0,a=!1,n=!1,i=new A.a,o=new S.a,s={value:null,needsUpdate:!1};function l(){s.value!==t&&(s.value=t,s.needsUpdate=r>0),e.numPlanes=r,e.numIntersection=0}function u(t,r,a,n){var l=null!==t?t.length:0,u=null;if(0!==l){if(u=s.value,!0!==n||null===u){var d=a+4*l,p=r.matrixWorldInverse;o.getNormalMatrix(p),(null===u||u.length<d)&&(u=new Float32Array(d));for(var c=0,f=a;c!==l;++c,f+=4)i.copy(t[c]).applyMatrix4(p,o),i.normal.toArray(u,f),u[f+3]=i.constant}s.value=u,s.needsUpdate=!0}return e.numPlanes=l,e.numIntersection=0,u}this.uniform=s,this.numPlanes=0,this.numIntersection=0,this.init=function(e,n,i){var o=0!==e.length||n||0!==r||a;return a=n,t=u(e,i,0),r=e.length,o},this.beginShadows=function(){n=!0,u(null)},this.endShadows=function(){n=!1,l()},this.setState=function(e,i,o,d,p,c){if(!a||null===e||0===e.length||n&&!o)n?u(null):l();else{var f=n?0:r,h=4*f,m=p.clippingState||null;s.value=m,m=u(e,d,h,c);for(var g=0;g!==h;++g)m[g]=t[g];p.clippingState=m,this.numIntersection=i?this.numPlanes:0,this.numPlanes+=f}}}function L(e){var t={};return{get:function(r){if(void 0!==t[r])return t[r];var a;switch(r){case"WEBGL_depth_texture":a=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":a=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":a=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":a=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:a=e.getExtension(r)}return null===a&&console.warn("THREE.WebGLRenderer: "+r+" extension not supported."),t[r]=a,a}}}var P=r(328),y=r(329),F=r(460);function U(e,t,r){var a=new WeakMap,n=new WeakMap;function i(e){var o=e.target,s=a.get(o);for(var l in null!==s.index&&t.remove(s.index),s.attributes)t.remove(s.attributes[l]);o.removeEventListener("dispose",i),a.delete(o);var u=n.get(s);u&&(t.remove(u),n.delete(s)),r.memory.geometries--}function o(r){var a=[],i=r.index,o=r.attributes.position,s=0;if(null!==i){var l=i.array;s=i.version;for(var u=0,d=l.length;u<d;u+=3){var p=l[u+0],c=l[u+1],f=l[u+2];a.push(p,c,c,f,f,p)}}else{l=o.array;s=o.version;for(u=0,d=l.length/3-1;u<d;u+=3){p=u+0,c=u+1,f=u+2;a.push(p,c,c,f,f,p)}}var h=new(Object(F.a)(a)>65535?P.e:P.d)(a,1);h.version=s,t.update(h,e.ELEMENT_ARRAY_BUFFER);var m=n.get(r);m&&t.remove(m),n.set(r,h)}return{get:function(e,t){var n=a.get(t);return n||(t.addEventListener("dispose",i),t.isBufferGeometry?n=t:t.isGeometry&&(void 0===t._bufferGeometry&&(t._bufferGeometry=(new y.a).setFromObject(e)),n=t._bufferGeometry),a.set(t,n),r.memory.geometries++,n)},update:function(r){var a=r.index,n=r.attributes;for(var i in null!==a&&t.update(a,e.ELEMENT_ARRAY_BUFFER),n)t.update(n[i],e.ARRAY_BUFFER);var o=r.morphAttributes;for(var i in o)for(var s=o[i],l=0,u=s.length;l<u;l++)t.update(s[l],e.ARRAY_BUFFER)},getWireframeAttribute:function(e){var t=n.get(e);if(t){var r=e.index;null!==r&&t.version<r.version&&o(e)}else o(e);return n.get(e)}}}function D(e,t,r,a){var n,i,o,s=a.isWebGL2;this.setMode=function(e){n=e},this.setIndex=function(e){i=e.type,o=e.bytesPerElement},this.render=function(t,a){e.drawElements(n,a,i,t*o),r.update(a,n)},this.renderInstances=function(a,l,u,d){if(0!==d){var p,c;if(s)p=e,c="drawElementsInstanced";else if(c="drawElementsInstancedANGLE",null===(p=t.get("ANGLE_instanced_arrays")))return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");p[c](n,u,i,l*o,d),r.update(u,n,d)}}}function C(e){var t={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:t,programs:null,autoReset:!0,reset:function(){t.frame++,t.calls=0,t.triangles=0,t.points=0,t.lines=0},update:function(r,a,n){switch(n=n||1,t.calls++,a){case e.TRIANGLES:t.triangles+=n*(r/3);break;case e.LINES:t.lines+=n*(r/2);break;case e.LINE_STRIP:t.lines+=n*(r-1);break;case e.LINE_LOOP:t.lines+=n*r;break;case e.POINTS:t.points+=n*r;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",a)}}}}function N(e,t){return Math.abs(t[1])-Math.abs(e[1])}function I(e){var t={},r=new Float32Array(8);return{update:function(a,n,i,o){var s=a.morphTargetInfluences,l=void 0===s?0:s.length,u=t[n.id];if(void 0===u){u=[];for(var d=0;d<l;d++)u[d]=[d,0];t[n.id]=u}var p=i.morphTargets&&n.morphAttributes.position,c=i.morphNormals&&n.morphAttributes.normal;for(d=0;d<l;d++){0!==(h=u[d])[1]&&(p&&n.deleteAttribute("morphTarget"+d),c&&n.deleteAttribute("morphNormal"+d))}for(d=0;d<l;d++){(h=u[d])[0]=d,h[1]=s[d]}u.sort(N);var f=0;for(d=0;d<8;d++){var h;if(h=u[d]){var m=h[0],g=h[1];if(g){p&&n.setAttribute("morphTarget"+d,p[m]),c&&n.setAttribute("morphNormal"+d,c[m]),r[d]=g,f+=g;continue}}r[d]=0}var E=n.morphTargetsRelative?1:1-f;o.getUniforms().setValue(e,"morphTargetBaseInfluence",E),o.getUniforms().setValue(e,"morphTargetInfluences",r)}}}function O(e,t,r,a){var n=new WeakMap;return{update:function(i){var o=a.render.frame,s=i.geometry,l=t.get(i,s);return n.get(l)!==o&&(s.isGeometry&&l.updateFromObject(i),t.update(l),n.set(l,o)),i.isInstancedMesh&&r.update(i.instanceMatrix,e.ARRAY_BUFFER),l},dispose:function(){n=new WeakMap}}}var B=r(461),G=r(83);function W(e,t,r,n){G.a.call(this,null),this.image={data:e||null,width:t||1,height:r||1,depth:n||1},this.magFilter=a.kb,this.minFilter=a.kb,this.wrapR=a.l,this.generateMipmaps=!1,this.flipY=!1,this.needsUpdate=!0}function H(e,t,r,n){G.a.call(this,null),this.image={data:e||null,width:t||1,height:r||1,depth:n||1},this.magFilter=a.kb,this.minFilter=a.kb,this.wrapR=a.l,this.generateMipmaps=!1,this.flipY=!1,this.needsUpdate=!0}W.prototype=Object.create(G.a.prototype),W.prototype.constructor=W,W.prototype.isDataTexture2DArray=!0,H.prototype=Object.create(G.a.prototype),H.prototype.constructor=H,H.prototype.isDataTexture3D=!0;var X=new G.a,k=new W,V=new H,z=new B.a,Y=[],j=[],q=new Float32Array(16),K=new Float32Array(9),Z=new Float32Array(4);function Q(e,t,r){var a=e[0];if(a<=0||a>0)return e;var n=t*r,i=Y[n];if(void 0===i&&(i=new Float32Array(n),Y[n]=i),0!==t){a.toArray(i,0);for(var o=1,s=0;o!==t;++o)s+=r,e[o].toArray(i,s)}return i}function J(e,t){if(e.length!==t.length)return!1;for(var r=0,a=e.length;r<a;r++)if(e[r]!==t[r])return!1;return!0}function $(e,t){for(var r=0,a=t.length;r<a;r++)e[r]=t[r]}function ee(e,t){var r=j[t];void 0===r&&(r=new Int32Array(t),j[t]=r);for(var a=0;a!==t;++a)r[a]=e.allocateTextureUnit();return r}function te(e,t){var r=this.cache;r[0]!==t&&(e.uniform1f(this.addr,t),r[0]=t)}function re(e,t){var r=this.cache;if(void 0!==t.x)r[0]===t.x&&r[1]===t.y||(e.uniform2f(this.addr,t.x,t.y),r[0]=t.x,r[1]=t.y);else{if(J(r,t))return;e.uniform2fv(this.addr,t),$(r,t)}}function ae(e,t){var r=this.cache;if(void 0!==t.x)r[0]===t.x&&r[1]===t.y&&r[2]===t.z||(e.uniform3f(this.addr,t.x,t.y,t.z),r[0]=t.x,r[1]=t.y,r[2]=t.z);else if(void 0!==t.r)r[0]===t.r&&r[1]===t.g&&r[2]===t.b||(e.uniform3f(this.addr,t.r,t.g,t.b),r[0]=t.r,r[1]=t.g,r[2]=t.b);else{if(J(r,t))return;e.uniform3fv(this.addr,t),$(r,t)}}function ne(e,t){var r=this.cache;if(void 0!==t.x)r[0]===t.x&&r[1]===t.y&&r[2]===t.z&&r[3]===t.w||(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),r[0]=t.x,r[1]=t.y,r[2]=t.z,r[3]=t.w);else{if(J(r,t))return;e.uniform4fv(this.addr,t),$(r,t)}}function ie(e,t){var r=this.cache,a=t.elements;if(void 0===a){if(J(r,t))return;e.uniformMatrix2fv(this.addr,!1,t),$(r,t)}else{if(J(r,a))return;Z.set(a),e.uniformMatrix2fv(this.addr,!1,Z),$(r,a)}}function oe(e,t){var r=this.cache,a=t.elements;if(void 0===a){if(J(r,t))return;e.uniformMatrix3fv(this.addr,!1,t),$(r,t)}else{if(J(r,a))return;K.set(a),e.uniformMatrix3fv(this.addr,!1,K),$(r,a)}}function se(e,t){var r=this.cache,a=t.elements;if(void 0===a){if(J(r,t))return;e.uniformMatrix4fv(this.addr,!1,t),$(r,t)}else{if(J(r,a))return;q.set(a),e.uniformMatrix4fv(this.addr,!1,q),$(r,a)}}function le(e,t,r){var a=this.cache,n=r.allocateTextureUnit();a[0]!==n&&(e.uniform1i(this.addr,n),a[0]=n),r.safeSetTexture2D(t||X,n)}function ue(e,t,r){var a=this.cache,n=r.allocateTextureUnit();a[0]!==n&&(e.uniform1i(this.addr,n),a[0]=n),r.setTexture2DArray(t||k,n)}function de(e,t,r){var a=this.cache,n=r.allocateTextureUnit();a[0]!==n&&(e.uniform1i(this.addr,n),a[0]=n),r.setTexture3D(t||V,n)}function pe(e,t,r){var a=this.cache,n=r.allocateTextureUnit();a[0]!==n&&(e.uniform1i(this.addr,n),a[0]=n),r.safeSetTextureCube(t||z,n)}function ce(e,t){var r=this.cache;r[0]!==t&&(e.uniform1i(this.addr,t),r[0]=t)}function fe(e,t){var r=this.cache;J(r,t)||(e.uniform2iv(this.addr,t),$(r,t))}function he(e,t){var r=this.cache;J(r,t)||(e.uniform3iv(this.addr,t),$(r,t))}function me(e,t){var r=this.cache;J(r,t)||(e.uniform4iv(this.addr,t),$(r,t))}function ge(e,t){var r=this.cache;r[0]!==t&&(e.uniform1ui(this.addr,t),r[0]=t)}function Ee(e,t){e.uniform1fv(this.addr,t)}function ve(e,t){e.uniform1iv(this.addr,t)}function Me(e,t){e.uniform2iv(this.addr,t)}function Te(e,t){e.uniform3iv(this.addr,t)}function _e(e,t){e.uniform4iv(this.addr,t)}function be(e,t){var r=Q(t,this.size,2);e.uniform2fv(this.addr,r)}function xe(e,t){var r=Q(t,this.size,3);e.uniform3fv(this.addr,r)}function Re(e,t){var r=Q(t,this.size,4);e.uniform4fv(this.addr,r)}function Se(e,t){var r=Q(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,r)}function Ae(e,t){var r=Q(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,r)}function we(e,t){var r=Q(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,r)}function Le(e,t,r){var a=t.length,n=ee(r,a);e.uniform1iv(this.addr,n);for(var i=0;i!==a;++i)r.safeSetTexture2D(t[i]||X,n[i])}function Pe(e,t,r){var a=t.length,n=ee(r,a);e.uniform1iv(this.addr,n);for(var i=0;i!==a;++i)r.safeSetTextureCube(t[i]||z,n[i])}function ye(e,t,r){this.id=e,this.addr=r,this.cache=[],this.setValue=function(e){switch(e){case 5126:return te;case 35664:return re;case 35665:return ae;case 35666:return ne;case 35674:return ie;case 35675:return oe;case 35676:return se;case 5124:case 35670:return ce;case 35667:case 35671:return fe;case 35668:case 35672:return he;case 35669:case 35673:return me;case 5125:return ge;case 35678:case 36198:case 36298:case 36306:case 35682:return le;case 35679:case 36299:case 36307:return de;case 35680:case 36300:case 36308:case 36293:return pe;case 36289:case 36303:case 36311:case 36292:return ue}}(t.type)}function Fe(e,t,r){this.id=e,this.addr=r,this.cache=[],this.size=t.size,this.setValue=function(e){switch(e){case 5126:return Ee;case 35664:return be;case 35665:return xe;case 35666:return Re;case 35674:return Se;case 35675:return Ae;case 35676:return we;case 5124:case 35670:return ve;case 35667:case 35671:return Me;case 35668:case 35672:return Te;case 35669:case 35673:return _e;case 35678:case 36198:case 36298:case 36306:case 35682:return Le;case 35680:case 36300:case 36308:case 36293:return Pe}}(t.type)}function Ue(e){this.id=e,this.seq=[],this.map={}}Fe.prototype.updateCache=function(e){var t=this.cache;e instanceof Float32Array&&t.length!==e.length&&(this.cache=new Float32Array(e.length)),$(t,e)},Ue.prototype.setValue=function(e,t,r){for(var a=this.seq,n=0,i=a.length;n!==i;++n){var o=a[n];o.setValue(e,t[o.id],r)}};var De=/([\w\d_]+)(\])?(\[|\.)?/g;function Ce(e,t){e.seq.push(t),e.map[t.id]=t}function Ne(e,t,r){var a=e.name,n=a.length;for(De.lastIndex=0;;){var i=De.exec(a),o=De.lastIndex,s=i[1],l="]"===i[2],u=i[3];if(l&&(s|=0),void 0===u||"["===u&&o+2===n){Ce(r,void 0===u?new ye(s,e,t):new Fe(s,e,t));break}var d=r.map[s];void 0===d&&Ce(r,d=new Ue(s)),r=d}}function Ie(e,t){this.seq=[],this.map={};for(var r=e.getProgramParameter(t,e.ACTIVE_UNIFORMS),a=0;a<r;++a){var n=e.getActiveUniform(t,a);Ne(n,e.getUniformLocation(t,n.name),this)}}function Oe(e,t,r){var a=e.createShader(t);return e.shaderSource(a,r),e.compileShader(a),a}Ie.prototype.setValue=function(e,t,r,a){var n=this.map[t];void 0!==n&&n.setValue(e,r,a)},Ie.prototype.setOptional=function(e,t,r){var a=t[r];void 0!==a&&this.setValue(e,r,a)},Ie.upload=function(e,t,r,a){for(var n=0,i=t.length;n!==i;++n){var o=t[n],s=r[o.id];!1!==s.needsUpdate&&o.setValue(e,s.value,a)}},Ie.seqWithValue=function(e,t){for(var r=[],a=0,n=e.length;a!==n;++a){var i=e[a];i.id in t&&r.push(i)}return r};var Be=r(501),Ge=0;function We(e){switch(e){case a.Q:return["Linear","( value )"];case a.id:return["sRGB","( value )"];case a.bc:return["RGBE","( value )"];case a.gc:return["RGBM","( value, 7.0 )"];case a.fc:return["RGBM","( value, 16.0 )"];case a.ac:return["RGBD","( value, 256.0 )"];case a.F:return["Gamma","( value, float( GAMMA_FACTOR ) )"];case a.X:return["LogLuv","( value )"];default:throw new Error("unsupported encoding: "+e)}}function He(e,t,r){var a=e.getShaderParameter(t,e.COMPILE_STATUS),n=e.getShaderInfoLog(t).trim();return a&&""===n?"":"THREE.WebGLShader: gl.getShaderInfoLog() "+r+"\n"+n+function(e){for(var t=e.split("\n"),r=0;r<t.length;r++)t[r]=r+1+": "+t[r];return t.join("\n")}(e.getShaderSource(t))}function Xe(e,t){var r=We(t);return"vec4 "+e+"( vec4 value ) { return "+r[0]+"ToLinear"+r[1]+"; }"}function ke(e,t){var r;switch(t){case a.W:r="Linear";break;case a.qc:r="Reinhard";break;case a.Vc:r="Uncharted2";break;case a.k:r="OptimizedCineon";break;case a.a:r="ACESFilmic";break;default:throw new Error("unsupported toneMapping: "+t)}return"vec3 "+e+"( vec3 color ) { return "+r+"ToneMapping( color ); }"}function Ve(e){return""!==e}function ze(e,t){return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function Ye(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}var je=/^[ \t]*#include +<([\w\d./]+)>/gm;function qe(e){return e.replace(je,Ke)}function Ke(e,t){var r=Be.a[t];if(void 0===r)throw new Error("Can not resolve #include <"+t+">");return qe(r)}var Ze=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,Qe=/#pragma unroll_loop_start[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}[\s]+?#pragma unroll_loop_end/g;function Je(e){return e.replace(Qe,et).replace(Ze,$e)}function $e(e,t,r,a){return console.warn("WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead."),et(e,t,r,a)}function et(e,t,r,a){for(var n="",i=parseInt(t);i<parseInt(r);i++)n+=a.replace(/\[ i \]/g,"[ "+i+" ]").replace(/UNROLLED_LOOP_INDEX/g,i);return n}function tt(e){var t="precision "+e.precision+" float;\nprecision "+e.precision+" int;";return"highp"===e.precision?t+="\n#define HIGH_PRECISION":"mediump"===e.precision?t+="\n#define MEDIUM_PRECISION":"lowp"===e.precision&&(t+="\n#define LOW_PRECISION"),t}function rt(e,t,r){var n,i,o,s,l,u=e.getContext(),d=r.defines,p=r.vertexShader,c=r.fragmentShader,f=function(e){var t="SHADOWMAP_TYPE_BASIC";return e.shadowMapType===a.Ab?t="SHADOWMAP_TYPE_PCF":e.shadowMapType===a.Bb?t="SHADOWMAP_TYPE_PCF_SOFT":e.shadowMapType===a.dd&&(t="SHADOWMAP_TYPE_VSM"),t}(r),h=function(e){var t="ENVMAP_TYPE_CUBE";if(e.envMap)switch(e.envMapMode){case a.m:case a.n:t="ENVMAP_TYPE_CUBE";break;case a.o:case a.p:t="ENVMAP_TYPE_CUBE_UV";break;case a.A:case a.B:t="ENVMAP_TYPE_EQUIREC";break;case a.Ic:t="ENVMAP_TYPE_SPHERE"}return t}(r),m=function(e){var t="ENVMAP_MODE_REFLECTION";if(e.envMap)switch(e.envMapMode){case a.n:case a.B:t="ENVMAP_MODE_REFRACTION"}return t}(r),g=function(e){var t="ENVMAP_BLENDING_NONE";if(e.envMap)switch(e.combine){case a.jb:t="ENVMAP_BLENDING_MULTIPLY";break;case a.hb:t="ENVMAP_BLENDING_MIX";break;case a.c:t="ENVMAP_BLENDING_ADD"}return t}(r),E=e.gammaFactor>0?e.gammaFactor:1,v=r.isWebGL2?"":function(e){return[e.extensionDerivatives||e.envMapCubeUV||e.bumpMap||e.tangentSpaceNormalMap||e.clearcoatNormalMap||e.flatShading||"physical"===e.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(e.extensionFragDepth||e.logarithmicDepthBuffer)&&e.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",e.extensionDrawBuffers&&e.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(e.extensionShaderTextureLOD||e.envMap)&&e.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(Ve).join("\n")}(r),M=function(e){var t=[];for(var r in e){var a=e[r];!1!==a&&t.push("#define "+r+" "+a)}return t.join("\n")}(d),T=u.createProgram();if(r.isRawShaderMaterial?((n=[M].filter(Ve).join("\n")).length>0&&(n+="\n"),(i=[v,M].filter(Ve).join("\n")).length>0&&(i+="\n")):(n=[tt(r),"#define SHADER_NAME "+r.shaderName,M,r.instancing?"#define USE_INSTANCING":"",r.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+E,"#define MAX_BONES "+r.maxBones,r.useFog&&r.fog?"#define USE_FOG":"",r.useFog&&r.fogExp2?"#define FOG_EXP2":"",r.map?"#define USE_MAP":"",r.envMap?"#define USE_ENVMAP":"",r.envMap?"#define "+m:"",r.lightMap?"#define USE_LIGHTMAP":"",r.aoMap?"#define USE_AOMAP":"",r.emissiveMap?"#define USE_EMISSIVEMAP":"",r.bumpMap?"#define USE_BUMPMAP":"",r.normalMap?"#define USE_NORMALMAP":"",r.normalMap&&r.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",r.normalMap&&r.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",r.clearcoatMap?"#define USE_CLEARCOATMAP":"",r.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",r.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",r.displacementMap&&r.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",r.specularMap?"#define USE_SPECULARMAP":"",r.roughnessMap?"#define USE_ROUGHNESSMAP":"",r.metalnessMap?"#define USE_METALNESSMAP":"",r.alphaMap?"#define USE_ALPHAMAP":"",r.vertexTangents?"#define USE_TANGENT":"",r.vertexColors?"#define USE_COLOR":"",r.vertexUvs?"#define USE_UV":"",r.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",r.flatShading?"#define FLAT_SHADED":"",r.skinning?"#define USE_SKINNING":"",r.useVertexTexture?"#define BONE_TEXTURE":"",r.morphTargets?"#define USE_MORPHTARGETS":"",r.morphNormals&&!1===r.flatShading?"#define USE_MORPHNORMALS":"",r.doubleSided?"#define DOUBLE_SIDED":"",r.flipSided?"#define FLIP_SIDED":"",r.shadowMapEnabled?"#define USE_SHADOWMAP":"",r.shadowMapEnabled?"#define "+f:"",r.sizeAttenuation?"#define USE_SIZEATTENUATION":"",r.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",r.logarithmicDepthBuffer&&r.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING"," attribute mat4 instanceMatrix;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#ifdef USE_COLOR","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(Ve).join("\n"),i=[v,tt(r),"#define SHADER_NAME "+r.shaderName,M,r.alphaTest?"#define ALPHATEST "+r.alphaTest+(r.alphaTest%1?"":".0"):"","#define GAMMA_FACTOR "+E,r.useFog&&r.fog?"#define USE_FOG":"",r.useFog&&r.fogExp2?"#define FOG_EXP2":"",r.map?"#define USE_MAP":"",r.matcap?"#define USE_MATCAP":"",r.envMap?"#define USE_ENVMAP":"",r.envMap?"#define "+h:"",r.envMap?"#define "+m:"",r.envMap?"#define "+g:"",r.lightMap?"#define USE_LIGHTMAP":"",r.aoMap?"#define USE_AOMAP":"",r.emissiveMap?"#define USE_EMISSIVEMAP":"",r.bumpMap?"#define USE_BUMPMAP":"",r.normalMap?"#define USE_NORMALMAP":"",r.normalMap&&r.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",r.normalMap&&r.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",r.clearcoatMap?"#define USE_CLEARCOATMAP":"",r.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",r.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",r.specularMap?"#define USE_SPECULARMAP":"",r.roughnessMap?"#define USE_ROUGHNESSMAP":"",r.metalnessMap?"#define USE_METALNESSMAP":"",r.alphaMap?"#define USE_ALPHAMAP":"",r.sheen?"#define USE_SHEEN":"",r.vertexTangents?"#define USE_TANGENT":"",r.vertexColors?"#define USE_COLOR":"",r.vertexUvs?"#define USE_UV":"",r.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",r.gradientMap?"#define USE_GRADIENTMAP":"",r.flatShading?"#define FLAT_SHADED":"",r.doubleSided?"#define DOUBLE_SIDED":"",r.flipSided?"#define FLIP_SIDED":"",r.shadowMapEnabled?"#define USE_SHADOWMAP":"",r.shadowMapEnabled?"#define "+f:"",r.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",r.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",r.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",r.logarithmicDepthBuffer&&r.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"",(r.extensionShaderTextureLOD||r.envMap)&&r.rendererExtensionShaderTextureLod?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",r.toneMapping!==a.rb?"#define TONE_MAPPING":"",r.toneMapping!==a.rb?Be.a.tonemapping_pars_fragment:"",r.toneMapping!==a.rb?ke("toneMapping",r.toneMapping):"",r.dithering?"#define DITHERING":"",r.outputEncoding||r.mapEncoding||r.matcapEncoding||r.envMapEncoding||r.emissiveMapEncoding||r.lightMapEncoding?Be.a.encodings_pars_fragment:"",r.mapEncoding?Xe("mapTexelToLinear",r.mapEncoding):"",r.matcapEncoding?Xe("matcapTexelToLinear",r.matcapEncoding):"",r.envMapEncoding?Xe("envMapTexelToLinear",r.envMapEncoding):"",r.emissiveMapEncoding?Xe("emissiveMapTexelToLinear",r.emissiveMapEncoding):"",r.lightMapEncoding?Xe("lightMapTexelToLinear",r.lightMapEncoding):"",r.outputEncoding?(o="linearToOutputTexel",s=r.outputEncoding,l=We(s),"vec4 "+o+"( vec4 value ) { return LinearTo"+l[0]+l[1]+"; }"):"",r.depthPacking?"#define DEPTH_PACKING "+r.depthPacking:"","\n"].filter(Ve).join("\n")),p=Ye(p=ze(p=qe(p),r),r),c=Ye(c=ze(c=qe(c),r),r),p=Je(p),c=Je(c),r.isWebGL2&&!r.isRawShaderMaterial){var _=!1,b=/^\s*#version\s+300\s+es\s*\n/;r.isShaderMaterial&&null!==p.match(b)&&null!==c.match(b)&&(_=!0,p=p.replace(b,""),c=c.replace(b,"")),n=["#version 300 es\n","#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+n,i=["#version 300 es\n","#define varying in",_?"":"out highp vec4 pc_fragColor;",_?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+i}var x,R,S=n+p,A=i+c,w=Oe(u,u.VERTEX_SHADER,S),L=Oe(u,u.FRAGMENT_SHADER,A);if(u.attachShader(T,w),u.attachShader(T,L),void 0!==r.index0AttributeName?u.bindAttribLocation(T,0,r.index0AttributeName):!0===r.morphTargets&&u.bindAttribLocation(T,0,"position"),u.linkProgram(T),e.debug.checkShaderErrors){var P=u.getProgramInfoLog(T).trim(),y=u.getShaderInfoLog(w).trim(),F=u.getShaderInfoLog(L).trim(),U=!0,D=!0;if(!1===u.getProgramParameter(T,u.LINK_STATUS)){U=!1;var C=He(u,w,"vertex"),N=He(u,L,"fragment");console.error("THREE.WebGLProgram: shader error: ",u.getError(),"gl.VALIDATE_STATUS",u.getProgramParameter(T,u.VALIDATE_STATUS),"gl.getProgramInfoLog",P,C,N)}else""!==P?console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",P):""!==y&&""!==F||(D=!1);D&&(this.diagnostics={runnable:U,programLog:P,vertexShader:{log:y,prefix:n},fragmentShader:{log:F,prefix:i}})}return u.detachShader(T,w),u.detachShader(T,L),u.deleteShader(w),u.deleteShader(L),this.getUniforms=function(){return void 0===x&&(x=new Ie(u,T)),x},this.getAttributes=function(){return void 0===R&&(R=function(e,t){for(var r={},a=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES),n=0;n<a;n++){var i=e.getActiveAttrib(t,n).name;r[i]=e.getAttribLocation(t,i)}return r}(u,T)),R},this.destroy=function(){u.deleteProgram(T),this.program=void 0},this.name=r.shaderName,this.id=Ge++,this.cacheKey=t,this.usedTimes=1,this.program=T,this.vertexShader=w,this.fragmentShader=L,this}function at(e,t,r){var n=[],i=r.isWebGL2,o=r.logarithmicDepthBuffer,s=r.floatVertexTextures,l=r.precision,u=r.maxVertexUniforms,d=r.vertexTextures,p={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},c=["precision","isWebGL2","supportsVertexTextures","outputEncoding","instancing","map","mapEncoding","matcap","matcapEncoding","envMap","envMapMode","envMapEncoding","envMapCubeUV","lightMap","lightMapEncoding","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","objectSpaceNormalMap","tangentSpaceNormalMap","clearcoatMap","clearcoatRoughnessMap","clearcoatNormalMap","displacementMap","specularMap","roughnessMap","metalnessMap","gradientMap","alphaMap","combine","vertexColors","vertexTangents","vertexUvs","uvsVertexOnly","fog","useFog","fogExp2","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","maxMorphTargets","maxMorphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","numDirLightShadows","numPointLightShadows","numSpotLightShadows","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","alphaTest","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering","sheen"];function f(e){var t;return e?e.isTexture?t=e.encoding:e.isWebGLRenderTarget&&(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),t=e.texture.encoding):t=a.Q,t}this.getParameters=function(n,c,h,m,g,E,v){var M=m.fog,b=n.isMeshStandardMaterial?m.environment:null,x=n.envMap||b,R=p[n.type],S=v.isSkinnedMesh?function(e){var t=e.skeleton.bones;if(s)return 1024;var r=u,a=Math.floor((r-20)/4),n=Math.min(a,t.length);return n<t.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+t.length+" bones. This GPU supports "+n+"."),0):n}(v):0;null!==n.precision&&(l=r.getMaxPrecision(n.precision))!==n.precision&&console.warn("THREE.WebGLProgram.getParameters:",n.precision,"not supported, using",l,"instead.");var A=function(e,t){var r;if(t){var a=T.a[t];r={name:e.type,uniforms:_.a.clone(a.uniforms),vertexShader:a.vertexShader,fragmentShader:a.fragmentShader}}else r={name:e.type,uniforms:e.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader};return r}(n,R);n.onBeforeCompile(A,e);var w=e.getRenderTarget();return{isWebGL2:i,shaderID:R,shaderName:A.name,uniforms:A.uniforms,vertexShader:A.vertexShader,fragmentShader:A.fragmentShader,defines:n.defines,isRawShaderMaterial:n.isRawShaderMaterial,isShaderMaterial:n.isShaderMaterial,precision:l,instancing:!0===v.isInstancedMesh,supportsVertexTextures:d,outputEncoding:null!==w?f(w.texture):e.outputEncoding,map:!!n.map,mapEncoding:f(n.map),matcap:!!n.matcap,matcapEncoding:f(n.matcap),envMap:!!x,envMapMode:x&&x.mapping,envMapEncoding:f(x),envMapCubeUV:!!x&&(x.mapping===a.o||x.mapping===a.p),lightMap:!!n.lightMap,lightMapEncoding:f(n.lightMap),aoMap:!!n.aoMap,emissiveMap:!!n.emissiveMap,emissiveMapEncoding:f(n.emissiveMap),bumpMap:!!n.bumpMap,normalMap:!!n.normalMap,objectSpaceNormalMap:n.normalMapType===a.ub,tangentSpaceNormalMap:n.normalMapType===a.Qc,clearcoatMap:!!n.clearcoatMap,clearcoatRoughnessMap:!!n.clearcoatRoughnessMap,clearcoatNormalMap:!!n.clearcoatNormalMap,displacementMap:!!n.displacementMap,roughnessMap:!!n.roughnessMap,metalnessMap:!!n.metalnessMap,specularMap:!!n.specularMap,alphaMap:!!n.alphaMap,gradientMap:!!n.gradientMap,sheen:!!n.sheen,combine:n.combine,vertexTangents:n.normalMap&&n.vertexTangents,vertexColors:n.vertexColors,vertexUvs:!!(n.map||n.bumpMap||n.normalMap||n.specularMap||n.alphaMap||n.emissiveMap||n.roughnessMap||n.metalnessMap||n.clearcoatMap||n.clearcoatRoughnessMap||n.clearcoatNormalMap||n.displacementMap),uvsVertexOnly:!(n.map||n.bumpMap||n.normalMap||n.specularMap||n.alphaMap||n.emissiveMap||n.roughnessMap||n.metalnessMap||n.clearcoatNormalMap||!n.displacementMap),fog:!!M,useFog:n.fog,fogExp2:M&&M.isFogExp2,flatShading:n.flatShading,sizeAttenuation:n.sizeAttenuation,logarithmicDepthBuffer:o,skinning:n.skinning&&S>0,maxBones:S,useVertexTexture:s,morphTargets:n.morphTargets,morphNormals:n.morphNormals,maxMorphTargets:e.maxMorphTargets,maxMorphNormals:e.maxMorphNormals,numDirLights:c.directional.length,numPointLights:c.point.length,numSpotLights:c.spot.length,numRectAreaLights:c.rectArea.length,numHemiLights:c.hemi.length,numDirLightShadows:c.directionalShadowMap.length,numPointLightShadows:c.pointShadowMap.length,numSpotLightShadows:c.spotShadowMap.length,numClippingPlanes:g,numClipIntersection:E,dithering:n.dithering,shadowMapEnabled:e.shadowMap.enabled&&h.length>0,shadowMapType:e.shadowMap.type,toneMapping:n.toneMapped?e.toneMapping:a.rb,physicallyCorrectLights:e.physicallyCorrectLights,premultipliedAlpha:n.premultipliedAlpha,alphaTest:n.alphaTest,doubleSided:n.side===a.w,flipSided:n.side===a.h,depthPacking:void 0!==n.depthPacking&&n.depthPacking,index0AttributeName:n.index0AttributeName,extensionDerivatives:n.extensions&&n.extensions.derivatives,extensionFragDepth:n.extensions&&n.extensions.fragDepth,extensionDrawBuffers:n.extensions&&n.extensions.drawBuffers,extensionShaderTextureLOD:n.extensions&&n.extensions.shaderTextureLOD,rendererExtensionFragDepth:i||null!==t.get("EXT_frag_depth"),rendererExtensionDrawBuffers:i||null!==t.get("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:i||null!==t.get("EXT_shader_texture_lod"),onBeforeCompile:n.onBeforeCompile}},this.getProgramCacheKey=function(t){var r=[];if(t.shaderID?r.push(t.shaderID):(r.push(t.fragmentShader),r.push(t.vertexShader)),void 0!==t.defines)for(var a in t.defines)r.push(a),r.push(t.defines[a]);if(void 0===t.isRawShaderMaterial){for(var n=0;n<c.length;n++)r.push(t[c[n]]);r.push(e.outputEncoding),r.push(e.gammaFactor)}return r.push(t.onBeforeCompile.toString()),r.join()},this.acquireProgram=function(t,r){for(var a,i=0,o=n.length;i<o;i++){var s=n[i];if(s.cacheKey===r){++(a=s).usedTimes;break}}return void 0===a&&(a=new rt(e,r,t),n.push(a)),a},this.releaseProgram=function(e){if(0==--e.usedTimes){var t=n.indexOf(e);n[t]=n[n.length-1],n.pop(),e.destroy()}},this.programs=n}function nt(){var e=new WeakMap;return{get:function(t){var r=e.get(t);return void 0===r&&(r={},e.set(t,r)),r},remove:function(t){e.delete(t)},update:function(t,r,a){e.get(t)[r]=a},dispose:function(){e=new WeakMap}}}function it(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.program!==t.program?e.program.id-t.program.id:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function ot(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function st(){var e=[],t=0,r=[],a=[],n={id:-1};function i(r,a,i,o,s,l){var u=e[t];return void 0===u?(u={id:r.id,object:r,geometry:a,material:i,program:i.program||n,groupOrder:o,renderOrder:r.renderOrder,z:s,group:l},e[t]=u):(u.id=r.id,u.object=r,u.geometry=a,u.material=i,u.program=i.program||n,u.groupOrder=o,u.renderOrder=r.renderOrder,u.z=s,u.group=l),t++,u}return{opaque:r,transparent:a,init:function(){t=0,r.length=0,a.length=0},push:function(e,t,n,o,s,l){var u=i(e,t,n,o,s,l);(!0===n.transparent?a:r).push(u)},unshift:function(e,t,n,o,s,l){var u=i(e,t,n,o,s,l);(!0===n.transparent?a:r).unshift(u)},finish:function(){for(var r=t,a=e.length;r<a;r++){var n=e[r];if(null===n.id)break;n.id=null,n.object=null,n.geometry=null,n.material=null,n.program=null,n.group=null}},sort:function(e,t){r.length>1&&r.sort(e||it),a.length>1&&a.sort(t||ot)}}}function lt(){var e=new WeakMap;function t(r){var a=r.target;a.removeEventListener("dispose",t),e.delete(a)}return{get:function(r,a){var n,i=e.get(r);return void 0===i?(n=new st,e.set(r,new WeakMap),e.get(r).set(a,n),r.addEventListener("dispose",t)):void 0===(n=i.get(a))&&(n=new st,i.set(a,n)),n},dispose:function(){e=new WeakMap}}}function ut(){var e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];var r;switch(t.type){case"DirectionalLight":r={direction:new d.a,color:new v.a};break;case"SpotLight":r={position:new d.a,direction:new d.a,color:new v.a,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":r={position:new d.a,color:new v.a,distance:0,decay:0};break;case"HemisphereLight":r={direction:new d.a,skyColor:new v.a,groundColor:new v.a};break;case"RectAreaLight":r={color:new v.a,position:new d.a,halfWidth:new d.a,halfHeight:new d.a}}return e[t.id]=r,r}}}var dt=0;function pt(e,t){return(t.castShadow?1:0)-(e.castShadow?1:0)}function ct(){for(var e,t=new ut,r=(e={},{get:function(t){if(void 0!==e[t.id])return e[t.id];var r;switch(t.type){case"DirectionalLight":case"SpotLight":r={shadowBias:0,shadowRadius:1,shadowMapSize:new u.a};break;case"PointLight":r={shadowBias:0,shadowRadius:1,shadowMapSize:new u.a,shadowCameraNear:1,shadowCameraFar:1e3}}return e[t.id]=r,r}}),a={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]},n=0;n<9;n++)a.probe.push(new d.a);var i=new d.a,o=new s.a,l=new s.a;return{setup:function(e,n,s){for(var u=0,d=0,p=0,c=0;c<9;c++)a.probe[c].set(0,0,0);var f=0,h=0,m=0,g=0,E=0,v=0,M=0,T=0,_=s.matrixWorldInverse;e.sort(pt),c=0;for(var b=e.length;c<b;c++){var x=e[c],R=x.color,S=x.intensity,A=x.distance,w=x.shadow&&x.shadow.map?x.shadow.map.texture:null;if(x.isAmbientLight)u+=R.r*S,d+=R.g*S,p+=R.b*S;else if(x.isLightProbe)for(var L=0;L<9;L++)a.probe[L].addScaledVector(x.sh.coefficients[L],S);else if(x.isDirectionalLight){if((F=t.get(x)).color.copy(x.color).multiplyScalar(x.intensity),F.direction.setFromMatrixPosition(x.matrixWorld),i.setFromMatrixPosition(x.target.matrixWorld),F.direction.sub(i),F.direction.transformDirection(_),x.castShadow){var P=x.shadow;(y=r.get(x)).shadowBias=P.bias,y.shadowRadius=P.radius,y.shadowMapSize=P.mapSize,a.directionalShadow[f]=y,a.directionalShadowMap[f]=w,a.directionalShadowMatrix[f]=x.shadow.matrix,v++}a.directional[f]=F,f++}else if(x.isSpotLight){if((F=t.get(x)).position.setFromMatrixPosition(x.matrixWorld),F.position.applyMatrix4(_),F.color.copy(R).multiplyScalar(S),F.distance=A,F.direction.setFromMatrixPosition(x.matrixWorld),i.setFromMatrixPosition(x.target.matrixWorld),F.direction.sub(i),F.direction.transformDirection(_),F.coneCos=Math.cos(x.angle),F.penumbraCos=Math.cos(x.angle*(1-x.penumbra)),F.decay=x.decay,x.castShadow){P=x.shadow;(y=r.get(x)).shadowBias=P.bias,y.shadowRadius=P.radius,y.shadowMapSize=P.mapSize,a.spotShadow[m]=y,a.spotShadowMap[m]=w,a.spotShadowMatrix[m]=x.shadow.matrix,T++}a.spot[m]=F,m++}else if(x.isRectAreaLight){(F=t.get(x)).color.copy(R).multiplyScalar(S),F.position.setFromMatrixPosition(x.matrixWorld),F.position.applyMatrix4(_),l.identity(),o.copy(x.matrixWorld),o.premultiply(_),l.extractRotation(o),F.halfWidth.set(.5*x.width,0,0),F.halfHeight.set(0,.5*x.height,0),F.halfWidth.applyMatrix4(l),F.halfHeight.applyMatrix4(l),a.rectArea[g]=F,g++}else if(x.isPointLight){if((F=t.get(x)).position.setFromMatrixPosition(x.matrixWorld),F.position.applyMatrix4(_),F.color.copy(x.color).multiplyScalar(x.intensity),F.distance=x.distance,F.decay=x.decay,x.castShadow){var y;P=x.shadow;(y=r.get(x)).shadowBias=P.bias,y.shadowRadius=P.radius,y.shadowMapSize=P.mapSize,y.shadowCameraNear=P.camera.near,y.shadowCameraFar=P.camera.far,a.pointShadow[h]=y,a.pointShadowMap[h]=w,a.pointShadowMatrix[h]=x.shadow.matrix,M++}a.point[h]=F,h++}else if(x.isHemisphereLight){var F;(F=t.get(x)).direction.setFromMatrixPosition(x.matrixWorld),F.direction.transformDirection(_),F.direction.normalize(),F.skyColor.copy(x.color).multiplyScalar(S),F.groundColor.copy(x.groundColor).multiplyScalar(S),a.hemi[E]=F,E++}}a.ambient[0]=u,a.ambient[1]=d,a.ambient[2]=p;var U=a.hash;U.directionalLength===f&&U.pointLength===h&&U.spotLength===m&&U.rectAreaLength===g&&U.hemiLength===E&&U.numDirectionalShadows===v&&U.numPointShadows===M&&U.numSpotShadows===T||(a.directional.length=f,a.spot.length=m,a.rectArea.length=g,a.point.length=h,a.hemi.length=E,a.directionalShadow.length=v,a.directionalShadowMap.length=v,a.pointShadow.length=M,a.pointShadowMap.length=M,a.spotShadow.length=T,a.spotShadowMap.length=T,a.directionalShadowMatrix.length=v,a.pointShadowMatrix.length=M,a.spotShadowMatrix.length=T,U.directionalLength=f,U.pointLength=h,U.spotLength=m,U.rectAreaLength=g,U.hemiLength=E,U.numDirectionalShadows=v,U.numPointShadows=M,U.numSpotShadows=T,a.version=dt++)},state:a}}function ft(){var e=new ct,t=[],r=[];return{init:function(){t.length=0,r.length=0},state:{lightsArray:t,shadowsArray:r,lights:e},setupLights:function(a){e.setup(t,r,a)},pushLight:function(e){t.push(e)},pushShadow:function(e){r.push(e)}}}function ht(){var e=new WeakMap;function t(r){var a=r.target;a.removeEventListener("dispose",t),e.delete(a)}return{get:function(r,a){var n;return!1===e.has(r)?(n=new ft,e.set(r,new WeakMap),e.get(r).set(a,n),r.addEventListener("dispose",t)):!1===e.get(r).has(a)?(n=new ft,e.get(r).set(a,n)):n=e.get(r).get(a),n},dispose:function(){e=new WeakMap}}}var mt=r(396),gt=r(432),Et=r(433);function vt(e,t,r){var n=new o.a,i=new u.a,s=new u.a,l=new p.a,d=[],c=[],f={},h={0:a.h,1:a.E,2:a.w},m=new E.a({defines:{SAMPLE_RATE:.25,HALF_SAMPLE_RATE:1/8},uniforms:{shadow_pass:{value:null},resolution:{value:new u.a},radius:{value:4}},vertexShader:"\n\nvoid main() {\n\n\tgl_Position = vec4( position, 1.0 );\n\n}\n\n",fragmentShader:"\nuniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n\n#include <packing>\n\nvoid main() {\n\n  float mean = 0.0;\n  float squared_mean = 0.0;\n\n\t// This seems totally useless but it's a crazy work around for a Adreno compiler bug\n\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy  ) / resolution ) );\n\n  for ( float i = -1.0; i < 1.0 ; i += SAMPLE_RATE) {\n\n    #ifdef HORIZONAL_PASS\n\n      vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( i, 0.0 ) * radius ) / resolution ) );\n      mean += distribution.x;\n      squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\n    #else\n\n      float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0,  i )  * radius ) / resolution ) );\n      mean += depth;\n      squared_mean += depth * depth;\n\n    #endif\n\n  }\n\n  mean = mean * HALF_SAMPLE_RATE;\n  squared_mean = squared_mean * HALF_SAMPLE_RATE;\n\n  float std_dev = sqrt( squared_mean - mean * mean );\n\n  gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n\n}\n"}),g=m.clone();g.defines.HORIZONAL_PASS=1;var v=new y.a;v.setAttribute("position",new P.a(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));var T=new M.a(v,m),_=this;function b(r,a){var n=t.update(T);m.uniforms.shadow_pass.value=r.map.texture,m.uniforms.resolution.value=r.mapSize,m.uniforms.radius.value=r.radius,e.setRenderTarget(r.mapPass),e.clear(),e.renderBufferDirect(a,null,n,m,T,null),g.uniforms.shadow_pass.value=r.mapPass.texture,g.uniforms.resolution.value=r.mapSize,g.uniforms.radius.value=r.radius,e.setRenderTarget(r.map),e.clear(),e.renderBufferDirect(a,null,n,g,T,null)}function x(e,t,r){var n=e<<0|t<<1|r<<2,i=d[n];return void 0===i&&(i=new gt.a({depthPacking:a.Cb,morphTargets:e,skinning:t}),d[n]=i),i}function R(e,t,r){var a=e<<0|t<<1|r<<2,n=c[a];return void 0===n&&(n=new Et.a({morphTargets:e,skinning:t}),c[a]=n),n}function S(t,r,n,i,o,s){var l=t.geometry,u=null,d=x,p=t.customDepthMaterial;if(!0===n.isPointLight&&(d=R,p=t.customDistanceMaterial),void 0===p){var c=!1;!0===r.morphTargets&&(!0===l.isBufferGeometry?c=l.morphAttributes&&l.morphAttributes.position&&l.morphAttributes.position.length>0:!0===l.isGeometry&&(c=l.morphTargets&&l.morphTargets.length>0));var m=!1;!0===t.isSkinnedMesh&&(!0===r.skinning?m=!0:console.warn("THREE.WebGLShadowMap: THREE.SkinnedMesh with material.skinning set to false:",t)),u=d(c,m,!0===t.isInstancedMesh)}else u=p;if(e.localClippingEnabled&&!0===r.clipShadows&&0!==r.clippingPlanes.length){var g=u.uuid,E=r.uuid,v=f[g];void 0===v&&(v={},f[g]=v);var M=v[E];void 0===M&&(M=u.clone(),v[E]=M),u=M}return u.visible=r.visible,u.wireframe=r.wireframe,s===a.dd?u.side=null!==r.shadowSide?r.shadowSide:r.side:u.side=null!==r.shadowSide?r.shadowSide:h[r.side],u.clipShadows=r.clipShadows,u.clippingPlanes=r.clippingPlanes,u.clipIntersection=r.clipIntersection,u.wireframeLinewidth=r.wireframeLinewidth,u.linewidth=r.linewidth,!0===n.isPointLight&&!0===u.isMeshDistanceMaterial&&(u.referencePosition.setFromMatrixPosition(n.matrixWorld),u.nearDistance=i,u.farDistance=o),u}function A(r,i,o,s,l){if(!1!==r.visible){if(r.layers.test(i.layers)&&(r.isMesh||r.isLine||r.isPoints)&&(r.castShadow||r.receiveShadow&&l===a.dd)&&(!r.frustumCulled||n.intersectsObject(r))){r.modelViewMatrix.multiplyMatrices(o.matrixWorldInverse,r.matrixWorld);var u=t.update(r),d=r.material;if(Array.isArray(d))for(var p=u.groups,c=0,f=p.length;c<f;c++){var h=p[c],m=d[h.materialIndex];if(m&&m.visible){var g=S(r,m,s,o.near,o.far,l);e.renderBufferDirect(o,null,u,g,r,h)}}else if(d.visible){g=S(r,d,s,o.near,o.far,l);e.renderBufferDirect(o,null,u,g,r,null)}}for(var E=r.children,v=0,M=E.length;v<M;v++)A(E[v],i,o,s,l)}}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=a.Ab,this.render=function(t,o,u){if(!1!==_.enabled&&(!1!==_.autoUpdate||!1!==_.needsUpdate)&&0!==t.length){var d=e.getRenderTarget(),p=e.getActiveCubeFace(),c=e.getActiveMipmapLevel(),f=e.state;f.setBlending(a.qb),f.buffers.color.setClear(1,1,1,1),f.buffers.depth.setTest(!0),f.setScissorTest(!1);for(var h=0,m=t.length;h<m;h++){var g=t[h],E=g.shadow;if(void 0!==E){i.copy(E.mapSize);var v=E.getFrameExtents();if(i.multiply(v),s.copy(E.mapSize),(i.x>r||i.y>r)&&(console.warn("THREE.WebGLShadowMap:",g,"has shadow exceeding max texture size, reducing"),i.x>r&&(s.x=Math.floor(r/v.x),i.x=s.x*v.x,E.mapSize.x=s.x),i.y>r&&(s.y=Math.floor(r/v.y),i.y=s.y*v.y,E.mapSize.y=s.y)),null===E.map&&!E.isPointLightShadow&&this.type===a.dd){var M={minFilter:a.R,magFilter:a.R,format:a.Db};E.map=new mt.a(i.x,i.y,M),E.map.texture.name=g.name+".shadowMap",E.mapPass=new mt.a(i.x,i.y,M),E.camera.updateProjectionMatrix()}if(null===E.map){M={minFilter:a.kb,magFilter:a.kb,format:a.Db};E.map=new mt.a(i.x,i.y,M),E.map.texture.name=g.name+".shadowMap",E.camera.updateProjectionMatrix()}e.setRenderTarget(E.map),e.clear();for(var T=E.getViewportCount(),x=0;x<T;x++){var R=E.getViewport(x);l.set(s.x*R.x,s.y*R.y,s.x*R.z,s.y*R.w),f.viewport(l),E.updateMatrices(g,x),n=E.getFrustum(),A(o,u,E.camera,g,this.type)}E.isPointLightShadow||this.type!==a.dd||b(E,u)}else console.warn("THREE.WebGLShadowMap:",g,"has no shadow.")}_.needsUpdate=!1,e.setRenderTarget(d,p,c)}}}function Mt(e,t,r){var n=r.isWebGL2;var i=new function(){var t=!1,r=new p.a,a=null,n=new p.a(0,0,0,0);return{setMask:function(r){a===r||t||(e.colorMask(r,r,r,r),a=r)},setLocked:function(e){t=e},setClear:function(t,a,i,o,s){!0===s&&(t*=o,a*=o,i*=o),r.set(t,a,i,o),!1===n.equals(r)&&(e.clearColor(t,a,i,o),n.copy(r))},reset:function(){t=!1,a=null,n.set(-1,0,0,0)}}},o=new function(){var t=!1,r=null,n=null,i=null;return{setTest:function(t){t?W(e.DEPTH_TEST):H(e.DEPTH_TEST)},setMask:function(a){r===a||t||(e.depthMask(a),r=a)},setFunc:function(t){if(n!==t){if(t)switch(t){case a.pb:e.depthFunc(e.NEVER);break;case a.f:e.depthFunc(e.ALWAYS);break;case a.O:e.depthFunc(e.LESS);break;case a.P:e.depthFunc(e.LEQUAL);break;case a.z:e.depthFunc(e.EQUAL);break;case a.H:e.depthFunc(e.GEQUAL);break;case a.G:e.depthFunc(e.GREATER);break;case a.tb:e.depthFunc(e.NOTEQUAL);break;default:e.depthFunc(e.LEQUAL)}else e.depthFunc(e.LEQUAL);n=t}},setLocked:function(e){t=e},setClear:function(t){i!==t&&(e.clearDepth(t),i=t)},reset:function(){t=!1,r=null,n=null,i=null}}},s=new function(){var t=!1,r=null,a=null,n=null,i=null,o=null,s=null,l=null,u=null;return{setTest:function(r){t||(r?W(e.STENCIL_TEST):H(e.STENCIL_TEST))},setMask:function(a){r===a||t||(e.stencilMask(a),r=a)},setFunc:function(t,r,o){a===t&&n===r&&i===o||(e.stencilFunc(t,r,o),a=t,n=r,i=o)},setOp:function(t,r,a){o===t&&s===r&&l===a||(e.stencilOp(t,r,a),o=t,s=r,l=a)},setLocked:function(e){t=e},setClear:function(t){u!==t&&(e.clearStencil(t),u=t)},reset:function(){t=!1,r=null,a=null,n=null,i=null,o=null,s=null,l=null,u=null}}},l=e.getParameter(e.MAX_VERTEX_ATTRIBS),u=new Uint8Array(l),d=new Uint8Array(l),c=new Uint8Array(l),f={},h=null,m=null,g=null,E=null,v=null,M=null,T=null,_=null,b=null,x=!1,R=null,S=null,A=null,w=null,L=null,P=e.getParameter(e.MAX_COMBINED_TEXTURE_IMAGE_UNITS),y=!1,F=0,U=e.getParameter(e.VERSION);-1!==U.indexOf("WebGL")?(F=parseFloat(/^WebGL\ ([0-9])/.exec(U)[1]),y=F>=1):-1!==U.indexOf("OpenGL ES")&&(F=parseFloat(/^OpenGL\ ES\ ([0-9])/.exec(U)[1]),y=F>=2);var D=null,C={},N=new p.a,I=new p.a;function O(t,r,a){var n=new Uint8Array(4),i=e.createTexture();e.bindTexture(t,i),e.texParameteri(t,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(t,e.TEXTURE_MAG_FILTER,e.NEAREST);for(var o=0;o<a;o++)e.texImage2D(r+o,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,n);return i}var B={};function G(r,a){(u[r]=1,0===d[r]&&(e.enableVertexAttribArray(r),d[r]=1),c[r]!==a)&&((n?e:t.get("ANGLE_instanced_arrays"))[n?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](r,a),c[r]=a)}function W(t){!0!==f[t]&&(e.enable(t),f[t]=!0)}function H(t){!1!==f[t]&&(e.disable(t),f[t]=!1)}B[e.TEXTURE_2D]=O(e.TEXTURE_2D,e.TEXTURE_2D,1),B[e.TEXTURE_CUBE_MAP]=O(e.TEXTURE_CUBE_MAP,e.TEXTURE_CUBE_MAP_POSITIVE_X,6),i.setClear(0,0,0,1),o.setClear(1),s.setClear(0),W(e.DEPTH_TEST),o.setFunc(a.P),Y(!1),j(a.q),W(e.CULL_FACE),z(a.qb);var X={[a.b]:e.FUNC_ADD,[a.Nc]:e.FUNC_SUBTRACT,[a.sc]:e.FUNC_REVERSE_SUBTRACT};if(n)X[a.fb]=e.MIN,X[a.eb]=e.MAX;else{var k=t.get("EXT_blend_minmax");null!==k&&(X[a.fb]=k.MIN_EXT,X[a.eb]=k.MAX_EXT)}var V={[a.gd]:e.ZERO,[a.vb]:e.ONE,[a.Lc]:e.SRC_COLOR,[a.Jc]:e.SRC_ALPHA,[a.Kc]:e.SRC_ALPHA_SATURATE,[a.y]:e.DST_COLOR,[a.x]:e.DST_ALPHA,[a.zb]:e.ONE_MINUS_SRC_COLOR,[a.yb]:e.ONE_MINUS_SRC_ALPHA,[a.xb]:e.ONE_MINUS_DST_COLOR,[a.wb]:e.ONE_MINUS_DST_ALPHA};function z(t,r,n,i,o,s,l,u){if(t!==a.qb){if(m||(W(e.BLEND),m=!0),t===a.t)o=o||r,s=s||n,l=l||i,r===E&&o===T||(e.blendEquationSeparate(X[r],X[o]),E=r,T=o),n===v&&i===M&&s===_&&l===b||(e.blendFuncSeparate(V[n],V[i],V[s],V[l]),v=n,M=i,_=s,b=l),g=t,x=null;else if(t!==g||u!==x){if(E===a.b&&T===a.b||(e.blendEquation(e.FUNC_ADD),E=a.b,T=a.b),u)switch(t){case a.sb:e.blendFuncSeparate(e.ONE,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA);break;case a.d:e.blendFunc(e.ONE,e.ONE);break;case a.Oc:e.blendFuncSeparate(e.ZERO,e.ZERO,e.ONE_MINUS_SRC_COLOR,e.ONE_MINUS_SRC_ALPHA);break;case a.ib:e.blendFuncSeparate(e.ZERO,e.SRC_COLOR,e.ZERO,e.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}else switch(t){case a.sb:e.blendFuncSeparate(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA);break;case a.d:e.blendFunc(e.SRC_ALPHA,e.ONE);break;case a.Oc:e.blendFunc(e.ZERO,e.ONE_MINUS_SRC_COLOR);break;case a.ib:e.blendFunc(e.ZERO,e.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}v=null,M=null,_=null,b=null,g=t,x=u}}else m&&(H(e.BLEND),m=!1)}function Y(t){R!==t&&(t?e.frontFace(e.CW):e.frontFace(e.CCW),R=t)}function j(t){t!==a.s?(W(e.CULL_FACE),t!==S&&(t===a.q?e.cullFace(e.BACK):t===a.r?e.cullFace(e.FRONT):e.cullFace(e.FRONT_AND_BACK))):H(e.CULL_FACE),S=t}function q(t,r,a){t?(W(e.POLYGON_OFFSET_FILL),w===r&&L===a||(e.polygonOffset(r,a),w=r,L=a)):H(e.POLYGON_OFFSET_FILL)}function K(t){void 0===t&&(t=e.TEXTURE0+P-1),D!==t&&(e.activeTexture(t),D=t)}return{buffers:{color:i,depth:o,stencil:s},initAttributes:function(){for(var e=0,t=u.length;e<t;e++)u[e]=0},enableAttribute:function(e){G(e,0)},enableAttributeAndDivisor:G,disableUnusedAttributes:function(){for(var t=0,r=d.length;t!==r;++t)d[t]!==u[t]&&(e.disableVertexAttribArray(t),d[t]=0)},enable:W,disable:H,useProgram:function(t){return h!==t&&(e.useProgram(t),h=t,!0)},setBlending:z,setMaterial:function(t,r){t.side===a.w?H(e.CULL_FACE):W(e.CULL_FACE);var n=t.side===a.h;r&&(n=!n),Y(n),t.blending===a.sb&&!1===t.transparent?z(a.qb):z(t.blending,t.blendEquation,t.blendSrc,t.blendDst,t.blendEquationAlpha,t.blendSrcAlpha,t.blendDstAlpha,t.premultipliedAlpha),o.setFunc(t.depthFunc),o.setTest(t.depthTest),o.setMask(t.depthWrite),i.setMask(t.colorWrite);var l=t.stencilWrite;s.setTest(l),l&&(s.setMask(t.stencilWriteMask),s.setFunc(t.stencilFunc,t.stencilRef,t.stencilFuncMask),s.setOp(t.stencilFail,t.stencilZFail,t.stencilZPass)),q(t.polygonOffset,t.polygonOffsetFactor,t.polygonOffsetUnits)},setFlipSided:Y,setCullFace:j,setLineWidth:function(t){t!==A&&(y&&e.lineWidth(t),A=t)},setPolygonOffset:q,setScissorTest:function(t){t?W(e.SCISSOR_TEST):H(e.SCISSOR_TEST)},activeTexture:K,bindTexture:function(t,r){null===D&&K();var a=C[D];void 0===a&&(a={type:void 0,texture:void 0},C[D]=a),a.type===t&&a.texture===r||(e.bindTexture(t,r||B[t]),a.type=t,a.texture=r)},unbindTexture:function(){var t=C[D];void 0!==t&&void 0!==t.type&&(e.bindTexture(t.type,null),t.type=void 0,t.texture=void 0)},compressedTexImage2D:function(){try{e.compressedTexImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage2D:function(){try{e.texImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage3D:function(){try{e.texImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},scissor:function(t){!1===N.equals(t)&&(e.scissor(t.x,t.y,t.z,t.w),N.copy(t))},viewport:function(t){!1===I.equals(t)&&(e.viewport(t.x,t.y,t.z,t.w),I.copy(t))},reset:function(){for(var t=0;t<d.length;t++)1===d[t]&&(e.disableVertexAttribArray(t),d[t]=0);f={},D=null,C={},h=null,g=null,R=null,S=null,i.reset(),o.reset(),s.reset()}}}function Tt(e,t,r,i,o,s,l){var u,d=o.isWebGL2,p=o.maxTextures,c=o.maxCubemapSize,f=o.maxTextureSize,h=o.maxSamples,m=new WeakMap,g=!1;try{g="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(e){}function E(e,t){return g?new OffscreenCanvas(e,t):document.createElementNS("http://www.w3.org/1999/xhtml","canvas")}function v(e,t,r,a){var i=1;if((e.width>a||e.height>a)&&(i=a/Math.max(e.width,e.height)),i<1||!0===t){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap){var o=t?n.a.floorPowerOfTwo:Math.floor,s=o(i*e.width),l=o(i*e.height);void 0===u&&(u=E(s,l));var d=r?E(s,l):u;return d.width=s,d.height=l,d.getContext("2d").drawImage(e,0,0,s,l),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+e.width+"x"+e.height+") to ("+s+"x"+l+")."),d}return"data"in e&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+e.width+"x"+e.height+")."),e}return e}function M(e){return n.a.isPowerOfTwo(e.width)&&n.a.isPowerOfTwo(e.height)}function T(e,t){return e.generateMipmaps&&t&&e.minFilter!==a.kb&&e.minFilter!==a.R}function _(t,r,a,n){e.generateMipmap(t),i.get(r).__maxMipLevel=Math.log(Math.max(a,n))*Math.LOG2E}function b(r,a,n){if(!1===d)return a;if(null!==r){if(void 0!==e[r])return e[r];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+r+"'")}var i=a;return a===e.RED&&(n===e.FLOAT&&(i=e.R32F),n===e.HALF_FLOAT&&(i=e.R16F),n===e.UNSIGNED_BYTE&&(i=e.R8)),a===e.RGB&&(n===e.FLOAT&&(i=e.RGB32F),n===e.HALF_FLOAT&&(i=e.RGB16F),n===e.UNSIGNED_BYTE&&(i=e.RGB8)),a===e.RGBA&&(n===e.FLOAT&&(i=e.RGBA32F),n===e.HALF_FLOAT&&(i=e.RGBA16F),n===e.UNSIGNED_BYTE&&(i=e.RGBA8)),i!==e.R16F&&i!==e.R32F&&i!==e.RGBA16F&&i!==e.RGBA32F||t.get("EXT_color_buffer_float"),i}function x(t){return t===a.kb||t===a.ob||t===a.nb?e.NEAREST:e.LINEAR}function R(t){var r=t.target;r.removeEventListener("dispose",R),function(t){var r=i.get(t);if(void 0===r.__webglInit)return;e.deleteTexture(r.__webglTexture),i.remove(t)}(r),r.isVideoTexture&&m.delete(r),l.memory.textures--}function S(t){var r=t.target;r.removeEventListener("dispose",S),function(t){var r=i.get(t),a=i.get(t.texture);if(!t)return;void 0!==a.__webglTexture&&e.deleteTexture(a.__webglTexture);t.depthTexture&&t.depthTexture.dispose();if(t.isWebGLCubeRenderTarget)for(var n=0;n<6;n++)e.deleteFramebuffer(r.__webglFramebuffer[n]),r.__webglDepthbuffer&&e.deleteRenderbuffer(r.__webglDepthbuffer[n]);else e.deleteFramebuffer(r.__webglFramebuffer),r.__webglDepthbuffer&&e.deleteRenderbuffer(r.__webglDepthbuffer),r.__webglMultisampledFramebuffer&&e.deleteFramebuffer(r.__webglMultisampledFramebuffer),r.__webglColorRenderbuffer&&e.deleteRenderbuffer(r.__webglColorRenderbuffer),r.__webglDepthRenderbuffer&&e.deleteRenderbuffer(r.__webglDepthRenderbuffer);i.remove(t.texture),i.remove(t)}(r),l.memory.textures--}var A=0;function w(t,a){var n=i.get(t);if(t.isVideoTexture&&function(e){var t=l.render.frame;m.get(e)!==t&&(m.set(e,t),e.update())}(t),t.version>0&&n.__version!==t.version){var o=t.image;if(void 0===o)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined");else{if(!1!==o.complete)return void C(n,t,a);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}r.activeTexture(e.TEXTURE0+a),r.bindTexture(e.TEXTURE_2D,n.__webglTexture)}function L(t,n){if(6===t.image.length){var o=i.get(t);if(t.version>0&&o.__version!==t.version){D(o,t),r.activeTexture(e.TEXTURE0+n),r.bindTexture(e.TEXTURE_CUBE_MAP,o.__webglTexture),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,t.flipY);for(var l=t&&(t.isCompressedTexture||t.image[0].isCompressedTexture),u=t.image[0]&&t.image[0].isDataTexture,p=[],f=0;f<6;f++)p[f]=l||u?u?t.image[f].image:t.image[f]:v(t.image[f],!1,!0,c);var h,m=p[0],g=M(m)||d,E=s.convert(t.format),x=s.convert(t.type),R=b(t.internalFormat,E,x);if(U(e.TEXTURE_CUBE_MAP,t,g),l){for(f=0;f<6;f++){h=p[f].mipmaps;for(var S=0;S<h.length;S++){var A=h[S];t.format!==a.Db&&t.format!==a.dc?null!==E?r.compressedTexImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+f,S,R,A.width,A.height,0,A.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):r.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+f,S,R,A.width,A.height,0,E,x,A.data)}}o.__maxMipLevel=h.length-1}else{h=t.mipmaps;for(f=0;f<6;f++)if(u){r.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+f,0,R,p[f].width,p[f].height,0,E,x,p[f].data);for(S=0;S<h.length;S++){var w=(A=h[S]).image[f].image;r.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+f,S+1,R,w.width,w.height,0,E,x,w.data)}}else{r.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+f,0,R,E,x,p[f]);for(S=0;S<h.length;S++){A=h[S];r.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+f,S+1,R,E,x,A.image[f])}}o.__maxMipLevel=h.length}T(t,g)&&_(e.TEXTURE_CUBE_MAP,t,m.width,m.height),o.__version=t.version,t.onUpdate&&t.onUpdate(t)}else r.activeTexture(e.TEXTURE0+n),r.bindTexture(e.TEXTURE_CUBE_MAP,o.__webglTexture)}}function P(t,a){r.activeTexture(e.TEXTURE0+a),r.bindTexture(e.TEXTURE_CUBE_MAP,i.get(t).__webglTexture)}var y={[a.rc]:e.REPEAT,[a.l]:e.CLAMP_TO_EDGE,[a.gb]:e.MIRRORED_REPEAT},F={[a.kb]:e.NEAREST,[a.ob]:e.NEAREST_MIPMAP_NEAREST,[a.nb]:e.NEAREST_MIPMAP_LINEAR,[a.R]:e.LINEAR,[a.V]:e.LINEAR_MIPMAP_NEAREST,[a.U]:e.LINEAR_MIPMAP_LINEAR};function U(r,n,s){s?(e.texParameteri(r,e.TEXTURE_WRAP_S,y[n.wrapS]),e.texParameteri(r,e.TEXTURE_WRAP_T,y[n.wrapT]),r!==e.TEXTURE_3D&&r!==e.TEXTURE_2D_ARRAY||e.texParameteri(r,e.TEXTURE_WRAP_R,y[n.wrapR]),e.texParameteri(r,e.TEXTURE_MAG_FILTER,F[n.magFilter]),e.texParameteri(r,e.TEXTURE_MIN_FILTER,F[n.minFilter])):(e.texParameteri(r,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(r,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),r!==e.TEXTURE_3D&&r!==e.TEXTURE_2D_ARRAY||e.texParameteri(r,e.TEXTURE_WRAP_R,e.CLAMP_TO_EDGE),n.wrapS===a.l&&n.wrapT===a.l||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),e.texParameteri(r,e.TEXTURE_MAG_FILTER,x(n.magFilter)),e.texParameteri(r,e.TEXTURE_MIN_FILTER,x(n.minFilter)),n.minFilter!==a.kb&&n.minFilter!==a.R&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter."));var l=t.get("EXT_texture_filter_anisotropic");if(l){if(n.type===a.D&&null===t.get("OES_texture_float_linear"))return;if(n.type===a.I&&null===(d||t.get("OES_texture_half_float_linear")))return;(n.anisotropy>1||i.get(n).__currentAnisotropy)&&(e.texParameterf(r,l.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(n.anisotropy,o.getMaxAnisotropy())),i.get(n).__currentAnisotropy=n.anisotropy)}}function D(t,r){void 0===t.__webglInit&&(t.__webglInit=!0,r.addEventListener("dispose",R),t.__webglTexture=e.createTexture(),l.memory.textures++)}function C(t,n,i){var o=e.TEXTURE_2D;n.isDataTexture2DArray&&(o=e.TEXTURE_2D_ARRAY),n.isDataTexture3D&&(o=e.TEXTURE_3D),D(t,n),r.activeTexture(e.TEXTURE0+i),r.bindTexture(o,t.__webglTexture),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,n.flipY),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n.premultiplyAlpha),e.pixelStorei(e.UNPACK_ALIGNMENT,n.unpackAlignment);var l=function(e){return!d&&(e.wrapS!==a.l||e.wrapT!==a.l||e.minFilter!==a.kb&&e.minFilter!==a.R)}(n)&&!1===M(n.image),u=v(n.image,l,!1,f),p=M(u)||d,c=s.convert(n.format),h=s.convert(n.type),m=b(n.internalFormat,c,h);U(o,n,p);var g,E=n.mipmaps;if(n.isDepthTexture)m=e.DEPTH_COMPONENT,d?m=n.type===a.D?e.DEPTH_COMPONENT32F:n.type===a.Yc?e.DEPTH_COMPONENT24:n.type===a.Xc?e.DEPTH24_STENCIL8:e.DEPTH_COMPONENT16:n.type===a.D&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),n.format===a.u&&m===e.DEPTH_COMPONENT&&n.type!==a.cd&&n.type!==a.Yc&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),n.type=a.cd,h=s.convert(n.type)),n.format===a.v&&m===e.DEPTH_COMPONENT&&(m=e.DEPTH_STENCIL,n.type!==a.Xc&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),n.type=a.Xc,h=s.convert(n.type))),r.texImage2D(e.TEXTURE_2D,0,m,u.width,u.height,0,c,h,null);else if(n.isDataTexture)if(E.length>0&&p){for(var x=0,R=E.length;x<R;x++)g=E[x],r.texImage2D(e.TEXTURE_2D,x,m,g.width,g.height,0,c,h,g.data);n.generateMipmaps=!1,t.__maxMipLevel=E.length-1}else r.texImage2D(e.TEXTURE_2D,0,m,u.width,u.height,0,c,h,u.data),t.__maxMipLevel=0;else if(n.isCompressedTexture){for(x=0,R=E.length;x<R;x++)g=E[x],n.format!==a.Db&&n.format!==a.dc?null!==c?r.compressedTexImage2D(e.TEXTURE_2D,x,m,g.width,g.height,0,g.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):r.texImage2D(e.TEXTURE_2D,x,m,g.width,g.height,0,c,h,g.data);t.__maxMipLevel=E.length-1}else if(n.isDataTexture2DArray)r.texImage3D(e.TEXTURE_2D_ARRAY,0,m,u.width,u.height,u.depth,0,c,h,u.data),t.__maxMipLevel=0;else if(n.isDataTexture3D)r.texImage3D(e.TEXTURE_3D,0,m,u.width,u.height,u.depth,0,c,h,u.data),t.__maxMipLevel=0;else if(E.length>0&&p){for(x=0,R=E.length;x<R;x++)g=E[x],r.texImage2D(e.TEXTURE_2D,x,m,c,h,g);n.generateMipmaps=!1,t.__maxMipLevel=E.length-1}else r.texImage2D(e.TEXTURE_2D,0,m,c,h,u),t.__maxMipLevel=0;T(n,p)&&_(o,n,u.width,u.height),t.__version=n.version,n.onUpdate&&n.onUpdate(n)}function N(t,a,n,o){var l=s.convert(a.texture.format),u=s.convert(a.texture.type),d=b(a.texture.internalFormat,l,u);r.texImage2D(o,0,d,a.width,a.height,0,l,u,null),e.bindFramebuffer(e.FRAMEBUFFER,t),e.framebufferTexture2D(e.FRAMEBUFFER,n,o,i.get(a.texture).__webglTexture,0),e.bindFramebuffer(e.FRAMEBUFFER,null)}function I(t,r,n){if(e.bindRenderbuffer(e.RENDERBUFFER,t),r.depthBuffer&&!r.stencilBuffer){var i=e.DEPTH_COMPONENT16;if(n){var o=r.depthTexture;o&&o.isDepthTexture&&(o.type===a.D?i=e.DEPTH_COMPONENT32F:o.type===a.Yc&&(i=e.DEPTH_COMPONENT24));var l=B(r);e.renderbufferStorageMultisample(e.RENDERBUFFER,l,i,r.width,r.height)}else e.renderbufferStorage(e.RENDERBUFFER,i,r.width,r.height);e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,t)}else if(r.depthBuffer&&r.stencilBuffer){if(n){l=B(r);e.renderbufferStorageMultisample(e.RENDERBUFFER,l,e.DEPTH24_STENCIL8,r.width,r.height)}else e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_STENCIL,r.width,r.height);e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.RENDERBUFFER,t)}else{var u=s.convert(r.texture.format),d=s.convert(r.texture.type);i=b(r.texture.internalFormat,u,d);if(n){l=B(r);e.renderbufferStorageMultisample(e.RENDERBUFFER,l,i,r.width,r.height)}else e.renderbufferStorage(e.RENDERBUFFER,i,r.width,r.height)}e.bindRenderbuffer(e.RENDERBUFFER,null)}function O(t){var r=i.get(t),n=!0===t.isWebGLCubeRenderTarget;if(t.depthTexture){if(n)throw new Error("target.depthTexture not supported in Cube render targets");!function(t,r){if(r&&r.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(e.bindFramebuffer(e.FRAMEBUFFER,t),!r.depthTexture||!r.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");i.get(r.depthTexture).__webglTexture&&r.depthTexture.image.width===r.width&&r.depthTexture.image.height===r.height||(r.depthTexture.image.width=r.width,r.depthTexture.image.height=r.height,r.depthTexture.needsUpdate=!0),w(r.depthTexture,0);var n=i.get(r.depthTexture).__webglTexture;if(r.depthTexture.format===a.u)e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,n,0);else{if(r.depthTexture.format!==a.v)throw new Error("Unknown depthTexture format");e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,n,0)}}(r.__webglFramebuffer,t)}else if(n){r.__webglDepthbuffer=[];for(var o=0;o<6;o++)e.bindFramebuffer(e.FRAMEBUFFER,r.__webglFramebuffer[o]),r.__webglDepthbuffer[o]=e.createRenderbuffer(),I(r.__webglDepthbuffer[o],t,!1)}else e.bindFramebuffer(e.FRAMEBUFFER,r.__webglFramebuffer),r.__webglDepthbuffer=e.createRenderbuffer(),I(r.__webglDepthbuffer,t,!1);e.bindFramebuffer(e.FRAMEBUFFER,null)}function B(e){return d&&e.isWebGLMultisampleRenderTarget?Math.min(h,e.samples):0}var G=!1,W=!1;this.allocateTextureUnit=function(){var e=A;return e>=p&&console.warn("THREE.WebGLTextures: Trying to use "+e+" texture units while this GPU supports only "+p),A+=1,e},this.resetTextureUnits=function(){A=0},this.setTexture2D=w,this.setTexture2DArray=function(t,a){var n=i.get(t);t.version>0&&n.__version!==t.version?C(n,t,a):(r.activeTexture(e.TEXTURE0+a),r.bindTexture(e.TEXTURE_2D_ARRAY,n.__webglTexture))},this.setTexture3D=function(t,a){var n=i.get(t);t.version>0&&n.__version!==t.version?C(n,t,a):(r.activeTexture(e.TEXTURE0+a),r.bindTexture(e.TEXTURE_3D,n.__webglTexture))},this.setTextureCube=L,this.setTextureCubeDynamic=P,this.setupRenderTarget=function(t){var n=i.get(t),o=i.get(t.texture);t.addEventListener("dispose",S),o.__webglTexture=e.createTexture(),l.memory.textures++;var u=!0===t.isWebGLCubeRenderTarget,p=!0===t.isWebGLMultisampleRenderTarget,c=M(t)||d;if(!d||t.texture.format!==a.dc||t.texture.type!==a.D&&t.texture.type!==a.I||(t.texture.format=a.Db,console.warn("THREE.WebGLRenderer: Rendering to textures with RGB format is not supported. Using RGBA format instead.")),u){n.__webglFramebuffer=[];for(var f=0;f<6;f++)n.__webglFramebuffer[f]=e.createFramebuffer()}else if(n.__webglFramebuffer=e.createFramebuffer(),p)if(d){n.__webglMultisampledFramebuffer=e.createFramebuffer(),n.__webglColorRenderbuffer=e.createRenderbuffer(),e.bindRenderbuffer(e.RENDERBUFFER,n.__webglColorRenderbuffer);var h=s.convert(t.texture.format),m=s.convert(t.texture.type),g=b(t.texture.internalFormat,h,m),E=B(t);e.renderbufferStorageMultisample(e.RENDERBUFFER,E,g,t.width,t.height),e.bindFramebuffer(e.FRAMEBUFFER,n.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.RENDERBUFFER,n.__webglColorRenderbuffer),e.bindRenderbuffer(e.RENDERBUFFER,null),t.depthBuffer&&(n.__webglDepthRenderbuffer=e.createRenderbuffer(),I(n.__webglDepthRenderbuffer,t,!0)),e.bindFramebuffer(e.FRAMEBUFFER,null)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.");if(u){r.bindTexture(e.TEXTURE_CUBE_MAP,o.__webglTexture),U(e.TEXTURE_CUBE_MAP,t.texture,c);for(f=0;f<6;f++)N(n.__webglFramebuffer[f],t,e.COLOR_ATTACHMENT0,e.TEXTURE_CUBE_MAP_POSITIVE_X+f);T(t.texture,c)&&_(e.TEXTURE_CUBE_MAP,t.texture,t.width,t.height),r.bindTexture(e.TEXTURE_CUBE_MAP,null)}else r.bindTexture(e.TEXTURE_2D,o.__webglTexture),U(e.TEXTURE_2D,t.texture,c),N(n.__webglFramebuffer,t,e.COLOR_ATTACHMENT0,e.TEXTURE_2D),T(t.texture,c)&&_(e.TEXTURE_2D,t.texture,t.width,t.height),r.bindTexture(e.TEXTURE_2D,null);t.depthBuffer&&O(t)},this.updateRenderTargetMipmap=function(t){var a=t.texture;if(T(a,M(t)||d)){var n=t.isWebGLCubeRenderTarget?e.TEXTURE_CUBE_MAP:e.TEXTURE_2D,o=i.get(a).__webglTexture;r.bindTexture(n,o),_(n,a,t.width,t.height),r.bindTexture(n,null)}},this.updateMultisampleRenderTarget=function(t){if(t.isWebGLMultisampleRenderTarget)if(d){var r=i.get(t);e.bindFramebuffer(e.READ_FRAMEBUFFER,r.__webglMultisampledFramebuffer),e.bindFramebuffer(e.DRAW_FRAMEBUFFER,r.__webglFramebuffer);var a=t.width,n=t.height,o=e.COLOR_BUFFER_BIT;t.depthBuffer&&(o|=e.DEPTH_BUFFER_BIT),t.stencilBuffer&&(o|=e.STENCIL_BUFFER_BIT),e.blitFramebuffer(0,0,a,n,0,0,a,n,o,e.NEAREST),e.bindFramebuffer(e.FRAMEBUFFER,r.__webglMultisampledFramebuffer)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.")},this.safeSetTexture2D=function(e,t){e&&e.isWebGLRenderTarget&&(!1===G&&(console.warn("THREE.WebGLTextures.safeSetTexture2D: don't use render targets as textures. Use their .texture property instead."),G=!0),e=e.texture),w(e,t)},this.safeSetTextureCube=function(e,t){e&&e.isWebGLCubeRenderTarget&&(!1===W&&(console.warn("THREE.WebGLTextures.safeSetTextureCube: don't use cube render targets as textures. Use their .texture property instead."),W=!0),e=e.texture),e&&e.isCubeTexture||Array.isArray(e.image)&&6===e.image.length?L(e,t):P(e,t)}}function _t(e,t,r){var n=r.isWebGL2;return{convert:function(r){var i;if(r===a.Wc)return e.UNSIGNED_BYTE;if(r===a.Zc)return e.UNSIGNED_SHORT_4_4_4_4;if(r===a.ad)return e.UNSIGNED_SHORT_5_5_5_1;if(r===a.bd)return e.UNSIGNED_SHORT_5_6_5;if(r===a.j)return e.BYTE;if(r===a.Hc)return e.SHORT;if(r===a.cd)return e.UNSIGNED_SHORT;if(r===a.J)return e.INT;if(r===a.Yc)return e.UNSIGNED_INT;if(r===a.D)return e.FLOAT;if(r===a.I)return n?e.HALF_FLOAT:null!==(i=t.get("OES_texture_half_float"))?i.HALF_FLOAT_OES:null;if(r===a.e)return e.ALPHA;if(r===a.dc)return e.RGB;if(r===a.Db)return e.RGBA;if(r===a.cb)return e.LUMINANCE;if(r===a.bb)return e.LUMINANCE_ALPHA;if(r===a.u)return e.DEPTH_COMPONENT;if(r===a.v)return e.DEPTH_STENCIL;if(r===a.oc)return e.RED;if(r===a.pc)return e.RED_INTEGER;if(r===a.mc)return e.RG;if(r===a.nc)return e.RG_INTEGER;if(r===a.ec)return e.RGB_INTEGER;if(r===a.Eb)return e.RGBA_INTEGER;if(r===a.lc||r===a.Xb||r===a.Yb||r===a.Zb){if(null===(i=t.get("WEBGL_compressed_texture_s3tc")))return null;if(r===a.lc)return i.COMPRESSED_RGB_S3TC_DXT1_EXT;if(r===a.Xb)return i.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(r===a.Yb)return i.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(r===a.Zb)return i.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(r===a.kc||r===a.jc||r===a.Wb||r===a.Vb){if(null===(i=t.get("WEBGL_compressed_texture_pvrtc")))return null;if(r===a.kc)return i.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(r===a.jc)return i.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(r===a.Wb)return i.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(r===a.Vb)return i.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(r===a.hc)return null!==(i=t.get("WEBGL_compressed_texture_etc1"))?i.COMPRESSED_RGB_ETC1_WEBGL:null;if((r===a.ic||r===a.Ub)&&null!==(i=t.get("WEBGL_compressed_texture_etc"))){if(r===a.ic)return i.COMPRESSED_RGB8_ETC2;if(r===a.Ub)return i.COMPRESSED_RGBA8_ETC2_EAC}return r===a.Lb||r===a.Mb||r===a.Nb||r===a.Ob||r===a.Pb||r===a.Qb||r===a.Rb||r===a.Sb||r===a.Gb||r===a.Hb||r===a.Ib||r===a.Fb||r===a.Jb||r===a.Kb||r===a.zc||r===a.Ac||r===a.Bc||r===a.Cc||r===a.Dc||r===a.Ec||r===a.Fc||r===a.Gc||r===a.uc||r===a.vc||r===a.wc||r===a.tc||r===a.xc||r===a.yc?null!==(i=t.get("WEBGL_compressed_texture_astc"))?r:null:r===a.Tb?null!==(i=t.get("EXT_texture_compression_bptc"))?r:null:r===a.Xc?n?e.UNSIGNED_INT_24_8:null!==(i=t.get("WEBGL_depth_texture"))?i.UNSIGNED_INT_24_8_WEBGL:null:void 0}}}var bt=r(368);function xt(e){bt.a.call(this),this.cameras=e||[]}xt.prototype=Object.assign(Object.create(bt.a.prototype),{constructor:xt,isArrayCamera:!0});var Rt=r(59),St=r(120);function At(e,t){var r=this,a=null,n=1,i=null,o="local-floor",s=null,l=[],u=new Map,c=new bt.a;c.layers.enable(1),c.viewport=new p.a;var h=new bt.a;h.layers.enable(2),h.viewport=new p.a;var m=new xt([c,h]);m.layers.enable(1),m.layers.enable(2);var g=null,E=null;function v(e){var t=u.get(e.inputSource);t&&(t.targetRay&&t.targetRay.dispatchEvent({type:e.type}),t.grip&&t.grip.dispatchEvent({type:e.type}))}function M(){u.forEach((function(e,t){e.targetRay&&(e.targetRay.dispatchEvent({type:"disconnected",data:t}),e.targetRay.visible=!1),e.grip&&(e.grip.dispatchEvent({type:"disconnected",data:t}),e.grip.visible=!1)})),u.clear(),e.setFramebuffer(null),e.setRenderTarget(e.getRenderTarget()),A.stop(),r.isPresenting=!1,r.dispatchEvent({type:"sessionend"})}function T(e){i=e,A.setContext(a),A.start(),r.isPresenting=!0,r.dispatchEvent({type:"sessionstart"})}function _(e){for(var t=a.inputSources,r=0;r<l.length;r++)u.set(t[r],l[r]);for(r=0;r<e.removed.length;r++){var n=e.removed[r];(i=u.get(n))&&(i.targetRay&&i.targetRay.dispatchEvent({type:"disconnected",data:n}),i.grip&&i.grip.dispatchEvent({type:"disconnected",data:n}),u.delete(n))}for(r=0;r<e.added.length;r++){var i;n=e.added[r];(i=u.get(n))&&(i.targetRay&&i.targetRay.dispatchEvent({type:"connected",data:n}),i.grip&&i.grip.dispatchEvent({type:"connected",data:n}))}}this.enabled=!1,this.isPresenting=!1,this.getController=function(e){var t=l[e];return void 0===t&&(t={},l[e]=t),void 0===t.targetRay&&(t.targetRay=new St.a,t.targetRay.matrixAutoUpdate=!1,t.targetRay.visible=!1),t.targetRay},this.getControllerGrip=function(e){var t=l[e];return void 0===t&&(t={},l[e]=t),void 0===t.grip&&(t.grip=new St.a,t.grip.matrixAutoUpdate=!1,t.grip.visible=!1),t.grip},this.setFramebufferScaleFactor=function(e){n=e,1==r.isPresenting&&console.warn("WebXRManager: Cannot change framebuffer scale while presenting VR content")},this.setReferenceSpaceType=function(e){o=e},this.getReferenceSpace=function(){return i},this.getSession=function(){return a},this.setSession=function(e){if(null!==(a=e)){a.addEventListener("select",v),a.addEventListener("selectstart",v),a.addEventListener("selectend",v),a.addEventListener("squeeze",v),a.addEventListener("squeezestart",v),a.addEventListener("squeezeend",v),a.addEventListener("end",M);var r=t.getContextAttributes(),i={antialias:r.antialias,alpha:r.alpha,depth:r.depth,stencil:r.stencil,framebufferScaleFactor:n},s=new XRWebGLLayer(a,t,i);a.updateRenderState({baseLayer:s}),a.requestReferenceSpace(o).then(T),a.addEventListener("inputsourceschange",_)}};var b=new d.a,x=new d.a;function R(e,t){null===t?e.matrixWorld.copy(e.matrix):e.matrixWorld.multiplyMatrices(t.matrixWorld,e.matrix),e.matrixWorldInverse.getInverse(e.matrixWorld)}this.getCamera=function(e){m.near=h.near=c.near=e.near,m.far=h.far=c.far=e.far,g===m.near&&E===m.far||(a.updateRenderState({depthNear:m.near,depthFar:m.far}),g=m.near,E=m.far);var t=e.parent,r=m.cameras;R(m,t);for(var n=0;n<r.length;n++)R(r[n],t);e.matrixWorld.copy(m.matrixWorld);for(var i=e.children,o=(n=0,i.length);n<o;n++)i[n].updateMatrixWorld(!0);return function(e,t,r){b.setFromMatrixPosition(t.matrixWorld),x.setFromMatrixPosition(r.matrixWorld);var a=b.distanceTo(x),n=t.projectionMatrix.elements,i=r.projectionMatrix.elements,o=n[14]/(n[10]-1),s=n[14]/(n[10]+1),l=(n[9]+1)/n[5],u=(n[9]-1)/n[5],d=(n[8]-1)/n[0],p=(i[8]+1)/i[0],c=o*d,f=o*p,h=a/(-d+p),m=h*-d;t.matrixWorld.decompose(e.position,e.quaternion,e.scale),e.translateX(m),e.translateZ(h),e.matrixWorld.compose(e.position,e.quaternion,e.scale),e.matrixWorldInverse.getInverse(e.matrixWorld);var g=o+h,E=s+h,v=c-m,M=f+(a-m),T=l*s/E*g,_=u*s/E*g;e.projectionMatrix.makePerspective(v,M,T,_,g,E)}(m,c,h),m};var S=null;var A=new f;A.setAnimationLoop((function(t,r){if(null!==(s=r.getViewerPose(i))){var n=s.views,o=a.renderState.baseLayer;e.setFramebuffer(o.framebuffer);for(var u=0;u<n.length;u++){var d=n[u],p=o.getViewport(d),c=m.cameras[u];c.matrix.fromArray(d.transform.matrix),c.projectionMatrix.fromArray(d.projectionMatrix),c.viewport.set(p.x,p.y,p.width,p.height),0===u&&m.matrix.copy(c.matrix)}}var f=a.inputSources;for(u=0;u<l.length;u++){var h=l[u],g=f[u],E=null,v=null;g&&(h.targetRay&&null!==(E=r.getPose(g.targetRaySpace,i))&&(h.targetRay.matrix.fromArray(E.transform.matrix),h.targetRay.matrix.decompose(h.targetRay.position,h.targetRay.rotation,h.targetRay.scale)),h.grip&&g.gripSpace&&null!==(v=r.getPose(g.gripSpace,i))&&(h.grip.matrix.fromArray(v.transform.matrix),h.grip.matrix.decompose(h.grip.position,h.grip.rotation,h.grip.scale))),h.targetRay&&(h.targetRay.visible=null!==E),h.grip&&(h.grip.visible=null!==v)}S&&S(t,r)})),this.setAnimationLoop=function(e){S=e},this.dispose=function(){}}function wt(e){var t=void 0!==(e=e||{}).canvas?e.canvas:document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),r=void 0!==e.context?e.context:null,m=void 0!==e.alpha&&e.alpha,g=void 0===e.depth||e.depth,E=void 0===e.stencil||e.stencil,v=void 0!==e.antialias&&e.antialias,M=void 0===e.premultipliedAlpha||e.premultipliedAlpha,T=void 0!==e.preserveDrawingBuffer&&e.preserveDrawingBuffer,_=void 0!==e.powerPreference?e.powerPreference:"default",S=void 0!==e.failIfMajorPerformanceCaveat&&e.failIfMajorPerformanceCaveat,A=null,P=null;this.domElement=t,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.outputEncoding=a.Q,this.physicallyCorrectLights=!1,this.toneMapping=a.W,this.toneMappingExposure=1,this.toneMappingWhitePoint=1,this.maxMorphTargets=8,this.maxMorphNormals=4;var y,F,N,B,G,W,H,X,k,V,z,Y,j,q,K,Z,Q,J,$=this,ee=!1,te=null,re=0,ae=0,ne=null,ie=null,oe=-1,se={geometry:null,program:null,wireframe:!1},le=null,ue=null,de=new p.a,pe=new p.a,ce=null,fe=t.width,he=t.height,me=1,ge=null,Ee=null,ve=new p.a(0,0,fe,he),Me=new p.a(0,0,fe,he),Te=!1,_e=new o.a,be=new w,xe=!1,Re=!1,Se=new s.a,Ae=new d.a;function we(){return null===ne?me:1}try{var Le={alpha:m,depth:g,stencil:E,antialias:v,premultipliedAlpha:M,preserveDrawingBuffer:T,powerPreference:_,failIfMajorPerformanceCaveat:S,xrCompatible:!0};if(t.addEventListener("webglcontextlost",Ue,!1),t.addEventListener("webglcontextrestored",De,!1),null===(y=r||t.getContext("webgl",Le)||t.getContext("experimental-webgl",Le)))throw null!==t.getContext("webgl")?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.");void 0===y.getShaderPrecisionFormat&&(y.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(e){throw console.error("THREE.WebGLRenderer: "+e.message),e}function Pe(){F=new L(y),!1===(N=new R(y,F,e)).isWebGL2&&(F.get("WEBGL_depth_texture"),F.get("OES_texture_float"),F.get("OES_texture_half_float"),F.get("OES_texture_half_float_linear"),F.get("OES_standard_derivatives"),F.get("OES_element_index_uint"),F.get("ANGLE_instanced_arrays")),F.get("OES_texture_float_linear"),J=new _t(y,F,N),(B=new Mt(y,F,N)).scissor(pe.copy(Me).multiplyScalar(me).floor()),B.viewport(de.copy(ve).multiplyScalar(me).floor()),G=new C(y),W=new nt,H=new Tt(y,F,B,W,N,J,G),X=new h(y,N),k=new U(y,X,G),V=new O(y,k,X,G),K=new I(y),z=new at($,F,N),Y=new lt,j=new ht,q=new b($,B,V,M),Z=new x(y,F,G,N),Q=new D(y,F,G,N),G.programs=z.programs,$.capabilities=N,$.extensions=F,$.properties=W,$.renderLists=Y,$.state=B,$.info=G}Pe();var ye=new At($,y);this.xr=ye;var Fe=new vt($,V,N.maxTextureSize);function Ue(e){e.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),ee=!0}function De(){console.log("THREE.WebGLRenderer: Context Restored."),ee=!1,Pe()}function Ce(e){var t=e.target;t.removeEventListener("dispose",Ce),function(e){Ne(e),W.remove(e)}(t)}function Ne(e){var t=W.get(e).program;e.program=void 0,void 0!==t&&z.releaseProgram(t)}this.shadowMap=Fe,this.getContext=function(){return y},this.getContextAttributes=function(){return y.getContextAttributes()},this.forceContextLoss=function(){var e=F.get("WEBGL_lose_context");e&&e.loseContext()},this.forceContextRestore=function(){var e=F.get("WEBGL_lose_context");e&&e.restoreContext()},this.getPixelRatio=function(){return me},this.setPixelRatio=function(e){void 0!==e&&(me=e,this.setSize(fe,he,!1))},this.getSize=function(e){return void 0===e&&(console.warn("WebGLRenderer: .getsize() now requires a Vector2 as an argument"),e=new u.a),e.set(fe,he)},this.setSize=function(e,r,a){ye.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(fe=e,he=r,t.width=Math.floor(e*me),t.height=Math.floor(r*me),!1!==a&&(t.style.width=e+"px",t.style.height=r+"px"),this.setViewport(0,0,e,r))},this.getDrawingBufferSize=function(e){return void 0===e&&(console.warn("WebGLRenderer: .getdrawingBufferSize() now requires a Vector2 as an argument"),e=new u.a),e.set(fe*me,he*me).floor()},this.setDrawingBufferSize=function(e,r,a){fe=e,he=r,me=a,t.width=Math.floor(e*a),t.height=Math.floor(r*a),this.setViewport(0,0,e,r)},this.getCurrentViewport=function(e){return void 0===e&&(console.warn("WebGLRenderer: .getCurrentViewport() now requires a Vector4 as an argument"),e=new p.a),e.copy(de)},this.getViewport=function(e){return e.copy(ve)},this.setViewport=function(e,t,r,a){e.isVector4?ve.set(e.x,e.y,e.z,e.w):ve.set(e,t,r,a),B.viewport(de.copy(ve).multiplyScalar(me).floor())},this.getScissor=function(e){return e.copy(Me)},this.setScissor=function(e,t,r,a){e.isVector4?Me.set(e.x,e.y,e.z,e.w):Me.set(e,t,r,a),B.scissor(pe.copy(Me).multiplyScalar(me).floor())},this.getScissorTest=function(){return Te},this.setScissorTest=function(e){B.setScissorTest(Te=e)},this.setOpaqueSort=function(e){ge=e},this.setTransparentSort=function(e){Ee=e},this.getClearColor=function(){return q.getClearColor()},this.setClearColor=function(){q.setClearColor.apply(q,arguments)},this.getClearAlpha=function(){return q.getClearAlpha()},this.setClearAlpha=function(){q.setClearAlpha.apply(q,arguments)},this.clear=function(e,t,r){var a=0;(void 0===e||e)&&(a|=y.COLOR_BUFFER_BIT),(void 0===t||t)&&(a|=y.DEPTH_BUFFER_BIT),(void 0===r||r)&&(a|=y.STENCIL_BUFFER_BIT),y.clear(a)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",Ue,!1),t.removeEventListener("webglcontextrestored",De,!1),Y.dispose(),j.dispose(),W.dispose(),V.dispose(),ye.dispose(),Ge.stop(),this.forceContextLoss()},this.renderBufferImmediate=function(e,t){B.initAttributes();var r=W.get(e);e.hasPositions&&!r.position&&(r.position=y.createBuffer()),e.hasNormals&&!r.normal&&(r.normal=y.createBuffer()),e.hasUvs&&!r.uv&&(r.uv=y.createBuffer()),e.hasColors&&!r.color&&(r.color=y.createBuffer());var a=t.getAttributes();e.hasPositions&&(y.bindBuffer(y.ARRAY_BUFFER,r.position),y.bufferData(y.ARRAY_BUFFER,e.positionArray,y.DYNAMIC_DRAW),B.enableAttribute(a.position),y.vertexAttribPointer(a.position,3,y.FLOAT,!1,0,0)),e.hasNormals&&(y.bindBuffer(y.ARRAY_BUFFER,r.normal),y.bufferData(y.ARRAY_BUFFER,e.normalArray,y.DYNAMIC_DRAW),B.enableAttribute(a.normal),y.vertexAttribPointer(a.normal,3,y.FLOAT,!1,0,0)),e.hasUvs&&(y.bindBuffer(y.ARRAY_BUFFER,r.uv),y.bufferData(y.ARRAY_BUFFER,e.uvArray,y.DYNAMIC_DRAW),B.enableAttribute(a.uv),y.vertexAttribPointer(a.uv,2,y.FLOAT,!1,0,0)),e.hasColors&&(y.bindBuffer(y.ARRAY_BUFFER,r.color),y.bufferData(y.ARRAY_BUFFER,e.colorArray,y.DYNAMIC_DRAW),B.enableAttribute(a.color),y.vertexAttribPointer(a.color,3,y.FLOAT,!1,0,0)),B.disableUnusedAttributes(),y.drawArrays(y.TRIANGLES,0,e.count),e.count=0};var Oe=new c.a;this.renderBufferDirect=function(e,t,r,a,n,i){null===t&&(t=Oe);var o=n.isMesh&&n.matrixWorld.determinant()<0,s=Ve(e,t,a,n);B.setMaterial(a,o);var l=!1;se.geometry===r.id&&se.program===s.id&&se.wireframe===(!0===a.wireframe)||(se.geometry=r.id,se.program=s.id,se.wireframe=!0===a.wireframe,l=!0),(a.morphTargets||a.morphNormals)&&(K.update(n,r,a,s),l=!0);var u=r.index,d=r.attributes.position;if(null===u){if(void 0===d||0===d.count)return}else if(0===u.count)return;var p,c=1;!0===a.wireframe&&(u=k.getWireframeAttribute(r),c=2);var f=Z;null!==u&&(p=X.get(u),(f=Q).setIndex(p)),l&&(!function(e,t,r,a){if(!1===N.isWebGL2&&(e.isInstancedMesh||t.isInstancedBufferGeometry)&&null===F.get("ANGLE_instanced_arrays"))return;B.initAttributes();var n=t.attributes,i=a.getAttributes(),o=r.defaultAttributeValues;for(var s in i){var l=i[s];if(l>=0){var u=n[s];if(void 0!==u){var d=u.normalized,p=u.itemSize;if(void 0===(v=X.get(u)))continue;var c=v.buffer,f=v.type,h=v.bytesPerElement;if(u.isInterleavedBufferAttribute){var m=u.data,g=m.stride,E=u.offset;m&&m.isInstancedInterleavedBuffer?(B.enableAttributeAndDivisor(l,m.meshPerAttribute),void 0===t.maxInstancedCount&&(t.maxInstancedCount=m.meshPerAttribute*m.count)):B.enableAttribute(l),y.bindBuffer(y.ARRAY_BUFFER,c),y.vertexAttribPointer(l,p,f,d,g*h,E*h)}else u.isInstancedBufferAttribute?(B.enableAttributeAndDivisor(l,u.meshPerAttribute),void 0===t.maxInstancedCount&&(t.maxInstancedCount=u.meshPerAttribute*u.count)):B.enableAttribute(l),y.bindBuffer(y.ARRAY_BUFFER,c),y.vertexAttribPointer(l,p,f,d,0,0)}else if("instanceMatrix"===s){var v;if(void 0===(v=X.get(e.instanceMatrix)))continue;c=v.buffer,f=v.type;B.enableAttributeAndDivisor(l+0,1),B.enableAttributeAndDivisor(l+1,1),B.enableAttributeAndDivisor(l+2,1),B.enableAttributeAndDivisor(l+3,1),y.bindBuffer(y.ARRAY_BUFFER,c),y.vertexAttribPointer(l+0,4,f,!1,64,0),y.vertexAttribPointer(l+1,4,f,!1,64,16),y.vertexAttribPointer(l+2,4,f,!1,64,32),y.vertexAttribPointer(l+3,4,f,!1,64,48)}else if(void 0!==o){var M=o[s];if(void 0!==M)switch(M.length){case 2:y.vertexAttrib2fv(l,M);break;case 3:y.vertexAttrib3fv(l,M);break;case 4:y.vertexAttrib4fv(l,M);break;default:y.vertexAttrib1fv(l,M)}}}}B.disableUnusedAttributes()}(n,r,a,s),null!==u&&y.bindBuffer(y.ELEMENT_ARRAY_BUFFER,p.buffer));var h=null!==u?u.count:d.count,m=r.drawRange.start*c,g=r.drawRange.count*c,E=null!==i?i.start*c:0,v=null!==i?i.count*c:1/0,M=Math.max(m,E),T=Math.min(h,m+g,E+v)-1,_=Math.max(0,T-M+1);if(0!==_){if(n.isMesh)!0===a.wireframe?(B.setLineWidth(a.wireframeLinewidth*we()),f.setMode(y.LINES)):f.setMode(y.TRIANGLES);else if(n.isLine){var b=a.linewidth;void 0===b&&(b=1),B.setLineWidth(b*we()),n.isLineSegments?f.setMode(y.LINES):n.isLineLoop?f.setMode(y.LINE_LOOP):f.setMode(y.LINE_STRIP)}else n.isPoints?f.setMode(y.POINTS):n.isSprite&&f.setMode(y.TRIANGLES);n.isInstancedMesh?f.renderInstances(r,M,_,n.count):r.isInstancedBufferGeometry?f.renderInstances(r,M,_,r.maxInstancedCount):f.render(M,_)}},this.compile=function(e,t){(P=j.get(e,t)).init(),e.traverse((function(e){e.isLight&&(P.pushLight(e),e.castShadow&&P.pushShadow(e))})),P.setupLights(t);var r={};e.traverse((function(t){if(t.material)if(Array.isArray(t.material))for(var a=0;a<t.material.length;a++)t.material[a].uuid in r==!1&&(ke(t.material[a],e,t),r[t.material[a].uuid]=!0);else t.material.uuid in r==!1&&(ke(t.material,e,t),r[t.material.uuid]=!0)}))};var Be=null;var Ge=new f;function We(e,t,r,a){if(!1!==e.visible){if(e.layers.test(t.layers))if(e.isGroup)r=e.renderOrder;else if(e.isLOD)!0===e.autoUpdate&&e.update(t);else if(e.isLight)P.pushLight(e),e.castShadow&&P.pushShadow(e);else if(e.isSprite){if(!e.frustumCulled||_e.intersectsSprite(e)){a&&Ae.setFromMatrixPosition(e.matrixWorld).applyMatrix4(Se);var n=V.update(e);(i=e.material).visible&&A.push(e,n,i,r,Ae.z,null)}}else if(e.isImmediateRenderObject)a&&Ae.setFromMatrixPosition(e.matrixWorld).applyMatrix4(Se),A.push(e,null,e.material,r,Ae.z,null);else if((e.isMesh||e.isLine||e.isPoints)&&(e.isSkinnedMesh&&e.skeleton.frame!==G.render.frame&&(e.skeleton.update(),e.skeleton.frame=G.render.frame),!e.frustumCulled||_e.intersectsObject(e))){a&&Ae.setFromMatrixPosition(e.matrixWorld).applyMatrix4(Se);n=V.update(e);var i=e.material;if(Array.isArray(i))for(var o=n.groups,s=0,l=o.length;s<l;s++){var u=o[s],d=i[u.materialIndex];d&&d.visible&&A.push(e,n,d,r,Ae.z,u)}else i.visible&&A.push(e,n,i,r,Ae.z,null)}var p=e.children;for(s=0,l=p.length;s<l;s++)We(p[s],t,r,a)}}function He(e,t,r,a){for(var n=0,i=e.length;n<i;n++){var o=e[n],s=o.object,l=o.geometry,u=void 0===a?o.material:a,d=o.group;if(r.isArrayCamera){ue=r;for(var p=r.cameras,c=0,f=p.length;c<f;c++){var h=p[c];s.layers.test(h.layers)&&(B.viewport(de.copy(h.viewport)),P.setupLights(h),Xe(s,t,h,l,u,d))}}else ue=null,Xe(s,t,r,l,u,d)}}function Xe(e,t,r,a,n,i){if(e.onBeforeRender($,t,r,a,n,i),P=j.get(t,ue||r),e.modelViewMatrix.multiplyMatrices(r.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix),e.isImmediateRenderObject){var o=Ve(r,t,n,e);B.setMaterial(n),se.geometry=null,se.program=null,se.wireframe=!1,function(e,t){e.render((function(e){$.renderBufferImmediate(e,t)}))}(e,o)}else $.renderBufferDirect(r,t,a,n,e,i);e.onAfterRender($,t,r,a,n,i),P=j.get(t,ue||r)}function ke(e,t,r){var a=W.get(e),n=P.state.lights,i=P.state.shadowsArray,o=n.state.version,s=z.getParameters(e,n.state,i,t,be.numPlanes,be.numIntersection,r),l=z.getProgramCacheKey(s),u=a.program,d=!0;if(void 0===u)e.addEventListener("dispose",Ce);else if(u.cacheKey!==l)Ne(e);else if(a.lightsStateVersion!==o)a.lightsStateVersion=o,d=!1;else{if(void 0!==s.shaderID)return;d=!1}d&&(u=z.acquireProgram(s,l),a.program=u,a.uniforms=s.uniforms,a.environment=e.isMeshStandardMaterial?t.environment:null,a.outputEncoding=$.outputEncoding,e.program=u);var p=u.getAttributes();if(e.morphTargets){e.numSupportedMorphTargets=0;for(var c=0;c<$.maxMorphTargets;c++)p["morphTarget"+c]>=0&&e.numSupportedMorphTargets++}if(e.morphNormals){e.numSupportedMorphNormals=0;for(c=0;c<$.maxMorphNormals;c++)p["morphNormal"+c]>=0&&e.numSupportedMorphNormals++}var f=a.uniforms;(e.isShaderMaterial||e.isRawShaderMaterial)&&!0!==e.clipping||(a.numClippingPlanes=be.numPlanes,a.numIntersection=be.numIntersection,f.clippingPlanes=be.uniform),a.fog=t.fog,a.needsLights=function(e){return e.isMeshLambertMaterial||e.isMeshToonMaterial||e.isMeshPhongMaterial||e.isMeshStandardMaterial||e.isShadowMaterial||e.isShaderMaterial&&!0===e.lights}(e),a.lightsStateVersion=o,a.needsLights&&(f.ambientLightColor.value=n.state.ambient,f.lightProbe.value=n.state.probe,f.directionalLights.value=n.state.directional,f.directionalLightShadows.value=n.state.directionalShadow,f.spotLights.value=n.state.spot,f.spotLightShadows.value=n.state.spotShadow,f.rectAreaLights.value=n.state.rectArea,f.pointLights.value=n.state.point,f.pointLightShadows.value=n.state.pointShadow,f.hemisphereLights.value=n.state.hemi,f.directionalShadowMap.value=n.state.directionalShadowMap,f.directionalShadowMatrix.value=n.state.directionalShadowMatrix,f.spotShadowMap.value=n.state.spotShadowMap,f.spotShadowMatrix.value=n.state.spotShadowMatrix,f.pointShadowMap.value=n.state.pointShadowMap,f.pointShadowMatrix.value=n.state.pointShadowMatrix);var h=a.program.getUniforms(),m=Ie.seqWithValue(h.seq,f);a.uniformsList=m}function Ve(e,t,r,o){H.resetTextureUnits();var s=t.fog,u=r.isMeshStandardMaterial?t.environment:null,d=W.get(r),p=P.state.lights;if(xe&&(Re||e!==le)){var c=e===le&&r.id===oe;be.setState(r.clippingPlanes,r.clipIntersection,r.clipShadows,e,d,c)}r.version===d.__version?void 0===d.program||r.fog&&d.fog!==s||d.environment!==u||d.needsLights&&d.lightsStateVersion!==p.state.version?ke(r,t,o):void 0===d.numClippingPlanes||d.numClippingPlanes===be.numPlanes&&d.numIntersection===be.numIntersection?d.outputEncoding!==$.outputEncoding&&ke(r,t,o):ke(r,t,o):(ke(r,t,o),d.__version=r.version);var f,h,m=!1,g=!1,E=!1,v=d.program,M=v.getUniforms(),T=d.uniforms;if(B.useProgram(v.program)&&(m=!0,g=!0,E=!0),r.id!==oe&&(oe=r.id,g=!0),m||le!==e){if(M.setValue(y,"projectionMatrix",e.projectionMatrix),N.logarithmicDepthBuffer&&M.setValue(y,"logDepthBufFC",2/(Math.log(e.far+1)/Math.LN2)),le!==e&&(le=e,g=!0,E=!0),r.isShaderMaterial||r.isMeshPhongMaterial||r.isMeshToonMaterial||r.isMeshStandardMaterial||r.envMap){var _=M.map.cameraPosition;void 0!==_&&_.setValue(y,Ae.setFromMatrixPosition(e.matrixWorld))}(r.isMeshPhongMaterial||r.isMeshToonMaterial||r.isMeshLambertMaterial||r.isMeshBasicMaterial||r.isMeshStandardMaterial||r.isShaderMaterial)&&M.setValue(y,"isOrthographic",!0===e.isOrthographicCamera),(r.isMeshPhongMaterial||r.isMeshToonMaterial||r.isMeshLambertMaterial||r.isMeshBasicMaterial||r.isMeshStandardMaterial||r.isShaderMaterial||r.skinning)&&M.setValue(y,"viewMatrix",e.matrixWorldInverse)}if(r.skinning){M.setOptional(y,o,"bindMatrix"),M.setOptional(y,o,"bindMatrixInverse");var b=o.skeleton;if(b){var x=b.bones;if(N.floatVertexTextures){if(void 0===b.boneTexture){var R=Math.sqrt(4*x.length);R=n.a.ceilPowerOfTwo(R),R=Math.max(R,4);var S=new Float32Array(R*R*4);S.set(b.boneMatrices);var A=new i.a(S,R,R,a.Db,a.D);b.boneMatrices=S,b.boneTexture=A,b.boneTextureSize=R}M.setValue(y,"boneTexture",b.boneTexture,H),M.setValue(y,"boneTextureSize",b.boneTextureSize)}else M.setOptional(y,b,"boneMatrices")}}return(g||d.receiveShadow!==o.receiveShadow)&&(d.receiveShadow=o.receiveShadow,M.setValue(y,"receiveShadow",o.receiveShadow)),g&&(M.setValue(y,"toneMappingExposure",$.toneMappingExposure),M.setValue(y,"toneMappingWhitePoint",$.toneMappingWhitePoint),d.needsLights&&(h=E,(f=T).ambientLightColor.needsUpdate=h,f.lightProbe.needsUpdate=h,f.directionalLights.needsUpdate=h,f.directionalLightShadows.needsUpdate=h,f.pointLights.needsUpdate=h,f.pointLightShadows.needsUpdate=h,f.spotLights.needsUpdate=h,f.spotLightShadows.needsUpdate=h,f.rectAreaLights.needsUpdate=h,f.hemisphereLights.needsUpdate=h),s&&r.fog&&function(e,t){e.fogColor.value.copy(t.color),t.isFog?(e.fogNear.value=t.near,e.fogFar.value=t.far):t.isFogExp2&&(e.fogDensity.value=t.density)}(T,s),r.isMeshBasicMaterial?ze(T,r):r.isMeshLambertMaterial?(ze(T,r),function(e,t){t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap)}(T,r)):r.isMeshToonMaterial?(ze(T,r),function(e,t){e.specular.value.copy(t.specular),e.shininess.value=Math.max(t.shininess,1e-4),t.gradientMap&&(e.gradientMap.value=t.gradientMap);t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap);t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===a.h&&(e.bumpScale.value*=-1));t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===a.h&&e.normalScale.value.negate());t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(T,r)):r.isMeshPhongMaterial?(ze(T,r),function(e,t){e.specular.value.copy(t.specular),e.shininess.value=Math.max(t.shininess,1e-4),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap);t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===a.h&&(e.bumpScale.value*=-1));t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===a.h&&e.normalScale.value.negate());t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(T,r)):r.isMeshStandardMaterial?(ze(T,r,u),r.isMeshPhysicalMaterial?function(e,t,r){Ye(e,t,r),e.reflectivity.value=t.reflectivity,e.clearcoat.value=t.clearcoat,e.clearcoatRoughness.value=t.clearcoatRoughness,t.sheen&&e.sheen.value.copy(t.sheen);t.clearcoatMap&&(e.clearcoatMap.value=t.clearcoatMap);t.clearcoatRoughnessMap&&(e.clearcoatRoughnessMap.value=t.clearcoatRoughnessMap);t.clearcoatNormalMap&&(e.clearcoatNormalScale.value.copy(t.clearcoatNormalScale),e.clearcoatNormalMap.value=t.clearcoatNormalMap,t.side===a.h&&e.clearcoatNormalScale.value.negate());e.transparency.value=t.transparency}(T,r,u):Ye(T,r,u)):r.isMeshMatcapMaterial?(ze(T,r),function(e,t){t.matcap&&(e.matcap.value=t.matcap);t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===a.h&&(e.bumpScale.value*=-1));t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===a.h&&e.normalScale.value.negate());t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(T,r)):r.isMeshDepthMaterial?(ze(T,r),function(e,t){t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(T,r)):r.isMeshDistanceMaterial?(ze(T,r),function(e,t){t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias);e.referencePosition.value.copy(t.referencePosition),e.nearDistance.value=t.nearDistance,e.farDistance.value=t.farDistance}(T,r)):r.isMeshNormalMaterial?(ze(T,r),function(e,t){t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===a.h&&(e.bumpScale.value*=-1));t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===a.h&&e.normalScale.value.negate());t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(T,r)):r.isLineBasicMaterial?(function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity}(T,r),r.isLineDashedMaterial&&function(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}(T,r)):r.isPointsMaterial?function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.size.value=t.size*me,e.scale.value=.5*he,t.map&&(e.map.value=t.map);t.alphaMap&&(e.alphaMap.value=t.alphaMap);var r;t.map?r=t.map:t.alphaMap&&(r=t.alphaMap);void 0!==r&&(!0===r.matrixAutoUpdate&&r.updateMatrix(),e.uvTransform.value.copy(r.matrix))}(T,r):r.isSpriteMaterial?function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.rotation.value=t.rotation,t.map&&(e.map.value=t.map);t.alphaMap&&(e.alphaMap.value=t.alphaMap);var r;t.map?r=t.map:t.alphaMap&&(r=t.alphaMap);void 0!==r&&(!0===r.matrixAutoUpdate&&r.updateMatrix(),e.uvTransform.value.copy(r.matrix))}(T,r):r.isShadowMaterial&&(T.color.value.copy(r.color),T.opacity.value=r.opacity),void 0!==T.ltc_1&&(T.ltc_1.value=l.a.LTC_1),void 0!==T.ltc_2&&(T.ltc_2.value=l.a.LTC_2),Ie.upload(y,d.uniformsList,T,H),r.isShaderMaterial&&(r.uniformsNeedUpdate=!1)),r.isShaderMaterial&&!0===r.uniformsNeedUpdate&&(Ie.upload(y,d.uniformsList,T,H),r.uniformsNeedUpdate=!1),r.isSpriteMaterial&&M.setValue(y,"center",o.center),M.setValue(y,"modelViewMatrix",o.modelViewMatrix),M.setValue(y,"normalMatrix",o.normalMatrix),M.setValue(y,"modelMatrix",o.matrixWorld),v}function ze(e,t,r){e.opacity.value=t.opacity,t.color&&e.diffuse.value.copy(t.color),t.emissive&&e.emissive.value.copy(t.emissive).multiplyScalar(t.emissiveIntensity),t.map&&(e.map.value=t.map),t.alphaMap&&(e.alphaMap.value=t.alphaMap),t.specularMap&&(e.specularMap.value=t.specularMap);var a,n,i=t.envMap||r;i&&(e.envMap.value=i,e.flipEnvMap.value=i.isCubeTexture?-1:1,e.reflectivity.value=t.reflectivity,e.refractionRatio.value=t.refractionRatio,e.maxMipLevel.value=W.get(i).__maxMipLevel),t.lightMap&&(e.lightMap.value=t.lightMap,e.lightMapIntensity.value=t.lightMapIntensity),t.aoMap&&(e.aoMap.value=t.aoMap,e.aoMapIntensity.value=t.aoMapIntensity),t.map?a=t.map:t.specularMap?a=t.specularMap:t.displacementMap?a=t.displacementMap:t.normalMap?a=t.normalMap:t.bumpMap?a=t.bumpMap:t.roughnessMap?a=t.roughnessMap:t.metalnessMap?a=t.metalnessMap:t.alphaMap?a=t.alphaMap:t.emissiveMap&&(a=t.emissiveMap),void 0!==a&&(a.isWebGLRenderTarget&&(a=a.texture),!0===a.matrixAutoUpdate&&a.updateMatrix(),e.uvTransform.value.copy(a.matrix)),t.aoMap?n=t.aoMap:t.lightMap&&(n=t.lightMap),void 0!==n&&(n.isWebGLRenderTarget&&(n=n.texture),!0===n.matrixAutoUpdate&&n.updateMatrix(),e.uv2Transform.value.copy(n.matrix))}function Ye(e,t,r){e.roughness.value=t.roughness,e.metalness.value=t.metalness,t.roughnessMap&&(e.roughnessMap.value=t.roughnessMap),t.metalnessMap&&(e.metalnessMap.value=t.metalnessMap),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===a.h&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===a.h&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias),(t.envMap||r)&&(e.envMapIntensity.value=t.envMapIntensity)}Ge.setAnimationLoop((function(e){ye.isPresenting||Be&&Be(e)})),"undefined"!=typeof window&&Ge.setContext(window),this.setAnimationLoop=function(e){Be=e,ye.setAnimationLoop(e),Ge.start()},this.render=function(e,t){var r,a;if(void 0!==arguments[2]&&(console.warn("THREE.WebGLRenderer.render(): the renderTarget argument has been removed. Use .setRenderTarget() instead."),r=arguments[2]),void 0!==arguments[3]&&(console.warn("THREE.WebGLRenderer.render(): the forceClear argument has been removed. Use .clear() instead."),a=arguments[3]),t&&t.isCamera){if(!ee){se.geometry=null,se.program=null,se.wireframe=!1,oe=-1,le=null,!0===e.autoUpdate&&e.updateMatrixWorld(),null===t.parent&&t.updateMatrixWorld(),ye.enabled&&ye.isPresenting&&(t=ye.getCamera(t)),(P=j.get(e,t)).init(),e.onBeforeRender($,e,t,r||ne),Se.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),_e.setFromProjectionMatrix(Se),Re=this.localClippingEnabled,xe=be.init(this.clippingPlanes,Re,t),(A=Y.get(e,t)).init(),We(e,t,0,$.sortObjects),A.finish(),!0===$.sortObjects&&A.sort(ge,Ee),xe&&be.beginShadows();var n=P.state.shadowsArray;Fe.render(n,e,t),P.setupLights(t),xe&&be.endShadows(),this.info.autoReset&&this.info.reset(),void 0!==r&&this.setRenderTarget(r),q.render(A,e,t,a);var i=A.opaque,o=A.transparent;if(e.overrideMaterial){var s=e.overrideMaterial;i.length&&He(i,e,t,s),o.length&&He(o,e,t,s)}else i.length&&He(i,e,t),o.length&&He(o,e,t);e.onAfterRender($,e,t),null!==ne&&(H.updateRenderTargetMipmap(ne),H.updateMultisampleRenderTarget(ne)),B.buffers.depth.setTest(!0),B.buffers.depth.setMask(!0),B.buffers.color.setMask(!0),B.setPolygonOffset(!1),A=null,P=null}}else console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.")},this.setFramebuffer=function(e){te!==e&&null===ne&&y.bindFramebuffer(y.FRAMEBUFFER,e),te=e},this.getActiveCubeFace=function(){return re},this.getActiveMipmapLevel=function(){return ae},this.getRenderTarget=function(){return ne},this.setRenderTarget=function(e,t,r){ne=e,re=t,ae=r,e&&void 0===W.get(e).__webglFramebuffer&&H.setupRenderTarget(e);var a=te,n=!1;if(e){var i=W.get(e).__webglFramebuffer;e.isWebGLCubeRenderTarget?(a=i[t||0],n=!0):a=e.isWebGLMultisampleRenderTarget?W.get(e).__webglMultisampledFramebuffer:i,de.copy(e.viewport),pe.copy(e.scissor),ce=e.scissorTest}else de.copy(ve).multiplyScalar(me).floor(),pe.copy(Me).multiplyScalar(me).floor(),ce=Te;if(ie!==a&&(y.bindFramebuffer(y.FRAMEBUFFER,a),ie=a),B.viewport(de),B.scissor(pe),B.setScissorTest(ce),n){var o=W.get(e.texture);y.framebufferTexture2D(y.FRAMEBUFFER,y.COLOR_ATTACHMENT0,y.TEXTURE_CUBE_MAP_POSITIVE_X+(t||0),o.__webglTexture,r||0)}},this.readRenderTargetPixels=function(e,t,r,n,i,o,s){if(e&&e.isWebGLRenderTarget){var l=W.get(e).__webglFramebuffer;if(e.isWebGLCubeRenderTarget&&void 0!==s&&(l=l[s]),l){var u=!1;l!==ie&&(y.bindFramebuffer(y.FRAMEBUFFER,l),u=!0);try{var d=e.texture,p=d.format,c=d.type;if(p!==a.Db&&J.convert(p)!==y.getParameter(y.IMPLEMENTATION_COLOR_READ_FORMAT))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");if(!(c===a.Wc||J.convert(c)===y.getParameter(y.IMPLEMENTATION_COLOR_READ_TYPE)||c===a.D&&(N.isWebGL2||F.get("OES_texture_float")||F.get("WEBGL_color_buffer_float"))||c===a.I&&(N.isWebGL2?F.get("EXT_color_buffer_float"):F.get("EXT_color_buffer_half_float"))))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");y.checkFramebufferStatus(y.FRAMEBUFFER)===y.FRAMEBUFFER_COMPLETE?t>=0&&t<=e.width-n&&r>=0&&r<=e.height-i&&y.readPixels(t,r,n,i,J.convert(p),J.convert(c),o):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{u&&y.bindFramebuffer(y.FRAMEBUFFER,ie)}}}else console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.")},this.copyFramebufferToTexture=function(e,t,r){void 0===r&&(r=0);var a=Math.pow(2,-r),n=Math.floor(t.image.width*a),i=Math.floor(t.image.height*a),o=J.convert(t.format);H.setTexture2D(t,0),y.copyTexImage2D(y.TEXTURE_2D,r,o,e.x,e.y,n,i,0),B.unbindTexture()},this.copyTextureToTexture=function(e,t,r,a){var n=t.image.width,i=t.image.height,o=J.convert(r.format),s=J.convert(r.type);H.setTexture2D(r,0),t.isDataTexture?y.texSubImage2D(y.TEXTURE_2D,a||0,e.x,e.y,n,i,o,s,t.image.data):y.texSubImage2D(y.TEXTURE_2D,a||0,e.x,e.y,o,s,t.image),B.unbindTexture()},this.initTexture=function(e){H.setTexture2D(e,0),B.unbindTexture()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}Object.assign(At.prototype,Rt.a.prototype)}}]);
//# sourceMappingURL=vendors~Cop~Obj.bundle.js.map