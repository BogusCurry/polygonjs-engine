!function(e){function t(t){for(var r,s,a=t[0],_=t[1],u=t[2],p=0,l=[];p<a.length;p++)s=a[p],Object.prototype.hasOwnProperty.call(o,s)&&o[s]&&l.push(o[s][0]),o[s]=0;for(r in _)Object.prototype.hasOwnProperty.call(_,r)&&(e[r]=_[r]);for(c&&c(t);l.length;)l.shift()();return i.push.apply(i,u||[]),n()}function n(){for(var e,t=0;t<i.length;t++){for(var n=i[t],r=!0,a=1;a<n.length;a++){var _=n[a];0!==o[_]&&(r=!1)}r&&(i.splice(t--,1),e=s(s.s=n[0]))}return e}var r={},o={4:0},i=[];function s(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=e,s.c=r,s.d=function(e,t,n){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)s.d(n,r,function(t){return e[t]}.bind(null,r));return n},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="";var a=window.webpackJsonp=window.webpackJsonp||[],_=a.push.bind(a);a.push=t,a=a.slice();for(var u=0;u<a.length;u++)t(a[u]);var c=_;i.push([335,6,0,3,5,1,2,7]),n()}([,,,,,,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(25),o=n(284),i=function(e,t,n){this.type=e,this.init_value=t,this.options=n};t.ParamTemplate=i;var s=function(){function e(){}return e.BUTTON=function(e,t){return new i(r.ParamType.BUTTON,e,t)},e.BOOLEAN=function(e,t){return new i(r.ParamType.BOOLEAN,e,t)},e.COLOR=function(e,t){return new i(r.ParamType.COLOR,e,t)},e.FLOAT=function(e,t){return new i(r.ParamType.FLOAT,e,t)},e.INTEGER=function(e,t){return new i(r.ParamType.INTEGER,e,t)},e.OPERATOR_PATH=function(e,t){return new i(r.ParamType.OPERATOR_PATH,e,t)},e.RAMP=function(e,t){return void 0===e&&(e=o.RampParam.DEFAULT_VALUE),new i(r.ParamType.RAMP,e,t)},e.SEPARATOR=function(e,t){return void 0===e&&(e=null),new i(r.ParamType.SEPARATOR,e,t)},e.STRING=function(e,t){return void 0===e&&(e=""),new i(r.ParamType.STRING,e,t)},e.VECTOR2=function(e,t){return new i(r.ParamType.VECTOR2,e,t)},e.VECTOR3=function(e,t){return new i(r.ParamType.VECTOR3,e,t)},e.VECTOR4=function(e,t){return new i(r.ParamType.VECTOR4,e,t)},e}();t.ParamConfig=s;var a=function(){};t.NodeParamsConfig=a},,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,o=n(3),i=o.__importDefault(n(82)),s=o.__importDefault(n(149)),a=n(81),_=n(26),u=n(292),c=n(296),p=n(606),l=n(118),d=n(42),h=n(120);!function(e){e.FROM_SET_CORE_GROUP="from set_core_group",e.FROM_SET_GROUP="from set_group",e.FROM_SET_OBJECTS="from set_objects",e.FROM_SET_OBJECT="from set_object",e.FROM_SET_GEOMETRIES="from set_geometries",e.FROM_SET_GEOMETRY="from set_geometry"}(r||(r={}));var f=["input geometry","input geometry","input geometry","input geometry"],m=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.container_controller=new l.TypedContainerController(t,p.GeometryContainer),t.flags=new h.FlagsControllerDB(t),t}return o.__extends(t,e),t.node_context=function(){return d.NodeContext.SOP},t.displayed_input_names=function(){return f},t.prototype.initialize_base_node=function(){var e=this;this.flags.display&&(this.flags.display.set(!1),this.flags.display.add_hook((function(){if(e.flags.display.active){var t=e.parent;t&&t.display_node_controller.set_display_node(e)}})))},t.prototype.set_core_group=function(e){for(var t=0,n=e.objects();t<n.length;t++){var o=n[t];this._set_object_attributes(o)}this.set_container(e,r.FROM_SET_CORE_GROUP)},t.prototype.set_object=function(e){this._set_object_attributes(e),this.set_container_objects([e],r.FROM_SET_OBJECT)},t.prototype.set_objects=function(e){for(var t=0,n=e;t<n.length;t++){var o=n[t];this._set_object_attributes(o)}this.set_container_objects(e,r.FROM_SET_OBJECTS)},t.prototype.set_geometry=function(e,t){var n=this.create_object(e,t);this.set_container_objects([n],r.FROM_SET_GEOMETRY)},t.prototype.set_geometries=function(e,t){var n,o=this,i=[];e.forEach((function(e){n=o.create_object(e,t),o._set_object_attributes(n),i.push(n)})),this.set_container_objects(i,r.FROM_SET_GEOMETRIES)},t.prototype.set_container_objects=function(e,t){var n=this.container_controller.container.core_content()||new u.CoreGroup;n.set_objects(e),n.touch(),this.set_container(n)},t.prototype.create_object=function(e,t){if(!e.index){var n=e.getAttribute("position").array;e.setIndex(i.default(n.length/3))}null==t&&(t=_.CoreConstant.OBJECT_TYPE.MESH);var r=new(0,_.CoreConstant.CONSTRUCTORS_BY_NAME[t])(e,_.CoreConstant.MATERIALS[t].clone());return r.castShadow=!0,r.receiveShadow=!0,r.frustumCulled=!1,r},t.prototype._set_object_attributes=function(e){var t=e.material;if(t){if(!this.scene)throw console.log("no scene"),"no scene";var n=c.CoreMaterial.node(this.scene,t);n&&n.add_render_hook(e)}},t.prototype._add_index=function(e){var t=e.getAttribute("position").array.length/3,n=[];s.default(t,(function(e){return n.push(e)})),e.setIndex(n)},t}(a.TypedNode);t.TypedSopNode=m;var y=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o.__extends(t,e),t}(m);t.BaseSopNodeClass=y},,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.ALWAYS="always",e.NEVER="never",e.FROM_NODE="from_node"}(t.InputCloneMode||(t.InputCloneMode={}))},,,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.BOOLEAN="boolean",e.BUTTON="button",e.COLOR="color",e.FLOAT="float",e.INTEGER="integer",e.OPERATOR_PATH="operator_path",e.RAMP="ramp",e.SEPARATOR="separator",e.STRING="string",e.VECTOR2="vector2",e.VECTOR3="vector3",e.VECTOR4="vector4"}(t.ParamType||(t.ParamType={}))},function(e,t,n){"use strict";var r,o,i;Object.defineProperty(t,"__esModule",{value:!0});var s,a=n(121),_=n(84),u=n(75),c=n(10),p=n(0),l=n(23),d=n(66),h=n(36),f=n(0),m=n(6),y=n(228),v=n(58),g=n(68),b=n(213),O=n(38);!function(e){e.MESH="MESH",e.POINTS="POINTS",e.LINE_SEGMENTS="LINE_SEGMENTS"}(s=t.ObjectType||(t.ObjectType={})),t.ObjectTypes=[s.MESH,s.POINTS,s.LINE_SEGMENTS],t.ObjectTypeMenuEntries=[{name:"Mesh",value:t.ObjectTypes.indexOf(s.MESH)},{name:"Points",value:t.ObjectTypes.indexOf(s.POINTS)},{name:"LineSegments",value:t.ObjectTypes.indexOf(s.LINE_SEGMENTS)}];var P,w,x=((r={MeshStandard:new g.MeshStandardMaterial({color:16777215,side:f.FrontSide,metalness:.5,roughness:.9})})[s.MESH]=new b.MeshLambertMaterial({color:new m.Color(.5,.5,1),side:f.FrontSide,vertexColors:p.NoColors,transparent:!0,depthTest:!0}),r[s.POINTS]=new v.PointsMaterial({color:16777215,size:.1,depthTest:!0}),r[s.LINE_SEGMENTS]=new O.LineBasicMaterial({color:16777215,linewidth:1}),r);!function(e){e[e.VERTEX=0]="VERTEX",e[e.OBJECT=1]="OBJECT"}(P=t.AttribClass||(t.AttribClass={})),t.AttribClassMenuEntries=[{name:"vertex",value:P.VERTEX},{name:"object",value:P.OBJECT}],function(e){e[e.NUMERIC=0]="NUMERIC",e[e.STRING=1]="STRING"}(w=t.AttribType||(t.AttribType={})),t.AttribTypeMenuEntries=[{name:"numeric",value:w.NUMERIC},{name:"string",value:w.STRING}],t.CoreConstant={ATTRIB_CLASS:{VERTEX:P.VERTEX,OBJECT:P.OBJECT},ATTRIB_TYPE:{NUMERIC:0,STRING:1},OBJECT_TYPE:{MESH:s.MESH,POINTS:s.POINTS,LINE_SEGMENTS:s.LINE_SEGMENTS},OBJECT_TYPES:t.ObjectTypes,CONSTRUCTOR_NAMES_BY_CONSTRUCTOR_NAME:(o={},o[_.Scene.name]="Scene",o[h.Group.name]="Group",o[c.Object3D.name]="Object3D",o[l.Mesh.name]="Mesh",o[u.Points.name]="Points",o[d.LineSegments.name]="LineSegments",o[y.Bone.name]="Bone",o[a.SkinnedMesh.name]="SkinnedMesh",o),CONSTRUCTORS_BY_NAME:(i={},i[s.MESH]=l.Mesh,i[s.POINTS]=u.Points,i[s.LINE_SEGMENTS]=d.LineSegments,i),MATERIALS:x}},,,,,,,,,,,,,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.MANAGER="managers",e.OBJ="objects",e.SOP="sop",e.MAT="mat",e.COP="cop",e.POST="post",e.GL="gl",e.EVENT="event"}(t.NodeContext||(t.NodeContext={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=n(1),i=n(4),s=n(4),a=n(5),_=n(76),u=r.__importDefault(n(82)),c=r.__importDefault(n(102)),p=r.__importDefault(n(135)),l=r.__importDefault(n(293)),d=r.__importDefault(n(206)),h=r.__importDefault(n(178)),f=r.__importDefault(n(21)),m=r.__importDefault(n(41)),y=n(294),v=n(604),g=n(26),b=n(94),O=n(605),P=n(215),w=function(){function e(e){this._geometry=e}return e.prototype.geometry=function(){return this._geometry},e.prototype.uuid=function(){return this._geometry.uuid},e.prototype.bounding_box=function(){return this._bounding_box=this._bounding_box||this._create_bounding_box()},e.prototype._create_bounding_box=function(){return this._geometry.computeBoundingBox(),this._geometry.boundingBox},e.prototype.mark_as_instance=function(){this._geometry.userData.is_instance=!0},e.marked_as_instance=function(e){return!0===e.userData.is_instance},e.prototype.marked_as_instance=function(){return e.marked_as_instance(this._geometry)},e.prototype.position_attrib_name=function(){var e="position";return this.marked_as_instance()&&(e="instancePosition"),e},e.prototype.compute_vertex_normals=function(){this._geometry.computeVertexNormals()},e.prototype.user_data_attribs=function(){var e="indexed_attrib_values";return this._geometry.userData[e]=this._geometry.userData[e]||{}},e.prototype.indexed_attribute_names=function(){return Object.keys(this.user_data_attribs()||{})},e.prototype.user_data_attrib=function(e){return e=b.CoreAttribute.remap_name(e),this.user_data_attribs()[e]},e.prototype.is_attrib_indexed=function(e){return e=b.CoreAttribute.remap_name(e),null!=this.user_data_attrib(e)},e.prototype.has_attrib=function(e){return"ptnum"===e||(e=b.CoreAttribute.remap_name(e),null!=this._geometry.attributes[e])},e.prototype.attrib_type=function(e){return this.is_attrib_indexed(e)?g.CoreConstant.ATTRIB_TYPE.STRING:g.CoreConstant.ATTRIB_TYPE.NUMERIC},e.prototype.attrib_names=function(){return Object.keys(this._geometry.attributes)},e.prototype.attrib_sizes=function(){for(var e={},t=0,n=this.attrib_names();t<n.length;t++){var r=n[t];e[r]=this._geometry.attributes[r].itemSize}return e},e.prototype.attrib_size=function(e){var t;return e=b.CoreAttribute.remap_name(e),null!=(t=this._geometry.attributes[e])?t.itemSize:"ptnum"===e?1:0},e.prototype.set_indexed_attribute_values=function(e,t){this.user_data_attribs()[e]=t},e.prototype.set_indexed_attribute=function(e,t,n){this.set_indexed_attribute_values(e,t),this._geometry.setAttribute(e,new i.Int32BufferAttribute(n,1))},e.prototype.add_numeric_attrib=function(e,t,n){void 0===t&&(t=1),void 0===n&&(n=0);var r=[],o=!1;if(m.default(n)){for(var i=0;i<this.points_count();i++)for(var a=0;a<t;a++)r.push(n);o=!0}else if(t>1)if(f.default(n)){for(i=0;i<this.points_count();i++)for(a=0;a<t;a++)r.push(n[a]);o=!0}else{var _=n;if(2==t&&null!=_.x&&null!=_.y){for(i=0;i<this.points_count();i++)r.push(_.x),r.push(_.y);o=!0}var u=n;if(3==t&&null!=u.x&&null!=u.y&&null!=u.z){for(i=0;i<this.points_count();i++)r.push(u.x),r.push(u.y),r.push(u.z);o=!0}var c=n;if(3==t&&null!=c.r&&null!=c.g&&null!=c.b){for(i=0;i<this.points_count();i++)r.push(c.r),r.push(c.g),r.push(c.b);o=!0}var p=n;if(4==t&&null!=p.x&&null!=p.y&&null!=p.z&&null!=p.w){for(i=0;i<this.points_count();i++)r.push(p.x),r.push(p.y),r.push(p.z),r.push(p.w);o=!0}}if(!o)throw"no other default value allowed for now in add_numeric_attrib";this._geometry.setAttribute(e,new s.Float32BufferAttribute(r,t))},e.prototype.init_position_attribute=function(e,t){var n=[];null==t&&(t=new o.Vector3);for(var r=0;r<e;r++)n.push(t.x),n.push(t.y),n.push(t.z);return this._geometry.setAttribute("position",new s.Float32BufferAttribute(n,3))},e.prototype.add_attribute=function(e,t){switch(t.type()){case g.CoreConstant.ATTRIB_TYPE.STRING:return console.log("TODO: to implement");case g.CoreConstant.ATTRIB_TYPE.NUMERIC:return this.add_numeric_attrib(e,t.size())}},e.prototype.rename_attribute=function(e,t){this.is_attrib_indexed(e)&&(this.user_data_attribs()[t]=h.default(this.user_data_attribs()[e]),delete this.user_data_attribs()[e]);var n=this._geometry.getAttribute(e);return this._geometry.setAttribute(t,new s.Float32BufferAttribute(n.array,n.itemSize)),this._geometry.deleteAttribute(e)},e.prototype.delete_attribute=function(e){return this.is_attrib_indexed(e)&&delete this.user_data_attribs()[e],this._geometry.deleteAttribute(e)},e.prototype.clone=function(){return e.clone(this._geometry)},e.clone=function(e){for(var t,n=0,r=Object.keys(e.attributes);n<r.length;n++){var o=r[n],i=e.getAttribute(o);i.constructor.name==_.InterleavedBufferAttribute.name&&O.MonkeyPatcher.patch(i)}var s=e.clone();return null!=(t=e.userData)&&(s.userData=d.default(t)),s},e.prototype.points_count=function(){return e.points_count(this._geometry)},e.points_count=function(e){var t,n=0,r="position";if(new this(e).marked_as_instance()&&(r="instancePosition"),null!=(t=e.getAttribute(r))){var o;null!=(o=t.array)&&(n=o.length/3)}return n},e.prototype.points=function(){return this._points=this._points||this.points_from_geometry()},e.prototype.reset_points=function(){this._points=void 0},e.prototype.points_from_geometry=function(){var e=[],t=this._geometry.getAttribute(this.position_attrib_name());if(null!=t)for(var n=t.array.length/3,r=0;r<n;r++){var o=new y.CorePoint(this,r);e.push(o)}return e},e.geometry_from_points=function(e,t){var n=new a.BufferGeometry,r=new this(n),o=e[0];if(null!=o){var i=o.geometry(),_=o.geometry_wrapper(),u={};p.default(e,(function(e,t){return u[e.index]=t}));var l=this._indices_from_points(u,i,t);null!=l&&0!==l.length&&n.setIndex(l);for(var d=i.attributes,h=function(t){if(null!=_.user_data_attribs()[t]){var o=c.default(e.map((function(e){return e.attrib_value(t)}))),i={};p.default(o,(function(e,t){return i[e]=t})),r.user_data_attribs()[t]=o;for(var a=[],u=0,l=e;u<l.length;u++){var h=l[u],f=i[h.attrib_value(t)];a.push(f)}n.setAttribute(t,new s.Float32BufferAttribute(a,1))}else{for(var m=[],y=d[t].itemSize,v=0,g=e;v<g.length;v++){var b=(h=g[v]).attrib_value(t);switch(y){case 1:m.push(b);case 3:m.push(b.x),m.push(b.y),m.push(b.z)}}n.setAttribute(t,new s.Float32BufferAttribute(m,y))}},f=0,m=Object.keys(d);f<m.length;f++){h(m[f])}}return n},e._indices_from_points=function(e,t,n){var r=t.index;if(null!=r){var o=r.array,i=[];switch(n){case g.CoreConstant.OBJECT_TYPE.POINTS:p.default(o,(function(t,n){var r=e[t];null!=r&&i.push(r)}));break;case g.CoreConstant.OBJECT_TYPE.MESH:p.default(o,(function(t,n){if(n%3==0){var r=o[n],s=o[n+1],a=o[n+2],_=e[r],u=e[s],c=e[a];null!=_&&null!=u&&null!=c&&(i.push(_),i.push(u),i.push(c))}}));break;case g.CoreConstant.OBJECT_TYPE.LINE_SEGMENTS:p.default(o,(function(t,n){if(n%2==0){var r=o[n],s=o[n+1],a=e[r],_=e[s];null!=a&&null!=_&&(i.push(a),i.push(_))}}))}return i}},e.merge_geometries=function(t){if(0!==t.length){for(var n=t.map((function(t){return new e(t)})),r=n[0].indexed_attribute_names(),o={},i=0,s=r;i<s.length;i++){for(var a=s[i],_={},u=[],c=0,p=n;c<p.length;c++)for(var l=0,d=p[c].points();l<d.length;l++){var h=d[l];u.push(h),null!=_[v=h.attrib_value(a)]?_[v]:_[v]=Object.keys(_).length}for(var f=Object.keys(_),m=0,y=u;m<y.length;m++){var v,g=_[v=(h=y[m]).attrib_value(a)];h.set_attrib_index(a,g)}o[a]=f}var b=P.BufferGeometryUtils.mergeBufferGeometries(t),O=new this(b);return Object.keys(o).forEach((function(e){var t=o[e];O.set_indexed_attribute_values(e,t)})),b&&delete b.userData.mergedUserData,b}},e.prototype.segments=function(){var e,t=(null===(e=this.geometry().index)||void 0===e?void 0:e.array)||[];return l.default(t,2)},e.prototype.faces=function(){return this.faces_from_geometry()},e.prototype.faces_from_geometry=function(){var e,t=this,n=((null===(e=this.geometry().index)||void 0===e?void 0:e.array)||[]).length/3;return u.default(n).map((function(e){return new v.CoreFace(t,e)}))},e}();t.CoreGeometry=w},,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=n(92),i=n(209),s=n(145),a=n(81),_=n(521),u=r.__importDefault(n(45)),c=r.__importDefault(n(41)),p=n(143),l=function(){function e(e){this.param=e,this.node=this.param.node}return e.required_arguments=function(){return console.warn("Expression.Method._Base.required_arguments virtual method call. Please override"),[]},e.optional_arguments=function(){return[]},e.min_allowed_arguments_count=function(){return this.required_arguments().length},e.max_allowed_arguments_count=function(){return this.min_allowed_arguments_count()+this.optional_arguments().length},e.allowed_arguments_count=function(e){return e>=this.min_allowed_arguments_count()&&e<=this.max_allowed_arguments_count()},e.prototype.process_arguments=function(e){throw"Expression.Method._Base.process_arguments virtual method call. Please override"},e.prototype.get_referenced_node_container=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,n;return r.__generator(this,(function(r){switch(r.label){case 0:return(t=this.get_referenced_node(e))?[4,t.request_container()]:[3,2];case 1:if((n=r.sent())&&n.core_content())return[2,n];throw"referenced node invalid: "+t.full_path();case 2:throw"invalid input ("+e+")"}}))}))},e.prototype.get_referenced_param=function(e,t){return o.CoreWalker.find_param(this.node,e,t)||null},e.prototype.find_referenced_graph_node=function(e,t){if(c.default(e)){var n=e;return this.node.io.inputs.input_graph_node(n)}var r=e;return this.get_referenced_node(r,t)},e.prototype.get_referenced_node=function(e,t){if(u.default(e)){var n=e;return o.CoreWalker.find_node(this.node,n,t)}var r=e;return this.node.io.inputs.input(r)},e.prototype.find_dependency=function(e){return null},e.prototype.create_dependency_from_index_or_path=function(e){var t=new i.DecomposedPath,n=this.find_referenced_graph_node(e,t);return n?this.create_dependency(n,e,t):null},e.prototype.create_dependency=function(e,t,n){if(p.CoreObject.is_a(e,a.TypedNode)||p.CoreObject.is_a(e,s.TypedParam)){var r=e;return _.MethodDependency.create(this.param,t,r,null==n?void 0:n.named_nodes)}return _.MethodDependency.create(this.param,t,e,null==n?void 0:n.named_nodes)},e}();t.BaseMethod=l},,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=r.__importDefault(n(82)),i=r.__importDefault(n(102)),s=r.__importDefault(n(203)),a=r.__importDefault(n(91)),_=r.__importDefault(n(74)),u=r.__importDefault(n(479)),c=r.__importDefault(n(276)),p=r.__importDefault(n(483)),l=r.__importDefault(n(277)),d=r.__importDefault(n(491)),h=/[, ]/,f=/\d+$/,m=/,| /,y=/^\d+\.?\d*$/,v=function(){function e(){}return e.is_number=function(e){return y.test(e)},e.tail_digits=function(e){var t=e.match(f);return t?parseInt(t[0]):0},e.increment=function(e){var t;if(t=e.match(f)){var n=parseInt(t[0]);return""+e.substring(0,e.length-t[0].length)+(n+1)}return e+"1"},e.pluralize=function(e){return"s"!==e[e.length-1]?e+"s":e},e.camel_case=function(e){return d.default(e)},e.upper_first=function(e){return l.default(e)},e.snake_case=function(e){return p.default(e)},e.titleize=function(e){return c.default(e.replace(/_/g," "))},e.type_to_class_name=function(e){return this.upper_first(d.default(e))},e.timestamp_to_seconds=function(e){return Date.parse(e)/1e3},e.seconds_to_timestamp=function(e){var t=new Date;return t.setTime(1e3*e),t.toISOString().substr(11,8)},e.precision=function(e,t){void 0===t&&(t=2),t=Math.max(t,0);var n=(""+e).split(".");if(t<=0)return n[0];var r=n[1];if(void 0!==r)return r.length>t&&(r=r.substring(0,t)),r=u.default(r,t,"0"),n[0]+"."+r;var o=e+".",i=o.length+t;return u.default(o,i,"0")},e.ensure_float=function(e){var t=""+e;return t.indexOf(".")>=0?t:t+".0"},e.match_mask=function(e,t){return"*"===t||(t="^"+(t=t.split("*").join(".*"))+"$",new RegExp(t).test(e))},e.matches_one_mask=function(t,n){for(var r=!1,o=0,i=n;o<i.length;o++){var s=i[o];e.match_mask(t,s)&&(r=!0)}return r},e.attrib_names=function(e){var t=e.split(h),n=a.default(t.map((function(e){return s.default(e)})));return i.default(n)},e.to_id=function(e){if(null==e)return 0;var t=e.split("").reverse(),n=0,r=0;return t.forEach((function(e,t){var o=e.charCodeAt(0);o>=0&&(r=t%10,n+=o*Math.pow(10,r),n%=Number.MAX_SAFE_INTEGER)})),n},e.indices=function(e){var t=this,n=e.split(m);if(n.length>1)return i.default(_.default(n.map((function(e){return t.indices(e)})))).sort((function(e,t){return e-t}));var r=n[0];if(r){if(r.indexOf("-")>0){var s=r.split("-");return o.default(parseInt(s[0]),parseInt(s[1])+1)}return[parseInt(r)]}return[]},e.escape_line_breaks=function(e){return e.replace(/(\r\n|\n|\r)/gm,"\\n")},e}();t.CoreString=v},,function(e,t,n){"use strict";n.d(t,"a",(function(){return u}));var r,o,i,s=n(23),a=n(57),_=n(56);function u(){this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}Object.assign(u.prototype,{setSize:function(){},render:function(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}}),u.FullScreenQuad=(r=new a.OrthographicCamera(-1,1,1,-1,0,1),o=new _.PlaneBufferGeometry(2,2),i=function(e){this._mesh=new s.Mesh(o,e)},Object.defineProperty(i.prototype,"material",{get:function(){return this._mesh.material},set:function(e){this._mesh.material=e}}),Object.assign(i.prototype,{dispose:function(){this._mesh.geometry.dispose()},render:function(e){e.render(this._mesh,r)}}),i)},,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(465),o=function(){function e(e,t){this._scene=e,this._name=t,this._dirty_controller=new r.DirtyController(this),this._graph_node_id=e.graph.next_id(),e.graph.setNode(this),this._graph=e.graph}return Object.defineProperty(e.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0}),e.prototype.set_name=function(e){this._name=e},Object.defineProperty(e.prototype,"scene",{get:function(){return this._scene},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"graph",{get:function(){return this._graph},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"graph_node_id",{get:function(){return this._graph_node_id},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dirty_controller",{get:function(){return this._dirty_controller},enumerable:!0,configurable:!0}),e.prototype.set_dirty=function(e){e=e||this,this._dirty_controller.set_dirty(e)},e.prototype.set_successors_dirty=function(e){this._dirty_controller.set_successors_dirty(e)},e.prototype.remove_dirty_state=function(){this._dirty_controller.remove_dirty_state()},Object.defineProperty(e.prototype,"is_dirty",{get:function(){return this._dirty_controller.is_dirty},enumerable:!0,configurable:!0}),e.prototype.add_post_dirty_hook=function(e){this._dirty_controller.add_post_dirty_hook(e)},e.prototype.graph_remove=function(){this.graph.removeNode(this)},e.prototype.add_graph_input=function(e){return this.graph.connect(e,this)},e.prototype.remove_graph_input=function(e){this.graph.disconnect(e,this)},e.prototype.graph_disconnect_predecessors=function(){this.graph.disconnect_predecessors(this)},e.prototype.graph_disconnect_successors=function(){this.graph.disconnect_successors(this)},e.prototype.graph_predecessor_ids=function(){return this.graph.predecessor_ids(this._graph_node_id)||[]},e.prototype.graph_predecessors=function(){return this.graph.predecessors(this)},e.prototype.graph_successors=function(){return this.graph.successors(this)},e.prototype.graph_all_predecessors=function(){return this.graph.all_predecessors(this)},e.prototype.graph_all_successors=function(){return this.graph.all_successors(this)},e}();t.CoreGraphNode=o},,,,,,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.CREATED="node_created",e.DELETED="node_deleted",e.NAME_UPDATED="node_name_update",e.OVERRIDE_CLONABLE_STATE_UPDATE="node_override_clonable_state_update",e.NAMED_OUTPUTS_UPDATED="node_named_outputs_updated",e.NAMED_INPUTS_UPDATED="node_named_inputs_updated",e.INPUTS_UPDATED="node_inputs_updated",e.PARAMS_UPDATED="node_params_updated",e.UI_DATA_UPDATED="node_ui_data_updated",e.ERROR_UPDATED="node_error_updated",e.FLAG_BYPASS_UPDATED="bypass_flag_updated",e.FLAG_DISPLAY_UPDATED="display_flag_updated",e.SELECTION_UPDATED="selection_updated"}(t.NodeEvent||(t.NodeEvent={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(1),o=n(31),i=n(15),s=n(159),a=function(){function e(){this._translation_matrix=new i.Matrix4,this._translation_matrix_q=new o.Quaternion,this._translation_matrix_s=new r.Vector3(1,1,1),this._matrix=(new i.Matrix4).identity(),this._matrix_q=new o.Quaternion,this._matrix_e=new s.Euler,this._matrix_s=new r.Vector3,this._rotate_geometry_m=new i.Matrix4,this._rotate_geometry_q=new o.Quaternion,this._rotate_geometry_vec_dest=new r.Vector3}return e.set_params_from_matrix=function(e,t,n){void 0===n&&(n={});var i=n.scale;null==i&&(i=!0);var a=new r.Vector3,_=new o.Quaternion,u=new r.Vector3;e.decompose(a,_,u);var c=(new s.Euler).setFromQuaternion(_).toVector3();c.divideScalar(Math.PI/180),t.scene.batch_update((function(){t.params.set_vector3("r",c.toArray()),t.params.set_vector3("t",a.toArray()),t.params.set_vector3("s",u.toArray()),i&&t.params.set_float("scale",1)}))},e.set_params_from_object=function(e,t){var n=e.position.toArray(),r=e.rotation.toArray().map((function(e){return e*(180/Math.PI)}));t.scene.batch_update((function(){t.params.set_vector3("t",n),t.params.set_vector3("r",r)}))},e.prototype.translation_matrix=function(e){return this._translation_matrix.compose(e,this._translation_matrix_q,this._translation_matrix_s),this._translation_matrix},e.matrix_quaternion=function(e){var t=new r.Vector3,n=new o.Quaternion,i=new r.Vector3;return e.decompose(t,n,i),n},e.prototype.matrix=function(e,t,n,r){return this._matrix_e.set(t.x,t.y,t.z,"XYZ"),this._matrix_q.setFromEuler(this._matrix_e),this._matrix_s.copy(n).multiplyScalar(r),this._matrix.compose(e,this._matrix_q,this._matrix_s),this._matrix},e.prototype.rotate_geometry=function(e,t,n){this._rotate_geometry_vec_dest.copy(n),this._rotate_geometry_vec_dest.normalize(),this._rotate_geometry_q.setFromUnitVectors(t,this._rotate_geometry_vec_dest),this._rotate_geometry_m.makeRotationFromQuaternion(this._rotate_geometry_q),e.applyMatrix(this._rotate_geometry_m)},e}();t.CoreTransform=a},,,,,,,,,,,,,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=n(55),i=n(466),s=n(467),a=n(470),_=n(472),u=n(497),c=n(118),p=n(498),l=n(499),d=n(201),h=n(511),f=n(512),m=n(546),y=n(547),v=n(548),g=r.__importDefault(n(553)),b=n(556),O=n(119),P=function(e){function t(t,n){void 0===n&&(n="BaseNode");var r=e.call(this,t,n)||this;return r.container_controller=new c.TypedContainerController(r,O.BaseContainer),r.pv=new m.ParamsValueAccessor(r),r.p=new b.ParamsAccessor(r),r._initialized=!1,r}return r.__extends(t,e),Object.defineProperty(t.prototype,"parent_controller",{get:function(){return this._parent_controller=this._parent_controller||new a.HierarchyParentController(this)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"children_controller",{get:function(){return this._children_controller=this._children_controller||new _.HierarchyChildrenController(this)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"selection",{get:function(){return this._selection=this._selection||new g.default(this)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ui_data",{get:function(){return this._ui_data=this._ui_data||new i.UIData(this)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dependencies_controller",{get:function(){return this._dependencies_controller=this._dependencies_controller||new l.DependenciesController(this)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"states",{get:function(){return this._states=this._states||new s.StatesController(this)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lifecycle",{get:function(){return this._lifecycle=this._lifecycle||new u.LifeCycleController(this)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"serializer",{get:function(){return this._serializer=this._serializer||new h.NodeSerializer(this)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cook_controller",{get:function(){return this._cook_controller=this._cook_controller||new p.CookController(this)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"io",{get:function(){return this._io=this._io||new v.IOController(this)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"name_controller",{get:function(){return this._name_controller=this._name_controller||new d.NameController(this)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"params",{get:function(){return this._params_controller=this._params_controller||new f.ParamsController(this)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"processing_context",{get:function(){return this._processing_context=this._processing_context||new y.ProcessingContext(this)},enumerable:!0,configurable:!0}),t.prototype.initialize_base_and_node=function(){this._initialized?console.warn("node already initialized"):(this.initialize_base_node(),this.initialize_node(),this._initialized=!0)},t.prototype.initialize_base_node=function(){},t.prototype.initialize_node=function(){},t.type=function(){throw"type to be overriden"},t.prototype.type=function(){return this.constructor.type()},t.node_context=function(){throw"requires override"},t.prototype.node_context=function(){return this.constructor.node_context()},t.required_three_imports=function(){return[]},t.required_imports=function(){var e=this.required_three_imports();return e?e.map((function(e){return"three/examples/jsm/"+e})):[]},t.prototype.required_imports=function(){return this.constructor.required_imports()},t.require_webgl2=function(){return!1},t.prototype.require_webgl2=function(){return this.constructor.require_webgl2()},t.prototype.accepts_visitor=function(e){return e.visit_node(this)},t.prototype.set_parent=function(e){this.parent_controller.set_parent(e)},Object.defineProperty(t.prototype,"parent",{get:function(){return this.parent_controller.parent},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"root",{get:function(){return this._scene.root},enumerable:!0,configurable:!0}),t.prototype.full_path=function(){return this.parent_controller.full_path()},t.prototype.create_params=function(){},t.prototype.add_param=function(e,t,n,r){var o;return null===(o=this._params_controller)||void 0===o?void 0:o.add_param(e,t,n,r)},t.prototype.cook=function(e){return null},t.prototype.request_container=function(){return this.container_controller.request_container()},t.prototype.set_container=function(e,t){void 0===t&&(t=null),this.container_controller.container.set_content(e),null!=e&&(e.name||(e.name=this.full_path()),e.node||(e.node=this)),this.cook_controller.end_cook(t)},t.prototype.create_node=function(e){return this.children_controller.create_node(e)},t.prototype.remove_node=function(e){return this.children_controller.remove_node(e)},t.prototype.children=function(){return this.children_controller.children()},t.prototype.node=function(e){return this.children_controller.find_node(e)},t.prototype.nodes_by_type=function(e){return this.children_controller.nodes_by_type(e)},t.prototype.set_input=function(e,t){this.io.inputs.set_input(e,t)},t.prototype.emit=function(e,t){void 0===t&&(t=null),this.scene.events_controller.dispatch(this,e,t)},t.prototype.to_json=function(e){return void 0===e&&(e=!1),this.serializer.to_json(e)},t}(o.CoreGraphNode);t.TypedNode=P;var w=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t}(P);t.BaseNodeClass=w},,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,o=n(3),i=n(10),s=n(81),a=n(569),_=n(570),u=n(571),c=n(42),p=n(118),l=["parent object","parent object","parent object","parent object"];!function(e){e[e.MANAGER=0]="MANAGER",e[e.FOG=1]="FOG",e[e.CAMERA=2]="CAMERA",e[e.LIGHT=3]="LIGHT",e[e.EVENT=4]="EVENT",e[e.MAT=5]="MAT"}(r=t.ObjNodeRenderOrder||(t.ObjNodeRenderOrder={}));var d=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.container_controller=new p.TypedContainerController(t,a.ObjectContainer),t.render_order=r.MANAGER,t.add_to_hierarchy=!0,t._used_in_scene=!1,t}return o.__extends(t,e),t.node_context=function(){return c.NodeContext.OBJ},t.displayed_input_names=function(){return l},Object.defineProperty(t.prototype,"look_at_controller",{get:function(){return this._look_at_controller=this._look_at_controller||new _.LookAtController(this)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"transform_controller",{get:function(){return this._transform_controller=this._transform_controller||new u.TransformController(this)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"used_in_scene",{get:function(){return this._used_in_scene},enumerable:!0,configurable:!0}),t.prototype.set_used_in_scene=function(e){if(this._used_in_scene=e,!this.scene.loading_controller.is_loading){var t=this.parent;t&&t.update_object(this)}},t.prototype.initialize_base_node=function(){this._object=this._create_object_with_attributes(),this.name_controller.add_post_set_full_path_hook(this.set_group_name.bind(this))},Object.defineProperty(t.prototype,"object",{get:function(){return this._object},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"group",{get:function(){return this.object},enumerable:!0,configurable:!0}),t.prototype._create_object_with_attributes=function(){var e=this.create_object();return null!=e&&(e.name=this.name,e.node=this),e},t.prototype.set_group_name=function(){var e=this.group;e&&(e.name=this.full_path())},t.prototype.create_object=function(){return new i.Object3D},t.prototype.request_display_node=function(){},t.prototype.is_display_node_cooking=function(){return!1},t.prototype.is_displayed=function(){var e,t;return(null===(t=null===(e=this.flags)||void 0===e?void 0:e.display)||void 0===t?void 0:t.active)||!1},t.prototype.accepts_visitor=function(e){e.visit_node_obj(this)},t}(s.TypedNode);t.TypedObjNode=d;var h=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o.__extends(t,e),t}(d);t.BaseObjNodeclass=h},,,,,,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.find_param=function(e,n,r){if(!e)return null;var o=n.split(t.SEPARATOR);if(1===o.length)return e.params.get(o[0]);var i=o.slice(0,+(o.length-2)+1||void 0).join(t.SEPARATOR),s=this.find_node(e,i,r);if(null!=s){var a=o[o.length-1],_=s.params.get(a);return r&&_&&r.add_node(a,_),_}return null},t.relative_path=function(e,n){var r=this.closest_common_parent(e,n);if(r){var o=this.distance_to_parent(e,r),i="";if(o-1>0){for(var s=0,a=[];s++<o-1;)a.push(t.PARENT);i=a.join(t.SEPARATOR)+t.SEPARATOR}for(var _=r.full_path().split(t.SEPARATOR).filter((function(e){return e.length>0})),u=[],c=0,p=0,l=n.full_path().split(t.SEPARATOR).filter((function(e){return e.length>0}));p<l.length;p++){var d=l[p];_[c]||u.push(d),c++}return""+i+u.join(t.SEPARATOR)}return n.full_path()},t.closest_common_parent=function(e,t){for(var n=this.parents(e).reverse(),r=this.parents(t).reverse(),o=Math.min(n.length,r.length),i=null,s=0;s<o;s++)n[s].graph_node_id==r[s].graph_node_id&&(i=n[s]);return i},t.parents=function(e){for(var t=[],n=e.parent;n;)t.push(n),n=n.parent;return t},t.distance_to_parent=function(e,t){for(var n=0,r=e,o=t.graph_node_id;r&&r.graph_node_id!=o;)n+=1,r=r.parent;return r&&r.graph_node_id==o?n:-1},t.SEPARATOR="/",t.CURRENT=".",t.PARENT="..",t.CURRENT_WITH_SLASH=t.CURRENT+"/",t.PARENT_WITH_SLASH=t.PARENT+"/",t}(n(471).CoreWalkerEmbed);t.CoreWalker=o},,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(1),o={Vector2:n(2).Vector2,Vector3:r.Vector3},i={P:"position",N:"normal",Cd:"color"},s=function(){function e(){}return e.remap_name=function(e){return i[e]||e},e.array_to_indexed_arrays=function(e){for(var t={},n=0,r=[],o=[],i=0;i<e.length;){var s=e[i],a=t[s];null!=a?r.push(a):(o.push(s),r.push(n),t[s]=n,n+=1),i++}return{indices:r,values:o}},e.default_value=function(e){switch(e){case 1:return 0;case 2:return new o.Vector2(0,0);case 3:return new o.Vector3(0,0,0);default:throw"size "+e+" not yet implemented"}},e}();t.CoreAttribute=s},,,,,,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.post_eval_raw=function(e){var t=this._value;this._value=e,null!=this._value&&this.states.error.clear();var n=this.is_dirty;if(this.remove_dirty_state(),n&&this.emit_controller.emit_param_updated(),this.options.has_callback()&&t!==this._value)return this.options.execute_callback()},t}(n(145).TypedParam);t.Single=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=n(1),i={Triangle:n(77).Triangle,Vector3:o.Vector3},s=r.__importDefault(n(41)),a=n(282),_=Math.PI/180,u=function(){function e(){}return e.clamp=function(e,t,n){return e<t?t:e>n?n:e},e.fit01=function(e,t,n){return this.fit(e,0,1,t,n)},e.fit=function(e,t,n,r,o){return(e-t)/(n-t)*(o-r)+r},e.degrees_to_radians=function(e){return e*_},e.radians_to_degrees=function(e){return e/_},e.deg2rad=function(e){return this.degrees_to_radians(e)},e.rad2deg=function(e){return this.radians_to_degrees(e)},e.rand=function(e){return s.default(e)?this.rand_float(e):this.rand_vec2(e)},e.round=function(e,t){var n=e/t,r=e<0?Math.ceil(n):Math.floor(n);return console.log("round",t,e,n,r,r*t),r*t},e.highest_even=function(e){return 2*Math.ceil(.5*e)},e.rand_float=function(e){var t={x:e,y:136574};return this.rand_vec2(t)},e.rand_vec2=function(e){var t=(12.9898*e.x+78.233*e.y)%Math.PI;return this.fract(43758.5453*Math.sin(t))},e.geodesic_distance=function(e,t){var n=this.deg2rad(e.lat),r=this.deg2rad(t.lat),o=this.deg2rad(t.lat-e.lat),i=this.deg2rad(t.lng-e.lng),s=Math.sin(o/2)*Math.sin(o/2)+Math.cos(n)*Math.cos(r)*Math.sin(i/2)*Math.sin(i/2);return 6371e3*(2*Math.atan2(Math.sqrt(s),Math.sqrt(1-s)))},e.expand_triangle=function(e,t){var n,r=new i.Vector3;e.getMidpoint(r),function(e){e.a="a",e.b="b",e.c="c"}(n||(n={}));for(var o=0,s=["a","b","c"];o<s.length;o++){var a=s[o],_=e[a].clone().sub(r),u=_.clone().normalize(),c=_.length()+t;e[a]=r.clone().add(u.multiplyScalar(c))}return e},e.nearestPower2=function(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.log(2)))},e.Easing=a.Easing,e.fract=function(e){return e-Math.floor(e)},e}();t.CoreMath=u},,,,,,,,,,,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=function(){function e(e,t){this.node=e,this._callbacks=[],this._container=new t(this.node)}return Object.defineProperty(e.prototype,"container",{get:function(){return this._container},enumerable:!0,configurable:!0}),e.prototype.request_container=function(){var e=this;return new Promise((function(t,n){e._callbacks.push(t),e.node.scene.cook_controller.add_node(e.node),setTimeout(e.process_container_request.bind(e),0)}))},e.prototype.process_container_request=function(){var e,t,n=this;if(null===(t=null===(e=this.node.flags)||void 0===e?void 0:e.bypass)||void 0===t?void 0:t.active){this.request_input_container(0).then((function(e){n.node.remove_dirty_state(),e?n.notify_requesters(e):n.node.states.error.set("input invalid")}))}else this.node.is_dirty?(this.node.container_controller.container.reset_caches(),this.node.cook_controller.cook_main()):this.notify_requesters()},e.prototype.request_input_container=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t;return r.__generator(this,(function(n){switch(n.label){case 0:return(t=this.node.io.inputs.input(e))?(t.processing_context.copy(this.node.processing_context),[4,t.container_controller.request_container()]):[3,2];case 1:return[2,n.sent()];case 2:return this.node.states.error.set("input "+e+" required"),this.notify_requesters(),[2,null]}}))}))},e.prototype.notify_requesters=function(e){for(var t,n=[];t=this._callbacks.pop();)n.push(t);for(e||(e=this.node.container_controller.container.clone());t=n.pop();)t(e);this.node.scene.cook_controller.remove_node(this.node)},e}();t.TypedContainerController=o;var i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t}(o);t.BaseContainerController=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=function(e){function t(t){var n=e.call(this)||this;return n._node=t,n}return r.__extends(t,e),t.prototype.set_node=function(e){this._node=e},t.prototype.node=function(){return this._node},t.prototype.clone=function(){var e,t=new this.constructor;return t.set_node(this.node()),null!=(e=this.content())&&t.set_content(e),t},t.prototype.reset_caches=function(){},t.prototype.set_content=function(e){this.reset_caches(),this._content=e,this._post_set_content()},t.prototype.has_content=function(){return null!=this._content},t.prototype.content=function(){return this._content},t.prototype._post_set_content=function(){},t.prototype.core_content=function(){return this._content},t.prototype.core_content_cloned=function(){return this._content},t.prototype.infos=function(){return[]},t}(n(143).CoreObject);t.TypedContainer=o;var i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t}(o);t.BaseContainer=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=n(572),i=n(573),s=function(){function e(e){this.node=e}return e.prototype.has_display=function(){return!1},e.prototype.has_bypass=function(){return!1},e}();function a(e){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.display=new i.DisplayFlag(t.node),t}return r.__extends(t,e),t.prototype.has_display=function(){return!0},t}(e)}function _(e){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.bypass=new o.BypassFlag(t.node),t}return r.__extends(t,e),t.prototype.has_bypass=function(){return!0},t}(e)}t.FlagsController=s;var u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t}(a(s));t.FlagsControllerD=u;var c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t}(_(s));t.FlagsControllerB=c;var p=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t}(_(a(s)));t.FlagsControllerDB=p},,,,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(456),o=n(457),i=function(){function e(){this.renderers_controller=new r.RenderersController,this.nodes_register=new o.NodesRegister,this.scenes_by_uuid={}}return e.prototype.register_node=function(e,t,n){this.nodes_register.register_node(e,t,n)},e.prototype.registered_nodes=function(e,t){return this.nodes_register.registered_nodes(e,t)},e.prototype.in_worker_thread=function(){return!1},e.prototype.desktop_controller=function(){},e.prototype.player_mode=function(){return!1},e.prototype.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];console.log.apply(console,e)},e.prototype.set_env=function(e){this._env=e},Object.defineProperty(e.prototype,"env",{get:function(){return this._env},enumerable:!0,configurable:!0}),e}();t.Poly=i,window.POLY=window.POLY||new i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=["extended","included"];var o=function(){function e(){}return e.include=function(e){var t,n;t=e,n=this,Object.keys(n).forEach((function(e){r.includes(e)||(t.prototype[e]=n[e])})),n.included&&n.included.apply(t)},e.is_a=function(e,t){for(var n=e;n;){if(n.constructor==t)return!0;n=n.__proto__}return!1},e.prototype.is_a=function(t){return e.is_a(this,t)},e}();t.CoreObject=o},,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=n(92),i=n(55),s=n(504),a=n(505),_=n(506),u=n(507),c=n(510),p=n(25),l=function(e){function t(t){var n=e.call(this,t,"BaseParam")||this;return n._options=new s.OptionsController(n),n._emit_controller=new a.EmitController(n),n._is_computing=!1,n.initialize_param(),n}return r.__extends(t,e),Object.defineProperty(t.prototype,"options",{get:function(){return this._options=this._options||new s.OptionsController(this)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"emit_controller",{get:function(){return this._emit_controller=this._emit_controller||new a.EmitController(this)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"expression_controller",{get:function(){return this._expression_controller},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"serializer",{get:function(){return this._serializer=this._serializer||new _.ParamSerializer(this)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"states",{get:function(){return this._states=this._states||new u.StatesController(this)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ui_data",{get:function(){return this._ui_data=this._ui_data||new c.UIData(this.scene,this)},enumerable:!0,configurable:!0}),t.prototype.initialize_value=function(){},t.prototype.initialize_param=function(){},t.prototype.accepts_visitor=function(e){return e.visit_typed_param(this)},t.type=function(){return p.ParamType.FLOAT},Object.defineProperty(t.prototype,"type",{get:function(){return this.constructor.type()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"is_numeric",{get:function(){return!1},enumerable:!0,configurable:!0}),t.prototype.set_name=function(t){e.prototype.set_name.call(this,t)},Object.defineProperty(t.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0}),t.prototype.convert=function(e){return null},t.prototype.set=function(e){},Object.defineProperty(t.prototype,"default_value",{get:function(){return this._default_value},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"is_default",{get:function(){return!0},enumerable:!0,configurable:!0}),t.prototype.compute=function(){return r.__awaiter(this,void 0,void 0,(function(){var e,t=this;return r.__generator(this,(function(n){switch(n.label){case 0:return this.is_dirty?this._is_computing?[3,2]:(this._is_computing=!0,[4,this.process_computation()]):[3,3];case 1:if(n.sent(),this._is_computing=!1,this._compute_resolves)for(e=void 0;e=this._compute_resolves.pop();)e();return[3,3];case 2:return[2,new Promise((function(e,n){t._compute_resolves=t._compute_resolves||[],t._compute_resolves.push(e)}))];case 3:return[2]}}))}))},t.prototype.process_computation=function(){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(e){return[2]}))}))},t.prototype.set_init_value=function(e){this._default_value=e,this.is_multiple||this.set(e)},t.prototype.set_node=function(e){var t,n;if(e?(this._node=e,this.options.makes_node_dirty_when_dirty()&&!this.parent_param&&(null===(n=e.params.params_node)||void 0===n||n.add_graph_input(this))):this._node&&(null===(t=this._node.params.params_node)||void 0===t||t.remove_graph_input(this)),this.is_multiple&&(this.init_components(),this.components))for(var r=0,o=this.components;r<o.length;r++){o[r].set_node(e)}},Object.defineProperty(t.prototype,"node",{get:function(){return this._node},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return this.node},enumerable:!0,configurable:!0}),t.prototype.set_parent_param=function(e){e.add_graph_input(this),this._parent_param=e},Object.defineProperty(t.prototype,"parent_param",{get:function(){return this._parent_param},enumerable:!0,configurable:!0}),t.prototype.has_parent_param=function(){return null!=this._parent_param},t.prototype.full_path=function(){var e;return(null===(e=this.node)||void 0===e?void 0:e.full_path())+"/"+this.name},t.prototype.path_relative_to=function(e){return o.CoreWalker.relative_path(e,this)},t.prototype.emit=function(e){this.emit_controller.emit_allowed&&(this.emit_controller.increment_count(e),this.scene.events_controller.dispatch(this,e))},Object.defineProperty(t.prototype,"components",{get:function(){return this._components},enumerable:!0,configurable:!0}),Object.defineProperty(t,"component_names",{get:function(){return[]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"component_names",{get:function(){return this.constructor.component_names},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"is_multiple",{get:function(){return this.component_names.length>0},enumerable:!0,configurable:!0}),t.prototype.init_components=function(){},t.prototype.has_expression=function(){return null!=this.expression_controller&&this.expression_controller.active},t.prototype.to_json=function(){return this.serializer.to_json()},t}(i.CoreGraphNode);t.TypedParam=l;var d=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t}(l);t.BaseParamClass=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=r.__importDefault(n(21)),i=n(145),s=n(283),a=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._components_contructor=s.FloatParam,t}return r.__extends(t,e),Object.defineProperty(t.prototype,"components",{get:function(){return this._components},enumerable:!0,configurable:!0}),t.prototype.accepts_visitor=function(e){return e.visit_typed_multiple_param(this)},t.prototype.init_components=function(){var e=0;this._components=new Array(this.component_names.length);for(var t=0,n=this.component_names;t<n.length;t++){var r=n[t],i=new this._components_contructor(this.scene),s=void 0;s=o.default(this._default_value)?this._default_value[e]:this._default_value[r],i.options.copy(this.options),i.set_init_value(s),i.set_name(""+this.name+r),i.set_parent_param(this),this.add_graph_input(i),this._components[e]=i,e++}this.compute()},t.prototype.process_computation=function(){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(e){switch(e.label){case 0:return[4,this.compute_components()];case 1:return e.sent(),this.set_value_from_components(),[2]}}))}))},t.prototype.set_value_from_components=function(){},Object.defineProperty(t.prototype,"is_numeric",{get:function(){return!0},enumerable:!0,configurable:!0}),t.prototype.has_expression=function(){for(var e,t=0,n=this.components;t<n.length;t++){if(null===(e=n[t].expression_controller)||void 0===e?void 0:e.active)return!0}return!1},Object.defineProperty(t.prototype,"is_default",{get:function(){for(var e=0,t=this.components;e<t.length;e++){if(!t[e].is_default)return!1}return!0},enumerable:!0,configurable:!0}),t.prototype.compute_components=function(){return r.__awaiter(this,void 0,void 0,(function(){var e,t,n,o,i;return r.__generator(this,(function(r){switch(r.label){case 0:for(e=this.components,t=[],n=0,o=e;n<o.length;n++)i=o[n],t.push(i.compute());return[4,Promise.all(t)];case 1:return r.sent(),this.remove_dirty_state(),[2]}}))}))},t.prototype.set=function(e){var t=this.scene.cooker;t.block();for(var n=this.components,r=0,o=n;r<o.length;r++){o[r].emit_controller.block_parent_emit()}for(var i=0;i<n.length;i++)n[i].set(e[i]);t.unblock();for(i=0;i<n.length;i++)n[i].emit_controller.unblock_parent_emit();this.emit_controller.emit_param_updated()},t}(i.TypedParam);t.TypedMultipleParam=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=n(83),i=n(36),s=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}r.__extends(t,e)}(n(9).NodeParamsConfig),function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.add_to_hierarchy=!1,t}return r.__extends(t,e),t.prototype.create_object=function(){return new i.Group},t.prototype.cook=function(){this.cook_controller.end_cook()},t}(o.TypedObjNode));t.BaseManagerObjNode=s},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3).__importDefault(n(117)),o=n(55),i=n(64),s=function(){function e(e){this.node=e,this._graph_node=new o.CoreGraphNode(e.scene,"node_name_controller")}return Object.defineProperty(e.prototype,"graph_node",{get:function(){return this._graph_node},enumerable:!0,configurable:!0}),e.base_name=function(e){var t=e.type(),n=t[t.length-1];return r.default(parseInt(n))||(t+="_"),t+"1"},e.prototype.request_name_to_parent=function(e){var t=this.node.parent;null!=t?t.children_controller.set_child_name(this.node,e):console.warn("request_name_to_parent failed, no parent found")},e.prototype.set_name=function(e){e!=this.node.name&&this.request_name_to_parent(e)},e.prototype.update_name_from_parent=function(e){this.node.set_name(e),this.post_set_name(),this.post_set_full_path(),this.node.children_controller.children().forEach((function(e){e.name_controller.post_set_full_path()})),this._graph_node.set_successors_dirty(),this.node.emit(i.NodeEvent.NAME_UPDATED)},e.prototype.add_post_set_name_hook=function(e){this._on_set_name_hooks=this._on_set_name_hooks||[],this._on_set_name_hooks.push(e)},e.prototype.add_post_set_full_path_hook=function(e){this._on_set_full_path_hooks=this._on_set_full_path_hooks||[],this._on_set_full_path_hooks.push(e)},e.prototype.post_set_name=function(){if(this._on_set_name_hooks)for(var e=0,t=this._on_set_name_hooks;e<t.length;e++){(0,t[e])()}},e.prototype.post_set_full_path=function(){if(this._on_set_full_path_hooks)for(var e=0,t=this._on_set_full_path_hooks;e<t.length;e++){(0,t[e])()}},e}();t.NameController=s},,,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.VISIBLE_UPDATED="param_visible_updated",e.UPDATED="param_updated",e.DELETED="param_deleted"}(t.ParamEvent||(t.ParamEvent={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=r.__importDefault(n(45)),i=n(103),s=n(280),a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),Object.defineProperty(t.prototype,"is_numeric",{get:function(){return!0},enumerable:!0,configurable:!0}),t.prototype.accepts_visitor=function(e){return e.visit_numeric_param(this)},t.prototype.set=function(e){var t;this.states.error.clear();var n=this.convert(e);null!=n?(null===(t=this._expression_controller)||void 0===t||t.set_expression(void 0,!1),n!=this._value&&(this._value=n,this.emit_controller.emit_param_updated(),this.remove_dirty_state(),this.set_successors_dirty())):o.default(e)?(this._expression_controller=this._expression_controller||new s.ExpressionController(this),e!=this._expression_controller.expression&&(this._expression_controller.set_expression(e),this.emit_controller.emit_param_updated())):(this.states.error.set("param input is invalid ("+this.full_path()+")"),this.emit_controller.emit_param_updated()),this.parent_param&&this.parent_param.set_value_from_components()},t.prototype.process_computation=function(){var e;return r.__awaiter(this,void 0,void 0,(function(){var t,n;return r.__generator(this,(function(r){switch(r.label){case 0:return null===(e=this.expression_controller)||void 0===e||!e.active||this.expression_controller.requires_entities?[3,2]:[4,this.expression_controller.compute_expression()];case 1:t=r.sent(),this.expression_controller.is_errored?this.states.error.set('expression error: "'+this.expression_controller.expression+'" ('+this.expression_controller.error_message+")"):(null!=(n=this.convert(t))?this._value=n:this.states.error.set("expression returns an invalid type ("+t+") ("+this.expression_controller.expression+")"),this.remove_dirty_state()),r.label=2;case 2:return[2]}}))}))},t}(i.Single);t.TypedNumericParam=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(92).CoreWalker.SEPARATOR,o=function(){function e(){this.named_nodes=[],this.graph_node_ids=[],this.node_element_by_graph_node_id={}}return e.prototype.add_node=function(e,t){e==t.name&&this.named_nodes.push(t),this.graph_node_ids.push(t.graph_node_id),this.node_element_by_graph_node_id[t.graph_node_id]=e},e.prototype.update_from_name_change=function(e){this.named_nodes.map((function(e){return e.graph_node_id})).includes(e.graph_node_id)&&(this.node_element_by_graph_node_id[e.graph_node_id]=e.name)},e.prototype.to_path=function(){var e=this;return this.graph_node_ids.map((function(t){return e.node_element_by_graph_node_id[t]})).join(r)},e}();t.DecomposedPath=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VARIABLE_PREFIX="$";var r=function(){function e(e){this.param=e}return e.prototype.set_error=function(e){this.error_message=this.error_message||e},e.prototype.traverse_node=function(e){var t="traverse_"+e.type;if(this[t])return this[t](e);this.set_error("expression unknown node type: "+e.type)},e.prototype.traverse_BinaryExpression=function(e){return this.traverse_node(e.left)+" "+e.operator+" "+this.traverse_node(e.right)},e.prototype.traverse_LogicalExpression=function(e){return this.traverse_node(e.left)+" "+e.operator+" "+this.traverse_node(e.right)},e.prototype.traverse_MemberExpression=function(e){return this.traverse_node(e.object)+"."+this.traverse_node(e.property)},e.prototype.traverse_ConditionalExpression=function(e){return"("+this.traverse_node(e.test)+") ? ("+this.traverse_node(e.consequent)+") : ("+this.traverse_node(e.alternate)+")"},e.prototype.traverse_Compound=function(e){var n=e.body;console.log(n);for(var r=[],o=0;o<n.length;o++){var i=n[o];"Identifier"==i.type?i.name[0]==t.VARIABLE_PREFIX?r.push("`${"+this.traverse_node(i)+"}`"):r.push("'"+i.name+"'"):r.push("`${"+this.traverse_node(i)+"}`")}return r.join(" + ")},e.prototype.traverse_Literal=function(e){return""+e.raw},e}();t.BaseTraverser=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){}return e.unreachable=function(e){throw new Error("Didn't expect to get here")},e}();t.TypeAssert=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=n(291),i=n(56),s=n(23),a=n(50),_=function(){function e(e){this.node=e,this._bg_raycaster=new o.Raycaster}return Object.defineProperty(e.prototype,"screen_quad",{get:function(){return this._screen_quad=this._screen_quad||this._create_screen_quad()},enumerable:!0,configurable:!0}),e.prototype._create_screen_quad=function(){var e=new i.PlaneBufferGeometry(2,2,1,1),t=new s.Mesh(e);return this.node.object.add(t),t},e.prototype.screen_quad_flat_material=function(){return this._screen_quad_flat_material=this._screen_quad_flat_material||new a.MeshBasicMaterial},e.prototype.add_params=function(){},Object.defineProperty(e.prototype,"use_background",{get:function(){return this.node.params.boolean("use_background")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"use_background_material",{get:function(){return this.use_background&&this.node.params.boolean("use_material")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"use_background_color",{get:function(){return this.use_background&&!this.node.params.boolean("use_material")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"background_color",{get:function(){return this.use_background_color?this.node.params.color("background_color"):null},enumerable:!0,configurable:!0}),e.prototype.update_screen_quad=function(){},e.prototype.update=function(){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(e){switch(e.label){case 0:return this.use_background?(this.update_screen_quad(),[4,this.update_background_color()]):[3,4];case 1:return e.sent(),this.use_background_material?[4,this.update_background_material()]:[3,3];case 2:e.sent(),e.label=3;case 3:return[3,5];case 4:this._screen_quad&&this.node.object.remove(this._screen_quad),e.label=5;case 5:return[2]}}))}))},e.prototype.update_background_color=function(){return r.__awaiter(this,void 0,void 0,(function(){var e;return r.__generator(this,(function(t){return(e=this.screen_quad_flat_material()).color=this.node.pv.background_color,this.screen_quad.material=e,[2]}))}))},e.prototype.update_background_material=function(){return r.__awaiter(this,void 0,void 0,(function(){var e,t;return r.__generator(this,(function(n){switch(n.label){case 0:return(e=this.node.p.background_material.found_node())?[4,e.request_container()]:[3,2];case 1:return n.sent(),t=e.material,this.screen_quad.material=t,[3,3];case 2:this.node.states.error.set("bg node not found"),n.label=3;case 3:return[2]}}))}))},e}();t.BaseBackgroundController=_},,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=n(1),i=n(2),s=n(6),a=n(43),_=n(94),u=n(26),c=n(296),p=n(49),l=r.__importDefault(n(206)),d=r.__importDefault(n(45)),h=r.__importDefault(n(21)),f=r.__importDefault(n(41)),m=n(295),y=function(e){function t(t,n){var r=e.call(this,n)||this;return r._object=t,null==r._object.userData.attributes&&(r._object.userData.attributes={}),r}return r.__extends(t,e),t.prototype.object=function(){return this._object},t.prototype.geometry=function(){return this._object.geometry},t.prototype.core_geometry=function(){var e=this.geometry();return new a.CoreGeometry(e)},t.prototype.points=function(){return this.core_geometry().points()},t.prototype.points_from_group=function(e){if(e){var t=p.CoreString.indices(e);if(t){var n=this.points();return t.map((function(e){return n[e]}))}return[]}return this.points()},t.prototype.compute_vertex_normals=function(){this.core_geometry().compute_vertex_normals()},t.prototype.add_attribute=function(e,t){var n;n=f.default(t)||h.default(t)||d.default(t)?t:t.toArray(),this._object.userData.attributes[e]=n},t.prototype.add_numeric_attrib=function(e,t){this.add_attribute(e,t)},t.prototype.set_attrib_value=function(e,t){this.add_attribute(e,t)},t.prototype.add_numeric_vertex_attrib=function(e,t,n){null==n&&(n=_.CoreAttribute.default_value(t)),this.core_geometry().add_numeric_attrib(e,t,n)},t.prototype.attribute_names=function(){return Object.keys(this._object.userData.attributes)},t.prototype.attrib_names=function(){return this.attribute_names()},t.prototype.has_attrib=function(e){return this.attribute_names().includes(e)},t.prototype.rename_attribute=function(e,t){this.add_attribute(t,this.attrib_value(e)),this.delete_attribute(e)},t.prototype.delete_attribute=function(e){delete this._object.userData.attributes[e]},t.prototype.attrib_value=function(e){if("ptnum"===e)return this.index;var t=this._object.userData.attributes[e];return null==t&&"name"==e&&(t=this._object.name),t},t.prototype.name=function(){return this.attrib_value("name")},t.prototype.human_type=function(){return u.CoreConstant.CONSTRUCTOR_NAMES_BY_CONSTRUCTOR_NAME[this._object.constructor.name]},t.prototype.attrib_type=function(e){var t=this.attrib_value(e);return d.default(t)?u.CoreConstant.ATTRIB_TYPE.STRING:u.CoreConstant.ATTRIB_TYPE.NUMERIC},t.prototype.attrib_size=function(e){var t=this.attrib_value(e);if(null==t)return 0;if(d.default(t)||f.default(t))return 1;switch(t.constructor){case i.Vector2:return 2;case o.Vector3:return 3;default:return 0}},t.prototype.clone=function(){return t.clone(this._object)},t.clone=function(e){var n=e.clone(),r=new Map,o=new Map;return t.parallelTraverse(e,n,(function(e,t){r.set(t,e),o.set(e,t)})),n.traverse((function(t){var n=r.get(t),i=t;if(i.geometry){var _=n.geometry;i.geometry=a.CoreGeometry.clone(_);var u=i.geometry;u.userData&&(u.userData=l.default(_.userData))}if(i.material){i.material=n.material,c.CoreMaterial.apply_custom_materials(t,i.material);var p=i.material;null==p.color&&(p.color=new s.Color(1,1,1))}e.userData&&(t.userData=l.default(n.userData));var d=n;d.animations&&(t.animations=d.animations.map((function(e){return e.clone()})));var h=t;if(h.isSkinnedMesh){var f=h,m=n,y=m.skeleton.bones;f.skeleton=m.skeleton.clone(),f.bindMatrix.copy(m.bindMatrix);var v=y.map((function(e){return o.get(e)}));f.skeleton.bones=v,f.bind(f.skeleton,f.bindMatrix)}})),n},t.parallelTraverse=function(e,t,n){n(e,t);for(var r=0;r<e.children.length;r++)this.parallelTraverse(e.children[r],t.children[r],n)},t}(m.CoreEntity);t.CoreObject=y},function(e,t,n){"use strict";n.r(t),n.d(t,"BufferGeometryUtils",(function(){return c}));var r=n(4),o=n(5),i=n(108),s=n(76),a=n(0),_=n(2),u=n(1),c={computeTangents:function(e){var t=e.index,n=e.attributes;if(null!==t&&void 0!==n.position&&void 0!==n.normal&&void 0!==n.uv){var o=t.array,i=n.position.array,s=n.normal.array,a=n.uv.array,c=i.length/3;void 0===n.tangent&&e.setAttribute("tangent",new r.BufferAttribute(new Float32Array(4*c),4));for(var p=n.tangent.array,l=[],d=[],h=0;h<c;h++)l[h]=new u.Vector3,d[h]=new u.Vector3;var f=new u.Vector3,m=new u.Vector3,y=new u.Vector3,v=new _.Vector2,g=new _.Vector2,b=new _.Vector2,O=new u.Vector3,P=new u.Vector3,w=e.groups;0===w.length&&(w=[{start:0,count:o.length}]);h=0;for(var x=w.length;h<x;++h)for(var C=D=(R=w[h]).start,E=D+R.count;C<E;C+=3)I(o[C+0],o[C+1],o[C+2]);var T,j,A,N=new u.Vector3,M=new u.Vector3,k=new u.Vector3,S=new u.Vector3;for(h=0,x=w.length;h<x;++h){var R,D;for(C=D=(R=w[h]).start,E=D+R.count;C<E;C+=3)L(o[C+0]),L(o[C+1]),L(o[C+2])}}else console.warn("THREE.BufferGeometry: Missing required attributes (index, position, normal or uv) in BufferGeometry.computeTangents()");function I(e,t,n){f.fromArray(i,3*e),m.fromArray(i,3*t),y.fromArray(i,3*n),v.fromArray(a,2*e),g.fromArray(a,2*t),b.fromArray(a,2*n),m.sub(f),y.sub(f),g.sub(v),b.sub(v);var r=1/(g.x*b.y-b.x*g.y);isFinite(r)&&(O.copy(m).multiplyScalar(b.y).addScaledVector(y,-g.y).multiplyScalar(r),P.copy(y).multiplyScalar(g.x).addScaledVector(m,-b.x).multiplyScalar(r),l[e].add(O),l[t].add(O),l[n].add(O),d[e].add(P),d[t].add(P),d[n].add(P))}function L(e){k.fromArray(s,3*e),S.copy(k),j=l[e],N.copy(j),N.sub(k.multiplyScalar(k.dot(j))).normalize(),M.crossVectors(S,j),A=M.dot(d[e]),T=A<0?-1:1,p[4*e]=N.x,p[4*e+1]=N.y,p[4*e+2]=N.z,p[4*e+3]=T}},mergeBufferGeometries:function(e,t){for(var n=null!==e[0].index,r=new Set(Object.keys(e[0].attributes)),i=new Set(Object.keys(e[0].morphAttributes)),s={},a={},_=e[0].morphTargetsRelative,u=new o.BufferGeometry,c=0,p=0;p<e.length;++p){var l=e[p];if(n!==(null!==l.index))return null;for(var d in l.attributes){if(!r.has(d))return null;void 0===s[d]&&(s[d]=[]),s[d].push(l.attributes[d])}if(_!==l.morphTargetsRelative)return null;for(var d in l.morphAttributes){if(!i.has(d))return null;void 0===a[d]&&(a[d]=[]),a[d].push(l.morphAttributes[d])}if(u.userData.mergedUserData=u.userData.mergedUserData||[],u.userData.mergedUserData.push(l.userData),t){var h;if(n)h=l.index.count;else{if(void 0===l.attributes.position)return null;h=l.attributes.position.count}u.addGroup(c,h,p),c+=h}}if(n){var f=0,m=[];for(p=0;p<e.length;++p){for(var y=e[p].index,v=0;v<y.count;++v)m.push(y.getX(v)+f);f+=e[p].attributes.position.count}u.setIndex(m)}for(var d in s){var g=this.mergeBufferAttributes(s[d]);if(!g)return null;u.setAttribute(d,g)}for(var d in a){var b=a[d][0].length;if(0===b)break;u.morphAttributes=u.morphAttributes||{},u.morphAttributes[d]=[];for(p=0;p<b;++p){var O=[];for(v=0;v<a[d].length;++v)O.push(a[d][v][p]);var P=this.mergeBufferAttributes(O);if(!P)return null;u.morphAttributes[d].push(P)}}return u},mergeBufferAttributes:function(e){for(var t,n,o,i=0,s=0;s<e.length;++s){var a=e[s];if(a.isInterleavedBufferAttribute)return null;if(void 0===t&&(t=a.array.constructor),t!==a.array.constructor)return null;if(void 0===n&&(n=a.itemSize),n!==a.itemSize)return null;if(void 0===o&&(o=a.normalized),o!==a.normalized)return null;i+=a.array.length}var _=new t(i),u=0;for(s=0;s<e.length;++s)_.set(e[s].array,u),u+=e[s].array.length;return new r.BufferAttribute(_,n,o)},interleaveAttributes:function(e){for(var t,n=0,r=0,o=0,a=e.length;o<a;++o){var _=e[o];if(void 0===t&&(t=_.array.constructor),t!==_.array.constructor)return console.warn("AttributeBuffers of different types cannot be interleaved"),null;n+=_.array.length,r+=_.itemSize}var u=new i.a(new t(n),r),c=0,p=[],l=["getX","getY","getZ","getW"],d=["setX","setY","setZ","setW"],h=0;for(a=e.length;h<a;h++){var f=(_=e[h]).itemSize,m=_.count,y=new s.InterleavedBufferAttribute(u,f,c,_.normalized);p.push(y),c+=f;for(var v=0;v<m;v++)for(var g=0;g<f;g++)y[d[g]](v,_[l[g]](v))}return p},estimateBytesUsed:function(e){var t=0;for(var n in e.attributes){var r=e.getAttribute(n);t+=r.count*r.itemSize*r.array.BYTES_PER_ELEMENT}var o=e.getIndex();return t+=o?o.count*o.itemSize*o.array.BYTES_PER_ELEMENT:0},mergeVertices:function(e,t=1e-4){t=Math.max(t,Number.EPSILON);for(var n={},o=e.getIndex(),i=e.getAttribute("position"),s=o?o.count:i.count,a=0,_=Object.keys(e.attributes),u={},c={},p=[],l=["getX","getY","getZ","getW"],d=0,h=_.length;d<h;d++){u[b=_[d]]=[],(x=e.morphAttributes[b])&&(c[b]=new Array(x.length).fill().map(()=>[]))}var f=Math.log10(1/t),m=Math.pow(10,f);for(d=0;d<s;d++){var y=o?o.getX(d):d,v="",g=0;for(h=_.length;g<h;g++)for(var b=_[g],O=(w=e.getAttribute(b)).itemSize,P=0;P<O;P++)v+=`${~~(w[l[P]](y)*m)},`;if(v in n)p.push(n[v]);else{for(g=0,h=_.length;g<h;g++){b=_[g];var w=e.getAttribute(b),x=e.morphAttributes[b],C=(O=w.itemSize,u[b]),E=c[b];for(P=0;P<O;P++){var T=l[P];if(C.push(w[T](y)),x)for(var j=0,A=x.length;j<A;j++)E[j].push(x[j][T](y))}}n[v]=a,p.push(a),a++}}const N=e.clone();for(d=0,h=_.length;d<h;d++){b=_[d];var M=e.getAttribute(b),k=new M.array.constructor(u[b]);w=new r.BufferAttribute(k,M.itemSize,M.normalized);if(N.setAttribute(b,w),b in c)for(g=0;g<c[b].length;g++){var S=e.morphAttributes[b][g],R=(k=new S.array.constructor(c[b][g]),new r.BufferAttribute(k,S.itemSize,S.normalized));N.morphAttributes[b][g]=R}}return N.setIndex(p),N},toTrianglesDrawMode:function(e,t){if(t===a.TrianglesDrawMode)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),e;if(t===a.TriangleFanDrawMode||t===a.TriangleStripDrawMode){var n=e.getIndex();if(null===n){var r=[],o=e.getAttribute("position");if(void 0===o)return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),e;for(var i=0;i<o.count;i++)r.push(i);e.setIndex(r),n=e.getIndex()}var s=n.count-2,_=[];if(t===a.TriangleFanDrawMode)for(i=1;i<=s;i++)_.push(n.getX(0)),_.push(n.getX(i)),_.push(n.getX(i+1));else for(i=0;i<s;i++)i%2==0?(_.push(n.getX(i)),_.push(n.getX(i+1)),_.push(n.getX(i+2))):(_.push(n.getX(i+2)),_.push(n.getX(i+1)),_.push(n.getX(i)));_.length/3!==s&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");var u=e.clone();return u.setIndex(_),u.clearGroups(),u}return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",t),e}}},,,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(43),o=n(4),i=n(5),s=function(){function e(){}return e.accumulated_curve_point_indices=function(e){for(var t,n=[],r=[],o=null,i=0;i<e.length;i++)if(i%2==1){t=e[i];var s=e[i-1];null==o||s===o?(0===n.length&&n.push(s),n.push(t),o=t):(r.push(n),n=[s,t],o=t)}return r.push(n),r},e.create_line_segment_geometry=function(e,t,n,r){var s=[],a={};n.forEach((function(e){a[e]=[]})),t.forEach((function(t,o){var i=e[t];n.forEach((function(e){var t=i.attrib_value(e);(t=r[e]>1?t.toArray():[t]).forEach((function(t){a[e].push(t)}))})),o>0&&(s.push(o-1),s.push(o))}));var _=new i.BufferGeometry;return n.forEach((function(e){var t=r[e],n=a[e];_.setAttribute(e,new o.Float32BufferAttribute(n,t))})),_.setIndex(s),_},e.line_segment_to_geometries=function(e){var t,n=this,o=[],i=new r.CoreGeometry(e),s=i.attrib_names(),a=i.points(),_=(null===(t=e.getIndex())||void 0===t?void 0:t.array)||[],u=this.accumulated_curve_point_indices(_);if(console.log(_,u),u.length>0){var c=i.attrib_sizes();u.forEach((function(t,r){e=n.create_line_segment_geometry(a,t,s,c),o.push(e)}))}return o},e}();t.CoreGeometryUtilCurve=s},function(e,t){},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=function(e){function t(){return e.call(this)||this}return r.__extends(t,e),t}(n(143).CoreObject);t.default=o},,,,,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=n(515),i=function(){function e(e){this.param=e}return Object.defineProperty(e.prototype,"active",{get:function(){return null!=this._expression},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"expression",{get:function(){return this._expression},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"is_errored",{get:function(){return!!this._manager&&this._manager.is_errored},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"error_message",{get:function(){return this._manager?this._manager.error_message:null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"requires_entities",{get:function(){return this.param.options.is_expression_for_entities},enumerable:!0,configurable:!0}),e.prototype.set_expression=function(e,t){void 0===t&&(t=!0),this._expression!=e&&(this._expression=e,this._expression?(this._manager=this._manager||new o.ExpressionManager(this.param),this._manager.parse_expression(this._expression)):this._manager&&this._manager.reset(),t&&this.param.set_dirty())},e.prototype.update_from_method_dependency_name_change=function(){},e.prototype.compute_expression=function(){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(e){return this._manager&&this.active?[2,this._manager.compute_function()]:[2]}))}))},e.prototype.compute_expression_for_entities=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(n){switch(n.label){case 0:return this.set_entities(e,t),[4,this.compute_expression()];case 1:return n.sent(),this.reset_entities(),[2]}}))}))},e.prototype.compute_expression_for_points=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(n){return this.compute_expression_for_entities(e,t),[2]}))}))},e.prototype.compute_expression_for_objects=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(n){return this.compute_expression_for_entities(e,t),[2]}))}))},Object.defineProperty(e.prototype,"entities",{get:function(){return this._entities},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"entity_callback",{get:function(){return this._entity_callback},enumerable:!0,configurable:!0}),e.prototype.set_entities=function(e,t){this._entities=e,this._entity_callback=t},e.prototype.reset_entities=function(){this._entities=void 0,this._entity_callback=void 0},e}();t.ExpressionController=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=r.__importDefault(n(45)),i=r.__importDefault(n(516));i.default.addUnaryOp("@");i.default.addBinaryOp("**",10);var s=function(){function e(){}return e.prototype.parse_expression=function(e){try{this.reset(),this.node=i.default(e)}catch(n){var t="could not parse the expression '"+e+"' (error: "+n+")";this.error_message=t}},e.prototype.parse_expression_for_string_param=function(t){try{this.reset();for(var n=e.string_value_elements(t),r=[],o=0;o<n.length;o++){var s=n[o],a=void 0;a=o%2==1?i.default(s):{type:"Literal",value:"'"+s+"'",raw:"'"+s+"'"},r.push(a)}this.node={type:"CallExpression",arguments:r,callee:{type:"Identifier",name:"str_concat"}}}catch(e){var _="could not parse the expression '"+t+"' (error: "+e+")";this.error_message=_}},e.string_value_elements=function(e){return null!=e&&o.default(e)?e.split("`"):[]},e.prototype.reset=function(){this.node=void 0,this.error_message=void 0},e}();t.ParsedTree=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(e){return function(t){return Math.pow(t,e)}},o=function(e){return function(t){return 1-Math.abs(Math.pow(t-1,e))}},i=function(e){return function(t){return t<.5?r(e)(2*t)/2:o(e)(2*t-1)/2+.5}};t.Easing={linear:i(1),ease_i:function(e,t){return r(t)(e)},ease_o:function(e,t){return o(t)(e)},ease_io:function(e,t){return i(t)(e)},ease_i2:r(2),ease_o2:o(2),ease_io2:i(2),ease_i3:i(3),ease_o3:i(3),ease_io3:i(3),ease_i4:i(4),ease_o4:i(4),ease_io4:i(4),ease_i_sin:function(e){return 1+Math.sin(Math.PI/2*e-Math.PI/2)},ease_o_sin:function(e){return Math.sin(Math.PI/2*e)},ease_io_sin:function(e){return(1+Math.sin(Math.PI*e-Math.PI/2))/2},ease_i_elastic:function(e){return(.04-.04/e)*Math.sin(25*e)+1},ease_o_elastic:function(e){return.04*e/--e*Math.sin(25*e)},ease_io_elastic:function(e){return(e-=.5)<0?(.02+.01/e)*Math.sin(50*e):(.02-.01/e)*Math.sin(50*e)+1}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=r.__importDefault(n(41)),i=n(208),s=n(25),a=n(49),_=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.type=function(){return s.ParamType.FLOAT},t.prototype.convert=function(e){if(o.default(e))return e;if(a.CoreString.is_number(e)){var t=parseFloat(e);if(o.default(t))return t}return null},t}(i.TypedNumericParam);t.FloatParam=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=r.__importDefault(n(93)),i=n(0),s=n(223),a=n(224),_=n(103),u=n(540),c=n(25),p=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.type=function(){return c.ParamType.RAMP},t.prototype.initialize_param=function(){this.add_post_dirty_hook(this._reset_ramp_interpolant_and_texture.bind(this))},t.prototype.accepts_visitor=function(e){return e.visit_ramp_param(this)},Object.defineProperty(t.prototype,"is_default",{get:function(){return this.value.is_equal(this.default_value)},enumerable:!0,configurable:!0}),t.prototype.has_expression=function(){return!1},t.prototype._reset_ramp_interpolant_and_texture=function(){this._ramp_interpolant=void 0,this._ramp_texture=void 0},t.prototype.ramp_texture=function(){return this._ramp_texture=this._ramp_texture||this._create_ramp_texture()},t.prototype._create_ramp_texture=function(){for(var e=new Uint8Array(3072),t=0,n=0,r=0,o=0;o<1024;o++)t=3*o,n=o/1024,r=this.value_at_position(n),e[t]=255*r;var a=new s.DataTexture(e,1024,1,i.RGBFormat);return a.needsUpdate=!0,a},t.create_interpolant=function(e,t){var n=new Float32Array(1);return new a.CubicInterpolant(e,t,1,n)},t.prototype.interpolant=function(){return this._ramp_interpolant=this._ramp_interpolant||this._create_interpolant()},t.prototype._create_interpolant=function(){for(var e=this.value.points(),n=o.default(e,(function(e){return e.position()})),r=new Float32Array(n.length),i=new Float32Array(n.length),s=0,a=0,_=n;a<_.length;a++){var u=_[a];r[s]=u.position(),i[s]=u.value,s++}return t.create_interpolant(r,i)},t.prototype.value_at_position=function(e){return this.interpolant().evaluate(e)[0]},t.DEFAULT_VALUE=new u.RampValue("linear",[new u.RampPoint(0,0),new u.RampPoint(1,1)]),t}(_.Single);t.RampParam=p},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CATEGORY_OBJ={LIGHT:"lights",MANAGER:"managers",GEOMETRY:"geometries",CAMERA:"cameras",MISC:"misc"},t.CATEGORY_COP={INPUT:"inputs",ADVANCED:"advanced"},t.CATEGORY_EVENT={CAMERA:"cameras",MISC:"misc"},t.CATEGORY_GL={COLOR:"color",CONVERSION:"conversion",DYNAMICS:"dynamics",GEOMETRY:"geometry",GLOBALS:"globals",MATH:"math",QUAT:"quat",TRIGO:"trigo",UTIL:"util",INSTANCE:"instance"},t.CATEGORY_MAT={ADVANCED:"advanced",MESH:"meshes",POINT:"points",LINE:"lines",VOLUME:"volumes",INSTANCE:"instances"},t.CATEGORY_POST={PASS:"passes"},t.CATEGORY_SOP={ANIMATION:"animation",ATTRIBUTE:"attributes",DYNAMICS:"dynamics",INPUT:"inputs",MISC:"misc",MODIFIER:"modifiers",RENDER:"render"}},function(e,t,n){"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.CHANGE="change",e.MOVEEND="moveend"}(r||(r={}));var o=function(){function e(e){this._callback=e,this._update_always=!0,this._listener_added=!1,this._listener=this._execute_callback.bind(this)}return e.prototype.remove_target=function(){this.set_target(void 0)},e.prototype.set_target=function(e){e||this._remove_camera_event();var t=this._target;this._target=e,null!=this._target&&this._execute_callback(),(null!=this._target?this._target.uuid:void 0)!==(null!=t?t.uuid:void 0)&&this._add_camera_event()},e.prototype.set_update_always=function(e){this._remove_camera_event(),this._update_always=e,this._add_camera_event()},e.prototype._current_event_name=function(){return this._update_always?r.CHANGE:r.MOVEEND},e.prototype._add_camera_event=function(){this._listener_added||null!=this._target&&(this._target.addEventListener(this._current_event_name(),this._listener),this._listener_added=!0)},e.prototype._remove_camera_event=function(){!0===this._listener_added&&null!=this._target&&(this._target.removeEventListener(this._current_event_name(),this._listener),this._listener_added=!1)},e.prototype._execute_callback=function(){null!=this._target&&this._callback(this._target)},e}();t.CameraController=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this.node=e,this._state=!0,this._hooks=null}return e.prototype.add_hook=function(e){this._hooks=this._hooks||[],this._hooks.push(e)},e.prototype.on_update=function(){},e.prototype.set=function(e){this._state!=e&&(this._state=e,this.on_update(),this.run_hooks())},Object.defineProperty(e.prototype,"active",{get:function(){return this._state},enumerable:!0,configurable:!0}),e.prototype.toggle=function(){this.set(!this._state)},e.prototype.run_hooks=function(){if(this._hooks)for(var e=0,t=this._hooks;e<t.length;e++){(0,t[e])()}},e}();t.BaseFlag=r},,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=r.__importDefault(n(117)),i=n(65),s=n(83),a=n(583),_=n(590),u=n(591),c=n(290),p=n(212),l=n(25),d=n(42),h={type:"change"};t.BASE_CAMERA_DEFAULT={near:1,far:100};var f=n(9),m=n(120),y=function(e){function n(){var n=null!==e&&e.apply(this,arguments)||this;return n.controls=f.ParamConfig.OPERATOR_PATH("",{node_selection:{context:d.NodeContext.EVENT}}),n.t=f.ParamConfig.VECTOR3([0,0,0]),n.r=f.ParamConfig.VECTOR3([0,0,0]),n.s=f.ParamConfig.VECTOR3([1,1,1]),n.scale=f.ParamConfig.FLOAT(1),n.target=f.ParamConfig.VECTOR3([0,0,0],{cook:!1}),n.near=f.ParamConfig.FLOAT(t.BASE_CAMERA_DEFAULT.near,{range:[0,100]}),n.far=f.ParamConfig.FLOAT(t.BASE_CAMERA_DEFAULT.far,{range:[0,100]}),n.aspect=f.ParamConfig.FLOAT(1),n.lock_width=f.ParamConfig.BOOLEAN(1),n.look_at=f.ParamConfig.OPERATOR_PATH(""),n.use_background=f.ParamConfig.BOOLEAN(0),n.use_material=f.ParamConfig.BOOLEAN(0,{visible_if:{use_background:!0}}),n.background_color=f.ParamConfig.COLOR([0,0,0],{visible_if:{use_background:!0,use_material:!1}}),n.background_material=f.ParamConfig.OPERATOR_PATH("",{visible_if:{use_background:!0,use_material:!0},node_selection:{context:d.NodeContext.MAT},dependent_on_found_node:!1}),n.background_ratio=f.ParamConfig.FLOAT(1,{visible_if:{use_background:!0,use_material:!0}}),n}return r.__extends(n,e),n}(f.NodeParamsConfig);t.BaseCameraObjParamsConfig=y;var v=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.flags=new m.FlagsControllerD(t),t.render_order=s.ObjNodeRenderOrder.CAMERA,t._aspect=-1,t._used_in_scene=!0,t}return r.__extends(t,e),Object.defineProperty(t.prototype,"object",{get:function(){return this._object},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"background_controller",{get:function(){return this._background_controller=this._background_controller||new this.background_controller_constructor(this)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"background_controller_constructor",{get:function(){return p.BaseBackgroundController},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"controls_controller",{get:function(){return this._controls_controller=this._controls_controller||new a.ControlsController(this)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"layers_controller",{get:function(){return this._layers_controller=this._layers_controller||new _.LayersController(this)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"post_process_controller",{get:function(){return this._post_process_controller=this._post_process_controller||new u.PostProcessController(this)},enumerable:!0,configurable:!0}),t.prototype.initialize_node=function(){var e=this;this.io.inputs.set_count_to_one_max(),this.flags.display.add_hook((function(){e.set_used_in_scene(e.flags.display.active||!1)}))},t.prototype.create_common_params=function(){this.layers_controller.add_params(),this.post_process_controller.add_params()},t.prototype.create_player_camera_params=function(){this.add_param(l.ParamType.BUTTON,"set_master_camera",null,{callback:this.set_as_master_camera.bind(this)})},t.prototype.cook=function(){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(e){switch(e.label){case 0:return this.transform_controller.update(),this.layers_controller.update(),[4,this.background_controller.update()];case 1:return e.sent(),this._object.near==this.pv.near&&this._object.far==this.pv.far||(this._object.near=this.pv.near,this._object.far=this.pv.far,this._object.updateProjectionMatrix()),[4,this.post_process_controller.update_composer_passes()];case 2:return e.sent(),this.update_camera(),this.controls_controller.update_controls(),this._object.dispatchEvent(h),this.cook_controller.end_cook(),[2]}}))}))},t.prototype.on_create=function(){},t.prototype.on_delete=function(){},t.prototype.camera=function(){return this._object},t.prototype.update_camera=function(){},t.prototype.set_as_master_camera=function(){this.scene.cameras_controller.set_master_camera_node_path(this.full_path())},t.prototype.setup_for_aspect_ratio=function(e){o.default(e)||e&&this._aspect!=e&&(this._aspect=e,this._update_for_aspect_ratio())},t.prototype._update_for_aspect_ratio=function(){},t.prototype.update_transform_params_from_object=function(){i.CoreTransform.set_params_from_object(this._object,this)},t.prototype.viewer=function(e){return new c.ThreejsViewer(e,this.scene,this)},t}(s.TypedObjNode);t.TypedCameraObjNode=v;var g=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t}(v);t.BaseCameraObjNodeClass=g},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=n(593);n(142);var i=function(e){function t(t,n,r){var o=e.call(this,t,n,r)||this;return o._scene=n,o.do_render=!0,o._animate_method=o.animate.bind(o),o._canvas=document.createElement("canvas"),o._canvas.id=("canvas_id_"+Math.random()).replace(".","_"),o._container.appendChild(o._canvas),o._container.classList.add("CoreThreejsViewer"),o._set_events(),o}return r.__extends(t,e),t.prototype._build=function(){this._init_display(),this.activate()},t.prototype.dispose=function(){this._cancel_animate(),this.controls_controller.dispose_controls()},t.prototype._set_events=function(){this.events_controller.init(),this.webgl_controller.init(),POLY.player_mode()&&(window.onresize=this.cameras_controller.on_resize.bind(this))},t.prototype._init_display=function(){var e;this.cameras_controller.compute_size_and_aspect();var t=this.cameras_controller.size;null===(e=this.cameras_controller.camera_node)||void 0===e||e.post_process_controller.create_renderer(this._canvas,t),this.cameras_controller.prepare_current_camera(),this.animate()},t.prototype.animate=function(){this.do_render&&(this.render(),this._request_animation_frame_id=requestAnimationFrame(this._animate_method))},t.prototype._cancel_animate=function(){var e;this.do_render=!1,this._request_animation_frame_id&&cancelAnimationFrame(this._request_animation_frame_id),null===(e=this.cameras_controller.camera_node)||void 0===e||e.post_process_controller.delete_renderer(this._canvas)},t.prototype.render=function(){if(this.cameras_controller.camera_node){var e=this.cameras_controller.size,t=this.cameras_controller.aspect;this.cameras_controller.camera_node.post_process_controller.render(this._canvas,e,t)}else console.warn("no camera to render with")},t}(o.BaseViewer);t.ThreejsViewer=i},,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=r.__importDefault(n(102)),i=r.__importDefault(n(91)),s=r.__importDefault(n(117)),a=r.__importDefault(n(203)),_=r.__importDefault(n(74)),u=r.__importDefault(n(148)),c=n(1),p=n(36),l=n(44),d=n(214),h=n(43),f=n(94),m=n(49),y=n(26),v=function(){function e(){this.touch()}return e.prototype.timestamp=function(){return this._timestamp},e.prototype.touch=function(){this._timestamp=performance.now(),this.reset()},e.prototype.reset=function(){this._bounding_box=void 0,this._core_geometries=void 0,this._core_objects=void 0},e.prototype.clone=function(){var t=new e;if(this._objects){for(var n=[],r=0,o=this._objects;r<o.length;r++){var i=o[r];n.push(d.CoreObject.clone(i))}t.set_objects(n)}return t},e.prototype.set_objects=function(e){this._objects=e,this.touch()},e.prototype.objects=function(){return this._objects},e.prototype.core_objects=function(){return this._core_objects=this._core_objects||this._create_core_objects()},e.prototype._create_core_objects=function(){var e=[];if(this._objects)for(var t=function(t){n._objects[t].traverse((function(n){var r=new d.CoreObject(n,t);e.push(r)}))},n=this,r=0;r<this._objects.length;r++)t(r);return e},e.prototype.geometries=function(){for(var e=[],t=0,n=this.core_objects();t<n.length;t++){var r=n[t].object().geometry;r&&e.push(r)}return e},e.prototype.core_geometries=function(){return this._core_geometries=this._core_geometries||this.create_core_geometries()},e.prototype.create_core_geometries=function(){for(var e=[],t=0,n=this.geometries();t<n.length;t++){var r=n[t];e.push(new h.CoreGeometry(r))}return e},e.prototype.__geometry_from_object=function(e,t){if(t.geometry)return e.push(t.geometry)},e.geometry_from_object=function(e){return e.isMesh||e.isLine||e.isPoints?e.geometry:null},e.prototype.faces=function(){return _.default(this.core_geometries().map((function(e){return e.faces()})))},e.prototype.points=function(){return _.default(this.core_geometries().map((function(e){return e.points()})))},e.prototype.points_count=function(){return u.default(this.core_geometries().map((function(e){return e.points_count()})))},e.prototype.points_from_group=function(e){if(e){var t=m.CoreString.indices(e),n=this.points();return t.map((function(e){return n[e]}))}return this.points()},e.from_objects=function(t){var n=new e;return n.set_objects(t),n},e.prototype.objects_from_group=function(e){return this.core_objects_from_group(e).map((function(e){return e.object()}))},e.prototype.core_objects_from_group=function(e){if(""!==(e=a.default(e))){var t=parseInt(e);return s.default(t)?this.core_objects().filter((function(t){return m.CoreString.match_mask(e,t.name())})):i.default([this.core_objects()[t]])}return this.core_objects()},e.prototype.bounding_box=function(){return this._bounding_box=this._bounding_box||this._compute_bounding_box()},e.prototype.center=function(){var e=new c.Vector3;return this.bounding_box().getCenter(e),e},e.prototype.size=function(){var e=new c.Vector3;return this.bounding_box().getSize(e),e},e.prototype._compute_bounding_box=function(){var e=new l.Box3;if(this._objects)for(var t=0,n=this._objects;t<n.length;t++){var r=n[t];e.expandByObject(r)}return e},e.prototype.compute_vertex_normals=function(){for(var e=0,t=this.core_objects();e<t.length;e++){t[e].compute_vertex_normals()}},e.prototype.has_attrib=function(e){var t;return null!=(t=this.core_geometries()[0])&&t.has_attrib(e)},e.prototype.attrib_type=function(e){var t=this.core_geometries()[0];return null!=t?t.attrib_type(e):null},e.prototype.rename_attrib=function(t,n,r){switch(r){case y.CoreConstant.ATTRIB_CLASS.VERTEX:if(this.has_attrib(t)&&this._objects)for(var o=0,i=this._objects;o<i.length;o++){i[o].traverse((function(r){var o=e.geometry_from_object(r);o&&new h.CoreGeometry(o).rename_attribute(t,n)}))}break;case y.CoreConstant.ATTRIB_CLASS.OBJECT:if(this.has_attrib(t)&&this._objects)for(var s=0,a=this._objects;s<a.length;s++){a[s].traverse((function(e){new d.CoreObject(e,0).rename_attribute(t,n)}))}}},e.prototype.attrib_names=function(){var e;return null!=(e=this.core_geometries()[0])?e.attrib_names():[]},e.prototype.object_attrib_names=function(){var e;return null!=(e=this.core_objects()[0])?e.attrib_names():[]},e.prototype.attrib_names_matching_mask=function(e){for(var t=m.CoreString.attrib_names(e),n=[],r=0,i=this.attrib_names();r<i.length;r++)for(var s=i[r],a=0,_=t;a<_.length;a++){var u=_[a];m.CoreString.match_mask(s,u)&&n.push(s)}return o.default(n)},e.prototype.attrib_sizes=function(){var e;return null!=(e=this.core_geometries()[0])?e.attrib_sizes():{}},e.prototype.attrib_size=function(e){var t;return null!=(t=this.core_geometries()[0])?t.attrib_size(e):0},e.prototype.add_numeric_vertex_attrib=function(e,t,n){null==n&&(n=f.CoreAttribute.default_value(t));for(var r=0,o=this.core_geometries();r<o.length;r++){o[r].add_numeric_attrib(e,t,n)}},e.prototype.add_numeric_object_attrib=function(e,t,n){null==n&&(n=f.CoreAttribute.default_value(t));for(var r=0,o=this.core_objects();r<o.length;r++){o[r].add_numeric_attrib(e,n)}},e.clone=function(e){var t=new p.Group;return e.children.forEach((function(e){var n=d.CoreObject.clone(e);t.add(n)})),t},e}();t.CoreGroup=v},,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,o=n(3),i=n(17),s=n(1),a=n(2),_=n(94),u=n(295),c="position",p="normal";!function(e){e.x="x",e.y="y",e.z="z",e.w="w",e.r="r",e.g="g",e.b="b"}(r||(r={}));var l={x:0,y:1,z:2,w:3,r:0,g:1,b:2},d=function(e){function t(t,n){var r=e.call(this,n)||this;return r._core_geometry=t,r._geometry=r._core_geometry.geometry(),r}return o.__extends(t,e),t.prototype.geometry_wrapper=function(){return this._core_geometry},t.prototype.geometry=function(){return this._geometry=this._geometry||this._core_geometry.geometry()},t.prototype.attrib_size=function(e){return e=_.CoreAttribute.remap_name(e),this._geometry.getAttribute(e).itemSize},t.prototype.has_attrib=function(e){var t=_.CoreAttribute.remap_name(e);return this._core_geometry.has_attrib(t)},t.prototype.attrib_value=function(e){if("ptnum"===e)return this.index;var t=null,n=null;"."===e[e.length-2]&&(t=e[e.length-1],n=l[t],e=e.substring(0,e.length-2));var r=_.CoreAttribute.remap_name(e),o=this._geometry.getAttribute(r);if(!o){var u="attrib "+e+" not found. availables are: "+Object.keys(this._geometry.attributes||{}).join(",");throw console.warn(u),u}var c=o.array;if(this._core_geometry.is_attrib_indexed(r)){var p=this.attrib_value_index(r);return this._core_geometry.user_data_attrib(r)[p]}var d=o.itemSize,h=this._index*d;if(null==n)switch(d){case 1:return c[h];case 2:return new a.Vector2(c[h+0],c[h+1]);case 3:return new s.Vector3(c[h+0],c[h+1],c[h+2]);case 4:return new i.Vector4(c[h+0],c[h+1],c[h+2],c[h+3]);default:throw"size not valid ("+d+")"}else switch(d){case 1:return c[h];default:return c[h+n]}},t.prototype.attrib_value_index=function(e){return this._core_geometry.is_attrib_indexed(e)?this._geometry.getAttribute(e).array[this._index]:-1},t.prototype.position=function(){var e=this._geometry.getAttribute(c).array;return this._position=this._position||new s.Vector3,this._position.fromArray(e,3*this._index)},t.prototype.set_position=function(e){this.set_attrib_value_vector3(c,e)},t.prototype.normal=function(){var e=this._geometry.getAttribute(p).array;return this._normal=this._normal||new s.Vector3,this._normal.fromArray(e,3*this._index)},t.prototype.set_normal=function(e){return this.set_attrib_value_vector3(p,e)},t.prototype.set_attrib_value=function(e,t){if(null!=t){if(null==e)throw"Point.set_attrib_value requires a name";var n=this._geometry.getAttribute(e),r=n.array,o=n.itemSize;switch(o){case 1:r[this._index]=t;break;case 2:var i=t;r[2*this._index+0]=i.x,r[2*this._index+1]=i.y;break;case 3:if(null!=t.r){var s=t;r[3*this._index+0]=s.r,r[3*this._index+1]=s.g,r[3*this._index+2]=s.b}else{var a=t;r[3*this._index+0]=a.x,r[3*this._index+1]=a.y,r[3*this._index+2]=a.z}break;default:throw console.warn("Point.set_attrib_value does not yet allow attrib size "+o),"attrib size "+o+" not implemented"}}},t.prototype.set_attrib_value_vector3=function(e,t){if(null!=t){if(null==e)throw"Point.set_attrib_value requires a name";var n=this._geometry.getAttribute(e).array,r=3*this._index;n[r]=t.x,n[r+1]=t.y,n[r+2]=t.z}},t.prototype.set_attrib_index=function(e,t){return this._geometry.getAttribute(e).array[this._index]=t},t}(u.CoreEntity);t.CorePoint=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this._index=e}return Object.defineProperty(e.prototype,"index",{get:function(){return this._index},enumerable:!0,configurable:!0}),e}();t.CoreEntity=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,o=n(3).__importDefault(n(21));!function(e){e.customDistanceMaterial="customDistanceMaterial",e.customDepthMaterial="customDepthMaterial",e.customDepthDOFMaterial="customDepthDOFMaterial"}(r||(r={}));var i=function(){function e(){}return e.node=function(e,t){return e.node(t.name)},e.clone=function(e){var t=this;return o.default(e)?e.map((function(e){return t.clone_single(e)})):this.clone_single(e)},e.clone_single=function(e){var t=e.clone();return t.linewidth=e.linewidth,t},e.apply_custom_materials=function(e,t){if(t.custom_materials)for(var n=0,r=Object.keys(t.custom_materials);n<r.length;n++){var o=r[n],i=t.custom_materials[o];e[o]=i,i.needsUpdate=!0}},e.assign_custom_uniforms=function(e,t,n){if(e.custom_materials)for(var r=0,o=Object.keys(e.custom_materials);r<o.length;r++){var i=o[r];e.custom_materials[i].uniforms[t].value=n}},e.init_custom_material_uniforms=function(e,t,n){if(e.custom_materials)for(var r=0,o=Object.keys(e.custom_materials);r<o.length;r++){var i=o[r],s=e.custom_materials[i];s.uniforms[t]=s.uniforms[t]||n}},e}();t.CoreMaterial=i},,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=function(){function e(e){void 0===e&&(e={}),this._array_index=0,this._count=0,this._current_count_index=0,this._resolve=null,this._max_time_per_chunk=e.max_time_per_chunk||10,this._check_every_interations=e.check_every_interations||100}return e.prototype.start_with_count=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var n=this;return r.__generator(this,(function(r){if(this._count=e,this._current_count_index=0,this._iteratee_method_count=t,this._bound_next_with_count=this.next_with_count.bind(this),this._resolve)throw"an iterator cannot be started twice";return[2,new Promise((function(e,t){n._resolve=e,n.next_with_count()}))]}))}))},e.prototype.next_with_count=function(){var e=performance.now();if(this._iteratee_method_count&&this._bound_next_with_count)for(;this._current_count_index<this._count;)if(this._iteratee_method_count(this._current_count_index),this._current_count_index++,this._current_count_index%this._check_every_interations==0&&performance.now()-e>this._max_time_per_chunk){setTimeout(this._bound_next_with_count,1);break}this._current_count_index>=this._count&&this._resolve&&this._resolve()},e.prototype.start_with_array=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var n=this;return r.__generator(this,(function(r){if(this._array=e,this._array_index=0,this._iteratee_method_array=t,this._bound_next_with_array=this.next_with_array.bind(this),this._resolve)throw"an iterator cannot be started twice";return[2,new Promise((function(e,t){n._resolve=e,n.next_with_array()}))]}))}))},e.prototype.next_with_array=function(){var e=performance.now();if(this._iteratee_method_array&&this._bound_next_with_array&&this._array)for(;this._current_array_element=this._array[this._array_index];)if(this._iteratee_method_array(this._current_array_element,this._array_index),this._array_index++,this._array_index%this._check_every_interations==0&&performance.now()-e>this._max_time_per_chunk){setTimeout(this._bound_next_with_array,1);break}void 0===this._current_array_element&&this._resolve&&this._resolve()},e}();t.CoreIterator=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(104),o=n(2),i=n(4),s=n(5),a=function(){function e(){}return e.positions=function(e,t,n){void 0===n&&(n=360);for(var i=r.CoreMath.degrees_to_radians(n)/t,s=[],a=0;a<t;a++){var _=i*a,u=e*Math.cos(_),c=e*Math.sin(_);s.push(new o.Vector2(u,c))}return s},e.create=function(e,t,n){void 0===n&&(n=360);for(var r,o=this.positions(e,t,n),a=[],_=[],u=0;u<o.length;u++)r=o[u],a.push(r.x),a.push(r.y),a.push(0),u>0&&(_.push(u-1),_.push(u));_.push(t-1),_.push(0);var c=new s.BufferGeometry;return c.setAttribute("position",new i.Float32BufferAttribute(a,3)),c.setIndex(_),c},e}();t.CoreGeometryUtilCircle=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=r.__importDefault(n(21)),i=r.__importDefault(n(63)),s=r.__importDefault(n(45)),a=r.__importDefault(n(74)),_=n(75),u=n(4),c={BufferGeometry:n(5).BufferGeometry,Float32BufferAttribute:u.Float32BufferAttribute,Points:_.Points},p=r.__importDefault(n(301)),l=n(49),d=n(43),h=n(26),f=n(651),m=n(94),y=function(){function e(e){void 0===e&&(e={}),this._attribute_datas_by_name={},this._options={},this._options.data_keys_prefix=e.data_keys_prefix,this._options.skip_entries=e.skip_entries,this._options.do_convert=e.do_convert||!1,this._options.convert_to_numeric=e.convert_to_numeric}return e.prototype.load=function(e,t,n,r){var o=this;p.default.get(e).then((function(e){o._json=e.data,null!=o._options.data_keys_prefix&&""!=o._options.data_keys_prefix&&(o._json=o.get_prefixed_json(o._json,o._options.data_keys_prefix.split(".")));var n=o.create_object();t(n)})).catch((function(e){console.log("error",e),r(e)}))},e.prototype.get_prefixed_json=function(e,t){if(0==t.length)return e;var n=t.shift();return n?this.get_prefixed_json(e[n],t):[]},e.prototype.set_json=function(e){return this._json=e},e.prototype.create_object=function(){var e=new c.BufferGeometry,t=new d.CoreGeometry(e);if(null!=this._json){var n=this._json.length;t.init_position_attribute(n),this._find_attributes();for(var r=l.CoreString.attrib_names(this._options.convert_to_numeric||""),o=0,i=Object.keys(this._attribute_datas_by_name);o<i.length;o++){var _=i[o],u=a.default(this._attribute_values_for_name(_)),p=this._attribute_datas_by_name[_],f=p.size();if(p.type()===h.CoreConstant.ATTRIB_TYPE.STRING)if(this._options.do_convert&&l.CoreString.matches_one_mask(_,r)){var y=u.map((function(e){return s.default(e)?parseFloat(e)||0:e}));e.setAttribute(_,new c.Float32BufferAttribute(y,f))}else{var v=m.CoreAttribute.array_to_indexed_arrays(u);t.set_indexed_attribute(_,v.values,v.indices)}else{y=u;e.setAttribute(_,new c.Float32BufferAttribute(y,f))}}}return new c.Points(e,h.CoreConstant.MATERIALS[c.Points.name])},e.prototype._find_attributes=function(){var e,t=l.CoreString.attrib_names(this._options.skip_entries||"");if(this._json&&null!=(e=this._json[0]))for(var n=0,r=Object.keys(e);n<r.length;n++){var o=r[n],i=e[o];if(this._value_has_subentries(i))for(var s=0,a=Object.keys(i);s<a.length;s++){var _=[o,a[s]].join(":"),u=i[o];l.CoreString.matches_one_mask(_,t)||(this._attribute_datas_by_name[_]=f.CoreAttributeData.from_value(u))}else l.CoreString.matches_one_mask(o,t)||(this._attribute_datas_by_name[o]=f.CoreAttributeData.from_value(i))}},e.prototype._attribute_values_for_name=function(e){var t=this;return this._json?this._json.map((function(n){var r=e.split(":")[0],o=n[r];return t._value_has_subentries(o)?o[e.substring(r.length+1)]||0:o||0})):[]},e.prototype._value_has_subentries=function(e){return i.default(e)&&!o.default(e)},e}();t.JsonDataLoader=y},,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=n(4),i=n(43),s=r.__importDefault(n(74)),a=r.__importDefault(n(770)),_=r.__importDefault(n(271)),u=function(){function e(e,t,n){this.geometry=e,this.geometry1=t,this.geometry0=n}return e.prototype.process=function(){var e=this,t=new i.CoreGeometry(this.geometry0),n=new i.CoreGeometry(this.geometry1),r=t.segments(),u=n.segments();if(0!==r.length&&0!==u.length){var c=r.length<u.length?[t,n]:[n,t],p=c[0],l=c[1],d=p.segments(),h=l.segments(),f=p.points(),m=l.points(),y=f.length,v=_.default(f,m),g=[];d.forEach((function(e,t){var n=h[t];g.push(e[0]),g.push(e[1]),g.push(n[0]+y),g.push(e[1]),g.push(n[1]+y),g.push(n[0]+y)})),a.default(p.attrib_names(),l.attrib_names()).forEach((function(t){var n=p.attrib_size(t),r=v.map((function(e){return e.attrib_value(t)}));n>1&&(r=s.default(r.map((function(e){return e.toArray()})))),e.geometry.setAttribute(t,new o.Float32BufferAttribute(r,n))})),this.geometry.setIndex(g),this.geometry.computeVertexNormals()}},e}();t.CoreGeometryOperationSkin=u},,,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(336);n(565);var o=n(290),i=new r.PolyScene;i.root.create_node("ambient_light"),i.loading_controller.mark_as_loaded();var s=i.root.create_node("perspective_camera");s.p.t.z.set(5);var a=i.root.create_node("geo");a.flags.display.set(!0),a.create_node("box").flags.display.set(!0),a.p.r.y.set("$F+20");var _=document.createElement("style");_.innerText="html, body, canvas, .canvas_container {height: 100%; margin: 0px;} canvas {display: block;}",document.body.appendChild(_);var u=document.createElement("div");u.classList.add("canvas_container"),document.body.appendChild(u),new o.ThreejsViewer(u,i,s),i.play()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=n(337),i=n(338),s=n(339),a=n(454),_=n(455),u=n(458),c=n(459),p=n(460),l=n(462),d=n(558),h=n(560),f=n(562),m=n(563),y=n(564),v=n(84),g=function(){function e(){this._display_scene=new v.Scene,this._cameras_controller=new o.CamerasController(this),this._cooker=new i.Cooker,this.cook_controller=new a.CookController,this._graph=new s.CoreGraph,this._missing_expression_references_controller=new p.MissingReferencesController,this._nodes_controller=new l.NodesController(this),this._time_controller=new h.TimeController(this),this._graph.set_scene(this),this.nodes_controller.init()}return Object.defineProperty(e.prototype,"display_scene",{get:function(){return this._display_scene},enumerable:!0,configurable:!0}),e.prototype.set_uuid=function(e){return this._uuid=e},Object.defineProperty(e.prototype,"uuid",{get:function(){return this._uuid},enumerable:!0,configurable:!0}),e.prototype.set_name=function(e){return this._name=e},Object.defineProperty(e.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cameras_controller",{get:function(){return this._cameras_controller},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cooker",{get:function(){return this._cooker},enumerable:!0,configurable:!0}),e.prototype.wait_for_cooks_completed=function(){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(e){return[2,this.cook_controller.wait_for_cooks_completed()]}))}))},Object.defineProperty(e.prototype,"events_controller",{get:function(){return this._events_controller=this._events_controller||new _.EventsController(this)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"graph",{get:function(){return this._graph},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"lifecycle_controller",{get:function(){return this._lifecycle_controller=this._lifecycle_controller||new u.LifeCycleController(this)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"loading_controller",{get:function(){return this._loading_controller=this._loading_controller||new c.LoadingController(this)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"missing_expression_references_controller",{get:function(){return this._missing_expression_references_controller},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"nodes_controller",{get:function(){return this._nodes_controller},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"performance",{get:function(){return this._performance=this._performance||new d.CorePerformance},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"time_controller",{get:function(){return this._time_controller},enumerable:!0,configurable:!0}),e.prototype.set_frame=function(e){this.time_controller.set_frame(e)},Object.defineProperty(e.prototype,"frame",{get:function(){return this.time_controller.frame},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"frame_range",{get:function(){return this.time_controller.frame_range},enumerable:!0,configurable:!0}),e.prototype.play=function(){this.time_controller.play()},e.prototype.pause=function(){this.time_controller.pause()},Object.defineProperty(e.prototype,"serializer",{get:function(){return this._serializer=this._serializer||new f.Serializer(this)},enumerable:!0,configurable:!0}),e.prototype.to_json=function(){return this.serializer.to_json()},Object.defineProperty(e.prototype,"uniforms_controller",{get:function(){return this._uniforms_controller=this._uniforms_controller||new m.UniformsController(this)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"webgl_controller",{get:function(){return this._webgl_controller=this._webgl_controller||new y.WebGLController},enumerable:!0,configurable:!0}),e.prototype.batch_update=function(e){this._cooker.block(),e(),this._cooker.unblock()},e.prototype.node=function(e){return this.nodes_controller.node(e)},Object.defineProperty(e.prototype,"root",{get:function(){return this.nodes_controller.root},enumerable:!0,configurable:!0}),e}();t.PolyScene=g},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this.scene=e,this._master_camera_node_path=null}return e.prototype.set_master_camera_node_path=function(e){this._master_camera_node_path=e},Object.defineProperty(e.prototype,"master_camera_node_path",{get:function(){return this._master_camera_node_path},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"master_camera_node",{get:function(){return this.master_camera_node_path?this.scene.node(this.master_camera_node_path):(console.warn("master camera node not found"),this._find_any_camera())},enumerable:!0,configurable:!0}),e.prototype._find_any_camera=function(){var e=this.scene.root;return e.nodes_by_type("perspective_camera")[0]||e.nodes_by_type("orthographic_camera")[0]},e}();t.CamerasController=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){this._queue={},this._block_level=0,this._queue={},this._block_level=0}return e.prototype.block=function(){this._block_level+=1},e.prototype.unblock=function(){this._block_level-=1,this.process_queue()},Object.defineProperty(e.prototype,"blocked",{get:function(){return this._block_level>0},enumerable:!0,configurable:!0}),e.prototype.enqueue=function(e){this._queue[e.graph_node_id]=e},e.prototype.process_queue=function(){if(!this.blocked)for(var e,t=0,n=Object.keys(this._queue);t<n.length;t++){var r=n[t];(e=this._queue[r])&&(delete this._queue[r],e.dirty_controller.run_post_dirty_hooks())}},e}();t.Cooker=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(340),o=function(){function e(){this._next_id=0,this._graph=new r.Graph({directed:!0,compound:!1,multigraph:!0})}return e.prototype.graph=function(){return this._graph},e.prototype.set_scene=function(e){this._scene=e},e.prototype.scene=function(){return this._scene},e.prototype.next_id=function(){return""+(this._next_id+=1)},e.prototype.setNode=function(e){this._graph.setNode(e.graph_node_id,e)},e.prototype.removeNode=function(e){this._graph.removeNode(e.graph_node_id)},e.prototype.nodes_from_ids=function(e){for(var t=[],n=0,r=e;n<r.length;n++){var o=r[n],i=this.node_from_id(o);i&&t.push(i)}return t},e.prototype.node_from_id=function(e){return this._graph.node(e)},e.prototype.connect=function(e,t){var n=e.graph_node_id,o=t.graph_node_id;if(this._graph.hasNode(n)&&this._graph.hasNode(o)){this._graph.setEdge(n,o);var i=!1;return!(!this._scene||this._scene.loading_controller.is_loading)&&(i=!r.alg.isAcyclic(this._graph)),i?(this._graph.removeEdge(n,o),!1):(e.dirty_controller.clear_successors_cache_with_predecessors(),!0)}return console.warn("attempt to connect non existing node "+n+" or "+o),!1},e.prototype.disconnect=function(e,t){if(e&&t){var n=e.graph_node_id,r=t.graph_node_id;this._graph.removeEdge(n,r),e.dirty_controller.clear_successors_cache_with_predecessors()}},e.prototype.disconnect_predecessors=function(e){for(var t=0,n=this.predecessors(e);t<n.length;t++){var r=n[t];this.disconnect(r,e)}},e.prototype.disconnect_successors=function(e){for(var t=0,n=this.successors(e);t<n.length;t++){var r=n[t];this.disconnect(e,r)}},e.prototype.predecessor_ids=function(e){return this._graph.predecessors(e)||[]},e.prototype.predecessors=function(e){var t=this.predecessor_ids(e.graph_node_id);return this.nodes_from_ids(t)},e.prototype.successor_ids=function(e){return this._graph.successors(e)||[]},e.prototype.successors=function(e){var t=this.successor_ids(e.graph_node_id)||[];return this.nodes_from_ids(t)},e.prototype.all_next_ids=function(e,t){for(var n=[],r=this[t](e.graph_node_id);r.length>0;){for(var o=[],i=0,s=r;i<s.length;i++)for(var a=s[i],_=0,u=this[t](a);_<u.length;_++){var c=u[_];o.push(c)}for(var p=0,l=r;p<l.length;p++){var d=l[p];n.push(d)}for(var h=0,f=o;h<f.length;h++){d=f[h];r.push(d)}r=o}return n},e.prototype.all_predecessor_ids=function(e){return this.all_next_ids(e,"predecessor_ids")},e.prototype.all_successor_ids=function(e){return this.all_next_ids(e,"successor_ids")},e.prototype.all_predecessors=function(e){var t=this.all_predecessor_ids(e);return this.nodes_from_ids(t)},e.prototype.all_successors=function(e){var t=this.all_successor_ids(e);return this.nodes_from_ids(t)},e}();t.CoreGraph=o},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=function(){function e(){this._cooking_nodes_by_id=new Map,this._resolves=[]}return e.prototype.add_node=function(e){this._cooking_nodes_by_id.set(e.graph_node_id,e)},e.prototype.remove_node=function(e){this._cooking_nodes_by_id.delete(e.graph_node_id),0==this._cooking_nodes_by_id.size&&this.flush()},e.prototype.flush=function(){for(var e;e=this._resolves.pop();)e()},e.prototype.wait_for_cooks_completed=function(){return r.__awaiter(this,void 0,void 0,(function(){var e=this;return r.__generator(this,(function(t){return 0==this._cooking_nodes_by_id.size?[2]:[2,new Promise((function(t,n){e._resolves.push(t)}))]}))}))},e}();t.CookController=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n(142);var r=function(){function e(e){this.scene=e}return e.prototype.set_listener=function(e){this._events_listener=e},Object.defineProperty(e.prototype,"events_listener",{get:function(){return this._events_listener},enumerable:!0,configurable:!0}),e.prototype.dispatch=function(e,t,n){var r;void 0===n&&(n={}),null===(r=this._events_listener)||void 0===r||r.process_events(e,t,n)},Object.defineProperty(e.prototype,"emit_allowed",{get:function(){return this.scene.loading_controller.loaded&&null!=this._events_listener&&this.scene.loading_controller.auto_updating&&!POLY.player_mode()},enumerable:!0,configurable:!0}),e}();t.EventsController=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r={antialias:!0},o=function(){function e(){this._next_renderer_id=0,this._next_env_map_id=0,this._renderers={},this._env_maps={},this._require_webgl2=!1}return e.prototype.set_require_webgl2=function(){this._require_webgl2||(this._require_webgl2=!0)},e.prototype.rendering_context=function(e){var t=null;return this._require_webgl2&&(t=this._rendering_context_webgl(e,!0)),t||(t=this._rendering_context_webgl(e,!1)),t},e.prototype._rendering_context_webgl=function(e,t){var n=t?"webgl2":"webgl",o=e.getContext(n,r);return o||(n=t?"experimental-webgl2":"experimental-webgl",o=e.getContext(n,r)),o},e.prototype.register_renderer=function(e){if(e._polygon_id)throw new Error("render already registered");e._polygon_id=this._next_renderer_id+=1,this._renderers[e._polygon_id]=e},e.prototype.deregister_renderer=function(e){delete this._renderers[e._polygon_id],e.dispose()},e.prototype.first_renderer=function(){var e=Object.keys(this._renderers)[0];return e?this._renderers[e]:null},e.prototype.renderers=function(){return Object.values(this._renderers)},e}();t.RenderersController=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){this._node_register={},this._node_register_categories={},this._node_register_options={}}return e.prototype.register_node=function(e,t,n){var r=e.node_context(),o=e.type();if(this._node_register[r]=this._node_register[r]||{},this._node_register[r][o])throw new Error("node "+r+"/"+o+" already registered");this._node_register[r][o]=e,t&&(this._node_register_categories[r]=this._node_register_categories[r]||{},this._node_register_categories[r][o]=t),this._node_register_options[r]=this._node_register_options[r]||{},n&&(this._node_register_options[r][o]=n)},e.prototype.deregister_node=function(e,t){delete this._node_register[e][t],delete this._node_register_categories[e][t],delete this._node_register_options[e][t]},e.prototype.registered_nodes_for_context_and_parent_type=function(e,t){var n=this;return this._node_register[e]?Object.values(this._node_register[e]).filter((function(r){var o,i=n._node_register_options[e][r.type()];return!i||(null===(o=i.only)||void 0===o?void 0:o.includes(t))})):[]},e.prototype.registered_nodes=function(e,t){for(var n={},r=0,o=this.registered_nodes_for_context_and_parent_type(e,t);r<o.length;r++){var i=o[r];n[i.type()]=i}return n},e}();t.NodesRegister=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this.scene=e,this._lifecycle_on_create_allowed=!0}return e.prototype.on_create_hook_allowed=function(){return this.scene.loading_controller.loaded&&this._lifecycle_on_create_allowed},e.prototype.on_create_prevent=function(e){this._lifecycle_on_create_allowed=!1,e(),this._lifecycle_on_create_allowed=!0},e}();t.LifeCycleController=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=function(){function e(e){this.scene=e,this._loading_state=!0,this._auto_updating=!0,this._first_object_loaded=!1}return e.prototype.mark_as_loading=function(){this._set_loading_state(!0)},e.prototype.mark_as_loaded=function(){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(e){switch(e.label){case 0:return[4,this._set_loading_state(!1)];case 1:return e.sent(),[2]}}))}))},e.prototype._set_loading_state=function(e){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(t){switch(t.label){case 0:return this._loading_state=e,[4,this.set_auto_update(!this._loading_state)];case 1:return t.sent(),[2]}}))}))},Object.defineProperty(e.prototype,"is_loading",{get:function(){return this._loading_state},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"loaded",{get:function(){return!this._loading_state},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"auto_updating",{get:function(){return this._auto_updating},enumerable:!0,configurable:!0}),e.prototype.set_auto_update=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t;return r.__generator(this,(function(n){switch(n.label){case 0:return this._auto_updating===e?[3,4]:(this._auto_updating=e,this._auto_updating?(t=this.scene.root)?[4,t.process_queue()]:[3,2]:[3,3]);case 1:n.sent(),n.label=2;case 2:return[3,3];case 3:return[3,4];case 4:return[2]}}))}))},e.prototype.on_first_object_loaded=function(){var e;if(!this._first_object_loaded){this._first_object_loaded=!0;var t=document.getElementById("scene_loading_container");t&&(null===(e=t.parentElement)||void 0===e||e.removeChild(t))}},e}();t.LoadingController=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(461),o=function(){function e(){this.references={},this.next_id=0,this.next_id_s="0"}return e.prototype.register=function(e,t,n){var o=this.next_id_s,i=new r.MissingExpressionReference(e,t,n,o);return this.references[n]=this.references[n]||{},this.references[n][o]=i,this.next_id+=1,this.next_id_s=""+this.next_id,i},e.prototype.unregister=function(e){this.references[e.full_path]&&delete this.references[e.full_path][e.id]},e.prototype.check_for_references=function(e){var t=e.full_path(),n=this.references[t];n&&(Object.keys(n).forEach((function(t){n[t].resolve_with_node(e)})),delete this.references[t])},e}();t.MissingReferencesController=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t,n,r){this.param=e,this.jsep_node=t,this.full_path=n,this.id=r,console.log(this.jsep_node,this.param)}return e.prototype.resolve_with_node=function(e){console.warn("this should not work! REFACTOR asap")},e}();t.MissingExpressionReference=r;var o=function(){function e(){this.found_graph_nodes=[],this.missing_paths=[]}return e.prototype.set_found_graph_nodes=function(e){this.found_graph_nodes=e},e.prototype.set_missing_paths=function(e){this.missing_paths=e},e}();t.ReferenceSearchResult=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=r.__importDefault(n(271)),i=r.__importDefault(n(74)),s=r.__importDefault(n(91)),a=n(463),_=n(49),u=function(){function e(e){this.scene=e,this._node_context_signatures={},this._instanciated_nodes_by_context_and_type={}}return e.prototype.init=function(){this._root=new a.ObjectsManagerNode(this.scene),this._root.initialize_base_and_node(),this._root.init_display_scene()},Object.defineProperty(e.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),e.prototype.objects_from_mask=function(e){var t=e.split(" "),n=this.root.children(),r=(n=n.filter((function(e){return _.CoreString.matches_one_mask(e.name,t)}))).map((function(e){return e.object}));return s.default(r)},e.prototype.clear=function(){for(var e=0,t=this.root.children();e<t.length;e++){var n=t[e];this.root.children_controller.remove_node(n)}},e.prototype.node=function(e){return"/"===e?this.root:this.root.node(e)},e.prototype.all_nodes=function(){for(var e=[this.root],t=[this.root],n=0;t.length>0&&n<10;){var r=i.default(t.map((function(e){return e.children_controller.children_allowed()?e.children():[]})));e=o.default(e,r),t=r,n+=1}return i.default(e)},e.prototype.reset_node_context_signatures=function(){this._node_context_signatures={}},e.prototype.register_node_context_signature=function(e){this._node_context_signatures[e.children_controller.node_context_signature()]=!0},e.prototype.node_context_signatures=function(){return Object.keys(this._node_context_signatures).sort().map((function(e){return e.toLowerCase()}))},e.prototype.add_to_instanciated_node=function(e){var t=e.node_context(),n=e.type();this._instanciated_nodes_by_context_and_type[t]=this._instanciated_nodes_by_context_and_type[t]||{},this._instanciated_nodes_by_context_and_type[t][n]=this._instanciated_nodes_by_context_and_type[t][n]||{},this._instanciated_nodes_by_context_and_type[t][n][e.graph_node_id]=e},e.prototype.remove_from_instanciated_node=function(e){var t=e.node_context(),n=e.type();delete this._instanciated_nodes_by_context_and_type[t][n][e.graph_node_id]},e.prototype.instanciated_nodes=function(e,t){var n=[];if(this._instanciated_nodes_by_context_and_type[e]){var r=this._instanciated_nodes_by_context_and_type[e][t];if(r)for(var o=0,i=Object.keys(r);o<i.length;o++){var s=i[o];n.push(r[s])}}return n},e}();t.NodesController=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=n(36),i=n(464);n(142);var s=n(42),a=new(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t}(n(9).NodeParamsConfig)),_=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=a,t._object=new o.Group,t._queued_nodes_by_id={},t._queued_nodes_by_path={},t._expected_geo_nodes={},t._process_queue_start=-1,t}return r.__extends(t,e),t.type=function(){return"obj"},t.prototype.initialize_node=function(){this.children_controller.init(s.NodeContext.OBJ),this.lifecycle.add_on_child_add_hook(this._on_child_add.bind(this)),this.lifecycle.add_on_child_remove_hook(this._on_child_remove.bind(this))},t.prototype.init_display_scene=function(){this._object.name="_WORLD_",this._scene.display_scene.add(this._object)},t.prototype.object=function(){return this._object},t.prototype.create_node=function(t){return e.prototype.create_node.call(this,t)},t.prototype.children=function(){return e.prototype.children.call(this)},t.prototype.nodes_by_type=function(t){return e.prototype.nodes_by_type.call(this,t)},t.prototype.multiple_display_flags_allowed=function(){return!0},t.prototype.add_to_queue=function(e){var t=e.graph_node_id;if(null==this._queued_nodes_by_id[t])return this._queued_nodes_by_id[t]=e},t.prototype.process_queue=function(){return r.__awaiter(this,void 0,void 0,(function(){var e,t,n,o,i,s,a,_,u,c=this;return r.__generator(this,(function(r){switch(r.label){case 0:for(this._queued_nodes_by_path={},e=Object.keys(this._queued_nodes_by_id),t=0,n=e;t<n.length;t++)o=n[t],i=this._queued_nodes_by_id[o],delete this._queued_nodes_by_id[o],s="_____"+i.render_order+"__"+i.full_path(),this._queued_nodes_by_path[s]=i;return a=Object.keys(this._queued_nodes_by_path).sort().map((function(e){var t=c._queued_nodes_by_path[e];return c.update_object(t)})),_=this,(u=this._expected_geo_nodes)?[3,2]:[4,this.expected_loading_geo_nodes_by_id()];case 1:u=r.sent(),r.label=2;case 2:return _._expected_geo_nodes=u,this._process_queue_start=performance.now(),Promise.all(a).then((function(){POLY.log("SCENE LOADED '"+c.scene.name+"' in "+(performance.now()-c._process_queue_start))})),[2]}}))}))},t.prototype.update_object=function(e){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(t){return this.scene.loading_controller.auto_updating?this.add_to_scene(e):this.add_to_queue(e),[2]}))}))},t.prototype.get_parent_for_node=function(e){if(e.add_to_hierarchy){var t=e.io.inputs.input(0);return t?t.object:this._object}return null},t.prototype.add_to_scene=function(e){if(e.add_to_hierarchy){var t=this.get_parent_for_node(e);t&&(e.used_in_scene?(t.add(e.object),e.cook_controller.cook_main_without_inputs()):t.remove(e.object))}},t.prototype.remove_from_scene=function(e){if(e.add_to_hierarchy){var t=e.object;if(null!=t){var n=t.parent;null!=n&&n.remove(t)}}},t.prototype.are_children_cooking=function(){for(var e=0,t=this.children();e<t.length;e++){if(t[e].is_display_node_cooking())return!0}return!1},t.prototype.expected_loading_geo_nodes_by_id=function(){return r.__awaiter(this,void 0,void 0,(function(){var e,t,n,o,i;return r.__generator(this,(function(r){switch(r.label){case 0:e=this.nodes_by_type("geo"),t={},n=0,o=e,r.label=1;case 1:return n<o.length?[4,(i=o[n]).is_displayed()]:[3,4];case 2:r.sent()&&(t[i.graph_node_id]=i),r.label=3;case 3:return n++,[3,1];case 4:return[2,t]}}))}))},t.prototype.add_to_parent_transform=function(e){this.update_object(e)},t.prototype.remove_from_parent_transform=function(e){this.update_object(e)},t.prototype._on_child_add=function(e){e&&this.update_object(e)},t.prototype._on_child_remove=function(e){e&&this.remove_from_scene(e)},t}(i.TypedBaseManagerNode);t.ObjectsManagerNode=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=n(81),i=n(42),s=n(118),a=n(557),_=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.container_controller=new s.TypedContainerController(t,a.ManagerContainer),t}return r.__extends(t,e),t.node_context=function(){return i.NodeContext.MANAGER},t}(o.TypedNode);t.TypedBaseManagerNode=_;var u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t}(_);t.BaseManagerNodeClass=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this.node=e,this._dirty_count=0,this._dirty=!0,this._post_dirty_hooks=[]}return Object.defineProperty(e.prototype,"is_dirty",{get:function(){return!0===this._dirty},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dirty_timestamp",{get:function(){return this._dirty_timestamp},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dirty_count",{get:function(){return this._dirty_count},enumerable:!0,configurable:!0}),e.prototype.add_post_dirty_hook=function(e){this._post_dirty_hooks=this._post_dirty_hooks||[],this._post_dirty_hooks.push(e)},e.prototype.remove_dirty_state=function(){this._dirty=!1},e.prototype.set_forbidden_trigger_nodes=function(e){this._forbidden_trigger_nodes=e.map((function(e){return e.graph_node_id}))},e.prototype.set_dirty=function(e,t){null==t&&(t=!0),e&&this._forbidden_trigger_nodes&&this._forbidden_trigger_nodes.includes(e.graph_node_id)||(null==e&&(e=this.node),this._dirty=!0,this._dirty_timestamp=performance.now(),this._dirty_count+=1,this.run_post_dirty_hooks(e),!0===t&&this.set_successors_dirty(e))},e.prototype.run_post_dirty_hooks=function(e){var t=this.node.scene.cooker;if(t.blocked)t.enqueue(this.node);else if(this._post_dirty_hooks)for(var n=0,r=this._post_dirty_hooks;n<r.length;n++){(0,r[n])(e)}},e.prototype.set_successors_dirty=function(e){this._cached_successors=this._cached_successors||this.node.graph_all_successors();for(var t=0,n=this._cached_successors;t<n.length;t++){n[t].dirty_controller.set_dirty(e,!1)}},e.prototype.clear_successors_cache=function(){this._cached_successors=void 0},e.prototype.clear_successors_cache_with_predecessors=function(){this.clear_successors_cache();for(var e=0,t=this.node.graph_all_predecessors();e<t.length;e++){t[e].dirty_controller.clear_successors_cache()}},e}();t.DirtyController=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=r.__importDefault(n(272)),i=n(2),s=n(6),a=n(64),_=function(e){function t(t,n,r){void 0===n&&(n=0),void 0===r&&(r=0);var o=e.call(this)||this;return o.node=t,o._width=50,o._border_radius=3,o._color=new s.Color(.75,.75,.75),o._icon=null,o._layout_vertical=!0,o._position=new i.Vector2(n||0,r||0),o}return r.__extends(t,e),t.prototype.set_border_radius=function(e){this._border_radius=e},t.prototype.border_radius=function(){return this._border_radius},t.prototype.set_width=function(e){this._width=e},t.prototype.width=function(){return this._width},t.prototype.set_comment=function(e){this._comment=e,this.node.emit(a.NodeEvent.UI_DATA_UPDATED,this.to_json())},t.prototype.comment=function(){return this._comment},t.prototype.set_color=function(e){this._color=e},t.prototype.color=function(){return this._color},t.prototype.set_icon=function(e){this._icon=e},t.prototype.icon=function(){return this._icon},t.prototype.set_layout_horizontal=function(){this._layout_vertical=!1},t.prototype.is_layout_vertical=function(){return this._layout_vertical},t.prototype.copy=function(e){this._position.copy(e.position()),this._color.copy(e.color())},t.prototype.position=function(){return this._position},t.prototype.set_position=function(e){this._position.copy(e),this.node.emit(a.NodeEvent.UI_DATA_UPDATED,this.to_json())},t.prototype.translate=function(e,t){void 0===t&&(t=!1),this._position.add(e),t&&(this._position.x=Math.round(this._position.x),this._position.y=Math.round(this._position.y)),this.node.emit(a.NodeEvent.UI_DATA_UPDATED,this.to_json())},t.prototype.to_json=function(){return{x:this._position.x,y:this._position.y,comment:this._comment}},t}(o.default);t.UIData=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(468),o=n(469),i=function(e){this.node=e,this.time_dependent=new r.TimeDependentState(this.node),this.error=new o.ErrorState(this.node)};t.StatesController=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this.node=e}return Object.defineProperty(e.prototype,"active",{get:function(){return this.are_params_time_dependent()||this.are_inputs_time_dependent()},enumerable:!0,configurable:!0}),e.prototype.are_params_time_dependent=function(){for(var e=0,t=this.node.params.names;e<t.length;e++){var n=t[e],r=this.node.params.get(n);if(r&&r.states.time_dependent.active)return!0}return!1},e.prototype.are_inputs_time_dependent=function(){for(var e=0,t=this.node.io.inputs.inputs();e<t.length;e++){var n=t[e];if(n&&n.states.time_dependent.active)return!0}return!1},e}();t.TimeDependentState=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(64),o=function(){function e(e){this.node=e}return e.prototype.set=function(e){this._message!=e&&(this._message=e,this.on_update())},Object.defineProperty(e.prototype,"message",{get:function(){return this._message},enumerable:!0,configurable:!0}),e.prototype.clear=function(){this.set(void 0)},Object.defineProperty(e.prototype,"active",{get:function(){return null!=this._message},enumerable:!0,configurable:!0}),e.prototype.on_update=function(){null!=this._message&&this.node.set_container(null,"from error '"+this._message+"'"),this.node.emit(r.NodeEvent.ERROR_UPDATED)},e}();t.ErrorState=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(201),o=n(92),i=function(){function e(e){this.node=e,this._parent=null}return Object.defineProperty(e.prototype,"parent",{get:function(){return this._parent},enumerable:!0,configurable:!0}),e.prototype.set_parent=function(e){e!=this.node.parent_controller.parent&&(this._parent=e,this._parent&&this.node.name_controller.request_name_to_parent(r.NameController.base_name(this.node)))},e.prototype.is_selected=function(){var e,t;return null===(t=null===(e=this.parent)||void 0===e?void 0:e.selection)||void 0===t?void 0:t.contains(this.node)},e.prototype.full_path=function(){var e=o.CoreWalker.SEPARATOR;if(null!=this._parent){var t=this._parent.full_path();return t===e?t+this.node.name:t+e+this.node.name}return e},e.prototype.on_set_parent=function(){if(this._on_set_parent_hooks)for(var e=0,t=this._on_set_parent_hooks;e<t.length;e++){(0,t[e])()}},e}();t.HierarchyParentController=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){}return e.separator=function(){return"/"},e.find_node=function(e,t,n){if(!e)return null;var r=t.split("/").filter((function(e){return e.length>0})),o=r[0],i=null;if("/"!==t[0]){switch(o){case"..":i=e.parent;break;case".":i=e;break;default:i=e.node(o)}if(i&&n&&n.add_node(o,i),null!=i&&r.length>1){var s=r.slice(1).join("/");i=this.find_node(i,s,n)}return i}var a=t.substr(1);return i=this.find_node(e.root,a,n)},e}();t.CoreWalkerEmbed=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=n(49),i=n(92),s=n(55),a=r.__importDefault(n(492)),_=r.__importDefault(n(79)),u=r.__importDefault(n(93)),c=r.__importDefault(n(200)),p=n(64),l=n(201),d=function(){function e(e){this.node=e,this._children_allowed=!1,this._children={},this._children_by_type={},this._children_and_grandchildren_by_context={},this._is_dependent_on_children=!1}return e.prototype.init=function(e,t){void 0===t&&(t=!1),this._context=e,this._children_allowed=!0,this._children={},t&&(this._is_dependent_on_children=t,this._is_dependent_on_children&&(this._children_node=new s.CoreGraphNode(this.node.scene,"children"),this.node.add_graph_input(this._children_node)))},Object.defineProperty(e.prototype,"context",{get:function(){return this._context},enumerable:!0,configurable:!0}),e.prototype.set_child_name=function(e,t){var n;if(t=(t=t.replace(/[^A-Za-z0-9]/g,"_")).replace(/^[0-9]/,"_"),null!=(n=this._children[t])){if(e.name===t&&n.graph_node_id===e.graph_node_id)return;return t=o.CoreString.increment(t),this.set_child_name(e,t)}var r=e.name;this._children[r]&&delete this._children[r],this._children[t]=e,e.name_controller.update_name_from_parent(t),this._add_to_nodes_by_type(e),this.node.scene.nodes_controller.add_to_instanciated_node(e)},e.prototype.node_context_signature=function(){return this.node.node_context()+"/"+this.node.type()},e.prototype.available_children_classes=function(){return this._context?POLY.registered_nodes(this._context,this.node.type()):(console.warn("children controller not initialized for node",this.node.type(),this.node),{})},e.prototype.children_allowed=function(){var e=this.available_children_classes();return e&&Object.keys(e).length>0},e.prototype.create_node=function(e){if(null==this.available_children_classes())throw"no children available for "+this.node.full_path()+".";var t=this.available_children_classes()[e];if(null==t){var n="node type "+e+" not found for "+this.node.full_path()+" ("+Object.keys(this.available_children_classes()).join(", ")+", "+this._context+", "+this.node.type()+")";throw console.error(n),n}var r=new t(this.node.scene,"child_node_"+e);return r.initialize_base_and_node(),this.add_node(r),r},e.prototype.add_node=function(e){if(!this._children_allowed)throw"node "+this.node.full_path()+" cannot have children";e.set_parent(this.node),e.params.init(),e.parent_controller.on_set_parent(),e.name_controller.post_set_full_path();for(var t=0,n=e.children_controller.children();t<n.length;t++){n[t].name_controller.post_set_full_path()}return this.node.emit(p.NodeEvent.CREATED,{child_node:e}),this.node.scene.lifecycle_controller.on_create_hook_allowed()&&e.lifecycle.on_create(),this.set_child_name(e,l.NameController.base_name(e)),this.node.lifecycle.on_child_add(e),this._is_dependent_on_children&&this._children_node&&this._children_node.add_graph_input(e),e.require_webgl2()&&this.node.scene.webgl_controller.set_require_webgl2(),e},e.prototype.remove_node=function(e){if(e.parent!=this.node)return console.warn("node "+e.name+" not under parent "+this.node.full_path());e.set_successors_dirty(this.node),this._is_dependent_on_children&&this._children_node&&this._children_node.remove_graph_input(e),this.node.selection.contains(e)&&this.node.selection.remove([e]);var t=e.io.connections.first_input_connection();e.io.connections.input_connections().forEach((function(e){e&&e.disconnect({set_input:!0})})),e.io.connections.output_connections().forEach((function(e){if(e&&(e.disconnect({set_input:!0}),t)){var n=t.node_src,r=e.output_index,o=e.node_dest,i=e.input_index;o.io.inputs.set_input(i,n,r)}})),e.graph_disconnect_successors(),e.set_parent(null),delete this._children[e.name],this._remove_from_nodes_by_type(e),this.node.scene.nodes_controller.remove_from_instanciated_node(e),this.node.lifecycle.on_child_remove(e),e.lifecycle.on_delete(),e.emit(p.NodeEvent.DELETED,{parent:this.node})},e.prototype.find_node=function(e){if(!this._children_allowed)return null;if(null==e)return null;if(e===i.CoreWalker.CURRENT||e===i.CoreWalker.CURRENT_WITH_SLASH)return this.node;if(e===i.CoreWalker.PARENT||e===i.CoreWalker.PARENT_WITH_SLASH)return this.node.parent;var t=i.CoreWalker.separator();e[0]===t&&(e=e.substring(1,e.length));var n=e.split(t);if(1===n.length){var r=n[0];return this._children[r]}return i.CoreWalker.find_node(this.node,e)},e.prototype._add_to_nodes_by_type=function(e){var t=e.graph_node_id,n=e.type();this._children_by_type[n]=this._children_by_type[n]||[],a.default(this._children_by_type[n],t)||this._children_by_type[n].push(t),this.add_to_children_and_grandchildren_by_context(e)},e.prototype._remove_from_nodes_by_type=function(e){var t=e.graph_node_id,n=e.type();if(this._children_by_type[n]){var r=this._children_by_type[n].indexOf(t);r>=0&&(this._children_by_type[n].splice(r,1),0==this._children_by_type[n].length&&delete this._children_by_type[n])}this.remove_from_children_and_grandchildren_by_context(e)},e.prototype.add_to_children_and_grandchildren_by_context=function(e){var t=e.graph_node_id,n=e.node_context();this._children_and_grandchildren_by_context[n]=this._children_and_grandchildren_by_context[n]||[],a.default(this._children_and_grandchildren_by_context[n],t)||this._children_and_grandchildren_by_context[n].push(t),this.node.parent&&this.node.parent.children_controller.add_to_children_and_grandchildren_by_context(e)},e.prototype.remove_from_children_and_grandchildren_by_context=function(e){var t=e.graph_node_id,n=e.node_context();if(this._children_and_grandchildren_by_context[n]){var r=this._children_and_grandchildren_by_context[n].indexOf(t);r>=0&&(this._children_and_grandchildren_by_context[n].splice(r,1),0==this._children_and_grandchildren_by_context[n].length&&delete this._children_and_grandchildren_by_context[n])}this.node.parent&&this.node.parent.children_controller.remove_from_children_and_grandchildren_by_context(e)},e.prototype.nodes_by_type=function(e){var t=this._children_by_type[e]||[],n=this.node.scene.graph;return t.map((function(e){return n.node_from_id(e)}))},e.prototype.has_children_and_grandchildren_with_context=function(e){return null!=this._children_and_grandchildren_by_context[e]},e.prototype.children=function(){return c.default(this._children)},e.prototype.children_names=function(){return u.default(_.default(this._children))},e.prototype.traverse_children=function(e){for(var t,n=0,r=this.children();n<r.length;n++){var o=r[n];e(o),null===(t=o.children_controller)||void 0===t||t.traverse_children(e)}},e}();t.HierarchyChildrenController=d},,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this.node=e,this._on_child_add_hooks=[],this._on_child_remove_hooks=[],this._on_create_hooks=[],this._on_delete_hooks=[]}return e.prototype.add_on_child_add_hook=function(e){this._on_child_add_hooks.push(e)},e.prototype.on_child_add=function(e){this.execute_hooks_with_child_node(this._on_child_add_hooks,e)},e.prototype.add_on_child_remove_hook=function(e){this._on_child_remove_hooks.push(e)},e.prototype.on_child_remove=function(e){this.execute_hooks_with_child_node(this._on_child_remove_hooks,e)},e.prototype.add_create_hook=function(e){this._on_create_hooks.push(e)},e.prototype.on_create=function(){this.execute_hooks(this._on_create_hooks)},e.prototype.add_delete_hook=function(e){this._on_delete_hooks.push(e)},e.prototype.on_delete=function(){this.execute_hooks(this._on_delete_hooks)},e.prototype.execute_hooks=function(e){for(var t=0,n=e;t<n.length;t++){(0,n[t])()}},e.prototype.execute_hooks_with_child_node=function(e,t){for(var n=0,r=e;n<r.length;n++){(0,r[n])(t)}},e}();t.LifeCycleController=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=function(){function e(e){this.node=e,this._cooking=!1,this._cooks_count=0,this._max_cook_time=-1,this._cook_time_with_inputs=0,this._cook_time=0,this._cook_time_params=0,this._inputs_evaluation_required=!0}return e.prototype.disallow_inputs_evaluation=function(){this._inputs_evaluation_required=!1},Object.defineProperty(e.prototype,"is_cooking",{get:function(){return!0===this._cooking},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cooks_count",{get:function(){return this._cooks_count},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cook_time",{get:function(){return this._cook_time},enumerable:!0,configurable:!0}),e.prototype._init_cooking_state=function(){this._cooking=!0,this._cooking_dirty_timestamp=this.node.dirty_controller.dirty_timestamp},e.prototype._init_cooking_start_time=function(e){null==e&&(e=this.node.scene.performance.started),e&&(this._cook_time_start=performance.now())},e.prototype._start_cook_if_no_errors=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t;return r.__generator(this,(function(n){switch(n.label){case 0:return this.node.states.error.active?(this.end_cook(),[3,4]):[3,1];case 1:return n.trys.push([1,3,,4]),[4,this.node.cook(e)];case 2:return n.sent(),[3,4];case 3:return t=n.sent(),this.node.states.error.set("node internal error: '"+t+"'."),console.error(this.node.full_path(),t),this.end_cook(),[3,4];case 4:return[2]}}))}))},e.prototype.cook_main=function(){return r.__awaiter(this,void 0,void 0,(function(){var e,t,n,o,i;return r.__generator(this,(function(r){switch(r.label){case 0:return this.is_cooking?[2]:(this._init_cooking_state(),(e=this.node.scene.performance.started)&&(this._cook_time_with_inputs_start=performance.now()),this.node.states.error.clear(),[4,this.evaluate_inputs_and_params()]);case 1:if(t=r.sent(),this._init_cooking_start_time(e),n=[],t)for(o=void 0,i=0;i<t.length;i++)(o=t[i])&&(this.node.io.inputs.input_clonable_state_with_override(i)?n.push(o.core_content_cloned()):n.push(o.core_content()));return[4,this._start_cook_if_no_errors(n)];case 2:return r.sent(),[2]}}))}))},e.prototype.cook_main_without_inputs=function(){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(e){switch(e.label){case 0:return this.node.scene.cook_controller.add_node(this.node),this.is_cooking?(console.warn("cook_main_without_inputs already cooking",this.node.full_path()),[2]):(this._init_cooking_state(),this._init_cooking_start_time(),this.node.states.error.clear(),[4,this.node.params.eval_all()]);case 1:return e.sent(),[4,this._start_cook_if_no_errors([])];case 2:return e.sent(),[2]}}))}))},e.prototype.end_cook=function(e){this._increment_cooks_count();var t=this.node.dirty_controller.dirty_timestamp;null==t||t===this._cooking_dirty_timestamp?(this.node.remove_dirty_state(),this._terminate_cook_process()):(POLY.log("COOK AGAIN",t,this._cooking_dirty_timestamp,this.node.full_path()),this._cooking=!1,this.cook_main())},e.prototype._terminate_cook_process=function(){this.is_cooking&&(this._cooking=!1,this._record_cook_time(),setTimeout(this.node.container_controller.notify_requesters.bind(this.node.container_controller),0))},e.prototype._increment_cooks_count=function(){this.is_cooking&&null!=this._cook_time_start&&(this._cooks_count+=1)},e.prototype._record_cook_time=function(){if(this.node.scene.performance.started){var e=performance.now();null!=this._cook_time_with_inputs_start&&(this._cook_time_with_inputs=e-this._cook_time_with_inputs_start,this._cook_time_with_inputs_start=void 0),null!=this._cook_time_params_start&&null!=this._cook_time_start&&(this._cook_time_params=this._cook_time_start-this._cook_time_params_start),null!=this._cook_time_start&&(this._cook_time=e-this._cook_time_start,this._cook_time_start=void 0),this._max_cook_time=Math.max(this._max_cook_time,this._cook_time)}this.node.scene.performance.started&&this.node.scene.performance.record_node_cook_data(this.node)},e.prototype.evaluate_inputs_and_params=function(){return r.__awaiter(this,void 0,void 0,(function(){var e;return r.__generator(this,(function(t){switch(t.label){case 0:return e=[],this._inputs_evaluation_required?[4,this.node.io.inputs.eval_required_inputs_p()]:[3,2];case 1:e=t.sent(),t.label=2;case 2:return this.node.scene.performance.started&&(this._cook_time_params_start=performance.now()),[4,this.node.params.eval_all()];case 3:return t.sent(),[2,e]}}))}))},Object.defineProperty(e.prototype,"cook_time_with_inputs",{get:function(){return this._cook_time_with_inputs},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cook_time_params",{get:function(){return this._cook_time_params},enumerable:!0,configurable:!0}),e.prototype._time_with_precision=function(e){return Math.round(1e3*e)/1e3},e}();t.CookController=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,o=n(3).__importDefault(n(500)),i=n(81),s=n(145);!function(e){e.SUCCESSORS="graph_successors",e.PREDECESSORS="graph_predecessors"}(r||(r={}));var a=function(){function e(e){this.node=e}return e.prototype.scene_successors=function(){return this._find_scene_node_scene_nodes(r.SUCCESSORS)},e.prototype.scene_predecessors=function(){return this._find_scene_node_scene_nodes(r.PREDECESSORS)},e.prototype._find_scene_node_scene_nodes=function(e){var t=this,n=this.node.params.all;n.push(this.node);for(var i=[],s=0,a=n;s<a.length;s++){var _=a[s];this._find_base_nodes_from_node(_,e,i)}if(e==r.SUCCESSORS)for(var u=0,c=this.param_nodes_referree();u<c.length;u++){var p=c[u];i.push(p)}i=i.filter((function(e){return e.graph_node_id!=t.node.graph_node_id}));var l=o.default(i,(function(e){return e.graph_node_id})),d=[];return Object.keys(l).forEach((function(e){d.push(l[e][0])})),d},e.prototype._find_base_nodes_from_node=function(e,t,n){for(var r,o,a=0,_=e[t]();a<_.length;a++){var u=_[a];u instanceof s.BaseParamClass?n.push(u.node):(r=u,("string"==typeof(o=i.BaseNodeClass)?typeof r===o:r instanceof o)?n.push(u):this._find_base_nodes_from_node(u,t,n))}return n},e.prototype.add_param_referree=function(e){this._params_referrees_by_graph_node_id=this._params_referrees_by_graph_node_id||{},this._params_referrees_by_graph_node_id[e.graph_node_id]=e},e.prototype.remove_param_referree=function(e){this._params_referrees_by_graph_node_id&&delete this._params_referrees_by_graph_node_id[e.graph_node_id]},e.prototype.params_referree=function(){var e=[];if(this._params_referrees_by_graph_node_id)for(var t=0,n=Object.keys(this._params_referrees_by_graph_node_id);t<n.length;t++){var r=n[t];e.push(this._params_referrees_by_graph_node_id[r])}return e},e.prototype.param_nodes_referree=function(){for(var e,t={},n=0,r=this.params_referree();n<r.length;n++){t[(e=r[n].node).graph_node_id]=e}for(var o=[],i=0,s=Object.keys(t);i<s.length;i++){var a=s[i];o.push(t[a])}return o},e}();t.DependenciesController=a},,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=r.__importDefault(n(91)),i=r.__importDefault(n(206)),s=r.__importDefault(n(279)),a=n(25),_=n(207),u=function(){function e(e){this._param=e,this._programatic_visible_state=!0}return e.prototype.set=function(e){this._default_options=e,this._options=i.default(this._default_options)},e.prototype.copy=function(e){this._default_options=i.default(e.default),this._options=i.default(e.current)},e.prototype.set_option=function(e,t){return Object.assign(this._options,e,t)},Object.defineProperty(e.prototype,"param",{get:function(){return this._param},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"node",{get:function(){return this._param.node},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"default",{get:function(){return this._default_options},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"current",{get:function(){return this._options},enumerable:!0,configurable:!0}),e.prototype.has_options_overridden=function(){return!s.default(this._options,this._default_options)},e.prototype.overridden_options=function(){for(var e={},t=0,n=Object.keys(this._options);t<n.length;t++){var r=n[t];s.default(this._options[r],this._default_options[r])||Object.assign(e,r,i.default(this._options[r]))}return e},e.prototype.always_reference_asset=function(){return this._options.always_reference_asset||!1},e.prototype.has_callback=function(){return null!=this._options.callback||null!=this._options.callback_string},e.prototype.execute_callback=function(){var e=this.get_callback();null!=e&&this.node&&!this.node.cook_controller.is_cooking&&e(this.node,this.param)},e.prototype.get_callback=function(){if(this.has_callback())return this._options.callback=this._options.callback||this.create_callback_from_string()},e.prototype.create_callback_from_string=function(){var e=this,t=this._options.callback_string;if(t){var n=new Function("node","scene","window","location",t);return function(){n(e.node,e.node.scene,null,null)}}},e.prototype.color=function(){return this._options.color},e.prototype.makes_node_dirty_when_dirty=function(){var e;if(null!=this.param.parent_param)return!1;var t=!0;return null!=(e=this._options.cook)&&(t=e),t},Object.defineProperty(e.prototype,"desktop_browse_option",{get:function(){return this._options.desktop_browse},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"desktop_browse_allowed",{get:function(){return null!=this.desktop_browse_option},enumerable:!0,configurable:!0}),e.prototype.desktop_browse_file_type=function(){return this.desktop_browse_option?this.desktop_browse_option.file_type:null},Object.defineProperty(e.prototype,"displays_expression_only",{get:function(){return!0===this._options.expression_only},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"is_expression_for_entities",{get:function(){var e=this._options.expression;return e&&e.for_entities||!1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"has_menu",{get:function(){return null!=this.menu_options},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"menu_options",{get:function(){return this._options.menu},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"menu_entries",{get:function(){return this.menu_options?this.menu_options.entries:[]},enumerable:!0,configurable:!0}),e.prototype.has_menu_radio=function(){return this.has_menu},e.prototype.is_multiline=function(){return!0===this._options.multiline},Object.defineProperty(e.prototype,"node_selection_options",{get:function(){return this._options.node_selection},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"node_selection_context",{get:function(){if(this.node_selection_options)return this.node_selection_options.context},enumerable:!0,configurable:!0}),e.prototype.dependent_on_found_node=function(){return!("dependent_on_found_node"in this._options)||this._options.dependent_on_found_node},e.prototype.range=function(){return this._options.range||[0,1]},e.prototype.step=function(){return this._options.step||.01},e.prototype.range_locked=function(){return this._options.range_locked||[!1,!1]},e.prototype._ensure_in_range=function(e){var t=this.range();return e>=t[0]&&e<=t[1]?e:e<t[0]?!0===this.range_locked()[0]?t[0]:e:!0===this.range_locked()[1]?t[1]:e},e.prototype.is_spare=function(){return this._options.spare||!1},e.prototype.texture_options=function(){return this._options.texture},e.prototype.texture_as_env=function(){var e=this.texture_options();return null!=e&&!0===e.env},e.prototype.is_hidden=function(){return!0===this._options.hidden||!1===this._programatic_visible_state},e.prototype.is_visible=function(){return!this.is_hidden()},e.prototype.set_visible_state=function(e){this._options.hidden=!e,this.param.emit(_.ParamEvent.VISIBLE_UPDATED)},e.prototype.is_label_hidden=function(){var e=this.param.type;return!1===this._options.label||e===a.ParamType.BUTTON||e===a.ParamType.SEPARATOR||e===a.ParamType.BOOLEAN&&this.is_field_hidden()},e.prototype.is_field_hidden=function(){return!1===this._options.field},e.prototype.ui_data_depends_on_other_params=function(){return"visible_if"in this._options},e.prototype.visibility_predecessors=function(){var e=this,t=Object.keys(this._options.visible_if||{}),n=this.param.node;return o.default(t.map((function(t){var r=n.params.get(t);if(r)return r;console.error("param "+t+" not found as visibility condition for "+e.param.name+" in node "+e.param.node.type())})))},e.prototype.set_ui_data_dependency=function(){var e=this;this.visibility_predecessors().forEach((function(t){e.param.ui_data.add_graph_input(t)}))},e.prototype.update_visibility=function(){return r.__awaiter(this,void 0,void 0,(function(){var e,t,n,o,i,s,a,u;return r.__generator(this,(function(r){switch(r.label){case 0:return(e=this._options.visible_if)?(t=this.visibility_predecessors(),n=t.map((function(e){return e.compute()})),this._programatic_visible_state=!0,[4,Promise.all(n)]):[3,2];case 1:for(r.sent(),o=0,i=t;o<i.length;o++)s=i[o],a=e[s.name],u=s.value,a!=u&&(this._programatic_visible_state=!1);this.param.emit(_.ParamEvent.VISIBLE_UPDATED),r.label=2;case 2:return[2]}}))}))},e}();t.OptionsController=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(207),o=function(){function e(e){this.param=e,this._blocked_emit=!0,this._blocked_parent_emit=!0,this._count_by_event_name={}}return Object.defineProperty(e.prototype,"emit_allowed",{get:function(){return!0!==this._blocked_emit&&(!this.param.scene.loading_controller.is_loading&&this.param.scene.events_controller.emit_allowed)},enumerable:!0,configurable:!0}),e.prototype.block_emit=function(){return this._blocked_emit=!0,this.param.is_multiple&&this.param.components&&this.param.components.forEach((function(e){return e.emit_controller.block_emit()})),!0},e.prototype.unblock_emit=function(){return this._blocked_emit=!1,this.param.is_multiple&&this.param.components&&this.param.components.forEach((function(e){return e.emit_controller.unblock_emit()})),!0},e.prototype.block_parent_emit=function(){return this._blocked_parent_emit=!0,!0},e.prototype.unblock_parent_emit=function(){return this._blocked_parent_emit=!1,!0},e.prototype.increment_count=function(e){this._count_by_event_name[e]=this._count_by_event_name[e]||0,this._count_by_event_name[e]+=1},e.prototype.events_count=function(e){return this._count_by_event_name[e]||0},e.prototype.emit_param_updated=function(){this.emit_allowed&&(this.param.emit(r.ParamEvent.UPDATED),null!=this.param.parent_param&&!0!==this._blocked_parent_emit&&this.param.parent_param.emit(r.ParamEvent.UPDATED))},e}();t.EmitController=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this.param=e}return e.prototype.to_json=function(){var e,t={name:this.param.name,type:this.param.type,value:this.param.value,expression:this.param.has_expression()?null===(e=this.param.expression_controller)||void 0===e?void 0:e.expression:null,graph_node_id:this.param.graph_node_id,is_dirty:this.param.is_dirty,error_message:this.param.states.error.message,is_visible:this.param.options.is_visible(),folder_name:this.param.ui_data.folder_name,components:null};return this.param.is_multiple&&this.param.components&&(t.components=this.param.components.map((function(e){return e.graph_node_id}))),t},e}();t.ParamSerializer=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(508),o=n(509),i=function(e){this.param=e,this.time_dependent=new r.TimeDependentState(this.param),this.error=new o.ErrorState(this.param)};t.StatesController=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this.param=e}return Object.defineProperty(e.prototype,"active",{get:function(){var e=this.param.scene.time_controller.graph_node.graph_node_id;return this.param.graph_predecessor_ids().includes(e)},enumerable:!0,configurable:!0}),e}();t.TimeDependentState=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this.node=e}return e.prototype.set=function(e){this._message!=e&&(this._message=e)},Object.defineProperty(e.prototype,"message",{get:function(){return this._message},enumerable:!0,configurable:!0}),e.prototype.clear=function(){this.set(void 0)},Object.defineProperty(e.prototype,"active",{get:function(){return null!=this._message},enumerable:!0,configurable:!0}),e}();t.ErrorState=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=function(e){function t(t,n){var r=e.call(this,t,"param ui data")||this;return r.param=n,r.add_post_dirty_hook(r.update_visibility_and_remove_dirty.bind(r)),r}return r.__extends(t,e),t.prototype.update_visibility_and_remove_dirty=function(){this.update_visibility(),this.remove_dirty_state()},t.prototype.update_visibility=function(){this.param.options.update_visibility()},t.prototype.set_folder_name=function(e){this._folder_name=e},Object.defineProperty(t.prototype,"folder_name",{get:function(){return this._folder_name},enumerable:!0,configurable:!0}),t}(n(55).CoreGraphNode);t.UIData=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this.node=e}return e.prototype.serialize=function(){return this.to_json()},e.prototype.to_json=function(e){var t,n,r,o;void 0===e&&(e=!1);var i=this.node.children().map((function(e){return e.graph_node_id})),s=this.node.io.inputs.inputs().map((function(e){return null!=e?e.graph_node_id:void 0})),a=this.node.io.connections.input_connections().map((function(e){return null!=e?e.output_index:void 0})),_=this.node.io.inputs.named_inputs().map((function(e){return e.to_json()})),u=this.node.io.outputs.named_outputs().map((function(e){return e.to_json()})),c={name:this.node.name,type:this.node.type(),graph_node_id:this.node.graph_node_id,is_dirty:this.node.is_dirty,ui_data:this.node.ui_data.to_json(),error_message:this.node.states.error.message,children:i,inputs:s,input_connection_output_indices:a,named_inputs:_,named_outputs:u,params:this.to_json_params(e),spare_params:this.to_json_spare_params(e),override_clonable_state:this.node.io.inputs.override_clonable_state(),inputs_clonable_state_with_override:this.node.io.inputs.inputs_clonable_state_with_override(),flags:{display:null===(n=null===(t=this.node.flags)||void 0===t?void 0:t.display)||void 0===n?void 0:n.active,bypass:null===(o=null===(r=this.node.flags)||void 0===r?void 0:r.bypass)||void 0===o?void 0:o.active},selection:null};return this.node.children_controller.children_allowed()&&(c.selection=this.node.selection.to_json()),c},e.prototype.to_json_params_from_names=function(e,t){void 0===t&&(t=!1);for(var n={},r=0,o=e;r<o.length;r++){var i=o[r],s=this.node.params.get(i);if(s&&(n[i]=s.graph_node_id,t&&s.is_multiple&&s.components))for(var a=0,_=s.components;a<_.length;a++){var u=_[a];n[u.name]=u.graph_node_id}}return n},e.prototype.to_json_params=function(e){return void 0===e&&(e=!1),this.to_json_params_from_names(this.node.params.non_spare_names,e)},e.prototype.to_json_spare_params=function(e){return void 0===e&&(e=!1),this.to_json_params_from_names(this.node.params.spare_names,e)},e}();t.NodeSerializer=r},function(e,t,n){"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0});var o=n(3),i=n(55),s=n(513),a=n(536),_=n(537),u=n(283),c=n(538),p=n(539),l=n(284),d=n(541),h=n(542),f=n(543),m=n(544),y=n(545),v=n(25),g=n(207),b=((r={})[v.ParamType.BOOLEAN]=s.BooleanParam,r[v.ParamType.BUTTON]=a.ButtonParam,r[v.ParamType.COLOR]=_.ColorParam,r[v.ParamType.FLOAT]=u.FloatParam,r[v.ParamType.INTEGER]=c.IntegerParam,r[v.ParamType.OPERATOR_PATH]=p.OperatorPathParam,r[v.ParamType.RAMP]=l.RampParam,r[v.ParamType.SEPARATOR]=d.SeparatorParam,r[v.ParamType.STRING]=h.StringParam,r[v.ParamType.VECTOR2]=f.Vector2Param,r[v.ParamType.VECTOR3]=m.Vector3Param,r[v.ParamType.VECTOR4]=y.Vector4Param,r),O=function(){function e(e){this.node=e,this._param_create_mode=!1,this._params_by_name={},this._params_list=[],this._param_names=[],this._non_spare_params=[],this._spare_params=[],this._non_spare_param_names=[],this._spare_param_names=[],this._params_added_since_last_params_eval=!1}return e.prototype.init_dependency_node=function(){this._params_node||(this._params_node=new i.CoreGraphNode(this.node.scene,"params"),this.node.add_graph_input(this._params_node))},e.prototype.init=function(){this.init_dependency_node(),this._param_create_mode=!0,this.init_from_params_config(),this.node.create_params(),this._update_caches(),this._create_params_ui_data_dependencies(),this.init_param_accessors(),this._param_create_mode=!1},e.prototype.init_from_params_config=function(){var e=this.node.params_config;if(e)for(var t=0,n=Object.keys(e);t<n.length;t++){var r=n[t],o=e[r];this.add_param(o.type,r,o.init_value,o.options)}},e.prototype.init_param_accessors=function(){for(var e=function(e){Object.defineProperty(t.node.pv,e.name,{get:function(){return e.value}}),Object.defineProperty(t.node.p,e.name,{get:function(){return e}})},t=this,n=0,r=this.all;n<r.length;n++){e(r[n])}},Object.defineProperty(e.prototype,"params_node",{get:function(){return this._params_node},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"all",{get:function(){return this._params_list},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"non_spare",{get:function(){return this._non_spare_params},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"spare",{get:function(){return this._spare_params},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"names",{get:function(){return this._param_names},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"non_spare_names",{get:function(){return this._non_spare_param_names},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"spare_names",{get:function(){return this._spare_param_names},enumerable:!0,configurable:!0}),e.prototype.set_with_type=function(e,t,n){var r=this.param_with_type(e,n);r?r.set(t):console.warn("param "+e+" not found with type "+n)},e.prototype.set_float=function(e,t){this.set_with_type(e,t,v.ParamType.FLOAT)},e.prototype.set_vector3=function(e,t){this.set_with_type(e,t,v.ParamType.VECTOR3)},e.prototype.has_param=function(e){return null!=this._params_by_name[e]},e.prototype.has=function(e){return this.has_param(e)},e.prototype.get=function(e){return this.param(e)},e.prototype.param_with_type=function(e,t){var n=this.param(e);if(n&&n.type==t)return n},e.prototype.get_float=function(e){return this.param_with_type(e,v.ParamType.FLOAT)},e.prototype.get_operator_path=function(e){return this.param_with_type(e,v.ParamType.OPERATOR_PATH)},e.prototype.value=function(e){var t;return null===(t=this.param(e))||void 0===t?void 0:t.value},e.prototype.value_with_type=function(e,t){var n;return null===(n=this.param_with_type(e,t))||void 0===n?void 0:n.value},e.prototype.boolean=function(e){return this.value_with_type(e,v.ParamType.BOOLEAN)},e.prototype.float=function(e){return this.value_with_type(e,v.ParamType.FLOAT)},e.prototype.integer=function(e){return this.value_with_type(e,v.ParamType.INTEGER)},e.prototype.string=function(e){return this.value_with_type(e,v.ParamType.STRING)},e.prototype.vector2=function(e){return this.value_with_type(e,v.ParamType.VECTOR2)},e.prototype.vector3=function(e){return this.value_with_type(e,v.ParamType.VECTOR3)},e.prototype.color=function(e){return this.value_with_type(e,v.ParamType.COLOR)},e.prototype.param=function(e){var t=this._params_by_name[e];return null!=t?t:(console.warn("tried to access param '"+e+"' in node "+this.node.full_path()+", but existing params are: "+this.names),null)},e.prototype.delete_params=function(e){for(var t=0,n=e;t<n.length;t++){var r=n[t];this.delete_param(r)}this._update_caches()},e.prototype.delete_param=function(e){var t=this._params_by_name[e];if(!t)throw new Error("param '"+e+"' does not exist on node "+this.node.full_path());if(this._params_node&&this._params_node.remove_graph_input(this._params_by_name[e]),t.set_node(null),delete this._params_by_name[e],t.is_multiple&&t.components)for(var n=0,r=t.components;n<r.length;n++){var o=r[n].name;delete this._params_by_name[o]}t.emit(g.ParamEvent.DELETED)},e.prototype.add_param=function(e,t,n,r){void 0===r&&(r={});var o=r.spare||!1;!1!==this._param_create_mode||o||console.warn("node "+this.node.full_path()+" ("+this.node.type()+") param '"+t+"' cannot be created outside of create_params"),null==this.node.scene&&console.warn("node "+this.node.full_path()+" ("+this.node.type()+") has no scene assigned");var i=b[e];if(null!=i){var s=this._params_by_name[t];s&&(o?s.type!=e&&this.delete_param(s.name):console.warn("a param named "+t+" already exists",this.node));var a=new i(this.node.scene);return a.options.set(r),a.set_name(t),a.set_init_value(n),a.ui_data.set_folder_name(this.current_param_folder_name()),this._params_by_name[a.name]=a,a.set_node(this.node),this._params_added_since_last_params_eval=!0,a}},e.prototype._update_caches=function(){this._params_list=Object.values(this._params_by_name),this._param_names=Object.keys(this._params_by_name),this._non_spare_params=Object.values(this._params_by_name).filter((function(e){return!e.options.is_spare()})),this._spare_params=Object.values(this._params_by_name).filter((function(e){return e.options.is_spare()})),this._non_spare_param_names=Object.values(this._params_by_name).filter((function(e){return!e.options.is_spare()})).map((function(e){return e.name})),this._spare_param_names=Object.values(this._params_by_name).filter((function(e){return e.options.is_spare()})).map((function(e){return e.name}))},e.prototype._eval_param=function(e){return o.__awaiter(this,void 0,void 0,(function(){return o.__generator(this,(function(t){switch(t.label){case 0:return e.is_dirty?[4,e.compute()]:[3,2];case 1:return t.sent(),e.states.error.active&&this.node.states.error.set("param '"+e.name+"' error: "+e.states.error.message),[3,2];case 2:return[2]}}))}))},e.prototype.eval_params=function(e){return o.__awaiter(this,void 0,void 0,(function(){var t,n;return o.__generator(this,(function(r){switch(r.label){case 0:for(t=[],n=0;n<e.length;n++)t.push(this._eval_param(e[n]));return[4,Promise.all(t)];case 1:return r.sent(),this.node.states.error.active&&this.node.set_container(null),[2]}}))}))},e.prototype.eval_all=function(){return o.__awaiter(this,void 0,void 0,(function(){return o.__generator(this,(function(e){switch(e.label){case 0:return this._params_node&&(this._params_node.is_dirty||this._params_added_since_last_params_eval)?[4,this.eval_params(this._params_list)]:[3,2];case 1:e.sent(),this._params_node.remove_dirty_state(),this._params_added_since_last_params_eval=!1,e.label=2;case 2:return[2]}}))}))},e.prototype._create_params_ui_data_dependencies=function(){this._params_list.filter((function(e){return e.options.ui_data_depends_on_other_params()})).forEach((function(e){e.options.set_ui_data_dependency()}))},e.prototype.within_param_folder=function(e,t){var n=this._current_param_folder_name;this._current_param_folder_name=e,t(),this._current_param_folder_name=n},e.prototype.current_param_folder_name=function(){return this._current_param_folder_name},e}();t.ParamsController=O},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=r.__importDefault(n(41)),i=r.__importDefault(n(514)),s=r.__importDefault(n(45)),a=n(208),_=n(25),u=n(49),c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.type=function(){return _.ParamType.BOOLEAN},t.prototype.convert=function(e){return i.default(e)?e:o.default(e)?e>=1:s.default(e)&&u.CoreString.is_number(e)?parseFloat(e)>=1:null},t}(a.TypedNumericParam);t.BooleanParam=c},,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(281),o=n(517),i=n(534),s=n(535),a=n(25),_=function(){function e(e){this.param=e,this.parse_completed=!1,this.parse_started=!1,this.parsed_tree=new r.ParsedTree,this.function_generator=new o.FunctionGenerator(this.param),this.dependencies_controller=new s.DependenciesController(this.param)}return e.prototype.parse_expression=function(e){if(this.parse_started)throw new Error("parse in progress for param "+this.param.full_path());this.parse_started=!0,this.parse_completed=!1,this.parsed_tree=this.parsed_tree||new r.ParsedTree,this.reset(),this.param.type==a.ParamType.STRING?this.parsed_tree.parse_expression_for_string_param(e):this.parsed_tree.parse_expression(e),this.function_generator.parse_tree(this.parsed_tree),null==this.function_generator.error_message?(this.dependencies_controller.update(this.function_generator),this.dependencies_controller.error_message?this.param.states.error.set(this.dependencies_controller.error_message):(this.parse_completed=!0,this.parse_started=!1)):this.set_error(this.function_generator.error_message)},e.prototype.compute_function=function(){return this.compute_allowed()?this.function_generator.eval_function():new Promise((function(e,t){e(null)}))},e.prototype.reset=function(){this.parse_completed=!1,this.parse_started=!1,this._error_message=void 0,this.dependencies_controller.reset(),this.function_generator.reset()},e.prototype.set_error=function(e){this._error_message=this._error_message||e},Object.defineProperty(e.prototype,"is_errored",{get:function(){return null!=this._error_message},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"error_message",{get:function(){return this._error_message},enumerable:!0,configurable:!0}),e.prototype.compute_allowed=function(){return null==this._error_message&&this.function_generator.eval_allowed()},e.prototype.update_from_method_dependency_name_change=function(){var e;this.expression_string_generator=this.expression_string_generator||new i.ExpressionStringGenerator(this.param);var t=this.expression_string_generator.parse_tree(this.parsed_tree);null===(e=this.param.expression_controller)||void 0===e||e.set_expression(t),t&&this.parse_expression(t)},e}();t.ExpressionManager=_},,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=n(518),i=n(519),s=n(94),a={math_random:"random"},_=n(282),u=Object.keys(_.Easing),c={};["abs","acos","asin","atan","ceil","cos","exp","floor","max","min","pow","round","sign","sin","sqrt","tan"].forEach((function(e){c[e]="Math."+e})),Object.keys(a).forEach((function(e){var t=a[e];c[e]="Math."+t})),["fit","fit01","fract","deg2rad","rad2deg","rand","clamp"].forEach((function(e){c[e]="POLY.Core.Math."+e})),u.forEach((function(e){c[e]="POLY.Core.Math.Easing."+e})),["precision"].forEach((function(e){c[e]="POLY.Core.String."+e}));var p={if:o.LiteralConstructsController.if},l={};["PI","E"].forEach((function(e){l[e]="Math."+e}));var d=i.MethodModule,h=n(210),f={x:0,y:1,z:2,w:3,r:0,g:1,b:2},m=n(210),y=Object.getPrototypeOf((function(){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(e){return[2]}))}))})).constructor,v=function(e){function t(t){var n=e.call(this,t)||this;return n.param=t,n.function_pre_entities_loop_lines=[],n.methods=[],n.method_index=0,n.method_dependencies=[],n.immutable_dependencies=[],n}return r.__extends(t,e),t.prototype.parse_tree=function(e){if(this.reset(),null==e.error_message){try{if(this.function_pre_entities_loop_lines=[],e.node){var t=this.traverse_node(e.node);t&&null==this.error_message&&(this.function_main_string=t)}else console.warn("no parsed_tree.node")}catch(e){console.warn("error in expression for param "+this.param.full_path()),console.warn(e)}if(this.function_main_string)try{this.function=new y("param","methods","\n\t\t\t\t\ttry {\n\t\t\t\t\t\t"+this.function_body()+"\n\t\t\t\t\t} catch(e) {\n\t\t\t\t\t\tparam.states.error.set(e.message || e);\n\t\t\t\t\t\treturn null;\n\t\t\t\t\t}")}catch(e){console.warn(e),this.set_error("cannot generate function")}else this.set_error("cannot generate function body")}else this.set_error("cannot parse expression")},t.prototype.reset=function(){this.error_message=void 0,this.function_main_string=void 0,this.methods=[],this.method_index=0,this.function=void 0,this.method_dependencies=[],this.immutable_dependencies=[]},t.prototype.function_body=function(){return this.param.options.is_expression_for_entities?"\n\t\t\tconst entities = param.expression_controller.entities;\n\t\t\tif(entities){\n\t\t\t\treturn new Promise( async (resolve, reject)=>{\n\t\t\t\t\tlet entity;\n\t\t\t\t\tconst entity_callback = param.expression_controller.entity_callback;\n\t\t\t\t\t"+this.function_pre_entities_loop_lines.join(";\n")+"\n\t\t\t\t\tfor(let index=0; index < entities.length; index++){\n\t\t\t\t\t\tentity = entities[index];\n\t\t\t\t\t\tresult = "+this.function_main_string+";\n\t\t\t\t\t\tentity_callback(entity, result);\n\t\t\t\t\t}\n\t\t\t\t\tresolve()\n\t\t\t\t})\n\t\t\t}\n\t\t\treturn []":"\n\t\t\treturn new Promise( async (resolve, reject)=>{\n\t\t\t\tresolve("+this.function_main_string+")\n\t\t\t})\n\t\t\t"},t.prototype.eval_allowed=function(){return null!=this.function},t.prototype.eval_function=function(){if(this.function)return this.function(this.param,this.methods)},t.prototype.traverse_CallExpression=function(e){var t=this,n=e.arguments.map((function(e){return t.traverse_node(e)})),r=e.callee.name;if(r){var o=p[r];if(o)return o(n);var i=""+n.join(", "),s=c[r];if(s)return s+"("+i+")";if(d[r]){var a=e.arguments[0],_="return "+n[0],u=[];try{u=new Function(_)()}catch(e){}return this._create_method_and_dependencies(r,u,a),"(await methods["+this.method_index+"].process_arguments(["+i+"]))"}}this.set_error("unknown method: "+r)},t.prototype.traverse_BinaryExpression=function(e){return"("+this.traverse_node(e.left)+" "+e.operator+" "+this.traverse_node(e.right)+")"},t.prototype.traverse_LogicalExpression=function(e){return"("+this.traverse_node(e.left)+" "+e.operator+" "+this.traverse_node(e.right)+")"},t.prototype.traverse_MemberExpression=function(e){return this.traverse_node(e.object)+"."+this.traverse_node(e.property)},t.prototype.traverse_UnaryExpression=function(e){if("@"===e.operator){var t=e.argument,n=void 0,r=void 0;switch(t.type){case"Identifier":n=t.name;break;case"MemberExpression":var o=t,i=o.object,a=o.property;n=i.name,r=a.name}if(n){if("ptnum"==(n=s.CoreAttribute.remap_name(n)))return"((entity != null) ? entity.index : 0)";var _="attrib_"+n,u="attrib_size_"+n,c="array_"+n;return this.function_pre_entities_loop_lines.push("const "+_+" = entities[0].geometry().attributes['"+n+"']"),this.function_pre_entities_loop_lines.push("const "+u+" = "+_+".itemSize"),this.function_pre_entities_loop_lines.push("const "+c+" = "+_+".array"),r?c+"[entity.index*"+u+"+"+f[r]+"]":c+"[entity.index*"+u+"]"}return console.warn("attribute not found"),""}return""+e.operator+this.traverse_node(e.argument)},t.prototype.traverse_Literal=function(e){return""+e.raw},t.prototype.traverse_Identifier=function(e){if(e.name[0]!=h.VARIABLE_PREFIX)return e.name;var t=e.name.substr(1),n=l[t];if(n)return n;var r="traverse_Identifier_"+t;if(this[r])return this[r]();this.set_error("identifier unknown: "+e.name)},t.prototype.traverse_Identifier_F=function(){return this.immutable_dependencies.push(this.param.scene.time_controller.graph_node),"param.scene.time_controller.frame"},t.prototype.traverse_Identifier_FPS=function(){return this.immutable_dependencies.push(this.param.scene.time_controller.graph_node),"param.scene.time_controller.fps"},t.prototype.traverse_Identifier_T=function(){return this.immutable_dependencies.push(this.param.scene.time_controller.graph_node),"param.scene.time_controller.time"},t.prototype.traverse_Identifier_CH=function(){return"'"+this.param.name+"'"},t.prototype.traverse_Identifier_CEX=function(){return this._method_centroid("x")},t.prototype.traverse_Identifier_CEY=function(){return this._method_centroid("y")},t.prototype.traverse_Identifier_CEZ=function(){return this._method_centroid("z")},t.prototype._method_centroid=function(e){var t=[0,"'"+e+"'"].join(", ");return this._create_method_and_dependencies("centroid",0),"(await methods["+this.method_index+"].process_arguments(["+t+"]))"},t.prototype._create_method_and_dependencies=function(e,t,n){var r=new(0,d[e])(this.param);this.method_index+=1,this.methods[this.method_index]=r;var o=r.find_dependency(t);o&&(n&&o.set_jsep_node(n),this.method_dependencies.push(o))},t}(m.BaseTraverser);t.FunctionGenerator=v},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){}return e.if=function(e){return"("+e[0]+") ? ("+e[1]+") : ("+e[2]+")"},e}();t.LiteralConstructsController=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(520),o=n(522),i=n(523),s=n(524),a=n(525),_=n(526),u=n(527),c=n(528),p=n(529),l=n(530),d=n(531),h=n(532),f=n(533);t.MethodModule={bbox:r.Bbox,ch:i.Ch,centroid:o.Centroid,cop_res:a.CopRes,local:_.Local,opdigits:u.Opdigits,point:c.Point,points_count:p.PointsCount,copy:s.Copy,str_chars_count:l.StrCharsCount,str_concat:d.StrConcat,str_index:h.StrIndex,str_sub:f.StrSub}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=n(46),i=n(1),s=["min","max","size","center"],a=["x","y","z"],_=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.required_arguments=function(){return[["string","path to node"],["string","vector name, min, max, size or center"],["string","component_name, x,y or z"]]},t.prototype.find_dependency=function(e){return this.create_dependency_from_index_or_path(e)},t.prototype.process_arguments=function(e){var t=this,n=0;return new Promise((function(o,i){return r.__awaiter(t,void 0,void 0,(function(){var t,s,a,_,u;return r.__generator(this,(function(r){switch(r.label){case 0:if(3!=e.length)return[3,5];t=e[0],s=e[1],a=e[2],_=null,r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this.get_referenced_node_container(t)];case 2:return _=r.sent(),[3,4];case 3:return u=r.sent(),i(u),[3,4];case 4:return _&&(n=this._get_value_from_container(_,s,a),o(n)),[3,6];case 5:o(0),r.label=6;case 6:return[2]}}))}))}))},t.prototype._get_value_from_container=function(e,t,n){if(s.indexOf(t)>=0){var r=e.bounding_box(),o=new i.Vector3;switch(t){case"size":r.getSize(o);break;case"center":r.getCenter(o);break;default:o=r[t]}return a.indexOf(n)>=0?o[n]:-1}return-1},t}(o.BaseMethod);t.Bbox=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=r.__importDefault(n(41)),i=n(209),s=n(55),a=n(143),_=n(81),u=function(e){function t(t,n,r){var o=e.call(this,t.scene,"MethodDependency")||this;return o.param=t,o.path_argument=n,o.decomposed_path=r,o.add_post_dirty_hook(o._update_from_name_change.bind(o)),o}return r.__extends(t,e),t.prototype._update_from_name_change=function(e){if(a.CoreObject.is_a(e,_.TypedNode)&&this.decomposed_path){var t=e;this.decomposed_path.update_from_name_change(t);var n=this.decomposed_path.to_path(),r=this.jsep_node;r&&(r.value=(""+r.value).replace(""+this.path_argument,n),r.raw=r.raw.replace(""+this.path_argument,n)),this.param.expression_controller&&this.param.expression_controller.update_from_method_dependency_name_change()}},t.prototype.reset=function(){this.graph_disconnect_predecessors()},t.prototype.listen_for_name_changes=function(){var e=this;this.jsep_node&&this.decomposed_path&&this.decomposed_path.named_nodes.forEach((function(t){t&&t instanceof _.BaseNodeClass&&e.add_graph_input(t.name_controller.graph_node)}))},t.prototype.set_jsep_node=function(e){this.jsep_node=e},t.prototype.set_resolved_graph_node=function(e){this.resolved_graph_node=e},t.prototype.set_unresolved_path=function(e){this.unresolved_path=e},t.create=function(e,n,r,s){var a=o.default(n),_=void 0;if(s){_=new i.DecomposedPath;for(var u=0,c=s;u<c.length;u++){var p=c[u];_.add_node(p.name,p)}}var l=new t(e,n,_);if(r)l.set_resolved_graph_node(r);else if(!a){var d=n;l.set_unresolved_path(d)}return l},t}(s.CoreGraphNode);t.MethodDependency=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.required_arguments=function(){return[["string","path to node"],["string","component_name, x,y or z"]]},t.prototype.find_dependency=function(e){return this.create_dependency_from_index_or_path(e)},t.prototype.process_arguments=function(e){var t=this;return new Promise((function(n,o){return r.__awaiter(t,void 0,void 0,(function(){var t,i,s,a,_,u,c;return r.__generator(this,(function(r){switch(r.label){case 0:if(2!=e.length)return[3,5];t=e[0],i=e[1],s=null,r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this.get_referenced_node_container(t)];case 2:return s=r.sent(),[3,4];case 3:return a=r.sent(),o(a),[3,4];case 4:return s&&(_=s.bounding_box(),u=_.min.clone().add(_.max).multiplyScalar(.5),c=u[i],n(null!=c?c:0)),[3,6];case 5:n(0),r.label=6;case 6:return[2]}}))}))}))},t}(n(46).BaseMethod);t.Centroid=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=n(46),i=n(209),s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.required_arguments=function(){return[["string","path to param"]]},t.prototype.find_dependency=function(e){var t=new i.DecomposedPath,n=this.get_referenced_param(e,t);return n?this.create_dependency(n,e,t):null},t.prototype.process_arguments=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,n,o,i;return r.__generator(this,(function(r){switch(r.label){case 0:return t=0,1!=e.length?[3,2]:(n=e[0],(o=this.get_referenced_param(n))?[4,o.compute()]:[3,2]);case 1:r.sent(),null!=(i=o.value)&&(t=i),r.label=2;case 2:return[2,t]}}))}))},t}(o.BaseMethod);t.Ch=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=n(46),i=n(92),s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.required_arguments=function(){return[["string","path to copy"],["integer","default value"]]},t.optional_arguments=function(){return[["string","attribute name (optional)"]]},t.prototype.find_dependency=function(e){var t=this.find_referenced_graph_node(e);if(t&&"copy"==t.type()){var n=t.stamp_node;return this.create_dependency(n,e)}return null},t.prototype.process_arguments=function(e){var t=this;return new Promise((function(n,r){if(2==e.length||3==e.length){var o=e[0],s=e[1],a=e[2],_=i.CoreWalker.find_node(t.node,o),u=void 0;_&&"copy"==_.type()&&(u=_.stamp_value(a)),null==u&&(u=s),n(u)}else n(0)}))},t}(o.BaseMethod);t.Copy=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.required_arguments=function(){return[["string","path to node"],["string","component_name: x or y"]]},t.prototype.find_dependency=function(e){return this.create_dependency_from_index_or_path(e)},t.prototype.process_arguments=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,n,o,i,s;return r.__generator(this,(function(r){switch(r.label){case 0:return t=0,2!=e.length?[3,2]:(n=e[0],o=e[1],[4,this.get_referenced_node_container(n)]);case 1:(i=r.sent())&&(s=i.resolution(),[0,"0","x"].includes(o)?t=s[0]:[1,"1","y"].includes(o)&&(t=s[1])),r.label=2;case 2:return[2,t]}}))}))},t}(n(46).BaseMethod);t.CopRes=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.required_arguments=function(){return[["string","path"]]},t.prototype.process_arguments=function(e){var t=this;return new Promise((function(n,r){t.request_asset_url(e[0]).then((function(e){n(e)}))}))},t.prototype.request_asset_url=function(e){var t=this;return new Promise((function(n,r){if(!POLY.desktop_controller().active())return n("");POLY.desktop_controller().add_local_path(e,t.param),n(POLY.desktop_controller().local_path_server_url(e))}))},t}(n(46).BaseMethod);t.Local=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=n(46),i=n(81),s=n(49),a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.required_arguments=function(){return[["string","path to node"]]},t.prototype.find_dependency=function(e){var t=this.find_referenced_graph_node(e);if(t&&t instanceof i.BaseNodeClass){var n=t.name_controller.graph_node;return this.create_dependency(n,e)}return null},t.prototype.process_arguments=function(e){var t=this;return new Promise((function(n,r){if(1==e.length){var o=e[0],i=t.get_referenced_node(o);if(i){var a=i.name;n(s.CoreString.tail_digits(a))}else n(0)}else n(0)}))},t}(o.BaseMethod);t.Opdigits=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.required_arguments=function(){return[["string","path to node"],["index","point index"],["string","attribute name"]]},t.prototype.find_dependency=function(e){return this.create_dependency_from_index_or_path(e)},t.prototype.process_arguments=function(e){var t=this;return new Promise((function(n,o){return r.__awaiter(t,void 0,void 0,(function(){var t,i,s,a,_,u;return r.__generator(this,(function(r){switch(r.label){case 0:if(3!=e.length)return[3,5];t=e[0],i=e[1],s=e[2],a=null,r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this.get_referenced_node_container(t)];case 2:return a=r.sent(),[3,4];case 3:return _=r.sent(),o(_),[3,4];case 4:return a&&(u=this._get_value_from_container(a,i,s),n(u)),[3,6];case 5:n(0),r.label=6;case 6:return[2]}}))}))}))},t.prototype._get_value_from_container=function(e,t,n){var r=e.core_content();if(r){var o=r.points()[n];return o?o.attrib_value(t):0}return null},t}(n(46).BaseMethod);t.Point=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.required_arguments=function(){return[["string","path to node"]]},t.prototype.find_dependency=function(e){return this.create_dependency_from_index_or_path(e)},t.prototype.process_arguments=function(e){var t=this;return new Promise((function(n,o){return r.__awaiter(t,void 0,void 0,(function(){var t,i,s,a;return r.__generator(this,(function(r){switch(r.label){case 0:if(1!=e.length)return[3,5];t=e[0],i=void 0,r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this.get_referenced_node_container(t)];case 2:return i=r.sent(),[3,4];case 3:return s=r.sent(),o(s),[2];case 4:return i&&(a=i.points_count(),n(a)),[3,6];case 5:n(0),r.label=6;case 6:return[2]}}))}))}))},t}(n(46).BaseMethod);t.PointsCount=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.required_arguments=function(){return[["string","string to count characters of"]]},t.prototype.process_arguments=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,n;return r.__generator(this,(function(r){return t=0,1==e.length&&(n=e[0],t=n.length),[2,t]}))}))},t}(n(46).BaseMethod);t.StrCharsCount=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.required_arguments=function(){return[]},t.prototype.process_arguments=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,n,o,i;return r.__generator(this,(function(r){for(t="",n=0,o=e;n<o.length;n++)null==(i=o[n])&&(i=""),t+=""+i;return[2,t]}))}))},t}(n(46).BaseMethod);t.StrConcat=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.required_arguments=function(){return[["string","string to get index from"],["string","char to find index of"]]},t.prototype.process_arguments=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,n,o;return r.__generator(this,(function(r){return t=-1,2==e.length&&(n=e[0],o=e[1],t=n.indexOf(o)),[2,t]}))}))},t}(n(46).BaseMethod);t.StrIndex=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.required_arguments=function(){return[["string","string to get range from"],["integer","range start"],["integer","range size"]]},t.prototype.process_arguments=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,n,o,i;return r.__generator(this,(function(r){return t="",n=e[0],o=e[1]||0,i=e[2]||1,n&&(t=n.substr(o,i)),[2,t]}))}))},t}(n(46).BaseMethod);t.StrSub=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=function(e){function t(t){var n=e.call(this,t)||this;return n.param=t,n}return r.__extends(t,e),t.prototype.parse_tree=function(e){if(null==e.error_message&&e.node)try{return this.traverse_node(e.node)}catch(e){this.set_error("could not traverse tree")}else this.set_error("cannot parse tree")},t.prototype.traverse_CallExpression=function(e){var t=this,n=""+e.arguments.map((function(e){return t.traverse_node(e)})).join(", ");return e.callee.name+"("+n+")"},t.prototype.traverse_UnaryExpression=function(e){return""+e.operator+this.traverse_node(e.argument)},t.prototype.traverse_Identifier=function(e){return""+e.name},t}(n(210).BaseTraverser);t.ExpressionStringGenerator=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this.param=e,this.cyclic_graph_detected=!1,this.method_dependencies=[]}return e.prototype.set_error=function(e){this.error_message=this.error_message||e},e.prototype.reset=function(){this.param.graph_disconnect_predecessors(),this.method_dependencies.forEach((function(e){e.reset()})),this.method_dependencies=[]},e.prototype.update=function(e){this.cyclic_graph_detected=!1,this.connect_immutable_dependencies(e),this.method_dependencies=e.method_dependencies,this.handle_method_dependencies(),this.listen_for_name_changes()},e.prototype.connect_immutable_dependencies=function(e){var t=this;e.immutable_dependencies.forEach((function(e){if(0==t.cyclic_graph_detected&&0==t.param.add_graph_input(e))return t.cyclic_graph_detected=!0,t.set_error("cannot create expression, infinite graph detected"),void t.reset()}))},e.prototype.handle_method_dependencies=function(){var e=this;this.method_dependencies.forEach((function(t){0==e.cyclic_graph_detected&&e.handle_method_dependency(t)}))},e.prototype.handle_method_dependency=function(e){var t=e.resolved_graph_node;if(t&&!this.param.add_graph_input(t))return this.cyclic_graph_detected=!0,this.set_error("cannot create expression, infinite graph detected"),void this.reset()},e.prototype.listen_for_name_changes=function(){this.method_dependencies.forEach((function(e){e.listen_for_name_changes()}))},e}();t.DependenciesController=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=n(103),i=n(25),s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.type=function(){return i.ParamType.BUTTON},t.prototype.press_button=function(){this.options.execute_callback()},t}(o.Single);t.ButtonParam=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=n(146),i=n(6),s=n(25),a=["r","g","b"],_=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._value=new i.Color,t}return r.__extends(t,e),t.type=function(){return s.ParamType.COLOR},Object.defineProperty(t,"component_names",{get:function(){return a},enumerable:!0,configurable:!0}),t.prototype.init_components=function(){e.prototype.init_components.call(this),this.r=this.components[0],this.g=this.components[1],this.b=this.components[2]},t.prototype.set_value_from_components=function(){this._value.r=this.r.value,this._value.g=this.g.value,this._value.b=this.b.value},t}(o.TypedMultipleParam);t.ColorParam=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=r.__importDefault(n(41)),i=n(208),s=n(25),a=n(49),_=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.type=function(){return s.ParamType.INTEGER},t.prototype.convert=function(e){if(o.default(e))return Math.round(e);if(a.CoreString.is_number(e)){var t=parseInt(e);if(o.default(t))return t}return null},t}(i.TypedNumericParam);t.IntegerParam=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=n(103),i=n(92),s=n(25),a=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._found_node=null,t}return r.__extends(t,e),t.type=function(){return s.ParamType.OPERATOR_PATH},t.prototype.accepts_visitor=function(e){return e.visit_operator_path_param(this)},t.prototype.set=function(e){this._value=e},t.prototype.process_computation=function(){var e;return r.__awaiter(this,void 0,void 0,(function(){var t,n,o,s,a;return r.__generator(this,(function(r){return t=this._value,n=null,null!=t&&""!==t&&(n=i.CoreWalker.find_node(this.node,t)),this._found_node!==n&&(o=this.options.dependent_on_found_node(),this._found_node&&o&&this.remove_graph_input(this._found_node),this._found_node=n,n&&(s=this.options.node_selection_context,a=null===(e=n.parent)||void 0===e?void 0:e.children_controller.context,s==a||null==s?o&&this.add_graph_input(n):this.states.error.set("node context is "+s+" but the params expects a "+a))),[2]}))}))},t.prototype.found_node=function(){return this._found_node},t}(o.Single);t.OperatorPathParam=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(13),o=function(){function e(e,t){this._position=e,this._value=t}return e.prototype.to_json=function(){return{position:this._position,value:this._value}},e.prototype.position=function(){return this._position},Object.defineProperty(e.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0}),e.prototype.is_equal=function(e){return this._position==e.position()&&this._value==e.value},e}();t.RampPoint=o;var i=function(){function e(e,t){this._interpolation=e,this._points=t,this._uuid=r._Math.generateUUID()}return e.prototype.uuid=function(){return this._uuid},e.from_json=function(t){for(var n=[],r=0,i=t.points;r<i.length;r++){var s=i[r];n.push(new o(s.position,s.value))}return new e(t.interpolation,n)},e.prototype.to_json=function(){return{interpolation:this._interpolation,points:this._points.map((function(e){return e.to_json()}))}},e.prototype.interpolation=function(){return this._interpolation},e.prototype.points=function(){return this._points},e.prototype.is_equal=function(e){var t=!0;this._interpolation!=e.interpolation()&&(t=!1);var n=e.points();if(t&&this._points.length!=n.length&&(t=!1),t)for(var r=0,o=0,i=this._points;o<i.length;o++){var s=i[o],a=n[r];s.is_equal(a)||(t=!1),r+=1}return t},e}();t.RampValue=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=n(103),i=n(25),s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.type=function(){return i.ParamType.SEPARATOR},t}(o.Single);t.SeparatorParam=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=r.__importDefault(n(45)),i=n(103),s=n(281),a=n(25),_=n(280),u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.type=function(){return a.ParamType.STRING},t.prototype.accepts_visitor=function(e){return e.visit_string_param(this)},t.prototype.convert=function(e){return o.default(e)?e:""+e},t.prototype.set=function(e){this.states.error.clear(),this._value_elements(e).length>=3?(this._expression_controller=this._expression_controller||new _.ExpressionController(this),e!=this._expression_controller.expression&&(this._expression_controller.set_expression(e),this.set_dirty())):e!=this._value&&(this._value=e,this.remove_dirty_state(),this.set_successors_dirty())},t.prototype.process_computation=function(){var e;return r.__awaiter(this,void 0,void 0,(function(){var t,n;return r.__generator(this,(function(r){switch(r.label){case 0:return null===(e=this.expression_controller)||void 0===e||!e.active||this.expression_controller.requires_entities?[3,2]:[4,this.expression_controller.compute_expression()];case 1:t=r.sent(),this.expression_controller.is_errored?this.states.error.set("expression error: "+this.expression_controller.error_message):((n=this.convert(t))?this._value=n:this.states.error.set("expression returns an invalid type ("+t+")"),this.remove_dirty_state()),r.label=2;case 2:return[2]}}))}))},t.prototype._value_elements=function(e){return s.ParsedTree.string_value_elements(e)},t}(i.Single);t.StringParam=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=n(146),i=n(2),s=n(25),a=["x","y"],_=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._value=new i.Vector2,t}return r.__extends(t,e),t.type=function(){return s.ParamType.VECTOR2},Object.defineProperty(t,"component_names",{get:function(){return a},enumerable:!0,configurable:!0}),t.prototype.init_components=function(){e.prototype.init_components.call(this),this.x=this.components[0],this.y=this.components[1]},t.prototype.set_value_from_components=function(){this._value.x=this.x.value,this._value.y=this.y.value},t}(o.TypedMultipleParam);t.Vector2Param=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=n(146),i=n(1),s=n(25),a=["x","y","z"],_=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._value=new i.Vector3,t}return r.__extends(t,e),t.type=function(){return s.ParamType.VECTOR3},Object.defineProperty(t,"component_names",{get:function(){return a},enumerable:!0,configurable:!0}),t.prototype.init_components=function(){e.prototype.init_components.call(this),this.x=this.components[0],this.y=this.components[1],this.z=this.components[2]},t.prototype.set_value_from_components=function(){this._value.x=this.x.value,this._value.y=this.y.value,this._value.z=this.z.value},t}(o.TypedMultipleParam);t.Vector3Param=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=n(146),i=n(17),s=n(25),a=["x","y","z","w"],_=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._value=new i.Vector4,t}return r.__extends(t,e),t.type=function(){return s.ParamType.VECTOR4},Object.defineProperty(t,"component_names",{get:function(){return a},enumerable:!0,configurable:!0}),t.prototype.init_components=function(){e.prototype.init_components.call(this),this.x=this.components[0],this.y=this.components[1],this.z=this.components[2],this.w=this.components[3]},t.prototype.set_value_from_components=function(){this._value.x=this.x.value,this._value.y=this.y.value,this._value.z=this.z.value,this._value.w=this.w.value},t}(o.TypedMultipleParam);t.Vector4Param=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(e){this.node=e};t.ParamsValueAccessor=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this._frame=0}return e.prototype.copy=function(e){this._frame=e.frame},Object.defineProperty(e.prototype,"frame",{get:function(){return this._frame},enumerable:!0,configurable:!0}),e}();t.ProcessingContext=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(549),o=n(550),i=n(552),s=function(){function e(e){this.node=e,this._connections=new r.ConnectionsController(this.node)}return Object.defineProperty(e.prototype,"connections",{get:function(){return this._connections},enumerable:!0,configurable:!0}),e.prototype.init_inputs=function(e){this.inputs.set_options(e)},Object.defineProperty(e.prototype,"inputs",{get:function(){return this._inputs=this._inputs||new o.InputsController(this.node)},enumerable:!0,configurable:!0}),e.prototype.has_inputs=function(){return null!=this._inputs},Object.defineProperty(e.prototype,"outputs",{get:function(){return this._outputs=this._outputs||new i.OutputsController(this.node)},enumerable:!0,configurable:!0}),e.prototype.has_outputs=function(){return null!=this._outputs},e}();t.IOController=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3).__importDefault(n(91)),o=function(){function e(e){this._node=e,this._input_connections=[],this._output_connections={}}return e.prototype.add_input_connection=function(e){this._input_connections[e.input_index]=e},e.prototype.add_output_connection=function(e){var t=e.output_index,n=e.uuid;this._output_connections[t]=this._output_connections[t]||{},this._output_connections[t][n]=e},e.prototype.remove_input_connection=function(e){this._input_connections[e.input_index]=null},e.prototype.remove_output_connection=function(e){var t=e.output_index,n=e.uuid;delete this._output_connections[t][n]},e.prototype.input_connection=function(e){return this._input_connections[e]},e.prototype.first_input_connection=function(){return r.default(this._input_connections)[0]},e.prototype.last_input_connection=function(){var e=r.default(this._input_connections);return e[e.length-1]},e.prototype.input_connections=function(){return this._input_connections},e.prototype.output_connections=function(){var e=this,t=[];return Object.keys(this._output_connections).forEach((function(n){var r=e._output_connections[n];Object.keys(r).forEach((function(e){t.push(r[e])}))})),t},e}();t.ConnectionsController=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=r.__importDefault(n(135)),i=r.__importDefault(n(45)),s=n(551),a=n(55),_=n(64),u=n(19),c=n(211),p=function(){function e(e,t){void 0===t&&(t={}),this.node=e,this._graph_node_inputs=[],this._inputs=[],this._has_named_inputs=!1,this._named_inputs=[],this._min_inputs_count=0,this._max_inputs_count=0,this._depends_on_inputs=!0,this._override_clonable_state=!1,this.set_options(t)}return e.prototype.set_options=function(e){e.min_inputs&&this.set_min_inputs_count(e.min_inputs),e.max_inputs&&this.set_max_inputs_count(e.max_inputs),e.depends_on_inputs&&this.set_depends_on_inputs(e.depends_on_inputs)},e.displayed_input_names=function(){return[]},e.prototype.set_depends_on_inputs=function(e){this._depends_on_inputs=e},e.prototype.set_min_inputs_count=function(e){this._min_inputs_count=e},e.prototype.set_max_inputs_count=function(e){this._max_inputs_count=e,this._init_graph_node_inputs()},e.prototype.set_named_inputs=function(e){this._has_named_inputs=!0,this._named_inputs=e,this.set_min_inputs_count(0),this.set_max_inputs_count(e.length),this.node.emit(_.NodeEvent.NAMED_INPUTS_UPDATED)},e.prototype.has_named_inputs=function(){return this._has_named_inputs},e.prototype.named_inputs=function(){return this._named_inputs},e.prototype._init_graph_node_inputs=function(){for(var e=0;e<this._max_inputs_count;e++)this._graph_node_inputs[e]=this._graph_node_inputs[e]||this._create_graph_node_input(e)},e.prototype._create_graph_node_input=function(e){var t=new a.CoreGraphNode(this.node.scene,"input_"+e);return this.node.add_graph_input(t),t},e.prototype.max_inputs_count=function(){return this._max_inputs_count||0},e.prototype.input_graph_node=function(e){return this._graph_node_inputs[e]},e.prototype.set_count_to_zero=function(){this.set_min_inputs_count(0),this.set_max_inputs_count(0),this.init_inputs_clonable_state()},e.prototype.set_count_to_one_max=function(){this.set_min_inputs_count(0),this.set_max_inputs_count(1),this.init_inputs_clonable_state()},e.prototype.set_count=function(e,t){null==t&&(t=e),this.set_min_inputs_count(e),this.set_max_inputs_count(t),this.init_inputs_clonable_state()},e.prototype.eval_required_inputs_p=function(){return r.__awaiter(this,void 0,void 0,(function(){var e,t,n,o=this;return r.__generator(this,(function(r){switch(r.label){case 0:return e=[],this._max_inputs_count>0?(t=[],this.inputs().forEach((function(e,n){e&&t.push(n)})),t.length<this._min_inputs_count?(this.node.states.error.set("inputs are missing"),[3,3]):[3,1]):[3,3];case 1:return t.length>0?(n=t.map((function(e){return o.node.io.inputs.eval_required_input(e)})),[4,Promise.all(n)]):[3,3];case 2:e=r.sent(),r.label=3;case 3:return[2,e]}}))}))},e.prototype.eval_required_input=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,n,o;return r.__generator(this,(function(r){switch(r.label){case 0:return[4,this.node.container_controller.request_input_container(e)];case 1:return(t=r.sent())&&t.core_content()||(n=this.input(e))&&(o=n.states.error.message,this.node.states.error.set("input "+e+" is invalid (error: "+o+")")),[2,t]}}))}))},e.prototype._get_named_input_index_without_error=function(e){var t=this.named_inputs(),n=-1;return t.forEach((function(t,r){t.name()==e&&(n=r)})),n},e.prototype.get_named_input_index=function(e){var t=this._get_named_input_index_without_error(e);if(null==t){var n=this.named_inputs(),r=n.map((function(e){return e.name()})).join(", ");throw console.log("named_inputs",n),new Error(this.node.full_path()+": no inputs named '"+e+"'. available names are '"+r+"' ("+n.length+" inputs)")}return t},e.prototype.get_input_index=function(e){if(i.default(e)){if(this.has_named_inputs())return this.get_named_input_index(e);throw new Error("node "+this.node.full_path()+" has no named inputs")}return e},e.prototype.set_input=function(e,t,n){void 0===n&&(n=0);var r=this.get_input_index(e)||0,o=0;t&&t.io.outputs.has_named_outputs()&&(o=t.io.outputs.get_output_index(n)||0);var i=this._graph_node_inputs[r];if(null==i)throw"graph_input_node not found at index "+r;if(!t||this.node.parent==t.parent){var a=this._inputs[r],u=null,c=this.node.io.connections.input_connection(r);c&&(u=c.output_index),t===a&&o==u||(null!=a&&this._depends_on_inputs&&i.remove_graph_input(a),null!=t?i.add_graph_input(t)?(this._depends_on_inputs||i.remove_graph_input(t),c&&c.disconnect({set_input:!1}),this._inputs[r]=t,new s.NodeConnection(t,this.node,o,r)):console.warn("cannot connect "+t.full_path()+" to "+this.node.full_path()):(this._inputs[r]=null,c&&c.disconnect({set_input:!1})),this.post_set_input(),this.node.set_dirty(t),this.node.emit(_.NodeEvent.INPUTS_UPDATED))}},e.prototype.post_set_input=function(){},e.prototype.remove_input=function(e){var t=this;o.default(this.inputs(),(function(n,r){null!=n&&null!=e&&n.graph_node_id===e.graph_node_id&&t.set_input(r,null)}))},e.prototype.input=function(e){return this._inputs[e]},e.prototype.named_input=function(e){if(this.has_named_inputs()){var t=this.get_input_index(e);return this._inputs[t]}throw new Error(this.node.full_path()+" has no named inputs")},e.prototype.named_connection=function(e){if(this.has_named_inputs()){var t=this.get_input_index(e);return this._named_inputs[t]}throw new Error(this.node.full_path()+" has no named inputs")},e.prototype.has_named_input=function(e){return null!=this._get_named_input_index_without_error(e)},e.prototype.has_input=function(e){return null!=this._inputs[e]},e.prototype.inputs=function(){return this._inputs},e.prototype.override_clonable_state_allowed=function(){for(var e=!1,t=0,n=this.inputs_clonable_state();t<n.length;t++){n[t]==u.InputCloneMode.FROM_NODE&&(e=!0)}return e},e.prototype.inputs_clonable_state=function(){return this._inputs_clonable_states=this._inputs_clonable_states||this.init_inputs_clonable_state()},e.prototype.input_cloned=function(e){return this.input_clonable_state_with_override(e)},e.prototype.inputs_clonable_state_with_override=function(){for(var e=[],t=this.inputs_clonable_state(),n=0;n<t.length;n++)e.push(this.input_clonable_state_with_override(n));return e},e.prototype.input_clonable_state_with_override=function(e){var t=this.inputs_clonable_state()[e];switch(t){case u.InputCloneMode.ALWAYS:return!0;case u.InputCloneMode.NEVER:return!1;case u.InputCloneMode.FROM_NODE:return!this._override_clonable_state}return c.TypeAssert.unreachable(t)},e.prototype.init_inputs_clonable_state=function(e){return void 0===e&&(e=null),e&&(this._user_inputs_clonable_states=e),this._inputs_clonable_states=this._user_inputs_clonable_states||this._default_inputs_clonale_state_values(),this._inputs_clonable_states},e.prototype._default_inputs_clonale_state_values=function(){for(var e=[],t=0;t<this._max_inputs_count;t++)e.push(u.InputCloneMode.ALWAYS);return e},e.prototype.set_override_clonable_state=function(e){this._override_clonable_state=e,this.node.emit(_.NodeEvent.OVERRIDE_CLONABLE_STATE_UPDATE)},e.prototype.override_clonable_state=function(){return this._override_clonable_state},e}();t.InputsController=p},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(13);!function(e){e.GEOMETRY="geometry",e.MATRIX="matrix",e.INT="int",e.FLOAT="float",e.BOOL="bool",e.VEC2="vec2",e.VEC3="vec3",e.VEC4="vec4",e.MAT3="mat3",e.RGB="rgb",e.RGBA="rgba"}(t.ConnectionType||(t.ConnectionType={}));var o=function(){function e(e,t,n,o){void 0===n&&(n=0),void 0===o&&(o=0),this._node_src=e,this._node_dest=t,this._output_index=n,this._input_index=o,this._uuid=r._Math.generateUUID(),this._node_src.io.connections.add_output_connection(this),this._node_dest.io.connections.add_input_connection(this)}return Object.defineProperty(e.prototype,"uuid",{get:function(){return this._uuid},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"node_src",{get:function(){return this._node_src},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"node_dest",{get:function(){return this._node_dest},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"output_index",{get:function(){return this._output_index},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"input_index",{get:function(){return this._input_index},enumerable:!0,configurable:!0}),e.prototype.disconnect=function(e){void 0===e&&(e={}),this._node_src.io.connections.remove_output_connection(this),this._node_dest.io.connections.remove_input_connection(this),!0===e.set_input&&this._node_dest.io.inputs.set_input(this._input_index,null)},e}();t.NodeConnection=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=r.__importDefault(n(41)),i=r.__importDefault(n(102)),s=r.__importDefault(n(45)),a=n(64),_=function(){function e(e){this.node=e,this._has_outputs=!1,this._named_outputs=[],this._has_named_outputs=!1}return e.prototype.init=function(e){null==e&&(e={}),null==e.has_outputs&&(e.has_outputs=!0),this._has_outputs=e.has_outputs},e.prototype.has_outputs=function(){return this._has_outputs},e.prototype.has_named_outputs=function(){return this._has_named_outputs},e.prototype.has_named_output=function(e){return null!=this._get_named_output_index_without_error(e)},e.prototype.named_outputs=function(){return this._named_outputs},e.prototype.named_output=function(e){return this._named_outputs[e]},e.prototype._get_named_output_index_without_error=function(e){var t=this.named_outputs(),n=-1;return t.forEach((function(t,r){t.name()==e&&(n=r)})),n},e.prototype.get_named_output_index=function(e){var t=this._get_named_output_index_without_error(e);if(null==t){var n=this.named_outputs().map((function(e){return e.name()})).join(", ");throw new Error("no outputs named '"+e+"'. available names are "+n)}return t},e.prototype.get_output_index=function(e){return e?s.default(e)?this.has_named_outputs()?this.get_named_output_index(e):(console.warn("node "+this.node.full_path()+" has no named outputs"),-1):e:-1},e.prototype.named_output_by_name=function(e){return this._named_outputs.filter((function(t){return t.name()==e}))[0]},e.prototype.set_named_outputs=function(e){this._has_named_outputs=!0,this._named_outputs=e,this.node.scene&&this.node.set_dirty(this.node),this.node.emit(a.NodeEvent.NAMED_OUTPUTS_UPDATED)},e.prototype.used_output_names=function(){var e=this,t=i.default(this.node.io.connections.output_connections().map((function(e){return e?e.output_index:null}))),n=[];return t.forEach((function(e){o.default(e)&&n.push(e)})),n.map((function(t){return e.named_outputs()[t].name()}))},e}();t.OutputsController=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=r.__importDefault(n(272)),i=r.__importDefault(n(554)),s=r.__importDefault(n(264)),a=r.__importDefault(n(279)),_=n(64),u=function(e){function t(t){var n=e.call(this)||this;return n._node=t,n._node_ids=[],n}return r.__extends(t,e),t.prototype.node=function(){return this._node},t.prototype.clear=function(){this._node_ids=[]},t.prototype.nodes=function(){return this._node.scene.graph.nodes_from_ids(this._node_ids)},t.prototype.contains=function(e){return this._node_ids.includes(e.graph_node_id)},t.prototype.equals=function(e){var t=e.map((function(e){return e.graph_node_id})).sort();return a.default(t,this._node_ids)},t.prototype.set=function(e){return this.remove(this.nodes()),this.add(e)},t.prototype.add=function(e){var t=e.map((function(e){return e.graph_node_id}));return this._node_ids=s.default(this._node_ids,t),this.update_nodes_ui_data(e)},t.prototype.remove=function(e){var t=e.map((function(e){return e.graph_node_id}));this._node_ids=i.default(this._node_ids,t),this.update_nodes_ui_data(e)},t.prototype.update_nodes_ui_data=function(e){this.node().emit(_.NodeEvent.SELECTION_UPDATED)},t.prototype.to_json=function(){return this._node_ids},t}(o.default);t.default=u},,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(e){this.node=e};t.ParamsAccessor=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.set_content=function(t){e.prototype.set_content.call(this,t)},t}(n(119).TypedContainer);t.ManagerContainer=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=r.__importDefault(n(102)),i=r.__importDefault(n(178)),s=r.__importDefault(n(93)),a=n(559),_=function(){function e(){this._started=!1,this._start_time=0,this._previous_timestamp=0,this._nodes_cook_data={},this._durations_by_name={},this._durations_count_by_name={}}return e.prototype.profile=function(e,t){var n=performance.now();t();var r=performance.now()-n;console.log(e+": "+r)},e.prototype.start=function(){this._started||(this.reset(),this._started=!0,this._start_time=performance.now(),this._nodes_cook_data={},this._previous_timestamp=this._start_time)},e.prototype.stop=function(){this.reset()},e.prototype.reset=function(){this._started=!1,this._start_time=null,this._durations_by_name={},this._durations_count_by_name={},this._nodes_cook_data={}},Object.defineProperty(e.prototype,"started",{get:function(){return this._started},enumerable:!0,configurable:!0}),e.prototype.record_node_cook_data=function(e){var t=e.graph_node_id;null==this._nodes_cook_data[t]&&(this._nodes_cook_data[t]=new a.PerformanceNode(e)),this._nodes_cook_data[t].update_cook_data()},e.prototype.record=function(e){this.started||this.start();var t=performance.now();return null==this._durations_by_name[e]&&(this._durations_by_name[e]=0),this._durations_by_name[e]+=t-this._previous_timestamp,null==this._durations_count_by_name[e]&&(this._durations_count_by_name[e]=0),this._durations_count_by_name[e]+=1,this._previous_timestamp=t},e.prototype.print=function(){this.print_node_cook_data(),this.print_recordings()},e.prototype.print_node_cook_data=function(){var e=Object.values(this._nodes_cook_data),t=(e=s.default(e,(function(e){return-e.cook_time_total}))).map((function(e){return e.print_object()}));console.log("--------------- NODES COOK TIME -----------");for(var n=[],r=0,o=s.default(t,(function(e){return-e.cook_time_total}));r<o.length;r++){var i=o[r];n.push(i)}return console.table(n),t},e.prototype.print_recordings=function(){for(var e=i.default(this._durations_by_name),t=i.default(this._durations_count_by_name),n=[],r={},s=0,a=Object.keys(e);s<a.length;s++){var _=a[s],u=e[_];n.push(u),null==r[u]&&(r[u]=[]),r[u].push(_)}n.sort((function(e,t){return e-t}));var c=o.default(n);console.log("--------------- PERF RECORDINGS -----------");for(var p=[],l=0,d=c;l<d.length;l++)for(var h=0,f=r[u=d[l]];h<f.length;h++){var m=f[h],y=t[m],v={duration:u,name:m,count:y,duration_per_iteration:u/y};p.push(v)}return console.table(p),p},e}();t.CorePerformance=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this._node=e,this._cooks_count=0,this._cook_time_total=0,this._cook_time_total_with_inputs=0,this._cook_time_total_params=0}return e.prototype.update_cook_data=function(){this._cooks_count+=1,this._cook_time_total+=this._node.cook_controller.cook_time,this._cook_time_total_with_inputs+=this._node.cook_controller.cook_time_with_inputs,this._cook_time_total_params+=this._node.cook_controller.cook_time_params},Object.defineProperty(e.prototype,"cook_time_total",{get:function(){return this._cook_time_total},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cook_time_per_iteration",{get:function(){return this._cooks_count>0?this._cook_time_total/this._cooks_count:0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cook_time_total_with_inputs",{get:function(){return this._cook_time_total_with_inputs},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cook_time_total_with_inputs_per_iteration",{get:function(){return this._cooks_count>0?this._cook_time_total_with_inputs/this._cooks_count:0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cook_time_total_params",{get:function(){return this._cook_time_total_params},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cook_time_total_params_per_iteration",{get:function(){return this._cooks_count>0?this._cook_time_total_params/this._cooks_count:0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cooks_count",{get:function(){return this._cooks_count},enumerable:!0,configurable:!0}),e.prototype.print_object=function(){return{full_path:this._node.full_path(),cooks_count:this.cooks_count,cook_time_total:this.cook_time_total,cook_time_per_iteration:this.cook_time_per_iteration,cook_time_total_with_inputs:this.cook_time_total_with_inputs,cook_time_total_with_inputs_per_iteration:this.cook_time_total_with_inputs_per_iteration,cook_time_total_params:this.cook_time_total_params,cook_time_total_params_per_iteration:this.cook_time_total_params_per_iteration}},e}();t.PerformanceNode=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(55),o=n(561),i=function(){function e(e){this.scene=e,this.self=this,this._frame=1,this._frame_range=[1,600],this._frame_range_locked=[!0,!0],this._playing=!1,this._fps=60,this._frame_interval=1e3/60,this._graph_node=new r.CoreGraphNode(e,"time controller")}return Object.defineProperty(e.prototype,"graph_node",{get:function(){return this._graph_node},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fps",{get:function(){return this._fps},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"frame",{get:function(){return this._frame},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"time",{get:function(){return this._frame/this._fps},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"frame_range",{get:function(){return this._frame_range},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"frame_range_locked",{get:function(){return this._frame_range_locked},enumerable:!0,configurable:!0}),e.prototype.set_frame_range=function(e,t){this._frame_range=[Math.floor(e),Math.floor(t)],this.scene.events_controller.dispatch(this._graph_node,o.SceneEvent.FRAME_RANGE_UPDATED)},e.prototype.set_frame_range_locked=function(e,t){this._frame_range_locked=[e,t],this.scene.events_controller.dispatch(this._graph_node,o.SceneEvent.FRAME_RANGE_UPDATED)},e.prototype.set_fps=function(e){this._fps=Math.floor(e),this._frame_interval=1e3/this._fps,this.scene.events_controller.dispatch(this._graph_node,o.SceneEvent.FRAME_RANGE_UPDATED)},e.prototype.set_frame=function(e){(e=this._ensure_frame_within_bounds(e))!=this.frame&&(this._frame=e,this.scene.events_controller.dispatch(this._graph_node,o.SceneEvent.FRAME_UPDATED),this.scene.uniforms_controller.update_frame_dependent_uniform_owners(),this.graph_node.set_successors_dirty())},e.prototype.increment_frame=function(){this.set_frame(this.frame+1)},e.prototype.decrement_frame=function(){this.set_frame(this.frame-1)},e.prototype.set_first_frame=function(){this.set_frame(this.frame_range[0])},e.prototype._ensure_frame_within_bounds=function(e){return this._frame_range_locked[0]&&e<this._frame_range[0]&&(e=this._frame_range[1]),this._frame_range_locked[1]&&e>this._frame_range[1]&&(e=this._frame_range[0]),e},Object.defineProperty(e.prototype,"playing",{get:function(){return!0===this._playing},enumerable:!0,configurable:!0}),e.prototype.pause=function(){this._playing=!1,this.scene.events_controller.dispatch(this._graph_node,o.SceneEvent.PLAY_STATE_UPDATED)},e.prototype.play=function(){!0!==this._playing&&setTimeout(this.play_next_frame.bind(this),this._frame_interval),this._playing=!0,this.scene.events_controller.dispatch(this._graph_node,o.SceneEvent.PLAY_STATE_UPDATED)},e.prototype.toggle_play_pause=function(){this.playing?this.pause():this.play()},e.prototype.play_next_frame=function(){this.playing&&(this.scene.root.are_children_cooking()||this.increment_frame(),setTimeout(this.play_next_frame.bind(this),this._frame_interval))},e}();t.TimeController=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.FRAME_RANGE_UPDATED="scene_frame_range_updated",e.FRAME_UPDATED="scene_frame_updated",e.PLAY_STATE_UPDATED="scene_play_state_updated"}(t.SceneEvent||(t.SceneEvent={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this.scene=e}return e.prototype.to_json=function(e){void 0===e&&(e=!1);for(var t={},n={},r=0,o=this.scene.nodes_controller.all_nodes();r<o.length;r++){var i=o[r];t[i.graph_node_id]=i.to_json(e);for(var s=0,a=i.params.all;s<a.length;s++){var _=a[s];n[_.graph_node_id]=_.to_json()}}return{nodes_by_graph_node_id:t,params_by_graph_node_id:n}},e}();t.Serializer=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=function(){function e(e){this.scene=e,this._frame_dependent_uniform_owners={},this._frame_dependent_uniform_owners_ids=null,this._resolution=new r.Vector2(1,1),this._resolution_dependent_uniform_owners={},this._resolution_dependent_uniform_owners_ids=[]}return e.prototype.add_frame_dependent_uniform_owner=function(e,t){this._frame_dependent_uniform_owners[e]=t,this._update_frame_dependent_uniform_owners_ids()},e.prototype.remove_frame_dependent_uniform_owner=function(e){delete this._frame_dependent_uniform_owners[e],this._update_frame_dependent_uniform_owners_ids()},e.prototype._update_frame_dependent_uniform_owners_ids=function(){this._frame_dependent_uniform_owners_ids=Object.keys(this._frame_dependent_uniform_owners)},e.prototype.update_frame_dependent_uniform_owners=function(){var e=this.scene.frame;if(this._frame_dependent_uniform_owners_ids)for(var t=0,n=this._frame_dependent_uniform_owners_ids;t<n.length;t++){var r=n[t];this._frame_dependent_uniform_owners[r].frame.value=e}},e.prototype.add_resolution_dependent_uniform_owner=function(e,t){this._resolution_dependent_uniform_owners[e]=t,this._update_resolution_dependent_uniform_owners_ids(),this._resolution&&this.update_resolution_dependent_uniforms(t)},e.prototype.remove_resolution_dependent_uniform_owner=function(e){delete this._resolution_dependent_uniform_owners[e],this._update_resolution_dependent_uniform_owners_ids()},e.prototype._update_resolution_dependent_uniform_owners_ids=function(){this._resolution_dependent_uniform_owners_ids=Object.keys(this._resolution_dependent_uniform_owners)},e.prototype.update_resolution_dependent_uniform_owners=function(e){this._resolution.copy(e);for(var t=0,n=this._resolution_dependent_uniform_owners_ids;t<n.length;t++){var r=n[t],o=this._resolution_dependent_uniform_owners[r];this.update_resolution_dependent_uniforms(o)}},e.prototype.update_resolution_dependent_uniforms=function(e){e.resolution.value.x=this._resolution.x*window.devicePixelRatio,e.resolution.value.y=this._resolution.y*window.devicePixelRatio},e}();t.UniformsController=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){this._require_webgl2=!1}return e.prototype.require_webgl2=function(){return this._require_webgl2},e.prototype.set_require_webgl2=function(){this._require_webgl2||(this._require_webgl2=!0,POLY.renderers_controller.set_require_webgl2())},e}();t.WebGLController=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(566),o=n(602);n(142),r.ObjRegister.run(POLY),o.SopRegister.run(POLY)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(285),o=n(567),i=n(574),s=n(575),a=n(576),_=n(577),u=n(578),c=n(580),p=n(581),l=n(599),d=function(){function e(){}return e.run=function(e){e.register_node(o.AmbientLightObjNode,r.CATEGORY_OBJ.LIGHT),e.register_node(i.EventsObjNode,r.CATEGORY_OBJ.MANAGER),e.register_node(s.MaterialsObjNode,r.CATEGORY_OBJ.MANAGER),e.register_node(a.CopObjNode,r.CATEGORY_OBJ.MANAGER),e.register_node(_.PostProcessObjNode,r.CATEGORY_OBJ.MANAGER),e.register_node(u.GeoObjNode,r.CATEGORY_OBJ.GEOMETRY),e.register_node(p.OrthographicCameraObjNode,r.CATEGORY_OBJ.CAMERA),e.register_node(l.PerspectiveCameraObjNode,r.CATEGORY_OBJ.CAMERA),e.register_node(c.FogObjNode,r.CATEGORY_OBJ.MISC)},e}();t.ObjRegister=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=n(225),i=n(568),s=n(9),a=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.color=s.ParamConfig.COLOR([1,1,1]),t.intensity=s.ParamConfig.FLOAT(1),t}return r.__extends(t,e),t}(s.NodeParamsConfig)),_=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=a,t}return r.__extends(t,e),t.type=function(){return"ambient_light"},t.prototype.create_object=function(){return new o.AmbientLight},t.prototype.update_light_params=function(){this.object.color=this.pv.color,this.object.intensity=this.pv.intensity},t}(i.TypedLightObjNode);t.AmbientLightObjNode=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=n(83),i=n(6),s=n(120),a=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.flags=new s.FlagsControllerD(t),t.render_order=o.ObjNodeRenderOrder.LIGHT,t._color_with_intensity=new i.Color(0),t._used_in_scene=!0,t}return r.__extends(t,e),Object.defineProperty(t.prototype,"object",{get:function(){return this._object},enumerable:!0,configurable:!0}),t.prototype.initialize_base_node=function(){var t=this;e.prototype.initialize_base_node.call(this),this.flags.display.add_hook((function(){t.set_used_in_scene(t.flags.display.active||!1)})),this.dirty_controller.add_post_dirty_hook((function(){return r.__awaiter(t,void 0,void 0,(function(){return r.__generator(this,(function(e){switch(e.label){case 0:return this.used_in_scene?[4,this.cook_controller.cook_main_without_inputs()]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))}))}))},t.prototype.create_params=function(){},t.prototype.create_shadow_params_main=function(){if(null!=this.object.shadow)return this.create_shadow_params()},t.prototype.create_light_params=function(){},t.prototype.update_light_params=function(){},t.prototype.create_shadow_params=function(){},t.prototype.cook=function(){this.update_light_params(),this.update_shadow_params(),this.cook_controller.end_cook()},t.prototype.update_shadow_params=function(){},Object.defineProperty(t.prototype,"color_with_intensity",{get:function(){var e=this.params.color("color"),t=this.params.float("intensity");return this._color_with_intensity.copy(e).multiplyScalar(t),this._color_with_intensity},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"active",{get:function(){return this.flags.display.active},enumerable:!0,configurable:!0}),t}(o.TypedObjNode);t.TypedLightObjNode=a;var _=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t}(a);t.BaseLightObjNodeClass=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.set_content=function(t){e.prototype.set_content.call(this,t)},t.prototype.set_object=function(e){return this.set_content(e)},t.prototype.has_object=function(){return this.has_content()},t.prototype.object=function(){return this.content()},t}(n(119).TypedContainer);t.ObjectContainer=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(286),o=n(83),i=n(25),s=function(){function e(e){this.node=e,this._camera_controller=new r.CameraController(this._update_from_look_at_target.bind(this))}return Object.defineProperty(e.prototype,"active",{get:function(){return""!=this.param.value},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"param",{get:function(){return this.node.params.get_operator_path("look_at")},enumerable:!0,configurable:!0}),e.prototype.compute=function(){var e=this.param.found_node();e?e instanceof o.BaseObjNodeclass?this._camera_controller.set_target(e.object):this.node.states.error.set("look_at node is not an obj"):(this._camera_controller.remove_target(),this.node.transform_controller.update_transform_with_matrix())},e.prototype._update_from_look_at_target=function(e){var t=this.node.object;null!=t?(t.matrixAutoUpdate=!0,t.up.copy(this.node.params.value_with_type("up",i.ParamType.VECTOR3)),t.lookAt(e.position)):console.log("no object yet",this.node.full_path())},e}();t.LookAtController=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(159),o=n(104),i=n(65),s=function(){function e(e){this.node=e}return e.prototype.post_set_input=function(){null!=this.node.io.inputs.input(0)?this.node.root.add_to_parent_transform(this.node):this.node.root.remove_from_parent_transform(this.node)},e.prototype.update=function(e){return this.node.object?1==this.node.look_at_controller.active?this.node.look_at_controller.compute():this.update_transform_with_matrix(e):(console.warn("no object to update for "+this.node.full_path()),!1)},e.prototype.update_transform_with_matrix=function(e){var t=this.node.object;return null==e||e.equals(t.matrix)?this.update_transform_from_params():(t.matrixAutoUpdate=!1,t.matrix=e,t.dispatchEvent({type:"change"}))},e.prototype.update_transform_from_params=function(){var e=this.node.object;if(e){var t=this.node.params.vector3("t"),n=this.node.params.vector3("r"),i=this.node.params.vector3("s").clone().multiplyScalar(this.node.params.float("scale"));e.matrixAutoUpdate=!1,e.position.copy(t);var s=[o.CoreMath.degrees_to_radians(n.x),o.CoreMath.degrees_to_radians(n.y),o.CoreMath.degrees_to_radians(n.z)],a=new r.Euler(s[0],s[1],s[2]);e.rotation.copy(a),e.scale.copy(i),e.matrixAutoUpdate=!0,e.updateMatrix(),e.dispatchEvent({type:"change"})}},e.prototype.set_params_from_matrix=function(e,t){void 0===t&&(t={}),i.CoreTransform.set_params_from_matrix(e,this.node,t)},e}();t.TransformController=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=n(287),i=n(64),s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._state=!1,t}return r.__extends(t,e),t.prototype.on_update=function(){this.node.emit(i.NodeEvent.FLAG_BYPASS_UPDATED),this.node.set_dirty()},t}(o.BaseFlag);t.BypassFlag=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=n(287),i=n(64),s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.on_update=function(){this.node.emit(i.NodeEvent.FLAG_DISPLAY_UPDATED)},t}(o.BaseFlag);t.DisplayFlag=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=n(147),i=n(42),s=n(83),a=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.render_order=s.ObjNodeRenderOrder.EVENT,t}return r.__extends(t,e),t.type=function(){return"events"},t.prototype.initialize_node=function(){this.children_controller.init(i.NodeContext.EVENT)},t}(o.BaseManagerObjNode);t.EventsObjNode=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=n(147),i=n(42),s=n(83),a=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.render_order=s.ObjNodeRenderOrder.MAT,t}return r.__extends(t,e),t.type=function(){return"materials"},t.prototype.initialize_node=function(){this.children_controller.init(i.NodeContext.MAT)},t}(o.BaseManagerObjNode);t.MaterialsObjNode=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=n(147),i=n(42),s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.type=function(){return"cop"},t.prototype.initialize_node=function(){this.children_controller.init(i.NodeContext.COP)},t}(o.BaseManagerObjNode);t.CopObjNode=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=n(147),i=n(42),s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.type=function(){return"post_process"},t.prototype.initialize_node=function(){this.children_controller.init(i.NodeContext.POST)},t}(o.BaseManagerObjNode);t.PostProcessObjNode=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=n(83),i=n(36),s=n(65),a=n(579),_=n(42),u=n(9),c=n(120),p=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.t=u.ParamConfig.VECTOR3([0,0,0]),t.r=u.ParamConfig.VECTOR3([0,0,0]),t.s=u.ParamConfig.VECTOR3([1,1,1]),t.scale=u.ParamConfig.FLOAT(1),t.look_at=u.ParamConfig.OPERATOR_PATH(""),t.up=u.ParamConfig.VECTOR3([0,1,0]),t.pivot=u.ParamConfig.VECTOR3([0,0,0]),t.display=u.ParamConfig.BOOLEAN(1),t}return r.__extends(t,e),t}(u.NodeParamsConfig)),l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=p,t._display_node_controller=new a.DisplayNodeController(t),t.flags=new c.FlagsControllerD(t),t._used_in_scene=!0,t._core_transform=new s.CoreTransform,t}return r.__extends(t,e),Object.defineProperty(t.prototype,"display_node_controller",{get:function(){return this._display_node_controller},enumerable:!0,configurable:!0}),t.type=function(){return"geo"},t.prototype.initialize_node=function(){var e=this;this.children_controller.init(_.NodeContext.SOP),this.flags.display.add_hook((function(){e.set_used_in_scene(e.flags.display.active)})),this.dirty_controller.add_post_dirty_hook((function(){return r.__awaiter(e,void 0,void 0,(function(){return r.__generator(this,(function(e){switch(e.label){case 0:return this.used_in_scene?[4,this.cook_controller.cook_main_without_inputs()]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))}))})),this.io.inputs.set_count_to_one_max()},t.prototype.create_object=function(){return new i.Group},t.prototype.request_display_node=function(){this.scene.loading_controller.auto_updating},t.prototype.is_display_node_cooking=function(){if(this.flags.display.active){var e=this._display_node_controller.display_node;return!!e&&e.is_dirty}return!1},t.prototype.post_display_flag_node_set_dirty=function(){this.request_display_node()},t.prototype.post_add_node=function(e){var t,n;this.scene.loading_controller.loaded&&1==this.children().length&&(null===(n=null===(t=e.flags)||void 0===t?void 0:t.display)||void 0===n||n.set(!0))},t.prototype.create_node=function(t){return e.prototype.create_node.call(this,t)},t.prototype.children=function(){return e.prototype.children.call(this)},t.prototype.nodes_by_type=function(t){return e.prototype.nodes_by_type.call(this,t)},t.prototype.on_create=function(){},t.prototype.cook=function(){var e=this._core_transform.matrix(this.pv.t,this.pv.r,this.pv.s,this.pv.scale);this.group.visible=this.flags.display.active,this.transform_controller.update(e),this.cook_controller.end_cook()},t}(o.TypedObjNode);t.GeoObjNode=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=n(55),i=function(){function e(e){var t=this;this.node=e,this._children_uuids_dict={},this._children_length=0,this._graph_node=new o.CoreGraphNode(e.scene,"DisplayNodeController"),this._graph_node.dirty_controller.add_post_dirty_hook((function(){t.request_display_node_container()}))}return Object.defineProperty(e.prototype,"display_node",{get:function(){return this._display_node},enumerable:!0,configurable:!0}),e.prototype.set_display_node=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t;return r.__generator(this,(function(n){return this._display_node!=e&&((t=this._display_node)&&(t.flags.display.set(!1),this._graph_node.remove_graph_input(t),this.remove_children()),this._display_node=e,this._display_node&&this._graph_node.add_graph_input(this._display_node),this.request_display_node_container()),[2]}))}))},e.prototype.remove_children=function(){for(var e;e=this.node.object.children.pop();)this.node.object.remove(e)},e.prototype.request_display_node_container=function(){return r.__awaiter(this,void 0,void 0,(function(){var e,t,n,o,i,s,a,_,u;return r.__generator(this,(function(r){switch(r.label){case 0:return this.node.used_in_scene&&this._display_node?[4,this._display_node.request_container()]:[3,2];case 1:if(e=r.sent(),t=e.core_content()){if(n=t.objects(),!(o=n.length!=this._children_length))for(i=0,s=n;i<s.length;i++)(u=s[i]).uuid in this._children_uuids_dict||(o=!0);if(o){for(this.remove_children(),this._children_uuids_dict={},a=0,_=n;a<_.length;a++)u=_[a],this.node.object.add(u),this._children_uuids_dict[u.uuid]=!0;this._children_length=n.length}}else this.remove_children(),this._children_uuids_dict={},this._children_length=0;r.label=2;case 2:return[2]}}))}))},e}();t.DisplayNodeController=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=n(83),i=n(226),s=n(227),a={color:new(n(6).Color)(1,1,1),near:0,far:100,density:25e-5},_=n(9),u=n(120),c=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.color=_.ParamConfig.COLOR(a.color.toArray()),t.exponential=_.ParamConfig.BOOLEAN(0),t.density=_.ParamConfig.FLOAT(1),t.near=_.ParamConfig.FLOAT(0,{range:[0,100]}),t.far=_.ParamConfig.FLOAT(100,{range:[0,100]}),t}return r.__extends(t,e),t}(_.NodeParamsConfig)),p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=c,t.flags=new u.FlagsControllerD(t),t.render_order=o.ObjNodeRenderOrder.MANAGER,t.add_to_hierarchy=!1,t}return r.__extends(t,e),t.prototype.initialize_node=function(){this._linear_fog=new s.Fog(a.color.getHex(),a.near,a.far),this._linear_fogexp2=new i.FogExp2(a.color.getHex(),a.density)},t.type=function(){return"fog"},t.prototype.cook=function(){var e;this.pv.exponential?(this._linear_fogexp2.density=this.pv.density,e=this._linear_fogexp2):(this._linear_fog.near=this.pv.near,this._linear_fog.far=this.pv.far,e=this._linear_fog),e.color.copy(this.pv.color),this.scene.display_scene.fog=e,this.cook_controller.end_cook()},t}(o.TypedObjNode);t.FogObjNode=p},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=n(57),i=r.__importDefault(n(288)),s=n(289),a=n(598),_=n(25),u=n(9),c=-.5,p=.5,l=.5,d=-.5,h=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.size=u.ParamConfig.FLOAT(1),t.vertical_size_range=u.ParamConfig.VECTOR2([-1,-1]),t.horizontal_size_range=u.ParamConfig.VECTOR2([-1,-1]),t}return r.__extends(t,e),t}(s.BaseCameraObjParamsConfig)),f=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=h,t}return r.__extends(t,e),Object.defineProperty(t.prototype,"background_controller_constructor",{get:function(){return a.OrthographicCameraBackgroundController},enumerable:!0,configurable:!0}),t.type=function(){return"orthographic_camera"},t.prototype.create_object=function(){return new o.OrthographicCamera(2*c,2*p,2*l,2*d,s.BASE_CAMERA_DEFAULT.near,s.BASE_CAMERA_DEFAULT.far)},t.prototype.create_params=function(){this.create_common_params(),this.add_param(_.ParamType.FLOAT,"size",2,{range:[0,10]}),this.add_param(_.ParamType.VECTOR2,"vertical_size_range",[0,10],{visible_if:{lock_width:1}}),this.add_param(_.ParamType.VECTOR2,"horizontal_size_range",[0,10],{visible_if:{lock_width:0}}),this.create_player_camera_params()},t.prototype.update_camera=function(){this._update_for_aspect_ratio()},t.prototype._update_for_aspect_ratio=function(){if(this._aspect){var e=this.pv.size||1,t=this.pv.lock_width;if(null==t&&(t=!0),t){var n=e/this._aspect,r=this.get_zoom(n,this.pv.vertical_size_range);this._object.left=c*e*r,this._object.right=p*e*r,this._object.top=l*n*r,this._object.bottom=d*n*r}else{var o=e*this._aspect;r=this.get_zoom(o,this.pv.horizontal_size_range);this._object.left=c*o*r,this._object.right=p*o*r,this._object.top=l*e*r,this._object.bottom=d*e*r}this._object.updateProjectionMatrix()}},t.prototype.get_zoom=function(e,t){var n=1;t&&((e<t.x||e>t.y)&&(n=i.default(e,t.x,t.y)/e));return n},t}(s.TypedCameraObjNode);t.OrthographicCameraObjNode=f},,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=n(584),i=n(585),s=function(){function e(e){this.node=e,this._applied_controls_by_element_id={},this._controls_node=null}return e.prototype.controls_param=function(){return this.node.params.has("controls")?this.node.params.get("controls"):null},e.prototype.controls_node=function(){var e=this.node.p.controls.found_node();if(e){if(e instanceof i.CameraOrbitControlsEventNode)return e;this.node.states.error.set("found node is not of a camera control type")}else this.node.states.error.set("no node has been found");return null},e.prototype.update_controls=function(){var e=this.controls_node();e&&this._controls_node!=e&&this.dispose_control_refs(),this._controls_node=e},e.prototype.apply_controls=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,n,i,s,a;return r.__generator(this,(function(r){switch(r.label){case 0:return(t=this.controls_node())?(n=t.graph_node_id,i=!1,this._applied_controls_by_element_id[e.id]&&this._applied_controls_by_element_id[e.id][n]&&(i=!0),i?[3,2]:(this._applied_controls_by_element_id[e.id]=this._applied_controls_by_element_id[e.id]||{},this._applied_controls_by_element_id[e.id][n]=!0,[4,t.apply_controls(this.node.object,e)])):[3,2];case 1:return s=r.sent(),a=new o.CameraControlsConfig(this.node.graph_node_id,t,s),t.set_from_camera_node(s,this.node),this.set_controls_events(s),[2,a];case 2:return[2]}}))}))},e.prototype.dispose_control_refs=function(){this._applied_controls_by_element_id={}},e.prototype.dispose_controls=function(e){if(this._applied_controls_by_element_id[e.id]){var t=this.controls_node();if(t){var n=t.graph_node_id;delete this._applied_controls_by_element_id[e.id][n]}}},e.prototype.set_controls_events=function(e){var t=this;this.controls_start_listener=function(){t.on_controls_start(e)},this.controls_end_listener=function(){t.on_controls_end(e)},e.addEventListener("start",this.controls_start_listener),e.addEventListener("end",this.controls_end_listener)},e.prototype.on_controls_start=function(e){},e.prototype.on_controls_end=function(e){if(e.target){var t=e.target.toArray();this.node.params.set_vector3("target",t)}this.node.update_transform_params_from_object()},e}();t.ControlsController=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t,n){this._camera_node_id=e,this._controls_node=t,this._controls=n}return Object.defineProperty(e.prototype,"camera_node_id",{get:function(){return this._camera_node_id},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"controls",{get:function(){return this._controls},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"controls_node",{get:function(){return this._controls_node},enumerable:!0,configurable:!0}),e.prototype.is_equal=function(e){return e.camera_node_id==this._camera_node_id&&e.controls_node.graph_node_id==this._controls_node.graph_node_id},e}();t.CameraControlsConfig=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=n(586),i=n(589),s=n(9),a=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.allow_pan=s.ParamConfig.BOOLEAN(1),t.allow_rotate=s.ParamConfig.BOOLEAN(1),t.allow_zoom=s.ParamConfig.BOOLEAN(1),t.tdamping=s.ParamConfig.BOOLEAN(0),t.damping=s.ParamConfig.FLOAT(.1,{visible_if:{tdamping:!0}}),t.screen_space_panning=s.ParamConfig.BOOLEAN(1),t.rotate_speed=s.ParamConfig.FLOAT(.5),t.min_distance=s.ParamConfig.FLOAT(1,{range:[0,100],range_locked:[!0,!1]}),t.max_distance=s.ParamConfig.FLOAT(50,{range:[0,100],range_locked:[!0,!1]}),t.polar_angle_range=s.ParamConfig.VECTOR2([0,"$PI"]),t}return r.__extends(t,e),t}(s.NodeParamsConfig)),_=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=a,t}return r.__extends(t,e),t.type=function(){return"camera_orbit_controls"},t.prototype.create_controls_instance=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(n){return[2,new i.OrbitControls(e,t)]}))}))},t.prototype.setup_controls=function(e){e.enablePan=this.pv.allow_pan,e.enableRotate=this.pv.allow_rotate,e.enableZoom=this.pv.allow_zoom,e.enableDamping=this.pv.tdamping,e.dampingFactor=this.pv.damping,e.rotateSpeed=this.pv.rotate_speed,e.screenSpacePanning=this.pv.screen_space_panning,e.minDistance=this.pv.min_distance,e.maxDistance=this.pv.max_distance,e.minPolarAngle=this.pv.polar_angle_range.x,e.maxPolarAngle=this.pv.polar_angle_range.y,e.enableKeys=!1},t.prototype.set_from_camera_node=function(e,t){var n=t.params.vector3("target");e.target.copy(n)},t}(o.TypedCameraControlsEventNode);t.CameraOrbitControlsEventNode=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.apply_controls=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var n;return r.__generator(this,(function(r){switch(r.label){case 0:return[4,this.create_controls_instance(e,t)];case 1:return(n=r.sent()).name=this.full_path()+":"+e.name,[4,this.params.eval_all()];case 2:return r.sent(),this.setup_controls(n),[2,n]}}))}))},t}(n(587).TypedEventNode);t.TypedCameraControlsEventNode=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=n(81),i=n(588),s=n(42),a=n(118),_=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.container_controller=new a.TypedContainerController(t,i.EventContainer),t}return r.__extends(t,e),t.node_context=function(){return s.NodeContext.EVENT},t.prototype.initialize_base_node=function(){this.add_post_dirty_hook(this._eval_all_params_on_dirty.bind(this))},t.prototype._eval_all_params_on_dirty=function(){this.params.eval_all()},t}(o.TypedNode);t.TypedEventNode=_;var u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t}(_);t.BaseEventNodeClass=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.set_content=function(t){e.prototype.set_content.call(this,t)},t}(n(119).TypedContainer);t.EventContainer=o},function(e,t,n){"use strict";n.r(t),n.d(t,"OrbitControls",(function(){return u})),n.d(t,"MapControls",(function(){return c}));var r=n(30),o=n(0),i=n(31),s=n(231),a=n(2),_=n(1),u=function(e,t){var n,r,u,c,p;void 0===t&&console.warn('THREE.OrbitControls: The second parameter "domElement" is now mandatory.'),t===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),this.object=e,this.domElement=t,this.enabled=!0,this.target=new _.Vector3,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!1,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.enableKeys=!0,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={LEFT:o.MOUSE.ROTATE,MIDDLE:o.MOUSE.DOLLY,RIGHT:o.MOUSE.PAN},this.touches={ONE:o.TOUCH.ROTATE,TWO:o.TOUCH.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=function(){return g.phi},this.getAzimuthalAngle=function(){return g.theta},this.saveState=function(){l.target0.copy(l.target),l.position0.copy(l.object.position),l.zoom0=l.object.zoom},this.reset=function(){l.target.copy(l.target0),l.object.position.copy(l.position0),l.object.zoom=l.zoom0,l.object.updateProjectionMatrix(),l.dispatchEvent(d),l.update(),y=m.NONE},this.update=(n=new _.Vector3,r=(new i.Quaternion).setFromUnitVectors(e.up,new _.Vector3(0,1,0)),u=r.clone().inverse(),c=new _.Vector3,p=new i.Quaternion,function(){var e=l.object.position;return n.copy(e).sub(l.target),n.applyQuaternion(r),g.setFromVector3(n),l.autoRotate&&y===m.NONE&&R(2*Math.PI/60/60*l.autoRotateSpeed),l.enableDamping?(g.theta+=b.theta*l.dampingFactor,g.phi+=b.phi*l.dampingFactor):(g.theta+=b.theta,g.phi+=b.phi),g.theta=Math.max(l.minAzimuthAngle,Math.min(l.maxAzimuthAngle,g.theta)),g.phi=Math.max(l.minPolarAngle,Math.min(l.maxPolarAngle,g.phi)),g.makeSafe(),g.radius*=O,g.radius=Math.max(l.minDistance,Math.min(l.maxDistance,g.radius)),!0===l.enableDamping?l.target.addScaledVector(P,l.dampingFactor):l.target.add(P),n.setFromSpherical(g),n.applyQuaternion(u),e.copy(l.target).add(n),l.object.lookAt(l.target),!0===l.enableDamping?(b.theta*=1-l.dampingFactor,b.phi*=1-l.dampingFactor,P.multiplyScalar(1-l.dampingFactor)):(b.set(0,0,0),P.set(0,0,0)),O=1,!!(w||c.distanceToSquared(l.object.position)>v||8*(1-p.dot(l.object.quaternion))>v)&&(l.dispatchEvent(d),c.copy(l.object.position),p.copy(l.object.quaternion),w=!1,!0)}),this.dispose=function(){l.domElement.removeEventListener("contextmenu",oe,!1),l.domElement.removeEventListener("mousedown",K,!1),l.domElement.removeEventListener("wheel",$,!1),l.domElement.removeEventListener("touchstart",te,!1),l.domElement.removeEventListener("touchend",re,!1),l.domElement.removeEventListener("touchmove",ne,!1),document.removeEventListener("mousemove",Z,!1),document.removeEventListener("mouseup",Q,!1),l.domElement.removeEventListener("keydown",ee,!1)};var l=this,d={type:"change"},h={type:"start"},f={type:"end"},m={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},y=m.NONE,v=1e-6,g=new s.a,b=new s.a,O=1,P=new _.Vector3,w=!1,x=new a.Vector2,C=new a.Vector2,E=new a.Vector2,T=new a.Vector2,j=new a.Vector2,A=new a.Vector2,N=new a.Vector2,M=new a.Vector2,k=new a.Vector2;function S(){return Math.pow(.95,l.zoomSpeed)}function R(e){b.theta-=e}function D(e){b.phi-=e}var I,L=(I=new _.Vector3,function(e,t){I.setFromMatrixColumn(t,0),I.multiplyScalar(-e),P.add(I)}),B=function(){var e=new _.Vector3;return function(t,n){!0===l.screenSpacePanning?e.setFromMatrixColumn(n,1):(e.setFromMatrixColumn(n,0),e.crossVectors(l.object.up,e)),e.multiplyScalar(t),P.add(e)}}(),G=function(){var e=new _.Vector3;return function(t,n){var r=l.domElement;if(l.object.isPerspectiveCamera){var o=l.object.position;e.copy(o).sub(l.target);var i=e.length();i*=Math.tan(l.object.fov/2*Math.PI/180),L(2*t*i/r.clientHeight,l.object.matrix),B(2*n*i/r.clientHeight,l.object.matrix)}else l.object.isOrthographicCamera?(L(t*(l.object.right-l.object.left)/l.object.zoom/r.clientWidth,l.object.matrix),B(n*(l.object.top-l.object.bottom)/l.object.zoom/r.clientHeight,l.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),l.enablePan=!1)}}();function z(e){l.object.isPerspectiveCamera?O/=e:l.object.isOrthographicCamera?(l.object.zoom=Math.max(l.minZoom,Math.min(l.maxZoom,l.object.zoom*e)),l.object.updateProjectionMatrix(),w=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),l.enableZoom=!1)}function F(e){l.object.isPerspectiveCamera?O*=e:l.object.isOrthographicCamera?(l.object.zoom=Math.max(l.minZoom,Math.min(l.maxZoom,l.object.zoom/e)),l.object.updateProjectionMatrix(),w=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),l.enableZoom=!1)}function V(e){x.set(e.clientX,e.clientY)}function U(e){T.set(e.clientX,e.clientY)}function Y(e){if(1==e.touches.length)x.set(e.touches[0].pageX,e.touches[0].pageY);else{var t=.5*(e.touches[0].pageX+e.touches[1].pageX),n=.5*(e.touches[0].pageY+e.touches[1].pageY);x.set(t,n)}}function q(e){if(1==e.touches.length)T.set(e.touches[0].pageX,e.touches[0].pageY);else{var t=.5*(e.touches[0].pageX+e.touches[1].pageX),n=.5*(e.touches[0].pageY+e.touches[1].pageY);T.set(t,n)}}function H(e){var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY,r=Math.sqrt(t*t+n*n);N.set(0,r)}function X(e){if(1==e.touches.length)C.set(e.touches[0].pageX,e.touches[0].pageY);else{var t=.5*(e.touches[0].pageX+e.touches[1].pageX),n=.5*(e.touches[0].pageY+e.touches[1].pageY);C.set(t,n)}E.subVectors(C,x).multiplyScalar(l.rotateSpeed);var r=l.domElement;R(2*Math.PI*E.x/r.clientHeight),D(2*Math.PI*E.y/r.clientHeight),x.copy(C)}function J(e){if(1==e.touches.length)j.set(e.touches[0].pageX,e.touches[0].pageY);else{var t=.5*(e.touches[0].pageX+e.touches[1].pageX),n=.5*(e.touches[0].pageY+e.touches[1].pageY);j.set(t,n)}A.subVectors(j,T).multiplyScalar(l.panSpeed),G(A.x,A.y),T.copy(j)}function W(e){var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY,r=Math.sqrt(t*t+n*n);M.set(0,r),k.set(0,Math.pow(M.y/N.y,l.zoomSpeed)),z(k.y),N.copy(M)}function K(e){if(!1!==l.enabled){switch(e.preventDefault(),l.domElement.focus?l.domElement.focus():window.focus(),e.button){case 0:switch(l.mouseButtons.LEFT){case o.MOUSE.ROTATE:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===l.enablePan)return;U(e),y=m.PAN}else{if(!1===l.enableRotate)return;V(e),y=m.ROTATE}break;case o.MOUSE.PAN:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===l.enableRotate)return;V(e),y=m.ROTATE}else{if(!1===l.enablePan)return;U(e),y=m.PAN}break;default:y=m.NONE}break;case 1:switch(l.mouseButtons.MIDDLE){case o.MOUSE.DOLLY:if(!1===l.enableZoom)return;!function(e){N.set(e.clientX,e.clientY)}(e),y=m.DOLLY;break;default:y=m.NONE}break;case 2:switch(l.mouseButtons.RIGHT){case o.MOUSE.ROTATE:if(!1===l.enableRotate)return;V(e),y=m.ROTATE;break;case o.MOUSE.PAN:if(!1===l.enablePan)return;U(e),y=m.PAN;break;default:y=m.NONE}}y!==m.NONE&&(document.addEventListener("mousemove",Z,!1),document.addEventListener("mouseup",Q,!1),l.dispatchEvent(h))}}function Z(e){if(!1!==l.enabled)switch(e.preventDefault(),y){case m.ROTATE:if(!1===l.enableRotate)return;!function(e){C.set(e.clientX,e.clientY),E.subVectors(C,x).multiplyScalar(l.rotateSpeed);var t=l.domElement;R(2*Math.PI*E.x/t.clientHeight),D(2*Math.PI*E.y/t.clientHeight),x.copy(C),l.update()}(e);break;case m.DOLLY:if(!1===l.enableZoom)return;!function(e){M.set(e.clientX,e.clientY),k.subVectors(M,N),k.y>0?z(S()):k.y<0&&F(S()),N.copy(M),l.update()}(e);break;case m.PAN:if(!1===l.enablePan)return;!function(e){j.set(e.clientX,e.clientY),A.subVectors(j,T).multiplyScalar(l.panSpeed),G(A.x,A.y),T.copy(j),l.update()}(e)}}function Q(e){!1!==l.enabled&&(document.removeEventListener("mousemove",Z,!1),document.removeEventListener("mouseup",Q,!1),l.dispatchEvent(f),y=m.NONE)}function $(e){!1===l.enabled||!1===l.enableZoom||y!==m.NONE&&y!==m.ROTATE||(e.preventDefault(),e.stopPropagation(),l.dispatchEvent(h),function(e){e.deltaY<0?F(S()):e.deltaY>0&&z(S()),l.update()}(e),l.dispatchEvent(f))}function ee(e){!1!==l.enabled&&!1!==l.enableKeys&&!1!==l.enablePan&&function(e){var t=!1;switch(e.keyCode){case l.keys.UP:G(0,l.keyPanSpeed),t=!0;break;case l.keys.BOTTOM:G(0,-l.keyPanSpeed),t=!0;break;case l.keys.LEFT:G(l.keyPanSpeed,0),t=!0;break;case l.keys.RIGHT:G(-l.keyPanSpeed,0),t=!0}t&&(e.preventDefault(),l.update())}(e)}function te(e){if(!1!==l.enabled){switch(e.preventDefault(),e.touches.length){case 1:switch(l.touches.ONE){case o.TOUCH.ROTATE:if(!1===l.enableRotate)return;Y(e),y=m.TOUCH_ROTATE;break;case o.TOUCH.PAN:if(!1===l.enablePan)return;q(e),y=m.TOUCH_PAN;break;default:y=m.NONE}break;case 2:switch(l.touches.TWO){case o.TOUCH.DOLLY_PAN:if(!1===l.enableZoom&&!1===l.enablePan)return;!function(e){l.enableZoom&&H(e),l.enablePan&&q(e)}(e),y=m.TOUCH_DOLLY_PAN;break;case o.TOUCH.DOLLY_ROTATE:if(!1===l.enableZoom&&!1===l.enableRotate)return;!function(e){l.enableZoom&&H(e),l.enableRotate&&Y(e)}(e),y=m.TOUCH_DOLLY_ROTATE;break;default:y=m.NONE}break;default:y=m.NONE}y!==m.NONE&&l.dispatchEvent(h)}}function ne(e){if(!1!==l.enabled)switch(e.preventDefault(),e.stopPropagation(),y){case m.TOUCH_ROTATE:if(!1===l.enableRotate)return;X(e),l.update();break;case m.TOUCH_PAN:if(!1===l.enablePan)return;J(e),l.update();break;case m.TOUCH_DOLLY_PAN:if(!1===l.enableZoom&&!1===l.enablePan)return;!function(e){l.enableZoom&&W(e),l.enablePan&&J(e)}(e),l.update();break;case m.TOUCH_DOLLY_ROTATE:if(!1===l.enableZoom&&!1===l.enableRotate)return;!function(e){l.enableZoom&&W(e),l.enableRotate&&X(e)}(e),l.update();break;default:y=m.NONE}}function re(e){!1!==l.enabled&&(l.dispatchEvent(f),y=m.NONE)}function oe(e){!1!==l.enabled&&e.preventDefault()}l.domElement.addEventListener("contextmenu",oe,!1),l.domElement.addEventListener("mousedown",K,!1),l.domElement.addEventListener("wheel",$,!1),l.domElement.addEventListener("touchstart",te,!1),l.domElement.addEventListener("touchend",re,!1),l.domElement.addEventListener("touchmove",ne,!1),l.domElement.addEventListener("keydown",ee,!1),-1===l.domElement.tabIndex&&(l.domElement.tabIndex=0),this.update()};u.prototype=Object.create(r.a.prototype),u.prototype.constructor=u;var c=function(e,t){u.call(this,e,t),this.mouseButtons.LEFT=o.MOUSE.PAN,this.mouseButtons.RIGHT=o.MOUSE.ROTATE,this.touches.ONE=o.TOUCH.PAN,this.touches.TWO=o.TOUCH.DOLLY_ROTATE};c.prototype=Object.create(r.a.prototype),c.prototype.constructor=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(25),o=function(){function e(e){this.node=e}return e.prototype.add_params=function(){this.node.add_param(r.ParamType.INTEGER,"layer",0,{range:[0,31],range_locked:[!0,!0]})},e.prototype.update=function(){var e=this.node.object;e.layers.set(0),e.layers.enable(this.node.params.integer("layer"))},e}();t.LayersController=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=n(791),i=n(0),s=n(2),a=r.__importDefault(n(82)),_=n(793),u=n(592),c=n(42),p=n(25),l=function(){function e(e){this.node=e,this._renderers_by_canvas_id={},this._composers_by_canvas_id={},this._resolution_by_canvas_id={},this._composers_set_in_progress_by_canvas_id={},this._fetch_post_process_nodes_in_progress=!1,this._post_process_nodes=[],this._post_process_use_node_path_params=[],this._post_process_node_path_params=[]}return e.prototype.render=function(e,t,n){var r=this.renderer(e);if(r)if(this.node.params.boolean("do_post_process")){var o=this.composer(e);o&&(o.setSize(t.x,t.y),o.render())}else this.node.setup_for_aspect_ratio(n),r.render(this.node.scene.display_scene,this.node.object)},e.prototype.renderer=function(e){return this._renderers_by_canvas_id[e.id]},e.prototype.create_renderer=function(e,t){var n=POLY.renderers_controller.rendering_context(e),r=new o.WebGLRenderer({canvas:e,antialias:!0,alpha:!0,context:n});return r.shadowMap.enabled=!0,r.physicallyCorrectLights=!0,r.toneMapping=i.ACESFilmicToneMapping,r.toneMappingExposure=1,r.outputEncoding=i.sRGBEncoding,POLY.renderers_controller.register_renderer(r),this._renderers_by_canvas_id[e.id]=r,this.set_renderer_size(e,t),r.setPixelRatio(window.devicePixelRatio),r},e.prototype.delete_renderer=function(e){var t=this.renderer(e);t&&POLY.renderers_controller.deregister_renderer(t)},e.prototype.set_renderer_size=function(e,t){this._resolution_by_canvas_id[e.id]=this._resolution_by_canvas_id[e.id]||new s.Vector2,this._resolution_by_canvas_id[e.id].copy(t);var n=this.renderer(e);n&&n.setSize(t.x,t.y);var r=this.composer(e);r&&r.setSize(t.x,t.y)},e.prototype.composer=function(e){return this._composers_by_canvas_id[e.id]=this._composers_by_canvas_id[e.id]||this._create_composer(e)},e.prototype._create_composer=function(e){var t=this.renderer(e);if(t){var n=new _.EffectComposer(t);return n.setPixelRatio(2*window.devicePixelRatio),this.set_composer_passes(e.id,n,t),n}},e.prototype.update_composer_passes=function(){return r.__awaiter(this,void 0,void 0,(function(){var e,t,n,o,i,s;return r.__generator(this,(function(r){switch(r.label){case 0:if(!this.node.params.boolean("do_post_process"))return[3,6];if(this._post_process_nodes=[],this._fetch_post_process_nodes_in_progress)return[2];if(this._fetch_post_process_nodes_in_progress=!0,!this.composer_passes_nodes_changed())return[3,5];this._post_process_nodes=[],e=0,t=a.default(4),r.label=1;case 1:return e<t.length?(n=t[e],o=this._post_process_use_node_path_params[n],o.value?(i=this._post_process_node_path_params[n],(s=i.found_node())?[4,s.request_container()]:[3,3]):[3,3]):[3,4];case 2:r.sent(),this._post_process_nodes.push(s),r.label=3;case 3:return e++,[3,1];case 4:this.set_composers_passes(),r.label=5;case 5:return this._fetch_post_process_nodes_in_progress=!1,[3,7];case 6:this._post_process_nodes=[],r.label=7;case 7:return[2]}}))}))},e.prototype.set_composers_passes=function(){for(var e=0,t=Object.keys(this._composers_by_canvas_id);e<t.length;e++){var n=t[e],r=this._composers_by_canvas_id[n],o=this._renderers_by_canvas_id[n];r&&this.set_composer_passes(n,r,o)}},e.prototype.set_composer_passes=function(e,t,n){if(!this._composers_set_in_progress_by_canvas_id[e]){this._composers_set_in_progress_by_canvas_id[e]=!0,this.clear_render_passes(t);var r=new u.RenderPass(this.node.scene.display_scene,this.node.object);r.clearAlpha=0,t.addPass(r);for(var o=0,i=this._post_process_nodes;o<i.length;o++){i[o].apply_to_composer(t,this.node.object,this._resolution_by_canvas_id[e],this.node)}delete this._composers_set_in_progress_by_canvas_id[e]}},e.prototype.clear_render_passes=function(e){for(var t;t=e.passes.pop();)if(t){var n=t;if("function"==typeof n.dispose)try{n.dispose()}catch(e){console.warn(e)}}e.passes=[]},e.prototype.composer_passes_nodes_changed=function(){return!0},e.prototype.add_params=function(){var e=this;this.node.add_param(p.ParamType.BOOLEAN,"do_post_process",0),a.default(4).forEach((function(t){var n,r=e.node.add_param(p.ParamType.BOOLEAN,"use_post_process_node"+(t+1),0,{visible_if:{do_post_process:1}});if(r){var o=((n={do_post_process:1})[r.name]=1,n),i={node_selection:{context:c.NodeContext.POST},visible_if:o},s=e.node.add_param(p.ParamType.OPERATOR_PATH,"post_process_node"+(t+1),"",i);s&&(e._post_process_use_node_path_params.push(r),e._post_process_node_path_params.push(s))}}))},e}();t.PostProcessController=l},function(e,t,n){"use strict";n.r(t),n.d(t,"RenderPass",(function(){return o}));var r=n(51),o=function(e,t,n,o,i){r.a.call(this),this.scene=e,this.camera=t,this.overrideMaterial=n,this.clearColor=o,this.clearAlpha=void 0!==i?i:0,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1};o.prototype=Object.assign(Object.create(r.a.prototype),{constructor:o,render:function(e,t,n){var r,o,i=e.autoClear;e.autoClear=!1,this.scene.overrideMaterial=this.overrideMaterial,this.clearColor&&(r=e.getClearColor().getHex(),o=e.getClearAlpha(),e.setClearColor(this.clearColor,this.clearAlpha)),this.clearDepth&&e.clearDepth(),e.setRenderTarget(this.renderToScreen?null:n),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),e.render(this.scene,this.camera),this.clearColor&&e.setClearColor(r,o),this.scene.overrideMaterial=null,e.autoClear=i}})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=n(594),i=n(595),s=n(596),a=n(597),_=function(){function e(e,t,n){var r=this;this._container=e,this._scene=t,this._active=!1,this._display_scene=this._scene.display_scene,this._init_from_scene(n).then((function(){r._build()}))}return Object.defineProperty(e.prototype,"active",{get:function(){return this._active},enumerable:!0,configurable:!0}),e.prototype.activate=function(){this._active=!0},e.prototype.deactivate=function(){this._active=!1},Object.defineProperty(e.prototype,"cameras_controller",{get:function(){return this._cameras_controller=this._cameras_controller||new o.CamerasController(this)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"controls_controller",{get:function(){return this._controls_controller=this._controls_controller||new i.ControlsController(this)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"events_controller",{get:function(){return this._events_controller=this._events_controller||new s.EventsController(this)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"webgl_controller",{get:function(){return this._webgl_controller=this._webgl_controller||new a.WebGLController(this)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"container",{get:function(){return this._container},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scene",{get:function(){return this._scene},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"canvas",{get:function(){return this._canvas},enumerable:!0,configurable:!0}),e.prototype._init_from_scene=function(e){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(t){return this.cameras_controller.set_camera_node(e||this._scene.cameras_controller.master_camera_node),[2]}))}))},e.prototype.reset_container_class=function(){this.container.classList.remove("hovered")},e.prototype.set_container_class_hovered=function(){this.container.classList.add("hovered")},e}();t.BaseViewer=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=n(2),i=function(){function e(e){this.viewer=e,this._camera_node=null,this._size=new o.Vector2(100,100),this._aspect=1}return e.prototype.set_camera_node=function(e){this._camera_node&&e.graph_node_id==this._camera_node.graph_node_id||(this._camera_node=e)},Object.defineProperty(e.prototype,"camera_node",{get:function(){return this._camera_node},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"aspect",{get:function(){return this._aspect},enumerable:!0,configurable:!0}),e.prototype.on_resize=function(){var e;this.compute_size_and_aspect(),null===(e=this._camera_node)||void 0===e||e.post_process_controller.set_renderer_size(this.viewer.canvas,this._size),this.update_camera_aspect()},e.prototype.compute_size_and_aspect=function(){var e;this._update_size(),null===(e=this._camera_node)||void 0===e||e.scene.uniforms_controller.update_resolution_dependent_uniform_owners(this._size),this._aspect=this._get_aspect()},e.prototype._update_size=function(){this._size.x=this.viewer.container.offsetWidth,this._size.y=this.viewer.container.offsetHeight},e.prototype._get_aspect=function(){return this._size.x/this._size.y},e.prototype.update_camera_aspect=function(){var e;null===(e=this._camera_node)||void 0===e||e.setup_for_aspect_ratio(this._aspect)},e.prototype.prepare_current_camera=function(){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(e){switch(e.label){case 0:return this._camera_node?[4,this._camera_node.request_container()]:[3,3];case 1:return e.sent(),[4,this._update_from_camera_container()];case 2:e.sent(),e.label=3;case 3:return[2]}}))}))},e.prototype._update_from_camera_container=function(){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(e){switch(e.label){case 0:return this.update_camera_aspect(),[4,this.viewer.controls_controller.create_controls()];case 1:return e.sent(),[2]}}))}))},e}();t.CamerasController=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=function(){function e(e){this.viewer=e,this._active=!1,this._controls=null,this._bound_on_controls_start=this._on_controls_start.bind(this),this._bound_on_controls_end=this._on_controls_end.bind(this)}return Object.defineProperty(e.prototype,"active",{get:function(){return this._active},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"camera_node",{get:function(){return this.viewer.cameras_controller.camera_node},enumerable:!0,configurable:!0}),e.prototype.create_controls=function(){var e;return r.__awaiter(this,void 0,void 0,(function(){var t;return r.__generator(this,(function(n){switch(n.label){case 0:return this.dispose_controls(),[4,null===(e=this.camera_node)||void 0===e?void 0:e.controls_controller.apply_controls(this.viewer.canvas)];case 1:return(t=n.sent())&&(this._controls=t.controls,this._controls&&(this.viewer.active?(this._controls.addEventListener("start",this._bound_on_controls_start),this._controls.addEventListener("end",this._bound_on_controls_end)):this.dispose_controls())),[2]}}))}))},e.prototype.dispose_controls=function(){var e;this._controls&&(null===(e=this.camera_node)||void 0===e||e.controls_controller.dispose_controls(this.viewer.canvas),this._bound_on_controls_start&&this._controls.removeEventListener("start",this._bound_on_controls_start),this._bound_on_controls_end&&this._controls.removeEventListener("end",this._bound_on_controls_end),this._controls.dispose(),this._controls=null)},e.prototype._on_controls_start=function(){this._active=!0},e.prototype._on_controls_end=function(){this._active=!1},e}();t.ControlsController=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=function(){function e(e){this.viewer=e,this._mousedown_pos=new r.Vector2,this._mouse_distance_travelled=-1,this._bound_on_mousedown=this._on_mousedown.bind(this),this._bound_on_mousemove=this._on_mousemove.bind(this),this._bound_on_mouseup=this._on_mouseup.bind(this)}return Object.defineProperty(e.prototype,"camera_node",{get:function(){return this.viewer.cameras_controller.camera_node},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"canvas",{get:function(){return this.viewer.canvas},enumerable:!0,configurable:!0}),e.prototype.init=function(){this._bound_on_mousedown&&this.canvas.removeEventListener("mousedown",this._bound_on_mousedown),this._bound_on_mousemove&&this.canvas.removeEventListener("mousemove",this._bound_on_mousemove),this._bound_on_mouseup&&this.canvas.removeEventListener("mouseup",this._bound_on_mouseup),this._bound_on_mousedown=this._bound_on_mousedown||this._on_mousedown.bind(this),this._bound_on_mousemove=this._bound_on_mousemove||this._on_mousemove.bind(this),this._bound_on_mouseup=this._bound_on_mouseup||this._on_mouseup.bind(this),this.canvas.addEventListener("mousedown",this._bound_on_mousedown),this.canvas.addEventListener("mousemove",this._bound_on_mousemove),this.canvas.addEventListener("mouseup",this._bound_on_mouseup),this.canvas.addEventListener("touchstart",this._bound_on_mousedown,!1),this.canvas.addEventListener("touchmove",this._bound_on_mousemove,!1),this.canvas.addEventListener("touchend",this._bound_on_mouseup,!1),this.canvas.addEventListener("touchcancel",this._bound_on_mouseup,!1)},e.prototype._on_mousedown=function(e){if(this._mouse_distance_travelled=0,e instanceof MouseEvent)this._mousedown_pos.x=e.pageX,this._mousedown_pos.y=e.pageY;else{var t=e.touches[0];this._mousedown_pos.x=t.pageX,this._mousedown_pos.y=t.pageY}},e.prototype._on_mousemove=function(e){if(-1!==this._mouse_distance_travelled){var t=0;if(e instanceof MouseEvent)t=e.pageX-this._mousedown_pos.x+(e.pageY-this._mousedown_pos.y);else{var n=e.touches[0];t=n.pageX-this._mousedown_pos.x+(n.pageY-this._mousedown_pos.y)}this._mouse_distance_travelled+=Math.abs(t)}this.viewer.controls_controller.active},e.prototype._on_mouseup=function(e){this._mouse_distance_travelled,this._mouse_distance_travelled=-1},e}();t.EventsController=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this.viewer=e}return e.prototype.init=function(){var e=this.viewer.canvas;e.onwebglcontextlost=this._on_webglcontextlost.bind(this),e.onwebglcontextrestored=this._on_webglcontextrestored.bind(this)},e.prototype._on_webglcontextlost=function(){console.warn("context lost at frame",this.viewer.scene.frame),this.request_animation_frame_id?cancelAnimationFrame(this.request_animation_frame_id):console.warn("request_animation_frame_id not initialized"),console.warn("not canceled",this.request_animation_frame_id)},e.prototype._on_webglcontextrestored=function(){console.log("context restored")},e}();t.WebGLController=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=n(212),i=r.__importDefault(n(117)),s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.update_screen_quad=function(){var e=this.screen_quad,t=this.node.params.float("size"),n=t,r=this.node.params.float("far");!r||i.default(t)||i.default(n)||(e.scale.x=t,e.scale.y=n,e.position.z=-.9999*r)},t}(o.BaseBackgroundController);t.OrthographicCameraBackgroundController=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=r.__importDefault(n(288)),i=n(37),s=n(289),a=n(600),_=50,u=n(9),c=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.fov=u.ParamConfig.FLOAT(_),t.vertical_fov_range=u.ParamConfig.VECTOR2([0,100],{visible_if:{lock_width:1}}),t.horizontal_fov_range=u.ParamConfig.VECTOR2([0,100],{visible_if:{lock_width:0}}),t}return r.__extends(t,e),t}(s.BaseCameraObjParamsConfig)),p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=c,t}return r.__extends(t,e),t.type=function(){return"perspective_camera"},Object.defineProperty(t.prototype,"background_controller_constructor",{get:function(){return a.PerspectiveCameraBackgroundController},enumerable:!0,configurable:!0}),t.prototype.create_object=function(){return new i.PerspectiveCamera(_,1,s.BASE_CAMERA_DEFAULT.near,s.BASE_CAMERA_DEFAULT.far)},t.prototype.create_params=function(){this.create_common_params(),this.create_player_camera_params()},t.prototype.update_camera=function(){this._object.fov!=this.pv.fov&&(this._object.fov=this.pv.fov,this._object.updateProjectionMatrix()),this._update_for_aspect_ratio()},t.prototype._update_for_aspect_ratio=function(){if(this._aspect){var e=this.pv.lock_width;if(null==e&&(e=!0),this._object.aspect=this._aspect,e){var t=this.pv.fov/this._aspect;this._object.zoom=this.get_zoom(this._aspect,t,this.pv.vertical_fov_range)}else this._object.zoom=1;this._object.updateProjectionMatrix()}},t.prototype.get_zoom=function(e,t,n){var r=e;n&&((t<n.x||t>n.y)&&(r=e*(t/o.default(t,n.x,n.y))));return r},t}(s.TypedCameraObjNode);t.PerspectiveCameraObjNode=p},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=n(212),i=n(1),s=r.__importDefault(n(117)),a=r.__importDefault(n(148)),_={bl:{x:-1,y:-1},br:{x:1,y:-1},tl:{x:-1,y:1},tr:{x:1,y:1}},u=["bl","br","tl","tr"],c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._bg_corner={bl:new i.Vector3,br:new i.Vector3,tl:new i.Vector3,tr:new i.Vector3},t._bg_center=new i.Vector3,t}return r.__extends(t,e),t.prototype.update_screen_quad=function(){for(var e=this,t=this.screen_quad,n=0,r=u;n<r.length;n++){var o=r[n];this._update_corner_vector(this._bg_corner[o],_[o])}var i=this._bg_corner.bl.distanceTo(this._bg_corner.br),c=this._bg_corner.bl.distanceTo(this._bg_corner.tl);this._bg_center.x=a.default(u.map((function(t){return e._bg_corner[t].x})))/4,this._bg_center.y=a.default(u.map((function(t){return e._bg_corner[t].y})))/4,this._bg_center.z=a.default(u.map((function(t){return e._bg_corner[t].z})))/4;var p=this.node.params.float("far"),l=this.node.params.float("background_ratio");if(p&&!s.default(i)&&!s.default(c)){var d=p/this._bg_center.distanceTo(this.node.object.position),h=l||1;c=i>c?i/h:i*h,t.scale.x=i*d,t.scale.y=c*d,t.position.z=-.9999*p}},t.prototype._update_corner_vector=function(e,t){this._bg_raycaster.setFromCamera(t,this.node.object),e.copy(this._bg_raycaster.ray.direction).multiplyScalar(this.node.params.float("far")).add(this._bg_raycaster.ray.origin)},t}(o.BaseBackgroundController);t.PerspectiveCameraBackgroundController=c},,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(285),o=n(603),i=n(607),s=n(608),a=n(609),_=n(610),u=n(611),c=n(612),p=n(613),l=n(616),d=n(617),h=n(618),f=n(619),m=n(623),y=n(624),v=n(625),g=n(626),b=n(627),O=n(628),P=n(630),w=n(633),x=n(652),C=n(653),E=n(654),T=n(655),j=n(656),A=n(660),N=n(661),M=n(663),k=n(664),S=n(665),R=n(666),D=n(667),I=n(668),L=n(670),B=n(671),G=n(672),z=n(673),F=n(766),V=n(767),U=n(768),Y=n(769),q=n(773),H=n(774),X=n(775),J=n(776),W=n(777),K=n(779),Z=n(780),Q=n(781),$=n(785),ee=n(786),te=n(787),ne=n(788),re=n(789),oe=function(){function e(){}return e.run=function(e){e.register_node(o.AddSopNode,r.CATEGORY_SOP.INPUT),e.register_node(i.AnimationCopySopNode,r.CATEGORY_SOP.ANIMATION),e.register_node(s.AnimationMixerSopNode,r.CATEGORY_SOP.ANIMATION),e.register_node(a.AttribAddMultSopNode,r.CATEGORY_SOP.ATTRIBUTE),e.register_node(_.AttribCopySopNode,r.CATEGORY_SOP.ATTRIBUTE),e.register_node(u.AttribCreateSopNode,r.CATEGORY_SOP.ATTRIBUTE),e.register_node(c.AttribDeleteSopNode,r.CATEGORY_SOP.ATTRIBUTE),e.register_node(p.AttribNormalizeSopNode,r.CATEGORY_SOP.ATTRIBUTE),e.register_node(l.AttribPromoteSopNode,r.CATEGORY_SOP.ATTRIBUTE),e.register_node(d.AttribRemapSopNode,r.CATEGORY_SOP.ATTRIBUTE),e.register_node(h.AttribRenameSopNode,r.CATEGORY_SOP.ATTRIBUTE),e.register_node(f.AttribTransferSopNode,r.CATEGORY_SOP.ATTRIBUTE),e.register_node(m.BboxScatterSopNode,r.CATEGORY_SOP.MODIFIER),e.register_node(y.BlendSopNode,r.CATEGORY_SOP.MODIFIER),e.register_node(v.BoxSopNode,r.CATEGORY_SOP.INPUT),e.register_node(g.CacheSopNode,r.CATEGORY_SOP.MISC),e.register_node(b.CircleSopNode,r.CATEGORY_SOP.INPUT),e.register_node(O.ColorSopNode,r.CATEGORY_SOP.MODIFIER),e.register_node(P.CopySopNode,r.CATEGORY_SOP.MODIFIER),e.register_node(w.DataSopNode,r.CATEGORY_SOP.INPUT),e.register_node(x.DataUrlSopNode,r.CATEGORY_SOP.INPUT),e.register_node(C.DelaySopNode,r.CATEGORY_SOP.MISC),e.register_node(E.DeleteSopNode,r.CATEGORY_SOP.MODIFIER),e.register_node(T.FaceSopNode,r.CATEGORY_SOP.MODIFIER),e.register_node(j.FileSopNode,r.CATEGORY_SOP.INPUT),e.register_node(A.FuseSopNode,r.CATEGORY_SOP.MODIFIER),e.register_node(N.HexagonsSopNode,r.CATEGORY_SOP.INPUT),e.register_node(M.HierarchySopNode,r.CATEGORY_SOP.MISC),e.register_node(k.JitterSopNode,r.CATEGORY_SOP.MODIFIER),e.register_node(S.LayerSopNode,r.CATEGORY_SOP.MODIFIER),e.register_node(R.LineSopNode,r.CATEGORY_SOP.INPUT),e.register_node(D.MergeSopNode,r.CATEGORY_SOP.MISC),e.register_node(I.NoiseSopNode,r.CATEGORY_SOP.MISC),e.register_node(L.NormalsSopNode,r.CATEGORY_SOP.MODIFIER),e.register_node(B.NullSopNode,r.CATEGORY_SOP.MODIFIER),e.register_node(G.ObjectMergeSopNode,r.CATEGORY_SOP.INPUT),e.register_node(z.OcclusionSopNode,r.CATEGORY_SOP.INPUT),e.register_node(F.PeakSopNode,r.CATEGORY_SOP.MODIFIER),e.register_node(V.PlaneSopNode,r.CATEGORY_SOP.INPUT),e.register_node(U.PointSopNode,r.CATEGORY_SOP.MODIFIER),e.register_node(Y.PolywireSopNode,r.CATEGORY_SOP.MODIFIER),e.register_node(q.RaySopNode,r.CATEGORY_SOP.MODIFIER),e.register_node(H.ResampleSopNode,r.CATEGORY_SOP.MODIFIER),e.register_node(X.ScatterSopNode,r.CATEGORY_SOP.MODIFIER),e.register_node(W.SkinSopNode,r.CATEGORY_SOP.MODIFIER),e.register_node(J.ShadowsSopNode,r.CATEGORY_SOP.MODIFIER),e.register_node(K.SphereSopNode,r.CATEGORY_SOP.INPUT),e.register_node(Z.SwitchSopNode,r.CATEGORY_SOP.MISC),e.register_node(Q.TextSopNode,r.CATEGORY_SOP.INPUT),e.register_node($.TorusSopNode,r.CATEGORY_SOP.INPUT),e.register_node(ee.TorusKnotSopNode,r.CATEGORY_SOP.INPUT),e.register_node(te.TransformSopNode,r.CATEGORY_SOP.MODIFIER),e.register_node(ne.TubeSopNode,r.CATEGORY_SOP.INPUT),e.register_node(re.UvProjectSopNode,r.CATEGORY_SOP.MODIFIER)},e}();t.SopRegister=oe},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=r.__importDefault(n(149)),i=n(5),s=n(4),a=n(14),_=n(26),u=n(9),c=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.create_point=u.ParamConfig.BOOLEAN(1),t.points_count=u.ParamConfig.INTEGER(1,{range:[1,100],range_locked:[!0,!1],visible_if:{create_point:!0}}),t.position=u.ParamConfig.VECTOR3([0,0,0],{visible_if:{create_point:!0}}),t.open=u.ParamConfig.BOOLEAN(0),t.connect_to_last_point=u.ParamConfig.BOOLEAN(0),t}return r.__extends(t,e),t}(u.NodeParamsConfig)),p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=c,t}return r.__extends(t,e),t.type=function(){return"add"},t.displayed_input_names=function(){return["geometry to create polygons from (optional)"]},t.prototype.initialize_node=function(){this.io.inputs.set_count(0,1)},t.prototype.cook=function(e){this._objects=[],this._create_point(),this.set_objects(this._objects)},t.prototype._create_point=function(){var e=this;if(this.pv.create_point){var t=new i.BufferGeometry,n=[];o.default(this.pv.points_count,(function(t){e.pv.position.toArray(n,3*t)})),t.setAttribute("position",new s.BufferAttribute(new Float32Array(n),3));var r=this.create_object(t,_.CoreConstant.OBJECT_TYPE.POINTS);this._objects&&this._objects.push(r)}},t}(a.TypedSopNode);t.AddSopNode=p},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3).__importDefault(n(148)),o=n(1),i=n(2),s=n(77),a=n(294),_=n(104),u=function(){function e(e,t){this._core_geometry=e,this._index=t,this._geometry=this._core_geometry.geometry()}return Object.defineProperty(e.prototype,"index",{get:function(){return this._index},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"points",{get:function(){return this._points=this._points||this._get_points()},enumerable:!0,configurable:!0}),e.prototype._get_points=function(){var e,t=(null===(e=this._geometry.index)||void 0===e?void 0:e.array)||[],n=3*this._index;return[new a.CorePoint(this._core_geometry,t[n+0]),new a.CorePoint(this._core_geometry,t[n+1]),new a.CorePoint(this._core_geometry,t[n+2])]},Object.defineProperty(e.prototype,"positions",{get:function(){return this._positions=this._positions||this._get_positions()},enumerable:!0,configurable:!0}),e.prototype._get_positions=function(){var e=this.points;return[e[0].position(),e[1].position(),e[2].position()]},Object.defineProperty(e.prototype,"triangle",{get:function(){return this._triangle=this._triangle||this._get_triangle()},enumerable:!0,configurable:!0}),e.prototype._get_triangle=function(){var e=this.positions;return new s.Triangle(e[0],e[1],e[2])},Object.defineProperty(e.prototype,"deltas",{get:function(){return this._deltas=this._deltas||this._get_deltas()},enumerable:!0,configurable:!0}),e.prototype._get_deltas=function(){return[this.positions[1].clone().sub(this.positions[0]),this.positions[2].clone().sub(this.positions[0])]},Object.defineProperty(e.prototype,"area",{get:function(){return this.triangle.getArea()},enumerable:!0,configurable:!0}),e.prototype.center=function(e){var t=this.positions;return e.x=(t[0].x+t[1].x+t[2].x)/3,e.y=(t[0].y+t[1].y+t[2].y)/3,e.z=(t[0].z+t[1].z+t[2].z)/3,e},e.prototype.random_position=function(e){var t=[_.CoreMath.rand_float(e),_.CoreMath.rand_float(6541*e)];return t[0]+t[1]>1&&(t[0]=1-t[0],t[1]=1-t[1]),this.positions[0].clone().add(this.deltas[0].clone().multiplyScalar(t[0])).add(this.deltas[1].clone().multiplyScalar(t[1]))},e.prototype.attrib_value_at_position=function(e,t){var n=new o.Vector3;this.triangle.getBarycoord(t,n);var r,i,s=n.toArray(),a=this._geometry.attributes[e].itemSize,_=this.points.map((function(t){return t.attrib_value(e)})),u=0;switch(a){case 1:i=0;for(var c=0,p=_;c<p.length;c++){i+=p[c]*s[u],u++}r=i;break;default:for(var l=0,d=_;l<d.length;l++){var h=d[l].multiplyScalar(s[u]);i?i.add(h):i=h,u++}r=i}return r},e.interpolated_value=function(e,t,n,s){var a=[t.a,t.b,t.c],_=e.getAttribute("position").array,u=a.map((function(e){return new o.Vector3(_[3*e+0],_[3*e+1],_[3*e+2])})),c=s.itemSize,p=s.array,l=[];switch(c){case 1:l=a.map((function(e){return p[e]}));break;case 2:l=a.map((function(e){return new i.Vector2(p[2*e+0],p[2*e+1])}));break;case 3:l=a.map((function(e){return new o.Vector3(p[3*e+0],p[3*e+1],p[3*e+2])}))}var d,h=a.map((function(e,t){return n.distanceTo(u[t])})),f=r.default([h[0]*h[1],h[0]*h[2],h[1]*h[2]]),m=[h[1]*h[2]/f,h[0]*h[2]/f,h[0]*h[1]/f];switch(c){case 1:d=r.default(a.map((function(e,t){return m[t]*l[t]})));break;default:d=null;for(var y=0,v=a.map((function(e,t){return l[t].multiplyScalar(m[t])}));y<v.length;y++){var g=v[y];d?d.add(g):d=g}}return d},e}();t.CoreFace=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(76),o=function(){function e(){}return e.patch=function(e){Object.assign(e,{clone:function(){return new r.InterleavedBufferAttribute(e.data.clone(),e.itemSize,e.offset,e.normalized)}})},e}();t.MonkeyPatcher=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=n(119),i=n(43),s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.set_objects=function(e){},t.prototype.core_content_cloned=function(){if(this._content)return this._content.clone()},t.prototype.set_content=function(t){e.prototype.set_content.call(this,t)},t.prototype.first_object=function(){if(this._content)return this._content.objects()[0]},t.prototype.first_geometry=function(){var e=this.first_object();return e?e.geometry:null},t.prototype.objects_count=function(){return this._content?this._content.objects().length:0},t.prototype.objects_visible_count=function(){var e=0;return this._content&&(e=this._content.objects().filter((function(e){return e.visible})).length),e},t.prototype.objects_count_by_type=function(){var e={},t=this._content;if(this._content&&t)for(var n=0,r=t.core_objects();n<r.length;n++){var o=r[n].human_type();null==e[o]&&(e[o]=0),e[o]+=1}return e},t.prototype.objects_names_by_type=function(){var e={},t=this._content;if(this._content&&t)for(var n=0,r=t.core_objects();n<r.length;n++){var o=r[n],i=o.human_type();e[i]=e[i]||[],e[i].push(o.name())}return e},t.prototype.vertex_attribute_names=function(){var e=[],t=this.first_geometry();return t&&(e=Object.keys(t.attributes)),e},t.prototype.vertex_attribute_sizes_by_name=function(){var e={},t=this.first_geometry();return t&&Object.keys(t.attributes).forEach((function(n){var r=t.attributes[n];e[n]=r.itemSize})),e},t.prototype.vertex_attribute_types_by_name=function(){var e={},t=this.first_geometry();if(t){var n=new i.CoreGeometry(t);Object.keys(t.attributes).forEach((function(t){e[t]=n.attrib_type(t)}))}return e},t.prototype.object_attribute_names=function(){var e=[],t=this.first_object();return t&&(e=Object.keys(t.userData.attributes||{})),e},t.prototype.points_count=function(){return this._content?this._content.points_count():0},t.prototype.bounding_box=function(){return this._content.bounding_box()},t.prototype.center=function(){return this._content.center()},t.prototype.size=function(){return this._content.size()},t}(o.TypedContainer);t.GeometryContainer=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=n(14),i=n(9),s=n(19),a=new(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t}(i.NodeParamsConfig)),_=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=a,t}return r.__extends(t,e),t.type=function(){return"animation_copy"},t.displayed_input_names=function(){return["geometry to copy animation to","geometry to copy animation from"]},t.prototype.initialize_node=function(){this.io.inputs.set_count(2),this.io.inputs.init_inputs_clonable_state([s.InputCloneMode.FROM_NODE,s.InputCloneMode.NEVER])},t.prototype.cook=function(e){var t=e[0],n=e[1].objects()[0],r=t.objects()[0],o=n.animations;o?(r.animations=o.map((function(e){return e.clone()})),this.set_core_group(t)):this.states.error.set("no animation found")},t}(o.TypedSopNode);t.AnimationCopySopNode=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=n(14),i=r.__importDefault(n(21)),s=n(794),a=n(19),_=n(25),u=n(64),c=n(9),p=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.time=c.ParamConfig.FLOAT("$T",{range:[0,10]}),t.prepare=c.ParamConfig.BUTTON(null,{callback:function(e,t){l.PARAM_CALLBACK_prepare(e,t)}}),t}return r.__extends(t,e),t}(c.NodeParamsConfig)),l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=p,t._previous_time=null,t._mixer=null,t._actions_by_name={},t._values_by_param_name={},t}return r.__extends(t,e),t.type=function(){return"animation_mixer"},t.displayed_input_names=function(){return["geometry to be animated"]},t.prototype.initialize_node=function(){this.io.inputs.set_count(1),this.io.inputs.init_inputs_clonable_state([a.InputCloneMode.FROM_NODE])},t.prototype.cook=function(e){this._mixer?(this._update_mixer(),this.cook_controller.end_cook()):this.create_mixer(e[0])},t.prototype.create_mixer=function(e){var t=this;this._animation_target=e.objects()[0],this._mixer=new s.AnimationMixer(this._animation_target),this._remove_spare_params(),this._actions_by_name={},this._animation_target.animations&&this._animation_target.animations.forEach((function(e,n){var r=e.name,o=t._values_by_param_name[r];null==o&&(o=0==n?1:0);var i=t.add_param(_.ParamType.FLOAT,r,o,{spare:!0});if(i){var s=t._values_by_param_name[r];s&&i.set(s)}if(t._mixer){var a=t._mixer.clipAction(e);t._actions_by_name[e.name]=a}})),this.emit(u.NodeEvent.PARAMS_UPDATED),Object.keys(this._actions_by_name).forEach((function(e){t._actions_by_name[e].play()}));var n={};this._animation_target.traverse((function(e){var t=e;t.material&&(i.default(t.material)||(n[t.material.uuid]=t.material))})),Object.keys(n).forEach((function(e){var t=n[e];t.skinning=!0,t.morphTargets=!0})),this._previous_time=null,this._update_mixer(),this._update_mixer_weights(),this.set_object(this._animation_target)},t.prototype._remove_spare_params=function(){var e=this;this._values_by_param_name={},this.params.spare_names.forEach((function(t){var n=e.params.get_float(t);n&&(e._values_by_param_name[t]=n.value,e.params.delete_param(t))}))},t.prototype._update_mixer=function(){this.pv.time!=this._previous_time?this._update_mixer_time():this._update_mixer_weights()},t.prototype._update_mixer_time=function(){var e=this.pv.time-(this._previous_time||0);this._mixer&&this._mixer.update(e),this._previous_time=this.pv.time},t.prototype._update_mixer_weights=function(){for(var e=0,t=Object.keys(this._actions_by_name);e<t.length;e++){var n=t[e],r=this._actions_by_name[n],o=this.params.get_float(n).value;null!=o&&r.setEffectiveWeight(o)}},t.PARAM_CALLBACK_prepare=function(e,t){e.prepare_animation_mixer()},t.prototype.prepare_animation_mixer=function(){return r.__awaiter(this,void 0,void 0,(function(){var e;return r.__generator(this,(function(t){switch(t.label){case 0:return this._mixer=null,[4,this.io.inputs.eval_required_input(0)];case 1:return e=t.sent(),this.create_mixer(e.core_content_cloned()),this.set_dirty(),[2]}}))}))},t}(o.TypedSopNode);t.AnimationMixerSopNode=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=n(14),i=n(9),s=n(19),a=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name=i.ParamConfig.STRING(""),t.pre_add=i.ParamConfig.FLOAT(0,{range:[0,1]}),t.mult=i.ParamConfig.FLOAT(1,{range:[0,1]}),t.post_add=i.ParamConfig.FLOAT(0,{range:[0,1]}),t}return r.__extends(t,e),t}(i.NodeParamsConfig)),_=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=a,t}return r.__extends(t,e),t.type=function(){return"attrib_add_mult"},t.prototype.initialize_node=function(){this.io.inputs.set_count(1),this.io.inputs.init_inputs_clonable_state([s.InputCloneMode.FROM_NODE])},t.prototype.cook=function(e){for(var t=e[0],n=0,r=t.attrib_names_matching_mask(this.pv.name);n<r.length;n++)for(var o=r[n],i=0,s=t.geometries();i<s.length;i++){var a=s[i];this._update_attrib(o,a)}this.set_core_group(t)},t.prototype._update_attrib=function(e,t){var n=t.getAttribute(e);if(n){for(var r=n.array,o=this.pv.pre_add,i=this.pv.mult,s=this.pv.post_add,a=0;a<r.length;a++){var _=r[a];r[a]=(_+o)*i+s}this.io.inputs.input_cloned(0)||(n.needsUpdate=!0)}},t}(o.TypedSopNode);t.AttribAddMultSopNode=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=n(14),i=n(9),s=n(19),a=n(4),_=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name=i.ParamConfig.STRING(""),t.tnew_name=i.ParamConfig.BOOLEAN(0),t.new_name=i.ParamConfig.STRING("",{visible_if:{tnew_name:1}}),t}return r.__extends(t,e),t}(i.NodeParamsConfig)),u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=_,t}return r.__extends(t,e),t.type=function(){return"attrib_copy"},t.displayed_input_names=function(){return["geometry to copy attributes to","geometry to copy attributes from"]},t.prototype.initialize_node=function(){this.io.inputs.set_count(2),this.io.inputs.init_inputs_clonable_state([s.InputCloneMode.FROM_NODE,s.InputCloneMode.NEVER])},t.prototype.create_params=function(){},t.prototype.cook=function(e){for(var t=e[0],n=e[1],r=0,o=n.attrib_names_matching_mask(this.pv.name);r<o.length;r++){var i=o[r];this.copy_vertex_attribute_between_core_groups(t,n,i)}return this.set_core_group(t)},t.prototype.copy_vertex_attribute_between_core_groups=function(e,t,n){var r=t.objects(),o=e.objects();if(o.length>r.length)this.states.error.set("second input does not have enough objects to copy attributes from");else for(var i=0;i<o.length;i++){var s=o[i].geometry,a=o[i].geometry;this.copy_vertex_attribute_between_geometries(s,a,n)}},t.prototype.copy_vertex_attribute_between_geometries=function(e,t,n){var r=t.getAttribute(n);if(r){var o=r.itemSize,i=t.getAttribute("position").array.length/3,s=e.getAttribute("position").array.length/3;s>i&&this.states.error.set("not enough points in second input");var _=r.array.slice(0,s*o),u=this.pv.tnew_name?this.pv.new_name:n;e.setAttribute(u,new a.Float32BufferAttribute(_,o))}else this.states.error.set("attribute '"+n+"' does not exist on second input")},t}(o.TypedSopNode);t.AttribCopySopNode=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=r.__importDefault(n(203)),i=n(14),s=n(26),a=n(94),_=n(19),u=n(9),c=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.group=u.ParamConfig.STRING(""),t.class=u.ParamConfig.INTEGER(s.AttribClass.VERTEX,{menu:{entries:s.AttribClassMenuEntries}}),t.type=u.ParamConfig.INTEGER(s.AttribType.NUMERIC,{menu:{entries:s.AttribTypeMenuEntries}}),t.name=u.ParamConfig.STRING("new_attrib"),t.size=u.ParamConfig.INTEGER(1,{range:[1,4],range_locked:[!0,!0],visible_if:{type:s.CoreConstant.ATTRIB_TYPE.NUMERIC}}),t.value1=u.ParamConfig.FLOAT(0,{visible_if:{type:s.CoreConstant.ATTRIB_TYPE.NUMERIC,size:1},expression:{for_entities:!0}}),t.value2=u.ParamConfig.VECTOR2([0,0],{visible_if:{type:s.CoreConstant.ATTRIB_TYPE.NUMERIC,size:2},expression:{for_entities:!0}}),t.value3=u.ParamConfig.VECTOR3([0,0,0],{visible_if:{type:s.CoreConstant.ATTRIB_TYPE.NUMERIC,size:3},expression:{for_entities:!0}}),t.value4=u.ParamConfig.VECTOR4([0,0,0,0],{visible_if:{type:s.CoreConstant.ATTRIB_TYPE.NUMERIC,size:4},expression:{for_entities:!0}}),t.string=u.ParamConfig.STRING("",{visible_if:{type:s.CoreConstant.ATTRIB_TYPE.STRING},expression:{for_entities:!0}}),t}return r.__extends(t,e),t}(u.NodeParamsConfig)),p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=c,t._x_arrays_by_geometry_uuid={},t._y_arrays_by_geometry_uuid={},t._z_arrays_by_geometry_uuid={},t._w_arrays_by_geometry_uuid={},t}return r.__extends(t,e),t.type=function(){return"attrib_create"},t.prototype.initialize_node=function(){this.io.inputs.set_count(1),this.io.inputs.init_inputs_clonable_state([_.InputCloneMode.FROM_NODE])},t.prototype.cook=function(e){var t=e[0];if(this.pv.name&&""!=o.default(this.pv.name))switch(this.pv.class){case s.AttribClass.VERTEX:this.add_point_attribute(t);case s.AttribClass.OBJECT:this.add_object_attribute(t)}else this.states.error.set("attribute name is not valid")},t.prototype.add_point_attribute=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,n,o;return r.__generator(this,(function(r){switch(r.label){case 0:t=e.core_objects(),n=0,r.label=1;case 1:if(!(n<t.length))return[3,7];switch(o=t[n],this.pv.type){case s.CoreConstant.ATTRIB_TYPE.NUMERIC:return[3,2];case s.CoreConstant.ATTRIB_TYPE.STRING:return[3,4]}return[3,6];case 2:return[4,this.add_numeric_attribute_to_points(o)];case 3:return r.sent(),[3,6];case 4:return[4,this.add_string_attribute_to_points(o)];case 5:return r.sent(),[3,6];case 6:return n++,[3,1];case 7:return this.set_core_group(e),[2]}}))}))},t.prototype.add_object_attribute=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t;return r.__generator(this,(function(n){switch(n.label){case 0:switch(t=e.core_objects_from_group(this.pv.group),this.pv.type){case s.CoreConstant.ATTRIB_TYPE.NUMERIC:return[3,1];case s.CoreConstant.ATTRIB_TYPE.STRING:return[3,3]}return[3,5];case 1:return[4,this.add_numeric_attribute_to_object(t)];case 2:return n.sent(),[3,5];case 3:return[4,this.add_string_attribute_to_object(t)];case 4:return n.sent(),[3,5];case 5:return this.set_core_group(e),[2]}}))}))},t.prototype.add_numeric_attribute_to_points=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,n,o,i,s,a,_,u,c,p,l,d,h,f,m,y=this;return r.__generator(this,(function(v){switch(v.label){case 0:return t=e.core_geometry(),n=e.points_from_group(this.pv.group),(o=[this.p.value1,this.p.value2,this.p.value3,this.p.value4][this.pv.size-1]).has_expression()?(t.has_attrib(this.pv.name)||t.add_numeric_attrib(this.pv.name,this.pv.size,o.value),i=t.geometry(),s=i.getAttribute(this.pv.name).array,1!=this.pv.size?[3,3]:this.p.value1.expression_controller?[4,this.p.value1.expression_controller.compute_expression_for_points(n,(function(e,t){s[e.index*y.pv.size+0]=t}))]:[3,2]):[3,9];case 1:v.sent(),v.label=2;case 2:return[3,8];case 3:a=[this.p.value2,this.p.value3,this.p.value4][this.pv.size-2],_=a.components,u=new Array(_.length),c=void 0,p=[this._x_arrays_by_geometry_uuid,this._y_arrays_by_geometry_uuid,this._z_arrays_by_geometry_uuid,this._w_arrays_by_geometry_uuid],l=function(e){var t,o,a,l;return r.__generator(this,(function(r){switch(r.label){case 0:return(c=_[e]).has_expression()&&c.expression_controller?(u[e]=d._init_array_if_required(i,p[e],n.length),[4,c.expression_controller.compute_expression_for_points(n,(function(t,n){u[e][t.index]=n}))]):[3,2];case 1:return r.sent(),[3,3];case 2:for(t=c.value,o=0,a=n;o<a.length;o++)l=a[o],s[l.index*d.pv.size+e]=t;r.label=3;case 3:return[2]}}))},d=this,m=0,v.label=4;case 4:return m<_.length?[5,l(m)]:[3,7];case 5:v.sent(),v.label=6;case 6:return m++,[3,4];case 7:for(h=0;h<u.length;h++)if(f=u[h])for(m=0;m<f.length;m++)s[m*this.pv.size+h]=f[m];v.label=8;case 8:return[3,10];case 9:e.add_numeric_vertex_attrib(this.pv.name,this.pv.size,o.value),v.label=10;case 10:return[2]}}))}))},t.prototype.add_numeric_attribute_to_object=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,n,o,i,s,a,_,u,c,p,l,d,h,f=this;return r.__generator(this,(function(m){switch(m.label){case 0:return(t=[this.p.value1,this.p.value2,this.p.value3,this.p.value4][this.pv.size-1]).has_expression()?1!=this.pv.size?[3,3]:this.p.value1.expression_controller?[4,this.p.value1.expression_controller.compute_expression_for_objects(e,(function(e,t){e.set_attrib_value(f.pv.name,t)}))]:[3,2]:[3,9];case 1:m.sent(),m.label=2;case 2:return[3,8];case 3:for(n=[this.p.value2,this.p.value3,this.p.value4][this.pv.size-2],o=n.components,i={},s=0,a=e;s<a.length;s++)h=a[s],i[h.index]=[];_=function(t){var n,s,a,_;return r.__generator(this,(function(r){switch(r.label){case 0:return(n=o[t]).has_expression()&&n.expression_controller?[4,n.expression_controller.compute_expression_for_objects(e,(function(e,n){i[e.index][t]=n}))]:[3,2];case 1:return r.sent(),[3,3];case 2:for(s=0,a=e;s<a.length;s++)_=a[s],i[_.index][t]=n.value;r.label=3;case 3:return[2]}}))},u=0,m.label=4;case 4:return u<o.length?[5,_(u)]:[3,7];case 5:m.sent(),m.label=6;case 6:return u++,[3,4];case 7:for(c=0;c<e.length;c++)h=e[c],p=i[h.index],h.set_attrib_value(this.pv.name,p);m.label=8;case 8:return[3,10];case 9:for(l=0,d=e;l<d.length;l++)(h=d[l]).set_attrib_value(this.pv.name,t.value);m.label=10;case 10:return[2]}}))}))},t.prototype.add_string_attribute_to_points=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,n,o,i;return r.__generator(this,(function(r){switch(r.label){case 0:return t=e.points_from_group(this.pv.group),n=this.p.string,o=[],n.has_expression()&&n.expression_controller?[4,n.expression_controller.compute_expression_for_points(t,(function(e,t){o[e.index]=t}))]:[3,2];case 1:return r.sent(),[3,3];case 2:o.push(n.value),r.label=3;case 3:return i=a.CoreAttribute.array_to_indexed_arrays(o),e.core_geometry().set_indexed_attribute(this.pv.name,i.values,i.indices),[2]}}))}))},t.prototype.add_string_attribute_to_object=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,n,o,i=this;return r.__generator(this,(function(r){switch(r.label){case 0:return(t=this.p.string).has_expression()&&t.expression_controller?[4,t.expression_controller.compute_expression_for_objects(e,(function(e,t){e.set_attrib_value(i.pv.name,t)}))]:[3,2];case 1:return r.sent(),[3,3];case 2:for(n=0,o=e;n<o.length;n++)o[n].set_attrib_value(this.pv.name,t.value);r.label=3;case 3:return[2]}}))}))},t.prototype._init_array_if_required=function(e,t,n){var r=e.uuid,o=t[r];return o?o.length<n&&(t[r]=new Array(n)):t[r]=new Array(n),t[r]},t}(i.TypedSopNode);t.AttribCreateSopNode=p},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=n(14),i=n(214),s=n(43),a=n(26),_=n(19),u=n(9),c=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.class=u.ParamConfig.INTEGER(a.AttribClass.VERTEX,{menu:{entries:a.AttribClassMenuEntries}}),t.name=u.ParamConfig.STRING(""),t}return r.__extends(t,e),t}(u.NodeParamsConfig)),p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=c,t}return r.__extends(t,e),t.type=function(){return"attrib_delete"},t.displayed_input_names=function(){return["geometry to delete attributes from"]},t.prototype.initialize_node=function(){this.io.inputs.set_count(1),this.io.inputs.init_inputs_clonable_state([_.InputCloneMode.FROM_NODE])},t.prototype.cook=function(e){for(var t=e[0],n=0,r=t.attrib_names_matching_mask(this.pv.name);n<r.length;n++){var o=r[n];switch(this.pv.class){case a.AttribClass.VERTEX:this.delete_vertex_attribute(t,o);case a.AttribClass.OBJECT:this.delete_object_attribute(t,o)}}this.set_core_group(t)},t.prototype.delete_vertex_attribute=function(e,t){for(var n=0,r=e.objects();n<r.length;n++){r[n].traverse((function(e){var n=e;n.geometry&&new s.CoreGeometry(n.geometry).delete_attribute(t)}))}},t.prototype.delete_object_attribute=function(e,t){for(var n=function(e){var n=0;e.traverse((function(e){var r=e;new i.CoreObject(r,n).delete_attribute(t),n++}))},r=0,o=e.objects();r<o.length;r++){n(o[r])}},t}(o.TypedSopNode);t.AttribDeleteSopNode=p},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=n(14),i=n(1),s=r.__importDefault(n(150)),a=r.__importDefault(n(216)),_=r.__importDefault(n(41)),u=n(19),c=n(9),p=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name=c.ParamConfig.STRING(""),t.change_name=c.ParamConfig.BOOLEAN(!1),t.new_name=c.ParamConfig.STRING("",{visible_if:{change_name:1}}),t}return r.__extends(t,e),t}(c.NodeParamsConfig)),l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=p,t}return r.__extends(t,e),t.type=function(){return"attrib_normalize"},t.prototype.initialize_node=function(){this.io.inputs.set_count(1),this.io.inputs.init_inputs_clonable_state([u.InputCloneMode.FROM_NODE])},t.prototype.cook=function(e){var t=e[0];this._normalize_attribute(t),this.set_core_group(t)},t.prototype._normalize_attribute=function(e){var t=this,n=e.points();if(0!==n.length&&""!==this.pv.name){var r,o,u=n[0].attrib_size(this.pv.name),c=n.map((function(e){return e.attrib_value(t.pv.name)})),p=[];switch(u){case 1:if(r=a.default(c),o=s.default(c),_.default(r)&&_.default(o))for(var l=0,d=c;l<d.length;l++){var h=d[l],f=o>r?(h-r)/(o-r):1;p.push(f)}break;case 3:if(r=new i.Vector3(a.default(c.map((function(e){return e.x}))),a.default(c.map((function(e){return e.y}))),a.default(c.map((function(e){return e.z})))),o=new i.Vector3(s.default(c.map((function(e){return e.x}))),s.default(c.map((function(e){return e.y}))),s.default(c.map((function(e){return e.z})))),r instanceof i.Vector3&&o instanceof i.Vector3)for(var m=0,y=c;m<y.length;m++){h=y[m],f=new i.Vector3((h.x-r.x)/(o.x-r.x),(h.y-r.y)/(o.y-r.y),(h.z-r.z)/(o.z-r.z));p.push(f)}}var v=this.pv.name;this.pv.change_name&&(v=this.pv.new_name,e.has_attrib(v)||e.add_numeric_vertex_attrib(v,u,0)),p.forEach((function(e,t){n[t].set_attrib_value(v,e)}))}},t}(o.TypedSopNode);t.AttribNormalizeSopNode=l},,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,o=n(3),i=o.__importDefault(n(150)),s=o.__importDefault(n(216)),a=n(19),_=n(14),u=n(26),c=n(49);!function(e){e[e.MIN=0]="MIN",e[e.MAX=1]="MAX",e[e.FIRST_FOUND=3]="FIRST_FOUND"}(r=t.AttribPromoteMode||(t.AttribPromoteMode={}));var p=[{name:"min",value:r.MIN},{name:"max",value:r.MAX},{name:"first_found",value:r.FIRST_FOUND}],l=n(9),d=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.class_from=l.ParamConfig.INTEGER(u.AttribClass.VERTEX,{menu:{entries:u.AttribClassMenuEntries}}),t.class_to=l.ParamConfig.INTEGER(u.AttribClass.OBJECT,{menu:{entries:u.AttribClassMenuEntries}}),t.mode=l.ParamConfig.INTEGER(r.MIN,{menu:{entries:p}}),t.name=l.ParamConfig.STRING(""),t}return o.__extends(t,e),t}(l.NodeParamsConfig)),h=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=d,t._values_per_attrib_name={},t._filtered_values_per_attrib_name={},t}return o.__extends(t,e),t.type=function(){return"attrib_promote"},t.prototype.initialize_node=function(){this.io.inputs.set_count(1),this.io.inputs.init_inputs_clonable_state([a.InputCloneMode.FROM_NODE]),this.ui_data.set_icon("sort-amount-up")},t.prototype.create_params=function(){},t.prototype.cook=function(e){this._core_group=e[0],this._values_per_attrib_name={},this._filtered_values_per_attrib_name={};for(var t=0,n=this._core_group.core_objects();t<n.length;t++){var r=n[t];this._core_object=r,this.find_values(),this.filter_values(),this.set_values()}this.set_core_group(this._core_group)},t.prototype.find_values=function(){for(var e=0,t=c.CoreString.attrib_names(this.pv.name);e<t.length;e++){var n=t[e];switch(this.pv.class_from){case u.AttribClass.VERTEX:return this.find_values_from_points(n);case u.AttribClass.OBJECT:return this.find_values_from_object(n)}}},t.prototype.find_values_from_points=function(e){if(this._core_object){var t=this._core_object.points();this._values_per_attrib_name[e]=t.map((function(t){return t.attrib_value(e)}))}},t.prototype.find_values_from_object=function(e){this._values_per_attrib_name[e]=[],this._core_object&&this._values_per_attrib_name[e].push(this._core_object.attrib_value(e))},t.prototype.filter_values=function(){for(var e=0,t=Object.keys(this._values_per_attrib_name);e<t.length;e++){var n=t[e],o=this._values_per_attrib_name[n];switch(this.pv.mode){case r.MIN:this._filtered_values_per_attrib_name[n]=s.default(o);break;case r.MAX:this._filtered_values_per_attrib_name[n]=i.default(o);break;case r.FIRST_FOUND:this._filtered_values_per_attrib_name[n]=o[0]}}},t.prototype.set_values=function(){for(var e=0,t=Object.keys(this._filtered_values_per_attrib_name);e<t.length;e++){var n=t[e],r=this._filtered_values_per_attrib_name[n];if(null!=r)switch(this.pv.class_to){case u.AttribClass.VERTEX:this.set_values_to_points(n,r);break;case u.AttribClass.OBJECT:this.set_values_to_object(n,r)}}},t.prototype.set_values_to_points=function(e,t){if(this._core_group&&this._core_object){if(!this._core_group.has_attrib(e)){this._core_group.add_numeric_vertex_attrib(e,1,t)}this._core_object.points().forEach((function(n){return n.set_attrib_value(e,t)}))}},t.prototype.set_values_to_object=function(e,t){var n;null===(n=this._core_object)||void 0===n||n.set_attrib_value(e,t)},t}(_.TypedSopNode);t.AttribPromoteSopNode=h},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=r.__importDefault(n(150)),i=r.__importDefault(n(216)),s=r.__importDefault(n(93)),a=r.__importDefault(n(102)),_=r.__importDefault(n(41)),u=n(1),c=n(14),p=n(9),l=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name=p.ParamConfig.STRING(),t.ramp=p.ParamConfig.RAMP(),t.change_name=p.ParamConfig.BOOLEAN(0),t.new_name=p.ParamConfig.STRING("",{visible_if:{change_name:1}}),t}return r.__extends(t,e),t}(p.NodeParamsConfig)),d=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=l,t}return r.__extends(t,e),t.type=function(){return"attrib_remap"},t.prototype.initialize_node=function(){this.io.inputs.set_count(1)},t.prototype.cook=function(e){var t=e[0];this._remap_attribute(t),this.set_core_group(t)},t.prototype._remap_attribute=function(e){var t=this,n=e.points();if(0!==n.length&&""!==this.pv.name){var r,c,p=n[0].attrib_size(this.pv.name),l=n.map((function(e){return e.attrib_value(t.pv.name)})),d=new Array(n.length);switch(p){case 1:if(this.pv.only_integer_values){var h=a.default(s.default(l)),f={};h.forEach((function(e,t){return f[e]=t})),d=l.map((function(e){return f[e]}))}else if(r=i.default(l),c=o.default(l),_.default(r)&&_.default(c))for(var m=0,y=l;m<y.length;m++){var v=y[m],g=c>r?(v-r)/(c-r):1;d.push(g)}break;case 3:if(r=new u.Vector3(i.default(l.map((function(e){return e.x}))),i.default(l.map((function(e){return e.y}))),i.default(l.map((function(e){return e.z})))),c=new u.Vector3(o.default(l.map((function(e){return e.x}))),o.default(l.map((function(e){return e.y}))),o.default(l.map((function(e){return e.z})))),r instanceof u.Vector3&&c instanceof u.Vector3)for(var b=0,O=l;b<O.length;b++){v=O[b],g=new u.Vector3((v.x-r.x)/(c.x-r.x),(v.y-r.y)/(c.y-r.y),(v.z-r.z)/(c.z-r.z));d.push(g)}}var P=this.pv.name;this.pv.change_name&&(P=this.pv.new_name,e.has_attrib(P)||e.add_numeric_vertex_attrib(P,p,0)),d.forEach((function(e,t){n[t].set_attrib_value(P,e)}))}},t}(c.TypedSopNode);t.AttribRemapSopNode=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=n(14),i=n(9),s=n(26),a=n(19),_=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.class=i.ParamConfig.INTEGER(s.AttribClass.VERTEX,{menu:{entries:s.AttribClassMenuEntries}}),t.old_name=i.ParamConfig.STRING(),t.new_name=i.ParamConfig.STRING(),t}return r.__extends(t,e),t}(i.NodeParamsConfig)),u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=_,t}return r.__extends(t,e),t.type=function(){return"attrib_rename"},t.prototype.initialize_node=function(){this.io.inputs.set_count(1),this.io.inputs.init_inputs_clonable_state([a.InputCloneMode.FROM_NODE])},t.prototype.cook=function(e){var t=e[0];t.rename_attrib(this.pv.old_name,this.pv.new_name,this.pv.class),this.set_core_group(t)},t}(o.TypedSopNode);t.AttribRenameSopNode=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=n(14),i=n(620),s=n(621),a=n(298),_=n(9),u=n(19),c=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.src_group=_.ParamConfig.STRING(),t.dest_group=_.ParamConfig.STRING(),t.name=_.ParamConfig.STRING(),t.max_samples_count=_.ParamConfig.INTEGER(1,{range:[1,10],range_locked:[!0,!1]}),t.distance_threshold=_.ParamConfig.FLOAT(1),t.blend_width=_.ParamConfig.FLOAT(0),t}return r.__extends(t,e),t}(_.NodeParamsConfig)),p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=c,t}return r.__extends(t,e),t.type=function(){return"attrib_transfer"},t.displayed_input_names=function(){return["geometry to transfer attributes to","geometry to transfer attributes from"]},t.prototype.initialize_node=function(){this.io.inputs.set_count(2),this.io.inputs.init_inputs_clonable_state([u.InputCloneMode.FROM_NODE,u.InputCloneMode.NEVER])},t.prototype.cook=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t;return r.__generator(this,(function(n){switch(n.label){case 0:return this._core_group_dest=e[0],t=this._core_group_dest.points_from_group(this.pv.dest_group),this._core_group_src=e[1],this._attrib_names=this._core_group_src.attrib_names_matching_mask(this.pv.name),this._error_if_attribute_not_found_on_second_input(),this._build_octree_if_required(this._core_group_src),this._add_attribute_if_required(),[4,this._transfer_attributes(t)];case 1:return n.sent(),this.set_core_group(this._core_group_dest),[2]}}))}))},t.prototype._error_if_attribute_not_found_on_second_input=function(){for(var e=0,t=this._attrib_names;e<t.length;e++){var n=t[e];this._core_group_src.has_attrib(n)||this.states.error.set("attribute '"+n+"' not found on second input")}},t.prototype._build_octree_if_required=function(e){var t=null==this._octree_timestamp||this._octree_timestamp!==e.timestamp();if(this._prev_param_src_group!==this.pv.src_group||t){this._octree_timestamp=e.timestamp(),this._prev_param_src_group=this.pv.src_group;var n=this._core_group_src.points_from_group(this.pv.src_group);this._octree=new s.CoreOctree(this._core_group_src.bounding_box()),this._octree.set_points(n)}},t.prototype._add_attribute_if_required=function(){var e=this;this._attrib_names.forEach((function(t){if(!e._core_group_dest.has_attrib(t)){var n=e._core_group_src.attrib_size(t);e._core_group_dest.add_numeric_vertex_attrib(t,n,0)}}))},t.prototype._transfer_attributes=function(e){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(t){switch(t.label){case 0:return[4,(new a.CoreIterator).start_with_array(e,this._transfer_attributes_for_point.bind(this))];case 1:return t.sent(),[2]}}))}))},t.prototype._transfer_attributes_for_point=function(e){for(var t,n=this.pv.distance_threshold+this.pv.blend_width,r=(null===(t=this._octree)||void 0===t?void 0:t.find_points(e.position(),n,this.pv.max_samples_count))||[],o=0,i=this._attrib_names;o<i.length;o++){var s=i[o];this._interpolate_points(e,r,s)}},t.prototype._interpolate_points=function(e,t,n){var r;null!=(r=i.CoreInterpolate.perform(e,t,n,this.pv.distance_threshold,this.pv.blend_width))&&e.set_attrib_value(n,r)},t}(o.TypedSopNode);t.AttribTransferSopNode=p},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=r.__importDefault(n(150)),i=r.__importDefault(n(148)),s=function(){function e(){}return e.perform=function(e,t,n,r,o){switch(t.length){case 0:return 0;case 1:return this._interpolate_with_1_point(e,t[0],n,r,o);default:return this._interpolate_with_multiple_points(e,t,n,r,o)}},e._interpolate_with_1_point=function(e,t,n,r,o){var i=e.position(),s=t.position(),a=i.distanceTo(s),_=t.attrib_value(n);return this._weighted_value_from_distance(e,_,n,a,r,o)},e._weight_from_distance=function(e,t,n){return(e-t)/n},e._weighted_value_from_distance=function(e,t,n,r,o,i){if(r<=o)return t;var s=e.attrib_value(n),a=this._weight_from_distance(r,o,i);return a*s+(1-a)*t},e._interpolate_with_multiple_points=function(e,t,n,r,i){var s=this,a=t.map((function(t){return s._interpolate_with_1_point(e,t,n,r,i)}));return o.default(a)||0},e.weights=function(e,t){switch(t.length){case 1:return 1;case 2:return this._weights_from_2(e,t);default:return t=t.slice(0,3),this._weights_from_3(e,t)}},e._weights_from_2=function(e,t){var n=t.map((function(t){return e.distanceTo(t)})),r=i.default(n);return[n[1]/r,n[0]/r]},e._weights_from_3=function(e,t){var n=t.map((function(t){return e.distanceTo(t)})),r=i.default([n[0]*n[1],n[0]*n[2],n[1]*n[2]]);return[n[1]*n[2]/r,n[0]*n[2]/r,n[0]*n[1]/r]},e}();t.CoreInterpolate=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=n(33),i=r.__importDefault(n(93)),s=n(622),a=function(){function e(e){this._root=new s.OctreeNode(e)}return e.prototype.set_points=function(e){this._root.set_points(e)},e.prototype.traverse=function(e){this._root.traverse(e)},e.prototype.find_points=function(e,t,n){var r=new o.Sphere(e,t),s=[];return this._root.intersects_sphere(r)&&this._root.points_in_sphere(r,s),null==n?s:(s.length>n&&(s=(s=i.default(s,(function(t){return t.position().distanceTo(e)}))).slice(0,n)),s)},e}();t.CoreOctree=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=n(44),i=r.__importDefault(n(74)),s=function(){function e(e,t){void 0===t&&(t=0),this._bbox=e,this._level=t,this._leaves_by_octant={},this._points_by_octant_id={},this._leaves=[],this._bounding_boxes_by_octant={},this._bounding_boxes_by_octant_prepared=!1,this._center=this._bbox.max.clone().add(this._bbox.min).multiplyScalar(.5)}return e.prototype.level=function(){return this._level},e.prototype.traverse=function(e){e(this),Object.values(this._leaves_by_octant).forEach((function(t){t.traverse(e)}))},e.prototype.intersects_sphere=function(e){return!!this._bbox&&this._bbox.intersectsSphere(e)},e.prototype.points_in_sphere=function(e,t){0==this._leaves.length?i.default(Object.values(this._points_by_octant_id)).filter((function(t){return e.containsPoint(t.position())})).forEach((function(e){t.push(e)})):this._leaves.filter((function(t){return t.intersects_sphere(e)})).forEach((function(n){return n.points_in_sphere(e,t)}))},e.prototype.bounding_box=function(){return this._bbox},e.prototype.set_points=function(e){var t=this;this._points_by_octant_id={};for(var n=0,r=e;n<r.length;n++){var o=r[n];this.add_point(o)}var i=Object.keys(this._points_by_octant_id);i.length>1&&i.forEach((function(e){t.create_leaf(e)}))},e.prototype.create_leaf=function(t){var n=new e(this._leaf_bbox(t),this._level+1);this._leaves_by_octant[t]=n,this._leaves.push(n),n.set_points(this._points_by_octant_id[t])},e.prototype.add_point=function(e){var t=this._octant_id(e.position());null==this._points_by_octant_id[t]&&(this._points_by_octant_id[t]=[]),this._points_by_octant_id[t].push(e)},e.prototype._octant_id=function(e){return""+(e.x>this._center.x?1:0)+(e.y>this._center.y?1:0)+(e.z>this._center.z?1:0)},e.prototype._leaf_bbox=function(e){return this._bounding_boxes_by_octant_prepared||(this._prepare_leaves_bboxes(),this._bounding_boxes_by_octant_prepared=!0),this._bounding_boxes_by_octant[e]},e.prototype._bbox_center=function(e,t,n){var r=this._bbox.min.clone();return e&&(r.x=this._bbox.max.x),t&&(r.y=this._bbox.max.y),n&&(r.z=this._bbox.max.z),r.clone().add(this._center).multiplyScalar(.5)},e.prototype._prepare_leaves_bboxes=function(){var e=[];e.push(this._bbox_center(0,0,0)),e.push(this._bbox_center(0,0,1)),e.push(this._bbox_center(0,1,0)),e.push(this._bbox_center(0,1,1)),e.push(this._bbox_center(1,0,0)),e.push(this._bbox_center(1,0,1)),e.push(this._bbox_center(1,1,0)),e.push(this._bbox_center(1,1,1));for(var t=this._bbox.max.clone().sub(this._bbox.min).multiplyScalar(.25),n=0,r=e;n<r.length;n++){var i=r[n],s=this._octant_id(i),a=new o.Box3(i.clone().sub(t),i.clone().add(t));this._bounding_boxes_by_octant[s]=a}},e}();t.OctreeNode=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=n(5),i=n(4),s=r.__importDefault(n(82)),a=n(14),_=n(26),u=n(9),c=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.step_size=u.ParamConfig.FLOAT(.1),t}return r.__extends(t,e),t}(u.NodeParamsConfig)),p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=c,t}return r.__extends(t,e),t.type=function(){return"bbox_scatter"},t.displayed_input_names=function(){return["geometry to create points from"]},t.prototype.initialize_node=function(){this.io.inputs.set_count(1)},t.prototype.cook=function(e){var t=e[0],n=this.pv.step_size,r=t.bounding_box(),a={x:s.default(r.min.x,r.max.x,n),y:s.default(r.min.y,r.max.y,n),z:s.default(r.min.z,r.max.z,n)},u=[];a.x.forEach((function(e){a.y.forEach((function(t){a.z.forEach((function(n){u.push(e),u.push(t),u.push(n)}))}))}));var c=new o.BufferGeometry;c.setAttribute("position",new i.BufferAttribute(new Float32Array(u),3)),this.set_geometry(c,_.CoreConstant.OBJECT_TYPE.POINTS)},t}(a.TypedSopNode);t.BboxScatterSopNode=p},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=n(14),i=n(9),s=n(19),a=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.attrib_name=i.ParamConfig.STRING(),t.blend=i.ParamConfig.FLOAT(.5,{range:[0,1],range_locked:[!0,!0]}),t}return r.__extends(t,e),t}(i.NodeParamsConfig)),_=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=a,t}return r.__extends(t,e),t.type=function(){return"blend"},t.displayed_input_names=function(){return["geometry to blend from","geometry to blend to"]},t.prototype.initialize_node=function(){this.io.inputs.set_count(2),this.io.inputs.init_inputs_clonable_state([s.InputCloneMode.FROM_NODE,s.InputCloneMode.NEVER])},t.prototype.cook=function(e){for(var t,n,r=e[0],o=e[1],i=r.objects(),s=o.objects(),a=0;a<i.length;a++)t=i[a],n=s[a],this.blend(t,n,this.pv.blend);this.set_core_group(r)},t.prototype.blend=function(e,t,n){var r=e.geometry,o=t.geometry;if(null!=r&&null!=o){var i=r.getAttribute(this.pv.attrib_name),s=o.getAttribute(this.pv.attrib_name);if(null!=i&&null!=s){for(var a,_,u=i.array,c=s.array,p=0;p<u.length;p++)a=u[p],null!=(_=c[p])&&(u[p]=(1-n)*a+n*_);r.computeVertexNormals()}}},t}(o.TypedSopNode);t.BlendSopNode=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=n(14),i=n(65),s=n(105),a=n(19),_=n(9),u=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.size=_.ParamConfig.FLOAT(1),t.divisions=_.ParamConfig.FLOAT(1,{range:[1,10],range_locked:[!0,!1]}),t.center=_.ParamConfig.VECTOR3([0,0,0]),t}return r.__extends(t,e),t}(_.NodeParamsConfig)),c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=u,t._core_transform=new i.CoreTransform,t}return r.__extends(t,e),t.type=function(){return"box"},t.displayed_input_names=function(){return["geometry to create bounding box from (optional)"]},t.prototype.initialize_node=function(){this.io.inputs.set_count_to_one_max(),this.io.inputs.init_inputs_clonable_state([a.InputCloneMode.NEVER])},t.prototype.cook=function(e){var t=e[0];t?this._cook_with_input(t):this._cook_without_input()},t.prototype._cook_without_input=function(){var e=this.pv.divisions,t=this.pv.size,n=new s.BoxBufferGeometry(t,t,t,e,e,e);n.translate(this.pv.center.x,this.pv.center.y,this.pv.center.z),n.computeVertexNormals(),this.set_geometry(n)},t.prototype._cook_with_input=function(e){var t=this.pv.divisions,n=e.bounding_box(),r=n.max.clone().sub(n.min),o=n.max.clone().add(n.min).multiplyScalar(.5),i=new s.BoxBufferGeometry(r.x,r.y,r.z,t,t,t),a=this._core_transform.translation_matrix(o);i.applyMatrix(a),this.set_geometry(i)},t}(o.TypedSopNode);t.BoxSopNode=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=n(330),i=n(14),s=n(9),a=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.cache=s.ParamConfig.STRING("",{hidden:!0}),t.reset=s.ParamConfig.BUTTON(null,{callback:function(e,t){_.PARAM_CALLBACK_reset(e,t)}}),t}return r.__extends(t,e),t}(s.NodeParamsConfig)),_=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=a,t}return r.__extends(t,e),t.type=function(){return"cache"},t.displayed_input_names=function(){return["geometry to cache"]},t.prototype.initialize_node=function(){this.io.inputs.set_count(0,1)},t.prototype.cook=function(e){var t=""==this.pv.cache||null==this.pv.cache,n=e[0];if(t&&n){for(var r=[],i=0,s=n.objects();i<s.length;i++){var a=s[i];r.push(a.toJSON())}this.set_core_group(n),this.p.cache.set(JSON.stringify(r))}else if(this.pv.cache){for(var _=new o.ObjectLoader,u=[],c=0,p=JSON.parse(this.pv.cache);c<p.length;c++){r=p[c];var l=_.parse(r);u.push(l)}this.set_objects(u)}else this.set_objects([])},t.PARAM_CALLBACK_reset=function(e,t){e.param_callback_PARAM_CALLBACK_reset()},t.prototype.param_callback_PARAM_CALLBACK_reset=function(){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(e){return this.p.cache.set(""),this.request_container(),[2]}))}))},t}(i.TypedSopNode);t.CacheSopNode=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=n(1),i=n(157),s=n(14),a=n(299),_=n(26),u=n(65),c=new o.Vector3(0,0,1),p=n(9),l=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.radius=p.ParamConfig.FLOAT(1),t.segments=p.ParamConfig.INTEGER(12,{range:[1,50],range_locked:[!0,!1]}),t.open=p.ParamConfig.BOOLEAN(1),t.arc_angle=p.ParamConfig.FLOAT(360,{range:[0,360],range_locked:[!1,!1],visible_if:{open:1}}),t.direction=p.ParamConfig.VECTOR3([0,1,0]),t}return r.__extends(t,e),t}(p.NodeParamsConfig)),d=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=l,t._core_transform=new u.CoreTransform,t}return r.__extends(t,e),t.type=function(){return"circle"},t.prototype.initialize_node=function(){},t.prototype.cook=function(){this.pv.open?this._create_circle():this._create_disk()},t.prototype._create_circle=function(){var e=a.CoreGeometryUtilCircle.create(this.pv.radius,this.pv.segments,this.pv.arc_angle);this._core_transform.rotate_geometry(e,c,this.pv.direction),this.set_geometry(e,_.ObjectType.LINE_SEGMENTS)},t.prototype._create_disk=function(){var e=new i.CircleBufferGeometry(this.pv.radius,this.pv.segments);this._core_transform.rotate_geometry(e,c,this.pv.direction),this.set_geometry(e)},t}(s.TypedSopNode);t.CircleSopNode=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=n(6),i=n(629),s=n(14),a=n(19),_=new o.Color(1,1,1),u=n(9),c=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.from_attribute=u.ParamConfig.BOOLEAN(0),t.attrib_name=u.ParamConfig.STRING("",{visible_if:{from_attribute:1}}),t.color=u.ParamConfig.COLOR([1,1,1],{visible_if:{from_attribute:0},expression:{for_entities:!0}}),t.as_hsv=u.ParamConfig.BOOLEAN(0,{visible_if:{from_attribute:0}}),t}return r.__extends(t,e),t}(u.NodeParamsConfig)),p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=c,t._r_arrays_by_geometry_uuid={},t._g_arrays_by_geometry_uuid={},t._b_arrays_by_geometry_uuid={},t}return r.__extends(t,e),t.type=function(){return"color"},t.displayed_input_names=function(){return["geometry to update color of"]},t.prototype.initialize_node=function(){this.io.inputs.set_count(1),this.io.inputs.init_inputs_clonable_state([a.InputCloneMode.FROM_NODE]),this.ui_data.set_icon("palette")},t.prototype.cook=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,n,o,i,s,a,_,u;return r.__generator(this,(function(r){switch(r.label){case 0:t=e[0],n=t.core_objects(),o=0,i=n,r.label=1;case 1:return o<i.length?(s=i[o],this.pv.from_attribute?(this._set_from_attribute(s),[3,5]):[3,2]):[3,6];case 2:return this.p.color.has_expression()?[4,this._eval_expressions(s)]:[3,4];case 3:return r.sent(),[3,5];case 4:this._eval_simple_values(s),r.label=5;case 5:return o++,[3,1];case 6:if(!this.io.inputs.input_cloned(0))for(a=t.geometries(),_=0,u=a;_<u.length;_++)u[_].getAttribute("color").needsUpdate=!0;return this.set_core_group(t),[2]}}))}))},t.prototype._set_from_attribute=function(e){var t=e.core_geometry();this._create_init_color(t,_);var n=t.points(),r=t.attrib_size(this.pv.attrib_name),o=t.geometry(),i=o.getAttribute(this.pv.attrib_name).array,s=o.getAttribute("color").array;switch(r){case 1:for(var a=0;a<n.length;a++){s[(c=3*a)+0]=i[a],s[c+1]=1-i[a],s[c+2]=0}break;case 2:for(a=0;a<n.length;a++){var u=2*a;s[(c=3*a)+0]=i[u+0],s[c+1]=i[u+1],s[c+2]=0}break;case 3:for(a=0;a<i.length;a++)s[a]=i[a];break;case 4:for(a=0;a<n.length;a++){var c;u=4*a;s[(c=3*a)+0]=i[u+0],s[c+1]=i[u+1],s[c+2]=i[u+2]}}},t.prototype._create_init_color=function(e,t){e.has_attrib("color")||e.add_numeric_attrib("color",3,_)},t.prototype._eval_simple_values=function(e){var t,n=e.core_geometry();this._create_init_color(n,_),this.pv.as_hsv?(t=new o.Color,i.CoreColor.set_hsv(this.pv.color.r,this.pv.color.g,this.pv.color.b,t)):t=this.pv.color,n.add_numeric_attrib("color",3,t)},t.prototype._eval_expressions=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,n,s,a,u,c,p,l,d,h,f,m,y,v;return r.__generator(this,(function(r){switch(r.label){case 0:return t=e.points(),n=e.object(),s=e.core_geometry(),this._create_init_color(s,_),(a=n.geometry)?(u=a.getAttribute("color").array,[4,this._update_from_param(a,u,t,0)]):[3,4];case 1:return c=r.sent(),[4,this._update_from_param(a,u,t,1)];case 2:return p=r.sent(),[4,this._update_from_param(a,u,t,2)];case 3:if(l=r.sent(),c&&this._commit_tmp_values(c,u,0),p&&this._commit_tmp_values(p,u,1),l&&this._commit_tmp_values(l,u,2),this.pv.as_hsv)for(d=new o.Color,h=new o.Color,f=void 0,m=0,y=t;m<y.length;m++)v=y[m],f=3*v.index,d.fromArray(u,f),i.CoreColor.set_hsv(d.r,d.g,d.b,h),h.toArray(u,f);r.label=4;case 4:return[2]}}))}))},t.prototype._update_from_param=function(e,t,n,o){return r.__awaiter(this,void 0,void 0,(function(){var i,s,a,_,u,c,p;return r.__generator(this,(function(r){switch(r.label){case 0:return i=this.p.color.components[o],s=[this.pv.color.r,this.pv.color.g,this.pv.color.b][o],a=[this._r_arrays_by_geometry_uuid,this._g_arrays_by_geometry_uuid,this._b_arrays_by_geometry_uuid][o],i.has_expression()&&i.expression_controller?(_=this._init_array_if_required(e,a,n.length),[4,i.expression_controller.compute_expression_for_points(n,(function(e,t){_[e.index]=t}))]):[3,2];case 1:return r.sent(),[3,3];case 2:for(u=0,c=n;u<c.length;u++)p=c[u],t[3*p.index+o]=s;r.label=3;case 3:return[2,_]}}))}))},t.prototype._init_array_if_required=function(e,t,n){var r=e.uuid,o=t[r];return o?o.length<n&&(t[r]=new Array(n)):t[r]=new Array(n),t[r]},t.prototype._commit_tmp_values=function(e,t,n){for(var r=0;r<e.length;r++)t[3*r+n]=e[r]},t}(s.TypedSopNode);t.ColorSopNode=p},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(13),o=function(){function e(){}return e.set_hsv=function(e,t,n,o){e=r._Math.euclideanModulo(e,1),t=r._Math.clamp(t,0,1),n=r._Math.clamp(n,0,1),o.setHSL(e,t*n/((e=(2-t)*n)<1?e:2-e),.5*e)},e}();t.CoreColor=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=r.__importDefault(n(91)),i=n(14),s=n(214),a=n(631),_=n(49),u=n(632),c=n(9),p=n(19),l=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.count=c.ParamConfig.INTEGER(1,{range:[1,20],range_locked:[!0,!1]}),t.transform_only=c.ParamConfig.BOOLEAN(0),t.copy_attributes=c.ParamConfig.BOOLEAN(0),t.attributes_to_copy=c.ParamConfig.STRING("",{visible_if:{copy_attributes:!0}}),t.use_copy_expr=c.ParamConfig.BOOLEAN(0),t}return r.__extends(t,e),t}(c.NodeParamsConfig)),d=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=l,t._attribute_names_to_copy=[],t._objects=[],t}return r.__extends(t,e),t.type=function(){return"copy"},t.displayed_input_names=function(){return["geometry to be copied","points to copy to"]},t.prototype.initialize_node=function(){this.io.inputs.set_count(1,2),this.io.inputs.init_inputs_clonable_state([p.InputCloneMode.ALWAYS,p.InputCloneMode.NEVER])},t.prototype.cook=function(){return r.__awaiter(this,void 0,void 0,(function(){var e,t,n,o;return r.__generator(this,(function(r){switch(r.label){case 0:return[4,this.container_controller.request_input_container(0)];case 1:return null==(t=r.sent())||null==(e=t.core_content())?[3,8]:this.io.inputs.has_input(1)?(n=void 0,[4,this.container_controller.request_input_container(1)]):[3,6];case 2:return null==(o=r.sent())||null==(n=o.core_content())?[3,4]:[4,this.cook_with_template(e,n)];case 3:return r.sent(),[3,5];case 4:this.states.error.set("second input required"),r.label=5;case 5:return[3,7];case 6:this.cook_without_template(e),r.label=7;case 7:return[3,9];case 8:this.states.error.set("first input required"),r.label=9;case 9:return[2]}}))}))},t.prototype.cook_with_template=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var n,o,i;return r.__generator(this,(function(r){switch(r.label){case 0:return this._objects=[],n=t.points(),o=new a.CoreInstancer(t),i=o.matrices(),this._attribute_names_to_copy=_.CoreString.attrib_names(this.pv.attributes_to_copy).filter((function(e){return t.has_attrib(e)})),[4,this._copy_moved_objects_on_template_points(e,i,n)];case 1:return r.sent(),this.set_objects(this._objects),[2]}}))}))},t.prototype._copy_moved_objects_on_template_points=function(e,t,n){return r.__awaiter(this,void 0,void 0,(function(){var o;return r.__generator(this,(function(r){switch(r.label){case 0:o=0,r.label=1;case 1:return o<n.length?[4,this._copy_moved_object_on_template_point(e,t,n,o)]:[3,4];case 2:r.sent(),r.label=3;case 3:return o++,[3,1];case 4:return[2]}}))}))},t.prototype._copy_moved_object_on_template_point=function(e,t,n,o){var i=this;return new Promise((function(s,a){return r.__awaiter(i,void 0,void 0,(function(){var i,a,_=this;return r.__generator(this,(function(r){switch(r.label){case 0:return i=t[o],a=n[o],this.stamp_node.set_point(a),[4,this._get_moved_objects_for_template_point(e,o)];case 1:return r.sent().forEach((function(e){return _.pv.copy_attributes&&_._copy_attributes_from_template(e,a),_.pv.transform_only?e.applyMatrix(i):e.geometry.applyMatrix(i),_._objects.push(e)})),[2,s()]}}))}))}))},t.prototype._get_moved_objects_for_template_point=function(e,t){var n=this;return new Promise((function(i,s){return r.__awaiter(n,void 0,void 0,(function(){var n;return r.__generator(this,(function(r){switch(r.label){case 0:return[4,this._stamp_instance_group_if_required(e)];case 1:return r.sent()?(n=this.pv.transform_only?o.default([e.objects()[t]]):e.clone().objects(),i(n)):i([]),[2]}}))}))}))},t.prototype._stamp_instance_group_if_required=function(e){var t=this;return new Promise((function(n,o){return r.__awaiter(t,void 0,void 0,(function(){var t,o;return r.__generator(this,(function(r){switch(r.label){case 0:return this.pv.use_copy_expr?[4,this.container_controller.request_input_container(0)]:[3,2];case 1:return t=r.sent(),o=void 0,t&&null!=(o=t.core_content())?n(o):(this.states.error.set("input failed for index "+this.stamp_value()),n()),[3,3];case 2:n(e),r.label=3;case 3:return[2]}}))}))}))},t.prototype._copy_moved_objects_for_each_instance=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t;return r.__generator(this,(function(n){switch(n.label){case 0:t=0,n.label=1;case 1:return t<this.pv.count?[4,this._copy_moved_objects_for_instance(e,t)]:[3,4];case 2:n.sent(),n.label=3;case 3:return t++,[3,1];case 4:return[2]}}))}))},t.prototype._copy_moved_objects_for_instance=function(e,t){var n=this;return new Promise((function(o,i){return r.__awaiter(n,void 0,void 0,(function(){var n,i=this;return r.__generator(this,(function(r){switch(r.label){case 0:return this.stamp_node.set_global_index(t),[4,this._stamp_instance_group_if_required(e)];case 1:return(n=r.sent())&&n.objects().forEach((function(e){var t=s.CoreObject.clone(e);i._objects.push(t)})),o(),[2]}}))}))}))},t.prototype.cook_without_template=function(e){var t=this;this._objects=[],this._copy_moved_objects_for_each_instance(e).then((function(){t.set_objects(t._objects)}))},t.prototype._copy_attributes_from_template=function(e,t){this._attribute_names_to_copy.forEach((function(n,r){var o=t.attrib_value(n);new s.CoreObject(e,r).add_attribute(n,o)}))},t.prototype.stamp_value=function(e){return this.stamp_node.value(e)},Object.defineProperty(t.prototype,"stamp_node",{get:function(){return this._stamp_node=this._stamp_node||this.create_stamp_node()},enumerable:!0,configurable:!0}),t.prototype.create_stamp_node=function(){var e=new u.CopyStamp(this.scene);return this.dirty_controller.set_forbidden_trigger_nodes([e]),e},t}(i.TypedSopNode);t.CopySopNode=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3).__importDefault(n(41)),o=n(1),i=n(2),s=n(31),a=n(15),_=n(229),u=n(230),c=n(43),p={SCALE:new o.Vector3(1,1,1),PSCALE:1,EYE:new o.Vector3(0,0,0),UP:new o.Vector3(0,1,0)},l=new o.Vector3(1,1,1),d=new i.Vector2(0,0),h=function(){function e(e){this._group_wrapper=e,this._matrices={},this._is_pscale_present=this._group_wrapper.has_attrib("pscale"),this._is_scale_present=this._group_wrapper.has_attrib("scale"),this._is_normal_present=this._group_wrapper.has_attrib("normal"),this._is_up_present=this._group_wrapper.has_attrib("up"),this._do_rotate_matrices=this._is_normal_present}return e.prototype.matrices=function(){var e=this;return this._matrices={},this._matrices.translate=new a.Matrix4,this._matrices.rotate=new a.Matrix4,this._matrices.scale=new a.Matrix4,this._group_wrapper.points().map((function(t){return e._matrix_from_point(t)}))},e.prototype._matrix_from_point=function(e){var t=e.position(),n=this._is_scale_present?e.attrib_value("scale"):p.SCALE,r=this._is_pscale_present?e.attrib_value("pscale"):p.PSCALE;n=n.clone().multiplyScalar(r);var o=new a.Matrix4;o.identity();var i=this._matrices.scale;i.makeScale(n.x,n.y,n.z);var s=this._matrices.translate;if(s.makeTranslation(t.x,t.y,t.z),o.multiply(s),this._do_rotate_matrices){var _=this._matrices.rotate,u=p.EYE,c=e.attrib_value("normal").multiplyScalar(-1),l=this._is_up_present?e.attrib_value("up"):p.UP;l.normalize(),_.lookAt(u,c,l),o.multiply(_)}return o.multiply(i),o},e.create_instance_buffer_geo=function(t,n,i){var a=n.points(),p=new _.InstancedBufferGeometry;p.copy(t);var h=a.length,f=new Float32Array(3*h),m=new Float32Array(3*h),y=new Float32Array(3*h),v=new Float32Array(4*h),g=n.has_attrib("color"),b=new o.Vector3(0,0,0),O=new s.Quaternion,P=new o.Vector3(1,1,1),w=new e(n).matrices();a.forEach((function(e,t){var n=3*t,r=4*t;w[t].decompose(b,O,P),b.toArray(f,n),O.toArray(v,r),P.toArray(y,n),(g?e.attrib_value("color"):l).toArray(m,n)}));var x=n.has_attrib("uv");if(x){var C=new Float32Array(2*h);a.forEach((function(e,t){var n=2*t;(x?e.attrib_value("uv"):d).toArray(C,n)})),p.setAttribute("instanceUv",new u.InstancedBufferAttribute(C,2))}return p.setAttribute("instancePosition",new u.InstancedBufferAttribute(f,3)),p.setAttribute("instanceScale",new u.InstancedBufferAttribute(y,3)),p.setAttribute("instanceOrientation",new u.InstancedBufferAttribute(v,4)),p.setAttribute("instanceColor",new u.InstancedBufferAttribute(m,3)),n.attrib_names_matching_mask(i).forEach((function(e){var t=n.attrib_size(e),o=new Float32Array(h*t);a.forEach((function(n,i){var s=n.attrib_value(e);r.default(s)?o[i]=s:s.toArray(o,i*t)})),p.setAttribute(e,new u.InstancedBufferAttribute(o,t))})),new c.CoreGeometry(p).mark_as_instance(),p},e}();t.CoreInstancer=h},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=function(e){function t(t){var n=e.call(this,t,"CopyStamp")||this;return n._global_index=0,n}return r.__extends(t,e),t.prototype.set_point=function(e){this._point=e,this.set_dirty(),this.remove_dirty_state()},t.prototype.set_global_index=function(e){this._global_index=e,this.set_dirty(),this.remove_dirty_state()},t.prototype.value=function(e){return this._point?e?this._point.attrib_value(e):this._point.index:this._global_index},t}(n(55).CoreGraphNode);t.CopyStamp=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=n(14),i=n(300),s=JSON.stringify([{value:-40},{value:-30},{value:-20},{value:-10},{value:0},{value:10},{value:20},{value:30},{value:40},{value:50},{value:60},{value:70},{value:80}]),a=n(9),_=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.data=a.ParamConfig.STRING(s),t}return r.__extends(t,e),t}(a.NodeParamsConfig)),u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=_,t}return r.__extends(t,e),t.type=function(){return"data"},t.prototype.cook=function(){var e=null;try{e=JSON.parse(this.pv.data)}catch(e){this.states.error.set("could not parse json")}if(e){var t=new i.JsonDataLoader;t.set_json(e);var n=t.create_object();this.set_object(n)}else this.cook_controller.end_cook()},t}(o.TypedSopNode);t.DataSopNode=u},,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=r.__importDefault(n(21)),i=r.__importDefault(n(45)),s=n(26),a=function(){function e(e,t){this._size=e,this._type=t}return e.prototype.size=function(){return this._size},e.prototype.type=function(){return this._type},e.from_value=function(e){var t=i.default(e)?s.CoreConstant.ATTRIB_TYPE.STRING:s.CoreConstant.ATTRIB_TYPE.NUMERIC;return new this(o.default(e)?e.length:1,t)},e}();t.CoreAttributeData=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=n(14),i=n(300),s=n(9),a=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.url=s.ParamConfig.STRING("/examples/sop/data_url/basic.json"),t.json_data_keys_prefix=s.ParamConfig.STRING(""),t.skip_entries=s.ParamConfig.STRING(""),t.convert=s.ParamConfig.BOOLEAN(0),t.convert_to_numeric=s.ParamConfig.STRING("",{visible_if:{convert:1}}),t.reload=s.ParamConfig.BUTTON(null,{callback:function(e,t){_.PARAM_CALLBACK_reload(e,t)}}),t}return r.__extends(t,e),t}(s.NodeParamsConfig)),_=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=a,t}return r.__extends(t,e),t.type=function(){return"data_url"},t.prototype.cook=function(){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(e){return new i.JsonDataLoader({data_keys_prefix:this.pv.json_data_keys_prefix,skip_entries:this.pv.skip_entries,do_convert:this.pv.convert,convert_to_numeric:this.pv.convert_to_numeric}).load(this.pv.url,this._on_load.bind(this),void 0,this._on_error.bind(this)),[2]}))}))},t.prototype._on_load=function(e){this.set_objects([e])},t.prototype._on_error=function(e){this.states.error.set("could not load geometry from "+this.pv.url+" ("+e+")"),this.cook_controller.end_cook()},t.PARAM_CALLBACK_reload=function(e,t){e.param_callback_reload()},t.prototype.param_callback_reload=function(){this.p.url.set_dirty()},t}(o.TypedSopNode);t.DataUrlSopNode=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=n(14),i=n(9),s=n(19),a=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.duration=i.ParamConfig.INTEGER(1e3),t}return r.__extends(t,e),t}(i.NodeParamsConfig)),_=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=a,t}return r.__extends(t,e),t.type=function(){return"delay"},t.prototype.initialize_node=function(){this.io.inputs.set_count(1),this.io.inputs.init_inputs_clonable_state([s.InputCloneMode.ALWAYS])},t.prototype.cook=function(e){var t=this,n=e[0];setTimeout((function(){t.set_core_group(n)}),this.pv.duration)},t}(o.TypedSopNode);t.DelaySopNode=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,o=n(3),i=n(44),s=o.__importDefault(n(45)),a=o.__importDefault(n(135)),_=n(14),u=n(49),c=n(26),p=n(43),l=n(19);!function(e){e[e["=="]=0]="==",e[e["<"]=1]="<",e[e["<="]=2]="<=",e[e[">="]=3]=">=",e[e[">"]=4]=">",e[e["!="]=5]="!="}(r||(r={}));var d=[{name:"==",value:r["=="]},{name:"<",value:r["<"]},{name:"<=",value:r["<="]},{name:">=",value:r[">="]},{name:">",value:r[">"]},{name:"!=",value:r["!="]}],h=n(9),f=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.class=h.ParamConfig.INTEGER(c.AttribClass.VERTEX,{menu:{entries:c.AttribClassMenuEntries}}),t.invert=h.ParamConfig.BOOLEAN(0),t.hide_objects=h.ParamConfig.BOOLEAN(0),t.by_object_type=h.ParamConfig.BOOLEAN(0),t.object_type=h.ParamConfig.INTEGER(c.ObjectTypes.indexOf(c.ObjectType.MESH),{menu:{entries:c.ObjectTypeMenuEntries},visible_if:{by_object_type:!0}}),t.by_expression=h.ParamConfig.BOOLEAN(0),t.expression=h.ParamConfig.BOOLEAN("@ptnum==0",{visible_if:{by_expression:!0},expression:{for_entities:!0}}),t.by_attrib=h.ParamConfig.BOOLEAN(0),t.attrib_name=h.ParamConfig.STRING("",{visible_if:{by_attrib:!0}}),t.attrib_string=h.ParamConfig.STRING("",{visible_if:{by_attrib:!0}}),t.attrib_numeric=h.ParamConfig.VECTOR4([0,0,0,0],{visible_if:{by_attrib:!0}}),t.attrib_comparison_operator=h.ParamConfig.INTEGER(r["=="],{menu:{entries:d},visible_if:{by_attrib:!0}}),t.by_bbox=h.ParamConfig.BOOLEAN(0),t.bbox_size=h.ParamConfig.VECTOR3([1,1,1],{visible_if:{by_bbox:!0}}),t.bbox_center=h.ParamConfig.VECTOR3([0,0,0],{visible_if:{by_bbox:!0}}),t.by_visible=h.ParamConfig.BOOLEAN(0),t.keep_points=h.ParamConfig.BOOLEAN(1,{visible_if:{class:c.AttribClass.OBJECT}}),t}return o.__extends(t,e),t}(h.NodeParamsConfig)),m=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=f,t._marked_for_deletion_per_object_index=new Map,t}return o.__extends(t,e),t.type=function(){return"delete"},t.displayed_input_names=function(){return["geometry to delete from"]},t.prototype.initialize_node=function(){this.io.inputs.set_count(1),this.io.inputs.init_inputs_clonable_state([l.InputCloneMode.FROM_NODE])},t.prototype.cook=function(e){return o.__awaiter(this,void 0,void 0,(function(){var t;return o.__generator(this,(function(n){switch(n.label){case 0:switch(t=e[0],this._bbox_cache=void 0,this.pv.class){case c.AttribClass.VERTEX:return[3,1];case c.AttribClass.OBJECT:return[3,3]}return[3,5];case 1:return[4,this._eval_for_points(t)];case 2:return n.sent(),[3,5];case 3:return[4,this._eval_for_objects(t)];case 4:return n.sent(),[3,5];case 5:return[2]}}))}))},t.prototype._eval_for_objects=function(e){return o.__awaiter(this,void 0,void 0,(function(){var t,n,r,i,s,a,_,u,c,p,l,d=this;return o.__generator(this,(function(o){switch(o.label){case 0:for(t=[],n=e.core_objects(),this._marked_for_deletion_per_object_index=new Map,r=0,i=n;r<i.length;r++)s=i[r],this._marked_for_deletion_per_object_index.set(s.index,!1);return this.pv.by_expression?[4,this._eval_expressions_for_objects(n)]:[3,2];case 1:o.sent(),o.label=2;case 2:for(this.pv.by_object_type&&this._eval_type_for_objects(n),this.pv.by_attrib&&""!==this.pv.attrib_name&&this._eval_attrib_for_objects(n),this.pv.invert&&this._marked_for_deletion_per_object_index.forEach((function(e,t){d._marked_for_deletion_per_object_index.set(t,!e)})),u=[],this._marked_for_deletion_per_object_index.forEach((function(e,r){a=n[r],_=a.object(),d.pv.hide_objects?(t.push(_),e&&(_.visible=!1)):(e||t.push(_),e&&u.push(d._point_object(a)))})),c=0,p=u;c<p.length;c++)l=p[c],t.push(l);return this.set_objects(t),[2]}}))}))},t.prototype._eval_for_points=function(e){return o.__awaiter(this,void 0,void 0,(function(){var t,n,r,i,s,a,_;return o.__generator(this,(function(o){switch(o.label){case 0:t=e.core_objects(),r=0,o.label=1;case 1:return r<t.length?(n=t[r],(i=n.core_geometry())?(s=i.points_from_geometry(),a=s.length,this.pv.by_expression?[4,this._eval_expressions_for_points(s)]:[3,3]):[3,4]):[3,5];case 2:s=o.sent(),o.label=3;case 3:this.pv.by_attrib&&""!==this.pv.attrib_name&&(s=this._eval_attrib_for_points(s)),this.pv.by_bbox&&(s=this._eval_bbox_for_points(s)),s.length!=a&&(_=n.object(),i.geometry().dispose(),s.length>0?_.geometry=p.CoreGeometry.geometry_from_points(s,_.constructor):null!=_.parent&&_.parent.remove(_)),o.label=4;case 4:return r++,[3,1];case 5:return this.set_core_group(e),[2]}}))}))},t.prototype._eval_expressions_for_points=function(e){return o.__awaiter(this,void 0,void 0,(function(){var t,n,r,i,s,a=this;return o.__generator(this,(function(o){switch(o.label){case 0:return t=[],n=this.p.expression,this.p.expression.has_expression()&&n.expression_controller?[4,n.expression_controller.compute_expression_for_points(e,(function(e,n){var r=!n;a.pv.invert&&(r=!r),r&&t.push(e)}))]:[3,2];case 1:return o.sent(),[3,3];case 2:for(r=this.pv.expression,i=!r,this.pv.invert&&(i=!i),s=0;s<e.length;s++)i&&t.push(e[s]);o.label=3;case 3:return console.log(t),[2,t]}}))}))},t.prototype._eval_expressions_for_objects=function(e){return o.__awaiter(this,void 0,void 0,(function(){var t,n,r,i,s=this;return o.__generator(this,(function(o){switch(o.label){case 0:return(t=this.p.expression).has_expression()&&t.expression_controller?[4,t.expression_controller.compute_expression_for_objects(e,(function(e,t){s._marked_for_deletion_per_object_index.get(e.index)||s._marked_for_deletion_per_object_index.set(e.index,t)}))]:[3,2];case 1:return o.sent(),[3,3];case 2:for(n=0,r=e;n<r.length;n++)i=r[n],this._marked_for_deletion_per_object_index.set(i.index,t.value);o.label=3;case 3:return[2]}}))}))},t.prototype._eval_attrib_for_points=function(e){var t=this,n=[];if(e.length>0){var r=e[0].attrib_value(this.pv.attrib_name);(s.default(r)?u.CoreString.attrib_names(this.pv.attrib_string):[this.pv.attrib_numeric.x]).forEach((function(r){return e.forEach((function(e){var o=e.attrib_value(t.pv.attrib_name),i=!t._comparison(o,r);if(t.pv.invert&&(i=!i),i)return n.push(e)}))}))}return n},t.prototype._comparison=function(e,t){switch(this.pv.attrib_ComparisonOperator){case r["=="]:return e===t;case r["<="]:return e<=t;case r["<"]:return e<t;case r[">"]:return e>t;case r[">="]:return e>=t;case r["!="]:return e!==t}},t.prototype._eval_type_for_objects=function(e){for(var t=c.ObjectTypes[this.pv.object_type],n=0,r=e;n<r.length;n++){var o=r[n];if(!this._marked_for_deletion_per_object_index.get(o.index))o.object().constructor.name===t&&this._marked_for_deletion_per_object_index.set(o.index,!0)}},t.prototype._eval_attrib_for_objects=function(e){for(var t=0,n=e;t<n.length;t++){var r=n[t];if(!this._marked_for_deletion_per_object_index.get(r.index)){var o=r.attrib_value(this.pv.attrib_name);o===(s.default(o)?this.pv.attrib_string:this.pv.attrib_float)&&this._marked_for_deletion_per_object_index.set(r.index,!0)}}},t.prototype._eval_bbox_for_points=function(e){var t=this,n=[];return a.default(e,(function(e,r){var o=t._bbox.containsPoint(e.position());if(t.pv.invert?o:!o)return n.push(e)})),n},Object.defineProperty(t.prototype,"_bbox",{get:function(){return null!=this._bbox_cache?this._bbox_cache:this._bbox_cache=new i.Box3(this.pv.bbox_center.clone().sub(this.pv.bbox_size.clone().multiplyScalar(.5)),this.pv.bbox_center.clone().add(this.pv.bbox_size.clone().multiplyScalar(.5)))},enumerable:!0,configurable:!0}),t.prototype._point_object=function(e){var t=e.points(),n=p.CoreGeometry.geometry_from_points(t,e.object().constructor);return this.create_object(n,c.ObjectType.POINTS)},t}(_.TypedSopNode);t.DeleteSopNode=m},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=n(1),i=n(4),s=r.__importDefault(n(82)),a=r.__importDefault(n(149)),_=r.__importDefault(n(293)),u=n(14),c=n(19),p=n(9),l=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.make_faces_unique=p.ParamConfig.BOOLEAN(0),t.add_face_center_attribute=p.ParamConfig.BOOLEAN(0,{visible_if:{make_faces_unique:1}}),t.add_face_id=p.ParamConfig.BOOLEAN(0,{visible_if:{make_faces_unique:1}}),t.transform=p.ParamConfig.BOOLEAN(0,{visible_if:{make_faces_unique:1}}),t.scale=p.ParamConfig.FLOAT(1,{visible_if:{make_faces_unique:1,transform:1}}),t}return r.__extends(t,e),t}(p.NodeParamsConfig)),d=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=l,t}return r.__extends(t,e),t.type=function(){return"face"},t.prototype.initialize_node=function(){this.io.inputs.set_count(1),this.io.inputs.init_inputs_clonable_state([c.InputCloneMode.FROM_NODE])},t.prototype.cook=function(e){var t=e[0];this.pv.make_faces_unique&&(this._make_faces_unique(t),this.pv.add_face_center_attribute&&this._add_face_center_attribute(t),this.pv.add_face_id&&this._add_face_id(t),this.pv.transform&&this._transform_faces(t)),this.set_core_group(t)},t.prototype._make_faces_unique=function(e){for(var t,n=0,r=e.objects();n<r.length;n++){var o=r[n];if(o.isMesh){for(var u=o.geometry,c=_.default((null===(t=u.index)||void 0===t?void 0:t.array)||[],3),p=3*c.length,l=function(e){var t=u.attributes[e],n=t.itemSize,r=new Float32Array(p*n),o=0;c.forEach((function(e){e.forEach((function(e){a.default(n,(function(i){var s=t.array[e*n+i];r[o]=s,o+=1}))}))})),u.setAttribute(e,new i.BufferAttribute(r,n))},d=0,h=Object.keys(u.attributes);d<h.length;d++){l(h[d])}var f=s.default(p);u.setIndex(f)}}},t.prototype._add_face_center_attribute=function(e){var t,n,r,i=new o.Vector3;e.core_objects().forEach((function(e){var o=e.object(),s=e.core_geometry();if(o.isMesh){t=s.faces(),s.has_attrib("face_center")||s.add_numeric_attrib("face_center",3,-1);for(var a=0;a<t.length;a++){(n=t[a]).center(i),r=n.points;for(var _=0;_<r.length;_++)r[_].set_attrib_value("face_center",i)}}}))},t.prototype._add_face_id=function(e){e.core_objects().forEach((function(e){var t=e.object(),n=e.core_geometry();if(t.isMesh){var r=n.faces();n.has_attrib("face_id")||n.add_numeric_attrib("face_id",1,-1);for(var o=0;o<r.length;o++)for(var i=r[o].points,s=0;s<i.length;s++){i[s].set_attrib_value("face_id",o)}}}))},t.prototype._transform_faces=function(e){var t,n,r,i,s=new o.Vector3,a=new o.Vector3,_=this.pv.scale;e.core_objects().forEach((function(e){var o=e.object(),u=e.core_geometry();if(o.isMesh){t=u.faces(),u.has_attrib("position")||u.add_numeric_attrib("position",3,-1);for(var c=0;c<t.length;c++){(n=t[c]).center(s),r=n.points;for(var p=0;p<r.length;p++){var l=(i=r[p]).position();a.x=l.x*_+s.x*(1-_),a.y=l.y*_+s.y*(1-_),a.z=l.z*_+s.z*(1-_),i.set_attrib_value("position",a)}}}}))},t}(u.TypedSopNode);t.FaceSopNode=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=r.__importDefault(n(74)),i=n(14),s=n(657),a=n(9),_=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.url=a.ParamConfig.STRING("",{desktop_browse:{file_type:"geometry"},always_reference_asset:!0}),t.reload=a.ParamConfig.BUTTON(null,{callback:function(e,t){u.PARAM_CALLBACK_reload(e,t)}}),t}return r.__extends(t,e),t}(a.NodeParamsConfig)),u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=_,t}return r.__extends(t,e),t.type=function(){return"file"},t.prototype.initialize_node=function(){this.io.inputs.set_count_to_zero()},t.prototype.cook=function(){new s.CoreLoaderGeometry(this.pv.url).load(this._on_load.bind(this),this._on_error.bind(this))},t.prototype._on_load=function(e){e=o.default(e),this.set_objects(e)},t.prototype._on_error=function(e){this.states.error.set("could not load geometry from "+this.pv.url+" ("+e+")")},t.PARAM_CALLBACK_reload=function(e,t){e.param_callback_reload()},t.prototype.param_callback_reload=function(){this.p.url.set_dirty()},t}(i.TypedSopNode);t.FileSopNode=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,o=n(3),i=n(330),s=o.__importDefault(n(301));!function(e){e.AUTO="auto",e.JSON_DATA="json_data"}(r=t.LoaderType||(t.LoaderType={})),t.LOADER_TYPES=[r.AUTO,r.JSON_DATA];var a=function(){function e(e){this.url=e;var t=this.url.split(".");this.ext=t[t.length-1].toLowerCase(),"zip"===this.ext&&(this.ext=t[t.length-2])}return e.prototype.load=function(e,t){this.load_auto().then((function(t){e(t)})).catch((function(e){t(e)}))},e.prototype.load_auto=function(){var e=this;return new Promise((function(t,n){return o.__awaiter(e,void 0,void 0,(function(){var e,r,a,_=this;return o.__generator(this,(function(o){switch(o.label){case 0:return e=this.url.includes("?")?this.url:this.url+"?"+Date.now(),"json"!=this.ext?[3,1]:(s.default.get(e).then((function(e){(new i.ObjectLoader).parse(e.data,(function(e){t(_.on_load_success(e.children[0]))}))})).catch((function(e){n(e)})),[3,3]);case 1:return[4,this.loader_for_ext()];case 2:(r=o.sent())?r.load(e,(function(e){_.on_load_success(e).then((function(e){t(e)}))}),void 0,(function(e){n(e)})):(a="format not supported ("+this.ext+")",n(a)),o.label=3;case 3:return[2]}}))}))}))},e.prototype.on_load_success=function(e){return o.__awaiter(this,void 0,void 0,(function(){return o.__generator(this,(function(t){switch(this.ext){case"gltf":case"glb":return[2,this.on_load_succes_gltf(e)];case"obj":case"json":default:return[2,[e]]}return[2]}))}))},e.prototype.on_load_succes_gltf=function(e){var t=e.scene;return t.animations=e.animations,[t]},e.prototype.loader_for_ext=function(){return o.__awaiter(this,void 0,void 0,(function(){return o.__generator(this,(function(e){switch(this.ext.toLowerCase()){case"gltf":return[2,this.loader_for_gltf()];case"glb":return[2,this.loader_for_glb()];case"drc":return[2,this.loader_for_drc()];case"obj":return[2,this.loader_for_obj()]}return[2]}))}))},e.prototype.loader_for_gltf=function(){return o.__awaiter(this,void 0,void 0,(function(){return o.__generator(this,(function(e){switch(e.label){case 0:return[4,Promise.resolve().then((function(){return o.__importStar(n(218))}))];case 1:return[2,new(0,e.sent().GLTFLoader)]}}))}))},e.prototype.loader_for_glb=function(){return o.__awaiter(this,void 0,void 0,(function(){return o.__generator(this,(function(e){switch(e.label){case 0:return[4,Promise.resolve().then((function(){return o.__importStar(n(218))}))];case 1:return[2,new(0,e.sent().GLTFLoader)]}}))}))},e.prototype.loader_for_drc=function(){return o.__awaiter(this,void 0,void 0,(function(){var e,t,r,i;return o.__generator(this,(function(s){switch(s.label){case 0:return[4,Promise.resolve().then((function(){return o.__importStar(n(658))}))];case 1:return e=s.sent().DRACOLoader,[4,Promise.resolve().then((function(){return o.__importStar(n(218))}))];case 2:return t=s.sent().GLTFLoader,r=new t,i=new e,r.setDRACOLoader(i),[2,r]}}))}))},e.prototype.loader_for_obj=function(){return o.__awaiter(this,void 0,void 0,(function(){return o.__generator(this,(function(e){switch(e.label){case 0:return[4,Promise.resolve().then((function(){return o.__importStar(n(659))}))];case 1:return[2,new(0,e.sent().OBJLoader)]}}))}))},e}();t.CoreLoaderGeometry=a},function(e,t,n){"use strict";n.r(t),n.d(t,"DRACOLoader",(function(){return a}));var r=n(4),o=n(5),i=n(27),s=n(18),a=function(e){s.a.call(this,e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}};a.prototype=Object.assign(Object.create(s.a.prototype),{constructor:a,setDecoderPath:function(e){return this.decoderPath=e,this},setDecoderConfig:function(e){return this.decoderConfig=e,this},setWorkerLimit:function(e){return this.workerLimit=e,this},setVerbosity:function(){console.warn("THREE.DRACOLoader: The .setVerbosity() method has been removed.")},setDrawMode:function(){console.warn("THREE.DRACOLoader: The .setDrawMode() method has been removed.")},setSkipDequantization:function(){console.warn("THREE.DRACOLoader: The .setSkipDequantization() method has been removed.")},load:function(e,t,n,r){var o=new i.a(this.manager);o.setPath(this.path),o.setResponseType("arraybuffer"),"use-credentials"===this.crossOrigin&&o.setWithCredentials(!0),o.load(e,e=>{var n={attributeIDs:this.defaultAttributeIDs,attributeTypes:this.defaultAttributeTypes,useUniqueIDs:!1};this.decodeGeometry(e,n).then(t).catch(r)},n,r)},decodeDracoFile:function(e,t,n,r){var o={attributeIDs:n||this.defaultAttributeIDs,attributeTypes:r||this.defaultAttributeTypes,useUniqueIDs:!!n};this.decodeGeometry(e,o).then(t)},decodeGeometry:function(e,t){for(var n in t.attributeTypes){var r=t.attributeTypes[n];void 0!==r.BYTES_PER_ELEMENT&&(t.attributeTypes[n]=r.name)}var o,i=JSON.stringify(t);if(a.taskCache.has(e)){var s=a.taskCache.get(e);if(s.key===i)return s.promise;if(0===e.byteLength)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}var _=this.workerNextTaskID++,u=e.byteLength,c=this._getWorker(_,u).then(n=>(o=n,new Promise((n,r)=>{o._callbacks[_]={resolve:n,reject:r},o.postMessage({type:"decode",id:_,taskConfig:t,buffer:e},[e])}))).then(e=>this._createGeometry(e.geometry));return c.finally(()=>{o&&_&&this._releaseTask(o,_)}),a.taskCache.set(e,{key:i,promise:c}),c},_createGeometry:function(e){var t=new o.BufferGeometry;e.index&&t.setIndex(new r.BufferAttribute(e.index.array,1));for(var n=0;n<e.attributes.length;n++){var i=e.attributes[n],s=i.name,a=i.array,_=i.itemSize;t.setAttribute(s,new r.BufferAttribute(a,_))}return t},_loadLibrary:function(e,t){var n=new i.a(this.manager);return n.setPath(this.decoderPath),n.setResponseType(t),new Promise((t,r)=>{n.load(e,t,void 0,r)})},preload:function(){return this._initDecoder(),this},_initDecoder:function(){if(this.decoderPending)return this.decoderPending;var e="object"!=typeof WebAssembly||"js"===this.decoderConfig.type,t=[];return e?t.push(this._loadLibrary("draco_decoder.js","text")):(t.push(this._loadLibrary("draco_wasm_wrapper.js","text")),t.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(t).then(t=>{var n=t[0];e||(this.decoderConfig.wasmBinary=t[1]);var r=a.DRACOWorker.toString(),o=["/* draco decoder */",n,"","/* worker */",r.substring(r.indexOf("{")+1,r.lastIndexOf("}"))].join("\n");this.workerSourceURL=URL.createObjectURL(new Blob([o]))}),this.decoderPending},_getWorker:function(e,t){return this._initDecoder().then(()=>{var n;this.workerPool.length<this.workerLimit?((n=new Worker(this.workerSourceURL))._callbacks={},n._taskCosts={},n._taskLoad=0,n.postMessage({type:"init",decoderConfig:this.decoderConfig}),n.onmessage=function(e){var t=e.data;switch(t.type){case"decode":n._callbacks[t.id].resolve(t);break;case"error":n._callbacks[t.id].reject(t);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+t.type+'"')}},this.workerPool.push(n)):this.workerPool.sort((function(e,t){return e._taskLoad>t._taskLoad?-1:1}));return(n=this.workerPool[this.workerPool.length-1])._taskCosts[e]=t,n._taskLoad+=t,n})},_releaseTask:function(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]},debug:function(){console.log("Task load: ",this.workerPool.map(e=>e._taskLoad))},dispose:function(){for(var e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this}}),a.DRACOWorker=function(){var e,t;function n(e,t,n,r,o,i){var s,a,_=i.num_components(),u=n.num_points()*_;switch(o){case Float32Array:s=new e.DracoFloat32Array,t.GetAttributeFloatForAllPoints(n,i,s),a=new Float32Array(u);break;case Int8Array:s=new e.DracoInt8Array,t.GetAttributeInt8ForAllPoints(n,i,s),a=new Int8Array(u);break;case Int16Array:s=new e.DracoInt16Array,t.GetAttributeInt16ForAllPoints(n,i,s),a=new Int16Array(u);break;case Int32Array:s=new e.DracoInt32Array,t.GetAttributeInt32ForAllPoints(n,i,s),a=new Int32Array(u);break;case Uint8Array:s=new e.DracoUInt8Array,t.GetAttributeUInt8ForAllPoints(n,i,s),a=new Uint8Array(u);break;case Uint16Array:s=new e.DracoUInt16Array,t.GetAttributeUInt16ForAllPoints(n,i,s),a=new Uint16Array(u);break;case Uint32Array:s=new e.DracoUInt32Array,t.GetAttributeUInt32ForAllPoints(n,i,s),a=new Uint32Array(u);break;default:throw new Error("THREE.DRACOLoader: Unexpected attribute type.")}for(var c=0;c<u;c++)a[c]=s.GetValue(c);return e.destroy(s),{name:r,array:a,itemSize:_}}onmessage=function(r){var o=r.data;switch(o.type){case"init":e=o.decoderConfig,t=new Promise((function(t){e.onModuleLoaded=function(e){t({draco:e})},DracoDecoderModule(e)}));break;case"decode":var i=o.buffer,s=o.taskConfig;t.then(e=>{var t=e.draco,r=new t.Decoder,a=new t.DecoderBuffer;a.Init(new Int8Array(i),i.byteLength);try{var _=function(e,t,r,o){var i,s,a=o.attributeIDs,_=o.attributeTypes,u=t.GetEncodedGeometryType(r);if(u===e.TRIANGULAR_MESH)i=new e.Mesh,s=t.DecodeBufferToMesh(r,i);else{if(u!==e.POINT_CLOUD)throw new Error("THREE.DRACOLoader: Unexpected geometry type.");i=new e.PointCloud,s=t.DecodeBufferToPointCloud(r,i)}if(!s.ok()||0===i.ptr)throw new Error("THREE.DRACOLoader: Decoding failed: "+s.error_msg());var c={index:null,attributes:[]};for(var p in a){var l,d,h=self[_[p]];if(o.useUniqueIDs)d=a[p],l=t.GetAttributeByUniqueId(i,d);else{if(-1===(d=t.GetAttributeId(i,e[a[p]])))continue;l=t.GetAttribute(i,d)}c.attributes.push(n(e,t,i,p,h,l))}if(u===e.TRIANGULAR_MESH){for(var f=i.num_faces(),m=new Uint32Array(3*f),y=new e.DracoInt32Array,v=0;v<f;++v){t.GetFaceFromMesh(i,v,y);for(var g=0;g<3;++g)m[3*v+g]=y.GetValue(g)}c.index={array:m,itemSize:1},e.destroy(y)}return e.destroy(i),c}(t,r,a,s),u=_.attributes.map(e=>e.array.buffer);_.index&&u.push(_.index.array.buffer),self.postMessage({type:"decode",id:o.id,geometry:_},u)}catch(e){console.error(e),self.postMessage({type:"error",id:o.id,error:e.message})}finally{t.destroy(a),t.destroy(r)}})}}},a.taskCache=new WeakMap,a.setDecoderPath=function(){console.warn("THREE.DRACOLoader: The .setDecoderPath() method has been removed. Use instance methods.")},a.setDecoderConfig=function(){console.warn("THREE.DRACOLoader: The .setDecoderConfig() method has been removed. Use instance methods.")},a.releaseDecoderModule=function(){console.warn("THREE.DRACOLoader: The .releaseDecoderModule() method has been removed. Use instance methods.")},a.getDecoderModule=function(){console.warn("THREE.DRACOLoader: The .getDecoderModule() method has been removed. Use instance methods.")}},function(e,t,n){"use strict";n.r(t),n.d(t,"OBJLoader",(function(){return m}));var r=n(5),o=n(27),i=n(4),s=n(36),a=n(38),_=n(66),u=n(18),c=n(8),p=n(23),l=n(166),d=n(0),h=n(75),f=n(58),m=function(){var e=/^[og]\s*(.+)?/,t=/^mtllib /,n=/^usemtl /,m=/^usemap /;function y(){var e={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materialLibraries:[],startObject:function(e,t){if(this.object&&!1===this.object.fromDeclaration)return this.object.name=e,void(this.object.fromDeclaration=!1!==t);var n=this.object&&"function"==typeof this.object.currentMaterial?this.object.currentMaterial():void 0;if(this.object&&"function"==typeof this.object._finalize&&this.object._finalize(!0),this.object={name:e||"",fromDeclaration:!1!==t,geometry:{vertices:[],normals:[],colors:[],uvs:[]},materials:[],smooth:!0,startMaterial:function(e,t){var n=this._finalize(!1);n&&(n.inherited||n.groupCount<=0)&&this.materials.splice(n.index,1);var r={index:this.materials.length,name:e||"",mtllib:Array.isArray(t)&&t.length>0?t[t.length-1]:"",smooth:void 0!==n?n.smooth:this.smooth,groupStart:void 0!==n?n.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(e){var t={index:"number"==typeof e?e:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return t.clone=this.clone.bind(t),t}};return this.materials.push(r),r},currentMaterial:function(){if(this.materials.length>0)return this.materials[this.materials.length-1]},_finalize:function(e){var t=this.currentMaterial();if(t&&-1===t.groupEnd&&(t.groupEnd=this.geometry.vertices.length/3,t.groupCount=t.groupEnd-t.groupStart,t.inherited=!1),e&&this.materials.length>1)for(var n=this.materials.length-1;n>=0;n--)this.materials[n].groupCount<=0&&this.materials.splice(n,1);return e&&0===this.materials.length&&this.materials.push({name:"",smooth:this.smooth}),t}},n&&n.name&&"function"==typeof n.clone){var r=n.clone(0);r.inherited=!0,this.object.materials.push(r)}this.objects.push(this.object)},finalize:function(){this.object&&"function"==typeof this.object._finalize&&this.object._finalize(!0)},parseVertexIndex:function(e,t){var n=parseInt(e,10);return 3*(n>=0?n-1:n+t/3)},parseNormalIndex:function(e,t){var n=parseInt(e,10);return 3*(n>=0?n-1:n+t/3)},parseUVIndex:function(e,t){var n=parseInt(e,10);return 2*(n>=0?n-1:n+t/2)},addVertex:function(e,t,n){var r=this.vertices,o=this.object.geometry.vertices;o.push(r[e+0],r[e+1],r[e+2]),o.push(r[t+0],r[t+1],r[t+2]),o.push(r[n+0],r[n+1],r[n+2])},addVertexPoint:function(e){var t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addVertexLine:function(e){var t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addNormal:function(e,t,n){var r=this.normals,o=this.object.geometry.normals;o.push(r[e+0],r[e+1],r[e+2]),o.push(r[t+0],r[t+1],r[t+2]),o.push(r[n+0],r[n+1],r[n+2])},addColor:function(e,t,n){var r=this.colors,o=this.object.geometry.colors;o.push(r[e+0],r[e+1],r[e+2]),o.push(r[t+0],r[t+1],r[t+2]),o.push(r[n+0],r[n+1],r[n+2])},addUV:function(e,t,n){var r=this.uvs,o=this.object.geometry.uvs;o.push(r[e+0],r[e+1]),o.push(r[t+0],r[t+1]),o.push(r[n+0],r[n+1])},addUVLine:function(e){var t=this.uvs;this.object.geometry.uvs.push(t[e+0],t[e+1])},addFace:function(e,t,n,r,o,i,s,a,_){var u=this.vertices.length,c=this.parseVertexIndex(e,u),p=this.parseVertexIndex(t,u),l=this.parseVertexIndex(n,u);if(this.addVertex(c,p,l),this.colors.length>0&&this.addColor(c,p,l),void 0!==r&&""!==r){var d=this.uvs.length;c=this.parseUVIndex(r,d),p=this.parseUVIndex(o,d),l=this.parseUVIndex(i,d),this.addUV(c,p,l)}if(void 0!==s&&""!==s){var h=this.normals.length;c=this.parseNormalIndex(s,h),p=s===a?c:this.parseNormalIndex(a,h),l=s===_?c:this.parseNormalIndex(_,h),this.addNormal(c,p,l)}},addPointGeometry:function(e){this.object.geometry.type="Points";for(var t=this.vertices.length,n=0,r=e.length;n<r;n++)this.addVertexPoint(this.parseVertexIndex(e[n],t))},addLineGeometry:function(e,t){this.object.geometry.type="Line";for(var n=this.vertices.length,r=this.uvs.length,o=0,i=e.length;o<i;o++)this.addVertexLine(this.parseVertexIndex(e[o],n));var s=0;for(i=t.length;s<i;s++)this.addUVLine(this.parseUVIndex(t[s],r))}};return e.startObject("",!1),e}function v(e){u.a.call(this,e),this.materials=null}return v.prototype=Object.assign(Object.create(u.a.prototype),{constructor:v,load:function(e,t,n,r){var i=this,s=new o.a(i.manager);s.setPath(this.path),s.load(e,(function(e){t(i.parse(e))}),n,r)},setMaterials:function(e){return this.materials=e,this},parse:function(o){console.time("OBJLoader");var u=new y;-1!==o.indexOf("\r\n")&&(o=o.replace(/\r\n/g,"\n")),-1!==o.indexOf("\\\n")&&(o=o.replace(/\\\n/g,""));for(var v=o.split("\n"),g="",b="",O=[],P="function"==typeof"".trimLeft,w=0,x=v.length;w<x;w++)if(g=v[w],0!==(g=P?g.trimLeft():g.trim()).length&&"#"!==(b=g.charAt(0)))if("v"===b){var C=g.split(/\s+/);switch(C[0]){case"v":u.vertices.push(parseFloat(C[1]),parseFloat(C[2]),parseFloat(C[3])),C.length>=7&&u.colors.push(parseFloat(C[4]),parseFloat(C[5]),parseFloat(C[6]));break;case"vn":u.normals.push(parseFloat(C[1]),parseFloat(C[2]),parseFloat(C[3]));break;case"vt":u.uvs.push(parseFloat(C[1]),parseFloat(C[2]))}}else if("f"===b){for(var E=g.substr(1).trim().split(/\s+/),T=[],j=0,A=E.length;j<A;j++){var N=E[j];if(N.length>0){var M=N.split("/");T.push(M)}}var k=T[0];for(j=1,A=T.length-1;j<A;j++){var S=T[j],R=T[j+1];u.addFace(k[0],S[0],R[0],k[1],S[1],R[1],k[2],S[2],R[2])}}else if("l"===b){var D=g.substring(1).trim().split(" "),I=[],L=[];if(-1===g.indexOf("/"))I=D;else for(var B=0,G=D.length;B<G;B++){var z=D[B].split("/");""!==z[0]&&I.push(z[0]),""!==z[1]&&L.push(z[1])}u.addLineGeometry(I,L)}else if("p"===b){var F=g.substr(1).trim().split(" ");u.addPointGeometry(F)}else if(null!==(O=e.exec(g))){var V=(" "+O[0].substr(1).trim()).substr(1);u.startObject(V)}else if(n.test(g))u.object.startMaterial(g.substring(7).trim(),u.materialLibraries);else if(t.test(g))u.materialLibraries.push(g.substring(7).trim());else if(m.test(g))console.warn('THREE.OBJLoader: Rendering identifier "usemap" not supported. Textures must be defined in MTL files.');else if("s"===b){if((O=g.split(" ")).length>1){var U=O[1].trim().toLowerCase();u.object.smooth="0"!==U&&"off"!==U}else u.object.smooth=!0;(re=u.object.currentMaterial())&&(re.smooth=u.object.smooth)}else{if("\0"===g)continue;console.warn('THREE.OBJLoader: Unexpected line: "'+g+'"')}u.finalize();var Y=new s.Group;Y.materialLibraries=[].concat(u.materialLibraries);for(w=0,x=u.objects.length;w<x;w++){var q=u.objects[w],H=q.geometry,X=q.materials,J="Line"===H.type,W="Points"===H.type,K=!1;if(0!==H.vertices.length){var Z=new r.BufferGeometry;Z.setAttribute("position",new i.Float32BufferAttribute(H.vertices,3)),H.normals.length>0?Z.setAttribute("normal",new i.Float32BufferAttribute(H.normals,3)):Z.computeVertexNormals(),H.colors.length>0&&(K=!0,Z.setAttribute("color",new i.Float32BufferAttribute(H.colors,3))),H.uvs.length>0&&Z.setAttribute("uv",new i.Float32BufferAttribute(H.uvs,2));for(var Q,$=[],ee=0,te=X.length;ee<te;ee++){var ne=X[ee],re=void 0;if(null!==this.materials)if(re=this.materials.create(ne.name),!J||!re||re instanceof a.LineBasicMaterial){if(W&&re&&!(re instanceof f.PointsMaterial)){var oe=new f.PointsMaterial({size:10,sizeAttenuation:!1});c.a.prototype.copy.call(oe,re),oe.color.copy(re.color),oe.map=re.map,re=oe}}else{var ie=new a.LineBasicMaterial;c.a.prototype.copy.call(ie,re),ie.color.copy(re.color),re=ie}re||((re=J?new a.LineBasicMaterial:W?new f.PointsMaterial({size:1,sizeAttenuation:!1}):new l.a).name=ne.name),re.flatShading=!ne.smooth,re.vertexColors=K?d.VertexColors:d.NoColors,$.push(re)}if($.length>1){for(ee=0,te=X.length;ee<te;ee++){ne=X[ee];Z.addGroup(ne.groupStart,ne.groupCount,ee)}Q=J?new _.LineSegments(Z,$):W?new h.Points(Z,$):new p.Mesh(Z,$)}else Q=J?new _.LineSegments(Z,$[0]):W?new h.Points(Z,$[0]):new p.Mesh(Z,$[0]);Q.name=q.name,Y.add(Q)}}return console.timeEnd("OBJLoader"),Y}}),v}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=n(14),i=n(43),s=n(1),a=n(9),_=n(19),u=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.dist=a.ParamConfig.FLOAT(.1,{range:[0,1],range_locked:[!0,!1]}),t}return r.__extends(t,e),t}(a.NodeParamsConfig)),c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=u,t}return r.__extends(t,e),t.type=function(){return"fuse"},t.displayed_input_names=function(){return["points to fuse together"]},t.prototype.initialize_node=function(){this.io.inputs.set_count(1),this.io.inputs.init_inputs_clonable_state([_.InputCloneMode.FROM_NODE])},t.prototype.cook=function(e){for(var t,n=[],r=0,o=e[0].core_objects();r<o.length;r++){var i=o[r];(t=this._fuse_core_object(i))&&n.push(t)}this.set_objects(n)},t.prototype._fuse_core_object=function(e){var t=e.object();if(t){for(var n=e.points(),r=this.pv.dist,o={},a=0,_=n;a<_.length;a++){var u=_[a],c=u.position(),p=new s.Vector3(Math.round(c.x/r),Math.round(c.y/r),Math.round(c.z/r)).toArray().join("-");o[p]=o[p]||[],o[p].push(u)}var l=[];return Object.keys(o).forEach((function(e){l.push(o[e][0])})),t.geometry.dispose(),l.length>0?(t.geometry=i.CoreGeometry.geometry_from_points(l,t.constructor),t):void 0}},t}(o.TypedSopNode);t.FuseSopNode=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=n(1),i=n(14),s=n(65),a=n(26),_=n(662),u=new o.Vector3(0,1,0),c=n(9),p=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.size=c.ParamConfig.VECTOR2([1,1]),t.hexagon_radius=c.ParamConfig.FLOAT(.1),t.direction=c.ParamConfig.VECTOR3([0,1,0]),t.points_only=c.ParamConfig.BOOLEAN(0),t}return r.__extends(t,e),t}(c.NodeParamsConfig)),l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=p,t._core_transform=new s.CoreTransform,t}return r.__extends(t,e),t.type=function(){return"hexagons"},t.prototype.initialize_node=function(){},t.prototype.cook=function(){var e=new _.CoreGeometryOperationHexagon(this.pv.size,this.pv.hexagon_radius,this.pv.points_only).process();console.log(e,e.attributes.position),this._core_transform.rotate_geometry(e,u,this.pv.direction),this.pv.points_only?this.set_geometry(e,a.CoreConstant.OBJECT_TYPE.POINTS):this.set_geometry(e)},t}(i.TypedSopNode);t.HexagonsSopNode=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=n(2),i=n(5),s={BufferAttribute:n(4).BufferAttribute,BufferGeometry:i.BufferGeometry,Vector2:o.Vector2},a=r.__importDefault(n(74)),_=function(){function e(e,t,n){this._param_size=e,this._param_hexagon_radius=t,this._param_points_only=n}return e.prototype.process=function(){for(var e=this._param_hexagon_radius,t=.5*e,n=e,r=Math.cos(Math.PI/6)*this._param_hexagon_radius,o=Math.floor(this._param_size.x/n),i=Math.floor(this._param_size.y/r),_=[],u=[],c=0;c<i;c++)for(var p=0;p<o;p++)_.push([-.5*this._param_size.x+p*n+(c%2==0?t:0),0,-.5*this._param_size.y+c*r]),this._param_points_only||c>=1&&(0==p||p==o-1?0==p?u.push([p+1+(c-1)*o,p+(c-1)*o,p+c*o]):u.push([p+c*o,p+(c-1)*o,p-1+c*o]):(u.push([p+c*o,p+(c-1)*o,p-1+c*o]),u.push([p+c*o,p+1+(c-1)*o,p+(c-1)*o])));_=a.default(_);var l=new s.BufferGeometry;return l.setAttribute("position",new s.BufferAttribute(new Float32Array(_),3)),this._param_points_only||(u=a.default(u),l.setIndex(u),l.computeVertexNormals()),l},e}();t.CoreGeometryOperationHexagon=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,o=n(3),i=n(10),s={Group:n(36).Group,Object3D:i.Object3D},a=n(14);!function(e){e.ADD_PARENT="add_parent",e.REMOVE_PARENT="remove_parent"}(r=t.HierarchyMode||(t.HierarchyMode={})),t.HIERARCHY_MODES=[r.ADD_PARENT,r.REMOVE_PARENT];var _=n(9),u=new(function(e){function n(){var n=null!==e&&e.apply(this,arguments)||this;return n.mode=_.ParamConfig.INTEGER(0,{menu:{entries:t.HIERARCHY_MODES.map((function(e,t){return{name:e,value:t}}))}}),n.levels=_.ParamConfig.INTEGER(1,{range:[0,5]}),n}return o.__extends(n,e),n}(_.NodeParamsConfig)),c=function(e){function n(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=u,t}return o.__extends(n,e),n.type=function(){return"hierarchy"},n.displayed_input_names=function(){return["geometry to add or remove parents to/from"]},n.prototype.initialize_node=function(){this.io.inputs.set_count(1)},n.prototype.cook=function(e){var n=e[0];if(t.HIERARCHY_MODES[this.pv.mode]==r.ADD_PARENT){var o=this._add_parent_to_core_group(n);this.set_objects(o)}else{o=this._remove_parent_from_core_group(n);this.set_objects(o)}},n.prototype._add_parent_to_core_group=function(e){if(0==this.pv.levels)return e.objects();for(var t=[],n=void 0,r=0,o=e.objects();r<o.length;r++){var i=o[r];(n=this._add_parent_to_object(i))&&t.push(n)}return t},n.prototype._add_parent_to_object=function(e){var t=new s.Group;if(t.add(e),this.pv.levels>0)for(var n=0;n<this.pv.levels-1;n++)t=this._add_new_parent(t);return t},n.prototype._add_new_parent=function(e){var t=new s.Group;return t.add(e),t},n.prototype._remove_parent_from_core_group=function(e){if(0==this.pv.levels)return e.objects();for(var t=[],n=0,r=e.objects();n<r.length;n++)for(var o=r[n],i=0,s=this._remove_parent_from_object(o);i<s.length;i++){var a=s[i];t.push(a)}return t},n.prototype._remove_parent_from_object=function(e){for(var t=e.children,n=0;n<this.pv.levels-1;n++)t=this._get_children_from_objects(t);return t},n.prototype._get_children_from_objects=function(e){for(var t,n=[];t=e.pop();)if(t.children)for(var r=0,o=t.children;r<o.length;r++){var i=o[r];n.push(i)}return n},n}(a.TypedSopNode);t.HierarchySopNode=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o={Vector3:n(1).Vector3},i=n(104),s=n(14),a=n(9),_=n(19),u=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.amount=a.ParamConfig.FLOAT(1),t.seed=a.ParamConfig.INTEGER(1,{range:[0,100]}),t}return r.__extends(t,e),t}(a.NodeParamsConfig)),c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=u,t}return r.__extends(t,e),t.type=function(){return"jitter"},t.displayed_input_names=function(){return["geometry to jitter points of"]},t.prototype.initialize_node=function(){this.io.inputs.set_count(1),this.io.inputs.init_inputs_clonable_state([_.InputCloneMode.FROM_NODE])},t.prototype.cook=function(e){var t=this,n=e[0];n.points().forEach((function(e,n){var r=new o.Vector3(2*(i.CoreMath.rand(75*n+764+t.pv.seed)-.5),2*(i.CoreMath.rand(5678*n+3653+t.pv.seed)-.5),2*(i.CoreMath.rand(657*n+48464+t.pv.seed)-.5));r.normalize(),r.multiplyScalar(t.pv.amount);var s=e.position().clone().add(r);e.set_position(s)})),this.set_core_group(n)},t}(s.TypedSopNode);t.JitterSopNode=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=n(14),i=n(9),s=n(19),a=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.layer=i.ParamConfig.INTEGER(0,{range:[0,31],range_locked:[!0,!0]}),t}return r.__extends(t,e),t}(i.NodeParamsConfig)),_=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=a,t}return r.__extends(t,e),t.type=function(){return"layer"},t.displayed_input_names=function(){return["objects to change layers of"]},t.prototype.initialize_node=function(){this.io.inputs.set_count(1),this.io.inputs.init_inputs_clonable_state([s.InputCloneMode.FROM_NODE])},t.prototype.cook=function(e){for(var t=e[0],n=0,r=t.objects();n<r.length;n++){r[n].layers.set(this.pv.layer)}this.set_core_group(t)},t}(o.TypedSopNode);t.LayerSopNode=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=n(4),i=n(5),s=r.__importDefault(n(149)),a=n(14),_=n(26),u=n(9),c=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.length=u.ParamConfig.FLOAT(1,{range:[0,10]}),t.points_count=u.ParamConfig.INTEGER(1,{range:[2,100],range_locked:[!0,!1]}),t.origin=u.ParamConfig.VECTOR3([0,0,0]),t.direction=u.ParamConfig.VECTOR3([0,1,0]),t}return r.__extends(t,e),t}(u.NodeParamsConfig)),p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=c,t}return r.__extends(t,e),t.type=function(){return"line"},t.prototype.initialize_node=function(){},t.prototype.cook=function(){var e=this,t=Math.max(2,this.pv.points_count),n=new Array(3*t),r=new Array(t),a=this.pv.direction.clone().normalize().multiplyScalar(this.pv.length);s.default(t,(function(o){var i=o/(t-1),s=a.clone().multiplyScalar(i);s.add(e.pv.origin),s.toArray(n,3*o),o>0&&(r[2*(o-1)]=o-1,r[2*(o-1)+1]=o)}));var u=new i.BufferGeometry;u.setAttribute("position",new o.Float32BufferAttribute(n,3)),u.setIndex(r),this.set_geometry(u,_.CoreConstant.OBJECT_TYPE.LINE_SEGMENTS)},t}(a.TypedSopNode);t.LineSopNode=p},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=n(14),i=n(43),s=n(26),a="geometry to merge",_=n(9),u=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.compact=_.ParamConfig.BOOLEAN(1),t}return r.__extends(t,e),t}(_.NodeParamsConfig)),c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=u,t}return r.__extends(t,e),t.type=function(){return"merge"},t.displayed_input_names=function(){return[a,a,a,a]},t.prototype.initialize_node=function(){this.io.inputs.set_count(1,4),this.ui_data.set_width(100),this.ui_data.set_icon("compress-arrows-alt")},t.prototype.cook=function(e){for(var t=[],n=0,r=e;n<r.length;n++){var o=r[n];if(o)for(var i=0,s=o.objects();i<s.length;i++){s[i].traverse((function(e){t.push(e)}))}}this.pv.compact&&(t=this._make_compact(t)),this.set_objects(t)},t.prototype._make_compact=function(e){for(var t,n=((t={})[s.ObjectType.MESH]=[],t[s.ObjectType.POINTS]=[],t[s.ObjectType.LINE_SEGMENTS]=[],t),r=[],o=0,a=e;o<a.length;o++){(m=a[o]).traverse((function(e){var t=e;t.geometry&&(t.isMesh?n[s.ObjectType.MESH].push(t):t.isLineSegments?n[s.ObjectType.LINE_SEGMENTS].push(t):t.isPoints&&n[s.ObjectType.POINTS].push(t))}))}for(var _=0,u=Object.keys(n);_<u.length;_++){for(var c=u[_],p=[],l=0,d=n[c];l<d.length;l++){var h=(m=d[l]).geometry;h.applyMatrix(m.matrix),p.push(h)}var f=i.CoreGeometry.merge_geometries(p);if(f){var m=this.create_object(f,c);r.push(m)}}return r},t}(o.TypedSopNode);t.MergeSopNode=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,o=n(3),i=n(1),s=n(2),a=n(14),_=n(104),u=n(19),c=n(211),p=n(669);!function(e){e.ADD="add",e.SET="set",e.MULT="mult",e.SUBSTRACT="substract",e.DIVIDE="divide"}(r||(r={}));var l=[r.ADD,r.SET,r.MULT,r.SUBSTRACT,r.DIVIDE],d=n(9),h=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.amount=d.ParamConfig.FLOAT(1),t.freq=d.ParamConfig.VECTOR3([1,1,1]),t.offset=d.ParamConfig.VECTOR3([0,0,0]),t.octaves=d.ParamConfig.INTEGER(3,{range:[1,8],range_locked:[!0,!1]}),t.amp_attenuation=d.ParamConfig.FLOAT(.5,{range:[0,1]}),t.freq_increase=d.ParamConfig.FLOAT(2,{range:[0,10]}),t.seed=d.ParamConfig.INTEGER(0,{range:[0,100]}),t.separator=d.ParamConfig.SEPARATOR(),t.use_normals=d.ParamConfig.BOOLEAN(0),t.attrib_name=d.ParamConfig.STRING("position"),t.operation=d.ParamConfig.INTEGER(l.indexOf(r.ADD),{menu:{entries:l.map((function(e){return{name:e,value:l.indexOf(e)}}))}}),t.compute_normals=d.ParamConfig.BOOLEAN(1),t}return o.__extends(t,e),t}(d.NodeParamsConfig)),f=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=h,t._simplex_by_seed=new Map,t._rest_points=[],t}return o.__extends(t,e),t.type=function(){return"noise"},t.displayed_input_names=function(){return["geometry to add noise to","rest geometry"]},t.prototype.initialize_node=function(){this.io.inputs.set_count(1,2),this.io.inputs.init_inputs_clonable_state([u.InputCloneMode.FROM_NODE,u.InputCloneMode.NEVER])},t.prototype.cook=function(e){return o.__awaiter(this,void 0,void 0,(function(){var t,n,a,_,u,p,d,h,f,m,y,v=this;return o.__generator(this,(function(o){for(t=e[0],n=e[1],a=t.points(),n&&(null!=this._rest_core_group_timestamp&&this._rest_core_group_timestamp==n.timestamp()||(this._rest_points=n.points(),this._rest_core_group_timestamp=n.timestamp())),_=this._get_simplex(),u=this.pv.use_normals&&t.has_attrib("normal"),p=t.attrib_size(this.pv.attrib_name),d=function(e){var t=a[e],o=n?h._rest_points[e]:t,d=o.attrib_value(h.pv.attrib_name),f=o.position().add(h.pv.offset).multiply(h.pv.freq),m=function(){if(u){var e=o.attrib_value("normal"),t=v.pv.amount*v._fbm(_,f.x,f.y,f.z);return e.clone().multiplyScalar(t)}return new i.Vector3(v.pv.amount*v._fbm(_,f.x+545,f.y+125454,f.z+2142),v.pv.amount*v._fbm(_,f.x-425,f.y-25746,f.z+95242),v.pv.amount*v._fbm(_,f.x+765132,f.y+21,f.z-9245))}();m=function(){switch(p){case 1:return m.x;case 2:return new s.Vector2(m.x,m.y);case 3:return m}}();var y=function(){var e=l[v.pv.operation];switch(p){case 1:switch(e){case r.ADD:return d+m;case r.SET:return m;case r.MULT:return d*m;case r.DIVIDE:return d/m;case r.SUBSTRACT:return d-m}c.TypeAssert.unreachable(e);break;default:switch(e){case r.ADD:return d.add(m);case r.SET:return m;case r.MULT:return d.multiply(m);case r.DIVIDE:return d.divide(m);case r.SUBSTRACT:return d.sub(m)}c.TypeAssert.unreachable(e)}}();t.set_attrib_value(h.pv.attrib_name,y)},h=this,f=0;f<a.length;f++)d(f);if(!this.io.inputs.input_cloned(0))for(m=0,y=t.geometries();m<y.length;m++)y[m].getAttribute(this.pv.attrib_name).needsUpdate=!0;return this.pv.compute_normals&&t.compute_vertex_normals(),this.set_core_group(t),[2]}))}))},t.prototype._fbm=function(e,t,n,r){for(var o=0,i=1,s=0;s<this.pv.octaves;s++)o+=i*e.noise3d(t,n,r),t*=this.pv.freq_increase,n*=this.pv.freq_increase,r*=this.pv.freq_increase,i*=this.pv.amp_attenuation;return o},t.prototype._get_simplex=function(){var e=this._simplex_by_seed.get(this.pv.seed);if(e)return e;var t=this._create_simplex();return this._simplex_by_seed.set(this.pv.seed,t),t},t.prototype._create_simplex=function(){var e=this.pv.seed,t={random:function(){return _.CoreMath.rand_float(e)}},n=new p.SimplexNoise(t);return this._simplex_by_seed.delete(e),n},t}(a.TypedSopNode);t.NoiseSopNode=f},function(e,t,n){"use strict";n.r(t),n.d(t,"SimplexNoise",(function(){return r}));var r=function(e){null==e&&(e=Math),this.grad3=[[1,1,0],[-1,1,0],[1,-1,0],[-1,-1,0],[1,0,1],[-1,0,1],[1,0,-1],[-1,0,-1],[0,1,1],[0,-1,1],[0,1,-1],[0,-1,-1]],this.grad4=[[0,1,1,1],[0,1,1,-1],[0,1,-1,1],[0,1,-1,-1],[0,-1,1,1],[0,-1,1,-1],[0,-1,-1,1],[0,-1,-1,-1],[1,0,1,1],[1,0,1,-1],[1,0,-1,1],[1,0,-1,-1],[-1,0,1,1],[-1,0,1,-1],[-1,0,-1,1],[-1,0,-1,-1],[1,1,0,1],[1,1,0,-1],[1,-1,0,1],[1,-1,0,-1],[-1,1,0,1],[-1,1,0,-1],[-1,-1,0,1],[-1,-1,0,-1],[1,1,1,0],[1,1,-1,0],[1,-1,1,0],[1,-1,-1,0],[-1,1,1,0],[-1,1,-1,0],[-1,-1,1,0],[-1,-1,-1,0]],this.p=[];for(var t=0;t<256;t++)this.p[t]=Math.floor(256*e.random());this.perm=[];for(t=0;t<512;t++)this.perm[t]=this.p[255&t];this.simplex=[[0,1,2,3],[0,1,3,2],[0,0,0,0],[0,2,3,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,3,0],[0,2,1,3],[0,0,0,0],[0,3,1,2],[0,3,2,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,3,2,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,0,3],[0,0,0,0],[1,3,0,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,3,0,1],[2,3,1,0],[1,0,2,3],[1,0,3,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,3,1],[0,0,0,0],[2,1,3,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,1,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,0,1,2],[3,0,2,1],[0,0,0,0],[3,1,2,0],[2,1,0,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,1,0,2],[0,0,0,0],[3,2,0,1],[3,2,1,0]]};r.prototype.dot=function(e,t,n){return e[0]*t+e[1]*n},r.prototype.dot3=function(e,t,n,r){return e[0]*t+e[1]*n+e[2]*r},r.prototype.dot4=function(e,t,n,r,o){return e[0]*t+e[1]*n+e[2]*r+e[3]*o},r.prototype.noise=function(e,t){var n,r,o=(e+t)*(.5*(Math.sqrt(3)-1)),i=Math.floor(e+o),s=Math.floor(t+o),a=(3-Math.sqrt(3))/6,_=(i+s)*a,u=e-(i-_),c=t-(s-_);u>c?(n=1,r=0):(n=0,r=1);var p=u-n+a,l=c-r+a,d=u-1+2*a,h=c-1+2*a,f=255&i,m=255&s,y=this.perm[f+this.perm[m]]%12,v=this.perm[f+n+this.perm[m+r]]%12,g=this.perm[f+1+this.perm[m+1]]%12,b=.5-u*u-c*c,O=.5-p*p-l*l,P=.5-d*d-h*h;return 70*((b<0?0:(b*=b)*b*this.dot(this.grad3[y],u,c))+(O<0?0:(O*=O)*O*this.dot(this.grad3[v],p,l))+(P<0?0:(P*=P)*P*this.dot(this.grad3[g],d,h)))},r.prototype.noise3d=function(e,t,n){var r,o,i,s,a,_,u=(e+t+n)*(1/3),c=Math.floor(e+u),p=Math.floor(t+u),l=Math.floor(n+u),d=1/6,h=(c+p+l)*d,f=e-(c-h),m=t-(p-h),y=n-(l-h);f>=m?m>=y?(r=1,o=0,i=0,s=1,a=1,_=0):f>=y?(r=1,o=0,i=0,s=1,a=0,_=1):(r=0,o=0,i=1,s=1,a=0,_=1):m<y?(r=0,o=0,i=1,s=0,a=1,_=1):f<y?(r=0,o=1,i=0,s=0,a=1,_=1):(r=0,o=1,i=0,s=1,a=1,_=0);var v=f-r+d,g=m-o+d,b=y-i+d,O=f-s+2*d,P=m-a+2*d,w=y-_+2*d,x=f-1+.5,C=m-1+.5,E=y-1+.5,T=255&c,j=255&p,A=255&l,N=this.perm[T+this.perm[j+this.perm[A]]]%12,M=this.perm[T+r+this.perm[j+o+this.perm[A+i]]]%12,k=this.perm[T+s+this.perm[j+a+this.perm[A+_]]]%12,S=this.perm[T+1+this.perm[j+1+this.perm[A+1]]]%12,R=.6-f*f-m*m-y*y,D=.6-v*v-g*g-b*b,I=.6-O*O-P*P-w*w,L=.6-x*x-C*C-E*E;return 32*((R<0?0:(R*=R)*R*this.dot3(this.grad3[N],f,m,y))+(D<0?0:(D*=D)*D*this.dot3(this.grad3[M],v,g,b))+(I<0?0:(I*=I)*I*this.dot3(this.grad3[k],O,P,w))+(L<0?0:(L*=L)*L*this.dot3(this.grad3[S],x,C,E)))},r.prototype.noise4d=function(e,t,n,r){var o,i,s,a,_,u,c,p,l,d,h,f,m=this.grad4,y=this.simplex,v=this.perm,g=(Math.sqrt(5)-1)/4,b=(5-Math.sqrt(5))/20,O=(e+t+n+r)*g,P=Math.floor(e+O),w=Math.floor(t+O),x=Math.floor(n+O),C=Math.floor(r+O),E=(P+w+x+C)*b,T=e-(P-E),j=t-(w-E),A=n-(x-E),N=r-(C-E),M=(T>j?32:0)+(T>A?16:0)+(j>A?8:0)+(T>N?4:0)+(j>N?2:0)+(A>N?1:0),k=T-(o=y[M][0]>=3?1:0)+b,S=j-(i=y[M][1]>=3?1:0)+b,R=A-(s=y[M][2]>=3?1:0)+b,D=N-(a=y[M][3]>=3?1:0)+b,I=T-(_=y[M][0]>=2?1:0)+2*b,L=j-(u=y[M][1]>=2?1:0)+2*b,B=A-(c=y[M][2]>=2?1:0)+2*b,G=N-(p=y[M][3]>=2?1:0)+2*b,z=T-(l=y[M][0]>=1?1:0)+3*b,F=j-(d=y[M][1]>=1?1:0)+3*b,V=A-(h=y[M][2]>=1?1:0)+3*b,U=N-(f=y[M][3]>=1?1:0)+3*b,Y=T-1+4*b,q=j-1+4*b,H=A-1+4*b,X=N-1+4*b,J=255&P,W=255&w,K=255&x,Z=255&C,Q=v[J+v[W+v[K+v[Z]]]]%32,$=v[J+o+v[W+i+v[K+s+v[Z+a]]]]%32,ee=v[J+_+v[W+u+v[K+c+v[Z+p]]]]%32,te=v[J+l+v[W+d+v[K+h+v[Z+f]]]]%32,ne=v[J+1+v[W+1+v[K+1+v[Z+1]]]]%32,re=.6-T*T-j*j-A*A-N*N,oe=.6-k*k-S*S-R*R-D*D,ie=.6-I*I-L*L-B*B-G*G,se=.6-z*z-F*F-V*V-U*U,ae=.6-Y*Y-q*q-H*H-X*X;return 27*((re<0?0:(re*=re)*re*this.dot4(m[Q],T,j,A,N))+(oe<0?0:(oe*=oe)*oe*this.dot4(m[$],k,S,R,D))+(ie<0?0:(ie*=ie)*ie*this.dot4(m[ee],I,L,B,G))+(se<0?0:(se*=se)*se*this.dot4(m[te],z,F,V,U))+(ae<0?0:(ae*=ae)*ae*this.dot4(m[ne],Y,q,H,X)))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=n(14),i=n(19),s=n(9),a=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.edit=s.ParamConfig.BOOLEAN(0),t.update_x=s.ParamConfig.BOOLEAN(0,{visible_if:{edit:1}}),t.x=s.ParamConfig.FLOAT("@N.x",{visible_if:{update_x:1,edit:1},expression:{for_entities:!0}}),t.update_y=s.ParamConfig.BOOLEAN(0,{visible_if:{edit:1}}),t.y=s.ParamConfig.FLOAT("@N.y",{visible_if:{update_y:1,edit:1},expression:{for_entities:!0}}),t.update_z=s.ParamConfig.BOOLEAN(0,{visible_if:{edit:1}}),t.z=s.ParamConfig.FLOAT("@N.z",{visible_if:{update_z:1,edit:1},expression:{for_entities:!0}}),t.recompute=s.ParamConfig.BOOLEAN(0,{visible_if:{edit:0}}),t.invert=s.ParamConfig.BOOLEAN(0),t}return r.__extends(t,e),t}(s.NodeParamsConfig)),_=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=a,t}return r.__extends(t,e),t.type=function(){return"normals"},t.displayed_input_names=function(){return["geometry to update normals of"]},t.prototype.initialize_node=function(){this.io.inputs.set_count(1),this.io.inputs.init_inputs_clonable_state([i.InputCloneMode.FROM_NODE])},t.prototype.cook=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t;return r.__generator(this,(function(n){switch(n.label){case 0:return t=e[0],this.pv.edit?[4,this._eval_expressions_for_core_group(t)]:[3,2];case 1:return n.sent(),[3,3];case 2:t.compute_vertex_normals(),n.label=3;case 3:return this.pv.invert&&this._invert_normals(t),this.set_core_group(t),[2]}}))}))},t.prototype._eval_expressions_for_core_group=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,n;return r.__generator(this,(function(r){switch(r.label){case 0:t=e.core_objects(),n=0,r.label=1;case 1:return n<t.length?[4,this._eval_expressions_for_core_object(t[n])]:[3,4];case 2:r.sent(),r.label=3;case 3:return n++,[3,1];case 4:return[2]}}))}))},t.prototype._eval_expressions_for_core_object=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,n,o,i,s,a;return r.__generator(this,(function(r){switch(r.label){case 0:return t=e.object(),n=t.geometry,o=e.points(),i=n.getAttribute("normal").array,this.pv.update_x?this.p.x.has_expression()&&this.p.x.expression_controller?[4,this.p.x.expression_controller.compute_expression_for_points(o,(function(e,t){i[3*e.index+0]=t}))]:[3,2]:[3,3];case 1:return r.sent(),[3,3];case 2:for(s=void 0,a=0;a<o.length;a++)s=o[a],i[3*s.index+0]=this.pv.x;r.label=3;case 3:return this.pv.update_y?this.p.y.has_expression()&&this.p.y.expression_controller?[4,this.p.y.expression_controller.compute_expression_for_points(o,(function(e,t){i[3*e.index+1]=t}))]:[3,5]:[3,6];case 4:return r.sent(),[3,6];case 5:for(s=void 0,a=0;a<o.length;a++)s=o[a],i[3*s.index+1]=this.pv.y;r.label=6;case 6:return this.pv.update_z?this.p.z.has_expression()&&this.p.z.expression_controller?[4,this.p.z.expression_controller.compute_expression_for_points(o,(function(e,t){i[3*e.index+2]=t}))]:[3,8]:[3,9];case 7:return r.sent(),[3,9];case 8:for(s=void 0,a=0;a<o.length;a++)s=o[a],i[3*s.index+2]=this.pv.z;r.label=9;case 9:return[2]}}))}))},t.prototype._invert_normals=function(e){for(var t=0,n=e.core_objects();t<n.length;t++){var r=n[t].core_geometry().geometry().attributes.normal;if(r)for(var o=r.array,i=0;i<o.length;i++)o[i]*=-1}},t}(o.TypedSopNode);t.NormalsSopNode=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=n(14),i=n(9),s=n(19),a=new(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t}(i.NodeParamsConfig)),_=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=a,t}return r.__extends(t,e),t.type=function(){return"null"},t.prototype.initialize_node=function(){this.io.inputs.set_count(0,1),this.io.inputs.init_inputs_clonable_state([s.InputCloneMode.FROM_NODE]),this.ui_data.set_border_radius(1e3)},t.prototype.cook=function(e){var t=e[0];t?this.set_core_group(t):this.set_objects([])},t}(o.TypedSopNode);t.NullSopNode=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=n(14),i=n(42),s=n(9),a=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.geometry=s.ParamConfig.OPERATOR_PATH("",{node_selection:{context:i.NodeContext.SOP}}),t}return r.__extends(t,e),t}(s.NodeParamsConfig)),_=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=a,t}return r.__extends(t,e),t.type=function(){return"object_merge"},t.prototype.initialize_node=function(){},t.prototype.cook=function(e){return r.__awaiter(this,void 0,void 0,(function(){var e,t;return r.__generator(this,(function(n){switch(n.label){case 0:return(e=this.p.geometry.found_node())?e.node_context()!=i.NodeContext.SOP?[3,2]:[4,e.request_container()]:[3,4];case 1:return t=n.sent(),this.import_input(e,t),[3,3];case 2:this.states.error.set("found node is not a geometry"),n.label=3;case 3:return[3,5];case 4:this.states.error.set("node not found at path '"+this.pv.geometry+"'"),n.label=5;case 5:return[2]}}))}))},t.prototype.import_input=function(e,t){var n;null!=(n=t.core_content_cloned())?this.set_core_group(n):this.states.error.set("invalid target")},t}(o.TypedSopNode);t.ObjectMergeSopNode=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o={Float32BufferAttribute:n(4).Float32BufferAttribute},i=n(14),s=r.__importDefault(n(674)),a=n(9),_=n(19),u=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.attrib_name=a.ParamConfig.STRING("occlusion"),t.samples=a.ParamConfig.INTEGER(256,{range:[1,256],range_locked:[!0,!1]}),t.sep=a.ParamConfig.SEPARATOR(),t.buffer_resolution=a.ParamConfig.INTEGER(512),t.bias=a.ParamConfig.FLOAT(.01),t}return r.__extends(t,e),t}(a.NodeParamsConfig)),c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=u,t}return r.__extends(t,e),t.type=function(){return"occlusion"},t.prototype.initialize_node=function(){this.io.inputs.set_count(1),this.io.inputs.init_inputs_clonable_state([_.InputCloneMode.FROM_NODE]),this.ui_data.set_icon("palette")},t.prototype.cook=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,n,o,i,s;return r.__generator(this,(function(r){switch(r.label){case 0:t=e[0],n=t.core_objects(),o=0,i=n,r.label=1;case 1:return o<i.length?(s=i[o],[4,this._process_occlusion_on_object(s)]):[3,4];case 2:r.sent(),r.label=3;case 3:return o++,[3,1];case 4:return this.set_core_group(t),[2]}}))}))},t.prototype._process_occlusion_on_object=function(e){var t;return r.__awaiter(this,void 0,void 0,(function(){var n,i,a,_,u,c,p;return r.__generator(this,(function(r){for(n=e.core_geometry().geometry(),i=n.attributes.position.array,a=n.attributes.normal.array,_=null===(t=n.getIndex())||void 0===t?void 0:t.array,u=s.default(i,{cells:_,normals:a,resolution:this.pv.buffer_resolution,bias:this.pv.bias}),c=0;c<this.pv.samples;c++)u.sample();return p=u.report(),n.setAttribute(this.pv.attrib_name,new o.Float32BufferAttribute(p,1)),u.dispose(),[2]}))}))},t}(i.TypedSopNode);t.OcclusionSopNode=c},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=n(43),i=n(14),s=n(19),a=n(9),_=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.amount=a.ParamConfig.FLOAT(1,{range:[-1,1]}),t}return r.__extends(t,e),t}(a.NodeParamsConfig)),u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=_,t}return r.__extends(t,e),t.type=function(){return"peak"},t.prototype.initialize_node=function(){this.io.inputs.set_count(1),this.io.inputs.init_inputs_clonable_state([s.InputCloneMode.FROM_NODE])},t.prototype.cook=function(e){for(var t,n,r=this,i=e[0],s=0,a=i.objects();s<a.length;s++){a[s].traverse((function(e){var i;if(null!=(i=e.geometry)){for(var s=0,a=(t=new o.CoreGeometry(i)).points();s<a.length;s++){var _=(n=a[s]).normal(),u=n.position().clone().add(_.multiplyScalar(r.pv.amount));n.set_position(u)}if(!r.io.inputs.input_cloned(0))t.geometry().getAttribute("position").needsUpdate=!0}}))}this.set_core_group(i)},t}(i.TypedSopNode);t.PeakSopNode=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=n(1),i=n(2),s=n(56),a=n(14),_=n(65),u=n(19),c=new o.Vector3(0,0,1),p=new o.Vector3(0,0,1),l=new o.Vector3(0,1,0),d=n(9),h=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.size=d.ParamConfig.VECTOR2([1,1]),t.use_segments_count=d.ParamConfig.BOOLEAN(0),t.step_size=d.ParamConfig.FLOAT(1,{visible_if:{use_segments_count:0}}),t.segments=d.ParamConfig.VECTOR2([1,1],{visible_if:{use_segments_count:1}}),t.direction=d.ParamConfig.VECTOR3([0,1,0]),t.center=d.ParamConfig.VECTOR3([0,0,0]),t}return r.__extends(t,e),t}(d.NodeParamsConfig)),f=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=h,t._core_transform=new _.CoreTransform,t}return r.__extends(t,e),t.type=function(){return"plane"},t.displayed_input_names=function(){return["geometry to create plane from (optional)"]},t.prototype.initialize_node=function(){this.io.inputs.set_count_to_one_max(),this.io.inputs.init_inputs_clonable_state([u.InputCloneMode.NEVER])},t.prototype.cook=function(e){var t=e[0];t?this._cook_with_input(t):this._cook_without_input()},t.prototype._cook_without_input=function(){var e=this._create_plane(this.pv.size);this._core_transform.rotate_geometry(e,c,this.pv.direction);var t=this._core_transform.translation_matrix(this.pv.center);e.applyMatrix(t),this.set_geometry(e)},t.prototype._cook_with_input=function(e){var t=e.bounding_box(),n=new o.Vector3;t.getSize(n);var r=new o.Vector3;t.getCenter(r);var s=new i.Vector2(n.x,n.z),a=this._create_plane(s);this._core_transform.rotate_geometry(a,p,l);var _=this._core_transform.translation_matrix(r);a.applyMatrix(_),this.set_geometry(a)},t.prototype._create_plane=function(e){var t;return e=e.clone(),this.pv.use_segments_count?t={x:Math.floor(this.pv.segments.x),y:Math.floor(this.pv.segments.y)}:(t={x:Math.floor(e.x/this.pv.step_size),y:Math.floor(e.y/this.pv.step_size)},e.x=t.x*this.pv.step_size,e.y=t.y*this.pv.step_size),new s.PlaneBufferGeometry(e.x,e.y,t.x,t.y)},t}(a.TypedSopNode);t.PlaneSopNode=f},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=n(14),i=n(19),s=n(9),a=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.update_x=s.ParamConfig.BOOLEAN(0),t.x=s.ParamConfig.FLOAT("@P.x",{visible_if:{update_x:1},expression:{for_entities:!0}}),t.update_y=s.ParamConfig.BOOLEAN(0),t.y=s.ParamConfig.FLOAT("@P.y",{visible_if:{update_y:1},expression:{for_entities:!0}}),t.update_z=s.ParamConfig.BOOLEAN(0),t.z=s.ParamConfig.FLOAT("@P.z",{visible_if:{update_z:1},expression:{for_entities:!0}}),t.update_normals=s.ParamConfig.BOOLEAN(1),t}return r.__extends(t,e),t}(s.NodeParamsConfig)),_=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=a,t._x_arrays_by_geometry_uuid=new Map,t._y_arrays_by_geometry_uuid=new Map,t._z_arrays_by_geometry_uuid=new Map,t}return r.__extends(t,e),t.type=function(){return"point"},t.displayed_input_names=function(){return["points to move"]},t.prototype.initialize_node=function(){this.io.inputs.set_count(1),this.io.inputs.init_inputs_clonable_state([i.InputCloneMode.FROM_NODE]),this.ui_data.set_icon("dot-circle")},t.prototype.cook=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t;return r.__generator(this,(function(n){switch(n.label){case 0:return t=e[0],[4,this._eval_expressions_for_core_group(t)];case 1:return n.sent(),[2]}}))}))},t.prototype._eval_expressions_for_core_group=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,n,o,i,s,a,_,u,c;return r.__generator(this,(function(r){switch(r.label){case 0:t=e.core_objects(),n=0,r.label=1;case 1:return n<t.length?[4,this._eval_expressions_for_core_object(t[n])]:[3,4];case 2:r.sent(),r.label=3;case 3:return n++,[3,1];case 4:for(this.pv.update_normals&&e.compute_vertex_normals(),o=e.geometries(),i=0,s=o;i<s.length;i++)(c=s[i]).computeBoundingBox();if(!this.io.inputs.input_cloned(0))for(a=e.geometries(),_=0,u=a;_<u.length;_++)c=u[_],c.getAttribute("position").needsUpdate=!0;return this.set_core_group(e),[2]}}))}))},t.prototype._eval_expressions_for_core_object=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,n,o,i,s,a,_;return r.__generator(this,(function(r){switch(r.label){case 0:return t=e.object(),n=t.geometry,o=e.points(),i=n.getAttribute("position").array,[4,this._update_from_param(n,i,o,this.p.update_x,this.p.x,this.pv.x,this._x_arrays_by_geometry_uuid,0)];case 1:return s=r.sent(),[4,this._update_from_param(n,i,o,this.p.update_y,this.p.y,this.pv.y,this._y_arrays_by_geometry_uuid,1)];case 2:return a=r.sent(),[4,this._update_from_param(n,i,o,this.p.update_z,this.p.z,this.pv.z,this._z_arrays_by_geometry_uuid,2)];case 3:return _=r.sent(),s&&this._commit_tmp_values(s,i,0),a&&this._commit_tmp_values(a,i,1),_&&this._commit_tmp_values(_,i,2),[2]}}))}))},t.prototype._update_from_param=function(e,t,n,o,i,s,a,_){return r.__awaiter(this,void 0,void 0,(function(){var t,u,c,p,l;return r.__generator(this,(function(r){switch(r.label){case 0:return t=o,u=i,c=this._init_array_if_required(e,a,n.length,_),t.value?u.has_expression()&&u.expression_controller?[4,u.expression_controller.compute_expression_for_points(n,(function(e,t){c[e.index]=t}))]:[3,2]:[3,3];case 1:return r.sent(),[3,3];case 2:for(p=void 0,l=0;l<n.length;l++)p=n[l],c[p.index]=s;r.label=3;case 3:return[2,c]}}))}))},t.prototype._init_array_if_required=function(e,t,n,r){var o=e.uuid,i=t.get(o);if(i){if(i.length<n){var s=this._array_for_component(e,n,r);return t.set(o,s),s}return i}s=this._array_for_component(e,n,r);return t.set(o,s),s},t.prototype._array_for_component=function(e,t,n){for(var r=new Array(t),o=e.getAttribute("position").array,i=0;i<r.length;i++)r[i]=o[3*i+n];return r},t.prototype._commit_tmp_values=function(e,t,n){for(var r=0;r<e.length;r++)t[3*r+n]=e[r]},t}(o.TypedSopNode);t.PointSopNode=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=n(14),i=n(43),s=n(65),a=n(299),_=n(221),u=n(329),c=n(1),p=n(66),l=n(5),d=n(19),h=new c.Vector3(0,0,0),f=new c.Vector3(1,1,1),m=n(9),y=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.radius=m.ParamConfig.FLOAT(1),t.segments_radial=m.ParamConfig.INTEGER(8,{range:[3,20],range_locked:[!0,!1]}),t.closed=m.ParamConfig.BOOLEAN(0),t}return r.__extends(t,e),t}(m.NodeParamsConfig)),v=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=y,t._core_transform=new s.CoreTransform,t._geometries=[],t}return r.__extends(t,e),t.type=function(){return"polywire"},t.displayed_input_names=function(){return["lines to create tubes from"]},t.prototype.initialize_node=function(){this.io.inputs.set_count(1),this.io.inputs.init_inputs_clonable_state([d.InputCloneMode.NEVER])},t.prototype.cook=function(e){var t=e[0];this._geometries=[];for(var n=0,r=t.objects();n<r.length;n++){(_=r[n])instanceof p.LineSegments&&this._create_tube(_)}for(var o=i.CoreGeometry.merge_geometries(this._geometries),s=0,a=this._geometries;s<a.length;s++){a[s].dispose()}if(o){var _=this.create_object(o);this.set_object(_)}else this.set_objects([])},t.prototype._create_tube=function(e){for(var t,n=e.geometry,r=new i.CoreGeometry(n).points(),o=null===(t=n.getIndex())||void 0===t?void 0:t.array,s=0,a=_.CoreGeometryUtilCurve.accumulated_curve_point_indices(o);s<a.length;s++){var u=a[s].map((function(e){return r[e]}));this._create_tube_from_points(u)}},t.prototype._create_tube_from_points=function(e){if(!(e.length<=1)){for(var t=e.map((function(e){return e.attrib_value("position")})),n=a.CoreGeometryUtilCircle.create(this.pv.radius,this.pv.segments_radial),r=[],o=0,i=t;o<i.length;o++){var s=i[o],_=this._core_transform.matrix(s,h,f,1),u=n.clone();u.applyMatrix(_),r.push(u)}for(var c=0;c<r.length;c++)if(c>0){var p=r[c],l=r[c-1],d=this._skin(l,p);this._geometries.push(d)}}},t.prototype._skin=function(e,t){var n=new l.BufferGeometry;return new u.CoreGeometryOperationSkin(n,e,t).process(),n},t}(o.TypedSopNode);t.PolywireSopNode=v},,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=n(291),i=n(50),s=n(0),a=n(14),_=n(19),u=new i.MeshBasicMaterial({side:s.DoubleSide}),c=n(9),p=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.use_normals=c.ParamConfig.BOOLEAN(1),t.direction=c.ParamConfig.VECTOR3([0,-1,0],{visible_if:{use_normals:0}}),t.transfer_face_normals=c.ParamConfig.BOOLEAN(1),t}return r.__extends(t,e),t}(c.NodeParamsConfig)),l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=p,t._bound_assign_mat=t._assign_double_sided_material_to_object.bind(t),t._raycaster=new o.Raycaster,t}return r.__extends(t,e),t.type=function(){return"ray"},t.double_sided_material=function(){return u},t.displayed_input_names=function(){return["geometry to move","geometry to ray onto"]},t.prototype.initialize_node=function(){this.io.inputs.set_count(2),this.io.inputs.init_inputs_clonable_state([_.InputCloneMode.FROM_NODE,_.InputCloneMode.ALWAYS])},t.prototype.create_params=function(){},t.prototype.cook=function(e){var t=e[0],n=e[1];this.ray(t,n)},t.prototype.ray=function(e,t){var n,r;this._assign_double_sided_material_to_core_group(t);for(var o=0,i=e.points();o<i.length;o++){var s=i[o];n=this.pv.use_normals?s.normal():this.pv.direction,this._raycaster.set(s.position(),n),(r=this._raycaster.intersectObjects(t.objects(),!0)[0])&&(s.set_position(r.point),this.pv.transfer_face_normals&&r.face&&s.set_normal(r.face.normal))}this.set_core_group(e)},t.prototype._assign_double_sided_material_to_core_group=function(e){for(var t=0,n=e.objects();t<n.length;t++){n[t].traverse(this._bound_assign_mat)}},t.prototype._assign_double_sided_material_to_object=function(e){e.material=t.double_sided_material()},t}(a.TypedSopNode);t.RaySopNode=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,o,i=n(3),s=n(66),a=n(4),_=n(5),u=n(217),c=n(215),p=i.__importDefault(n(74)),l=i.__importDefault(n(261)),d=n(14),h=n(26),f=n(221),m=n(43);!function(e){e.POINTS_COUNT="points_count",e.SEGMENT_LENGTH="segment_length"}(r=t.METHOD||(t.METHOD={})),t.METHODS=[r.POINTS_COUNT,r.SEGMENT_LENGTH],function(e){e.CENTRIPETAL="centripetal",e.CHORDAL="chordal",e.CATMULLROM="catmullrom"}(o=t.CURVE_TYPE||(t.CURVE_TYPE={})),t.CURVE_TYPES=[o.CENTRIPETAL,o.CHORDAL,o.CATMULLROM];var y=n(9),v=n(211),g=new(function(e){function n(){var n=null!==e&&e.apply(this,arguments)||this;return n.method=y.ParamConfig.INTEGER(t.METHODS.indexOf(r.POINTS_COUNT),{menu:{entries:t.METHODS.map((function(e,t){return{name:e,value:t}}))}}),n.curve_type=y.ParamConfig.INTEGER(t.CURVE_TYPES.indexOf(o.CATMULLROM),{range:[0,2],range_locked:[!0,!0],menu:{entries:t.CURVE_TYPES.map((function(e,t){return{name:e,value:t}}))}}),n.tension=y.ParamConfig.FLOAT(.01,{range:[0,1],range_locked:[!0,!0]}),n.points_count=y.ParamConfig.INTEGER(100,{visible_if:{method:t.METHODS.indexOf(r.POINTS_COUNT)}}),n.segment_length=y.ParamConfig.FLOAT(1,{visible_if:{method:t.METHODS.indexOf(r.SEGMENT_LENGTH)}}),n}return i.__extends(n,e),n}(y.NodeParamsConfig)),b=function(e){function n(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=g,t}return i.__extends(n,e),n.type=function(){return"resample"},n.prototype.initialize_node=function(){this.io.inputs.set_count(1)},n.prototype.cook=function(e){var t=e[0],n=[];if(this.pv.points_count>=2)for(var r=t.core_objects(),o=0;o<r.length;o++){var i=r[o].object();if(i instanceof s.LineSegments){var a=this._resample(i);n.push(a)}}this.set_objects(n)},n.prototype._resample=function(e){for(var t,n=e.geometry,r=new m.CoreGeometry(n).points(),o=null===(t=n.getIndex())||void 0===t?void 0:t.array,i=f.CoreGeometryUtilCurve.accumulated_curve_point_indices(o),s=[],a=0;a<i.length;a++){var _=i[a].map((function(e){return r[e]})),u=this._create_curve_from_points(_);u&&s.push(u)}var p=c.BufferGeometryUtils.mergeBufferGeometries(s);return this.create_object(p,h.CoreConstant.OBJECT_TYPE.LINE_SEGMENTS)},n.prototype._create_curve_from_points=function(e){if(!(e.length<=1)){for(var n=l.default(e,(function(e){return e.attrib_value("position")})),r=t.CURVE_TYPES[this.pv.curve_type],o=this.pv.tension,i=new u.CatmullRomCurve3(n,!1,r,o),s=this._get_points_from_curve(i),c=[],d=[],h=0;h<s.length;h++){var f=s[h].toArray();c.push(f),h>0&&(d.push(h-1),d.push(h))}c=p.default(c);var m=new _.BufferGeometry;return m.setAttribute("position",new a.Float32BufferAttribute(c,3)),m.setIndex(d),m}},n.prototype._get_points_from_curve=function(e){var n=t.METHODS[this.pv.method];switch(n){case r.POINTS_COUNT:return e.getSpacedPoints(Math.max(2,this.pv.points_count));case r.SEGMENT_LENGTH:var o=e.getLength(),i=0!==this.pv.segment_length?1+o/this.pv.segment_length:2;return i=Math.max(2,i),e.getSpacedPoints(i)}v.TypeAssert.unreachable(n)},n}(d.TypedSopNode);t.ResampleSopNode=b},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=n(5),i={BufferAttribute:n(4).BufferAttribute,BufferGeometry:o.BufferGeometry},s=r.__importDefault(n(82)),a=r.__importDefault(n(41)),_=r.__importDefault(n(93)),u=n(14),c=n(26),p=n(104),l=n(298),d=n(9),h=n(19),f=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.points_count=d.ParamConfig.INTEGER(100,{range:[0,100],range_locked:[!0,!1]}),t.seed=d.ParamConfig.INTEGER(0,{range:[0,100],range_locked:[!1,!1]}),t.transfer_attributes=d.ParamConfig.BOOLEAN(0),t.attributes_to_transfer=d.ParamConfig.STRING("normal",{visible_if:{transfer_attributes:1}}),t.add_id_attribute=d.ParamConfig.BOOLEAN(1),t}return r.__extends(t,e),t}(d.NodeParamsConfig)),m=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=f,t}return r.__extends(t,e),t.type=function(){return"scatter"},t.displayed_input_names=function(){return["geometry to scatter points onto"]},t.prototype.initialize_node=function(){this.io.inputs.set_count(1),this.io.inputs.init_inputs_clonable_state([h.InputCloneMode.NEVER])},t.prototype.cook=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,n,o,u,d,h,f,m,y,v,g,b,O,P,w,x,C,E,T,j,A,N,M,k,S=this;return r.__generator(this,(function(r){switch(r.label){case 0:for(t=e[0],n=t.faces(),o=[],u=0,d=new Map,h=0,f=n;h<f.length;h++)O=f[h],m=O.area,d.set(O.index,m);for(y=_.default(n,(function(e){return d.get(e.index)})),v=0,g=0,b=y;g<b.length;g++)O=b[g],u+=d.get(O.index),o[v]=u,v++;for(P=[],w=[],this.pv.transfer_attributes&&(w=t.attrib_names_matching_mask(this.pv.attributes_to_transfer)),x=new Map,C=new Map,E=0,T=w;E<T.length;E++)M=T[E],x.set(M,[]),C.set(M,t.attrib_size(M));return[4,(new l.CoreIterator).start_with_count(this.pv.points_count,(function(e){for(var t=p.CoreMath.rand_float(S.pv.seed+e)*u,n=0;n<o.length;n++){if(t<=o[n]){var r=y[n],i=r.random_position(t);i.toArray(P,P.length);for(var s=0,_=w;s<_.length;s++){var c=_[s],l=r.attrib_value_at_position(c,i);a.default(l)?x.get(c).push(l):l.toArray(x.get(c),x.get(c).length)}break}}}))];case 1:for(r.sent(),(j=new i.BufferGeometry).setAttribute("position",new i.BufferAttribute(new Float32Array(P),3)),A=0,N=w;A<N.length;A++)M=N[A],j.setAttribute(M,new i.BufferAttribute(new Float32Array(x.get(M)),C.get(M)));return this.pv.add_id_attribute&&(k=s.default(this.pv.points_count),j.setAttribute("id",new i.BufferAttribute(new Float32Array(k),1))),this.set_geometry(j,c.CoreConstant.OBJECT_TYPE.POINTS),[2]}}))}))},t}(u.TypedSopNode);t.ScatterSopNode=m},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=n(14),i=n(19),s=n(9),a=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.cast_shadow=s.ParamConfig.BOOLEAN(1),t.receive_shadow=s.ParamConfig.BOOLEAN(1),t.apply_to_children=s.ParamConfig.BOOLEAN(0),t}return r.__extends(t,e),t}(s.NodeParamsConfig)),_=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=a,t}return r.__extends(t,e),t.type=function(){return"shadows"},t.displayed_input_names=function(){return["objects to change shadows properties of"]},t.prototype.initialize_node=function(){this.io.inputs.set_count(1),this.io.inputs.init_inputs_clonable_state([i.InputCloneMode.FROM_NODE])},t.prototype.cook=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,n,o,i,s=this;return r.__generator(this,(function(r){for(t=e[0],n=0,o=t.objects();n<o.length;n++)i=o[n],this.pv.apply_to_children?i.traverse((function(e){e.castShadow=s.pv.cast_shadow,e.receiveShadow=s.pv.receive_shadow})):(i.castShadow=this.pv.cast_shadow,i.receiveShadow=this.pv.receive_shadow);return console.log(t.objects()),this.set_core_group(t),[2]}))}))},t}(o.TypedSopNode);t.ShadowsSopNode=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=n(5),i=r.__importDefault(n(93)),s=r.__importDefault(n(778)),a=r.__importDefault(n(91)),_=n(14),u=n(221),c=n(329),p=new(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t}(n(9).NodeParamsConfig)),l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=p,t}return r.__extends(t,e),t.type=function(){return"skin"},t.displayed_input_names=function(){return["lines to create polygons from","if used, lines from both inputs will be used"]},t.prototype.initialize_node=function(){this.io.inputs.set_count(1,2)},t.prototype.cook=function(e){switch(a.default(this.io.inputs.inputs()).length){case 1:return this.process_one_input(e);case 2:return this.process_two_inputs(e);default:return this.states.error.set("inputs count not valid")}},t.prototype.process_one_input=function(e){var t=this,n=e[0],r=this._get_line_segments(n),o=[];if(r){var i=r[0];if(i){var s=u.CoreGeometryUtilCurve.line_segment_to_geometries(i.geometry);s.forEach((function(e,n){if(n>0){var r=s[n-1],i=t._skin(r,e);o.push(i)}}))}}this.set_geometries(o)},t.prototype.process_two_inputs=function(e){var t=this,n=e[0],r=e[1],o=this._get_line_segments(n),a=this._get_line_segments(r),_=s.default(i.default([o,a],(function(e){return e.length}))),u=_[0],c=_[1],p=[];u.forEach((function(e,n){var r=c[n];if(null!=e&&null!=r){var o=e.geometry,i=r.geometry,s=t._skin(o,i);p.push(s)}})),this.set_geometries(p)},t.prototype._get_line_segments=function(e){return e.objects().filter((function(e){return e.isLineSegments}))},t.prototype._skin=function(e,t){var n=new o.BufferGeometry;return new c.CoreGeometryOperationSkin(n,e,t).process(),n},t}(_.TypedSopNode);t.SkinSopNode=l},,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,o=n(3),i=n(155),s=n(151),a=n(14);!function(e){e.DEFAULT="default",e.ISOCAHEDRON="isocahedron"}(r||(r={}));var _={default:0,isocahedron:1},u=[r.DEFAULT,r.ISOCAHEDRON],c=n(9),p=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.type=c.ParamConfig.INTEGER(_.default,{menu:{entries:u.map((function(e){return{name:e,value:_[e]}}))}}),t.radius=c.ParamConfig.FLOAT(1,{visible_if:{type:_.default}}),t.resolution=c.ParamConfig.VECTOR2([8,6],{visible_if:{type:_.default}}),t.open=c.ParamConfig.BOOLEAN(0,{visible_if:{type:_.default}}),t.angle_range_x=c.ParamConfig.VECTOR2([0,"$PI*2"],{visible_if:{type:_.default,open:!0}}),t.angle_range_y=c.ParamConfig.VECTOR2([0,"$PI*2"],{visible_if:{type:_.default,open:!0}}),t.detail=c.ParamConfig.INTEGER(1,{range:[0,5],range_locked:[!0,!1],visible_if:{type:_.isocahedron}}),t.center=c.ParamConfig.VECTOR3([0,0,0]),t}return o.__extends(t,e),t}(c.NodeParamsConfig)),l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=p,t}return o.__extends(t,e),t.type=function(){return"sphere"},t.prototype.cook=function(){var e;(e=this.pv.type==_.default?this._create_default_sphere():this._create_default_isocahedron()).translate(this.pv.center.x,this.pv.center.y,this.pv.center.z),this.set_geometry(e)},t.prototype._create_default_sphere=function(){return this.pv.open?new i.SphereBufferGeometry(this.pv.radius,this.pv.resolution.x,this.pv.resolution.y,this.pv.angle_range_x.x,this.pv.angle_range_x.y,this.pv.angle_range_y.x,this.pv.angle_range_y.y):new i.SphereBufferGeometry(this.pv.radius,this.pv.resolution.x,this.pv.resolution.y)},t.prototype._create_default_isocahedron=function(){return new s.IcosahedronBufferGeometry(this.pv.radius,this.pv.detail)},t}(a.TypedSopNode);t.SphereSopNode=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=n(14),i="geometry to switch to",s=n(9),a=n(19),_=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.input=s.ParamConfig.INTEGER(0,{range:[0,3],range_locked:[!0,!0]}),t}return r.__extends(t,e),t}(s.NodeParamsConfig)),u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=_,t}return r.__extends(t,e),t.type=function(){return"switch"},t.displayed_input_names=function(){return[i,i,i,i]},t.prototype.initialize_node=function(){this.io.inputs.set_count(0,4),this.io.inputs.init_inputs_clonable_state([a.InputCloneMode.NEVER,a.InputCloneMode.NEVER,a.InputCloneMode.NEVER,a.InputCloneMode.NEVER]),this.ui_data.set_width(100),this.ui_data.set_icon("code-branch"),this.cook_controller.disallow_inputs_evaluation()},t.prototype.cook=function(){return r.__awaiter(this,void 0,void 0,(function(){var e;return r.__generator(this,(function(t){switch(t.label){case 0:return this.io.inputs.has_input(this.pv.input)?[4,this.container_controller.request_input_container(this.pv.input)]:[3,2];case 1:return e=t.sent(),this.set_core_group(e.core_content()),[3,3];case 2:this.states.error.set("no input "+this.pv.input),t.label=3;case 3:return[2]}}))}))},t}(o.TypedSopNode);t.SwitchSopNode=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,o=n(3),i=o.__importDefault(n(82)),s=n(14),a=n(26),_=n(154),u=n(5),c=n(156),p=n(795),l=n(4),d=n(215),h=n(790);!function(e){e.MESH="mesh",e.FLAT="flat",e.LINE="line",e.STROKE="stroke"}(r=t.TEXT_TYPE||(t.TEXT_TYPE={})),t.TEXT_TYPES=[r.MESH,r.FLAT,r.LINE,r.STROKE];var f=n(9),m=new(function(e){function n(){var n=null!==e&&e.apply(this,arguments)||this;return n.font=f.ParamConfig.STRING(""),n.text=f.ParamConfig.STRING("polygonjs",{multiline:!0}),n.type=f.ParamConfig.INTEGER(0,{menu:{entries:t.TEXT_TYPES.map((function(e,t){return{name:e,value:t}}))}}),n.size=f.ParamConfig.FLOAT(1,{range:[0,1],range_locked:[!0,!1]}),n.extrude=f.ParamConfig.FLOAT(.1,{visible_if:{type:t.TEXT_TYPES.indexOf(r.MESH)}}),n.segments=f.ParamConfig.INTEGER(1,{range:[1,20],range_locked:[!0,!1],visible_if:{type:t.TEXT_TYPES.indexOf(r.MESH)}}),n.stroke_width=f.ParamConfig.FLOAT(.02,{visible_if:{type:t.TEXT_TYPES.indexOf(r.STROKE)}}),n}return o.__extends(n,e),n}(f.NodeParamsConfig)),y=function(e){function s(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=m,t._font_loader=new p.FontLoader,t._loaded_fonts={},t}return o.__extends(s,e),s.type=function(){return"text"},s.prototype.initialize_node=function(){},s.prototype.cook=function(){return o.__awaiter(this,void 0,void 0,(function(){var e,n,i,s;return o.__generator(this,(function(o){switch(o.label){case 0:return o.trys.push([0,3,,4]),e=this._loaded_fonts,n=this.pv.font,(i=this._loaded_fonts[this.pv.font])?[3,2]:[4,this._load_url(this.pv.font)];case 1:i=o.sent(),o.label=2;case 2:return e[n]=i,[3,4];case 3:return o.sent(),this.states.error.set("count not load font ("+this.pv.font+")"),[2];case 4:if(s=this._loaded_fonts[this.pv.font])switch(t.TEXT_TYPES[this.pv.type]){case r.MESH:return[2,this._create_geometry_from_type_mesh(s)];case r.FLAT:return[2,this._create_geometry_from_type_flat(s)];case r.LINE:return[2,this._create_geometry_from_type_line(s)];case r.STROKE:return[2,this._create_geometry_from_type_stroke(s)];default:console.warn("type is not valid")}return[2]}}))}))},s.prototype._create_geometry_from_type_mesh=function(e){var t=this.displayed_text(),n={font:e,size:this.pv.size,height:this.pv.extrude,curveSegments:this.pv.segments};try{var r=new _.TextBufferGeometry(t,n);if(!r.index){var o=r.getAttribute("position").array;r.setIndex(i.default(o.length/3))}this.set_geometry(r)}catch(e){this.states.error.set("failed to generate geometry. Try to remove some characters")}},s.prototype._create_geometry_from_type_flat=function(e){var t=this._get_shapes(e);if(t){var n=new c.ShapeBufferGeometry(t);this.set_geometry(n)}},s.prototype._create_geometry_from_type_line=function(e){var t=this.shapes_from_font(e);if(t){for(var n=[],r=[],o=0,i=0;i<t.length;i++)for(var s=t[i].getPoints(),_=0;_<s.length;_++){var c=s[_];n.push(c.x),n.push(c.y),n.push(0),r.push(o),_>0&&_<s.length-1&&r.push(o),o+=1}var p=new u.BufferGeometry;p.setAttribute("position",new l.Float32BufferAttribute(n,3)),p.setIndex(r),this.set_geometry(p,a.CoreConstant.OBJECT_TYPE.LINE_SEGMENTS)}},s.prototype._create_geometry_from_type_stroke=function(e){return o.__awaiter(this,void 0,void 0,(function(){var t,n,r,i,s,a,_,u,c,p;return o.__generator(this,(function(o){switch(o.label){case 0:return(t=this.shapes_from_font(e))?(n=this,(r=this._svg_loader)?[3,2]:[4,this._load_svg_loader()]):[3,3];case 1:r=o.sent(),o.label=2;case 2:for(n._svg_loader=r,i=this._svg_loader.getStrokeStyle(this.pv.stroke_width,"white","miter","butt",4),s=[],a=0;a<t.length;a++)_=t[a],u=_.getPoints(),12,.001,c=this._svg_loader.pointsToStroke(u,i,12,.001),s.push(c);p=d.BufferGeometryUtils.mergeBufferGeometries(s),this.set_geometry(p),o.label=3;case 3:return[2]}}))}))},s.prototype.shapes_from_font=function(e){var t=this._get_shapes(e);if(t){for(var n=[],r=0;r<t.length;r++){var o=t[r];if(o.holes&&o.holes.length>0)for(var i=0;i<o.holes.length;i++){var s=o.holes[i];n.push(s)}}return t.push.apply(t,n),t}},s.prototype._get_shapes=function(e){var t=this.displayed_text();try{return e.generateShapes(t,this.pv.size)}catch(e){this.states.error.set("failed to generate geometry. Try to remove some characters")}},s.prototype.displayed_text=function(){return this.pv.text||""},s.prototype._load_url=function(e){""===e&&(e="/fonts/droid_sans_regular.typeface.json");var t=e.split("?")[0].split("."),n=t[t.length-1];switch(e=e+"?"+Date.now(),n){case"ttf":return this._load_ttf(e);case"json":return this._load_json(e);default:return null}},s.prototype._load_ttf=function(e){var t=this;return new Promise((function(n,r){return o.__awaiter(t,void 0,void 0,(function(){var t,i,s=this;return o.__generator(this,(function(o){switch(o.label){case 0:return t=this,(i=this._ttf_loader)?[3,2]:[4,this._load_ttf_loader()];case 1:i=o.sent(),o.label=2;case 2:return t._ttf_loader=i,window.opentype=h,this._ttf_loader.load(e,(function(e){var t=s._font_loader.parse(e);n(t)}),void 0,(function(){r()})),[2]}}))}))}))},s.prototype._load_json=function(e){var t=this;return new Promise((function(n,r){t._font_loader.load(e,(function(e){n(e)}),void 0,(function(){r()}))}))},s.prototype._load_ttf_loader=function(){return o.__awaiter(this,void 0,void 0,(function(){var e;return o.__generator(this,(function(t){switch(t.label){case 0:return[4,Promise.resolve().then((function(){return o.__importStar(n(783))}))];case 1:return e=t.sent().TTFLoader,[2,new e]}}))}))},s.prototype._load_svg_loader=function(){return o.__awaiter(this,void 0,void 0,(function(){return o.__generator(this,(function(e){switch(e.label){case 0:return[4,Promise.resolve().then((function(){return o.__importStar(n(784))}))];case 1:return[2,e.sent().SVGLoader]}}))}))},s}(s.TypedSopNode);t.TextSopNode=y},,function(e,t,n){"use strict";n.r(t),n.d(t,"TTFLoader",(function(){return i}));var r=n(27),o=n(18),i=function(e){o.a.call(this,e),this.reversed=!1};i.prototype=Object.assign(Object.create(o.a.prototype),{constructor:i,load:function(e,t,n,o){var i=this,s=new r.a(this.manager);s.setPath(this.path),s.setResponseType("arraybuffer"),s.load(e,(function(e){t(i.parse(e))}),n,o)},parse:function(e){function t(e){var t,n=[];e.forEach((function(e){"m"===e.type.toLowerCase()?(t=[e],n.push(t)):"z"!==e.type.toLowerCase()&&t.push(e)}));var r=[];return n.forEach((function(e){var t={type:"m",x:e[e.length-1].x,y:e[e.length-1].y};r.push(t);for(var n=e.length-1;n>0;n--){var o=e[n];t={type:o.type};void 0!==o.x2&&void 0!==o.y2?(t.x1=o.x2,t.y1=o.y2,t.x2=o.x1,t.y2=o.y1):void 0!==o.x1&&void 0!==o.y1&&(t.x1=o.x1,t.y1=o.y1),t.x=e[n-1].x,t.y=e[n-1].y,r.push(t)}})),r}return"undefined"==typeof opentype?(console.warn("THREE.TTFLoader: The loader requires opentype.js. Make sure it's included before using the loader."),null):function(e,n){for(var r=Math.round,o={},i=1e5/(72*(e.unitsPerEm||2048)),s=e.encoding.cmap.glyphIndexMap,a=Object.keys(s),_=0;_<a.length;_++){var u=a[_],c=e.glyphs.glyphs[s[u]];if(void 0!==u){var p={ha:r(c.advanceWidth*i),x_min:r(c.xMin*i),x_max:r(c.xMax*i),o:""};n&&(c.path.commands=t(c.path.commands)),c.path.commands.forEach((function(e){"c"===e.type.toLowerCase()&&(e.type="b"),p.o+=e.type.toLowerCase()+" ",void 0!==e.x&&void 0!==e.y&&(p.o+=r(e.x*i)+" "+r(e.y*i)+" "),void 0!==e.x1&&void 0!==e.y1&&(p.o+=r(e.x1*i)+" "+r(e.y1*i)+" "),void 0!==e.x2&&void 0!==e.y2&&(p.o+=r(e.x2*i)+" "+r(e.y2*i)+" ")})),o[String.fromCodePoint(c.unicode)]=p}}return{glyphs:o,familyName:e.getEnglishName("fullName"),ascender:r(e.ascender*i),descender:r(e.descender*i),underlinePosition:e.tables.post.underlinePosition,underlineThickness:e.tables.post.underlineThickness,boundingBox:{xMin:e.tables.head.xMin,xMax:e.tables.head.xMax,yMin:e.tables.head.yMin,yMax:e.tables.head.yMax},resolution:1e3,original_font_information:e.tables.name}}(opentype.parse(e),this.reversed)}})},,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=n(153),i=n(14),s=n(9),a=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.radius=s.ParamConfig.FLOAT(1,{range:[0,1]}),t.radius_tube=s.ParamConfig.FLOAT(1,{range:[0,1]}),t.segments_radial=s.ParamConfig.INTEGER(20,{range:[1,50],range_locked:[!0,!1]}),t.segments_tube=s.ParamConfig.INTEGER(12,{range:[1,50],range_locked:[!0,!1]}),t}return r.__extends(t,e),t}(s.NodeParamsConfig)),_=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=a,t}return r.__extends(t,e),t.type=function(){return"torus"},t.prototype.initialize_node=function(){},t.prototype.cook=function(){var e=this.pv.radius,t=this.pv.radius_tube,n=this.pv.segments_radial,r=this.pv.segments_tube,i=new o.TorusBufferGeometry(e,t,n,r);this.set_geometry(i)},t}(i.TypedSopNode);t.TorusSopNode=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o={TorusKnotBufferGeometry:n(152).TorusKnotBufferGeometry},i=n(14),s=n(9),a=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.radius=s.ParamConfig.FLOAT(1),t.radius_tube=s.ParamConfig.FLOAT(1),t.segments_radial=s.ParamConfig.INTEGER(64,{range:[1,128]}),t.segments_tube=s.ParamConfig.INTEGER(8,{range:[1,32]}),t.p=s.ParamConfig.INTEGER(2,{range:[1,10]}),t.q=s.ParamConfig.INTEGER(3,{range:[1,10]}),t}return r.__extends(t,e),t}(s.NodeParamsConfig)),_=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=a,t}return r.__extends(t,e),t.type=function(){return"torus_knot"},t.prototype.initialize_node=function(){},t.prototype.cook=function(){var e=this.pv.radius,t=this.pv.radius_tube,n=this.pv.segments_radial,r=this.pv.segments_tube,i=this.pv.p,s=this.pv.q,a=new o.TorusKnotBufferGeometry(e,t,n,r,i,s);this.set_geometry(a)},t}(i.TypedSopNode);t.TorusKnotSopNode=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=n(14),i=n(292),s=n(65),a=n(19),_=n(9),u=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.group=_.ParamConfig.STRING(""),t.t=_.ParamConfig.VECTOR3([0,0,0]),t.r=_.ParamConfig.VECTOR3([0,0,0]),t.s=_.ParamConfig.VECTOR3([1,1,1]),t.scale=_.ParamConfig.FLOAT(1),t.look_at=_.ParamConfig.OPERATOR_PATH(""),t.up=_.ParamConfig.VECTOR3([0,1,0]),t.pivot=_.ParamConfig.VECTOR3([0,0,0]),t}return r.__extends(t,e),t}(_.NodeParamsConfig)),c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=u,t._core_transform=new s.CoreTransform,t}return r.__extends(t,e),t.type=function(){return"transform"},t.displayed_input_names=function(){return["geometry to transform"]},t.prototype.initialize_node=function(){this.io.inputs.set_count(1),this.io.inputs.init_inputs_clonable_state([a.InputCloneMode.FROM_NODE])},t.prototype.cook=function(e){var t=e[0].objects(),n=this._core_transform.matrix(this.pv.t,this.pv.r,this.pv.s,this.pv.scale);if(""===this.pv.group)for(var r=0,o=t;r<o.length;r++){var s=o[r],a=void 0;null!=(a=s.geometry)?(a.translate(-this.pv.pivot.x,-this.pv.pivot.y,-this.pv.pivot.z),a.applyMatrix(n),a.translate(this.pv.pivot.x,this.pv.pivot.y,this.pv.pivot.z)):s.applyMatrix(n)}else for(var _=0,u=i.CoreGroup.from_objects(t).points_from_group(this.pv.group);_<u.length;_++){var c=u[_],p=c.position().sub(this.pv.pivot);p.applyMatrix4(n),c.set_position(p.add(this.pv.pivot))}this.set_objects(t)},t}(o.TypedSopNode);t.TransformSopNode=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=n(14),i=n(1),s=n(67),a=n(65),_=new i.Vector3(0,1,0),u=n(9),c=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.radius=u.ParamConfig.FLOAT(1,{range:[0,1]}),t.height=u.ParamConfig.FLOAT(1,{range:[0,1]}),t.segments_radial=u.ParamConfig.INTEGER(12,{range:[3,20],range_locked:[!0,!1]}),t.segments_height=u.ParamConfig.INTEGER(1,{range:[1,20],range_locked:[!0,!1]}),t.cap=u.ParamConfig.BOOLEAN(1),t.center=u.ParamConfig.VECTOR3([0,0,0]),t.direction=u.ParamConfig.VECTOR3([0,0,1]),t}return r.__extends(t,e),t}(u.NodeParamsConfig)),p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=c,t._core_transform=new a.CoreTransform,t}return r.__extends(t,e),t.type=function(){return"tube"},t.prototype.cook=function(){var e=new s.CylinderBufferGeometry(this.pv.radius,this.pv.radius,this.pv.height,this.pv.segments_radial,this.pv.segments_height,!this.pv.cap);this._core_transform.rotate_geometry(e,_,this.pv.direction),e.translate(this.pv.center.x,this.pv.center.y,this.pv.center.z),this.set_geometry(e)},t}(o.TypedSopNode);t.TubeSopNode=p},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=n(14),i=n(286),s=n(9),a=n(19),_=n(42),u=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.camera=s.ParamConfig.OPERATOR_PATH("/perspective_camera1",{node_selection:{context:_.NodeContext.OBJ}}),t}return r.__extends(t,e),t}(s.NodeParamsConfig)),c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=u,t._camera_controller=new i.CameraController(t._update_uvs_from_camera.bind(t)),t}return r.__extends(t,e),t.type=function(){return"uv_project"},t.prototype.initialize_node=function(){this.io.inputs.set_count(1),this.io.inputs.init_inputs_clonable_state([a.InputCloneMode.FROM_NODE])},t.prototype.cook=function(e){this._processed_core_group=e[0];var t=this.p.camera.found_node();null!=t?(this._camera_object=t.object,this._camera_controller.set_target(this._camera_object)):(this._camera_object=void 0,this._camera_controller.remove_target()),this.set_core_group(this._processed_core_group)},t.prototype._update_uvs_from_camera=function(e){var t=this;if(this._processed_core_group&&this.parent){var n=this._processed_core_group.points(),r=this.parent.object.matrixWorld;n.forEach((function(e){var n=e.position(),o=t._vector_in_camera_space(n,r);if(o){var i={x:1-(.5*o[0]+.5),y:.5*o[1]+.5};e.set_attrib_value("uv",i)}}))}},t.prototype._vector_in_camera_space=function(e,t){if(this._camera_object)return e.applyMatrix4(t),e.project(this._camera_object).toArray()},t}(o.TypedSopNode);t.UvProjectSopNode=c},,,,function(e,t,n){"use strict";n.r(t);var r=n(331),o=n(0),i=n(23),s=n(57),a=n(56),_=n(2),u=n(70),c={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float opacity;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","\tvec4 texel = texture2D( tDiffuse, vUv );","\tgl_FragColor = opacity * texel;","}"].join("\n")},p=n(34),l=n(22),d=n(51),h=function(e,t){d.a.call(this),this.textureID=void 0!==t?t:"tDiffuse",e instanceof p.a?(this.uniforms=e.uniforms,this.material=e):e&&(this.uniforms=l.a.clone(e.uniforms),this.material=new p.a({defines:Object.assign({},e.defines),uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),this.fsQuad=new d.a.FullScreenQuad(this.material)};h.prototype=Object.assign(Object.create(d.a.prototype),{constructor:h,render:function(e,t,n){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=n.texture),this.fsQuad.material=this.material,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),this.fsQuad.render(e))}});var f=function(e,t){d.a.call(this),this.scene=e,this.camera=t,this.clear=!0,this.needsSwap=!1,this.inverse=!1};f.prototype=Object.assign(Object.create(d.a.prototype),{constructor:f,render:function(e,t,n){var r,o,i=e.getContext(),s=e.state;s.buffers.color.setMask(!1),s.buffers.depth.setMask(!1),s.buffers.color.setLocked(!0),s.buffers.depth.setLocked(!0),this.inverse?(r=0,o=1):(r=1,o=0),s.buffers.stencil.setTest(!0),s.buffers.stencil.setOp(i.REPLACE,i.REPLACE,i.REPLACE),s.buffers.stencil.setFunc(i.ALWAYS,r,4294967295),s.buffers.stencil.setClear(o),s.buffers.stencil.setLocked(!0),e.setRenderTarget(n),this.clear&&e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(t),this.clear&&e.clear(),e.render(this.scene,this.camera),s.buffers.color.setLocked(!1),s.buffers.depth.setLocked(!1),s.buffers.stencil.setLocked(!1),s.buffers.stencil.setFunc(i.EQUAL,1,4294967295),s.buffers.stencil.setOp(i.KEEP,i.KEEP,i.KEEP),s.buffers.stencil.setLocked(!0)}});var m=function(){d.a.call(this),this.needsSwap=!1};m.prototype=Object.create(d.a.prototype),Object.assign(m.prototype,{render:function(e){e.state.buffers.stencil.setLocked(!1),e.state.buffers.stencil.setTest(!1)}}),n.d(t,"EffectComposer",(function(){return y})),n.d(t,"Pass",(function(){return O}));var y=function(e,t){if(this.renderer=e,void 0===t){var n={minFilter:o.LinearFilter,magFilter:o.LinearFilter,format:o.RGBAFormat,stencilBuffer:!1},i=e.getSize(new _.Vector2);this._pixelRatio=e.getPixelRatio(),this._width=i.width,this._height=i.height,(t=new u.a(this._width*this._pixelRatio,this._height*this._pixelRatio,n)).texture.name="EffectComposer.rt1"}else this._pixelRatio=1,this._width=t.width,this._height=t.height;this.renderTarget1=t,this.renderTarget2=t.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],void 0===c&&console.error("THREE.EffectComposer relies on CopyShader"),void 0===h&&console.error("THREE.EffectComposer relies on ShaderPass"),this.copyPass=new h(c),this.clock=new r.a};Object.assign(y.prototype,{swapBuffers:function(){var e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e},addPass:function(e){this.passes.push(e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)},insertPass:function(e,t){this.passes.splice(t,0,e)},isLastEnabledPass:function(e){for(var t=e+1;t<this.passes.length;t++)if(this.passes[t].enabled)return!1;return!0},render:function(e){void 0===e&&(e=this.clock.getDelta());var t,n,r=this.renderer.getRenderTarget(),o=!1,i=this.passes.length;for(n=0;n<i;n++)if(!1!==(t=this.passes[n]).enabled){if(t.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(n),t.render(this.renderer,this.writeBuffer,this.readBuffer,e,o),t.needsSwap){if(o){var s=this.renderer.getContext(),a=this.renderer.state.buffers.stencil;a.setFunc(s.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,e),a.setFunc(s.EQUAL,1,4294967295)}this.swapBuffers()}void 0!==f&&(t instanceof f?o=!0:t instanceof m&&(o=!1))}this.renderer.setRenderTarget(r)},reset:function(e){if(void 0===e){var t=this.renderer.getSize(new _.Vector2);this._pixelRatio=this.renderer.getPixelRatio(),this._width=t.width,this._height=t.height,(e=this.renderTarget1.clone()).setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2},setSize:function(e,t){this._width=e,this._height=t;var n=this._width*this._pixelRatio,r=this._height*this._pixelRatio;this.renderTarget1.setSize(n,r),this.renderTarget2.setSize(n,r);for(var o=0;o<this.passes.length;o++)this.passes[o].setSize(n,r)},setPixelRatio:function(e){this._pixelRatio=e,this.setSize(this._width,this._height)}});var v,g,b,O=function(){this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1};Object.assign(O.prototype,{setSize:function(){},render:function(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}}),O.FullScreenQuad=(v=new s.OrthographicCamera(-1,1,1,-1,0,1),g=new a.PlaneBufferGeometry(2,2),b=function(e){this._mesh=new i.Mesh(g,e)},Object.defineProperty(b.prototype,"material",{get:function(){return this._mesh.material},set:function(e){this._mesh.material=e}}),Object.assign(b.prototype,{dispose:function(){this._mesh.geometry.dispose()},render:function(e){e.render(this._mesh,v)}}),b)}]);