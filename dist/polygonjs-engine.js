/*! For license information please see polygonjs-engine.js.LICENSE */
!function(e){function t(t){for(var r,s,a=t[0],_=t[1],u=t[2],p=0,l=[];p<a.length;p++)s=a[p],Object.prototype.hasOwnProperty.call(o,s)&&o[s]&&l.push(o[s][0]),o[s]=0;for(r in _)Object.prototype.hasOwnProperty.call(_,r)&&(e[r]=_[r]);for(c&&c(t);l.length;)l.shift()();return i.push.apply(i,u||[]),n()}function n(){for(var e,t=0;t<i.length;t++){for(var n=i[t],r=!0,a=1;a<n.length;a++){var _=n[a];0!==o[_]&&(r=!1)}r&&(i.splice(t--,1),e=s(s.s=n[0]))}return e}var r={},o={1:0},i=[];function s(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=e,s.c=r,s.d=function(e,t,n){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)s.d(n,r,function(t){return e[t]}.bind(null,r));return n},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="";var a=window.webpackJsonp=window.webpackJsonp||[],_=a.push.bind(a);a.push=t,a=a.slice();for(var u=0;u<a.length;u++)t(a[u]);var c=_;i.push([177,0,2]),n()}([,,function(e,t,n){"use strict";n.r(t),n.d(t,"__extends",(function(){return o})),n.d(t,"__assign",(function(){return i})),n.d(t,"__rest",(function(){return s})),n.d(t,"__decorate",(function(){return a})),n.d(t,"__param",(function(){return _})),n.d(t,"__metadata",(function(){return u})),n.d(t,"__awaiter",(function(){return c})),n.d(t,"__generator",(function(){return p})),n.d(t,"__exportStar",(function(){return l})),n.d(t,"__values",(function(){return d})),n.d(t,"__read",(function(){return h})),n.d(t,"__spread",(function(){return f})),n.d(t,"__spreadArrays",(function(){return m})),n.d(t,"__await",(function(){return y})),n.d(t,"__asyncGenerator",(function(){return v})),n.d(t,"__asyncDelegator",(function(){return g})),n.d(t,"__asyncValues",(function(){return b})),n.d(t,"__makeTemplateObject",(function(){return w})),n.d(t,"__importStar",(function(){return P})),n.d(t,"__importDefault",(function(){return O}));var r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function o(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var i=function(){return(i=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};function s(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(e,r[o])&&(n[r[o]]=e[r[o]])}return n}function a(e,t,n,r){var o,i=arguments.length,s=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,n,s):o(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s}function _(e,t){return function(n,r){t(n,r,e)}}function u(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}function c(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{_(r.next(e))}catch(e){i(e)}}function a(e){try{_(r.throw(e))}catch(e){i(e)}}function _(e){e.done?o(e.value):new n((function(t){t(e.value)})).then(s,a)}_((r=r.apply(e,t||[])).next())}))}function p(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=(o=s.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}}function l(e,t){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}function d(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}}function h(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)s.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return s}function f(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(h(arguments[t]));return e}function m(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),o=0;for(t=0;t<n;t++)for(var i=arguments[t],s=0,a=i.length;s<a;s++,o++)r[o]=i[s];return r}function y(e){return this instanceof y?(this.v=e,this):new y(e)}function v(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,o=n.apply(e,t||[]),i=[];return r={},s("next"),s("throw"),s("return"),r[Symbol.asyncIterator]=function(){return this},r;function s(e){o[e]&&(r[e]=function(t){return new Promise((function(n,r){i.push([e,t,n,r])>1||a(e,t)}))})}function a(e,t){try{(n=o[e](t)).value instanceof y?Promise.resolve(n.value.v).then(_,u):c(i[0][2],n)}catch(e){c(i[0][3],e)}var n}function _(e){a("next",e)}function u(e){a("throw",e)}function c(e,t){e(t),i.shift(),i.length&&a(i[0][0],i[0][1])}}function g(e){var t,n;return t={},r("next"),r("throw",(function(e){throw e})),r("return"),t[Symbol.iterator]=function(){return this},t;function r(r,o){t[r]=e[r]?function(t){return(n=!n)?{value:y(e[r](t)),done:"return"===r}:o?o(t):t}:o}}function b(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e=d(e),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(n){t[n]=e[n]&&function(t){return new Promise((function(r,o){(function(e,t,n,r){Promise.resolve(r).then((function(t){e({value:t,done:n})}),t)})(r,o,(t=e[n](t)).done,t.value)}))}}}function w(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e}function P(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function O(e){return e&&e.__esModule?e:{default:e}}},,,,,,,,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.BUTTON="button",e.COLOR="color",e.FLOAT="float",e.INTEGER="integer",e.OPERATOR_PATH="operator_path",e.SEPARATOR="separator",e.STRING="string",e.BOOLEAN="boolean",e.VECTOR2="vector2",e.VECTOR3="vector3",e.VECTOR4="vector4",e.RAMP="ramp"}(t.ParamType||(t.ParamType={}))},,,,function(e,t,n){var r;try{r={clone:n(119),constant:n(137),each:n(138),filter:n(247),has:n(268),isArray:n(10),isEmpty:n(270),isFunction:n(59),isUndefined:n(271),keys:n(30),map:n(147),reduce:n(272),size:n(274),transform:n(277),union:n(150),values:n(102)}}catch(e){}r||(r=window._),e.exports=r},function(e,t,n){"use strict";n.d(t,"a",(function(){return u}));var r,o,i,s=n(23),a=n(79),_=n(39);function u(){this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}Object.assign(u.prototype,{setSize:function(){},render:function(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}}),u.FullScreenQuad=(r=new a.a(-1,1,1,-1,0,1),o=new _.PlaneBufferGeometry(2,2),i=function(e){this._mesh=new s.Mesh(o,e)},Object.defineProperty(i.prototype,"material",{get:function(){return this._mesh.material},set:function(e){this._mesh.material=e}}),Object.assign(i.prototype,{dispose:function(){this._mesh.geometry.dispose()},render:function(e){e.render(this._mesh,r)}}),i)},,,,,,,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.CREATED="node_created",e.DELETED="node_deleted",e.NAME_UPDATED="node_name_update",e.OVERRIDE_CLONABLE_STATE_UPDATE="node_override_clonable_state_update",e.NAMED_OUTPUTS_UPDATED="node_named_outputs_updated",e.NAMED_INPUTS_UPDATED="node_named_inputs_updated",e.INPUTS_UPDATED="node_inputs_updated",e.PARAMS_UPDATED="node_params_updated",e.UI_DATA_UPDATED="node_ui_data_updated",e.ERROR_UPDATED="node_error_updated",e.FLAG_BYPASS_UPDATED="bypass_flag_updated",e.FLAG_DISPLAY_UPDATED="display_flag_updated",e.SELECTION_UPDATED="selection_updated"}(t.NodeEvent||(t.NodeEvent={}))},,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(310),o=function(){function e(e,t){this._scene=e,this._name=t,this._dirty_controller=new r.DirtyController(this),this._graph_node_id=e.graph.next_id(),e.graph.setNode(this),this._graph=e.graph}return Object.defineProperty(e.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0}),e.prototype.set_name=function(e){this._name=e},Object.defineProperty(e.prototype,"scene",{get:function(){return this._scene},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"graph",{get:function(){return this._graph},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"graph_node_id",{get:function(){return this._graph_node_id},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dirty_controller",{get:function(){return this._dirty_controller},enumerable:!0,configurable:!0}),e.prototype.set_dirty=function(e){e=e||this,this._dirty_controller.set_dirty(e)},e.prototype.set_successors_dirty=function(e){this._dirty_controller.set_successors_dirty(e)},e.prototype.remove_dirty_state=function(){this._dirty_controller.remove_dirty_state()},Object.defineProperty(e.prototype,"is_dirty",{get:function(){return this._dirty_controller.is_dirty},enumerable:!0,configurable:!0}),e.prototype.add_post_dirty_hook=function(e){this._dirty_controller.add_post_dirty_hook(e)},e.prototype.graph_remove=function(){this.graph.removeNode(this)},e.prototype.add_graph_input=function(e){return this.graph.connect(e,this)},e.prototype.remove_graph_input=function(e){this.graph.disconnect(e,this)},e.prototype.graph_disconnect_predecessors=function(){this.graph.disconnect_predecessors(this)},e.prototype.graph_disconnect_successors=function(){this.graph.disconnect_successors(this)},e.prototype.graph_predecessor_ids=function(){return this.graph.predecessor_ids(this._graph_node_id)||[]},e.prototype.graph_predecessors=function(){return this.graph.predecessors(this)},e.prototype.graph_successors=function(){return this.graph.successors(this)},e.prototype.graph_all_predecessors=function(){return this.graph.all_predecessors(this)},e.prototype.graph_all_successors=function(){return this.graph.all_successors(this)},e}();t.CoreGraphNode=o},,,,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.MANAGER="managers",e.OBJ="objects",e.SOP="sop",e.MAT="mat",e.COP="cop",e.POST="post",e.GL="gl",e.EVENT="event"}(t.NodeContext||(t.NodeContext={}))},,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.is_raw_input_default=function(){return this._raw_input==this._default_value},t.prototype.eval_raw=function(){return r.__awaiter(this,void 0,void 0,(function(){var e,t;return r.__generator(this,(function(n){switch(n.label){case 0:return this.is_dirty?this.has_expression()?[4,this.expression_controller.eval()]:[3,2]:[3,4];case 1:return e=n.sent(),t=this.convert(e),this.post_eval_raw(t),[2,t];case 2:return this._value=this.convert(this._raw_input),this.remove_dirty_state(),[2,this._value];case 3:return[3,5];case 4:return[2,this._value];case 5:return[2]}}))}))},t.prototype.post_eval_raw=function(e){var t=this._value;this._value=e,null!=this._value&&this.states.error.clear();var n=this.is_dirty;if(this.remove_dirty_state(),n&&this.emit_controller.emit_param_updated(),this.options.has_callback()&&t!==this._value)return this.options.execute_callback()},t.prototype.eval=function(){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(e){switch(e.label){case 0:return[4,this.eval_raw()];case 1:return[2,e.sent()]}}))}))},t.prototype.set=function(e){if(this._value!==e||this.has_expression()){var t=this.scene.cooker;t.block(),this.states.error.clear(),this._value=e,this.set_expression(null),this.set_dirty(),this.options.execute_callback(),t.unblock(),this.emit_controller.emit_param_updated()}},t}(n(112).TypedParam);t.Single=o},,,,,,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(8),i=n(104),s=n(393),a=n(394),_=n(396),u=n(38),c=n(173),p=["parent object","parent object","parent object","parent object"],l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.container_controller=new c.TypedContainerController(t,s.ObjectContainer),t._sop_loaded=!1,t}return r.__extends(t,e),t.node_context=function(){return u.NodeContext.OBJ},t.displayed_input_names=function(){return p},Object.defineProperty(t.prototype,"look_at_controller",{get:function(){return this._look_at_controller=this._look_at_controller||new a.LookAtController(this)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"transform_controller",{get:function(){return this._transform_controller=this._transform_controller||new _.TransformController(this)},enumerable:!0,configurable:!0}),t.prototype.initialize_node=function(){this._object=this._create_object_with_attributes(),this.name_controller.add_post_set_full_path_hook(this.set_group_name.bind(this)),this._sop_loaded=!1},Object.defineProperty(t.prototype,"object",{get:function(){return this._object},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"group",{get:function(){return this.object},enumerable:!0,configurable:!0}),t.prototype._create_object_with_attributes=function(){var e=this.create_object();return null!=e&&(e.name=this.name,e.node=this),e},t.prototype.set_group_name=function(){var e=this.group;e&&(e.name=this.full_path())},t.prototype.create_object=function(){return new o.Object3D},t.prototype.request_display_node=function(){},t.prototype.is_display_node_cooking=function(){return!1},t.prototype.post_state_display_flag=function(){var e=this.object;if(null!=e){var t=this.is_displayed();t&&(e.visible=t,this._sop_loaded||this.request_display_node())}},t.prototype.is_displayed=function(){return this.flags.display.active},t.prototype.accepts_visitor=function(e){e.visit_node_obj(this)},t.prototype._init_dirtyable_hook=function(){this.add_post_dirty_hook(this._cook_main_without_inputs_later.bind(this))},t.prototype._cook_main_without_inputs_later=function(){var e=this;setTimeout((function(){e.cook_controller.cook_main_without_inputs()}),0)},t}(i.TypedNode);t.TypedObjNode=l;var d=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t}(l);t.BaseObjNodeclass=d},,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(178),o=n(179),i=function(){function e(){this.renderers_controller=new r.RenderersController,this.nodes_register=new o.NodesRegister}return e.prototype.register_node=function(e,t,n){this.nodes_register.register_node(e,t,n)},e.prototype.registered_nodes=function(e,t){return this.nodes_register.registered_nodes(e,t)},e.prototype.in_worker_thread=function(){return!1},e.prototype.desktop_controller=function(){},e.prototype.notify_scene_loaded=function(e){},e.prototype.player_mode=function(){return!1},e.prototype.log=function(e){console.log(e)},e.prototype.set_env=function(e){this._env=e},Object.defineProperty(e.prototype,"env",{get:function(){return this._env},enumerable:!0,configurable:!0}),e}();t.Poly=i,window.POLY=window.POLY||new i},,,,,,,,,,,,,,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.find_param=function(e,n,r){if(!e)return null;var o=n.split(t.SEPARATOR);if(1===o.length)return e.params.get(o[0]);var i=o.slice(0,+(o.length-2)+1||void 0).join(t.SEPARATOR),s=this.find_node(e,i,r);if(null!=s){var a=o[o.length-1],_=s.params.get(a);return r&&_&&r.add_node(a,_),_}return null},t.relative_path=function(e,n){var r=this.closest_common_parent(e,n);if(r){var o=this.distance_to_parent(e,r),i="";if(o-1>0){for(var s=0,a=[];s++<o-1;)a.push(t.PARENT);i=a.join(t.SEPARATOR)+t.SEPARATOR}for(var _=r.full_path().split(t.SEPARATOR).filter((function(e){return e.length>0})),u=[],c=0,p=0,l=n.full_path().split(t.SEPARATOR).filter((function(e){return e.length>0}));p<l.length;p++){var d=l[p];_[c]||u.push(d),c++}return""+i+u.join(t.SEPARATOR)}return n.full_path()},t.closest_common_parent=function(e,t){for(var n=this.parents(e).reverse(),r=this.parents(t).reverse(),o=Math.min(n.length,r.length),i=null,s=0;s<o;s++)n[s].graph_node_id==r[s].graph_node_id&&(i=n[s]);return i},t.parents=function(e){for(var t=[],n=e.parent;n;)t.push(n),n=n.parent;return t},t.distance_to_parent=function(e,t){for(var n=0,r=e,o=t.graph_node_id;r&&r.graph_node_id!=o;)n+=1,r=r.parent;return r&&r.graph_node_id==o?n:-1},t.SEPARATOR="/",t.CURRENT=".",t.PARENT="..",t.CURRENT_WITH_SLASH=t.CURRENT+"/",t.PARENT_WITH_SLASH=t.PARENT+"/",t}(n(319).CoreWalkerEmbed);t.CoreWalker=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(112),i=n(172),s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._components_contructor=i.FloatParam,t}return r.__extends(t,e),t.prototype.accepts_visitor=function(e){return e.visit_typed_multiple_param(this)},t.prototype.init_components=function(){for(var e=0,t=this.component_names;e<t.length;e++){var n=t[e],r=new this._components_contructor(this.scene);r.set_default_value(this._default_value[n]),r.options.copy(this.options),r.set_name(""+this.name+n),r.set_parent_param(this),this._components.push(r)}},Object.defineProperty(t.prototype,"is_numeric",{get:function(){return!0},enumerable:!0,configurable:!0}),t.prototype.has_expression=function(){for(var e=0,t=this.components;e<t.length;e++){if(t[e].expression_controller.active)return!0}return!1},t.prototype.set_expression=function(e){for(var t=0,n=this.components;t<n.length;t++){n[t].expression_controller.set_expression(e)}},t.prototype.is_raw_input_default=function(){for(var e=0,t=this.components;e<t.length;e++){if(!t[e].is_raw_input_default())return!1}return!0},t.prototype.eval_components=function(){return r.__awaiter(this,void 0,void 0,(function(){var e,t,n,o,i,s;return r.__generator(this,(function(r){switch(r.label){case 0:for(e=this.components,t=[],n=0,o=e;n<o.length;n++)i=o[n],t.push(i.eval_p());return[4,Promise.all(t)];case 1:return s=r.sent(),this.remove_dirty_state(),[2,s]}}))}))},t.prototype.set=function(e){var t=this.scene.cooker;t.block();for(var n=this.components,r=0,o=n;r<o.length;r++){o[r].emit_controller.block_parent_emit()}for(var i=0;i<n.length;i++)n[i].set(e[i]);t.unblock();for(i=0;i<n.length;i++)n[i].emit_controller.unblock_parent_emit();this.emit_controller.emit_param_updated()},t}(o.TypedParam);t.TypedMultipleParam=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(13);t._ParamFloat=function(e,t){return function(e,t){}};var o=function(e,t,n){this.type=e,this.init_value=t,this.options=n};t.ParamTemplate=o;var i=function(){function e(){}return e.BUTTON=function(e,t){return new o(r.ParamType.BUTTON,e,t)},e.BOOLEAN=function(e,t){return new o(r.ParamType.BOOLEAN,e,t)},e.COLOR=function(e,t){return new o(r.ParamType.COLOR,e,t)},e.FLOAT=function(e,t){return new o(r.ParamType.FLOAT,e,t)},e.INTEGER=function(e,t){return new o(r.ParamType.INTEGER,e,t)},e.OPERATOR_PATH=function(e,t){return new o(r.ParamType.OPERATOR_PATH,e,t)},e.STRING=function(e,t){return new o(r.ParamType.STRING,e,t)},e.VECTOR2=function(e,t){return new o(r.ParamType.VECTOR2,e,t)},e.VECTOR3=function(e,t){return new o(r.ParamType.VECTOR3,e,t)},e.VECTOR4=function(e,t){return new o(r.ParamType.VECTOR4,e,t)},e}();t.ParamConfig=i;var s=function(){};t.NodeParamsConfig=s},,,,,,function(e,t,n){"use strict";var r=n(17);e.exports=o;function o(e){this._isDirected=!r.has(e,"directed")||e.directed,this._isMultigraph=!!r.has(e,"multigraph")&&e.multigraph,this._isCompound=!!r.has(e,"compound")&&e.compound,this._label=void 0,this._defaultNodeLabelFn=r.constant(void 0),this._defaultEdgeLabelFn=r.constant(void 0),this._nodes={},this._isCompound&&(this._parent={},this._children={},this._children["\0"]={}),this._in={},this._preds={},this._out={},this._sucs={},this._edgeObjs={},this._edgeLabels={}}function i(e,t){e[t]?e[t]++:e[t]=1}function s(e,t){--e[t]||delete e[t]}function a(e,t,n,o){var i=""+t,s=""+n;if(!e&&i>s){var a=i;i=s,s=a}return i+""+s+""+(r.isUndefined(o)?"\0":o)}function _(e,t,n,r){var o=""+t,i=""+n;if(!e&&o>i){var s=o;o=i,i=s}var a={v:o,w:i};return r&&(a.name=r),a}function u(e,t){return a(e,t.v,t.w,t.name)}o.prototype._nodeCount=0,o.prototype._edgeCount=0,o.prototype.isDirected=function(){return this._isDirected},o.prototype.isMultigraph=function(){return this._isMultigraph},o.prototype.isCompound=function(){return this._isCompound},o.prototype.setGraph=function(e){return this._label=e,this},o.prototype.graph=function(){return this._label},o.prototype.setDefaultNodeLabel=function(e){return r.isFunction(e)||(e=r.constant(e)),this._defaultNodeLabelFn=e,this},o.prototype.nodeCount=function(){return this._nodeCount},o.prototype.nodes=function(){return r.keys(this._nodes)},o.prototype.sources=function(){var e=this;return r.filter(this.nodes(),(function(t){return r.isEmpty(e._in[t])}))},o.prototype.sinks=function(){var e=this;return r.filter(this.nodes(),(function(t){return r.isEmpty(e._out[t])}))},o.prototype.setNodes=function(e,t){var n=arguments,o=this;return r.each(e,(function(e){n.length>1?o.setNode(e,t):o.setNode(e)})),this},o.prototype.setNode=function(e,t){return r.has(this._nodes,e)?(arguments.length>1&&(this._nodes[e]=t),this):(this._nodes[e]=arguments.length>1?t:this._defaultNodeLabelFn(e),this._isCompound&&(this._parent[e]="\0",this._children[e]={},this._children["\0"][e]=!0),this._in[e]={},this._preds[e]={},this._out[e]={},this._sucs[e]={},++this._nodeCount,this)},o.prototype.node=function(e){return this._nodes[e]},o.prototype.hasNode=function(e){return r.has(this._nodes,e)},o.prototype.removeNode=function(e){var t=this;if(r.has(this._nodes,e)){var n=function(e){t.removeEdge(t._edgeObjs[e])};delete this._nodes[e],this._isCompound&&(this._removeFromParentsChildList(e),delete this._parent[e],r.each(this.children(e),(function(e){t.setParent(e)})),delete this._children[e]),r.each(r.keys(this._in[e]),n),delete this._in[e],delete this._preds[e],r.each(r.keys(this._out[e]),n),delete this._out[e],delete this._sucs[e],--this._nodeCount}return this},o.prototype.setParent=function(e,t){if(!this._isCompound)throw new Error("Cannot set parent in a non-compound graph");if(r.isUndefined(t))t="\0";else{for(var n=t+="";!r.isUndefined(n);n=this.parent(n))if(n===e)throw new Error("Setting "+t+" as parent of "+e+" would create a cycle");this.setNode(t)}return this.setNode(e),this._removeFromParentsChildList(e),this._parent[e]=t,this._children[t][e]=!0,this},o.prototype._removeFromParentsChildList=function(e){delete this._children[this._parent[e]][e]},o.prototype.parent=function(e){if(this._isCompound){var t=this._parent[e];if("\0"!==t)return t}},o.prototype.children=function(e){if(r.isUndefined(e)&&(e="\0"),this._isCompound){var t=this._children[e];if(t)return r.keys(t)}else{if("\0"===e)return this.nodes();if(this.hasNode(e))return[]}},o.prototype.predecessors=function(e){var t=this._preds[e];if(t)return r.keys(t)},o.prototype.successors=function(e){var t=this._sucs[e];if(t)return r.keys(t)},o.prototype.neighbors=function(e){var t=this.predecessors(e);if(t)return r.union(t,this.successors(e))},o.prototype.isLeaf=function(e){return 0===(this.isDirected()?this.successors(e):this.neighbors(e)).length},o.prototype.filterNodes=function(e){var t=new this.constructor({directed:this._isDirected,multigraph:this._isMultigraph,compound:this._isCompound});t.setGraph(this.graph());var n=this;r.each(this._nodes,(function(n,r){e(r)&&t.setNode(r,n)})),r.each(this._edgeObjs,(function(e){t.hasNode(e.v)&&t.hasNode(e.w)&&t.setEdge(e,n.edge(e))}));var o={};return this._isCompound&&r.each(t.nodes(),(function(e){t.setParent(e,function e(r){var i=n.parent(r);return void 0===i||t.hasNode(i)?(o[r]=i,i):i in o?o[i]:e(i)}(e))})),t},o.prototype.setDefaultEdgeLabel=function(e){return r.isFunction(e)||(e=r.constant(e)),this._defaultEdgeLabelFn=e,this},o.prototype.edgeCount=function(){return this._edgeCount},o.prototype.edges=function(){return r.values(this._edgeObjs)},o.prototype.setPath=function(e,t){var n=this,o=arguments;return r.reduce(e,(function(e,r){return o.length>1?n.setEdge(e,r,t):n.setEdge(e,r),r})),this},o.prototype.setEdge=function(){var e,t,n,o,s=!1,u=arguments[0];"object"==typeof u&&null!==u&&"v"in u?(e=u.v,t=u.w,n=u.name,2===arguments.length&&(o=arguments[1],s=!0)):(e=u,t=arguments[1],n=arguments[3],arguments.length>2&&(o=arguments[2],s=!0)),e=""+e,t=""+t,r.isUndefined(n)||(n=""+n);var c=a(this._isDirected,e,t,n);if(r.has(this._edgeLabels,c))return s&&(this._edgeLabels[c]=o),this;if(!r.isUndefined(n)&&!this._isMultigraph)throw new Error("Cannot set a named edge when isMultigraph = false");this.setNode(e),this.setNode(t),this._edgeLabels[c]=s?o:this._defaultEdgeLabelFn(e,t,n);var p=_(this._isDirected,e,t,n);return e=p.v,t=p.w,Object.freeze(p),this._edgeObjs[c]=p,i(this._preds[t],e),i(this._sucs[e],t),this._in[t][c]=p,this._out[e][c]=p,this._edgeCount++,this},o.prototype.edge=function(e,t,n){var r=1===arguments.length?u(this._isDirected,arguments[0]):a(this._isDirected,e,t,n);return this._edgeLabels[r]},o.prototype.hasEdge=function(e,t,n){var o=1===arguments.length?u(this._isDirected,arguments[0]):a(this._isDirected,e,t,n);return r.has(this._edgeLabels,o)},o.prototype.removeEdge=function(e,t,n){var r=1===arguments.length?u(this._isDirected,arguments[0]):a(this._isDirected,e,t,n),o=this._edgeObjs[r];return o&&(e=o.v,t=o.w,delete this._edgeLabels[r],delete this._edgeObjs[r],s(this._preds[t],e),s(this._sucs[e],t),delete this._in[t][r],delete this._out[e][r],this._edgeCount--),this},o.prototype.inEdges=function(e,t){var n=this._in[e];if(n){var o=r.values(n);return t?r.filter(o,(function(e){return e.v===t})):o}},o.prototype.outEdges=function(e,t){var n=this._out[e];if(n){var o=r.values(n);return t?r.filter(o,(function(e){return e.w===t})):o}},o.prototype.nodeEdges=function(e,t){var n=this.inEdges(e,t);if(n)return n.concat(this.outEdges(e,t))}},,,,,,function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(31),i=n(311),s=n(312),a=n(315),_=n(318),u=n(320),c=n(348),p=n(349),l=n(350),d=n(163),h=n(364),f=n(365),m=n(380),y=n(381),v=n(382),g=r.__importDefault(n(388)),b=n(391),w=function(e){function t(t,n){void 0===n&&(n="BaseNode");var r=e.call(this,t,n)||this;return r.pv=new m.ParamsValueAccessor(r),r.p=new b.ParamsAccessor(r),r.initialize_base_node(),r.initialize_node(),r}return r.__extends(t,e),Object.defineProperty(t.prototype,"parent_controller",{get:function(){return this._parent_controller=this._parent_controller||new _.HierarchyParentController(this)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"children_controller",{get:function(){return this._children_controller=this._children_controller||new u.HierarchyChildrenController(this)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"selection",{get:function(){return this._selection=this._selection||new g.default(this)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ui_data",{get:function(){return this._ui_data=this._ui_data||new i.UIData(this)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"flags",{get:function(){return this._flags=this._flags||new s.FlagsController(this)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dependencies_controller",{get:function(){return this._dependencies_controller=this._dependencies_controller||new l.DependenciesController(this)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"states",{get:function(){return this._states=this._states||new a.StatesController(this)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lifecycle",{get:function(){return this._lifecycle=this._lifecycle||new c.LifeCycleController(this)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"serializer",{get:function(){return this._serializer=this._serializer||new h.NodeSerializer(this)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cook_controller",{get:function(){return this._cook_controller=this._cook_controller||new p.CookController(this)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"io",{get:function(){return this._io=this._io||new v.IOController(this)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"name_controller",{get:function(){return this._name_controller=this._name_controller||new d.NameController(this)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"params",{get:function(){return this._params_controller=this._params_controller||new f.ParamsController(this)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"processing_context",{get:function(){return this._processing_context=this._processing_context||new y.ProcessingContext(this)},enumerable:!0,configurable:!0}),t.prototype.initialize_base_node=function(){},t.prototype.initialize_node=function(){},t.type=function(){throw"type to be overriden"},t.prototype.type=function(){return this.constructor.type()},t.node_context=function(){throw"requires override"},t.prototype.node_context=function(){return this.constructor.node_context()},t.required_three_imports=function(){return[]},t.required_imports=function(){var e=this.required_three_imports();return e?e.map((function(e){return"three/examples/jsm/"+e})):[]},t.prototype.required_imports=function(){return this.constructor.required_imports()},t.require_webgl2=function(){return!1},t.prototype.require_webgl2=function(){return this.constructor.require_webgl2()},t.prototype.accepts_visitor=function(e){return e.visit_node(this)},t.prototype.set_parent=function(e){this.parent_controller.set_parent(e)},Object.defineProperty(t.prototype,"parent",{get:function(){return this.parent_controller.parent},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"root",{get:function(){return this._scene.root},enumerable:!0,configurable:!0}),t.prototype.full_path=function(){return this.parent_controller.full_path()},t.prototype.create_params=function(){},t.prototype.add_param=function(e,t,n,r){return this._params_controller.add_param(e,t,n,r)},t.prototype.within_param_folder=function(e,t){this._params_controller.within_param_folder(e,t)},t.prototype.cook=function(e){return null},t.prototype.request_container=function(){return this.container_controller.request_container()},t.prototype.set_container=function(e,t){void 0===t&&(t=null),this.container_controller.container.set_content(e),null!=e&&(e.name||(e.name=this.full_path()),e.node||(e.node=this)),this.cook_controller.end_cook(t)},t.prototype.create_node=function(e){return this.children_controller.create_node(e)},t.prototype.children=function(){return this.children_controller.children()},t.prototype.node=function(e){return this.children_controller.find_node(e)},t.prototype.nodes_by_type=function(e){return this.children_controller.nodes_by_type(e)},t.prototype.emit=function(e,t){void 0===t&&(t=null),this.scene.events_controller.dispatch(this,e,t)},t.prototype.to_json=function(e){return void 0===e&&(e=!1),this.serializer.to_json(e)},t}(o.CoreGraphNode);t.TypedNode=w;var P=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t}(w);t.BaseNodeClass=P},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=["extended","included"];var o=function(){function e(){}return e.include=function(e){var t,n;t=e,n=this,Object.keys(n).forEach((function(e){r.includes(e)||(t.prototype[e]=n[e])})),n.included&&n.included.apply(t)},e.is_a=function(e,t){for(var n=e;n;){if(n.constructor==t)return!0;n=n.__proto__}return!1},e.prototype.is_a=function(t){return e.is_a(this,t)},e}();t.CoreObject=o},,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=r.__importDefault(n(165)),i=r.__importDefault(n(108)),s=r.__importDefault(n(324)),a=r.__importDefault(n(71)),_=r.__importDefault(n(160)),u=r.__importDefault(n(330)),c=r.__importDefault(n(169)),p=r.__importDefault(n(334)),l=r.__importDefault(n(170)),d=r.__importDefault(n(342)),h=/[, ]/,f=/\d+$/,m=/,| /,y=function(){function e(){}return e.tail_digits=function(e){var t=e.match(f);return t?parseInt(t[0]):0},e.increment=function(e){var t;if(t=e.match(f)){var n=parseInt(t[0]);return""+e.substring(0,e.length-t[0].length)+(n+1)}return e+"1"},e.pluralize=function(e){return"s"!==e[e.length-1]?e+"s":e},e.camel_case=function(e){return d.default(e)},e.upper_first=function(e){return l.default(e)},e.snake_case=function(e){return p.default(e)},e.titleize=function(e){return c.default(e.replace(/_/g," "))},e.type_to_class_name=function(e){return this.upper_first(d.default(e))},e.timestamp_to_seconds=function(e){return Date.parse(e)/1e3},e.seconds_to_timestamp=function(e){var t=new Date;return t.setTime(1e3*e),t.toISOString().substr(11,8)},e.precision=function(e,t){void 0===t&&(t=2),t=Math.max(t,0);var n=(""+e).split(".");if(t<=0)return n[0];var r=n[1];if(void 0!==r)return r.length>t&&(r=r.substring(0,t)),r=u.default(r,t,"0"),n[0]+"."+r;var o=e+".",i=o.length+t;return u.default(o,i,"0")},e.ensure_float=function(e){var t=""+e;return t.indexOf(".")>=0?t:t+".0"},e.match_mask=function(e,t){return"*"===t||(t="^"+(t=t.split("*").join(".*"))+"$",new RegExp(t).test(e))},e.matches_one_mask=function(t,n){for(var r=!1,o=0,i=n;o<i.length;o++){var s=i[o];e.match_mask(t,s)&&(r=!0)}return r},e.attrib_names=function(e){var t=e.split(h),n=a.default(t.map((function(e){return s.default(e)})));return i.default(n)},e.to_id=function(e){if(null==e)return 0;var t=e.split("").reverse(),n=0,r=0;return t.forEach((function(e,t){var o=e.charCodeAt(0);o>=0&&(r=t%10,n+=o*Math.pow(10,r),n%=Number.MAX_SAFE_INTEGER)})),n},e.indices=function(e){var t=this,n=e.split(m);if(n.length>1)return i.default(_.default(n.map((function(e){return t.indices(e)})))).sort((function(e,t){return e-t}));var r=n[0];if(r){if(r.indexOf("-")>0){var s=r.split("-");return o.default(parseInt(s[0]),parseInt(s[1])+1)}return[parseInt(r)]}return[]},e.escape_line_breaks=function(e){return e.replace(/(\r\n|\n|\r)/gm,"\\n")},e}();t.CoreString=y},,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(72),i=n(31),s=n(355),a=n(357),_=n(358),u=n(359),c=n(360),p=n(363),l=n(13),d=function(e){function t(t){var n=e.call(this,t,"BaseParam")||this;return n._components=[],n.initialize_param(),n}return r.__extends(t,e),Object.defineProperty(t.prototype,"options",{get:function(){return this._options=this._options||new s.OptionsController(this)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"emit_controller",{get:function(){return this._emit_controller=this._emit_controller||new _.EmitController(this)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"expression_controller",{get:function(){return this._expression_controller=this._expression_controller||new a.ExpressionController(this)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"serializer",{get:function(){return this._serializer=this._serializer||new u.ParamSerializer(this)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"states",{get:function(){return this._states=this._states||new c.StatesController(this)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ui_data",{get:function(){return this._ui_data=this._ui_data||new p.UIData(this.scene,this)},enumerable:!0,configurable:!0}),t.prototype.initialize_value=function(){},t.prototype.initialize_param=function(){},t.prototype.accepts_visitor=function(e){return e.visit_typed_param(this)},t.type=function(){return l.ParamType.FLOAT},Object.defineProperty(t.prototype,"type",{get:function(){return this.constructor.type()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"is_numeric",{get:function(){return!1},enumerable:!0,configurable:!0}),t.prototype.set_name=function(t){e.prototype.set_name.call(this,t)},Object.defineProperty(t.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0}),t.prototype.convert=function(e){return this._default_value},t.prototype.set=function(e){},Object.defineProperty(t.prototype,"default_value",{get:function(){return this._default_value},enumerable:!0,configurable:!0}),t.prototype.is_raw_input_default=function(e){return!0},t.prototype.set_default_value=function(e){this._default_value=e},t.prototype.set_init_value=function(e){this._default_value=this.convert(e),this._value=this.convert(e)},t.prototype.eval_p=function(){return new Promise((function(e,t){e()}))},t.prototype.set_node=function(e){if(e?(this._node=e,this.options.makes_node_dirty_when_dirty()&&e.params.params_node.add_graph_input(this)):this._node&&this._node.params.params_node.remove_graph_input(this),this.is_multiple){this.init_components();for(var t=0,n=this.components;t<n.length;t++){n[t].set_node(e)}}},Object.defineProperty(t.prototype,"node",{get:function(){return this._node},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return this.node},enumerable:!0,configurable:!0}),t.prototype.set_parent_param=function(e){e.add_graph_input(this),this._parent_param=e},Object.defineProperty(t.prototype,"parent_param",{get:function(){return this._parent_param},enumerable:!0,configurable:!0}),t.prototype.has_parent_param=function(){return null!=this._parent_param},t.prototype.full_path=function(){return this.node.full_path()+"/"+this.name},t.prototype.path_relative_to=function(e){return o.CoreWalker.relative_path(e,this)},t.prototype.emit=function(e,t){void 0===t&&(t=null),this.emit_controller.emit_allowed&&this.scene.events_controller.dispatch(this,e,t)},Object.defineProperty(t.prototype,"components",{get:function(){return this._components},enumerable:!0,configurable:!0}),Object.defineProperty(t,"component_names",{get:function(){return[]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"component_names",{get:function(){return this.constructor.component_names},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"is_multiple",{get:function(){return this.component_names.length>0},enumerable:!0,configurable:!0}),t.prototype.init_components=function(){},t.prototype.set_expression=function(e){this.expression_controller.set_expression(e)},t.prototype.has_expression=function(){return this.expression_controller.active},t.prototype.to_json=function(){return this.serializer.to_json()},t}(i.CoreGraphNode);t.TypedParam=d;var h=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t}(d);t.BaseParam=h},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.VISIBLE_UPDATED="param_visible_updated",e.UPDATED="param_updated",e.DELETED="param_deleted"}(t.ParamEvent||(t.ParamEvent={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),Object.defineProperty(t.prototype,"is_numeric",{get:function(){return!0},enumerable:!0,configurable:!0}),t.prototype.accepts_visitor=function(e){return e.visit_numeric_param(this)},t}(n(43).Single);t.TypedNumericParam=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(52),i=n(75),s=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}r.__extends(t,e)}(n(74).NodeParamsConfig),function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.create_object=function(){return new i.Group},t.prototype.cook=function(){this.cook_controller.end_cook()},t}(o.TypedObjNode));t.BaseManagerObjNode=s},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){var r=n(17),o=n(156);e.exports=function(e,t,n,r){return function(e,t,n,r){var i,s,a={},_=new o,u=function(e){var t=e.v!==i?e.v:e.w,r=a[t],o=n(e),u=s.distance+o;if(o<0)throw new Error("dijkstra does not allow negative edge weights. Bad edge: "+e+" Weight: "+o);u<r.distance&&(r.distance=u,r.predecessor=i,_.decrease(t,u))};e.nodes().forEach((function(e){var n=e===t?0:Number.POSITIVE_INFINITY;a[e]={distance:n},_.add(e,n)}));for(;_.size()>0&&(i=_.removeMin(),(s=a[i]).distance!==Number.POSITIVE_INFINITY);)r(i).forEach(u);return a}(e,String(t),n||i,r||function(t){return e.outEdges(t)})};var i=r.constant(1)},function(e,t,n){var r=n(17);function o(){this._arr=[],this._keyIndices={}}e.exports=o,o.prototype.size=function(){return this._arr.length},o.prototype.keys=function(){return this._arr.map((function(e){return e.key}))},o.prototype.has=function(e){return r.has(this._keyIndices,e)},o.prototype.priority=function(e){var t=this._keyIndices[e];if(void 0!==t)return this._arr[t].priority},o.prototype.min=function(){if(0===this.size())throw new Error("Queue underflow");return this._arr[0].key},o.prototype.add=function(e,t){var n=this._keyIndices;if(e=String(e),!r.has(n,e)){var o=this._arr,i=o.length;return n[e]=i,o.push({key:e,priority:t}),this._decrease(i),!0}return!1},o.prototype.removeMin=function(){this._swap(0,this._arr.length-1);var e=this._arr.pop();return delete this._keyIndices[e.key],this._heapify(0),e.key},o.prototype.decrease=function(e,t){var n=this._keyIndices[e];if(t>this._arr[n].priority)throw new Error("New priority is greater than current priority. Key: "+e+" Old: "+this._arr[n].priority+" New: "+t);this._arr[n].priority=t,this._decrease(n)},o.prototype._heapify=function(e){var t=this._arr,n=2*e,r=n+1,o=e;n<t.length&&(o=t[n].priority<t[o].priority?n:o,r<t.length&&(o=t[r].priority<t[o].priority?r:o),o!==e&&(this._swap(e,o),this._heapify(o)))},o.prototype._decrease=function(e){for(var t,n=this._arr,r=n[e].priority;0!==e&&!(n[t=e>>1].priority<r);)this._swap(e,t),e=t},o.prototype._swap=function(e,t){var n=this._arr,r=this._keyIndices,o=n[e],i=n[t];n[e]=i,n[t]=o,r[i.key]=e,r[o.key]=t}},function(e,t,n){var r=n(17);e.exports=function(e){var t=0,n=[],o={},i=[];return e.nodes().forEach((function(s){r.has(o,s)||function s(a){var _=o[a]={onStack:!0,lowlink:t,index:t++};if(n.push(a),e.successors(a).forEach((function(e){r.has(o,e)?o[e].onStack&&(_.lowlink=Math.min(_.lowlink,o[e].index)):(s(e),_.lowlink=Math.min(_.lowlink,o[e].lowlink))})),_.lowlink===_.index){var u,c=[];do{u=n.pop(),o[u].onStack=!1,c.push(u)}while(a!==u);i.push(c)}}(s)})),i}},function(e,t,n){var r=n(17);function o(e){var t={},n={},o=[];if(r.each(e.sinks(),(function s(a){if(r.has(n,a))throw new i;r.has(t,a)||(n[a]=!0,t[a]=!0,r.each(e.predecessors(a),s),delete n[a],o.push(a))})),r.size(t)!==e.nodeCount())throw new i;return o}function i(){}e.exports=o,o.CycleException=i,i.prototype=new Error},function(e,t,n){var r=n(17);e.exports=function(e,t,n){r.isArray(t)||(t=[t]);var o=(e.isDirected()?e.successors:e.neighbors).bind(e),i=[],s={};return r.each(t,(function(t){if(!e.hasNode(t))throw new Error("Graph does not have node: "+t);!function e(t,n,o,i,s,a){r.has(i,n)||(i[n]=!0,o||a.push(n),r.each(s(n),(function(n){e(t,n,o,i,s,a)})),o&&a.push(n))}(e,t,"post"===n,s,o,i)})),i}},,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=function(e){function t(){return e.call(this)||this}return r.__extends(t,e),t}(n(105).CoreObject);t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this.node=e}return e.prototype.on_update=function(){},e.prototype.set=function(e){this._state!=e&&(this._state=e,this.on_update())},Object.defineProperty(e.prototype,"active",{get:function(){return this._state},enumerable:!0,configurable:!0}),e.prototype.toggle=function(){this.set(!this._state)},e}();t.BaseFlag=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2).__importDefault(n(164)),o=n(31),i=n(28),s=function(){function e(e){this.node=e,this._graph_node=new o.CoreGraphNode(e.scene,"node_name_controller")}return Object.defineProperty(e.prototype,"graph_node",{get:function(){return this._graph_node},enumerable:!0,configurable:!0}),e.base_name=function(e){var t=e.type(),n=t[t.length-1];return r.default(parseInt(n))||(t+="_"),t+"1"},e.prototype.request_name_to_parent=function(e){var t=this.node.parent;null!=t?t.children_controller.set_child_name(this.node,e):console.warn("request_name_to_parent failed, no parent found")},e.prototype.set_name=function(e){e!=this.node.name&&this.request_name_to_parent(e)},e.prototype.update_name_from_parent=function(e){this.node.set_name(e),this.post_set_name(),this.post_set_full_path(),this.node.children_controller.children().forEach((function(e){e.name_controller.post_set_full_path()})),this._graph_node.set_successors_dirty(),this.node.emit(i.NodeEvent.NAME_UPDATED)},e.prototype.add_post_set_name_hook=function(e){this._on_set_name_hooks=this._on_set_name_hooks||[],this._on_set_name_hooks.push(e)},e.prototype.add_post_set_full_path_hook=function(e){this._on_set_full_path_hooks=this._on_set_full_path_hooks||[],this._on_set_full_path_hooks.push(e)},e.prototype.post_set_name=function(){if(this._on_set_name_hooks)for(var e=0,t=this._on_set_name_hooks;e<t.length;e++){(0,t[e])()}},e.prototype.post_set_full_path=function(){if(this._on_set_full_path_hooks)for(var e=0,t=this._on_set_full_path_hooks;e<t.length;e++){(0,t[e])()}},e}();t.NameController=s},,,,,,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(114),i=n(13),s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.type=function(){return i.ParamType.FLOAT},t.prototype.convert=function(e){return parseFloat(e)},t}(o.TypedNumericParam);t.FloatParam=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=function(){function e(e,t){this.node=e,this._callbacks=[],this._container=new t(this.node)}return Object.defineProperty(e.prototype,"container",{get:function(){return this._container},enumerable:!0,configurable:!0}),e.prototype.request_container=function(){var e=this;return new Promise((function(t,n){e._callbacks.push(t);var r=e.node.scene.cooker;r.blocked()?r.enqueue(e.node):setTimeout(e.process_container_request.bind(e),0)}))},e.prototype.process_container_request=function(){var e,t=this;if(null===(e=this.node.flags.bypass)||void 0===e?void 0:e.active){this.request_input_container_p(0).then((function(e){e?(t.node.remove_dirty_state(),t.notify_requesters(e)):t.node.states.error.set("input invalid")}))}else this.node.is_dirty?(this.node.container_controller.container.reset_caches(),this.node.cook_controller.cook_main()):this.notify_requesters()},e.prototype.request_input_container_p=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t;return r.__generator(this,(function(n){switch(n.label){case 0:return(t=this.node.io.inputs.input(e))?(t.processing_context.copy(this.node.processing_context),[4,t.container_controller.request_container()]):[3,2];case 1:return[2,n.sent()];case 2:return this.node.states.error.set("input "+e+" required"),this.notify_requesters(),[2,null]}}))}))},e.prototype.notify_requesters=function(e){for(var t,n=[];t=this._callbacks.pop();)n.push(t);for(e||(e=this.node.container_controller.container.clone());t=n.pop();)t(e)},e}();t.TypedContainerController=o;var i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t}(o);t.BaseContainerController=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=function(e){function t(t){var n=e.call(this)||this;return n._node=t,n}return r.__extends(t,e),t.prototype.set_node=function(e){this._node=e},t.prototype.node=function(){return this._node},t.prototype.clone=function(){var e,t=new this.constructor;return t.set_node(this.node()),null!=(e=this.content())&&t.set_content(e),t},t.prototype.reset_caches=function(){},t.prototype.set_content=function(e){this.reset_caches(),this._content=e,this._post_set_content()},t.prototype.has_content=function(){return null!=this._content},t.prototype.content=function(){return this._content},t.prototype._post_set_content=function(){},t.prototype.core_content=function(){return this._content},t.prototype.core_content_cloned=function(){return this._content},t.prototype.infos=function(){return[]},t}(n(105).CoreObject);t.TypedContainer=o;var i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t}(o);t.BaseContainer=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(1),o=n(24),i=n(7),s=n(76),a=n(13),_=function(){function e(){}return e.create_params=function(e){e.add_param(a.ParamType.VECTOR3,"t",[0,0,0]),e.add_param(a.ParamType.VECTOR3,"r",[0,0,0]),e.add_param(a.ParamType.VECTOR3,"s",[1,1,1]),e.add_param(a.ParamType.FLOAT,"scale",1,{range:[0,10]}),e.add_param(a.ParamType.OPERATOR_PATH,"look_at",""),e.add_param(a.ParamType.VECTOR3,"up",[0,1,0])},e.matrix_from_node_with_transform_params=function(e){var t=e.params.vector3("t"),n=e.params.vector3("r").clone().multiplyScalar(Math.PI/180),r=e.params.vector3("s"),o=e.params.float("scale");return this.matrix(t,n,r,o)},e.set_params_from_matrix=function(e,t,n){void 0===n&&(n={});var i=n.scale;null==i&&(i=!0);var a=new r.Vector3,_=new o.Quaternion,u=new r.Vector3;e.decompose(a,_,u);var c=(new s.Euler).setFromQuaternion(_).toVector3();c.divideScalar(Math.PI/180),t.scene.batch_update((function(){var e,n,r,o;null===(e=t.params.get("r"))||void 0===e||e.set(c.toArray()),null===(n=t.params.get("t"))||void 0===n||n.set(a.toArray()),null===(r=t.params.get("s"))||void 0===r||r.set(u.toArray()),i&&(null===(o=t.params.get("scale"))||void 0===o||o.set(1))}))},e.set_params_from_object=function(e,t){var n=e.position.toArray(),r=e.rotation.toArray().map((function(e){return e*(180/Math.PI)}));t.scene.batch_update((function(){var e,o;null===(e=t.params.get("t"))||void 0===e||e.set(n),null===(o=t.params.get("r"))||void 0===o||o.set(r)}))},e.translation_matrix=function(e,t,n){var s=new r.Vector3(e,t,n),a=new o.Quaternion,_=new r.Vector3(1,1,1),u=new i.Matrix4;return u.compose(s,a,_),u},e.matrix_quaternion=function(e){var t=new r.Vector3,n=new o.Quaternion,i=new r.Vector3;return e.decompose(t,n,i),n},e.matrix=function(e,t,n,r){n=n.clone().multiplyScalar(r);var a=new o.Quaternion,_=new s.Euler(t.x,t.y,t.z,"XYZ");a.setFromEuler(_);var u=new i.Matrix4;return u.compose(e,a,n),u},e.rotate_geometry_by_vector_difference=function(e,t,n){var r=new o.Quaternion;r.setFromUnitVectors(t,n.clone().normalize());var s=new i.Matrix4;s.makeRotationFromQuaternion(r),e.applyMatrix(s)},e}();t.CoreTransform=_},,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),console.log("start"),n(55);var r=n(180),o=n(107);new r.PolyScene,console.log(o.CoreString.precision(12.7,4),"12.7000"),console.log(o.CoreString.precision(12.75789465,4),"12.7578"),console.log(o.CoreString.precision(12,4),"12.0000"),console.log(o.CoreString.precision(12,4),"12.0000")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r={antialias:!0},o=function(){function e(){this._next_renderer_id=0,this._next_env_map_id=0,this._renderers={},this._env_maps={},this._require_webgl2=!1}return e.prototype.set_require_webgl2=function(){this._require_webgl2||(this._require_webgl2=!0)},e.prototype.rendering_context=function(e){var t=null;return this._require_webgl2&&(t=this._rendering_context_webgl(e,!0)),t||(t=this._rendering_context_webgl(e,!1)),t},e.prototype._rendering_context_webgl=function(e,t){var n=t?"webgl2":"webgl",o=e.getContext(n,r);return o||(n=t?"experimental-webgl2":"experimental-webgl",o=e.getContext(n,r)),o},e.prototype.register_renderer=function(e){if(e._polygon_id)throw new Error("render already registered");e._polygon_id=this._next_renderer_id+=1,this._renderers[e._polygon_id]=e},e.prototype.deregister_renderer=function(e){delete this._renderers[e._polygon_id],e.dispose()},e.prototype.first_renderer=function(){var e=Object.keys(this._renderers)[0];return e?this._renderers[e]:null},e.prototype.renderers=function(){return Object.values(this._renderers)},e}();t.RenderersController=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){this._node_register={},this._node_register_categories={},this._node_register_options={}}return e.prototype.register_node=function(e,t,n){var r=e.node_context(),o=e.type();if(this._node_register[r]=this._node_register[r]||{},this._node_register[r][o])throw new Error("node "+r+"/"+o+" already registered");this._node_register[r][o]=e,t&&(this._node_register_categories[r]=this._node_register_categories[r]||{},this._node_register_categories[r][o]=t),this._node_register_options[r]=this._node_register_options[r]||{},n&&(this._node_register_options[r][o]=n)},e.prototype.deregister_node=function(e,t){delete this._node_register[e][t],delete this._node_register_categories[e][t],delete this._node_register_options[e][t]},e.prototype.registered_nodes_for_context_and_parent_type=function(e,t){var n=this;return this._node_register[e]?Object.values(this._node_register[e]).filter((function(r){var o,i=n._node_register_options[e][r.type()];return!i||(null===(o=i.only)||void 0===o?void 0:o.includes(t))})):[]},e.prototype.registered_nodes=function(e,t){for(var n={},r=0,o=this.registered_nodes_for_context_and_parent_type(e,t);r<o.length;r++){var i=o[r];n[i.type()]=i}return n},e}();t.NodesRegister=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(181),o=n(182),i=n(183),s=n(301),a=n(302),_=n(303),u=n(304),c=n(306),p=n(419),l=n(421),d=n(423),h=n(424),f=n(425),m=n(117),y=function(){function e(){this._display_scene=new m.Scene,this._cameras_controller=new r.CamerasController(this),this._cooker=new o.Cooker,this._graph=new i.CoreGraph,this._missing_expression_references_controller=new u.MissingReferencesController,this._nodes_controller=new c.NodesController(this),this._time_controller=new l.TimeController(this),this._graph.set_scene(this),this.nodes_controller.init()}return Object.defineProperty(e.prototype,"display_scene",{get:function(){return this._display_scene},enumerable:!0,configurable:!0}),e.prototype.set_uuid=function(e){return this._uuid=e},Object.defineProperty(e.prototype,"uuid",{get:function(){return this._uuid},enumerable:!0,configurable:!0}),e.prototype.set_name=function(e){return this._name=e},Object.defineProperty(e.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cameras_controller",{get:function(){return this._cameras_controller},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cooker",{get:function(){return this._cooker},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"events_controller",{get:function(){return this._events_controller=this._events_controller||new s.EventsController(this)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"graph",{get:function(){return this._graph},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"lifecycle_controller",{get:function(){return this._lifecycle_controller=this._lifecycle_controller||new a.LifeCycleController(this)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"loading_controller",{get:function(){return this._loading_controller=this._loading_controller||new _.LoadingController(this)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"missing_expression_references_controller",{get:function(){return this._missing_expression_references_controller},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"nodes_controller",{get:function(){return this._nodes_controller},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"performance",{get:function(){return this._performance=this._performance||new p.CorePerformance},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"time_controller",{get:function(){return this._time_controller},enumerable:!0,configurable:!0}),e.prototype.set_frame=function(e){this.time_controller.set_frame(e)},Object.defineProperty(e.prototype,"frame",{get:function(){return this.time_controller.frame},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"frame_range",{get:function(){return this.time_controller.frame_range},enumerable:!0,configurable:!0}),e.prototype.play=function(){this.time_controller.play()},e.prototype.pause=function(){this.time_controller.pause()},Object.defineProperty(e.prototype,"serializer",{get:function(){return this._serializer=this._serializer||new d.Serializer(this)},enumerable:!0,configurable:!0}),e.prototype.to_json=function(){return this.serializer.to_json()},Object.defineProperty(e.prototype,"uniforms_controller",{get:function(){return this._uniforms_controller=this._uniforms_controller||new h.UniformsController(this)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"webgl_controller",{get:function(){return this._webgl_controller=this._webgl_controller||new f.WebGLController},enumerable:!0,configurable:!0}),e.prototype.batch_update=function(e){this._cooker.block(),e(),this._cooker.unblock()},e.prototype.node=function(e){return this.nodes_controller.node(e)},Object.defineProperty(e.prototype,"root",{get:function(){return this.nodes_controller.root},enumerable:!0,configurable:!0}),e}();t.PolyScene=y},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this.scene=e}return e.prototype.set_master_camera_node_path=function(e){this._master_camera_node_path=e},e.prototype.master_camera_node_path=function(){return this._master_camera_node_path},Object.defineProperty(e.prototype,"master_camera_node",{get:function(){var e=this.scene.node(this.master_camera_node_path());return e||(console.warn("master camera node not found"),this._find_any_camera())},enumerable:!0,configurable:!0}),e.prototype._find_any_camera=function(){var e=this.scene.root;return e.nodes_by_type("perspective_camera")[0]||e.nodes_by_type("orthographic_camera")[0]},e}();t.CamerasController=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){this._queue={},this._block_level=0,this._queue={},this._block_level=0}return e.prototype.block=function(){this._block_level+=1},e.prototype.unblock=function(){this._block_level-=1,this.process_queue()},e.prototype.blocked=function(){return this._block_level>0},e.prototype.enqueue=function(e){this._queue[e.graph_node_id]=e},e.prototype.process_queue=function(){if(!this.blocked())for(var e,t=0,n=Object.keys(this._queue);t<n.length;t++){var r=n[t];(e=this._queue[r])&&(delete this._queue[r],e.container_controller.process_container_request())}},e}();t.Cooker=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(184),o=function(){function e(){this._next_id=0,this._graph=new r.Graph({directed:!0,compound:!1,multigraph:!0})}return e.prototype.graph=function(){return this._graph},e.prototype.set_scene=function(e){this._scene=e},e.prototype.scene=function(){return this._scene},e.prototype.next_id=function(){return""+(this._next_id+=1)},e.prototype.setNode=function(e){this._graph.setNode(e.graph_node_id,e)},e.prototype.removeNode=function(e){this._graph.removeNode(e.graph_node_id)},e.prototype.nodes_from_ids=function(e){for(var t=[],n=0,r=e;n<r.length;n++){var o=r[n],i=this.node_from_id(o);i&&t.push(i)}return t},e.prototype.node_from_id=function(e){return this._graph.node(e)},e.prototype.connect=function(e,t){var n=e.graph_node_id,o=t.graph_node_id;if(this._graph.hasNode(n)&&this._graph.hasNode(o)){this._graph.setEdge(e.graph_node_id,t.graph_node_id);var i=!1;return!this.scene().loading_controller.is_loading&&(i=!r.alg.isAcyclic(this._graph)),i?(this._graph.removeEdge(e.graph_node_id,t.graph_node_id),!1):(e.dirty_controller.clear_successors_cache_with_predecessors(),!0)}return console.warn("attempt to connect non existing node "+n+" or "+o),!1},e.prototype.disconnect=function(e,t){if(e&&t){var n=e.graph_node_id,r=t.graph_node_id;this._graph.removeEdge(n,r),e.dirty_controller.clear_successors_cache_with_predecessors()}},e.prototype.disconnect_predecessors=function(e){for(var t=0,n=this.predecessors(e);t<n.length;t++){var r=n[t];this.disconnect(r,e)}},e.prototype.disconnect_successors=function(e){for(var t=0,n=this.successors(e);t<n.length;t++){var r=n[t];this.disconnect(e,r)}},e.prototype.predecessor_ids=function(e){return this._graph.predecessors(e)||[]},e.prototype.predecessors=function(e){var t=this.predecessor_ids(e.graph_node_id);return this.nodes_from_ids(t)},e.prototype.successor_ids=function(e){return this._graph.successors(e)||[]},e.prototype.successors=function(e){var t=this.successor_ids(e.graph_node_id)||[];return this.nodes_from_ids(t)},e.prototype.all_next_ids=function(e,t){for(var n=[],r=this[t](e.graph_node_id);r.length>0;){for(var o=[],i=0,s=r;i<s.length;i++)for(var a=s[i],_=0,u=this[t](a);_<u.length;_++){var c=u[_];o.push(c)}for(var p=0,l=r;p<l.length;p++){var d=l[p];n.push(d)}for(var h=0,f=o;h<f.length;h++){d=f[h];r.push(d)}r=o}return n},e.prototype.all_predecessor_ids=function(e){return this.all_next_ids(e,"predecessor_ids")},e.prototype.all_successor_ids=function(e){return this.all_next_ids(e,"successor_ids")},e.prototype.all_predecessors=function(e){var t=this.all_successor_ids(e);return this.nodes_from_ids(t)},e.prototype.all_successors=function(e){var t=this.all_successor_ids(e);return this.nodes_from_ids(t)},e}();t.CoreGraph=o},function(e,t,n){var r=n(185);e.exports={Graph:r.Graph,json:n(291),alg:n(292),version:r.version}},function(e,t,n){e.exports={Graph:n(80),version:n(290)}},,,,,,,,,,,,function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t){e.exports="2.1.9-pre"},function(e,t,n){var r=n(17),o=n(80);function i(e){return r.map(e.nodes(),(function(t){var n=e.node(t),o=e.parent(t),i={v:t};return r.isUndefined(n)||(i.value=n),r.isUndefined(o)||(i.parent=o),i}))}function s(e){return r.map(e.edges(),(function(t){var n=e.edge(t),o={v:t.v,w:t.w};return r.isUndefined(t.name)||(o.name=t.name),r.isUndefined(n)||(o.value=n),o}))}e.exports={write:function(e){var t={options:{directed:e.isDirected(),multigraph:e.isMultigraph(),compound:e.isCompound()},nodes:i(e),edges:s(e)};r.isUndefined(e.graph())||(t.value=r.clone(e.graph()));return t},read:function(e){var t=new o(e.options).setGraph(e.value);return r.each(e.nodes,(function(e){t.setNode(e.v,e.value),e.parent&&t.setParent(e.v,e.parent)})),r.each(e.edges,(function(e){t.setEdge({v:e.v,w:e.w,name:e.name},e.value)})),t}}},function(e,t,n){e.exports={components:n(293),dijkstra:n(155),dijkstraAll:n(294),findCycles:n(295),floydWarshall:n(296),isAcyclic:n(297),postorder:n(298),preorder:n(299),prim:n(300),tarjan:n(157),topsort:n(158)}},function(e,t,n){var r=n(17);e.exports=function(e){var t,n={},o=[];function i(o){r.has(n,o)||(n[o]=!0,t.push(o),r.each(e.successors(o),i),r.each(e.predecessors(o),i))}return r.each(e.nodes(),(function(e){t=[],i(e),t.length&&o.push(t)})),o}},function(e,t,n){var r=n(155),o=n(17);e.exports=function(e,t,n){return o.transform(e.nodes(),(function(o,i){o[i]=r(e,i,t,n)}),{})}},function(e,t,n){var r=n(17),o=n(157);e.exports=function(e){return r.filter(o(e),(function(t){return t.length>1||1===t.length&&e.hasEdge(t[0],t[0])}))}},function(e,t,n){var r=n(17);e.exports=function(e,t,n){return function(e,t,n){var r={},o=e.nodes();return o.forEach((function(e){r[e]={},r[e][e]={distance:0},o.forEach((function(t){e!==t&&(r[e][t]={distance:Number.POSITIVE_INFINITY})})),n(e).forEach((function(n){var o=n.v===e?n.w:n.v,i=t(n);r[e][o]={distance:i,predecessor:e}}))})),o.forEach((function(e){var t=r[e];o.forEach((function(n){var i=r[n];o.forEach((function(n){var r=i[e],o=t[n],s=i[n],a=r.distance+o.distance;a<s.distance&&(s.distance=a,s.predecessor=o.predecessor)}))}))})),r}(e,t||o,n||function(t){return e.outEdges(t)})};var o=r.constant(1)},function(e,t,n){var r=n(158);e.exports=function(e){try{r(e)}catch(e){if(e instanceof r.CycleException)return!1;throw e}return!0}},function(e,t,n){var r=n(159);e.exports=function(e,t){return r(e,t,"post")}},function(e,t,n){var r=n(159);e.exports=function(e,t){return r(e,t,"pre")}},function(e,t,n){var r=n(17),o=n(80),i=n(156);e.exports=function(e,t){var n,s=new o,a={},_=new i;function u(e){var r=e.v===n?e.w:e.v,o=_.priority(r);if(void 0!==o){var i=t(e);i<o&&(a[r]=n,_.decrease(r,i))}}if(0===e.nodeCount())return s;r.each(e.nodes(),(function(e){_.add(e,Number.POSITIVE_INFINITY),s.setNode(e)})),_.decrease(e.nodes()[0],0);var c=!1;for(;_.size()>0;){if(n=_.removeMin(),r.has(a,n))s.setEdge(n,a[n]);else{if(c)throw new Error("Input graph is not connected: "+e);c=!0}e.nodeEdges(n).forEach(u)}return s}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n(55);var r=function(){function e(e){this.scene=e}return e.prototype.set_store=function(e){this._events_listener=e},Object.defineProperty(e.prototype,"events_listener",{get:function(){return this._events_listener},enumerable:!0,configurable:!0}),e.prototype.dispatch=function(e,t,n){var r;void 0===n&&(n={}),null===(r=this._events_listener)||void 0===r||r.process_events(e,t,n)},Object.defineProperty(e.prototype,"emit_allowed",{get:function(){return this.scene.loading_controller.loaded&&this._events_listener&&this.scene.loading_controller.auto_updating&&!POLY.player_mode()},enumerable:!0,configurable:!0}),e}();t.EventsController=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this.scene=e,this._lifecycle_on_create_allowed=!0}return e.prototype.on_create_hook_allowed=function(){return this.scene.loading_controller.loaded&&this._lifecycle_on_create_allowed},e.prototype.on_create_prevent=function(e){this._lifecycle_on_create_allowed=!1,e(),this._lifecycle_on_create_allowed=!0},e}();t.LifeCycleController=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=function(){function e(e){this.scene=e,this._first_object_loaded=!1}return e.prototype.mark_as_loading=function(){this._set_loading_state(!0)},e.prototype.mark_as_loaded=function(){this._set_loading_state(!1),POLY.notify_scene_loaded(this.scene)},e.prototype._set_loading_state=function(e){this._loading_state=e,this.set_auto_update(!this._loading_state)},Object.defineProperty(e.prototype,"is_loading",{get:function(){return this._loading_state},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"loaded",{get:function(){return!this._loading_state},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"auto_updating",{get:function(){return this._auto_updating},enumerable:!0,configurable:!0}),e.prototype.set_auto_update=function(e){var t=this;if(this._auto_updating!==e&&(this._auto_updating=e,this._auto_updating)){var n=this.scene.root;if(n){setTimeout((function(){return r.__awaiter(t,void 0,void 0,(function(){return r.__generator(this,(function(e){switch(e.label){case 0:return[4,n.process_queue()];case 1:return e.sent(),[2]}}))}))}),50)}}},e.prototype.on_first_object_loaded=function(){var e;if(!this._first_object_loaded){this._first_object_loaded=!0;var t=document.getElementById("scene_loading_container");t&&(null===(e=t.parentElement)||void 0===e||e.removeChild(t))}},e.prototype.on_all_objects_loaded=function(){},e}();t.LoadingController=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(305),o=function(){function e(){this.references={},this.next_id=0,this.next_id_s="0"}return e.prototype.register=function(e,t,n){var o=this.next_id_s,i=new r.MissingExpressionReference(e,t,n,o);return this.references[n]=this.references[n]||{},this.references[n][o]=i,this.next_id+=1,this.next_id_s=""+this.next_id,i},e.prototype.unregister=function(e){this.references[e.full_path]&&delete this.references[e.full_path][e.id]},e.prototype.check_for_references=function(e){var t=e.full_path(),n=this.references[t];n&&(Object.keys(n).forEach((function(t){n[t].resolve_with_node(e)})),delete this.references[t])},e}();t.MissingReferencesController=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t,n,r){this.param=e,this.jsep_node=t,this.full_path=n,this.id=r,console.log(this.jsep_node,this.param)}return e.prototype.resolve_with_node=function(e){console.warn("this should not work! REFACTOR asap")},e}();t.MissingExpressionReference=r;var o=function(){function e(){this.found_graph_nodes=[],this.missing_paths=[]}return e.prototype.set_found_graph_nodes=function(e){this.found_graph_nodes=e},e.prototype.set_missing_paths=function(e){this.missing_paths=e},e}();t.ReferenceSearchResult=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=r.__importDefault(n(307)),i=r.__importDefault(n(160)),s=r.__importDefault(n(71)),a=n(308),_=n(107),u=function(){function e(e){this.scene=e,this._node_context_signatures={},this._instanciated_nodes_by_context_and_type={}}return e.prototype.init=function(){this._root=new a.ObjectsManagerNode(this.scene),this._root.init_display_scene()},Object.defineProperty(e.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),e.prototype.objects_from_mask=function(e){var t=e.split(" "),n=this.root.children(),r=(n=n.filter((function(e){return _.CoreString.matches_one_mask(e.name,t)}))).map((function(e){return e.object}));return s.default(r)},e.prototype.clear=function(){for(var e=0,t=this.root.children();e<t.length;e++){var n=t[e];this.root.children_controller.remove_node(n)}},e.prototype.node=function(e){return"/"===e?this.root:this.root.node(e)},e.prototype.all_nodes=function(){for(var e=[this.root],t=[this.root],n=0;t.length>0&&n<10;){var r=i.default(t.map((function(e){return e.children_controller.children_allowed()?e.children():[]})));e=o.default(e,r),t=r,n+=1}return i.default(e)},e.prototype.reset_node_context_signatures=function(){this._node_context_signatures={}},e.prototype.register_node_context_signature=function(e){this._node_context_signatures[e.children_controller.node_context_signature()]=!0},e.prototype.node_context_signatures=function(){return Object.keys(this._node_context_signatures).sort().map((function(e){return e.toLowerCase()}))},e.prototype.add_to_instanciated_node=function(e){var t=e.node_context(),n=e.type();this._instanciated_nodes_by_context_and_type[t]=this._instanciated_nodes_by_context_and_type[t]||{},this._instanciated_nodes_by_context_and_type[t][n]=this._instanciated_nodes_by_context_and_type[t][n]||{},this._instanciated_nodes_by_context_and_type[t][n][e.graph_node_id]=e},e.prototype.remove_from_instanciated_node=function(e){var t=e.node_context(),n=e.type();delete this._instanciated_nodes_by_context_and_type[t][n][e.graph_node_id]},e.prototype.instanciated_nodes=function(e,t){var n=[];if(this._instanciated_nodes_by_context_and_type[e]){var r=this._instanciated_nodes_by_context_and_type[e][t];if(r)for(var o=0,i=Object.keys(r);o<i.length;o++){var s=i[o];n.push(r[s])}}return n},e}();t.NodesController=u},,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(75),i=r.__importDefault(n(103)),s=r.__importDefault(n(147)),a=n(309),_=n(105),u=n(115),c=n(399),p=n(413),l=n(414),d=n(415),h=n(416);n(55);var f=n(38),m=new(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t}(n(74).NodeParamsConfig)),y=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=m,t._object=new o.Group,t._queued_nodes_by_id={},t._queued_nodes_by_path={},t._expected_geo_nodes={},t._loaded_geo_node_by_id={},t}return r.__extends(t,e),t.type=function(){return"obj"},t.prototype.initialize_node=function(){this.children_controller.init(f.NodeContext.OBJ),this.flags.add_display()},t.prototype.init_display_scene=function(){this._object.name="_WORLD_",this._scene.display_scene.add(this._object)},t.prototype.object=function(){return this._object},t.prototype.create_node=function(t){return e.prototype.create_node.call(this,t)},t.prototype.children=function(){return e.prototype.children.call(this)},t.prototype.nodes_by_type=function(t){return e.prototype.nodes_by_type.call(this,t)},t.prototype.multiple_display_flags_allowed=function(){return!0},t.prototype.add_to_queue=function(e){var t=e.graph_node_id;if(null==this._queued_nodes_by_id[t])return this._queued_nodes_by_id[t]=e},t.prototype.process_queue=function(){return r.__awaiter(this,void 0,void 0,(function(){var e,t,n,o,i,a,_,u,c,p=this;return r.__generator(this,(function(r){switch(r.label){case 0:for(this._queued_nodes_by_path={},e=Object.keys(this._queued_nodes_by_id),t=0,n=e;t<n.length;t++)o=n[t],i=this._queued_nodes_by_id[o],delete this._queued_nodes_by_id[o],a=i.full_path(),this._is_node_manager(i)?a="/_____005_"+a:this._is_node_fog(i)?a="/_____002_"+a:this._is_node_camera(i)?a="/_____003_"+a:this._is_node_light(i)&&(a="/_____004_"+a),this._queued_nodes_by_path[a]=i;return _=s.default(Object.keys(this._queued_nodes_by_path).sort(),(function(e){var t=p._queued_nodes_by_path[e];return p.update_object(t)})),u=this,(c=this._expected_geo_nodes)?[3,2]:[4,this.expected_loading_geo_nodes_by_id()];case 1:c=r.sent(),r.label=2;case 2:return u._expected_geo_nodes=c,this._process_queue_start=performance.now(),Promise.all(_).then((function(){POLY.log("SCENE LOADED '"+p.scene.name+"' in "+(performance.now()-p._process_queue_start)),0==Object.keys(p._expected_geo_nodes).length&&p.update_on_all_objects_loaded()})),[2]}}))}))},t.prototype.update_object=function(e){var t=this;return new Promise((function(n,r){return t.scene.loading_controller.auto_updating?(e.object&&t.add_to_scene(e),n()):(t.add_to_queue(e),n())}))},t.prototype._is_node_manager=function(e){return _.CoreObject.is_a(e,u.BaseManagerObjNode)},t.prototype._is_node_fog=function(e){return _.CoreObject.is_a(e,h.FogObjNode)},t.prototype._is_node_camera=function(e){return _.CoreObject.is_a(e,c.BaseCameraObjNodeClass)},t.prototype._is_node_light=function(e){return _.CoreObject.is_a(e,p.BaseLightObjNode)},t.prototype._is_node_event=function(e){return _.CoreObject.is_a(e,l.EventsObjNode)},t.prototype._is_node_mat=function(e){return _.CoreObject.is_a(e,d.MaterialsObjNode)},t.prototype.get_parent_for_node=function(e){if(this._is_node_event(e)||this._is_node_mat(e))return null;if(this._is_node_camera(e))return this.scene.display_scene;var t=e.io.inputs.input(0);return null!=t?t.object:this._object},t.prototype.add_to_scene=function(e){if(this._is_node_fog(e));else{var t=this.get_parent_for_node(e);if(null!=t)return e.params.eval_all().then((function(t){return e.request_container()})),t.add(e.object),e.request_display_node();e.request_container().then((function(){e.children_controller.traverse_children((function(e){return e.set_dirty()}))}))}},t.prototype.remove_from_scene=function(e){if(!this._is_node_fog(e)){var t=e.object;if(null!=t){var n=t.parent;null!=n&&n.remove(t)}}},t.prototype.are_children_cooking=function(){for(var e=0,t=this.children();e<t.length;e++){if(t[e].is_display_node_cooking())return!0}return!1},t.prototype.expected_loading_geo_nodes_by_id=function(){return r.__awaiter(this,void 0,void 0,(function(){var e,t,n,o,i;return r.__generator(this,(function(r){switch(r.label){case 0:e=this.nodes_by_type("geo"),t={},n=0,o=e,r.label=1;case 1:return n<o.length?[4,(i=o[n]).is_displayed()]:[3,4];case 2:r.sent()&&(t[i.graph_node_id]=i),r.label=3;case 3:return n++,[3,1];case 4:return[2,t]}}))}))},t.prototype.notify_geo_loaded=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,n;return r.__generator(this,(function(r){switch(r.label){case 0:return this._loaded_geo_node_by_id=this._loaded_geo_node_by_id||{},this._loaded_geo_node_by_id[e.graph_node_id]=!0,t=this,(n=this._expected_geo_nodes)?[3,2]:[4,this.expected_loading_geo_nodes_by_id()];case 1:n=r.sent(),r.label=2;case 2:return t._expected_geo_nodes=n,this.scene&&(this.scene.loading_controller.on_first_object_loaded(),i.default(Object.keys(this._loaded_geo_node_by_id),Object.keys(this._expected_geo_nodes))&&this.update_on_all_objects_loaded()),[2]}}))}))},t.prototype.update_on_all_objects_loaded=function(){this.scene.loading_controller.on_all_objects_loaded()},t.prototype.add_to_parent_transform=function(e){this.update_object(e)},t.prototype.remove_from_parent_transform=function(e){this.update_object(e)},t.prototype.on_child_add=function(e){this.update_object(e)},t.prototype.on_child_remove=function(e){this.remove_from_scene(e)},t}(a.TypedNodeManager);t.ObjectsManagerNode=y},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(104),i=n(38),s=n(173),a=n(392),_=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.container_controller=new s.TypedContainerController(t,a.ManagerContainer),t}return r.__extends(t,e),t.node_context=function(){return i.NodeContext.MANAGER},t}(o.TypedNode);t.TypedNodeManager=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this.node=e,this._dirty_count=0,this._dirty=!0,this._dirty_timestamp=null,this._post_dirty_hooks=[]}return Object.defineProperty(e.prototype,"is_dirty",{get:function(){return!0===this._dirty},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dirty_timestamp",{get:function(){return this._dirty_timestamp},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dirty_count",{get:function(){return this._dirty_count},enumerable:!0,configurable:!0}),e.prototype.add_post_dirty_hook=function(e){this._post_dirty_hooks=this._post_dirty_hooks||[],this._post_dirty_hooks.push(e)},e.prototype.remove_dirty_state=function(){this._dirty=!1},e.prototype.set_dirty=function(e,t){null==t&&(t=!0),null==e&&(e=this.node),this._dirty=!0,this._dirty_timestamp=performance.now(),this._dirty_count+=1,this.run_post_dirty_hooks(e),!0===t&&this.set_successors_dirty(e)},e.prototype.run_post_dirty_hooks=function(e){if(this._post_dirty_hooks)for(var t=0,n=this._post_dirty_hooks;t<n.length;t++){(0,n[t])(e)}},e.prototype.set_successors_dirty=function(e){var t=this.node.scene.cooker;t.block();this._cached_successors=this._cached_successors||this.node.graph_all_successors();for(var n=0,r=this._cached_successors;n<r.length;n++){r[n].dirty_controller.set_dirty(e,!1)}t.unblock()},e.prototype.clear_successors_cache=function(){this._cached_successors=[]},e.prototype.clear_successors_cache_with_predecessors=function(){this.clear_successors_cache();for(var e=0,t=this.node.graph_all_predecessors();e<t.length;e++){t[e].dirty_controller.clear_successors_cache()}},e}();t.DirtyController=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=r.__importDefault(n(161)),i=n(3),s=n(4),a=n(28),_=function(e){function t(t,n,r){void 0===n&&(n=0),void 0===r&&(r=0);var o=e.call(this)||this;return o.node=t,o._width=50,o._border_radius=3,o._color=new s.Color(.75,.75,.75),o._icon=null,o._layout_vertical=!0,o._position=new i.Vector2(n||0,r||0),o}return r.__extends(t,e),t.prototype.set_border_radius=function(e){this._border_radius=e},t.prototype.border_radius=function(){return this._border_radius},t.prototype.set_width=function(e){this._width=e},t.prototype.width=function(){return this._width},t.prototype.set_comment=function(e){this._comment=e,this.node.emit(a.NodeEvent.UI_DATA_UPDATED,this.to_json())},t.prototype.comment=function(){return this._comment},t.prototype.set_color=function(e){this._color=e},t.prototype.color=function(){return this._color},t.prototype.set_icon=function(e){this._icon=e},t.prototype.icon=function(){return this._icon},t.prototype.set_layout_horizontal=function(){this._layout_vertical=!1},t.prototype.is_layout_vertical=function(){return this._layout_vertical},t.prototype.copy=function(e){this._position.copy(e.position()),this._color.copy(e.color())},t.prototype.position=function(){return this._position},t.prototype.set_position=function(e){this._position.copy(e),this.node.emit(a.NodeEvent.UI_DATA_UPDATED,this.to_json())},t.prototype.translate=function(e,t){void 0===t&&(t=!1),this._position.add(e),t&&(this._position.x=Math.round(this._position.x),this._position.y=Math.round(this._position.y)),this.node.emit(a.NodeEvent.UI_DATA_UPDATED,this.to_json())},t.prototype.to_json=function(){return{x:this._position.x,y:this._position.y,comment:this._comment}},t}(o.default);t.UIData=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(313),o=n(314),i=function(){function e(e){this.node=e}return e.prototype.add_bypass=function(){this._bypass?console.warn("bypass flag already created",this.node):this._bypass=new r.BypassFlag(this.node)},Object.defineProperty(e.prototype,"bypass",{get:function(){return this._bypass},enumerable:!0,configurable:!0}),e.prototype.has_bypass=function(){return null!=this._bypass},e.prototype.add_display=function(){this._display?console.warn("display flag already created",this.node):this._display=new o.DisplayFlag(this.node)},Object.defineProperty(e.prototype,"display",{get:function(){return this._display},enumerable:!0,configurable:!0}),e.prototype.has_display=function(){return null!=this._display},e}();t.FlagsController=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(162),i=n(28),s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.on_update=function(){this.node.emit(i.NodeEvent.FLAG_BYPASS_UPDATED),this.node.set_dirty()},t}(o.BaseFlag);t.BypassFlag=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(162),i=n(28),s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.on_update=function(){this.node.emit(i.NodeEvent.FLAG_DISPLAY_UPDATED),this.node.set_dirty()},t}(o.BaseFlag);t.DisplayFlag=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(316),o=n(317),i=function(e){this.node=e,this.time_dependent=new r.TimeDependentState(this.node),this.error=new o.ErrorState(this.node)};t.StatesController=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this.node=e}return Object.defineProperty(e.prototype,"active",{get:function(){return this.are_params_time_dependent()||this.are_inputs_time_dependent()},enumerable:!0,configurable:!0}),e.prototype.are_params_time_dependent=function(){for(var e=0,t=this.node.params.names;e<t.length;e++){var n=t[e],r=this.node.params.get(n);if(r&&r.states.time_dependent.active)return!0}return!1},e.prototype.are_inputs_time_dependent=function(){for(var e=0,t=this.node.io.inputs.inputs();e<t.length;e++){var n=t[e];if(n&&n.states.time_dependent.active)return!0}return!1},e}();t.TimeDependentState=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(28),o=function(){function e(e){this.node=e}return e.prototype.set=function(e){this._message!=e&&(this._message=e,this.on_update())},Object.defineProperty(e.prototype,"message",{get:function(){return this._message},enumerable:!0,configurable:!0}),e.prototype.clear=function(){this.set(null)},Object.defineProperty(e.prototype,"active",{get:function(){return null!=this._message},enumerable:!0,configurable:!0}),e.prototype.on_update=function(){null!=this._message&&this.node.set_container(null,"from error '"+this._message+"'"),this.node.emit(r.NodeEvent.ERROR_UPDATED)},e}();t.ErrorState=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(163),o=n(72),i=function(){function e(e){this.node=e}return Object.defineProperty(e.prototype,"parent",{get:function(){return this._parent},enumerable:!0,configurable:!0}),e.prototype.set_parent=function(e){e!=this.node.parent_controller.parent&&(this._parent=e,this._parent&&this.node.name_controller.request_name_to_parent(r.NameController.base_name(this.node)))},e.prototype.is_selected=function(){var e,t;return null===(t=null===(e=this.parent)||void 0===e?void 0:e.selection)||void 0===t?void 0:t.contains(this.node)},e.prototype.full_path=function(){var e=o.CoreWalker.SEPARATOR;if(null!=this._parent){var t=this._parent.full_path();return t===e?t+this.node.name:t+e+this.node.name}return e},e.prototype.on_set_parent=function(){if(this._on_set_parent_hooks)for(var e=0,t=this._on_set_parent_hooks;e<t.length;e++){(0,t[e])()}},e}();t.HierarchyParentController=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){}return e.separator=function(){return"/"},e.find_node=function(e,t,n){if(!e)return null;var r=t.split("/").filter((function(e){return e.length>0})),o=r[0],i=null;if("/"!==t[0]){switch(o){case"..":i=e.parent;break;case".":i=e;break;default:i=e.node(o)}if(i&&n&&n.add_node(o,i),null!=i&&r.length>1){var s=r.slice(1).join("/");i=this.find_node(i,s,n)}return i}var a=t.substr(1);return i=this.find_node(e.root,a,n)},e}();t.CoreWalkerEmbed=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(107),i=n(72),s=n(31),a=r.__importDefault(n(343)),_=r.__importDefault(n(30)),u=r.__importDefault(n(111)),c=r.__importDefault(n(102)),p=n(28),l=function(){function e(e){this.node=e,this._children_allowed=!1,this._children_by_type={},this._children_and_grandchildren_by_context={},this._is_dependent_on_children=!1}return e.prototype.init=function(e,t){void 0===t&&(t=!1),this._context=e,this._children_allowed=!0,this._children={},t&&(this._is_dependent_on_children=t,this._is_dependent_on_children&&(this._children_node=new s.CoreGraphNode(this.node.scene,"children"),this.node.add_graph_input(this._children_node)))},Object.defineProperty(e.prototype,"context",{get:function(){return this._context},enumerable:!0,configurable:!0}),e.prototype.set_child_name=function(e,t){var n;if(t=(t=t.replace(/[^A-Za-z0-9]/g,"_")).replace(/^[0-9]/,"_"),null!=(n=this._children[t])){if(e.name===t&&n.graph_node_id===e.graph_node_id)return;return t=o.CoreString.increment(t),this.set_child_name(e,t)}var r=e.name;this._children[r]&&delete this._children[r],this._children[t]=e,e.name_controller.update_name_from_parent(t),this._add_to_nodes_by_type(e),this.node.scene.nodes_controller.add_to_instanciated_node(e)},e.prototype.node_context_signature=function(){return this.node.node_context()+"/"+this.node.type()},e.prototype.available_children_classes=function(){return POLY.registered_nodes(this._context,this.node.type())},e.prototype.children_allowed=function(){var e=this.available_children_classes();return e&&Object.keys(e).length>0},e.prototype.create_node=function(e){if(null==this.available_children_classes())throw"no children available for "+this.node.full_path()+".";var t=this.available_children_classes()[e];if(null==t){var n="node type "+e+" not found for "+this.node.full_path()+" ("+Object.keys(this.available_children_classes()).join(", ")+", "+this._context+", "+this.node.type()+")";throw console.error(n),n}var r=new t(this.node.scene,"child_node_"+e);return this.add_node(r),r},e.prototype.add_node=function(e){if(!this._children_allowed)throw"node "+this.node.full_path()+" cannot have children";e.set_parent(this.node),e.params.init(),e.parent_controller.on_set_parent(),e.name_controller.post_set_full_path();for(var t=0,n=e.children_controller.children();t<n.length;t++){n[t].name_controller.post_set_full_path()}return this.node.emit(p.NodeEvent.CREATED,{child_node:e}),this.node.lifecycle.on_child_add(e),this.node.scene.lifecycle_controller.on_create_hook_allowed()&&e.lifecycle.on_create(),this._is_dependent_on_children&&this._children_node.add_graph_input(e),e.require_webgl2()&&this.node.scene.webgl_controller.set_require_webgl2(),e},e.prototype.remove_node=function(e){if(e.parent!=this.node)return console.warn("node "+e.name+" not under parent "+this.node.full_path());e.set_dirty(this.node),this._is_dependent_on_children&&this._children_node.remove_graph_input(e),this.node.selection.contains(e)&&this.node.selection.remove([e]);var t=e.io.connections.first_input_connection();return e.io.connections.input_connections().forEach((function(e){e&&e.disconnect({set_input:!0})})),e.io.connections.output_connections().forEach((function(e){if(e&&(e.disconnect({set_input:!0}),t)){var n=t.node_src,r=e.output_index,o=e.node_dest,i=e.input_index;o.io.inputs.set_input(i,n,r)}})),e.graph_disconnect_successors(),e.set_parent(null),delete this._children[e.name],this._remove_from_nodes_by_type(e),this.node.scene.nodes_controller.remove_from_instanciated_node(e),this.node.lifecycle.on_child_remove(e),e.lifecycle.on_delete(),e.emit(p.NodeEvent.DELETED,{parent:this.node}),e},e.prototype.find_node=function(e){if(!this._children_allowed)return null;if(null==e)return null;if(e===i.CoreWalker.CURRENT||e===i.CoreWalker.CURRENT_WITH_SLASH)return this.node;if(e===i.CoreWalker.PARENT||e===i.CoreWalker.PARENT_WITH_SLASH)return this.node.parent;var t=i.CoreWalker.separator();e[0]===t&&(e=e.substring(1,e.length));var n=e.split(t);if(1===n.length){var r=n[0];return this._children[r]}return i.CoreWalker.find_node(this.node,e)},e.prototype._add_to_nodes_by_type=function(e){var t=e.graph_node_id,n=e.type();this._children_by_type[n]=this._children_by_type[n]||[],a.default(this._children_by_type[n],t)||this._children_by_type[n].push(t),this.add_to_children_and_grandchildren_by_context(e)},e.prototype._remove_from_nodes_by_type=function(e){var t=e.graph_node_id,n=e.type();if(this._children_by_type[n]){var r=this._children_by_type[n].indexOf(t);r>=0&&(this._children_by_type[n].splice(r,1),0==this._children_by_type[n].length&&delete this._children_by_type[n])}this.remove_from_children_and_grandchildren_by_context(e)},e.prototype.add_to_children_and_grandchildren_by_context=function(e){var t=e.graph_node_id,n=e.node_context();this._children_and_grandchildren_by_context[n]=this._children_and_grandchildren_by_context[n]||[],a.default(this._children_and_grandchildren_by_context[n],t)||this._children_and_grandchildren_by_context[n].push(t),this.node.parent&&this.node.parent.children_controller.add_to_children_and_grandchildren_by_context(e)},e.prototype.remove_from_children_and_grandchildren_by_context=function(e){var t=e.graph_node_id,n=e.node_context();if(this._children_and_grandchildren_by_context[n]){var r=this._children_and_grandchildren_by_context[n].indexOf(t);r>=0&&(this._children_and_grandchildren_by_context[n].splice(r,1),0==this._children_and_grandchildren_by_context[n].length&&delete this._children_and_grandchildren_by_context[n])}this.node.parent&&this.node.parent.children_controller.remove_from_children_and_grandchildren_by_context(e)},e.prototype.nodes_by_type=function(e){var t=this._children_by_type[e]||[],n=this.node.scene.graph;return t.map((function(e){return n.node_from_id(e)}))},e.prototype.has_children_and_grandchildren_with_context=function(e){return null!=this._children_and_grandchildren_by_context[e]},e.prototype.children=function(){return c.default(this._children)},e.prototype.children_names=function(){return u.default(_.default(this._children))},e.prototype.traverse_children=function(e){for(var t,n=0,r=this.children();n<r.length;n++){var o=r[n];e(o),null===(t=o.children_controller)||void 0===t||t.traverse_children(e)}},e}();t.HierarchyChildrenController=l},,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this.node=e,this._on_child_add_hooks=[],this._on_child_remove_hooks=[],this._on_create_hooks=[],this._on_delete_hooks=[]}return e.prototype.add_on_child_add_hook=function(e){this._on_child_add_hooks.push(e)},e.prototype.on_child_add=function(e){this.execute_hooks_with_child_node(this._on_child_add_hooks,e)},e.prototype.add_on_child_remove_hook=function(e){this._on_child_remove_hooks.push(e)},e.prototype.on_child_remove=function(e){this.execute_hooks_with_child_node(this._on_child_add_hooks,e)},e.prototype.add_create_hook=function(e){this._on_create_hooks.push(e)},e.prototype.on_create=function(){this.execute_hooks(this._on_create_hooks)},e.prototype.add_delete_hook=function(e){this._on_delete_hooks.push(e)},e.prototype.on_delete=function(){this.execute_hooks(this._on_delete_hooks)},e.prototype.execute_hooks=function(e){for(var t=0,n=e;t<n.length;t++){(0,n[t])(this.node)}},e.prototype.execute_hooks_with_child_node=function(e,t){for(var n=0,r=e;n<r.length;n++){(0,r[n])(this.node,t)}},e}();t.LifeCycleController=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=function(){function e(e){this.node=e,this._cooking=!1,this._cooks_count=0,this._max_cook_time=-1}return Object.defineProperty(e.prototype,"is_cooking",{get:function(){return!0===this._cooking},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cooks_count",{get:function(){return this._cooks_count},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cook_time",{get:function(){return this._cook_time},enumerable:!0,configurable:!0}),e.prototype._init_cooking_state=function(){this._cooking=!0},e.prototype._init_cooking_start_time=function(e){null==e&&(e=this.node.scene.performance.recording_started()),e&&(this._cook_time_start=performance.now())},e.prototype._start_cook_if_no_errors=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t;return r.__generator(this,(function(n){switch(n.label){case 0:return this.node.states.error.active?(this.end_cook(),[3,4]):[3,1];case 1:return n.trys.push([1,3,,4]),[4,this.node.cook(e)];case 2:return n.sent(),[3,4];case 3:return t=n.sent(),this.node.states.error.set("node internal error: '"+t+"'."),console.error(this.node.full_path(),t),this.end_cook(),[3,4];case 4:return[2]}}))}))},e.prototype.cook_main=function(){return r.__awaiter(this,void 0,void 0,(function(){var e,t,n,o,i;return r.__generator(this,(function(r){switch(r.label){case 0:return this.is_cooking?[2]:(this._init_cooking_state(),this._cooking_dirty_timestamp=this.node.dirty_controller.dirty_timestamp,(e=this.node.scene.performance.recording_started())&&(this._cook_time_with_inputs_start=performance.now()),this.node.states.error.clear(),[4,this.evaluate_inputs_and_params()]);case 1:if(t=r.sent(),this._init_cooking_start_time(e),n=[],t)for(o=void 0,i=0;i<t.length;i++)(o=t[i])&&(this.node.io.inputs.input_clonable_state_with_override(i)?n.push(o.core_content_cloned()):n.push(o.core_content()));return[4,this._start_cook_if_no_errors(n)];case 2:return r.sent(),[2]}}))}))},e.prototype.cook_main_without_inputs=function(){return r.__awaiter(this,void 0,void 0,(function(){var e;return r.__generator(this,(function(t){switch(t.label){case 0:return this.is_cooking?[2]:(this._init_cooking_state(),e=this.node.scene.performance.recording_started(),this._init_cooking_start_time(e),this.node.states.error.clear(),[4,this.node.params.eval_all()]);case 1:return t.sent(),[4,this._start_cook_if_no_errors([])];case 2:return t.sent(),[2]}}))}))},e.prototype.end_cook=function(e){this._increase_cooks_count();var t=this.node.dirty_controller.dirty_timestamp;null==t||t===this._cooking_dirty_timestamp?(this.node.remove_dirty_state(),this._terminate_cook_process()):(this._cooking=!1,this.cook_main())},e.prototype._terminate_cook_process=function(){this.is_cooking&&(this._cooking=!1,this._record_cook_time(),setTimeout(this.node.container_controller.notify_requesters.bind(this.node.container_controller),0))},e.prototype._increase_cooks_count=function(){this.is_cooking&&null!=this._cook_time_start&&(this._cooks_count+=1)},e.prototype._record_cook_time=function(){if(this.node.scene.performance.recording_started()){var e=performance.now();null!=this._cook_time_with_inputs_start&&(this._cook_time_with_inputs=e-this._cook_time_with_inputs_start,this._cook_time_with_inputs_start=null),null!=this._cook_time_params_start&&null!=this._cook_time_start&&(this._cook_time_params=this._cook_time_start-this._cook_time_params_start),null!=this._cook_time_start&&(this._cook_time=e-this._cook_time_start,this._cook_time_start=null),this._max_cook_time=Math.max(this._max_cook_time,this._cook_time)}if(this.node.scene.performance.recording_started())return this.node.scene.performance.record_node_cook_data(this)},e.prototype.evaluate_inputs_and_params=function(){return r.__awaiter(this,void 0,void 0,(function(){var e;return r.__generator(this,(function(t){switch(t.label){case 0:return[4,this.node.io.inputs.eval_required_inputs_p()];case 1:return e=t.sent(),this.node.scene.performance.recording_started()&&(this._cook_time_params_start=performance.now()),[4,this.node.params.eval_all()];case 2:return t.sent(),[2,e]}}))}))},e.prototype.cook_time_with_inputs=function(){return this._cook_time_with_inputs},e.prototype.cook_time_params=function(){return this._cook_time_params},e.prototype._time_with_precision=function(e){return Math.round(1e3*e)/1e3},e}();t.CookController=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,o=n(2).__importDefault(n(351)),i=n(104),s=n(112);!function(e){e.SUCCESSORS="graph_successors",e.PREDECESSORS="graph_predecessors"}(r||(r={}));var a=function(){function e(e){this.node=e}return e.prototype.scene_successors=function(){return this._find_scene_node_scene_nodes(r.SUCCESSORS)},e.prototype.scene_predecessors=function(){return this._find_scene_node_scene_nodes(r.PREDECESSORS)},e.prototype._find_scene_node_scene_nodes=function(e){var t=this,n=this.node.params.all;n.push(this.node);for(var i=[],s=0,a=n;s<a.length;s++){var _=a[s];this._find_base_nodes_from_node(_,e,i)}if(e==r.SUCCESSORS)for(var u=0,c=this.param_nodes_referree();u<c.length;u++){var p=c[u];i.push(p)}i=i.filter((function(e){return e.graph_node_id!=t.node.graph_node_id}));var l=o.default(i,(function(e){return e.graph_node_id})),d=[];return Object.keys(l).forEach((function(e){d.push(l[e][0])})),d},e.prototype._find_base_nodes_from_node=function(e,t,n){for(var r,o,a=0,_=e[t]();a<_.length;a++){var u=_[a];u instanceof s.BaseParam?n.push(u.node):(r=u,("string"==typeof(o=i.BaseNodeClass)?typeof r===o:r instanceof o)?n.push(u):this._find_base_nodes_from_node(u,t,n))}return n},e.prototype.add_param_referree=function(e){this._params_referrees_by_graph_node_id=this._params_referrees_by_graph_node_id||{},this._params_referrees_by_graph_node_id[e.graph_node_id]=e},e.prototype.remove_param_referree=function(e){delete this._params_referrees_by_graph_node_id[e.graph_node_id]},e.prototype.params_referree=function(){var e=[];if(this._params_referrees_by_graph_node_id)for(var t=0,n=Object.keys(this._params_referrees_by_graph_node_id);t<n.length;t++){var r=n[t];e.push(this._params_referrees_by_graph_node_id[r])}return e},e.prototype.param_nodes_referree=function(){for(var e,t={},n=0,r=this.params_referree();n<r.length;n++){t[(e=r[n].node).graph_node_id]=e}for(var o=[],i=0,s=Object.keys(t);i<s.length;i++){var a=s[i];o.push(t[a])}return o},e}();t.DependenciesController=a},,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=r.__importDefault(n(71)),i=r.__importDefault(n(356)),s=r.__importDefault(n(103)),a=n(13),_=n(113),u=function(){function e(e){this._param=e,this._programatic_visible_state=!0,this._options=i.default(this._default_options)}return e.prototype.set=function(e){this._default_options=e,this._options=i.default(this._default_options)},e.prototype.copy=function(e){this._default_options=i.default(e.default),this._options=i.default(e.current)},e.prototype.set_option=function(e,t){return Object.assign(this._options,e,t)},Object.defineProperty(e.prototype,"param",{get:function(){return this._param},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"node",{get:function(){return this._param.node},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"default",{get:function(){return this._default_options},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"current",{get:function(){return this._options},enumerable:!0,configurable:!0}),e.prototype.has_options_overridden=function(){return!s.default(this._options,this._default_options)},e.prototype.overridden_options=function(){for(var e={},t=0,n=Object.keys(this._options);t<n.length;t++){var r=n[t];s.default(this._options[r],this._default_options[r])||Object.assign(e,r,i.default(this._options[r]))}return e},e.prototype.always_reference_asset=function(){return this._options.always_reference_asset||!1},e.prototype.has_callback=function(){return null!=this._options.callback||null!=this._options.callback_string},e.prototype.execute_callback=function(){var e=this.get_callback();null!=e&&this.node&&!this.node.cook_controller.is_cooking&&e(this.param)},e.prototype.get_callback=function(){if(this.has_callback())return this._options.callback=this._options.callback||this.create_callback_from_string()},e.prototype.create_callback_from_string=function(){var e=this,t=this._options.callback_string;if(t){var n=new Function("node","scene","window","location",t);return function(){n(e.node,e.node.scene,null,null)}}},e.prototype.color=function(){return this._options.color},e.prototype.makes_node_dirty_when_dirty=function(){var e;if(null!=this.param.parent_param)return!1;var t=!0;return null!=(e=this._options.cook)&&(t=e),t},Object.defineProperty(e.prototype,"desktop_browse_option",{get:function(){return this._options.desktop_browse},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"desktop_browse_allowed",{get:function(){return null!=this.desktop_browse_option},enumerable:!0,configurable:!0}),e.prototype.desktop_browse_file_type=function(){return this.desktop_browse_option?this.desktop_browse_option.file_type:null},e.prototype.displays_expression_only=function(){return!0===this._options.expression_only},e.prototype.expression_for_entities=function(){var e=this._options.expression;return e&&e.for_entities||!1},Object.defineProperty(e.prototype,"has_menu",{get:function(){return null!=this.menu_options},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"menu_options",{get:function(){return this._options.menu},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"menu_entries",{get:function(){return this.menu_options?this.menu_options.entries:[]},enumerable:!0,configurable:!0}),e.prototype.has_menu_radio=function(){return this.has_menu},e.prototype.is_multiline=function(){return!0===this._options.multiline},Object.defineProperty(e.prototype,"node_selection_options",{get:function(){return this._options.node_selection},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"node_selection_context",{get:function(){if(this.node_selection_options)return this.node_selection_options.context},enumerable:!0,configurable:!0}),e.prototype.dependent_on_found_node=function(){return!("dependent_on_found_node"in this._options)||this._options.dependent_on_found_node},e.prototype.range=function(){return this._options.range||[0,1]},e.prototype.step=function(){return this._options.step||.01},e.prototype.range_locked=function(){return this._options.range_locked||[!1,!1]},e.prototype._ensure_in_range=function(e){var t=this.range();return e>=t[0]&&e<=t[1]?e:e<t[0]?!0===this.range_locked()[0]?t[0]:e:!0===this.range_locked()[1]?t[1]:e},e.prototype.is_spare=function(){return this._options.spare||!1},e.prototype.texture_options=function(){return this._options.texture},e.prototype.texture_as_env=function(){var e=this.texture_options();return null!=e&&!0===e.env},e.prototype.is_hidden=function(){return!0===this._options.hidden||!1===this._programatic_visible_state},e.prototype.is_visible=function(){return!this.is_hidden()},e.prototype.set_visible_state=function(e){this._options.hidden=!e,this.param.emit(_.ParamEvent.VISIBLE_UPDATED)},e.prototype.is_label_hidden=function(){var e=this.param.type;return!1===this._options.label||e===a.ParamType.BUTTON||e===a.ParamType.SEPARATOR||e===a.ParamType.BOOLEAN&&this.is_field_hidden()},e.prototype.is_field_hidden=function(){return!1===this._options.field},e.prototype.ui_data_depends_on_other_params=function(){return"visible_if"in this._options},e.prototype.visibility_predecessors=function(){var e=this,t=Object.keys(this._options.visible_if||{}),n=this.param.node;return o.default(t.map((function(t){var r=n.params.get(t);if(r)return r;console.error("param "+t+" not found as visibility condition for "+e.param.name+" in node "+e.param.node.type())})))},e.prototype.set_ui_data_dependency=function(){var e=this;this.visibility_predecessors().forEach((function(t){e.param.ui_data.add_graph_input(t)}))},e.prototype.update_visibility=function(){return r.__awaiter(this,void 0,void 0,(function(){var e,t,n,o,i,s,a,u;return r.__generator(this,(function(r){switch(r.label){case 0:return(e=this._options.visible_if)?(t=this.visibility_predecessors(),n=t.map((function(e){return e.eval_p()})),this._programatic_visible_state=!0,[4,Promise.all(n)]):[3,2];case 1:for(r.sent(),o=0,i=t;o<i.length;o++)s=i[o],a=e[s.name],u=s.value(),a!=u&&(this._programatic_visible_state=!1);this.param.emit(_.ParamEvent.VISIBLE_UPDATED),r.label=2;case 2:return[2]}}))}))},e}();t.OptionsController=u},,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=function(){function e(e){this.param=e}return Object.defineProperty(e.prototype,"active",{get:function(){return null!=this._expression},enumerable:!0,configurable:!0}),e.prototype.set_expression=function(e){this._expression=e,this.param.set_dirty()},e.prototype.reset=function(){},e.prototype.update_expression_from_method_dependency_name_change=function(){},e.prototype.eval=function(){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(e){return[2]}))}))},e}();t.ExpressionController=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(113),o=function(){function e(e){this.param=e,this._blocked_emit=!0,this._blocked_parent_emit=!0}return Object.defineProperty(e.prototype,"emit_allowed",{get:function(){return!0!==this._blocked_emit&&(!this.param.scene.loading_controller.is_loading&&this.param.scene.events_controller.emit_allowed)},enumerable:!0,configurable:!0}),e.prototype.block_emit=function(){return this._blocked_emit=!0,this.param.is_multiple&&this.param.components.forEach((function(e){return e.emit_controller.block_emit()})),!0},e.prototype.unblock_emit=function(){return this._blocked_emit=!1,this.param.is_multiple&&this.param.components.forEach((function(e){return e.emit_controller.unblock_emit()})),!0},e.prototype.block_parent_emit=function(){return this._blocked_parent_emit=!0,!0},e.prototype.unblock_parent_emit=function(){return this._blocked_parent_emit=!1,!0},e.prototype.emit_param_updated=function(){this.emit_allowed&&(this.param.emit(r.ParamEvent.UPDATED),null!=this.param.parent_param&&!0!==this._blocked_parent_emit&&this.param.parent_param.emit(r.ParamEvent.UPDATED))},e}();t.EmitController=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this.param=e}return e.prototype.to_json=function(){var e={name:this.param.name,type:this.param.type,value:this.param.value(),graph_node_id:this.param.graph_node_id,is_dirty:this.param.is_dirty,error_message:this.param.states.error.message,is_visible:this.param.options.is_visible(),folder_name:this.param.ui_data.folder_name,components:null};return this.param.is_multiple&&(e.components=this.param.components.map((function(e){return e.graph_node_id}))),e},e}();t.ParamSerializer=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(361),o=n(362),i=function(e){this.param=e,this.time_dependent=new r.TimeDependentState(this.param),this.error=new o.ErrorState(this.param)};t.StatesController=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this.param=e}return Object.defineProperty(e.prototype,"active",{get:function(){var e=this.param.scene.time_controller.graph_node.graph_node_id;return this.param.graph_predecessor_ids().includes(e)},enumerable:!0,configurable:!0}),e}();t.TimeDependentState=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this.node=e}return e.prototype.set=function(e){this._message!=e&&(this._message=e)},Object.defineProperty(e.prototype,"message",{get:function(){return this._message},enumerable:!0,configurable:!0}),e.prototype.clear=function(){this.set(null)},Object.defineProperty(e.prototype,"active",{get:function(){return null!=this._message},enumerable:!0,configurable:!0}),e}();t.ErrorState=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=function(e){function t(t,n){var r=e.call(this,t,"param ui data")||this;return r.param=n,r.add_post_dirty_hook(r.update_visibility_and_remove_dirty.bind(r)),r}return r.__extends(t,e),t.prototype.update_visibility_and_remove_dirty=function(){this.update_visibility(),this.remove_dirty_state()},t.prototype.update_visibility=function(){this.param.options.update_visibility()},t.prototype.set_folder_name=function(e){this._folder_name=e},Object.defineProperty(t.prototype,"folder_name",{get:function(){return this._folder_name},enumerable:!0,configurable:!0}),t}(n(31).CoreGraphNode);t.UIData=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this.node=e}return e.prototype.serialize=function(){return this.to_json()},e.prototype.to_json=function(e){var t,n,r,o;void 0===e&&(e=!1);var i=this.node.children().map((function(e){return e.graph_node_id})),s=this.node.io.inputs.inputs().map((function(e){return null!=e?e.graph_node_id:void 0})),a=this.node.io.connections.input_connections().map((function(e){return null!=e?e.output_index:void 0})),_=this.node.io.inputs.named_inputs().map((function(e){return e.to_json()})),u=this.node.io.outputs.named_outputs().map((function(e){return e.to_json()})),c={name:this.node.name,type:this.node.type(),graph_node_id:this.node.graph_node_id,is_dirty:this.node.is_dirty,ui_data:this.node.ui_data.to_json(),error_message:this.node.states.error.message,children:i,inputs:s,input_connection_output_indices:a,named_inputs:_,named_outputs:u,params:this.to_json_params(e),spare_params:this.to_json_spare_params(e),override_clonable_state:this.node.io.inputs.override_clonable_state(),inputs_clonable_state_with_override:this.node.io.inputs.inputs_clonable_state_with_override(),flags:{display:null===(n=null===(t=this.node.flags)||void 0===t?void 0:t.display)||void 0===n?void 0:n.active,bypass:null===(o=null===(r=this.node.flags)||void 0===r?void 0:r.bypass)||void 0===o?void 0:o.active},selection:null};return this.node.children_controller.children_allowed()&&(c.selection=this.node.selection.to_json()),c},e.prototype.to_json_params_from_names=function(e,t){void 0===t&&(t=!1);for(var n={},r=0,o=e;r<o.length;r++){var i=o[r],s=this.node.params.get(i);if(s&&(n[i]=s.graph_node_id,t&&s.is_multiple))for(var a=0,_=s.components;a<_.length;a++){var u=_[a];n[u.name]=u.graph_node_id}}return n},e.prototype.to_json_params=function(e){return void 0===e&&(e=!1),this.to_json_params_from_names(this.node.params.non_spare_names,e)},e.prototype.to_json_spare_params=function(e){return void 0===e&&(e=!1),this.to_json_params_from_names(this.node.params.spare_names,e)},e}();t.NodeSerializer=r},function(e,t,n){"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0});var o=n(2),i=n(31),s=n(366),a=n(367),_=n(368),u=n(172),c=n(369),p=n(370),l=n(371),d=n(373),h=n(374),f=n(377),m=n(378),y=n(379),v=n(13),g=n(113),b=((r={})[v.ParamType.BOOLEAN]=s.BooleanParam,r[v.ParamType.BUTTON]=a.ButtonParam,r[v.ParamType.COLOR]=_.ColorParam,r[v.ParamType.FLOAT]=u.FloatParam,r[v.ParamType.INTEGER]=c.IntegerParam,r[v.ParamType.OPERATOR_PATH]=p.OperatorPathParam,r[v.ParamType.RAMP]=l.RampParam,r[v.ParamType.SEPARATOR]=d.SeparatorParam,r[v.ParamType.STRING]=h.StringParam,r[v.ParamType.VECTOR2]=f.Vector2Param,r[v.ParamType.VECTOR3]=m.Vector3Param,r[v.ParamType.VECTOR4]=y.Vector4Param,r),w=function(){function e(e){this.node=e,this._param_create_mode=!1,this._params_by_name={},this._params_list=[],this._param_names=[],this._non_spare_params=[],this._spare_params=[],this._non_spare_param_names=[],this._spare_param_names=[],this._params_added_since_last_params_eval=!1,this._current_param_folder_name=null}return e.prototype.init_dependency_node=function(){this._params_node||(this._params_node=new i.CoreGraphNode(this.node.scene,"params"),this.node.add_graph_input(this._params_node))},e.prototype.init=function(){this.init_dependency_node(),this._param_create_mode=!0,this.init_from_params_config(),this.node.create_params(),this._update_caches(),this._create_params_ui_data_dependencies(),this.init_param_accessors(),this._param_create_mode=!1},e.prototype.init_from_params_config=function(){var e=this.node.params_config;if(e)for(var t=0,n=Object.keys(e);t<n.length;t++){var r=n[t],o=e[r];this.add_param(o.type,r,o.init_value,o.options)}},e.prototype.init_param_accessors=function(){for(var e=function(e){Object.defineProperty(t.node.pv,e.name,{get:function(){return e.value}}),Object.defineProperty(t.node.p,e.name,{get:function(){return e}})},t=this,n=0,r=this.all;n<r.length;n++){e(r[n])}},Object.defineProperty(e.prototype,"params_node",{get:function(){return this._params_node},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"all",{get:function(){return this._params_list},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"non_spare",{get:function(){return this._non_spare_params},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"spare",{get:function(){return this._spare_params},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"names",{get:function(){return this._param_names},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"non_spare_names",{get:function(){return this._non_spare_param_names},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"spare_names",{get:function(){return this._spare_param_names},enumerable:!0,configurable:!0}),e.prototype.set_with_type=function(e,t,n){var r=this.param_with_type(e,n);r?r.set(t):console.warn("param "+e+" not found with type "+n)},e.prototype.set_float=function(e,t){this.set_with_type(e,t,v.ParamType.FLOAT)},e.prototype.set_vector3=function(e,t){this.set_with_type(e,t,v.ParamType.VECTOR3)},e.prototype.has_param=function(e){return null!=this._params_by_name[e]},e.prototype.has=function(e){return this.has_param(e)},e.prototype.get=function(e){return this.param(e)},e.prototype.param_with_type=function(e,t){var n=this.param(e);if(n&&n.type==t)return n},e.prototype.get_operator_path=function(e){return this.param_with_type(e,v.ParamType.OPERATOR_PATH)},e.prototype.value=function(e){var t;return null===(t=this.param(e))||void 0===t?void 0:t.value()},e.prototype.value_with_type=function(e,t){var n;return null===(n=this.param_with_type(e,t))||void 0===n?void 0:n.value()},e.prototype.boolean=function(e){return this.value_with_type(e,v.ParamType.FLOAT)},e.prototype.float=function(e){return this.value_with_type(e,v.ParamType.FLOAT)},e.prototype.integer=function(e){return this.value_with_type(e,v.ParamType.INTEGER)},e.prototype.string=function(e){return this.value_with_type(e,v.ParamType.STRING)},e.prototype.vector2=function(e){return this.value_with_type(e,v.ParamType.VECTOR2)},e.prototype.vector3=function(e){return this.value_with_type(e,v.ParamType.VECTOR3)},e.prototype.color=function(e){return this.value_with_type(e,v.ParamType.COLOR)},e.prototype.param=function(e){var t=this._params_by_name[e];return null!=t?t:(console.warn("tried to access param '"+e+"' in node "+this.node.full_path()+", but existing params are: "+this.names),null)},e.prototype.delete_params=function(e){for(var t=0,n=e;t<n.length;t++){var r=n[t];this.delete_param(r)}this._update_caches()},e.prototype.delete_param=function(e){var t=this._params_by_name[e];if(!t)throw new Error("param '"+e+"' does not exist on node "+this.node.full_path());if(this._params_node.remove_graph_input(this._params_by_name[e]),t.set_node(null),delete this._params_by_name[e],t.is_multiple)for(var n=0,r=t.components;n<r.length;n++){var o=r[n].name;delete this._params_by_name[o]}t.emit(g.ParamEvent.DELETED)},e.prototype.add_param=function(e,t,n,r){void 0===r&&(r={});var o=r.spare||!1;if(!1===this._param_create_mode&&!o)return console.warn("node "+this.node.full_path()+" ("+this.node.type()+") param '"+t+"' cannot be created outside of create_params"),null;if(null==this.node.scene)return console.warn("node "+this.node.full_path()+" ("+this.node.type()+") has no scene assigned"),null;var i=b[e];if(null!=i){var s=this._params_by_name[t];if(s){if(!o)return console.warn("a param named "+t+" already exists"),null;s.type!=e&&this.delete_param(s.name)}var a=new i(this.node.scene);if(a.options.set(r),a.set_name(t),a.set_init_value(n),a.ui_data.set_folder_name(this.current_param_folder_name()),this._params_by_name[a.name]=a,a.set_node(this.node),a.is_multiple)for(var _=0,u=a.components;_<u.length;_++){var c=u[_];this._params_by_name[c.name]=c}return this._params_added_since_last_params_eval=!0,a}return null},e.prototype._update_caches=function(){this._params_list=Object.values(this._params_by_name),this._param_names=Object.keys(this._params_by_name),this._non_spare_params=Object.values(this._params_by_name).filter((function(e){return!e.options.is_spare()})),this._spare_params=Object.values(this._params_by_name).filter((function(e){return e.options.is_spare()})),this._non_spare_param_names=Object.values(this._params_by_name).filter((function(e){return!e.options.is_spare()})).map((function(e){return e.name})),this._spare_param_names=Object.values(this._params_by_name).filter((function(e){return e.options.is_spare()})).map((function(e){return e.name}))},e.prototype._eval_param=function(e){return o.__awaiter(this,void 0,void 0,(function(){var t;return o.__generator(this,(function(n){switch(n.label){case 0:return e.is_dirty?[4,e.eval_p()]:[3,2];case 1:return t=n.sent(),e.states.error.active&&this.node.states.error.set("param '"+e.name+"' error: "+e.states.error.message),[2,t];case 2:return[2,e.value()]}}))}))},e.prototype.eval_params=function(e){return o.__awaiter(this,void 0,void 0,(function(){var t,n;return o.__generator(this,(function(r){switch(r.label){case 0:for(t=[],n=0;n<e.length;n++)t.push(this._eval_param(e[n]));return[4,Promise.all(t)];case 1:return r.sent(),this.node.states.error.active&&this.node.set_container(null),[2]}}))}))},e.prototype.eval_all=function(){return o.__awaiter(this,void 0,void 0,(function(){return o.__generator(this,(function(e){switch(e.label){case 0:return this._params_node.is_dirty||this._params_added_since_last_params_eval?[4,this.eval_params(this._params_list)]:[3,2];case 1:e.sent(),this._params_node.remove_dirty_state(),this._params_added_since_last_params_eval=!1,e.label=2;case 2:return[2]}}))}))},e.prototype._create_params_ui_data_dependencies=function(){this._params_list.filter((function(e){return e.options.ui_data_depends_on_other_params()})).forEach((function(e){e.options.set_ui_data_dependency()}))},e.prototype.within_param_folder=function(e,t){var n=this._current_param_folder_name;this._current_param_folder_name=e,t(),this._current_param_folder_name=n},e.prototype.current_param_folder_name=function(){return this._current_param_folder_name},e}();t.ParamsController=w},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(114),i=n(13),s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.type=function(){return i.ParamType.BOOLEAN},t}(o.TypedNumericParam);t.BooleanParam=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(43),i=n(13),s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.type=function(){return i.ParamType.BUTTON},t}(o.Single);t.ButtonParam=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(73),i=r.__importDefault(n(10)),s=n(4),a=n(13),_=["r","g","b"],u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.type=function(){return a.ParamType.COLOR},Object.defineProperty(t,"component_names",{get:function(){return _},enumerable:!0,configurable:!0}),t.prototype.eval=function(){return r.__awaiter(this,void 0,void 0,(function(){var e;return r.__generator(this,(function(t){switch(t.label){case 0:return[4,this.eval_components()];case 1:return e=t.sent(),this._value.r=e[0],this._value.g=e[1],this._value.b=e[2],[2,this._value]}}))}))},t.prototype.convert=function(e){return i.default(e)?(new s.Color).fromArray(e):new s.Color},t}(o.TypedMultipleParam);t.ColorParam=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(114),i=n(13),s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.type=function(){return i.ParamType.INTEGER},t.prototype.convert=function(e){return parseInt(e)},t.prototype.eval=function(){return r.__awaiter(this,void 0,void 0,(function(){var e;return r.__generator(this,(function(t){switch(t.label){case 0:return[4,this.eval_raw()];case 1:return e=t.sent(),[2,this.convert(e)]}}))}))},t}(o.TypedNumericParam);t.IntegerParam=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(43),i=n(72),s=n(13),a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.type=function(){return s.ParamType.OPERATOR_PATH},t.prototype.accepts_visitor=function(e){return e.visit_operator_path_param(this)},t.prototype.set_path=function(e){this._path=e},t.prototype.path=function(){return this._path},t.prototype.eval=function(){var e;return r.__awaiter(this,void 0,void 0,(function(){var t,n,o,s,a;return r.__generator(this,(function(r){switch(r.label){case 0:return[4,this.eval_raw()];case 1:return t=r.sent(),n=null,null!=t&&""!==t&&(n=i.CoreWalker.find_node(this.node,t)),this._found_node!==n&&(o=this.options.dependent_on_found_node(),this._found_node&&o&&this.remove_graph_input(this._found_node),this._found_node=n,n&&(s=this.options.node_selection_context,a=null===(e=n.parent)||void 0===e?void 0:e.children_controller.context,s==a||null==s?o&&this.add_graph_input(n):this.states.error.set("node context is "+s+" but the params expects a "+a))),[2,t]}}))}))},t.prototype.found_node=function(){return this._found_node},t}(o.Single);t.OperatorPathParam=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=r.__importDefault(n(111)),i=n(0),s=n(116),a=n(428),_=n(43),u=n(372),c=n(13),p=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.type=function(){return c.ParamType.RAMP},t.prototype.initialize_param=function(){this.add_post_dirty_hook(this._reset_ramp_interpolant_and_texture.bind(this))},t.prototype.accepts_visitor=function(e){return e.visit_ramp_param(this)},t.prototype.is_raw_input_default=function(){return this.value.is_equal(this.default_value)},t.prototype.has_expression=function(){return!1},t.prototype._reset_ramp_interpolant_and_texture=function(){this._ramp_interpolant=null,this._ramp_texture=null},t.prototype.ramp_texture=function(){return this._ramp_texture=this._ramp_texture||this._create_ramp_texture()},t.prototype._create_ramp_texture=function(){for(var e=new Uint8Array(3072),t=0,n=0,r=0,o=0;o<1024;o++)t=3*o,n=o/1024,r=this.value_at_position(n),e[t]=255*r;var a=new s.DataTexture(e,1024,1,i.RGBFormat);return a.needsUpdate=!0,a},t.create_interpolant=function(e,t){var n=new Float32Array(1);return new a.CubicInterpolant(e,t,1,n)},t.prototype.interpolant=function(){return this._ramp_interpolant=this._ramp_interpolant||this._create_interpolant()},t.prototype._create_interpolant=function(){for(var e=this.value.points(),n=o.default(e,(function(e){return e.position()})),r=new Float32Array(n.length),i=new Float32Array(n.length),s=0,a=0,_=n;a<_.length;a++){var u=_[a];r[s]=u.position(),i[s]=u.value(),s++}return t.create_interpolant(r,i)},t.prototype.value_at_position=function(e){return this.interpolant().evaluate(e)[0]},t.DEFAULT_VALUE=new u.RampValue("linear",[new u.RampPoint(0,0),new u.RampPoint(1,1)]),t}(_.Single);t.RampParam=p},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(5),o=function(){function e(e,t){this._position=e,this._value=t}return e.prototype.to_json=function(){return{position:this._position,value:this._value}},e.prototype.position=function(){return this._position},e.prototype.value=function(){return this._value},e.prototype.is_equal=function(e){return this._position==e.position()&&this._value==e.value()},e}();t.RampPoint=o;var i=function(){function e(e,t){this._interpolation=e,this._points=t,this._uuid=r._Math.generateUUID()}return e.prototype.uuid=function(){return this._uuid},e.from_json=function(t){for(var n=[],r=0,i=t.points;r<i.length;r++){var s=i[r];n.push(new o(s.position,s.value))}return new e(t.interpolation,n)},e.prototype.to_json=function(){return{interpolation:this._interpolation,points:this._points.map((function(e){return e.to_json()}))}},e.prototype.interpolation=function(){return this._interpolation},e.prototype.points=function(){return this._points},e.prototype.is_equal=function(e){var t=!0;this._interpolation!=e.interpolation()&&(t=!1);var n=e.points();if(t&&this._points.length!=n.length&&(t=!1),t)for(var r=0,o=0,i=this._points;o<i.length;o++){var s=i[o],a=n[r];s.is_equal(a)||(t=!1),r+=1}return t},e}();t.RampValue=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(43),i=n(13),s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.type=function(){return i.ParamType.SEPARATOR},t}(o.Single);t.SeparatorParam=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(43),i=n(375),s=n(13),a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.type=function(){return s.ParamType.STRING},t.prototype.accepts_visitor=function(e){return e.visit_string_param(this)},t.prototype.set=function(e){this._raw_input!=e&&(this.expression_controller.reset(),this._raw_input=e)},t.prototype.has_expression=function(){return this._value_elements(this._raw_input).length>1},t.prototype._value_elements=function(e){return i.ParsedTree.string_value_elements(e)},t.prototype.parse_expression_and_update_dependencies=function(){},t}(o.Single);t.StringParam=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2).__importDefault(n(376));r.default.addUnaryOp("@");r.default.addBinaryOp("**",10);var o=function(){function e(){this.error_message=null}return e.prototype.parse_expression=function(e){try{this.reset(),this.node=r.default(e)}catch(n){var t="could not parse the expression '"+e+"' (error: "+n+")";this.error_message=t}},e.prototype.parse_expression_for_string_param=function(t){try{this.reset();for(var n=e.string_value_elements(t),o=[],i=0;i<n.length;i++){var s=n[i],a=void 0;a=i%2==1?r.default(s):{type:"Literal",value:"'"+s+"'",raw:"'"+s+"'"},o.push(a)}this.node={type:"CallExpression",arguments:o,callee:{type:"Identifier",name:"str_concat"}}}catch(e){var _="could not parse the expression '"+t+"' (error: "+e+")";this.error_message=_}},e.string_value_elements=function(e){return null!=e?(""+e).split("`"):[]},e.prototype.reset=function(){this.node=null,this.error_message=null},e}();t.ParsedTree=o},function(e,t,n){!function(n){"use strict";var r=function(e,t){var n=new Error(e+" at character "+t);throw n.index=t,n.description=e,n},o={"-":!0,"!":!0,"~":!0,"+":!0},i={"||":1,"&&":2,"|":3,"^":4,"&":5,"==":6,"!=":6,"===":6,"!==":6,"<":7,">":7,"<=":7,">=":7,"<<":8,">>":8,">>>":8,"+":9,"-":9,"*":10,"/":10,"%":10},s=function(e){var t,n=0;for(var r in e)(t=r.length)>n&&e.hasOwnProperty(r)&&(n=t);return n},a=s(o),_=s(i),u={true:!0,false:!1,null:null},c=function(e){return i[e]||0},p=function(e,t,n){return{type:"||"===e||"&&"===e?"LogicalExpression":"BinaryExpression",operator:e,left:t,right:n}},l=function(e){return e>=48&&e<=57},d=function(e){return 36===e||95===e||e>=65&&e<=90||e>=97&&e<=122||e>=128&&!i[String.fromCharCode(e)]},h=function(e){return 36===e||95===e||e>=65&&e<=90||e>=97&&e<=122||e>=48&&e<=57||e>=128&&!i[String.fromCharCode(e)]},f=function(e){for(var t,n,s=0,f=e.charAt,m=e.charCodeAt,y=function(t){return f.call(e,t)},v=function(t){return m.call(e,t)},g=e.length,b=function(){for(var e=v(s);32===e||9===e||10===e||13===e;)e=v(++s)},w=function(){var e,t,n=O();return b(),63!==v(s)?n:(s++,(e=w())||r("Expected expression",s),b(),58===v(s)?(s++,(t=w())||r("Expected expression",s),{type:"ConditionalExpression",test:n,consequent:e,alternate:t}):void r("Expected :",s))},P=function(){b();for(var t=e.substr(s,_),n=t.length;n>0;){if(i.hasOwnProperty(t)&&(!d(v(s))||s+t.length<e.length&&!h(v(s+t.length))))return s+=n,t;t=t.substr(0,--n)}return!1},O=function(){var e,t,n,o,i,a,_,u;if(a=j(),!(t=P()))return a;for(i={value:t,prec:c(t)},(_=j())||r("Expected expression after "+t,s),o=[a,i,_];(t=P())&&0!==(n=c(t));){for(i={value:t,prec:n};o.length>2&&n<=o[o.length-2].prec;)_=o.pop(),t=o.pop().value,a=o.pop(),e=p(t,a,_),o.push(e);(e=j())||r("Expected expression after "+t,s),o.push(i,e)}for(e=o[u=o.length-1];u>1;)e=p(o[u-1].value,o[u-2],e),u-=2;return e},j=function(){var t,n,r;if(b(),t=v(s),l(t)||46===t)return k();if(39===t||34===t)return x();if(91===t)return A();for(r=(n=e.substr(s,a)).length;r>0;){if(o.hasOwnProperty(n)&&(!d(v(s))||s+n.length<e.length&&!h(v(s+n.length))))return s+=r,{type:"UnaryExpression",operator:n,argument:j(),prefix:!0};n=n.substr(0,--r)}return!(!d(t)&&40!==t)&&T()},k=function(){for(var e,t,n="";l(v(s));)n+=y(s++);if(46===v(s))for(n+=y(s++);l(v(s));)n+=y(s++);if("e"===(e=y(s))||"E"===e){for(n+=y(s++),"+"!==(e=y(s))&&"-"!==e||(n+=y(s++));l(v(s));)n+=y(s++);l(v(s-1))||r("Expected exponent ("+n+y(s)+")",s)}return t=v(s),d(t)?r("Variable names cannot start with a number ("+n+y(s)+")",s):46===t&&r("Unexpected period",s),{type:"Literal",value:parseFloat(n),raw:n}},x=function(){for(var e,t="",n=y(s++),o=!1;s<g;){if((e=y(s++))===n){o=!0;break}if("\\"===e)switch(e=y(s++)){case"n":t+="\n";break;case"r":t+="\r";break;case"t":t+="\t";break;case"b":t+="\b";break;case"f":t+="\f";break;case"v":t+="\v";break;default:t+=e}else t+=e}return o||r('Unclosed quote after "'+t+'"',s),{type:"Literal",value:t,raw:n+t+n}},E=function(){var t,n=v(s),o=s;for(d(n)?s++:r("Unexpected "+y(s),s);s<g&&(n=v(s),h(n));)s++;return t=e.slice(o,s),u.hasOwnProperty(t)?{type:"Literal",value:u[t],raw:t}:"this"===t?{type:"ThisExpression"}:{type:"Identifier",name:t}},C=function(e){for(var t,n,o=[],i=!1;s<g;){if(b(),(t=v(s))===e){i=!0,s++;break}44===t?s++:((n=w())&&"Compound"!==n.type||r("Expected comma",s),o.push(n))}return i||r("Expected "+String.fromCharCode(e),s),o},T=function(){var e,t;for(t=40===(e=v(s))?M():E(),b(),e=v(s);46===e||91===e||40===e;)s++,46===e?(b(),t={type:"MemberExpression",computed:!1,object:t,property:E()}):91===e?(t={type:"MemberExpression",computed:!0,object:t,property:w()},b(),93!==(e=v(s))&&r("Unclosed [",s),s++):40===e&&(t={type:"CallExpression",arguments:C(41),callee:t}),b(),e=v(s);return t},M=function(){s++;var e=w();if(b(),41===v(s))return s++,e;r("Unclosed (",s)},A=function(){return s++,{type:"ArrayExpression",elements:C(93)}},R=[];s<g;)59===(t=v(s))||44===t?s++:(n=w())?R.push(n):s<g&&r('Unexpected "'+y(s)+'"',s);return 1===R.length?R[0]:{type:"Compound",body:R}};f.version="0.3.4",f.toString=function(){return"JavaScript Expression Parser (JSEP) v"+f.version},f.addUnaryOp=function(e){return a=Math.max(e.length,a),o[e]=!0,this},f.addBinaryOp=function(e,t){return _=Math.max(e.length,_),i[e]=t,this},f.addLiteral=function(e,t){return u[e]=t,this},f.removeUnaryOp=function(e){return delete o[e],e.length===a&&(a=s(o)),this},f.removeAllUnaryOps=function(){return o={},a=0,this},f.removeBinaryOp=function(e){return delete i[e],e.length===_&&(_=s(i)),this},f.removeAllBinaryOps=function(){return i={},_=0,this},f.removeLiteral=function(e){return delete u[e],this},f.removeAllLiterals=function(){return u={},this},e.exports?t=e.exports=f:t.parse=f}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(73),i=r.__importDefault(n(10)),s=n(3),a=n(13),_=["x","y"],u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.type=function(){return a.ParamType.VECTOR2},Object.defineProperty(t,"component_names",{get:function(){return _},enumerable:!0,configurable:!0}),t.prototype.eval=function(){return r.__awaiter(this,void 0,void 0,(function(){var e;return r.__generator(this,(function(t){switch(t.label){case 0:return[4,this.eval_components()];case 1:return e=t.sent(),this._value.x=e[0],this._value.y=e[1],[2,this._value]}}))}))},t.prototype.convert=function(e){return i.default(e)?(new s.Vector2).fromArray(e):new s.Vector2},t}(o.TypedMultipleParam);t.Vector2Param=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(73),i=r.__importDefault(n(10)),s=n(1),a=n(13),_=["x","y","z"],u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.type=function(){return a.ParamType.VECTOR3},Object.defineProperty(t,"component_names",{get:function(){return _},enumerable:!0,configurable:!0}),t.prototype.eval=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t;return r.__generator(this,(function(n){switch(n.label){case 0:return[4,this.eval_components()];case 1:return t=n.sent(),e?(e.fromArray(t),[2]):(this._value.x=t[0],this._value.y=t[1],this._value.z=t[2],console.log("cs",t),[2,this._value])}}))}))},t.prototype.convert=function(e){return i.default(e)?(new s.Vector3).fromArray(e):new s.Vector3},t}(o.TypedMultipleParam);t.Vector3Param=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(73),i=r.__importDefault(n(10)),s=n(12),a=n(13),_=["x","y","z","w"],u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.type=function(){return a.ParamType.VECTOR4},Object.defineProperty(t,"component_names",{get:function(){return _},enumerable:!0,configurable:!0}),t.prototype.eval=function(){return r.__awaiter(this,void 0,void 0,(function(){var e;return r.__generator(this,(function(t){switch(t.label){case 0:return[4,this.eval_components()];case 1:return e=t.sent(),this._value.x=e[0],this._value.y=e[1],this._value.z=e[2],this._value.w=e[3],[2,this._value]}}))}))},t.prototype.convert=function(e){return i.default(e)?(new s.Vector4).fromArray(e):new s.Vector4},t}(o.TypedMultipleParam);t.Vector4Param=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(e){this.node=e};t.ParamsValueAccessor=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){}return e.prototype.copy=function(e){this._frame=e.frame},Object.defineProperty(e.prototype,"frame",{get:function(){return this._frame},enumerable:!0,configurable:!0}),e}();t.ProcessingContext=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(383),o=n(384),i=n(387),s=function(){function e(e){this.node=e,this._connections=new r.ConnectionsController(this.node)}return Object.defineProperty(e.prototype,"connections",{get:function(){return this._connections},enumerable:!0,configurable:!0}),e.prototype.init_inputs=function(e){this.inputs.set_options(e)},Object.defineProperty(e.prototype,"inputs",{get:function(){return this._inputs=this._inputs||new o.InputsController(this.node)},enumerable:!0,configurable:!0}),e.prototype.has_inputs=function(){return null!=this._inputs},Object.defineProperty(e.prototype,"outputs",{get:function(){return this._outputs=this._outputs||new i.OutputsController(this.node)},enumerable:!0,configurable:!0}),e.prototype.has_outputs=function(){return null!=this._outputs},e}();t.IOController=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2).__importDefault(n(71)),o=function(){function e(e){this._node=e,this._input_connections=[],this._output_connections={}}return e.prototype.add_input_connection=function(e){this._input_connections[e.input_index]=e},e.prototype.add_output_connection=function(e){var t=e.output_index,n=e.uuid;this._output_connections[t]=this._output_connections[t]||{},this._output_connections[t][n]=e},e.prototype.remove_input_connection=function(e){this._input_connections[e.input_index]=null},e.prototype.remove_output_connection=function(e){var t=e.output_index,n=e.uuid;delete this._output_connections[t][n]},e.prototype.input_connection=function(e){return this._input_connections[e]},e.prototype.first_input_connection=function(){return r.default(this._input_connections)[0]},e.prototype.last_input_connection=function(){var e=r.default(this._input_connections);return e[e.length-1]},e.prototype.input_connections=function(){return this._input_connections},e.prototype.output_connections=function(){var e=this,t=[];return Object.keys(this._output_connections).forEach((function(n){var r=e._output_connections[n];Object.keys(r).forEach((function(e){t.push(r[e])}))})),t},e}();t.ConnectionsController=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=r.__importDefault(n(138)),i=r.__importDefault(n(68)),s=n(385),a=n(31),_=n(28),u=n(386),c=function(){function e(e,t){void 0===t&&(t={}),this.node=e,this._graph_node_inputs=[],this._inputs=[],this._has_named_inputs=!1,this._named_inputs=[],this._depends_on_inputs=!0,this._override_clonable_state=!1,this.set_options(t)}return e.prototype.set_options=function(e){e.min_inputs&&this.set_min_inputs_count(e.min_inputs),e.max_inputs&&this.set_max_inputs_count(e.max_inputs),e.depends_on_inputs&&this.set_depends_on_inputs(e.depends_on_inputs)},e.displayed_input_names=function(){return[]},e.prototype.set_depends_on_inputs=function(e){this._depends_on_inputs=e},e.prototype.set_min_inputs_count=function(e){this._min_inputs_count=e},e.prototype.set_max_inputs_count=function(e){this._max_inputs_count=e,this._init_graph_node_inputs()},e.prototype.set_named_inputs=function(e){this._has_named_inputs=!0,this._named_inputs=e,this.set_min_inputs_count(0),this.set_max_inputs_count(e.length),this.node.emit(_.NodeEvent.NAMED_INPUTS_UPDATED)},e.prototype.has_named_inputs=function(){return this._has_named_inputs},e.prototype.named_inputs=function(){return this._named_inputs},e.prototype._init_graph_node_inputs=function(){for(var e=0;e<this._max_inputs_count;e++)this._graph_node_inputs[e]=this._graph_node_inputs[e]||this._create_graph_node_input(e)},e.prototype._create_graph_node_input=function(e){var t=new a.CoreGraphNode(this.node.scene,"input_"+e);return this.node.add_graph_input(t),t},e.prototype.max_inputs_count=function(){return this._max_inputs_count||0},e.prototype.input_graph_node=function(e){return this._graph_node_inputs[e]},e.prototype.set_count_to_zero=function(){this.set_min_inputs_count(0),this.set_max_inputs_count(0),this.init_inputs_clonable_state()},e.prototype.set_count_to_one_max=function(){this.set_min_inputs_count(0),this.set_max_inputs_count(1),this.init_inputs_clonable_state()},e.prototype.set_count=function(e,t){null==t&&(t=e),this.set_min_inputs_count(e),this.set_max_inputs_count(t),this.init_inputs_clonable_state()},e.prototype.eval_required_inputs_p=function(){return r.__awaiter(this,void 0,void 0,(function(){var e,t,n,o=this;return r.__generator(this,(function(r){switch(r.label){case 0:return e=[],this._max_inputs_count>0?(t=[],this.inputs().forEach((function(e,n){e&&t.push(n)})),t.length<this._min_inputs_count?(this.node.states.error.set("inputs are missing"),[3,3]):[3,1]):[3,3];case 1:return t.length>0?(n=t.map((function(e){return o.node.io.inputs.eval_required_input_p(e)})),[4,Promise.all(n)]):[3,3];case 2:e=r.sent(),r.label=3;case 3:return[2,e]}}))}))},e.prototype.eval_required_input_p=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,n,o;return r.__generator(this,(function(r){switch(r.label){case 0:return[4,this.node.container_controller.request_input_container_p(e)];case 1:return(t=r.sent())&&t.core_content()||(n=this.input(e))&&(o=n.states.error.message,this.node.states.error.set("input "+e+" is invalid (error: "+o+")")),[2,t]}}))}))},e.prototype._get_named_input_index_without_error=function(e){var t=this.named_inputs(),n=-1;return t.forEach((function(t,r){t.name()==e&&(n=r)})),n},e.prototype.get_named_input_index=function(e){var t=this._get_named_input_index_without_error(e);if(null==t){var n=this.named_inputs(),r=n.map((function(e){return e.name()})).join(", ");throw console.log("named_inputs",n),new Error(this.node.full_path()+": no inputs named '"+e+"'. available names are '"+r+"' ("+n.length+" inputs)")}return t},e.prototype.get_input_index=function(e){if(i.default(e)){if(this.has_named_inputs())return this.get_named_input_index(e);throw new Error("node "+this.node.full_path()+" has no named inputs")}return e},e.prototype.set_input=function(e,t,n){void 0===n&&(n=0);var r=this.get_input_index(e)||0,o=0;t&&t.io.outputs.has_named_outputs()&&(o=t.io.outputs.get_output_index(n)||0);var i=this._graph_node_inputs[r];if(null==i)throw"graph_input_node not found at index "+r;if(!t||this.node.parent==t.parent){var a=this._inputs[r],u=null,c=this.node.io.connections.input_connection(r);c&&(u=c.output_index),t===a&&o==u||(null!=a&&this._depends_on_inputs&&i.remove_graph_input(a),null!=t?i.add_graph_input(t)?(this._depends_on_inputs||i.remove_graph_input(t),c&&c.disconnect({set_input:!1}),this._inputs[r]=t,new s.NodeConnection(t,this.node,o,r)):console.warn("cannot connect "+t.full_path()+" to "+this.node.full_path()):(this._inputs[r]=null,c&&c.disconnect({set_input:!1})),this.post_set_input(),this.node.set_dirty(t),this.node.emit(_.NodeEvent.INPUTS_UPDATED))}},e.prototype.post_set_input=function(){},e.prototype.remove_input=function(e){var t=this;o.default(this.inputs(),(function(n,r){null!=n&&null!=e&&n.graph_node_id===e.graph_node_id&&t.set_input(r,null)}))},e.prototype.input=function(e){return this._inputs[e]},e.prototype.named_input=function(e){if(this.has_named_inputs()){var t=this.get_input_index(e);return this._inputs[t]}throw new Error(this.node.full_path()+" has no named inputs")},e.prototype.named_connection=function(e){if(this.has_named_inputs()){var t=this.get_input_index(e);return this._named_inputs[t]}throw new Error(this.node.full_path()+" has no named inputs")},e.prototype.has_named_input=function(e){return null!=this._get_named_input_index_without_error(e)},e.prototype.has_input=function(e){return null!=this._inputs[e]},e.prototype.inputs=function(){return this._inputs},e.prototype.override_clonable_state_allowed=function(){for(var e=!1,t=0,n=this.inputs_clonable_state();t<n.length;t++){n[t]==u.InputCloneMode.FROM_NODE&&(e=!0)}return e},e.prototype.inputs_clonable_state=function(){return this._inputs_clonable_states=this._inputs_clonable_states||this.init_inputs_clonable_state()},e.prototype.input_cloned=function(e){return this.input_clonable_state_with_override(e)},e.prototype.inputs_clonable_state_with_override=function(){for(var e=[],t=this.inputs_clonable_state(),n=0;n<t.length;n++)e.push(this.input_clonable_state_with_override(n));return e},e.prototype.input_clonable_state_with_override=function(e){switch(this.inputs_clonable_state()[e]){case u.InputCloneMode.ALWAYS:return!0;case u.InputCloneMode.NEVER:return!1;case u.InputCloneMode.FROM_NODE:return!this._override_clonable_state;default:return!1}},e.prototype.init_inputs_clonable_state=function(e){return void 0===e&&(e=null),e&&(this._user_inputs_clonable_states=e),this._inputs_clonable_states=this._user_inputs_clonable_states||this._default_inputs_clonale_state_values(),this._inputs_clonable_states},e.prototype._default_inputs_clonale_state_values=function(){for(var e=[],t=0;t<this._max_inputs_count;t++)e.push(u.InputCloneMode.ALWAYS);return e},e.prototype.set_override_clonable_state=function(e){this._override_clonable_state=e,this.node.emit(_.NodeEvent.OVERRIDE_CLONABLE_STATE_UPDATE)},e.prototype.override_clonable_state=function(){return this._override_clonable_state},e}();t.InputsController=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(5);!function(e){e.GEOMETRY="geometry",e.MATRIX="matrix",e.INT="int",e.FLOAT="float",e.BOOL="bool",e.VEC2="vec2",e.VEC3="vec3",e.VEC4="vec4",e.MAT3="mat3",e.RGB="rgb",e.RGBA="rgba"}(t.ConnectionType||(t.ConnectionType={}));var o=function(){function e(e,t,n,o){void 0===n&&(n=0),void 0===o&&(o=0),this._node_src=e,this._node_dest=t,this._output_index=n,this._input_index=o,this._uuid=r._Math.generateUUID(),this._node_src.io.connections.add_output_connection(this),this._node_dest.io.connections.add_input_connection(this)}return Object.defineProperty(e.prototype,"uuid",{get:function(){return this._uuid},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"node_src",{get:function(){return this._node_src},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"node_dest",{get:function(){return this._node_dest},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"output_index",{get:function(){return this._output_index},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"input_index",{get:function(){return this._input_index},enumerable:!0,configurable:!0}),e.prototype.disconnect=function(e){void 0===e&&(e={}),this._node_src.io.connections.remove_output_connection(this),this._node_dest.io.connections.remove_input_connection(this),!0===e.set_input&&this._node_dest.io.inputs.set_input(this._input_index,null)},e}();t.NodeConnection=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.ALWAYS="always",e.NEVER="never",e.FROM_NODE="from_node"}(t.InputCloneMode||(t.InputCloneMode={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=r.__importDefault(n(106)),i=r.__importDefault(n(108)),s=r.__importDefault(n(68)),a=n(28),_=function(){function e(e){this.node=e,this._has_outputs=!1,this._named_outputs=[],this._has_named_outputs=!1}return e.prototype.init=function(e){null==e&&(e={}),null==e.has_outputs&&(e.has_outputs=!0),this._has_outputs=e.has_outputs},e.prototype.has_outputs=function(){return this._has_outputs},e.prototype.has_named_outputs=function(){return this._has_named_outputs},e.prototype.has_named_output=function(e){return null!=this._get_named_output_index_without_error(e)},e.prototype.named_outputs=function(){return this._named_outputs},e.prototype.named_output=function(e){return this._named_outputs[e]},e.prototype._get_named_output_index_without_error=function(e){var t=this.named_outputs(),n=-1;return t.forEach((function(t,r){t.name()==e&&(n=r)})),n},e.prototype.get_named_output_index=function(e){var t=this._get_named_output_index_without_error(e);if(null==t){var n=this.named_outputs().map((function(e){return e.name()})).join(", ");throw new Error("no outputs named '"+e+"'. available names are "+n)}return t},e.prototype.get_output_index=function(e){return e?s.default(e)?this.has_named_outputs()?this.get_named_output_index(e):(console.warn("node "+this.node.full_path()+" has no named outputs"),-1):e:-1},e.prototype.named_output_by_name=function(e){return this._named_outputs.filter((function(t){return t.name()==e}))[0]},e.prototype.set_named_outputs=function(e){this._has_named_outputs=!0,this._named_outputs=e,this.node.scene&&this.node.set_dirty(this.node),this.node.emit(a.NodeEvent.NAMED_OUTPUTS_UPDATED)},e.prototype.used_output_names=function(){var e=this,t=i.default(this.node.io.connections.output_connections().map((function(e){return e?e.output_index:null}))),n=[];return t.forEach((function(e){o.default(e)&&n.push(e)})),n.map((function(t){return e.named_outputs()[t].name()}))},e}();t.OutputsController=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=r.__importDefault(n(161)),i=r.__importDefault(n(389)),s=r.__importDefault(n(150)),a=r.__importDefault(n(103)),_=n(28),u=function(e){function t(t){var n=e.call(this)||this;return n._node=t,n._node_ids=[],n}return r.__extends(t,e),t.prototype.node=function(){return this._node},t.prototype.clear=function(){this._node_ids=[]},t.prototype.nodes=function(){return this._node.scene.graph.nodes_from_ids(this._node_ids)},t.prototype.contains=function(e){return this._node_ids.includes(e.graph_node_id)},t.prototype.equals=function(e){var t=e.map((function(e){return e.graph_node_id})).sort();return a.default(t,this._node_ids)},t.prototype.set=function(e){return this.remove(this.nodes()),this.add(e)},t.prototype.add=function(e){var t=e.map((function(e){return e.graph_node_id}));return this._node_ids=s.default(this._node_ids,t),this.update_nodes_ui_data(e)},t.prototype.remove=function(e){var t=e.map((function(e){return e.graph_node_id}));this._node_ids=i.default(this._node_ids,t),this.update_nodes_ui_data(e)},t.prototype.update_nodes_ui_data=function(e){this.node().emit(_.NodeEvent.SELECTION_UPDATED)},t.prototype.to_json=function(){return this._node_ids},t}(o.default);t.default=u},,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(e){this.node=e};t.ParamsAccessor=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.set_content=function(t){e.prototype.set_content.call(this,t)},t}(n(174).TypedContainer);t.ManagerContainer=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.set_content=function(t){e.prototype.set_content.call(this,t)},t.prototype.set_object=function(e){return this.set_content(e)},t.prototype.has_object=function(){return this.has_content()},t.prototype.object=function(){return this.content()},t}(n(174).TypedContainer);t.ObjectContainer=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(395),o=n(52),i=function(){function e(e){this.node=e,this._camera_controller=new r.CameraController(this._update_from_look_at_target.bind(this))}return Object.defineProperty(e.prototype,"active",{get:function(){return""!=this.param.value},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"param",{get:function(){return this.node.params.get_operator_path("look_at")},enumerable:!0,configurable:!0}),e.prototype.compute=function(){var e=this.param.found_node();e?e instanceof o.BaseObjNodeclass?this._camera_controller.set_target(e.object):this.node.states.error.set("look_at node is not an obj"):(this._camera_controller.remove_target(),this.node.transform_controller.update_transform_with_matrix())},e.prototype._update_from_look_at_target=function(e){var t=this.node.object;null!=t?(t.matrixAutoUpdate=!0,t.up.copy(this.node.params.value("up")),t.lookAt(e.position)):console.log("no object yet",this.node.full_path())},e}();t.LookAtController=i},function(e,t,n){"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.CHANGE="change",e.MOVEEND="moveend"}(r||(r={}));var o=function(){function e(e){this._callback=e,this._update_always=!0,this._listener=this._execute_callback.bind(this)}return e.prototype.remove_target=function(){this.set_target(null)},e.prototype.set_target=function(e){e||this._remove_camera_event();var t=this._target;this._target=e,null!=this._target&&this._execute_callback(),(null!=this._target?this._target.uuid:void 0)!==(null!=t?t.uuid:void 0)&&this._add_camera_event()},e.prototype.set_update_always=function(e){this._remove_camera_event(),this._update_always=e,this._add_camera_event()},e.prototype._current_event_name=function(){return this._update_always?r.CHANGE:r.MOVEEND},e.prototype._add_camera_event=function(){!0!==this._listener_added&&null!=this._target&&(this._target.addEventListener(this._current_event_name(),this._listener),this._listener_added=!0)},e.prototype._remove_camera_event=function(){!0===this._listener_added&&null!=this._target&&(this._target.removeEventListener(this._current_event_name(),this._listener),this._listener_added=!1)},e.prototype._execute_callback=function(){null!=this._target&&this._callback(this._target)},e}();t.CameraController=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(76),o=n(397),i=n(175),s=function(){function e(e){this.node=e}return e.prototype.post_set_input=function(){null!=this.node.io.inputs.input(0)?this.node.root.add_to_parent_transform(this.node):this.node.root.remove_from_parent_transform(this.node)},e.prototype.update=function(e){return this.node.object?1==this.node.look_at_controller.active?this.node.look_at_controller.compute():this.update_transform_with_matrix(e):(console.warn("no object to update for "+this.node.full_path()),!1)},e.prototype.update_transform_with_matrix=function(e){var t=this.node.object;return null==e||e.equals(t.matrix)?this.update_transform_from_params():(t.matrixAutoUpdate=!1,t.matrix=e,t.dispatchEvent({type:"change"}))},e.prototype.update_transform_from_params=function(){var e=this.node.object;if(e){var t=this.node.params.vector3("t"),n=this.node.params.vector3("r"),i=this.node.params.vector3("s").clone().multiplyScalar(this.node.params.float("scale"));e.matrixAutoUpdate=!1,e.position.copy(t);var s=[o.CoreMath.degrees_to_radians(n.x),o.CoreMath.degrees_to_radians(n.y),o.CoreMath.degrees_to_radians(n.z)],a=new r.Euler(s[0],s[1],s[2]);e.rotation.copy(a),e.scale.copy(i),e.matrixAutoUpdate=!0,e.updateMatrix(),e.dispatchEvent({type:"change"})}},e.prototype.set_params_from_matrix=function(e,t){void 0===t&&(t={}),i.CoreTransform.set_params_from_matrix(e,this.node,t)},e}();t.TransformController=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(1),i={Triangle:n(44).Triangle,Vector3:o.Vector3},s=r.__importDefault(n(106)),a=n(398),_=Math.PI/180,u=function(){function e(){}return e.clamp=function(e,t,n){return e<t?t:e>n?n:e},e.fit01=function(e,t,n){return this.fit(e,0,1,t,n)},e.fit=function(e,t,n,r,o){return(e-t)/(n-t)*(o-r)+r},e.degrees_to_radians=function(e){return e*_},e.radians_to_degrees=function(e){return e/_},e.deg2rad=function(e){return this.degrees_to_radians(e)},e.rad2deg=function(e){return this.radians_to_degrees(e)},e.rand=function(e){return s.default(e)?this.rand_float(e):this.rand_vec2(e)},e.round=function(e,t){var n=e/t,r=e<0?Math.ceil(n):Math.floor(n);return console.log("round",t,e,n,r,r*t),r*t},e.highest_even=function(e){return 2*Math.ceil(.5*e)},e.rand_float=function(e){var t={x:e,y:136574};return this.rand_vec2(t)},e.rand_vec2=function(e){var t=(12.9898*e.x+78.233*e.y)%Math.PI;return this.fract(43758.5453*Math.sin(t))},e.geodesic_distance=function(e,t){var n=this.deg2rad(e.lat),r=this.deg2rad(t.lat),o=this.deg2rad(t.lat-e.lat),i=this.deg2rad(t.lng-e.lng),s=Math.sin(o/2)*Math.sin(o/2)+Math.cos(n)*Math.cos(r)*Math.sin(i/2)*Math.sin(i/2);return 6371e3*(2*Math.atan2(Math.sqrt(s),Math.sqrt(1-s)))},e.expand_triangle=function(e,t){var n,r=new i.Vector3;e.getMidpoint(r),function(e){e.a="a",e.b="b",e.c="c"}(n||(n={}));for(var o=0,s=["a","b","c"];o<s.length;o++){var a=s[o],_=e[a].clone().sub(r),u=_.clone().normalize(),c=_.length()+t;e[a]=r.clone().add(u.multiplyScalar(c))}return e},e.nearestPower2=function(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.log(2)))},e.Easing=a.Easing,e.fract=function(e){return e-Math.floor(e)},e}();t.CoreMath=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(e){return function(t){return Math.pow(t,e)}},o=function(e){return function(t){return 1-Math.abs(Math.pow(t-1,e))}},i=function(e){return function(t){return t<.5?r(e)(2*t)/2:o(e)(2*t-1)/2+.5}};t.Easing={linear:i(1),ease_i:function(e,t){return r(t)(e)},ease_o:function(e,t){return o(t)(e)},ease_io:function(e,t){return i(t)(e)},ease_i2:r(2),ease_o2:o(2),ease_io2:i(2),ease_i3:i(3),ease_o3:i(3),ease_io3:i(3),ease_i4:i(4),ease_o4:i(4),ease_io4:i(4),ease_i_sin:function(e){return 1+Math.sin(Math.PI/2*e-Math.PI/2)},ease_o_sin:function(e){return Math.sin(Math.PI/2*e)},ease_io_sin:function(e){return(1+Math.sin(Math.PI*e-Math.PI/2))/2},ease_i_elastic:function(e){return(.04-.04/e)*Math.sin(25*e)+1},ease_o_elastic:function(e){return.04*e/--e*Math.sin(25*e)},ease_io_elastic:function(e){return(e-=.5)<0?(.02+.01/e)*Math.sin(50*e):(.02-.01/e)*Math.sin(50*e)+1}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=r.__importDefault(n(164)),i=n(175),s=n(52),a=n(400),_=n(402),u=n(403),c=n(405),p=n(411),l=n(13),d=n(38),h={type:"change"};t.BASE_CAMERA_DEFAULT={near:1,far:100};var f=n(74),m=function(e){function n(){var n=null!==e&&e.apply(this,arguments)||this;return n.controls=f.ParamConfig.OPERATOR_PATH("",{node_selection:{context:d.NodeContext.EVENT}}),n.target=f.ParamConfig.VECTOR3([0,0,0],{cook:!1}),n.near=f.ParamConfig.FLOAT(t.BASE_CAMERA_DEFAULT.near,{range:[0,100]}),n.far=f.ParamConfig.FLOAT(t.BASE_CAMERA_DEFAULT.far,{range:[0,100]}),n.aspect=f.ParamConfig.FLOAT(1),n.lock_width=f.ParamConfig.BOOLEAN(1),n.use_background=f.ParamConfig.BOOLEAN(0),n.use_material=f.ParamConfig.BOOLEAN(0,{visible_if:{use_background:!0}}),n.background_color=f.ParamConfig.COLOR([0,0,0],{visible_if:{use_background:!0,use_material:!1}}),n.background_material=f.ParamConfig.OPERATOR_PATH("",{visible_if:{use_background:!0,use_material:!0},node_selection:{context:d.NodeContext.MAT},dependent_on_found_node:!1}),n.background_ratio=f.ParamConfig.FLOAT(1,{visible_if:{use_background:!0,use_material:!0}}),n}return r.__extends(n,e),n}(f.NodeParamsConfig);t.BaseCameraObjParamsConfig=m;var y=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),Object.defineProperty(t.prototype,"object",{get:function(){return this._object},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"background_controller",{get:function(){return this._background_controller=this._background_controller||new this.background_controller_constructor(this)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"background_controller_constructor",{get:function(){return p.BaseBackgroundController},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"controls_controller",{get:function(){return this._controls_controller=this._controls_controller||new a.ControlsController(this)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"layers_controller",{get:function(){return this._layers_controller=this._layers_controller||new _.LayersController(this)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"post_process_controller",{get:function(){return this._post_process_controller=this._post_process_controller||new u.PostProcessController(this)},enumerable:!0,configurable:!0}),t.prototype.initialize_node=function(){this.io.inputs.set_count_to_one_max(),this._init_dirtyable_hook()},t.prototype.create_common_params=function(){var e=this;this.within_param_folder("transform",(function(){i.CoreTransform.create_params(e)})),this.within_param_folder("render",(function(){e.layers_controller.add_params()})),this.post_process_controller.add_params()},t.prototype.create_player_camera_params=function(){this.add_param(l.ParamType.BUTTON,"set_master_camera",null,{callback:this.set_as_master_camera.bind(this)})},t.prototype.cook=function(){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(e){switch(e.label){case 0:return this.transform_controller.update(),this.layers_controller.update(),[4,this.background_controller.update()];case 1:return e.sent(),this._object.near==this.pv.near&&this._object.far==this.pv.far||(this._object.near=this.pv.near,this._object.far=this.pv.far,this._object.updateProjectionMatrix()),[4,this.post_process_controller.update_composer_passes()];case 2:return e.sent(),this.update_camera(),this.controls_controller.update_controls(),this._object.dispatchEvent(h),this.cook_controller.end_cook(),[2]}}))}))},t.prototype.on_create=function(){},t.prototype.on_delete=function(){},t.prototype.camera=function(){return this._object},t.prototype.update_camera=function(){},t.prototype.set_as_master_camera=function(){this.scene.cameras_controller.set_master_camera_node_path(this.full_path())},t.prototype.setup_for_aspect_ratio=function(e){o.default(e)||e&&this._aspect!=e&&(this._aspect=e,this._update_for_aspect_ratio())},t.prototype._update_for_aspect_ratio=function(){},t.prototype.update_transform_params_from_object=function(){i.CoreTransform.set_params_from_object(this._object,this)},t.prototype.viewer=function(e){return new c.ThreejsViewer(e,this.scene,this)},t}(s.TypedObjNode);t.TypedCameraObjNode=y;var v=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t}(y);t.BaseCameraObjNodeClass=v},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(401),i=function(){function e(e){this.node=e,this._applied_controls_by_element_id={}}return e.prototype.controls_param=function(){return this.node.params.has("controls")?this.node.params.get("controls"):null},e.prototype.controls_node=function(){return this.node.p.controls.found_node()},e.prototype.update_controls=function(){var e=this.controls_node();e&&this._controls_node!=e&&this.dispose_control_refs(),this._controls_node=e},e.prototype.apply_controls=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,n,i,s,a;return r.__generator(this,(function(r){switch(r.label){case 0:return(t=this.controls_node())?(n=t.graph_node_id,i=!1,this._applied_controls_by_element_id[e.id]&&this._applied_controls_by_element_id[e.id][n]&&(i=!0),i?[3,2]:(this._applied_controls_by_element_id[e.id]=this._applied_controls_by_element_id[e.id]||{},this._applied_controls_by_element_id[e.id][n]=!0,[4,t.apply_controls(this.node.object,e)])):[3,2];case 1:return s=r.sent(),a=new o.CameraControlsConfig(this.node.graph_node_id,t,s),t.set_from_camera_node(s,this.node),this.set_controls_events(s),[2,a];case 2:return[2]}}))}))},e.prototype.dispose_control_refs=function(){this._applied_controls_by_element_id={}},e.prototype.dispose_controls=function(e){if(this._applied_controls_by_element_id[e.id]){var t=this.controls_node();if(t){var n=t.graph_node_id;delete this._applied_controls_by_element_id[e.id][n]}}},e.prototype.set_controls_events=function(e){var t=this;this.controls_start_listener=function(){t.on_controls_start(e)},this.controls_end_listener=function(){t.on_controls_end(e)},e.addEventListener("start",this.controls_start_listener),e.addEventListener("end",this.controls_end_listener)},e.prototype.on_controls_start=function(e){},e.prototype.on_controls_end=function(e){if(e.target){var t=e.target.toArray();this.node.params.set_vector3("target",t)}this.node.update_transform_params_from_object()},e}();t.ControlsController=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t,n){this._camera_node_id=e,this._controls_node=t,this._controls=n}return Object.defineProperty(e.prototype,"camera_node_id",{get:function(){return this._camera_node_id},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"controls",{get:function(){return this._controls},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"controls_node",{get:function(){return this._controls_node},enumerable:!0,configurable:!0}),e.prototype.is_equal=function(e){return e.camera_node_id==this._camera_node_id&&e.controls_node.graph_node_id==this._controls_node.graph_node_id},e}();t.CameraControlsConfig=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(13),o=function(){function e(e){this.node=e}return e.prototype.add_params=function(){this.node.add_param(r.ParamType.INTEGER,"layer",0,{range:[0,31],range_locked:[!0,!0]})},e.prototype.update=function(){var e=this.node.object;e.layers.set(0),e.layers.enable(this.node.params.integer("layer"))},e}();t.LayersController=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(426),i=n(0),s=n(3),a=r.__importDefault(n(165)),_=n(427),u=n(404),c=n(38),p=n(13),l=function(){function e(e){this.node=e,this._renderers_by_canvas_id={},this._composers_by_canvas_id={},this._resolution_by_canvas_id={},this._composers_set_in_progress_by_canvas_id={},this._post_process_nodes=[],this._post_process_use_node_path_params=[],this._post_process_node_path_params=[]}return e.prototype.render=function(e,t,n){var r=this.renderer(e);if(r)if(this.node.params.boolean("do_post_process")){var o=this.composer(e);o&&(o.setSize(t.x,t.y),o.render())}else this.node.setup_for_aspect_ratio(n),r.render(this.node.scene.display_scene,this.node.object)},e.prototype.renderer=function(e){return this._renderers_by_canvas_id[e.id]},e.prototype.create_renderer=function(e,t){var n=POLY.renderers_controller.rendering_context(e),r=new o.WebGLRenderer({canvas:e,antialias:!0,alpha:!0,context:n});return r.shadowMap.enabled=!0,r.physicallyCorrectLights=!0,r.toneMapping=i.ACESFilmicToneMapping,r.toneMappingExposure=1,r.outputEncoding=i.sRGBEncoding,POLY.renderers_controller.register_renderer(r),this._renderers_by_canvas_id[e.id]=r,this.set_renderer_size(e,t),r.setPixelRatio(window.devicePixelRatio),r},e.prototype.delete_renderer=function(e){var t=this.renderer(e);t&&POLY.renderers_controller.deregister_renderer(t)},e.prototype.set_renderer_size=function(e,t){this._resolution_by_canvas_id[e.id]=this._resolution_by_canvas_id[e.id]||new s.Vector2,this._resolution_by_canvas_id[e.id].copy(t);var n=this.renderer(e);n&&n.setSize(t.x,t.y);var r=this.composer(e);r&&r.setSize(t.x,t.y)},e.prototype.composer=function(e){return this._composers_by_canvas_id[e.id]=this._composers_by_canvas_id[e.id]||this._create_composer(e)},e.prototype._create_composer=function(e){var t=this.renderer(e);if(t){var n=new _.EffectComposer(t);return n.setPixelRatio(2*window.devicePixelRatio),this.set_composer_passes(e.id,n,t),n}},e.prototype.update_composer_passes=function(){return r.__awaiter(this,void 0,void 0,(function(){var e,t,n,o,i,s;return r.__generator(this,(function(r){switch(r.label){case 0:if(!this.node.params.boolean("do_post_process"))return[3,6];if(this._post_process_nodes=[],this._fetch_post_process_nodes_in_progress)return[2];if(this._fetch_post_process_nodes_in_progress=!0,!this.composer_passes_nodes_changed())return[3,5];this._post_process_nodes=[],e=0,t=a.default(4),r.label=1;case 1:return e<t.length?(n=t[e],o=this._post_process_use_node_path_params[n],o.value?(i=this._post_process_node_path_params[n],(s=i.found_node())?[4,s.request_container()]:[3,3]):[3,3]):[3,4];case 2:r.sent(),this._post_process_nodes.push(s),r.label=3;case 3:return e++,[3,1];case 4:this.set_composers_passes(),r.label=5;case 5:return this._fetch_post_process_nodes_in_progress=!1,[3,7];case 6:this._post_process_nodes=[],r.label=7;case 7:return[2]}}))}))},e.prototype.set_composers_passes=function(){for(var e=0,t=Object.keys(this._composers_by_canvas_id);e<t.length;e++){var n=t[e],r=this._composers_by_canvas_id[n],o=this._renderers_by_canvas_id[n];r&&this.set_composer_passes(n,r,o)}},e.prototype.set_composer_passes=function(e,t,n){if(!this._composers_set_in_progress_by_canvas_id[e]){this._composers_set_in_progress_by_canvas_id[e]=!0,this.clear_render_passes(t);var r=new u.RenderPass(this.node.scene.display_scene,this.node.object);r.clearAlpha=0,t.addPass(r);for(var o=0,i=this._post_process_nodes;o<i.length;o++){i[o].apply_to_composer(t,this.node.object,this._resolution_by_canvas_id[e],this.node)}delete this._composers_set_in_progress_by_canvas_id[e]}},e.prototype.clear_render_passes=function(e){for(var t;t=e.passes.pop();)if(t){var n=t;if("function"==typeof n.dispose)try{n.dispose()}catch(e){console.warn(e)}}e.passes=[]},e.prototype.composer_passes_nodes_changed=function(){return!0},e.prototype.add_params=function(){var e=this;this.node.within_param_folder("post_process",(function(){e.node.add_param(p.ParamType.BOOLEAN,"do_post_process",0),a.default(4).forEach((function(t){var n,r=e.node.add_param(p.ParamType.BOOLEAN,"use_post_process_node"+(t+1),0,{visible_if:{do_post_process:1}}),o=((n={do_post_process:1})[r.name]=1,n),i={node_selection:{context:c.NodeContext.POST},visible_if:o},s=e.node.add_param(p.ParamType.OPERATOR_PATH,"post_process_node"+(t+1),"",i);e._post_process_use_node_path_params.push(r),e._post_process_node_path_params.push(s)}))}))},e}();t.PostProcessController=l},function(e,t,n){"use strict";n.r(t),n.d(t,"RenderPass",(function(){return o}));var r=n(18),o=function(e,t,n,o,i){r.a.call(this),this.scene=e,this.camera=t,this.overrideMaterial=n,this.clearColor=o,this.clearAlpha=void 0!==i?i:0,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1};o.prototype=Object.assign(Object.create(r.a.prototype),{constructor:o,render:function(e,t,n){var r,o,i=e.autoClear;e.autoClear=!1,this.scene.overrideMaterial=this.overrideMaterial,this.clearColor&&(r=e.getClearColor().getHex(),o=e.getClearAlpha(),e.setClearColor(this.clearColor,this.clearAlpha)),this.clearDepth&&e.clearDepth(),e.setRenderTarget(this.renderToScreen?null:n),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),e.render(this.scene,this.camera),this.clearColor&&e.setClearColor(r,o),this.scene.overrideMaterial=null,e.autoClear=i}})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(406);n(55);var i=function(e){function t(t,n,r){var o=e.call(this,t,n,r)||this;return o._scene=n,o.do_render=!0,o._canvas=document.createElement("canvas"),o._canvas.id=("canvas_id_"+Math.random()).replace(".","_"),o._container.appendChild(o._canvas),o._container.classList.add("CoreThreejsViewer"),o._set_events(),o}return r.__extends(t,e),t.prototype._build=function(){this._init_display(),this.activate()},t.prototype.dispose=function(){this._cancel_animate(),this.controls_controller.dispose_controls()},t.prototype._set_events=function(){this.events_controller.init(),this.webgl_controller.init(),POLY.player_mode()&&(window.onresize=this.cameras_controller.on_resize.bind(this))},t.prototype._init_display=function(){this.cameras_controller.compute_size_and_aspect();var e=this.cameras_controller.size;this.cameras_controller.camera_node.post_process_controller.create_renderer(this._canvas,e),this.cameras_controller.prepare_current_camera(),this._animate_method=this.animate.bind(this),this.animate()},t.prototype.animate=function(){this.do_render&&(this.render(),this._request_animation_frame_id=requestAnimationFrame(this._animate_method))},t.prototype._cancel_animate=function(){this.do_render=!1,cancelAnimationFrame(this._request_animation_frame_id),this.cameras_controller.camera_node.post_process_controller.delete_renderer(this._canvas)},t.prototype.render=function(){if(this.cameras_controller.camera_node){var e=this.cameras_controller.size,t=this.cameras_controller.aspect;this.cameras_controller.camera_node.post_process_controller.render(this._canvas,e,t)}else console.warn("no camera to render with")},t}(o.BaseViewer);t.ThreejsViewer=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(407),i=n(408),s=n(409),a=n(410),_=function(){function e(e,t,n){var r=this;this._container=e,this._scene=t,this._active=!1,this._display_scene=this._scene.display_scene,this._init_from_scene(n).then((function(){r._build()}))}return Object.defineProperty(e.prototype,"active",{get:function(){return this._active},enumerable:!0,configurable:!0}),e.prototype.activate=function(){this._active=!0},e.prototype.deactivate=function(){this._active=!1},Object.defineProperty(e.prototype,"cameras_controller",{get:function(){return this._cameras_controller=this._cameras_controller||new o.CamerasController(this)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"controls_controller",{get:function(){return this._controls_controller=this._controls_controller||new i.ControlsController(this)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"events_controller",{get:function(){return this._events_controller=this._events_controller||new s.EventsController(this)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"webgl_controller",{get:function(){return this._webgl_controller=this._webgl_controller||new a.WebGLController(this)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"container",{get:function(){return this._container},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scene",{get:function(){return this._scene},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"canvas",{get:function(){return this._canvas},enumerable:!0,configurable:!0}),e.prototype._init_from_scene=function(e){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(t){return this.cameras_controller.set_camera_node(e||this._scene.cameras_controller.master_camera_node),[2]}))}))},e.prototype.reset_container_class=function(){this.container.classList.remove("hovered")},e.prototype.set_container_class_hovered=function(){this.container.classList.add("hovered")},e}();t.BaseViewer=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(3),i=function(){function e(e){this.viewer=e,this._size=new o.Vector2(100,100),this._aspect=1}return e.prototype.set_camera_node=function(e){this._camera_node&&e.graph_node_id==this._camera_node.graph_node_id||(this._camera_node=e)},Object.defineProperty(e.prototype,"camera_node",{get:function(){return this._camera_node},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"aspect",{get:function(){return this._aspect},enumerable:!0,configurable:!0}),e.prototype.on_resize=function(){this.compute_size_and_aspect(),this._camera_node.post_process_controller.set_renderer_size(this.viewer.canvas,this._size),this.update_camera_aspect()},e.prototype.compute_size_and_aspect=function(){this._update_size(),this._camera_node.scene.uniforms_controller.update_resolution_dependent_uniform_owners(this._size),this._aspect=this._get_aspect()},e.prototype._update_size=function(){this._size.x=this.viewer.container.offsetWidth,this._size.y=this.viewer.container.offsetHeight},e.prototype._get_aspect=function(){return this._size.x/this._size.y},e.prototype.update_camera_aspect=function(){this._camera_node.setup_for_aspect_ratio(this._aspect)},e.prototype.prepare_current_camera=function(){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(e){switch(e.label){case 0:return this._camera_node?[4,this._camera_node.request_container()]:[3,3];case 1:return e.sent(),[4,this._update_from_camera_container()];case 2:e.sent(),e.label=3;case 3:return[2]}}))}))},e.prototype._update_from_camera_container=function(){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(e){switch(e.label){case 0:return this.update_camera_aspect(),[4,this.viewer.controls_controller.create_controls()];case 1:return e.sent(),[2]}}))}))},e}();t.CamerasController=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=function(){function e(e){this.viewer=e,this._active=!1}return Object.defineProperty(e.prototype,"active",{get:function(){return this._active},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"camera_node",{get:function(){return this.viewer.cameras_controller.camera_node},enumerable:!0,configurable:!0}),e.prototype.create_controls=function(){return r.__awaiter(this,void 0,void 0,(function(){var e;return r.__generator(this,(function(t){switch(t.label){case 0:return this.dispose_controls(),[4,this.camera_node.controls_controller.apply_controls(this.viewer.canvas)];case 1:return(e=t.sent())&&(this._controls=e.controls,this._controls&&(this.viewer.active?(this._bound_on_controls_start=this._on_controls_start.bind(this),this._bound_on_controls_end=this._on_controls_end.bind(this),this._controls.addEventListener("start",this._bound_on_controls_start),this._controls.addEventListener("end",this._bound_on_controls_end)):this.dispose_controls())),[2]}}))}))},e.prototype.dispose_controls=function(){this._controls&&(this.camera_node.controls_controller.dispose_controls(this.viewer.canvas),this._bound_on_controls_start&&this._controls.removeEventListener("start",this._bound_on_controls_start),this._bound_on_controls_end&&this._controls.removeEventListener("end",this._bound_on_controls_end),this._controls.dispose(),this._controls=null)},e.prototype._on_controls_start=function(){this._active=!0},e.prototype._on_controls_end=function(){this._active=!1},e}();t.ControlsController=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this.viewer=e,this._mouse_distance_travelled=-1}return Object.defineProperty(e.prototype,"camera_node",{get:function(){return this.viewer.cameras_controller.camera_node},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"canvas",{get:function(){return this.viewer.canvas},enumerable:!0,configurable:!0}),e.prototype.init=function(){this._bound_on_mousedown&&this.canvas.removeEventListener("mousedown",this._bound_on_mousedown),this._bound_on_mousemove&&this.canvas.removeEventListener("mousemove",this._bound_on_mousemove),this._bound_on_click&&this.canvas.removeEventListener("mouseup",this._bound_on_click),this._bound_on_mousedown=this._bound_on_mousedown||this._on_mousedown.bind(this),this._bound_on_mousemove=this._bound_on_mousemove||this._on_mousemove.bind(this),this._bound_on_mouseup=this._bound_on_mouseup||this._on_mouseup.bind(this),this.canvas.addEventListener("mousedown",this._bound_on_mousedown),this.canvas.addEventListener("mousemove",this._bound_on_mousemove),this.canvas.addEventListener("mouseup",this._bound_on_mouseup),this.canvas.addEventListener("touchstart",this._bound_on_mousedown,!1),this.canvas.addEventListener("touchmove",this._bound_on_mousemove,!1),this.canvas.addEventListener("touchend",this._bound_on_mouseup,!1),this.canvas.addEventListener("touchcancel",this._bound_on_mouseup,!1)},e.prototype._on_mousedown=function(e){this._mouse_distance_travelled=0,this._mousedown_pos.x=e.pageX,this._mousedown_pos.y=e.pageY},e.prototype._on_mousemove=function(e){-1!==this._mouse_distance_travelled&&(this._mouse_distance_travelled+=Math.abs(e.pageX-this._mousedown_pos.x+(e.pageY-this._mousedown_pos.y))),this.viewer.controls_controller.active},e.prototype._on_mouseup=function(e){this._mouse_distance_travelled,this._mouse_distance_travelled=-1},e}();t.EventsController=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this.viewer=e}return e.prototype.init=function(){this.viewer.canvas.onwebglcontextlost=this._on_webglcontextlost.bind(this),this.viewer.canvas.onwebglcontextrestored=this._on_webglcontextrestored.bind(this)},e.prototype._on_webglcontextlost=function(e){console.warn("context lost at frame",this.viewer.scene.frame),e.preventDefault(),cancelAnimationFrame(this.request_animation_frame_id),console.warn("not canceled",this.request_animation_frame_id)},e.prototype._on_webglcontextrestored=function(e){console.log("context restored",e)},e}();t.WebGLController=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(412),i=n(39),s=n(23),a=n(118),_=function(){function e(e){this.node=e,this._bg_raycaster=new o.Raycaster}return Object.defineProperty(e.prototype,"screen_quad",{get:function(){return this._screen_quad=this._screen_quad||this._create_screen_quad()},enumerable:!0,configurable:!0}),e.prototype._create_screen_quad=function(){var e=new i.PlaneBufferGeometry(2,2,1,1),t=new s.Mesh(e);return this.node.object.add(t),t},e.prototype.screen_quad_flat_material=function(){return this._screen_quad_flat_material=this._screen_quad_flat_material||new a.MeshBasicMaterial},e.prototype.add_params=function(){this.node.within_param_folder("background",(function(){}))},Object.defineProperty(e.prototype,"use_background",{get:function(){return this.node.params.boolean("use_background")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"use_background_material",{get:function(){return this.use_background&&this.node.params.boolean("use_material")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"use_background_color",{get:function(){return this.use_background&&!this.node.params.boolean("use_material")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"background_color",{get:function(){return this.use_background_color?this.node.params.color("background_color"):null},enumerable:!0,configurable:!0}),e.prototype.update_screen_quad=function(){},e.prototype.update=function(){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(e){switch(e.label){case 0:return this.use_background?(this.update_screen_quad(),[4,this.update_background_color()]):[3,4];case 1:return e.sent(),this.use_background_material?[4,this.update_background_material()]:[3,3];case 2:e.sent(),e.label=3;case 3:return[3,5];case 4:this._screen_quad&&this.node.object.remove(this._screen_quad),e.label=5;case 5:return[2]}}))}))},e.prototype.update_background_color=function(){return r.__awaiter(this,void 0,void 0,(function(){var e;return r.__generator(this,(function(t){return(e=this.screen_quad_flat_material()).color=this._param_background_color,this.screen_quad.material=e,[2]}))}))},e.prototype.update_background_material=function(){return r.__awaiter(this,void 0,void 0,(function(){var e,t;return r.__generator(this,(function(n){switch(n.label){case 0:return(e=this.node.p.background_material.found_node())?[4,e.request_container()]:[3,2];case 1:return n.sent(),t=e.material,this.screen_quad.material=t,[3,3];case 2:this.node.states.error.set("bg node not found"),n.label=3;case 3:return[2]}}))}))},e}();t.BaseBackgroundController=_},,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(52),i=n(4),s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._color_with_intensity=new i.Color(0),t}return r.__extends(t,e),Object.defineProperty(t.prototype,"object",{get:function(){return this._object},enumerable:!0,configurable:!0}),t.prototype.initialize_base_node=function(){e.prototype.initialize_base_node.call(this),this.flags.add_display(),this._init_dirtyable_hook()},t.prototype.create_params=function(){return this.create_light_params(),this.create_shadow_params_main()},t.prototype.create_shadow_params_main=function(){if(null!=this.object.shadow)return this.create_shadow_params()},t.prototype.create_shadow_params=function(){},t.prototype.cook=function(){this.update_light_params(),this.update_shadow_params(),this.cook_controller.end_cook()},t.prototype.update_shadow_params=function(){},Object.defineProperty(t.prototype,"color_with_intensity",{get:function(){var e=this.params.color("color"),t=this.params.float("intensity");return this._color_with_intensity.copy(e).multiplyScalar(t),this._color_with_intensity},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"active",{get:function(){return this.flags.display.active},enumerable:!0,configurable:!0}),t}(o.TypedObjNode);t.BaseLightObjNode=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(115),i=n(38),s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.type=function(){return"events"},t.prototype.initialize_node=function(){this.children_controller.init(i.NodeContext.EVENT)},t}(o.BaseManagerObjNode);t.EventsObjNode=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(115),i=n(38),s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.type=function(){return"materials"},t.prototype.initialize_node=function(){this.children_controller.init(i.NodeContext.MAT)},t}(o.BaseManagerObjNode);t.MaterialsObjNode=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(52),i=n(417),s=n(418),a={color:new(n(4).Color)(1,1,1),near:0,far:100,density:25e-5},_=n(74),u=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.color=_.ParamConfig.COLOR(a.color.toArray()),t.exponential=_.ParamConfig.BOOLEAN(0),t.density=_.ParamConfig.FLOAT(1),t.near=_.ParamConfig.FLOAT(0,{range:[0,100]}),t.far=_.ParamConfig.FLOAT(100,{range:[0,100]}),t}return r.__extends(t,e),t}(_.NodeParamsConfig)),c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=u,t}return r.__extends(t,e),t.prototype.initialize_node=function(){this.flags.add_display(),this._init_dirtyable_hook(),this._linear_fog=new s.Fog(a.color.getHex(),a.near,a.far),this._linear_fogexp2=new i.FogExp2(a.color.getHex(),a.density)},t.type=function(){return"fog"},t.prototype.cook=function(){var e;this.pv.exponential?(this._linear_fogexp2.density=this.pv.density,e=this._linear_fogexp2):(this._linear_fog.near=this.pv.near,this._linear_fog.far=this.pv.far,e=this._linear_fog),e.color.copy(this.pv.color),this.scene.display_scene.fog=e,this.cook_controller.end_cook()},t}(o.TypedObjNode);t.FogObjNode=c},,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=r.__importDefault(n(108)),i=r.__importDefault(n(119)),s=r.__importDefault(n(111)),a=n(420),_=function(){function e(){this._started=!1,this._start_time=0,this._previous_timestamp=0,this._nodes_cook_data={}}return e.prototype.profile=function(e,t){var n=performance.now();t();var r=performance.now()-n;console.log(e+": "+r)},e.prototype.start=function(){this._started||(this.reset(),this._started=!0,this._start_time=performance.now(),this._nodes_cook_data={},this._previous_timestamp=this._start_time)},e.prototype.stop=function(){this.reset()},e.prototype.reset=function(){this._started=!1,this._start_time=null,this._durations_by_name={},this._durations_count_by_name={},this._nodes_cook_data={}},e.prototype.recording_started=function(){return this._started},e.prototype.record_node_cook_data=function(e){var t=e.graph_node_id;null==this._nodes_cook_data[t]&&(this._nodes_cook_data[t]=new a.PerformanceNode(e)),this._nodes_cook_data[t].update_cook_data()},e.prototype.record=function(e){this.recording_started()||this.start();var t=performance.now();return null==this._durations_by_name[e]&&(this._durations_by_name[e]=0),this._durations_by_name[e]+=t-this._previous_timestamp,null==this._durations_count_by_name[e]&&(this._durations_count_by_name[e]=0),this._durations_count_by_name[e]+=1,this._previous_timestamp=t},e.prototype.print=function(){this.print_node_cook_data(),this.print_recordings()},e.prototype.print_node_cook_data=function(){var e=Object.values(this._nodes_cook_data),t=(e=s.default(e,(function(e){return-e.cook_time_total()}))).map((function(e){return e.print_object()}));console.log("--------------- NODES COOK TIME -----------");for(var n=[],r=0,o=s.default(t,(function(e){return-e.cook_time_total}));r<o.length;r++){var i=o[r];n.push(i)}return console.table(n),t},e.prototype.print_recordings=function(){for(var e=i.default(this._durations_by_name),t=i.default(this._durations_count_by_name),n=[],r={},s=0,a=Object.keys(e);s<a.length;s++){var _=a[s],u=e[_];n.push(u),null==r[u]&&(r[u]=[]),r[u].push(_)}n.sort((function(e,t){return e-t}));var c=o.default(n);console.log("--------------- PERF RECORDINGS -----------");for(var p=[],l=0,d=c;l<d.length;l++)for(var h=0,f=r[u=d[l]];h<f.length;h++){var m=f[h],y=t[m],v={duration:u,name:m,count:y,duration_per_iteration:u/y};p.push(v)}return console.table(p),p},e}();t.CorePerformance=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this._cooks_count=0,this._cook_time_total=0,this._cook_time_total_with_inputs=0,this._cook_time_total_params=0,this._node=e,this._cooks_count=0,this._cook_time_total=0,this._cook_time_total_with_inputs=0,this._cook_time_total_params=0}return e.prototype.update_cook_data=function(){return this._cooks_count+=1,this._cook_time_total+=this._node.cook_time(),this._cook_time_total_with_inputs+=this._node.cook_time_with_inputs(),this._cook_time_total_params+=this._node.cook_time_params()},e.prototype.cook_time_total=function(){return this._cook_time_total},e.prototype.cook_time_per_iteration=function(){return this._cooks_count>0?this._cook_time_total/this._cooks_count:0},e.prototype.cook_time_total_with_inputs=function(){return this._cook_time_total_with_inputs},e.prototype.cook_time_total_with_inputs_per_iteration=function(){return this._cooks_count>0?this._cook_time_total_with_inputs/this._cooks_count:0},e.prototype.cook_time_total_params=function(){return this._cook_time_total_params},e.prototype.cook_time_total_params_per_iteration=function(){return this._cooks_count>0?this._cook_time_total_params/this._cooks_count:0},e.prototype.cooks_count=function(){return this._cooks_count},e.prototype.print_object=function(){return{full_path:this._node.full_path(),cooks_count:this.cooks_count(),cook_time_total:this.cook_time_total(),cook_time_per_iteration:this.cook_time_per_iteration(),cook_time_total_with_inputs:this.cook_time_total_with_inputs(),cook_time_total_with_inputs_per_iteration:this.cook_time_total_with_inputs_per_iteration(),cook_time_total_params:this.cook_time_total_params(),cook_time_total_params_per_iteration:this.cook_time_total_params_per_iteration()}},e}();t.PerformanceNode=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(31),o=n(422),i=function(){function e(e){this.scene=e,this.self=this,this._frame_range=[1,600],this._frame_range_locked=[!0,!0],this._playing=!1,this._fps=60,this._frame_interval=1e3/60,this._graph_node=new r.CoreGraphNode(e,"time controller")}return Object.defineProperty(e.prototype,"graph_node",{get:function(){return this._graph_node},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fps",{get:function(){return this._fps},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"frame",{get:function(){return this._frame},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"time",{get:function(){return this._frame/this._fps},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"frame_range",{get:function(){return this._frame_range},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"frame_range_locked",{get:function(){return this._frame_range_locked},enumerable:!0,configurable:!0}),e.prototype.set_frame_range=function(e,t){this._frame_range=[Math.floor(e),Math.floor(t)],this.scene.events_controller.dispatch(this._graph_node,o.SceneEvent.FRAME_RANGE_UPDATED)},e.prototype.set_frame_range_locked=function(e,t){this._frame_range_locked=[e,t],this.scene.events_controller.dispatch(this._graph_node,o.SceneEvent.FRAME_RANGE_UPDATED)},e.prototype.set_fps=function(e){this._fps=Math.floor(e),this._frame_interval=1e3/this._fps,this.scene.events_controller.dispatch(this._graph_node,o.SceneEvent.FRAME_RANGE_UPDATED)},e.prototype.set_frame=function(e){(e=this._ensure_frame_within_bounds(e))!=this.frame&&(this._frame=e,this.scene.events_controller.dispatch(this._graph_node,o.SceneEvent.FRAME_UPDATED),this.scene.uniforms_controller.update_frame_dependent_uniform_owners())},e.prototype.increment_frame=function(){this.set_frame(this.frame+1)},e.prototype.decrement_frame=function(){this.set_frame(this.frame-1)},e.prototype.set_first_frame=function(){this.set_frame(this.frame_range[0])},e.prototype._ensure_frame_within_bounds=function(e){return this._frame_range_locked[0]&&e<this._frame_range[0]&&(e=this._frame_range[1]),this._frame_range_locked[1]&&e>this._frame_range[1]&&(e=this._frame_range[0]),e},Object.defineProperty(e.prototype,"playing",{get:function(){return!0===this._playing},enumerable:!0,configurable:!0}),e.prototype.pause=function(){this._playing=!1,this.scene.events_controller.dispatch(this._graph_node,o.SceneEvent.PLAY_STATE_UPDATED)},e.prototype.play=function(){!0!==this._playing&&setTimeout(this.play_next_frame.bind(this),this._frame_interval),this._playing=!0,this.scene.events_controller.dispatch(this._graph_node,o.SceneEvent.PLAY_STATE_UPDATED)},e.prototype.toggle_play_pause=function(){this.playing?this.pause():this.play()},e.prototype.play_next_frame=function(){this.playing&&(this.scene.root.are_children_cooking()||this.increment_frame(),setTimeout(this.play_next_frame.bind(this),this._frame_interval))},e}();t.TimeController=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.FRAME_RANGE_UPDATED="scene_frame_range_updated",e.FRAME_UPDATED="scene_frame_updated",e.PLAY_STATE_UPDATED="scene_play_state_updated"}(t.SceneEvent||(t.SceneEvent={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this.scene=e}return e.prototype.to_json=function(e){void 0===e&&(e=!1);for(var t={},n={},r=0,o=this.scene.nodes_controller.all_nodes();r<o.length;r++){var i=o[r];t[i.graph_node_id]=i.to_json(e);for(var s=0,a=i.params.all;s<a.length;s++){var _=a[s];n[_.graph_node_id]=_.to_json()}}return{nodes_by_graph_node_id:t,params_by_graph_node_id:n}},e}();t.Serializer=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=function(){function e(e){this.scene=e,this._frame_dependent_uniform_owners={},this._resolution_dependent_uniform_owners={},this._resolution_dependent_uniform_owners_ids=[]}return e.prototype.add_frame_dependent_uniform_owner=function(e,t){this._frame_dependent_uniform_owners[e]=t,this._update_frame_dependent_uniform_owners_ids()},e.prototype.remove_frame_dependent_uniform_owner=function(e){delete this._frame_dependent_uniform_owners[e],this._update_frame_dependent_uniform_owners_ids()},e.prototype._update_frame_dependent_uniform_owners_ids=function(){this._frame_dependent_uniform_owners_ids=Object.keys(this._frame_dependent_uniform_owners)},e.prototype.update_frame_dependent_uniform_owners=function(){for(var e=this.scene.frame,t=0,n=this._frame_dependent_uniform_owners_ids;t<n.length;t++){var r=n[t];this._frame_dependent_uniform_owners[r].frame.value=e}},e.prototype.add_resolution_dependent_uniform_owner=function(e,t){this._resolution_dependent_uniform_owners[e]=t,this._update_resolution_dependent_uniform_owners_ids(),this._resolution&&this.update_resolution_dependent_uniforms(t)},e.prototype.remove_resolution_dependent_uniform_owner=function(e){delete this._resolution_dependent_uniform_owners[e],this._update_resolution_dependent_uniform_owners_ids()},e.prototype._update_resolution_dependent_uniform_owners_ids=function(){this._resolution_dependent_uniform_owners_ids=Object.keys(this._resolution_dependent_uniform_owners)},e.prototype.update_resolution_dependent_uniform_owners=function(e){this._resolution=this._resolution||new r.Vector2,this._resolution.copy(e);for(var t=0,n=this._resolution_dependent_uniform_owners_ids;t<n.length;t++){var o=n[t],i=this._resolution_dependent_uniform_owners[o];this.update_resolution_dependent_uniforms(i)}},e.prototype.update_resolution_dependent_uniforms=function(e){e.resolution.value.x=this._resolution.x*window.devicePixelRatio,e.resolution.value.y=this._resolution.y*window.devicePixelRatio},e}();t.UniformsController=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){this._require_webgl2=!1}return e.prototype.require_webgl2=function(){return this._require_webgl2},e.prototype.set_require_webgl2=function(){this._require_webgl2||(this._require_webgl2=!0,POLY.renderers_controller.set_require_webgl2())},e}();t.WebGLController=r},,function(e,t,n){"use strict";n.r(t);var r=n(176),o=n(0),i=n(23),s=n(79),a=n(39),_=n(3),u=n(25),c={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float opacity;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","\tvec4 texel = texture2D( tDiffuse, vUv );","\tgl_FragColor = opacity * texel;","}"].join("\n")},p=n(33),l=n(9),d=n(18),h=function(e,t){d.a.call(this),this.textureID=void 0!==t?t:"tDiffuse",e instanceof p.a?(this.uniforms=e.uniforms,this.material=e):e&&(this.uniforms=l.a.clone(e.uniforms),this.material=new p.a({defines:Object.assign({},e.defines),uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),this.fsQuad=new d.a.FullScreenQuad(this.material)};h.prototype=Object.assign(Object.create(d.a.prototype),{constructor:h,render:function(e,t,n){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=n.texture),this.fsQuad.material=this.material,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),this.fsQuad.render(e))}});var f=function(e,t){d.a.call(this),this.scene=e,this.camera=t,this.clear=!0,this.needsSwap=!1,this.inverse=!1};f.prototype=Object.assign(Object.create(d.a.prototype),{constructor:f,render:function(e,t,n){var r,o,i=e.getContext(),s=e.state;s.buffers.color.setMask(!1),s.buffers.depth.setMask(!1),s.buffers.color.setLocked(!0),s.buffers.depth.setLocked(!0),this.inverse?(r=0,o=1):(r=1,o=0),s.buffers.stencil.setTest(!0),s.buffers.stencil.setOp(i.REPLACE,i.REPLACE,i.REPLACE),s.buffers.stencil.setFunc(i.ALWAYS,r,4294967295),s.buffers.stencil.setClear(o),s.buffers.stencil.setLocked(!0),e.setRenderTarget(n),this.clear&&e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(t),this.clear&&e.clear(),e.render(this.scene,this.camera),s.buffers.color.setLocked(!1),s.buffers.depth.setLocked(!1),s.buffers.stencil.setLocked(!1),s.buffers.stencil.setFunc(i.EQUAL,1,4294967295),s.buffers.stencil.setOp(i.KEEP,i.KEEP,i.KEEP),s.buffers.stencil.setLocked(!0)}});var m=function(){d.a.call(this),this.needsSwap=!1};m.prototype=Object.create(d.a.prototype),Object.assign(m.prototype,{render:function(e){e.state.buffers.stencil.setLocked(!1),e.state.buffers.stencil.setTest(!1)}}),n.d(t,"EffectComposer",(function(){return y})),n.d(t,"Pass",(function(){return w}));var y=function(e,t){if(this.renderer=e,void 0===t){var n={minFilter:o.LinearFilter,magFilter:o.LinearFilter,format:o.RGBAFormat,stencilBuffer:!1},i=e.getSize(new _.Vector2);this._pixelRatio=e.getPixelRatio(),this._width=i.width,this._height=i.height,(t=new u.a(this._width*this._pixelRatio,this._height*this._pixelRatio,n)).texture.name="EffectComposer.rt1"}else this._pixelRatio=1,this._width=t.width,this._height=t.height;this.renderTarget1=t,this.renderTarget2=t.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],void 0===c&&console.error("THREE.EffectComposer relies on CopyShader"),void 0===h&&console.error("THREE.EffectComposer relies on ShaderPass"),this.copyPass=new h(c),this.clock=new r.a};Object.assign(y.prototype,{swapBuffers:function(){var e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e},addPass:function(e){this.passes.push(e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)},insertPass:function(e,t){this.passes.splice(t,0,e)},isLastEnabledPass:function(e){for(var t=e+1;t<this.passes.length;t++)if(this.passes[t].enabled)return!1;return!0},render:function(e){void 0===e&&(e=this.clock.getDelta());var t,n,r=this.renderer.getRenderTarget(),o=!1,i=this.passes.length;for(n=0;n<i;n++)if(!1!==(t=this.passes[n]).enabled){if(t.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(n),t.render(this.renderer,this.writeBuffer,this.readBuffer,e,o),t.needsSwap){if(o){var s=this.renderer.getContext(),a=this.renderer.state.buffers.stencil;a.setFunc(s.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,e),a.setFunc(s.EQUAL,1,4294967295)}this.swapBuffers()}void 0!==f&&(t instanceof f?o=!0:t instanceof m&&(o=!1))}this.renderer.setRenderTarget(r)},reset:function(e){if(void 0===e){var t=this.renderer.getSize(new _.Vector2);this._pixelRatio=this.renderer.getPixelRatio(),this._width=t.width,this._height=t.height,(e=this.renderTarget1.clone()).setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2},setSize:function(e,t){this._width=e,this._height=t;var n=this._width*this._pixelRatio,r=this._height*this._pixelRatio;this.renderTarget1.setSize(n,r),this.renderTarget2.setSize(n,r);for(var o=0;o<this.passes.length;o++)this.passes[o].setSize(n,r)},setPixelRatio:function(e){this._pixelRatio=e,this.setSize(this._width,this._height)}});var v,g,b,w=function(){this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1};Object.assign(w.prototype,{setSize:function(){},render:function(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}}),w.FullScreenQuad=(v=new s.a(-1,1,1,-1,0,1),g=new a.PlaneBufferGeometry(2,2),b=function(e){this._mesh=new i.Mesh(g,e)},Object.defineProperty(b.prototype,"material",{get:function(){return this._mesh.material},set:function(e){this._mesh.material=e}}),Object.assign(b.prototype,{dispose:function(){this._mesh.geometry.dispose()},render:function(e){e.render(this._mesh,v)}}),b)}]);