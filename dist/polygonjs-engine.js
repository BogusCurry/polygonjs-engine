/*! For license information please see polygonjs-engine.js.LICENSE.txt */
!function(e){function t(t){for(var r,a,s=t[0],_=t[1],u=t[2],p=0,l=[];p<s.length;p++)a=s[p],Object.prototype.hasOwnProperty.call(o,a)&&o[a]&&l.push(o[a][0]),o[a]=0;for(r in _)Object.prototype.hasOwnProperty.call(_,r)&&(e[r]=_[r]);for(c&&c(t);l.length;)l.shift()();return i.push.apply(i,u||[]),n()}function n(){for(var e,t=0;t<i.length;t++){for(var n=i[t],r=!0,s=1;s<n.length;s++){var _=n[s];0!==o[_]&&(r=!1)}r&&(i.splice(t--,1),e=a(a.s=n[0]))}return e}var r={},o={6:0},i=[];function a(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,a),n.l=!0,n.exports}a.m=e,a.c=r,a.d=function(e,t,n){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)a.d(n,r,function(t){return e[t]}.bind(null,r));return n},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="";var s=window.webpackJsonp=window.webpackJsonp||[],_=s.push.bind(s);s.push=t,s=s.slice();for(var u=0;u<s.length;u++)t(s[u]);var c=_;i.push([415,8,0,5,7,3,1,2,4,9]),n()}([,,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(24),o=n(128),i=function(e,t,n){this.type=e,this.init_value=t,this.options=n};t.ParamTemplate=i;var a=function(){function e(){}return e.BUTTON=function(e,t){return new i(r.ParamType.BUTTON,e,t)},e.BOOLEAN=function(e,t){return new i(r.ParamType.BOOLEAN,e,t)},e.COLOR=function(e,t){return new i(r.ParamType.COLOR,e,t)},e.FLOAT=function(e,t){return new i(r.ParamType.FLOAT,e,t)},e.FOLDER=function(e,t){return void 0===e&&(e=null),new i(r.ParamType.FOLDER,e,t)},e.INTEGER=function(e,t){return new i(r.ParamType.INTEGER,e,t)},e.OPERATOR_PATH=function(e,t){return new i(r.ParamType.OPERATOR_PATH,e,t)},e.RAMP=function(e,t){return void 0===e&&(e=o.RampParam.DEFAULT_VALUE),new i(r.ParamType.RAMP,e,t)},e.SEPARATOR=function(e,t){return void 0===e&&(e=null),new i(r.ParamType.SEPARATOR,e,t)},e.STRING=function(e,t){return void 0===e&&(e=""),new i(r.ParamType.STRING,e,t)},e.VECTOR2=function(e,t){return new i(r.ParamType.VECTOR2,e,t)},e.VECTOR3=function(e,t){return new i(r.ParamType.VECTOR3,e,t)},e.VECTOR4=function(e,t){return new i(r.ParamType.VECTOR4,e,t)},e}();t.ParamConfig=a;var s=function(){};t.NodeParamsConfig=s},,,,,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,o=n(2),i=o.__importDefault(n(81)),a=o.__importDefault(n(208)),s=n(90),_=n(35),u=n(378),c=n(162),p=n(829),l=n(113),d=n(27),f=n(94);!function(e){e.FROM_SET_CORE_GROUP="from set_core_group",e.FROM_SET_GROUP="from set_group",e.FROM_SET_OBJECTS="from set_objects",e.FROM_SET_OBJECT="from set_object",e.FROM_SET_GEOMETRIES="from set_geometries",e.FROM_SET_GEOMETRY="from set_geometry"}(r||(r={}));var h=["input geometry","input geometry","input geometry","input geometry"],m=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.container_controller=new l.TypedContainerController(t,p.GeometryContainer),t.flags=new f.FlagsControllerDB(t),t}return o.__extends(t,e),t.node_context=function(){return d.NodeContext.SOP},t.displayed_input_names=function(){return h},t.prototype.initialize_base_node=function(){var e=this;this.flags.display&&(this.flags.display.set(!1),this.flags.display.add_hook((function(){if(e.flags.display.active){var t=e.parent;t&&t.display_node_controller&&t.display_node_controller.set_display_node(e)}}))),this.io.outputs.set_has_one_output()},t.prototype.set_core_group=function(e){for(var t=0,n=e.objects();t<n.length;t++){var o=n[t];this._set_object_attributes(o)}this.set_container(e,r.FROM_SET_CORE_GROUP)},t.prototype.set_object=function(e){this._set_object_attributes(e),this.set_container_objects([e],r.FROM_SET_OBJECT)},t.prototype.set_objects=function(e){for(var t=0,n=e;t<n.length;t++){var o=n[t];this._set_object_attributes(o)}this.set_container_objects(e,r.FROM_SET_OBJECTS)},t.prototype.set_geometry=function(e,t){var n=this.create_object(e,t);this.set_container_objects([n],r.FROM_SET_GEOMETRY)},t.prototype.set_geometries=function(e,t){var n,o=this,i=[];e.forEach((function(e){n=o.create_object(e,t),o._set_object_attributes(n),i.push(n)})),this.set_container_objects(i,r.FROM_SET_GEOMETRIES)},t.prototype.set_container_objects=function(e,t){var n=this.container_controller.container.core_content()||new u.CoreGroup;n.set_objects(e),n.touch(),this.set_container(n)},t.prototype.create_object=function(e,t){if(!e.index){var n=e.getAttribute("position").array;e.setIndex(i.default(n.length/3))}null==t&&(t=_.CoreConstant.OBJECT_TYPE.MESH);var r=new(0,_.CoreConstant.CONSTRUCTORS_BY_NAME[t])(e,_.CoreConstant.MATERIALS[t].clone());return r.castShadow=!0,r.receiveShadow=!0,r.frustumCulled=!1,r},t.prototype._set_object_attributes=function(e){var t=e.material;if(t){if(!this.scene)throw console.log("no scene"),"no scene";var n=c.CoreMaterial.node(this.scene,t);n&&n.add_render_hook(e)}},t.prototype._add_index=function(e){var t=e.getAttribute("position").array.length/3,n=[];a.default(t,(function(e){return n.push(e)})),e.setIndex(n)},t}(s.TypedNode);t.TypedSopNode=m;var y=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o.__extends(t,e),t}(m);t.BaseSopNodeClass=y},,,function(e,t,n){"use strict";var r,o,i,a;Object.defineProperty(t,"__esModule",{value:!0});var s,_=n(24),u=n(128);!function(e){e.BOOL="bool",e.INT="int",e.FLOAT="float",e.VEC2="vec2",e.VEC3="vec3",e.VEC4="vec4",e.SAMPLER_2D="sampler2D"}(s=t.ConnectionPointType||(t.ConnectionPointType={})),t.ConnectionPointTypes=[s.BOOL,s.INT,s.FLOAT,s.VEC2,s.VEC3,s.VEC4],t.ConnectionPointTypeToParamTypeMap=((r={})[s.BOOL]=_.ParamType.BOOLEAN,r[s.INT]=_.ParamType.INTEGER,r[s.FLOAT]=_.ParamType.FLOAT,r[s.VEC2]=_.ParamType.VECTOR2,r[s.VEC3]=_.ParamType.VECTOR3,r[s.VEC4]=_.ParamType.VECTOR4,r[s.SAMPLER_2D]=_.ParamType.RAMP,r),t.ParamTypeToConnectionPointTypeMap=((o={})[_.ParamType.BOOLEAN]=s.BOOL,o[_.ParamType.COLOR]=s.VEC3,o[_.ParamType.INTEGER]=s.INT,o[_.ParamType.FLOAT]=s.FLOAT,o[_.ParamType.FOLDER]=void 0,o[_.ParamType.VECTOR2]=s.VEC2,o[_.ParamType.VECTOR3]=s.VEC3,o[_.ParamType.VECTOR4]=s.VEC4,o[_.ParamType.BUTTON]=void 0,o[_.ParamType.OPERATOR_PATH]=void 0,o[_.ParamType.RAMP]=void 0,o[_.ParamType.SEPARATOR]=void 0,o[_.ParamType.STRING]=void 0,o),t.ConnectionPointInitValueMap=((i={})[s.BOOL]=!1,i[s.INT]=0,i[s.FLOAT]=0,i[s.VEC2]=[0,0],i[s.VEC3]=[0,0,0],i[s.VEC4]=[0,0,0,0],i[s.SAMPLER_2D]=u.RampParam.DEFAULT_VALUE_JSON,i),t.ConnectionPointComponentsCountMap=((a={})[s.BOOL]=1,a[s.INT]=1,a[s.FLOAT]=1,a[s.VEC2]=2,a[s.VEC3]=3,a[s.VEC4]=4,a[s.SAMPLER_2D]=1,a)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.ALWAYS="always",e.NEVER="never",e.FROM_NODE="from_node"}(t.InputCloneMode||(t.InputCloneMode={}))},,,,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.BOOLEAN="boolean",e.BUTTON="button",e.COLOR="color",e.FLOAT="float",e.FOLDER="folder",e.INTEGER="integer",e.OPERATOR_PATH="operator_path",e.RAMP="ramp",e.SEPARATOR="separator",e.STRING="string",e.VECTOR2="vector2",e.VECTOR3="vector3",e.VECTOR4="vector4"}(t.ParamType||(t.ParamType={}))},,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.COP="cop",e.EVENT="event",e.GL="gl",e.JS="js",e.MANAGER="managers",e.MAT="mat",e.OBJ="objects",e.SOP="sop",e.POST="post"}(t.NodeContext||(t.NodeContext={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(49),i=r.__importDefault(n(44)),a=r.__importDefault(n(262)),s=r.__importDefault(n(45)),_=function(){function e(){}return e.any=function(e){if(s.default(e))return e;if(a.default(e))return""+e;if(i.default(e))return""+o.CoreString.ensure_float(e);var t=e.toArray().map((function(e){return""+o.CoreString.ensure_float(e)}));return"vec"+t.length+"("+t.join(", ")+")"},e.vector3=function(e){return s.default(e)?e:"vec3("+e.toArray().map((function(e){return""+o.CoreString.ensure_float(e)})).join(", ")+")"},e.vector2=function(e){return s.default(e)?e:"vec2("+e.toArray().map((function(e){return""+o.CoreString.ensure_float(e)})).join(", ")+")"},e.vector3_float=function(e,t){return s.default(t)||(t=o.CoreString.ensure_float(t)),"vec4("+this.vector3(e)+", "+t+")"},e.float4=function(e,t,n,r){return s.default(e)||(e=o.CoreString.ensure_float(e)),s.default(t)||(t=o.CoreString.ensure_float(t)),s.default(n)||(n=o.CoreString.ensure_float(n)),s.default(r)||(r=o.CoreString.ensure_float(r)),"vec4("+e+", "+t+", "+n+", "+r+")"},e.float3=function(e,t,n){return s.default(e)||(e=o.CoreString.ensure_float(e)),s.default(t)||(t=o.CoreString.ensure_float(t)),s.default(n)||(n=o.CoreString.ensure_float(n)),"vec3("+e+", "+t+", "+n+")"},e.float2=function(e,t){return s.default(e)||(e=o.CoreString.ensure_float(e)),s.default(t)||(t=o.CoreString.ensure_float(t)),"vec2("+e+", "+t+")"},e.float=function(e){return s.default(e)||(e=o.CoreString.ensure_float(e)),""+e},e.int=function(e){return""+e},e.bool=function(e){return""+e},e}();t.ThreeToGl=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,o=n(2),i=n(363);!function(e){e.ATTRIBUTE="attribute",e.FUNCTION="function",e.UNIFORM="uniform",e.VARYING="varying"}(r=t.GLDefinitionType||(t.GLDefinitionType={}));var a=function(){function e(e,t,n,r){this._definition_type=e,this._data_type=t,this._node=n,this._name=r}return Object.defineProperty(e.prototype,"definition_type",{get:function(){return this._definition_type},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"data_type",{get:function(){return this._data_type},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"node",{get:function(){return this._node},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0}),e.prototype.collection_instance=function(){return new i.TypedGLDefinitionCollection},e}();t.TypedGLDefinition=a;var s=function(e){function t(t,n,o){var i=e.call(this,r.ATTRIBUTE,n,t,o)||this;return i._node=t,i._data_type=n,i._name=o,i}return o.__extends(t,e),Object.defineProperty(t.prototype,"line",{get:function(){return"attribute "+this.data_type+" "+this.name},enumerable:!0,configurable:!0}),t}(a);t.AttributeGLDefinition=s;var _=function(e){function t(t,n,o){var i=e.call(this,r.FUNCTION,n,t,o)||this;return i._node=t,i._data_type=n,i._name=o,i}return o.__extends(t,e),Object.defineProperty(t.prototype,"line",{get:function(){return this.name},enumerable:!0,configurable:!0}),t}(a);t.FunctionGLDefinition=_;var u=function(e){function t(t,n,o){var i=e.call(this,r.UNIFORM,n,t,o)||this;return i._node=t,i._data_type=n,i._name=o,i}return o.__extends(t,e),Object.defineProperty(t.prototype,"line",{get:function(){return"uniform "+this.data_type+" "+this.name},enumerable:!0,configurable:!0}),t}(a);t.UniformGLDefinition=u;var c=function(e){function t(t,n,o){var i=e.call(this,r.VARYING,n,t,o)||this;return i._node=t,i._data_type=n,i._name=o,i}return o.__extends(t,e),Object.defineProperty(t.prototype,"line",{get:function(){return"varying "+this.data_type+" "+this.name},enumerable:!0,configurable:!0}),t}(a);t.VaryingGLDefinition=c},,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(16),o=function(){function e(e,t,n){this._name=e,this._type=t,this._init_value=n,void 0===this._init_value&&(this._init_value=r.ConnectionPointInitValueMap[this._type])}return Object.defineProperty(e.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"type",{get:function(){return this._type},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"param_type",{get:function(){return r.ConnectionPointTypeToParamTypeMap[this._type]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"init_value",{get:function(){return this._init_value},enumerable:!0,configurable:!0}),e.prototype.to_json=function(){return this._json=this._json||this._create_json()},e.prototype._create_json=function(){return{name:this._name,type:this._type}},e}();t.TypedNamedConnectionPoint=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(90),i=n(28),a=n(27),s=n(5),_=n(652),u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.spare_params_controller=new _.GlNodeSpareParamsController(t),t}return r.__extends(t,e),t.node_context=function(){return a.NodeContext.GL},t.prototype.initialize_base_node=function(){this.io.connections.init_inputs(),this.ui_data.set_layout_horizontal(),this.io.outputs.set_named_output_connection_points([]),this.spare_params_controller.initialize_node()},t.prototype.cook=function(){console.warn("gl nodes should never cook")},t.prototype._set_mat_to_recompile=function(){var e;null===(e=this.material_node)||void 0===e||e.assembler_controller.set_compilation_required_and_dirty(this)},Object.defineProperty(t.prototype,"material_node",{get:function(){var e;if(this.parent)return this.parent.type==this.type?null===(e=this.parent)||void 0===e?void 0:e.material_node:this.parent},enumerable:!0,configurable:!0}),t.prototype.gl_var_name=function(e){return"v_POLY_"+this.name+"_"+e},t.prototype.variable_for_input=function(e){var t,n=this.io.inputs.get_input_index(e),r=this.io.connections.input_connection(n);if(r){var o=r.node_src,a=o.io.outputs.named_output_connection_points[r.output_index];if(a){var s=a.name;return o.gl_var_name(s)}throw console.warn("no output called '"+e+"' for gl node "+o.full_path()),"variable_for_input ERROR"}return i.ThreeToGl.any(null===(t=this.params.get(e))||void 0===t?void 0:t.value)},t.prototype.set_lines=function(e){},t.prototype.reset_code=function(){var e;null===(e=this._param_configs_controller)||void 0===e||e.reset()},t.prototype.set_param_configs=function(){},t.prototype.param_configs=function(){var e;return null===(e=this._param_configs_controller)||void 0===e?void 0:e.list},t.prototype.gl_input_default_value=function(e){return null},t}(o.TypedNode);t.TypedGlNode=u;var c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t}(u);t.BaseGlNodeClass=c;var p=new(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t}(s.NodeParamsConfig)),l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=p,t}return r.__extends(t,e),t}(u);t.ParamlessTypedGlNode=l},function(e,t,n){"use strict";var r,o,i;Object.defineProperty(t,"__esModule",{value:!0});var a,s=n(292),_=n(55),u=n(96),c=n(10),p=n(22),l=n(57),d=n(40),f=n(0),h=n(7),m=n(293),y=n(71),v=n(59),g=n(160),b=n(41);!function(e){e.MESH="MESH",e.POINTS="POINTS",e.LINE_SEGMENTS="LINE_SEGMENTS"}(a=t.ObjectType||(t.ObjectType={})),t.ObjectTypes=[a.MESH,a.POINTS,a.LINE_SEGMENTS],t.ObjectTypeMenuEntries=[{name:"Mesh",value:t.ObjectTypes.indexOf(a.MESH)},{name:"Points",value:t.ObjectTypes.indexOf(a.POINTS)},{name:"LineSegments",value:t.ObjectTypes.indexOf(a.LINE_SEGMENTS)}],t.ObjectTypeByObject=function(e){return e instanceof p.Mesh?a.MESH:e instanceof l.LineSegments?a.LINE_SEGMENTS:e instanceof u.Points?a.POINTS:void console.warn("ObjectTypeByObject received an unknown object type",e)};var x,P,T=((r={MeshStandard:new v.MeshStandardMaterial({color:16777215,side:f.FrontSide,metalness:.5,roughness:.9})})[a.MESH]=new g.MeshLambertMaterial({color:new h.Color(.5,.5,1),side:f.FrontSide,vertexColors:!1,transparent:!0,depthTest:!0}),r[a.POINTS]=new y.PointsMaterial({color:16777215,size:.1,depthTest:!0}),r[a.LINE_SEGMENTS]=new b.LineBasicMaterial({color:16777215,linewidth:1}),r);!function(e){e[e.VERTEX=0]="VERTEX",e[e.OBJECT=1]="OBJECT"}(x=t.AttribClass||(t.AttribClass={})),t.AttribClassMenuEntries=[{name:"vertex",value:x.VERTEX},{name:"object",value:x.OBJECT}],function(e){e[e.NUMERIC=0]="NUMERIC",e[e.STRING=1]="STRING"}(P=t.AttribType||(t.AttribType={})),t.AttribTypeMenuEntries=[{name:"numeric",value:P.NUMERIC},{name:"string",value:P.STRING}],t.CoreConstant={ATTRIB_CLASS:{VERTEX:x.VERTEX,OBJECT:x.OBJECT},ATTRIB_TYPE:{NUMERIC:0,STRING:1},OBJECT_TYPE:{MESH:a.MESH,POINTS:a.POINTS,LINE_SEGMENTS:a.LINE_SEGMENTS},OBJECT_TYPES:t.ObjectTypes,CONSTRUCTOR_NAMES_BY_CONSTRUCTOR_NAME:(o={},o[_.Scene.name]="Scene",o[d.Group.name]="Group",o[c.Object3D.name]="Object3D",o[p.Mesh.name]="Mesh",o[u.Points.name]="Points",o[l.LineSegments.name]="LineSegments",o[m.Bone.name]="Bone",o[s.SkinnedMesh.name]="SkinnedMesh",o),CONSTRUCTORS_BY_NAME:(i={},i[a.MESH]=p.Mesh,i[a.POINTS]=u.Points,i[a.LINE_SEGMENTS]=l.LineSegments,i),MATERIALS:T}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=r.__importDefault(n(81)),i=r.__importDefault(n(92)),a=n(368),s=n(28),_=n(16),u=new(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t}(n(5).NodeParamsConfig)),c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=u,t}return r.__extends(t,e),t.prototype.gl_method_name=function(){return""},t.prototype.gl_function_definitions=function(){return[]},t.prototype.initialize_node=function(){e.prototype.initialize_node.call(this),this.gl_connections_controller.set_expected_input_types_function(this._expected_input_types.bind(this)),this.gl_connections_controller.set_expected_output_types_function(this._expected_output_types.bind(this)),this.gl_connections_controller.set_input_name_function(this._gl_input_name.bind(this))},t.prototype._expected_input_types=function(){var e=this.gl_connections_controller.first_input_connection_type()||_.ConnectionPointType.FLOAT;if(this.io.connections.first_input_connection()){var t=Math.max(i.default(this.io.connections.input_connections()).length+1,2);return o.default(t).map((function(t){return e}))}return o.default(2).map((function(t){return e}))},t.prototype._expected_output_types=function(){return[this._expected_input_types()[0]]},t.prototype._gl_input_name=function(e){return"in"},t.prototype.set_lines=function(e){var t=this,n=this.io.outputs.named_output_connection_points[0].type,r=this.io.inputs.named_input_connection_points.map((function(e,n){var r=e.name;return s.ThreeToGl.any(t.variable_for_input(r))})).join(", "),o=n+" "+this.gl_var_name(this.gl_connections_controller.output_name(0))+" = "+this.gl_method_name()+"("+r+")";e.add_body_lines(this,[o]),e.add_definitions(this,this.gl_function_definitions())},t}(a.BaseAdaptiveGlNode);t.BaseGlMathFunctionGlNode=c;var p=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype._gl_input_name=function(e){return"in"},t.prototype._expected_input_types=function(){return[this.gl_connections_controller.first_input_connection_type()||_.ConnectionPointType.FLOAT]},t}(c);t.BaseNodeGlMathFunctionArg1GlNode=p;var l=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype._expected_input_types=function(){var e=this.gl_connections_controller.first_input_connection_type()||_.ConnectionPointType.FLOAT;return[e,e]},t}(c);t.BaseNodeGlMathFunctionArg2GlNode=l;var d=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype._expected_input_types=function(){var e=this.gl_connections_controller.first_input_connection_type()||_.ConnectionPointType.FLOAT;return[e,e,e]},t}(c);t.BaseNodeGlMathFunctionArg3GlNode=d;var f=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype._expected_input_types=function(){var e=this.gl_connections_controller.first_input_connection_type()||_.ConnectionPointType.FLOAT;return[e,e,e,e]},t}(c);t.BaseNodeGlMathFunctionArg4GlNode=f;var h=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype._expected_input_types=function(){var e=this.gl_connections_controller.first_input_connection_type()||_.ConnectionPointType.FLOAT;return[e,e,e,e,e]},t}(c);t.BaseNodeGlMathFunctionArg5GlNode=h},,,,,,,,,,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,o=n(2),i=o.__importDefault(n(81)),a=o.__importDefault(n(91)),s=o.__importDefault(n(188)),_=o.__importDefault(n(92)),u=o.__importDefault(n(82)),c=o.__importDefault(n(548)),p=o.__importDefault(n(342)),l=o.__importDefault(n(552)),d=o.__importDefault(n(343)),f=o.__importDefault(n(560)),h=o.__importDefault(n(44)),m=/[, ]/,y=/\d+$/,v=/,| /,g=/^-?\d+\.?\d*$/;!function(e){e.TRUE="true",e.FALSE="false"}(r||(r={}));var b=function(){function e(){}return e.is_boolean=function(e){return e==r.TRUE||e==r.FALSE},e.to_boolean=function(e){return e==r.TRUE},e.is_number=function(e){return g.test(e)},e.tail_digits=function(e){var t=e.match(y);return t?parseInt(t[0]):0},e.increment=function(e){var t;if(t=e.match(y)){var n=parseInt(t[0]);return""+e.substring(0,e.length-t[0].length)+(n+1)}return e+"1"},e.pluralize=function(e){return"s"!==e[e.length-1]?e+"s":e},e.camel_case=function(e){return f.default(e)},e.upper_first=function(e){return d.default(e)},e.snake_case=function(e){return l.default(e)},e.titleize=function(e){return p.default(e.replace(/_/g," "))},e.type_to_class_name=function(e){return this.upper_first(f.default(e))},e.timestamp_to_seconds=function(e){return Date.parse(e)/1e3},e.seconds_to_timestamp=function(e){var t=new Date;return t.setTime(1e3*e),t.toISOString().substr(11,8)},e.precision=function(e,t){void 0===t&&(t=2),t=Math.max(t,0);var n=(""+e).split(".");if(t<=0)return n[0];var r=n[1];if(void 0!==r)return r.length>t&&(r=r.substring(0,t)),r=c.default(r,t,"0"),n[0]+"."+r;var o=e+".",i=o.length+t;return c.default(o,i,"0")},e.ensure_float=function(e){var t=""+e;return t.indexOf(".")>=0?t:t+".0"},e.match_mask=function(e,t){return"*"===t||(t="^"+(t=t.split("*").join(".*"))+"$",new RegExp(t).test(e))},e.matches_one_mask=function(t,n){for(var r=!1,o=0,i=n;o<i.length;o++){var a=i[o];e.match_mask(t,a)&&(r=!0)}return r},e.attrib_names=function(e){var t=e.split(m),n=_.default(t.map((function(e){return s.default(e)})));return a.default(n)},e.to_id=function(e){if(null==e)return 0;var t=e.split("").reverse(),n=0,r=0;return t.forEach((function(e,t){var o=e.charCodeAt(0);o>=0&&(r=t%10,n+=o*Math.pow(10,r),n%=Number.MAX_SAFE_INTEGER)})),n},e.indices=function(e){var t=this,n=e.split(v);if(n.length>1)return a.default(u.default(n.map((function(e){return t.indices(e)})))).sort((function(e,t){return e-t}));var r=n[0];if(r){if(r.indexOf("-")>0){var o=r.split("-");return i.default(parseInt(o[0]),parseInt(o[1])+1)}var s=parseInt(r);return h.default(s)?[s]:[]}return[]},e.escape_line_breaks=function(e){return e.replace(/(\r\n|\n|\r)/gm,"\\n")},e}();t.CoreString=b},function(e,t,n){"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.VERTEX="vertex",e.FRAGMENT="fragment",e.LEAVES_FROM_NODES_SHADER="leaves_from_nodes_shader",e.PARTICLES_0="particles_0",e.PARTICLES_1="particles_1",e.PARTICLES_2="particles_2",e.PARTICLES_3="particles_3",e.PARTICLES_4="particles_4",e.PARTICLES_5="particles_5",e.PARTICLES_6="particles_6",e.PARTICLES_7="particles_7",e.PARTICLES_8="particles_8",e.PARTICLES_9="particles_9"}(r=t.ShaderName||(t.ShaderName={})),t.ParticleShaderNames=[r.PARTICLES_0,r.PARTICLES_1,r.PARTICLES_2,r.PARTICLES_3,r.PARTICLES_4,r.PARTICLES_5,r.PARTICLES_6,r.PARTICLES_7,r.PARTICLES_8,r.PARTICLES_9]},,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(1),i=n(4),a=n(4),s=n(6),_=n(97),u=r.__importDefault(n(81)),c=r.__importDefault(n(91)),p=r.__importDefault(n(180)),l=r.__importDefault(n(379)),d=r.__importDefault(n(190)),f=r.__importDefault(n(169)),h=r.__importDefault(n(21)),m=r.__importDefault(n(44)),y=n(380),v=n(827),g=n(35),b=n(114),x=n(828),P=n(277),T=function(){function e(e){this._geometry=e}return e.prototype.geometry=function(){return this._geometry},e.prototype.uuid=function(){return this._geometry.uuid},e.prototype.bounding_box=function(){return this._bounding_box=this._bounding_box||this._create_bounding_box()},e.prototype._create_bounding_box=function(){if(this._geometry.computeBoundingBox(),this._geometry.boundingBox)return this._geometry.boundingBox},e.prototype.mark_as_instance=function(){this._geometry.userData.is_instance=!0},e.marked_as_instance=function(e){return!0===e.userData.is_instance},e.prototype.marked_as_instance=function(){return e.marked_as_instance(this._geometry)},e.prototype.position_attrib_name=function(){var e="position";return this.marked_as_instance()&&(e="instancePosition"),e},e.prototype.compute_vertex_normals=function(){this._geometry.computeVertexNormals()},e.prototype.user_data_attribs=function(){var e="indexed_attrib_values";return this._geometry.userData[e]=this._geometry.userData[e]||{}},e.prototype.indexed_attribute_names=function(){return Object.keys(this.user_data_attribs()||{})},e.prototype.user_data_attrib=function(e){return e=b.CoreAttribute.remap_name(e),this.user_data_attribs()[e]},e.prototype.is_attrib_indexed=function(e){return e=b.CoreAttribute.remap_name(e),null!=this.user_data_attrib(e)},e.prototype.has_attrib=function(e){return"ptnum"===e||(e=b.CoreAttribute.remap_name(e),null!=this._geometry.attributes[e])},e.prototype.attrib_type=function(e){return this.is_attrib_indexed(e)?g.CoreConstant.ATTRIB_TYPE.STRING:g.CoreConstant.ATTRIB_TYPE.NUMERIC},e.prototype.attrib_names=function(){return Object.keys(this._geometry.attributes)},e.prototype.attrib_sizes=function(){for(var e={},t=0,n=this.attrib_names();t<n.length;t++){var r=n[t];e[r]=this._geometry.attributes[r].itemSize}return e},e.prototype.attrib_size=function(e){var t;return e=b.CoreAttribute.remap_name(e),null!=(t=this._geometry.attributes[e])?t.itemSize:"ptnum"===e?1:0},e.prototype.set_indexed_attribute_values=function(e,t){this.user_data_attribs()[e]=t},e.prototype.set_indexed_attribute=function(e,t,n){this.set_indexed_attribute_values(e,t),this._geometry.setAttribute(e,new i.Int32BufferAttribute(n,1))},e.prototype.add_numeric_attrib=function(e,t,n){void 0===t&&(t=1),void 0===n&&(n=0);var r=[],o=!1;if(m.default(n)){for(var i=0;i<this.points_count();i++)for(var s=0;s<t;s++)r.push(n);o=!0}else if(t>1)if(h.default(n)){for(i=0;i<this.points_count();i++)for(s=0;s<t;s++)r.push(n[s]);o=!0}else{var _=n;if(2==t&&null!=_.x&&null!=_.y){for(i=0;i<this.points_count();i++)r.push(_.x),r.push(_.y);o=!0}var u=n;if(3==t&&null!=u.x&&null!=u.y&&null!=u.z){for(i=0;i<this.points_count();i++)r.push(u.x),r.push(u.y),r.push(u.z);o=!0}var c=n;if(3==t&&null!=c.r&&null!=c.g&&null!=c.b){for(i=0;i<this.points_count();i++)r.push(c.r),r.push(c.g),r.push(c.b);o=!0}var p=n;if(4==t&&null!=p.x&&null!=p.y&&null!=p.z&&null!=p.w){for(i=0;i<this.points_count();i++)r.push(p.x),r.push(p.y),r.push(p.z),r.push(p.w);o=!0}}if(!o)throw"no other default value allowed for now in add_numeric_attrib";this._geometry.setAttribute(e,new a.Float32BufferAttribute(r,t))},e.prototype.init_position_attribute=function(e,t){var n=[];null==t&&(t=new o.Vector3);for(var r=0;r<e;r++)n.push(t.x),n.push(t.y),n.push(t.z);return this._geometry.setAttribute("position",new a.Float32BufferAttribute(n,3))},e.prototype.add_attribute=function(e,t){switch(t.type()){case g.CoreConstant.ATTRIB_TYPE.STRING:return console.log("TODO: to implement");case g.CoreConstant.ATTRIB_TYPE.NUMERIC:return this.add_numeric_attrib(e,t.size())}},e.prototype.rename_attribute=function(e,t){this.is_attrib_indexed(e)&&(this.user_data_attribs()[t]=f.default(this.user_data_attribs()[e]),delete this.user_data_attribs()[e]);var n=this._geometry.getAttribute(e);return this._geometry.setAttribute(t,new a.Float32BufferAttribute(n.array,n.itemSize)),this._geometry.deleteAttribute(e)},e.prototype.delete_attribute=function(e){return this.is_attrib_indexed(e)&&delete this.user_data_attribs()[e],this._geometry.deleteAttribute(e)},e.prototype.clone=function(){return e.clone(this._geometry)},e.clone=function(e){for(var t,n=0,r=Object.keys(e.attributes);n<r.length;n++){var o=r[n],i=e.getAttribute(o);i.constructor.name==_.InterleavedBufferAttribute.name&&x.MonkeyPatcher.patch(i)}var a=e.clone();return null!=(t=e.userData)&&(a.userData=d.default(t)),a},e.prototype.points_count=function(){return e.points_count(this._geometry)},e.points_count=function(e){var t,n=0,r="position";if(new this(e).marked_as_instance()&&(r="instancePosition"),null!=(t=e.getAttribute(r))){var o;null!=(o=t.array)&&(n=o.length/3)}return n},e.prototype.points=function(){return this._points=this._points||this.points_from_geometry()},e.prototype.reset_points=function(){this._points=void 0},e.prototype.points_from_geometry=function(){var e=[],t=this._geometry.getAttribute(this.position_attrib_name());if(null!=t)for(var n=t.array.length/3,r=0;r<n;r++){var o=new y.CorePoint(this,r);e.push(o)}return e},e.geometry_from_points=function(e,t){var n=new s.BufferGeometry,r=new this(n),o=e[0];if(null!=o){var i=o.geometry(),_=o.geometry_wrapper(),u={};p.default(e,(function(e,t){return u[e.index]=t}));var l=this._indices_from_points(u,i,t);null!=l&&0!==l.length&&n.setIndex(l);for(var d=i.attributes,f=function(t){if(null!=_.user_data_attribs()[t]){var o=c.default(e.map((function(e){return e.attrib_value(t)}))),i={};p.default(o,(function(e,t){return i[e]=t})),r.user_data_attribs()[t]=o;for(var s=[],u=0,l=e;u<l.length;u++){var f=l[u],h=i[f.attrib_value(t)];s.push(h)}n.setAttribute(t,new a.Float32BufferAttribute(s,1))}else{for(var m=[],y=d[t].itemSize,v=0,g=e;v<g.length;v++){var b=(f=g[v]).attrib_value(t);switch(y){case 1:m.push(b);case 3:m.push(b.x),m.push(b.y),m.push(b.z)}}n.setAttribute(t,new a.Float32BufferAttribute(m,y))}},h=0,m=Object.keys(d);h<m.length;h++){f(m[h])}}return n},e._indices_from_points=function(e,t,n){var r=t.index;if(null!=r){var o=r.array,i=[];switch(n){case g.CoreConstant.OBJECT_TYPE.POINTS:p.default(o,(function(t,n){var r=e[t];null!=r&&i.push(r)}));break;case g.CoreConstant.OBJECT_TYPE.MESH:p.default(o,(function(t,n){if(n%3==0){var r=o[n],a=o[n+1],s=o[n+2],_=e[r],u=e[a],c=e[s];null!=_&&null!=u&&null!=c&&(i.push(_),i.push(u),i.push(c))}}));break;case g.CoreConstant.OBJECT_TYPE.LINE_SEGMENTS:p.default(o,(function(t,n){if(n%2==0){var r=o[n],a=o[n+1],s=e[r],_=e[a];null!=s&&null!=_&&(i.push(s),i.push(_))}}))}return i}},e.merge_geometries=function(t){if(0!==t.length){for(var n=t.map((function(t){return new e(t)})),r=n[0].indexed_attribute_names(),o={},i=0,a=r;i<a.length;i++){for(var s=a[i],_={},u=[],c=0,p=n;c<p.length;c++)for(var l=0,d=p[c].points();l<d.length;l++){var f=d[l];u.push(f),null!=_[v=f.attrib_value(s)]?_[v]:_[v]=Object.keys(_).length}for(var h=Object.keys(_),m=0,y=u;m<y.length;m++){var v,g=_[v=(f=y[m]).attrib_value(s)];f.set_attrib_index(s,g)}o[s]=h}var b=P.BufferGeometryUtils.mergeBufferGeometries(t),x=new this(b);return Object.keys(o).forEach((function(e){var t=o[e];x.set_indexed_attribute_values(e,t)})),b&&delete b.userData.mergedUserData,b}},e.prototype.segments=function(){var e,t=(null===(e=this.geometry().index)||void 0===e?void 0:e.array)||[];return l.default(t,2)},e.prototype.faces=function(){return this.faces_from_geometry()},e.prototype.faces_from_geometry=function(){var e,t=this,n=((null===(e=this.geometry().index)||void 0===e?void 0:e.array)||[]).length/3;return u.default(n).map((function(e){return new v.CoreFace(t,e)}))},e}();t.CoreGeometry=T},,,,,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.CREATED="node_created",e.DELETED="node_deleted",e.NAME_UPDATED="node_name_update",e.OVERRIDE_CLONABLE_STATE_UPDATE="node_override_clonable_state_update",e.NAMED_OUTPUTS_UPDATED="node_named_outputs_updated",e.NAMED_INPUTS_UPDATED="node_named_inputs_updated",e.INPUTS_UPDATED="node_inputs_updated",e.PARAMS_UPDATED="node_params_updated",e.UI_DATA_POSITION_UPDATED="node_ui_data_position_updated",e.UI_DATA_COMMENT_UPDATED="node_ui_data_comment_updated",e.ERROR_UPDATED="node_error_updated",e.FLAG_BYPASS_UPDATED="bypass_flag_updated",e.FLAG_DISPLAY_UPDATED="display_flag_updated",e.SELECTION_UPDATED="selection_updated"}(t.NodeEvent||(t.NodeEvent={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(101),i=n(352),a=n(587),s=r.__importDefault(n(45)),_=r.__importDefault(n(44)),u=function(){function e(e){this.param=e,this.node=this.param.node}return e.required_arguments=function(){return console.warn("Expression.Method._Base.required_arguments virtual method call. Please override"),[]},e.optional_arguments=function(){return[]},e.min_allowed_arguments_count=function(){return this.required_arguments().length},e.max_allowed_arguments_count=function(){return this.min_allowed_arguments_count()+this.optional_arguments().length},e.allowed_arguments_count=function(e){return e>=this.min_allowed_arguments_count()&&e<=this.max_allowed_arguments_count()},e.prototype.process_arguments=function(e){throw"Expression.Method._Base.process_arguments virtual method call. Please override"},e.prototype.get_referenced_node_container=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,n;return r.__generator(this,(function(r){switch(r.label){case 0:return(t=this.get_referenced_node(e))?[4,t.request_container()]:[3,2];case 1:if((n=r.sent())&&n.core_content())return[2,n];throw"referenced node invalid: "+t.full_path();case 2:throw"invalid input ("+e+")"}}))}))},e.prototype.get_referenced_param=function(e,t){return o.CoreWalker.find_param(this.node,e,t)||null},e.prototype.find_referenced_graph_node=function(e,t){if(_.default(e)){var n=e;return this.node.io.inputs.input_graph_node(n)}var r=e;return this.get_referenced_node(r,t)},e.prototype.get_referenced_node=function(e,t){if(s.default(e)){var n=e;return o.CoreWalker.find_node(this.node,n,t)}var r=e;return this.node.io.inputs.input(r),this.node.io.inputs.input(r)},e.prototype.find_dependency=function(e){return null},e.prototype.create_dependency_from_index_or_path=function(e){var t=new i.DecomposedPath,n=this.find_referenced_graph_node(e,t);return n?this.create_dependency(n,e,t):(console.warn("node not found for path",e),null)},e.prototype.create_dependency=function(e,t,n){return a.MethodDependency.create(this.param,t,e,n)},e}();t.BaseMethod=u},,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(531),o=n(532),i=function(){function e(){this.renderers_controller=new r.RenderersController,this.nodes_register=new o.NodesRegister,this.scenes_by_uuid={}}return e.instance=function(){return this._instance=this._instance||new e},e.prototype.register_node=function(e,t,n){this.nodes_register.register_node(e,t,n)},e.prototype.registered_nodes=function(e,t){return this.nodes_register.registered_nodes(e,t)},e.prototype.in_worker_thread=function(){return!1},e.prototype.desktop_controller=function(){},e.prototype.player_mode=function(){return!1},e.prototype.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];console.log.apply(console,e)},e.prototype.set_env=function(e){this._env=e},Object.defineProperty(e.prototype,"env",{get:function(){return this._env},enumerable:!0,configurable:!0}),e}();t.Poly=i,t.POLY=i.instance()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(534),o=function(){function e(e,t){this._scene=e,this._name=t,this._dirty_controller=new r.DirtyController(this),this._graph_node_id=e.graph.next_id(),e.graph.setNode(this),this._graph=e.graph}return Object.defineProperty(e.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0}),e.prototype.set_name=function(e){this._name=e},Object.defineProperty(e.prototype,"scene",{get:function(){return this._scene},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"graph",{get:function(){return this._graph},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"graph_node_id",{get:function(){return this._graph_node_id},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dirty_controller",{get:function(){return this._dirty_controller},enumerable:!0,configurable:!0}),e.prototype.set_dirty=function(e){e=e||this,this._dirty_controller.set_dirty(e)},e.prototype.set_successors_dirty=function(e){this._dirty_controller.set_successors_dirty(e)},e.prototype.remove_dirty_state=function(){this._dirty_controller.remove_dirty_state()},Object.defineProperty(e.prototype,"is_dirty",{get:function(){return this._dirty_controller.is_dirty},enumerable:!0,configurable:!0}),e.prototype.add_post_dirty_hook=function(e,t){this._dirty_controller.add_post_dirty_hook(e,t)},e.prototype.graph_remove=function(){this.graph.removeNode(this)},e.prototype.add_graph_input=function(e){return this.graph.connect(e,this)},e.prototype.remove_graph_input=function(e){this.graph.disconnect(e,this)},e.prototype.graph_disconnect_predecessors=function(){this.graph.disconnect_predecessors(this)},e.prototype.graph_disconnect_successors=function(){this.graph.disconnect_successors(this)},e.prototype.graph_predecessor_ids=function(){return this.graph.predecessor_ids(this._graph_node_id)||[]},e.prototype.graph_predecessors=function(){return this.graph.predecessors(this)},e.prototype.graph_successors=function(){return this.graph.successors(this)},e.prototype.graph_all_predecessors=function(){return this.graph.all_predecessors(this)},e.prototype.graph_all_successors=function(){return this.graph.all_successors(this)},e}();t.CoreGraphNode=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(90),i=n(9),a=n(766),s=n(27),_=n(113),u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.container_controller=new _.TypedContainerController(t,a.MaterialContainer),t._cook_main_without_inputs_when_dirty_bound=t._cook_main_without_inputs_when_dirty.bind(t),t}return r.__extends(t,e),t.node_context=function(){return s.NodeContext.MAT},t.prototype.initialize_base_node=function(){e.prototype.initialize_base_node.call(this),this.name_controller.add_post_set_full_path_hook(this.set_material_name.bind(this)),this.add_post_dirty_hook("_cook_main_without_inputs_when_dirty",this._cook_main_without_inputs_when_dirty_bound)},t.prototype._cook_main_without_inputs_when_dirty=function(){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(e){switch(e.label){case 0:return[4,this.cook_controller.cook_main_without_inputs()];case 1:return e.sent(),[2]}}))}))},t.prototype.set_material_name=function(){this._material&&(this._material.name=this.full_path())},Object.defineProperty(t.prototype,"material",{get:function(){return this._material=this._material||this.create_material()},enumerable:!0,configurable:!0}),t.prototype.set_material=function(e){this.set_container(e)},t.prototype.add_render_hook=function(e){},t}(o.TypedNode);t.TypedMatNode=u;var c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.create_material=function(){return new i.Material},t}(u);t.BaseMatNodeClass=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,o=n(2),i=n(10),a=n(90),s=n(790),_=n(27),u=n(113),c=n(40),p=["parent object","parent object","parent object","parent object"];!function(e){e[e.MANAGER=0]="MANAGER",e[e.FOG=1]="FOG",e[e.CAMERA=2]="CAMERA",e[e.LIGHT=3]="LIGHT",e[e.EVENT=4]="EVENT",e[e.MAT=5]="MAT"}(r=t.ObjNodeRenderOrder||(t.ObjNodeRenderOrder={}));var l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.container_controller=new u.TypedContainerController(t,s.ObjectContainer),t.render_order=r.MANAGER,t._children_group=new c.Group,t._attachable_to_hierarchy=!0,t._used_in_scene=!0,t}return o.__extends(t,e),t.node_context=function(){return _.NodeContext.OBJ},t.displayed_input_names=function(){return p},Object.defineProperty(t.prototype,"attachable_to_hierarchy",{get:function(){return this._attachable_to_hierarchy},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"used_in_scene",{get:function(){return this._used_in_scene},enumerable:!0,configurable:!0}),t.prototype.set_used_in_scene=function(e){if(this._used_in_scene=e,!this.scene.loading_controller.is_loading){var t=this.parent;t&&t.update_object(this)}},t.prototype.add_object_to_parent=function(e){this.attachable_to_hierarchy&&e.add(this.object)},t.prototype.remove_object_from_parent=function(){if(this.attachable_to_hierarchy){var e=this.object.parent;e&&e.remove(this.object)}},t.prototype.initialize_base_node=function(){this._object=this._create_object_with_attributes(),this.name_controller.add_post_set_full_path_hook(this.set_object_name.bind(this)),this.set_object_name()},Object.defineProperty(t.prototype,"children_group",{get:function(){return this._children_group},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"object",{get:function(){return this._object},enumerable:!0,configurable:!0}),t.prototype._create_object_with_attributes=function(){var e=this.create_object();return e.node=this,e.add(this._children_group),e},t.prototype.set_object_name=function(){this._object&&(this._object.name=this.full_path(),this._children_group.name=this.full_path()+":parented_outputs")},t.prototype.create_object=function(){return new i.Object3D},t.prototype.is_display_node_cooking=function(){return!1},t.prototype.is_displayed=function(){var e,t;return(null===(t=null===(e=this.flags)||void 0===e?void 0:e.display)||void 0===t?void 0:t.active)||!1},t}(a.TypedNode);t.TypedObjNode=l;var d=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o.__extends(t,e),t}(l);t.BaseObjNodeClass=d},,,function(e,t,n){"use strict";n.d(t,"a",(function(){return u}));var r,o,i,a=n(22),s=n(63),_=n(54);function u(){this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}Object.assign(u.prototype,{setSize:function(){},render:function(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}}),u.FullScreenQuad=(r=new s.OrthographicCamera(-1,1,1,-1,0,1),o=new _.PlaneBufferGeometry(2,2),i=function(e){this._mesh=new a.Mesh(o,e)},Object.defineProperty(i.prototype,"material",{get:function(){return this._mesh.material},set:function(e){this._mesh.material=e}}),Object.assign(i.prototype,{dispose:function(){this._mesh.geometry.dispose()},render:function(e){e.render(this._mesh,r)}}),i)},,,,,,,,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(219),i=n(1),a=n(104),s=n(84),_=n(5),u=n(69);function c(e){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.transform=_.ParamConfig.FOLDER(),t.t=_.ParamConfig.VECTOR3([0,0,0]),t.r=_.ParamConfig.VECTOR3([0,0,0]),t.s=_.ParamConfig.VECTOR3([1,1,1]),t.scale=_.ParamConfig.FLOAT(1),t}return r.__extends(t,e),t}(e)}t.TransformedParamConfig=c;!function(e){function t(){return null!==e&&e.apply(this,arguments)||this}r.__extends(t,e)}(c(_.NodeParamsConfig));var p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.transform_controller=new l(t),t}return r.__extends(t,e),t}(u.TypedObjNode);t.TransformedObjNode=p;var l=function(){function e(e){this.node=e,this._cook_main_without_inputs_when_dirty_bound=this._cook_main_without_inputs_when_dirty.bind(this),this._update_transform_from_params_scale=new i.Vector3}return e.prototype.initialize_node=function(){var e=this;this.node.io.inputs.set_count(0,1),this.node.io.inputs.set_depends_on_inputs(!1),this.node.io.outputs.set_has_one_output(),this.node.io.inputs.add_on_set_input_hook("on_input_updated",(function(){e.on_input_updated()}));var t="_cook_main_without_inputs_when_dirty";this.node.dirty_controller.has_hook(t)||this.node.dirty_controller.add_post_dirty_hook(t,this._cook_main_without_inputs_when_dirty_bound)},e.prototype._cook_main_without_inputs_when_dirty=function(){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(e){switch(e.label){case 0:return[4,this.node.cook_controller.cook_main_without_inputs()];case 1:return e.sent(),[2]}}))}))},e.on_input_updated=function(e){null!=e.io.inputs.input(0)?e.root.add_to_parent_transform(e):e.root.remove_from_parent_transform(e)},e.prototype.on_input_updated=function(){e.on_input_updated(this.node)},e.prototype.update=function(e){this.update_transform_with_matrix(e)},e.prototype.update_transform_with_matrix=function(e){var t=this.node.object;return null==e||e.equals(t.matrix)?this.update_transform_from_params():(t.matrixAutoUpdate=!1,t.matrix=e,t.dispatchEvent({type:"change"}))},e.prototype.update_transform_from_params=function(){var e=this.node.object;if(e){var t=this.node.pv.t,n=this.node.pv.r;this._update_transform_from_params_scale.copy(this.node.pv.s).multiplyScalar(this.node.pv.scale),e.matrixAutoUpdate=!1,e.position.copy(t);var r=[a.CoreMath.degrees_to_radians(n.x),a.CoreMath.degrees_to_radians(n.y),a.CoreMath.degrees_to_radians(n.z)],i=new o.Euler(r[0],r[1],r[2]);e.rotation.copy(i),e.scale.copy(this._update_transform_from_params_scale),e.matrixAutoUpdate=!0,e.updateMatrix(),e.dispatchEvent({type:"change"})}},e.prototype.set_params_from_matrix=function(e,t){void 0===t&&(t={}),s.CoreTransform.set_params_from_matrix(e,this.node,t)},e}();t.TransformController=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(1),o=n(42),i=n(15),a=n(219),s=n(14),_=function(){function e(){this._translation_matrix=new i.Matrix4,this._translation_matrix_q=new o.Quaternion,this._translation_matrix_s=new r.Vector3(1,1,1),this._matrix=(new i.Matrix4).identity(),this._matrix_q=new o.Quaternion,this._matrix_e=new a.Euler,this._matrix_s=new r.Vector3,this._rotate_geometry_m=new i.Matrix4,this._rotate_geometry_q=new o.Quaternion,this._rotate_geometry_vec_dest=new r.Vector3}return e.set_params_from_matrix=function(e,t,n){void 0===n&&(n={});var i=n.scale;null==i&&(i=!0);var s=new r.Vector3,_=new o.Quaternion,u=new r.Vector3;e.decompose(s,_,u);var c=(new a.Euler).setFromQuaternion(_).toVector3();c.divideScalar(Math.PI/180),t.scene.batch_update((function(){t.params.set_vector3("r",c.toArray()),t.params.set_vector3("t",s.toArray()),t.params.set_vector3("s",u.toArray()),i&&t.params.set_float("scale",1)}))},e.set_params_from_object=function(e,t){var n=e.position.toArray(),r=e.rotation.toArray().map((function(e){return e*(180/Math.PI)}));t.scene.batch_update((function(){t.params.set_vector3("t",n),t.params.set_vector3("r",r)}))},e.prototype.translation_matrix=function(e){return this._translation_matrix.compose(e,this._translation_matrix_q,this._translation_matrix_s),this._translation_matrix},e.matrix_quaternion=function(e){var t=new r.Vector3,n=new o.Quaternion,i=new r.Vector3;return e.decompose(t,n,i),n},e.prototype.matrix=function(e,t,n,r){return this._matrix_e.set(s.MathUtils.degToRad(t.x),s.MathUtils.degToRad(t.y),s.MathUtils.degToRad(t.z),"XYZ"),this._matrix_q.setFromEuler(this._matrix_e),this._matrix_s.copy(n).multiplyScalar(r),this._matrix.compose(e,this._matrix_q,this._matrix_s),this._matrix},e.prototype.rotate_geometry=function(e,t,n){this._rotate_geometry_vec_dest.copy(n),this._rotate_geometry_vec_dest.normalize(),this._rotate_geometry_q.setFromUnitVectors(t,this._rotate_geometry_vec_dest),this._rotate_geometry_m.makeRotationFromQuaternion(this._rotate_geometry_q),e.applyMatrix4(this._rotate_geometry_m)},e}();t.CoreTransform=_},,,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(67),i=n(535),a=n(536),s=n(539),_=n(540),u=n(567),c=n(113),p=n(568),l=n(569),d=n(258),f=n(348),h=n(579),m=n(612),y=n(613),v=n(614),g=(n(61),n(619)),b=n(115),x=function(e){function t(t,n){void 0===n&&(n="BaseNode");var r=e.call(this,t,n)||this;return r.container_controller=new c.TypedContainerController(r,b.BaseContainer),r.pv=new m.ParamsValueAccessor,r.p=new g.ParamsAccessor,r._initialized=!1,r}return r.__extends(t,e),Object.defineProperty(t.prototype,"display_node_controller",{get:function(){return this._display_node_controller},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"parent_controller",{get:function(){return this._parent_controller=this._parent_controller||new s.HierarchyParentController(this)},enumerable:!0,configurable:!0}),t.displayed_input_names=function(){return[]},Object.defineProperty(t.prototype,"children_controller_context",{get:function(){return this._children_controller_context},enumerable:!0,configurable:!0}),t.prototype._create_children_controller=function(){if(this._children_controller_context)return new _.HierarchyChildrenController(this,this._children_controller_context)},Object.defineProperty(t.prototype,"children_controller",{get:function(){return this._children_controller=this._children_controller||this._create_children_controller()},enumerable:!0,configurable:!0}),t.prototype.children_allowed=function(){return null!=this._children_controller_context},Object.defineProperty(t.prototype,"ui_data",{get:function(){return this._ui_data=this._ui_data||new i.UIData(this)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dependencies_controller",{get:function(){return this._dependencies_controller=this._dependencies_controller||new l.DependenciesController(this)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"states",{get:function(){return this._states=this._states||new a.StatesController(this)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lifecycle",{get:function(){return this._lifecycle=this._lifecycle||new u.LifeCycleController(this)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"serializer",{get:function(){return this._serializer=this._serializer||new f.NodeSerializer(this)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cook_controller",{get:function(){return this._cook_controller=this._cook_controller||new p.CookController(this)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"io",{get:function(){return this._io=this._io||new v.IOController(this)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"name_controller",{get:function(){return this._name_controller=this._name_controller||new d.NameController(this)},enumerable:!0,configurable:!0}),t.prototype.set_name=function(e){this.name_controller.set_name(e)},t.prototype._set_core_name=function(e){this._name=e},Object.defineProperty(t.prototype,"params",{get:function(){return this._params_controller=this._params_controller||new h.ParamsController(this)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"processing_context",{get:function(){return this._processing_context=this._processing_context||new y.ProcessingContext(this)},enumerable:!0,configurable:!0}),t.prototype.initialize_base_and_node=function(){this._initialized?console.warn("node already initialized"):(this.initialize_base_node(),this.initialize_node(),this._initialized=!0)},t.prototype.initialize_base_node=function(){},t.prototype.initialize_node=function(){},t.type=function(){throw"type to be overriden"},Object.defineProperty(t.prototype,"type",{get:function(){return this.constructor.type()},enumerable:!0,configurable:!0}),t.node_context=function(){throw"requires override"},t.prototype.node_context=function(){return this.constructor.node_context()},t.required_three_imports=function(){return[]},t.required_imports=function(){var e=this.required_three_imports();return e?e.map((function(e){return"three/examples/jsm/"+e})):[]},t.prototype.required_imports=function(){return this.constructor.required_imports()},t.require_webgl2=function(){return!1},t.prototype.require_webgl2=function(){return this.constructor.require_webgl2()},t.prototype.set_parent=function(e){this.parent_controller.set_parent(e)},Object.defineProperty(t.prototype,"parent",{get:function(){return this.parent_controller.parent},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"root",{get:function(){return this._scene.root},enumerable:!0,configurable:!0}),t.prototype.full_path=function(){return this.parent_controller.full_path()},t.prototype.create_params=function(){},t.prototype.add_param=function(e,t,n,r){var o;return null===(o=this._params_controller)||void 0===o?void 0:o.add_param(e,t,n,r)},t.prototype.cook=function(e){return null},t.prototype.request_container=function(){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(e){switch(e.label){case 0:return[4,this.container_controller.request_container()];case 1:return[2,e.sent()]}}))}))},t.prototype.set_container=function(e,t){void 0===t&&(t=null),this.container_controller.container.set_content(e),null!=e&&(e.name||(e.name=this.full_path()),e.node||(e.node=this)),this.cook_controller.end_cook(t)},t.prototype.create_node=function(e){var t;return null===(t=this.children_controller)||void 0===t?void 0:t.create_node(e)},t.prototype.remove_node=function(e){var t;null===(t=this.children_controller)||void 0===t||t.remove_node(e)},t.prototype.children=function(){var e;return(null===(e=this.children_controller)||void 0===e?void 0:e.children())||[]},t.prototype.node=function(e){var t;return(null===(t=this.parent_controller)||void 0===t?void 0:t.find_node(e))||null},t.prototype.nodes_by_type=function(e){var t;return(null===(t=this.children_controller)||void 0===t?void 0:t.nodes_by_type(e))||[]},t.prototype.set_input=function(e,t,n){void 0===n&&(n=0),this.io.inputs.set_input(e,t,n)},t.prototype.emit=function(e,t){void 0===t&&(t=null),this.scene.dispatch_controller.dispatch(this,e,t)},t.prototype.to_json=function(e){return void 0===e&&(e=!1),this.serializer.to_json(e)},t}(o.CoreGraphNode);t.TypedNode=x;var P=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t}(x);t.BaseNodeClass=P},,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(101),i=n(67),a=n(261),s=n(574),_=n(575),u=n(576),c=n(24),p=n(103),l=function(e){function t(t){var n=e.call(this,t,"BaseParam")||this;return n._options=new a.OptionsController(n),n._emit_controller=new s.EmitController(n),n._is_computing=!1,n.initialize_param(),n}return r.__extends(t,e),Object.defineProperty(t.prototype,"options",{get:function(){return this._options=this._options||new a.OptionsController(this)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"emit_controller",{get:function(){return this._emit_controller=this._emit_controller||new s.EmitController(this)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"expression_controller",{get:function(){return this._expression_controller},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"serializer",{get:function(){return this._serializer=this._serializer||new _.ParamSerializer(this)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"states",{get:function(){return this._states=this._states||new u.StatesController(this)},enumerable:!0,configurable:!0}),t.prototype.initialize_value=function(){},t.prototype.initialize_param=function(){},t.type=function(){return c.ParamType.FLOAT},Object.defineProperty(t.prototype,"type",{get:function(){return this.constructor.type()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"is_numeric",{get:function(){return!1},enumerable:!0,configurable:!0}),t.prototype.set_name=function(t){e.prototype.set_name.call(this,t)},Object.defineProperty(t.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0}),t.prototype.convert=function(e){return null},t.are_raw_input_equal=function(e,t){return!1},t.prototype.is_raw_input_equal=function(e){return this.constructor.are_raw_input_equal(this._raw_input,e)},t.are_values_equal=function(e,t){return!1},t.prototype.is_value_equal=function(e){return this.constructor.are_values_equal(this.value,e)},t.prototype._clone_raw_input=function(e){return e},t.prototype.set=function(e){this._raw_input=this._clone_raw_input(this._prefilter_invalid_raw_input(e)),this.emit_controller.emit(p.ParamEvent.RAW_INPUT_UPDATED),this.process_raw_input()},t.prototype._prefilter_invalid_raw_input=function(e){return e},Object.defineProperty(t.prototype,"default_value",{get:function(){return this._default_value},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"is_default",{get:function(){return!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"raw_input",{get:function(){return this._raw_input},enumerable:!0,configurable:!0}),t.prototype.process_raw_input=function(){},t.prototype.compute=function(){return r.__awaiter(this,void 0,void 0,(function(){var e,t=this;return r.__generator(this,(function(n){switch(n.label){case 0:return this.scene.loading_controller.is_loading&&console.warn("param attempt to compute "+this.full_path()),this.is_dirty?this._is_computing?[3,2]:(this._is_computing=!0,[4,this.process_computation()]):[3,3];case 1:if(n.sent(),this._is_computing=!1,this._compute_resolves)for(e=void 0;e=this._compute_resolves.pop();)e();return[3,3];case 2:return[2,new Promise((function(e,n){t._compute_resolves=t._compute_resolves||[],t._compute_resolves.push(e)}))];case 3:return[2]}}))}))},t.prototype.process_computation=function(){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(e){return[2]}))}))},t.prototype.set_init_value=function(e){this._default_value=e},t.prototype.set_node=function(e){var t,n;if(e?(this._node=e,this.options.makes_node_dirty_when_dirty()&&!this.parent_param&&(null===(n=e.params.params_node)||void 0===n||n.add_graph_input(this))):this._node&&(null===(t=this._node.params.params_node)||void 0===t||t.remove_graph_input(this)),this.components)for(var r=0,o=this.components;r<o.length;r++){o[r].set_node(e)}},Object.defineProperty(t.prototype,"node",{get:function(){return this._node},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return this.node},enumerable:!0,configurable:!0}),t.prototype.set_parent_param=function(e){e.add_graph_input(this),this._parent_param=e},Object.defineProperty(t.prototype,"parent_param",{get:function(){return this._parent_param},enumerable:!0,configurable:!0}),t.prototype.has_parent_param=function(){return null!=this._parent_param},t.prototype.full_path=function(){var e;return(null===(e=this.node)||void 0===e?void 0:e.full_path())+"/"+this.name},t.prototype.path_relative_to=function(e){return o.CoreWalker.relative_path(e,this)},t.prototype.emit=function(e){this.emit_controller.emit_allowed&&(this.emit_controller.increment_count(e),this.scene.dispatch_controller.dispatch(this,e))},Object.defineProperty(t.prototype,"components",{get:function(){return this._components},enumerable:!0,configurable:!0}),Object.defineProperty(t,"component_names",{get:function(){return[]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"component_names",{get:function(){return this.constructor.component_names},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"is_multiple",{get:function(){return this.component_names.length>0},enumerable:!0,configurable:!0}),t.prototype.init_components=function(){},t.prototype.has_expression=function(){return null!=this.expression_controller&&this.expression_controller.active},t.prototype.to_json=function(){return this.serializer.to_json()},t}(i.CoreGraphNode);t.TypedParam=l;var d=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),Object.defineProperty(t.prototype,"default_value_serialized",{get:function(){return"BaseParamClass.default_value_serialized overriden"},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"raw_input_serialized",{get:function(){return"BaseParamClass.raw_input_serialized overriden"},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"value_serialized",{get:function(){return"BaseParamClass.value_serialized overriden"},enumerable:!0,configurable:!0}),t}(l);t.BaseParamClass=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(642),i=n(643),a=function(){function e(e){this.node=e}return e.prototype.has_display=function(){return!1},e.prototype.has_bypass=function(){return!1},e}();function s(e){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.display=new i.DisplayFlag(t.node),t}return r.__extends(t,e),t.prototype.has_display=function(){return!0},t}(e)}function _(e){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.bypass=new o.BypassFlag(t.node),t}return r.__extends(t,e),t.prototype.has_bypass=function(){return!0},t}(e)}t.FlagsController=a;var u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t}(s(a));t.FlagsControllerD=u;var c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t}(_(a));t.FlagsControllerB=c;var p=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t}(_(s(a)));t.FlagsControllerDB=p},function(e,t,n){"use strict";n.r(t),t.default='\n\n// https://github.com/mattatz/ShibuyaCrowd/blob/master/source/shaders/common/quaternion.glsl\nvec4 quat_mult(vec4 q1, vec4 q2)\n{\n\treturn vec4(\n\tq1.w * q2.x + q1.x * q2.w + q1.z * q2.y - q1.y * q2.z,\n\tq1.w * q2.y + q1.y * q2.w + q1.x * q2.z - q1.z * q2.x,\n\tq1.w * q2.z + q1.z * q2.w + q1.y * q2.x - q1.x * q2.y,\n\tq1.w * q2.w - q1.x * q2.x - q1.y * q2.y - q1.z * q2.z\n\t);\n}\n// http://glmatrix.net/docs/quat.js.html#line97\n//   let ax = a[0], ay = a[1], az = a[2], aw = a[3];\n\n//   let bx = b[0], by = b[1], bz = b[2], bw = b[3];\n\n//   out[0] = ax * bw + aw * bx + ay * bz - az * by;\n\n//   out[1] = ay * bw + aw * by + az * bx - ax * bz;\n\n//   out[2] = az * bw + aw * bz + ax * by - ay * bx;\n\n//   out[3] = aw * bw - ax * bx - ay * by - az * bz;\n\n//   return out\n\n\n\n// http://www.neilmendoza.com/glsl-rotation-about-an-arbitrary-axis/\nmat4 rotationMatrix(vec3 axis, float angle)\n{\n\taxis = normalize(axis);\n\tfloat s = sin(angle);\n\tfloat c = cos(angle);\n\tfloat oc = 1.0 - c;\n\n \treturn mat4(oc * axis.x * axis.x + c, oc * axis.x * axis.y - axis.z * s,  oc * axis.z * axis.x + axis.y * s, 0.0, oc * axis.x * axis.y + axis.z * s,  oc * axis.y * axis.y + c, oc * axis.y * axis.z - axis.x * s,  0.0, oc * axis.z * axis.x - axis.y * s,  oc * axis.y * axis.z + axis.x * s,  oc * axis.z * axis.z + c, 0.0, 0.0, 0.0, 0.0, 1.0);\n}\n\n// https://www.geeks3d.com/20141201/how-to-rotate-a-vertex-by-a-quaternion-in-glsl/\nvec4 quat_from_axis_angle(vec3 axis, float angle)\n{\n\tvec4 qr;\n\tfloat half_angle = (angle * 0.5); // * 3.14159 / 180.0;\n\tfloat sin_half_angle = sin(half_angle);\n\tqr.x = axis.x * sin_half_angle;\n\tqr.y = axis.y * sin_half_angle;\n\tqr.z = axis.z * sin_half_angle;\n\tqr.w = cos(half_angle);\n\treturn qr;\n}\nvec3 rotate_with_axis_angle(vec3 position, vec3 axis, float angle)\n{\n\tvec4 q = quat_from_axis_angle(axis, angle);\n\tvec3 v = position.xyz;\n\treturn v + 2.0 * cross(q.xyz, cross(q.xyz, v) + q.w * v);\n}\n// vec3 applyQuaternionToVector( vec4 q, vec3 v ){\n// \treturn v + 2.0 * cross( q.xyz, cross( q.xyz, v ) + q.w * v );\n// }\nvec3 rotate_with_quat( vec3 v, vec4 q )\n{\n\t// vec4 qv = multQuat( quat, vec4(vec, 0.0) );\n\t// return multQuat( qv, vec4(-quat.x, -quat.y, -quat.z, quat.w) ).xyz;\n\treturn v + 2.0 * cross( q.xyz, cross( q.xyz, v ) + q.w * v );\n}\n// https://github.com/glslify/glsl-look-at/blob/gh-pages/index.glsl\n// mat3 rotation_matrix(vec3 origin, vec3 target, float roll) {\n// \tvec3 rr = vec3(sin(roll), cos(roll), 0.0);\n// \tvec3 ww = normalize(target - origin);\n// \tvec3 uu = normalize(cross(ww, rr));\n// \tvec3 vv = normalize(cross(uu, ww));\n\n// \treturn mat3(uu, vv, ww);\n// }\n// mat3 rotation_matrix(vec3 target, float roll) {\n// \tvec3 rr = vec3(sin(roll), cos(roll), 0.0);\n// \tvec3 ww = normalize(target);\n// \tvec3 uu = normalize(cross(ww, rr));\n// \tvec3 vv = normalize(cross(uu, ww));\n\n// \treturn mat3(uu, vv, ww);\n// }\n\nfloat vector_angle(vec3 start, vec3 dest){\n\tstart = normalize(start);\n\tdest = normalize(dest);\n\n\tfloat cosTheta = dot(start, dest);\n\tvec3 c1 = cross(start, dest);\n\t// We use the dot product of the cross with the Y axis.\n\t// This is a little arbitrary, but can still give a good sense of direction\n\tvec3 y_axis = vec3(0.0, 1.0, 0.0);\n\tfloat d1 = dot(c1, y_axis);\n\tfloat angle = acos(cosTheta) * sign(d1);\n\treturn angle;\n}\n\n// http://www.opengl-tutorial.org/intermediate-tutorials/tutorial-17-quaternions/#i-need-an-equivalent-of-glulookat-how-do-i-orient-an-object-towards-a-point-\nvec4 vector_align(vec3 start, vec3 dest){\n\tstart = normalize(start);\n\tdest = normalize(dest);\n\n\tfloat cosTheta = dot(start, dest);\n\tvec3 axis;\n\n\t// if (cosTheta < -1 + 0.001f){\n\t// \t// special case when vectors in opposite directions:\n\t// \t// there is no "ideal" rotation axis\n\t// \t// So guess one; any will do as long as it\'s perpendicular to start\n\t// \taxis = cross(vec3(0.0f, 0.0f, 1.0f), start);\n\t// \tif (length2(axis) < 0.01 ) // bad luck, they were parallel, try again!\n\t// \t\taxis = cross(vec3(1.0f, 0.0f, 0.0f), start);\n\n\t// \taxis = normalize(axis);\n\t// \treturn gtx::quaternion::angleAxis(glm::radians(180.0f), axis);\n\t// }\n\tif(cosTheta > (1.0 - 0.0001) || cosTheta < (-1.0 + 0.0001) ){\n\t\taxis = normalize(cross(start, vec3(0.0, 1.0, 0.0)));\n\t\tif (length(axis) < 0.001 ){ // bad luck, they were parallel, try again!\n\t\t\taxis = normalize(cross(start, vec3(1.0, 0.0, 0.0)));\n\t\t}\n\t} else {\n\t\taxis = normalize(cross(start, dest));\n\t}\n\n\tfloat angle = acos(cosTheta);\n\n\treturn quat_from_axis_angle(axis, angle);\n}\nvec4 vector_align_with_up(vec3 start, vec3 dest, vec3 up){\n\tvec4 rot1 = vector_align(start, dest);\n\tup = normalize(up);\n\n\t// Recompute desiredUp so that it\'s perpendicular to the direction\n\t// You can skip that part if you really want to force desiredUp\n\t// vec3 right = normalize(cross(dest, up));\n\t// up = normalize(cross(right, dest));\n\n\t// Because of the 1rst rotation, the up is probably completely screwed up.\n\t// Find the rotation between the "up" of the rotated object, and the desired up\n\tvec3 newUp = rotate_with_quat(vec3(0.0, 1.0, 0.0), rot1);//rot1 * vec3(0.0, 1.0, 0.0);\n\tvec4 rot2 = vector_align(up, newUp);\n\n\t// return rot1;\n\treturn rot2;\n\t// return multQuat(rot1, rot2);\n\t// return rot2 * rot1;\n\n}\n\n// https://www.euclideanspace.com/maths/geometry/rotations/conversions/quaternionToAngle/index.htm\nfloat quat_to_angle(vec4 q){\n\treturn 2.0 * acos(q.w);\n}\nvec3 quat_to_axis(vec4 q){\n\treturn vec3(\n\t\tq.x / sqrt(1.0-q.w*q.w),\n\t\tq.y / sqrt(1.0-q.w*q.w),\n\t\tq.z / sqrt(1.0-q.w*q.w)\n\t);\n}\n\nvec4 align(vec3 dir, vec3 up){\n\tvec3 start_dir = vec3(0.0, 0.0, 1.0);\n\tvec3 start_up = vec3(0.0, 1.0, 0.0);\n\tvec4 rot1 = vector_align(start_dir, dir);\n\tup = normalize(up);\n\n\t// Recompute desiredUp so that it\'s perpendicular to the direction\n\t// You can skip that part if you really want to force desiredUp\n\tvec3 right = normalize(cross(dir, up));\n\tif(length(right)<0.001){\n\t\tright = vec3(1.0, 0.0, 0.0);\n\t}\n\tup = normalize(cross(right, dir));\n\n\t// Because of the 1rst rotation, the up is probably completely screwed up.\n\t// Find the rotation between the "up" of the rotated object, and the desired up\n\tvec3 newUp = rotate_with_quat(start_up, rot1);//rot1 * vec3(0.0, 1.0, 0.0);\n\tvec4 rot2 = vector_align(normalize(newUp), up);\n\n\t// return rot1;\n\treturn quat_mult(rot1, rot2);\n\t// return rot2 * rot1;\n\n}'},,,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){}return e.find_node=function(t,n,r){if(!t)return null;var o=n.split(e.SEPARATOR).filter((function(e){return e.length>0})),i=o[0],a=null;if(n[0]!==e.SEPARATOR){switch(i){case e.PARENT:null==r||r.add_path_element(i),a=t.parent;break;case e.CURRENT:null==r||r.add_path_element(i),a=t;break;default:(a=t.node(i))&&(null==r||r.add_node(i,a))}if(null!=a&&o.length>1){var s=o.slice(1).join(e.SEPARATOR);a=this.find_node(a,s,r)}return a}var _=n.substr(1);return a=this.find_node(t.root,_,r)},e.find_param=function(t,n,r){if(!t)return null;var o=n.split(e.SEPARATOR);if(1===o.length)return t.params.get(o[0]);var i=o.slice(0,+(o.length-2)+1||void 0).join(e.SEPARATOR),a=this.find_node(t,i,r);if(null!=a){var s=o[o.length-1],_=a.params.get(s);return r&&_&&r.add_node(s,_),_}return null},e.relative_path=function(t,n){var r=this.closest_common_parent(t,n);if(r){var o=this.distance_to_parent(t,r),i="";if(o-1>0){for(var a=0,s=[];a++<o-1;)s.push(e.PARENT);i=s.join(e.SEPARATOR)+e.SEPARATOR}for(var _=r.full_path().split(e.SEPARATOR).filter((function(e){return e.length>0})),u=[],c=0,p=0,l=n.full_path().split(e.SEPARATOR).filter((function(e){return e.length>0}));p<l.length;p++){var d=l[p];_[c]||u.push(d),c++}return""+i+u.join(e.SEPARATOR)}return n.full_path()},e.closest_common_parent=function(e,t){for(var n=this.parents(e).reverse(),r=this.parents(t).reverse(),o=Math.min(n.length,r.length),i=null,a=0;a<o;a++)n[a].graph_node_id==r[a].graph_node_id&&(i=n[a]);return i},e.parents=function(e){for(var t=[],n=e.parent;n;)t.push(n),n=n.parent;return t},e.distance_to_parent=function(e,t){for(var n=0,r=e,o=t.graph_node_id;r&&r.graph_node_id!=o;)n+=1,r=r.parent;return r&&r.graph_node_id==o?n:-1},e.make_absolute_path=function(t,n){var r=n.split(e.SEPARATOR),o=r.shift();if(!o)return t.full_path();switch(o){case"..":return t.parent?this.make_absolute_path(t.parent,r.join(e.SEPARATOR)):null;case".":return this.make_absolute_path(t,r.join(e.SEPARATOR));default:return[t.full_path(),n].join(e.SEPARATOR)}},e.SEPARATOR="/",e.DOT=".",e.CURRENT=e.DOT,e.PARENT="..",e.CURRENT_WITH_SLASH=e.CURRENT+"/",e.PARENT_WITH_SLASH=e.PARENT+"/",e.NON_LETTER_PREFIXES=[e.SEPARATOR,e.DOT],e}();t.CoreWalker=r},,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.VISIBLE_UPDATED="param_visible_updated",e.RAW_INPUT_UPDATED="raw_input_updated",e.VALUE_UPDATED="param_value_updated",e.EXPRESSION_UPDATED="param_expression_update",e.ERROR_UPDATED="param_error_updated",e.DELETED="param_deleted"}(t.ParamEvent||(t.ParamEvent={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(1),i={Triangle:n(98).Triangle,Vector3:o.Vector3},a=r.__importDefault(n(44)),s=n(353),_=Math.PI/180,u=function(){function e(){}return e.clamp=function(e,t,n){return e<t?t:e>n?n:e},e.fit01=function(e,t,n){return this.fit(e,0,1,t,n)},e.fit=function(e,t,n,r,o){return(e-t)/(n-t)*(o-r)+r},e.degrees_to_radians=function(e){return e*_},e.radians_to_degrees=function(e){return e/_},e.deg2rad=function(e){return this.degrees_to_radians(e)},e.rad2deg=function(e){return this.radians_to_degrees(e)},e.rand=function(e){return a.default(e)?this.rand_float(e):this.rand_vec2(e)},e.round=function(e,t){var n=e/t,r=e<0?Math.ceil(n):Math.floor(n);return console.log("round",t,e,n,r,r*t),r*t},e.highest_even=function(e){return 2*Math.ceil(.5*e)},e.rand_float=function(e){var t={x:e,y:136574};return this.rand_vec2(t)},e.rand_vec2=function(e){var t=(12.9898*e.x+78.233*e.y)%Math.PI;return this.fract(43758.5453*Math.sin(t))},e.geodesic_distance=function(e,t){var n=this.deg2rad(e.lat),r=this.deg2rad(t.lat),o=this.deg2rad(t.lat-e.lat),i=this.deg2rad(t.lng-e.lng),a=Math.sin(o/2)*Math.sin(o/2)+Math.cos(n)*Math.cos(r)*Math.sin(i/2)*Math.sin(i/2);return 6371e3*(2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a)))},e.expand_triangle=function(e,t){var n,r=new i.Vector3;e.getMidpoint(r),function(e){e.a="a",e.b="b",e.c="c"}(n||(n={}));for(var o=0,a=["a","b","c"];o<a.length;o++){var s=a[o],_=e[s].clone().sub(r),u=_.clone().normalize(),c=_.length()+t;e[s]=r.clone().add(u.multiplyScalar(c))}return e},e.nearestPower2=function(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.log(2)))},e.Easing=s.Easing,e.fract=function(e){return e-Math.floor(e)},e}();t.CoreMath=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(159),i=n(0),a=n(0),s=n(0),_=n(9),u=n(68),c=n(5);function p(e){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.double_sided=c.ParamConfig.BOOLEAN(0),t.front=c.ParamConfig.BOOLEAN(1,{visible_if:{double_sided:!1}}),t}return r.__extends(t,e),t}(e)}t.SideParamConfig=p;var l=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t}(_.Material),d=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}r.__extends(t,e)}(p(c.NodeParamsConfig)),function(e){function t(){return null!==e&&e.apply(this,arguments)||this}r.__extends(t,e),t.prototype.create_material=function(){return new l}}(u.TypedMatNode),function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.update=function(e){var t=e.pv.front?i.FrontSide:s.BackSide,n=e.pv.double_sided?a.DoubleSide:t;n!=e.material.side&&(e.material.side=n,e.material.needsUpdate=!0)},t}(o.BaseController));t.SideController=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(158),i=n(28),a=n(50),s=n(29),_=n(16),u=n(129),c=n(26),p=n(270);!function(e){e.DISTANCE="customDistanceMaterial",e.DEPTH="customDepthMaterial",e.DEPTH_DOF="customDepthDOFMaterial"}(t.CustomMaterialName||(t.CustomMaterialName={}));var l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._assemblers_by_custom_name=new Map,t}return r.__extends(t,e),t.prototype.create_material=function(){return new c.ShaderMaterial},t.prototype.custom_assembler_class_by_custom_name=function(){},t.prototype._add_custom_materials=function(e){var t=this,n=this.custom_assembler_class_by_custom_name();n&&n.forEach((function(n,r){t._add_custom_material(e,r,n)}))},t.prototype._add_custom_material=function(e,t,n){var r=this._assemblers_by_custom_name.get(t);r||(r=new n(this._gl_parent_node),this._assemblers_by_custom_name.set(t,r)),e.custom_materials=e.custom_materials||{},e.custom_materials[t]=r.create_material()},t.prototype.compile_custom_materials=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,n=this;return r.__generator(this,(function(o){return(t=this.custom_assembler_class_by_custom_name())&&t.forEach((function(t,o){return r.__awaiter(n,void 0,void 0,(function(){var n,i;return r.__generator(this,(function(r){switch(r.label){case 0:return this._code_builder?((n=this._assemblers_by_custom_name.get(o))||(n=new t(this._gl_parent_node),this._assemblers_by_custom_name.set(o,n)),n.set_root_nodes(this._root_nodes),n.set_param_configs_owner(this._code_builder),n.set_shader_configs(this.shader_configs),n.set_variable_configs(this.variable_configs()),(i=e.custom_materials[o])?[4,n.compile_material(i)]:[3,2]):[3,2];case 1:r.sent(),r.label=2;case 2:return[2]}}))}))})),[2]}))}))},t.prototype.compile_material=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,n,o,i;return r.__generator(this,(function(r){switch(r.label){case 0:return this.compile_allowed()?((t=p.GlNodeFinder.find_output_nodes(this._gl_parent_node)).length>1&&this._gl_parent_node.states.error.set("only one output node allowed"),this.set_root_nodes(t),[4,this._update_shaders()]):[2];case 1:return r.sent(),n=this._shaders_by_name.get(a.ShaderName.VERTEX),o=this._shaders_by_name.get(a.ShaderName.FRAGMENT),n&&o&&(e.vertexShader=n,e.fragmentShader=o,this.add_uniforms(e.uniforms),e.needsUpdate=!0),i=this._gl_parent_node.scene,this.uniforms_time_dependent()?i.uniforms_controller.add_time_dependent_uniform_owner(e.uuid,e.uniforms):i.uniforms_controller.remove_time_dependent_uniform_owner(e.uuid),e.custom_materials?[4,this.compile_custom_materials(e)]:[3,3];case 2:r.sent(),r.label=3;case 3:return[2]}}))}))},t.prototype._update_shaders=function(){return r.__awaiter(this,void 0,void 0,(function(){var e,t,n,o,i,a,s;return r.__generator(this,(function(r){switch(r.label){case 0:for(this._shaders_by_name=new Map,this._lines=new Map,e=0,t=this.shader_names;e<t.length;e++)a=t[e],(n=this._template_shader_for_shader_name(a))&&this._lines.set(a,n.split("\n"));return this._root_nodes.length>0?[4,this.build_code_from_nodes(this._root_nodes)]:[3,2];case 1:r.sent(),this._build_lines(),r.label=2;case 2:for(o=0,i=this.shader_names;o<i.length;o++)a=i[o],(s=this._lines.get(a))&&this._shaders_by_name.set(a,s.join("\n"));return[2]}}))}))},t.prototype.shadow_assembler_class_by_custom_name=function(){return{}},t.prototype.add_output_body_line=function(e,t,n){var r,o=e.io.inputs.named_input(n),a=e.variable_for_input(n),s=this.variable_config(n),_=null;if(o)_=i.ThreeToGl.vector3(a);else if(s.default_from_attribute()){var u=e.io.inputs.named_input_connection_points_by_name(n);if(u){var c=u.type,p=null===(r=this.globals_handler)||void 0===r?void 0:r.read_attribute(e,c,n,t);p&&(_=p)}}else{var l=s.default();l&&(_=l)}if(_){var d=s.prefix(),f=s.suffix(),h=s.if_condition();h&&t.add_body_lines(e,["#if "+h]),t.add_body_lines(e,[""+d+_+f]),h&&t.add_body_lines(e,["#endif"])}},t.prototype.set_node_lines_output=function(e,t){var n,r=t.current_shader_name,o=null===(n=this.shader_config(r))||void 0===n?void 0:n.input_names();if(o)for(var i=0,a=o;i<a.length;i++){var s=a[i];this.add_output_body_line(e,t,s)}},t.prototype.set_node_lines_attribute=function(e,t){var n,r=e.gl_type(),o=null===(n=this.globals_handler)||void 0===n?void 0:n.read_attribute(e,r,e.attribute_name,t),i=e.gl_var_name(e.output_name);t.add_body_lines(e,[r+" "+i+" = "+o])},t.prototype.handle_gl_FragCoord=function(e,t,n){t==a.ShaderName.FRAGMENT&&e.push("vec4 "+n+" = gl_FragCoord")},t.prototype.handle_resolution=function(e,t,n){t==a.ShaderName.FRAGMENT&&e.push("vec2 "+n+" = resolution")},t.prototype.set_node_lines_globals=function(e,t){var n,r=[],o=t.current_shader_name,i=this.shader_config(o);if(i){for(var c,p,l=i.dependencies(),d=new Map,f=new Map,h=0,m=e.io.outputs.used_output_names();h<m.length;h++){var y=m[h],v=e.gl_var_name(y),g=t.current_shader_name;switch(y){case"time":c=new s.UniformGLDefinition(e,_.ConnectionPointType.FLOAT,y),g&&u.MapUtils.push_on_array_at_entry(d,g,c),p="float "+v+" = "+y;for(var b=0,x=l;b<x.length;b++){var P=x[b];u.MapUtils.push_on_array_at_entry(d,P,c),u.MapUtils.push_on_array_at_entry(f,P,p)}r.push(p),this.set_uniforms_time_dependent();break;case"gl_FragCoord":this.handle_gl_FragCoord(r,o,v);break;case"resolution":this.handle_resolution(r,o,v),c=new s.UniformGLDefinition(e,_.ConnectionPointType.VEC2,y),g&&u.MapUtils.push_on_array_at_entry(d,g,c);for(var T=0,w=l;T<w.length;T++){P=w[T];u.MapUtils.push_on_array_at_entry(d,P,c)}this.set_resolution_dependent();break;case"gl_PointCoord":o==a.ShaderName.FRAGMENT&&r.push("vec2 "+v+" = gl_PointCoord");break;default:null===(n=this.globals_handler)||void 0===n||n.handle_globals_node(e,y,t)}}d.forEach((function(n,r){t.add_definitions(e,n,r)})),f.forEach((function(n,r){t.add_body_lines(e,n,r)})),t.add_body_lines(e,r)}},t}(o.BaseGlShaderAssembler);t.ShaderAssemblerMaterial=l},,,,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=function(){function e(e,t){this.node=e,this._callbacks=[],this._container=new t(this.node)}return Object.defineProperty(e.prototype,"container",{get:function(){return this._container},enumerable:!0,configurable:!0}),e.prototype.request_container=function(){var e=this;return new Promise((function(t,n){e._callbacks.push(t),e.node.scene.cook_controller.add_node(e.node),setTimeout(e.process_container_request.bind(e),0)}))},e.prototype.process_container_request=function(){var e,t,n=this;if(null===(t=null===(e=this.node.flags)||void 0===e?void 0:e.bypass)||void 0===t?void 0:t.active){this.request_input_container(0).then((function(e){n.node.remove_dirty_state(),e?n.notify_requesters(e):n.node.states.error.set("input invalid")}))}else this.node.is_dirty?(this.node.container_controller.container.reset_caches(),this.node.cook_controller.cook_main()):this.notify_requesters()},e.prototype.request_input_container=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t;return r.__generator(this,(function(n){switch(n.label){case 0:return(t=this.node.io.inputs.input(e))?(t.processing_context.copy(this.node.processing_context),[4,t.container_controller.request_container()]):[3,2];case 1:return[2,n.sent()];case 2:return this.node.states.error.set("input "+e+" required"),this.notify_requesters(),[2,null]}}))}))},e.prototype.notify_requesters=function(e){for(var t,n=[];t=this._callbacks.pop();)n.push(t);for(e||(e=this.node.container_controller.container.clone());t=n.pop();)t(e);this.node.scene.cook_controller.remove_node(this.node)},e}();t.TypedContainerController=o;var i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t}(o);t.BaseContainerController=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(1),o={Vector2:n(3).Vector2,Vector3:r.Vector3},i={P:"position",N:"normal",Cd:"color"},a=function(){function e(){}return e.remap_name=function(e){return i[e]||e},e.array_to_indexed_arrays=function(e){for(var t={},n=0,r=[],o=[],i=0;i<e.length;){var a=e[i],s=t[a];null!=s?r.push(s):(o.push(a),r.push(n),t[a]=n,n+=1),i++}return{indices:r,values:o}},e.default_value=function(e){switch(e){case 1:return 0;case 2:return new o.Vector2(0,0);case 3:return new o.Vector3(0,0,0);default:throw"size "+e+" not yet implemented"}},e}();t.CoreAttribute=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=function(){function e(e){this._node=e}return e.prototype.set_node=function(e){this._node=e},e.prototype.node=function(){return this._node},e.prototype.clone=function(){var e,t=new this.constructor;return t.set_node(this.node()),null!=(e=this.content())&&t.set_content(e),t},e.prototype.reset_caches=function(){},e.prototype.set_content=function(e){this.reset_caches(),this._content=e,this._post_set_content()},e.prototype.has_content=function(){return null!=this._content},e.prototype.content=function(){return this._content},e.prototype._post_set_content=function(){},e.prototype.core_content=function(){return this._content},e.prototype.core_content_cloned=function(){return this._content},e.prototype.infos=function(){return[]},e}();t.TypedContainer=o;var i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t}(o);t.BaseContainer=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(159),i=n(9),a=n(5),s=n(68);function _(e){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.skinning=a.ParamConfig.BOOLEAN(0),t}return r.__extends(t,e),t}(e)}t.SkinningParamConfig=_;var u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t}(i.Material),c=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}r.__extends(t,e)}(_(a.NodeParamsConfig)),function(e){function t(){return null!==e&&e.apply(this,arguments)||this}r.__extends(t,e),t.prototype.create_material=function(){return new u}}(s.TypedMatNode),function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.update=function(e){var t=e.pv.skinning;t!=e.material.skinning&&(e.material.skinning=t,e.material.needsUpdate=!0)},t}(o.BaseController));t.SkinningController=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(9),i=n(135),a=n(68),s=n(273),_=n(5);function u(e){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.use_map=_.ParamConfig.BOOLEAN(0,s.BooleanParamOptions(c)),t.map=_.ParamConfig.OPERATOR_PATH(i.FileCopNode.DEFAULT_NODE_PATH.UV,s.OperatorPathOptions(c,"use_map")),t}return r.__extends(t,e),t}(e)}t.TextureMapParamConfig=u;(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}r.__extends(t,e)})(o.Material),function(e){function t(){return null!==e&&e.apply(this,arguments)||this}r.__extends(t,e)}(u(_.NodeParamsConfig)),function(e){function t(){return null!==e&&e.apply(this,arguments)||this}r.__extends(t,e)}(a.TypedMatNode);var c=function(e){function t(t,n){return e.call(this,t,n)||this}return r.__extends(t,e),t.prototype.initialize_node=function(){this.add_hooks(this.node.p.use_map,this.node.p.map)},t.prototype.update=function(){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(e){return this._update(this.node.material,"map",this.node.p.use_map,this.node.p.map),[2]}))}))},t.update=function(e){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(t){return e.texture_map_controller.update(),[2]}))}))},t}(s.BaseTextureMapController);t.TextureMapController=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(9),i=n(135),a=n(68),s=n(273),_=n(5);function u(e){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.use_alpha_map=_.ParamConfig.BOOLEAN(0,s.BooleanParamOptions(c)),t.alpha_map=_.ParamConfig.OPERATOR_PATH(i.FileCopNode.DEFAULT_NODE_PATH.UV,s.OperatorPathOptions(c,"use_alpha_map")),t}return r.__extends(t,e),t}(e)}t.TextureAlphaMapParamConfig=u;(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}r.__extends(t,e)})(o.Material),function(e){function t(){return null!==e&&e.apply(this,arguments)||this}r.__extends(t,e)}(u(_.NodeParamsConfig)),function(e){function t(){return null!==e&&e.apply(this,arguments)||this}r.__extends(t,e)}(a.TypedMatNode);var c=function(e){function t(t,n){return e.call(this,t,n)||this}return r.__extends(t,e),t.prototype.initialize_node=function(){this.add_hooks(this.node.p.use_alpha_map,this.node.p.alpha_map)},t.prototype.update=function(){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(e){return this._update(this.node.material,"alphaMap",this.node.p.use_alpha_map,this.node.p.alpha_map),[2]}))}))},t.update=function(e){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(t){return e.texture_alpha_map_controller.update(),[2]}))}))},t}(s.BaseTextureMapController);t.TextureAlphaMapController=c},,,,,,,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=r.__importDefault(n(102)),i=n(0),a=n(70),s=n(285),_=n(93),u=n(607),c=n(24),p=n(103),l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._reset_ramp_interpolant_and_texture_bound=t._reset_ramp_interpolant_and_texture.bind(t),t}return r.__extends(t,e),t.type=function(){return c.ParamType.RAMP},Object.defineProperty(t.prototype,"default_value_serialized",{get:function(){return this.default_value instanceof u.RampValue?this.default_value.to_json():this.default_value},enumerable:!0,configurable:!0}),t.prototype._clone_raw_input=function(e){return e instanceof u.RampValue?e.clone():u.RampValue.from_json(e).to_json()},Object.defineProperty(t.prototype,"raw_input_serialized",{get:function(){return this._raw_input instanceof u.RampValue?this._raw_input.to_json():u.RampValue.from_json(this._raw_input).to_json()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"value_serialized",{get:function(){return this.value.to_json()},enumerable:!0,configurable:!0}),t.are_raw_input_equal=function(e,t){return e instanceof u.RampValue?t instanceof u.RampValue?e.is_equal(t):e.is_equal_json(t):t instanceof u.RampValue?t.is_equal_json(e):u.RampValue.are_json_equal(e,t)},t.are_values_equal=function(e,t){return e.is_equal(t)},t.prototype.initialize_param=function(){this.add_post_dirty_hook("_reset_ramp_interpolant_and_texture",this._reset_ramp_interpolant_and_texture_bound)},Object.defineProperty(t.prototype,"is_default",{get:function(){return this.default_value instanceof u.RampValue?this.value.is_equal(this.default_value):this.value.is_equal_json(this.default_value)},enumerable:!0,configurable:!0}),t.prototype.process_raw_input=function(){this._raw_input instanceof u.RampValue?this._value?this._value.copy(this._raw_input):this._value=this._raw_input:this._value?this._value.from_json(this._raw_input):this._value=u.RampValue.from_json(this._raw_input),this.emit_controller.emit(p.ParamEvent.VALUE_UPDATED)},t.prototype.has_expression=function(){return!1},t.prototype._reset_ramp_interpolant_and_texture=function(){this._ramp_interpolant=void 0,this._ramp_texture=void 0},t.prototype.ramp_texture=function(){return this._ramp_texture=this._ramp_texture||this._create_ramp_texture()},t.prototype._create_ramp_texture=function(){for(var e=new Uint8Array(3072),t=0,n=0,r=0,o=0;o<1024;o++)t=3*o,n=o/1024,r=this.value_at_position(n),e[t]=255*r;var s=new a.DataTexture(e,1024,1,i.RGBFormat);return s.needsUpdate=!0,s},t.create_interpolant=function(e,t){var n=new Float32Array(1);return new s.CubicInterpolant(e,t,1,n)},t.prototype.interpolant=function(){return this._ramp_interpolant=this._ramp_interpolant||this._create_interpolant()},t.prototype._create_interpolant=function(){for(var e=this.value.points,n=o.default(e,(function(e){return e.position})),r=new Float32Array(n.length),i=new Float32Array(n.length),a=0,s=0,_=n;s<_.length;s++){var u=_[s];r[a]=u.position,i[a]=u.value,a++}return t.create_interpolant(r,i)},t.prototype.value_at_position=function(e){return this.interpolant().evaluate(e)[0]},t.DEFAULT_VALUE=new u.RampValue(u.RampInterpolation.LINEAR,[new u.RampPoint(0,0),new u.RampPoint(1,1)]),t.DEFAULT_VALUE_JSON=t.DEFAULT_VALUE.to_json(),t}(_.TypedParam);t.RampParam=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){}return e.push_on_array_at_entry=function(e,t,n){e.has(t)?e.get(t).push(n):e.set(t,[n])},e.unshift_on_array_at_entry=function(e,t,n){e.has(t)?e.get(t).unshift(n):e.set(t,[n])},e.concat_on_array_at_entry=function(e,t,n){if(e.has(t))for(var r=e.get(t),o=0,i=n;o<i.length;o++){var a=i[o];r.push(a)}else e.set(t,n)},e}();t.MapUtils=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CATEGORY_OBJ={LIGHT:"lights",MANAGER:"managers",GEOMETRY:"geometries",CAMERA:"cameras",MISC:"misc"},t.CATEGORY_COP={INPUT:"inputs",ADVANCED:"advanced",MISC:"misc"},t.CATEGORY_EVENT={CAMERA:"cameras",MISC:"misc"},t.CATEGORY_GL={COLOR:"color",CONVERSION:"conversion",DYNAMICS:"dynamics",GEOMETRY:"geometry",GLOBALS:"globals",LOGIC:"logic",MATH:"math",QUAT:"quat",TRIGO:"trigo",UTIL:"util",INSTANCE:"instance"},t.CATEGORY_MAT={ADVANCED:"advanced",MESH:"meshes",POINTS:"points",LINE:"lines",VOLUME:"volumes",INSTANCE:"instances"},t.CATEGORY_SOP={ADVANCED:"advanced",ANIMATION:"animation",ATTRIBUTE:"attributes",DYNAMICS:"dynamics",INPUT:"inputs",MISC:"misc",MODIFIER:"modifiers",PRIMITIVES:"primitives",RENDER:"render"},t.CATEGORY_POST={PASS:"passes"}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});for(var r=n(2),o=n(90),i=n(641),a=n(113),s=n(27),_=n(94),u=n(70),c=n(0),p=["input texture","input texture","input texture","input texture"],l=new Uint16Array(32),d=0;d<32;d++)l[d]=28898;var f=new u.DataTexture(l,32,1,c.LuminanceFormat,c.HalfFloatType),h=function(e){function t(t){var n=e.call(this,t,"BaseCopNode")||this;return n.container_controller=new a.TypedContainerController(n,i.TextureContainer),n.flags=new _.FlagsControllerB(n),n}return r.__extends(t,e),t.node_context=function(){return s.NodeContext.COP},t.displayed_input_names=function(){return p},t.prototype.initialize_base_node=function(){this.io.outputs.set_has_one_output()},t.prototype.set_texture=function(e){e.name=this.full_path(),this.set_container(e)},t.prototype.clear_texture=function(){this.set_container(f)},t}(o.TypedNode);t.TypedCopNode=h;var m=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t}(h);t.BaseCopNodeClass=m},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=r.__importDefault(n(644)),i=r.__importDefault(n(361)),a=r.__importDefault(n(346)),s=n(3),_=n(90),u=n(133),c=n(267),p=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.create_node=function(t){return e.prototype.create_node.call(this,t)},t.prototype.children=function(){return e.prototype.children.call(this)},t.prototype.nodes_by_type=function(t){return e.prototype.nodes_by_type.call(this,t)},t}(_.TypedNode);t.AssemblerControllerNode=p;var l=function(){function e(e,t){this.node=e,this._globals_handler=new u.GlobalsGeometryHandler,this._compile_required=!0,this._deleted_params_data=new Map,this._assembler=new t(this.node)}return e.prototype.set_assembler_globals_handler=function(e){(this._globals_handler?this._globals_handler.id():null)!=(e?e.id():null)&&(this._globals_handler=e,this.set_compilation_required_and_dirty(),this._assembler.reset_configs())},Object.defineProperty(e.prototype,"assembler",{get:function(){return this._assembler},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"globals_handler",{get:function(){return this._globals_handler},enumerable:!0,configurable:!0}),e.prototype.add_output_params=function(e){this._assembler.add_output_params(e)},e.prototype.add_globals_params=function(e){this._assembler.add_globals_params(e)},e.prototype.allow_attribute_exports=function(){return this._assembler.allow_attribute_exports()},e.prototype.on_create=function(){var e=this.node.create_node("globals"),t=this.node.create_node("output");e.ui_data.set_position(new s.Vector2(-200,0)),t.ui_data.set_position(new s.Vector2(200,0))},e.prototype.set_compilation_required=function(e){void 0===e&&(e=!0),this._compile_required=e},e.prototype.set_compilation_required_and_dirty=function(e){this.set_compilation_required(),this.node.set_dirty(e)},e.prototype.compile_required=function(){return this._compile_required},e.prototype.post_compile=function(){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(e){return this.create_spare_parameters(),this.set_compilation_required(!1),[2]}))}))},e.prototype.assign_uniform_values=function(){return r.__awaiter(this,void 0,void 0,(function(){var e,t;return r.__generator(this,(function(n){switch(n.label){case 0:if(!this._assembler)return[3,4];e=0,t=this._assembler.param_configs(),n.label=1;case 1:return e<t.length?[4,t[e].set_uniform_value(this.node)]:[3,4];case 2:n.sent(),n.label=3;case 3:return e++,[3,1];case 4:return[2]}}))}))},e.prototype.create_spare_parameters=function(){var e=this,t=this.node.params.spare_names,n=this._assembler.param_configs(),r=n.map((function(e){return e.name})),s=a.default(r,t),_=a.default(t,r),u={},p=this.node.params.names,l=i.default(s,p);if(l.length>0){var d=this.node.full_path()+" attempts to create spare params called '"+l.join(", ")+"' with same name as params";console.warn(d),this.node.states.error.set(d)}_.forEach((function(t){var n=e.node.params.get(t);if(n){var r=c.JsonExportDispatcher.dispatch_param(n);if(r.required){var o=r.data();e._deleted_params_data.set(n.name,o)}}u.names_to_delete=u.names_to_delete||[],u.names_to_delete.push(t)}));for(var f=0,h=n;f<h.length;f++){var m=h[f];if(s.indexOf(m.name)>=0){var y=o.default(m.param_options,{spare:!0,cook:!0});u.to_add=u.to_add||[],u.to_add.push({name:m.name,type:m.type,init_value:m.default_value,options:y})}}this.node.params.update_params(u)},e}();t.GlAssemblerController=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(362),i=n(266),a=n(29),s=n(129),_=n(50),u={position:"vec3( position )"},c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.handle_globals_node=function(e,t,n){var r,o=e.io.outputs.named_output_connection_points_by_name(t);if(o){var i=e.gl_var_name(t),s=o.type,_=new a.VaryingGLDefinition(e,s,i);n.add_definitions(e,[_]);var u=null===(r=e.material_node)||void 0===r?void 0:r.assembler_controller.assembler;if(u){var c=u.shader_config(n.current_shader_name);if(c){for(var p=c.dependencies(),l=i+" = "+s+"("+t+")",d=0,f=p;d<f.length;d++){var h=f[d];n.add_definitions(e,[_],h),n.add_body_lines(e,[l],h)}0==p.length&&n.add_body_lines(e,[l])}}}},t.variable_config_default=function(e){return u[e]},t.prototype.variable_config_default=function(e){return t.variable_config_default(e)},t.prototype.read_attribute=function(e,n,r,o){return t.read_attribute(e,n,r,o)},t.read_attribute=function(e,n,r,o){var u;t.PRE_DEFINED_ATTRIBUTES.indexOf(r)<0&&o.add_definitions(e,[new a.AttributeGLDefinition(e,n,r)],_.ShaderName.VERTEX);var c=o.current_shader_name;switch(c){case _.ShaderName.VERTEX:return r;case _.ShaderName.FRAGMENT:if(!(e instanceof i.AttributeGlNode))return;var p="varying_"+e.gl_var_name(e.output_name),l=new a.VaryingGLDefinition(e,n,p),d=new Map;d.set(_.ShaderName.FRAGMENT,[]);var f=new Map;f.set(_.ShaderName.FRAGMENT,[]),s.MapUtils.push_on_array_at_entry(d,c,l);var h=p+" = "+n+"("+r+")",m=null===(u=e.material_node)||void 0===u?void 0:u.assembler_controller.assembler.shader_config(c);if(m){for(var y=0,v=m.dependencies();y<v.length;y++){var g=v[y];s.MapUtils.push_on_array_at_entry(d,g,l),s.MapUtils.push_on_array_at_entry(f,g,h)}d.forEach((function(t,n){o.add_definitions(e,t,n)})),f.forEach((function(t,n){o.add_body_lines(e,t,n)}))}return p}},t.prototype.handle_attribute_node=function(e,n,r,o){return t.read_attribute(e,n,r,o)},t.PRE_DEFINED_ATTRIBUTES=["position","color","normal","uv","uv2","morphTarget0","morphTarget1","morphTarget2","morphTarget3","skinIndex","skinWeight"],t.IF_RULE={uv:"defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )"},t}(o.GlobalsBaseController);t.GlobalsGeometryHandler=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(16),o=n(33),i=function(){function e(e){var t=this;this.node=e,this._input_name_function=function(e){return"in"+e},this._output_name_function=function(e){return 0==e?"val":"val"+e},this._expected_input_types_function=function(){var e=t.first_input_connection_type()||r.ConnectionPointType.FLOAT;return[e,e]},this._expected_output_types_function=function(){return[t._expected_input_types_function()[0]]},this._update_signature_if_required_bound=this.update_signature_if_required.bind(this),this._initialized=!1}return e.prototype.set_input_name_function=function(e){this._input_name_function=e},e.prototype.set_output_name_function=function(e){this._output_name_function=e},e.prototype.set_expected_input_types_function=function(e){this._expected_input_types_function=e},e.prototype.set_expected_output_types_function=function(e){this._expected_output_types_function=e},e.prototype.output_name=function(e){return this._output_name_function(e)},e.prototype.initialize_node=function(){this._initialized?console.warn("already initialized",this.node):(this._initialized=!0,this.node.io.inputs.add_on_set_input_hook("_update_signature_if_required",this._update_signature_if_required_bound),this.node.params.add_on_scene_load_hook("_update_signature_if_required",this._update_signature_if_required_bound),this.node.params.set_post_create_params_hook(this._update_signature_if_required_bound),this.node.add_post_dirty_hook("_update_signature_if_required",this._update_signature_if_required_bound))},e.prototype.update_signature_if_required=function(e){this.node.lifecycle.creation_completed&&this._connections_match_inputs()||(this.update_connection_types(),this.node.remove_dirty_state(),this.make_successors_update_signatures())},e.prototype.make_successors_update_signatures=function(){for(var e=0,t=this.node.graph_all_successors();e<t.length;e++){var n=t[e];n.gl_connections_controller&&n.gl_connections_controller.update_signature_if_required(this.node)}},e.prototype.update_connection_types=function(){var e=this,t=this._expected_input_types_function(),n=this._expected_output_types_function(),r=t.map((function(t,n){return new o.TypedNamedConnectionPoint(e._input_name_function(n),t)})),i=n.map((function(t,n){return new o.TypedNamedConnectionPoint(e._output_name_function(n),t)}));this.node.io.inputs.set_named_input_connection_points(r),this.node.io.outputs.set_named_output_connection_points(i,!1),this.node.spare_params_controller.create_spare_parameters()},e.prototype._connections_match_inputs=function(){var e=this.node.io.inputs.named_input_connection_points.map((function(e){return e.type})),t=this.node.io.outputs.named_output_connection_points.map((function(e){return e.type})),n=this._expected_input_types_function(),r=this._expected_output_types_function();if(n.length!=e.length)return!1;if(r.length!=t.length)return!1;for(var o=0;o<e.length;o++)if(e[o]!=n[o])return!1;for(o=0;o<t.length;o++)if(t[o]!=r[o])return!1;return!0},e.prototype.first_input_connection_type=function(){var e=this.node.io.connections.input_connections();if(e){var t=e[0];if(t)return this.connection_type_from_connection(t)}},e.prototype.connection_type_from_connection=function(e){var t=e.node_src,n=e.output_index;return t.io.outputs.named_output_connection_points[n].type},e}();t.GlConnectionsController=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(269),i=n(0),a=n(131),s=n(669),_=n(24),u=n(61),c=[{UVMapping:i.UVMapping},{CubeReflectionMapping:i.CubeReflectionMapping},{CubeRefractionMapping:i.CubeRefractionMapping},{EquirectangularReflectionMapping:i.EquirectangularReflectionMapping},{EquirectangularRefractionMapping:i.EquirectangularRefractionMapping},{SphericalReflectionMapping:i.SphericalReflectionMapping},{CubeUVReflectionMapping:i.CubeUVReflectionMapping},{CubeUVRefractionMapping:i.CubeUVRefractionMapping}],p=[{ClampToEdgeWrapping:i.ClampToEdgeWrapping},{RepeatWrapping:i.RepeatWrapping},{MirroredRepeatWrapping:i.MirroredRepeatWrapping}],l=[{LinearFilter:i.LinearFilter},{NearestFilter:i.NearestFilter}],d=[{NearestFilter:i.NearestFilter},{NearestMipMapNearestFilter:i.NearestMipMapNearestFilter},{NearestMipMapLinearFilter:i.NearestMipMapLinearFilter},{LinearFilter:i.LinearFilter},{LinearMipMapNearestFilter:i.LinearMipMapNearestFilter},{LinearMipMapLinearFilter:i.LinearMipMapLinearFilter}],f=["mapping","wrapS","wrapT","minFilter","magFilter"],h={mapping:"mapping",wrapS:"wrap_s",wrapT:"wrap_t",minFilter:"min_filter",magFilter:"mag_filter"},m=n(5),y=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.url=m.ParamConfig.STRING(s.CoreTextureLoader.PARAM_DEFAULT,{desktop_browse:{file_type:"texture"}}),t.reload=m.ParamConfig.BUTTON(null,{callback:function(e,t){v.PARAM_CALLBACK_reload(e,t)}}),t.mapping=m.ParamConfig.INTEGER(i.UVMapping,{menu:{entries:c.map((function(e){return{name:Object.keys(e)[0],value:Object.values(e)[0]}}))}}),t.wrap_s=m.ParamConfig.INTEGER(Object.values(p[0])[0],{menu:{entries:p.map((function(e){return{name:Object.keys(e)[0],value:Object.values(e)[0]}}))}}),t.wrap_t=m.ParamConfig.INTEGER(Object.values(p[0])[0],{menu:{entries:p.map((function(e){return{name:Object.keys(e)[0],value:Object.values(e)[0]}}))}}),t.mag_filter=m.ParamConfig.INTEGER(Object.values(l[0])[0],{menu:{entries:l.map((function(e){return{name:Object.keys(e)[0],value:Object.values(e)[0]}}))}}),t.min_filter=m.ParamConfig.INTEGER(Object.values(d[0])[0],{menu:{entries:d.map((function(e){return{name:Object.keys(e)[0],value:Object.values(e)[0]}}))}}),t}return r.__extends(t,e),t}(m.NodeParamsConfig)),v=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=y,t}return r.__extends(t,e),t.type=function(){return"file"},t.prototype.cook=function(){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(e){switch(e.label){case 0:return this._is_static_image_url(this.pv.url)?[4,this.cook_for_image()]:[3,2];case 1:return e.sent(),[3,4];case 2:return[4,this.cook_for_video()];case 3:e.sent(),e.label=4;case 4:return[2]}}))}))},t.prototype._is_static_image_url=function(e){return!0},t.prototype.cook_for_image=function(){return r.__awaiter(this,void 0,void 0,(function(){var e;return r.__generator(this,(function(t){switch(t.label){case 0:return[4,this._load_texture(this.pv.url)];case 1:return(e=t.sent())?(this._update_texture_params(e),this.set_texture(e)):this.clear_texture(),[2]}}))}))},t.prototype.cook_for_video=function(){return r.__awaiter(this,void 0,void 0,(function(){var e;return r.__generator(this,(function(t){switch(t.label){case 0:return this._param_url_changed()?[4,this._load_texture(this.pv.url)]:[3,2];case 1:return(e=t.sent())&&this._add_video_spare_params_if_required(e),this._previous_param_url=this.pv.url,this._set_video_current_time(),e?(this._update_texture_params(e),this.set_texture(e)):this.cook_controller.end_cook(),[3,2];case 2:return[2]}}))}))},t.prototype.resolved_url=function(){return this.pv.url},t.prototype._update_texture_params=function(e){for(var t=0,n=f;t<n.length;t++){var r=n[t],o=h[r],i=this.params.float(o);null!=i&&e&&e[r]!=i&&(e[r]=i,e.needsUpdate=!0)}},t.PARAM_CALLBACK_reload=function(e,t){e.param_callback_reload()},t.prototype.param_callback_reload=function(){this._previous_param_url=void 0,this.p.url.set_successors_dirty()},t.prototype._set_video_current_time=function(){this._video&&this.params.has("video_time")&&(this._video.currentTime=this.params.float("video_time"))},t.prototype._add_video_spare_params_if_required=function(e){if(e)if(e.constructor==o.VideoTexture){if(this._video=e.image,this._video&&!this.params.has_param(t.VIDEO_TIME_PARAM_NAME)){var n=this._video.duration;this.add_param(_.ParamType.FLOAT,t.VIDEO_TIME_PARAM_NAME,"$T",{spare:!0,cook:!0,range:[0,n],range_locked:[!0,!0]}),this.emit(u.NodeEvent.PARAMS_UPDATED)}}else this._remove_spare_params();else this._remove_spare_params()},t.prototype._remove_spare_params=function(){this.params.has_param(t.VIDEO_TIME_PARAM_NAME)&&this.params.update_params({names_to_delete:[t.VIDEO_TIME_PARAM_NAME]})},t.prototype._param_url_changed=function(){return this._previous_param_url!=this.pv.url},t.prototype._load_texture=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,n;return r.__generator(this,(function(r){switch(r.label){case 0:if(t=null,n=this.params.get("url"),!e||!n)return[3,5];this._texture_loader=this._texture_loader||new s.CoreTextureLoader(this,n),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this._texture_loader.load_texture_from_url_or_op(e)];case 2:return t=r.sent(),[3,4];case 3:return r.sent(),[3,4];case 4:return t||this.states.error.set("could not load texture '"+e+"'"),[3,6];case 5:this.states.error.set("not url given to Mat/Base._load_texture"),r.label=6;case 6:return[2,t]}}))}))},t.VIDEO_TIME_PARAM_NAME="video_time",t.DEFAULT_NODE_PATH={UV:"/COP/file_uv",ENV_MAP:"/COP/env_map"},t}(a.TypedCopNode);t.FileCopNode=v},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(272),i=n(54),a=n(22),s=n(56),_=n(27),u=n(5);t.CameraBackgroundParamConfig=function(e){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.background=u.ParamConfig.FOLDER(),t.use_background=u.ParamConfig.BOOLEAN(0),t.use_material=u.ParamConfig.BOOLEAN(0,{visible_if:{use_background:!0}}),t.background_color=u.ParamConfig.COLOR([0,0,0],{visible_if:{use_background:!0,use_material:!1}}),t.background_material=u.ParamConfig.OPERATOR_PATH("",{visible_if:{use_background:!0,use_material:!0},node_selection:{context:_.NodeContext.MAT},dependent_on_found_node:!1}),t.background_ratio=u.ParamConfig.FLOAT(1,{visible_if:{use_background:!0,use_material:!0}}),t}return r.__extends(t,e),t}(e)};var c=function(){function e(e){this.node=e,this._bg_raycaster=new o.Raycaster}return Object.defineProperty(e.prototype,"screen_quad",{get:function(){return this._screen_quad=this._screen_quad||this._create_screen_quad()},enumerable:!0,configurable:!0}),e.prototype._create_screen_quad=function(){var e=new i.PlaneBufferGeometry(2,2,1,1),t=new a.Mesh(e);return this.node.object.add(t),t},e.prototype.screen_quad_flat_material=function(){return this._screen_quad_flat_material=this._screen_quad_flat_material||new s.MeshBasicMaterial},e.prototype.add_params=function(){},Object.defineProperty(e.prototype,"use_background",{get:function(){return this.node.params.boolean("use_background")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"use_background_material",{get:function(){return this.use_background&&this.node.params.boolean("use_material")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"use_background_color",{get:function(){return this.use_background&&!this.node.params.boolean("use_material")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"background_color",{get:function(){return this.use_background_color?this.node.params.color("background_color"):null},enumerable:!0,configurable:!0}),e.prototype.update_screen_quad=function(){},e.prototype.update=function(){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(e){switch(e.label){case 0:return this.use_background?(this.update_screen_quad(),[4,this.update_background_color()]):[3,4];case 1:return e.sent(),this.use_background_material?[4,this.update_background_material()]:[3,3];case 2:e.sent(),e.label=3;case 3:return[3,5];case 4:this._screen_quad&&this.node.object.remove(this._screen_quad),e.label=5;case 5:return[2]}}))}))},e.prototype.update_background_color=function(){return r.__awaiter(this,void 0,void 0,(function(){var e;return r.__generator(this,(function(t){return(e=this.screen_quad_flat_material()).color=this.node.pv.background_color,this.screen_quad.material=e,[2]}))}))},e.prototype.update_background_material=function(){return r.__awaiter(this,void 0,void 0,(function(){var e,t;return r.__generator(this,(function(n){switch(n.label){case 0:return(e=this.node.p.background_material.found_node())?[4,e.request_container()]:[3,2];case 1:return n.sent(),t=e.material,this.screen_quad.material=t,[3,3];case 2:this.node.states.error.set("bg node not found"),n.label=3;case 3:return[2]}}))}))},e}();t.BaseBackgroundController=c},,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=r.__importDefault(n(21)),i=n(93),a=n(354),s=n(103),_=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._components_contructor=a.FloatParam,t}return r.__extends(t,e),Object.defineProperty(t.prototype,"components",{get:function(){return this._components},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"is_numeric",{get:function(){return!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"is_default",{get:function(){for(var e=0,t=this.components;e<t.length;e++){if(!t[e].is_default)return!1}return!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"raw_input",{get:function(){return this._components.map((function(e){return e.raw_input}))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"raw_input_serialized",{get:function(){return this.raw_input},enumerable:!0,configurable:!0}),t.prototype.init_components=function(){if(null==this._components){var e=0;this._components=new Array(this.component_names.length);for(var t=0,n=this.component_names;t<n.length;t++){var r=n[t],i=new this._components_contructor(this.scene),a=void 0;a=o.default(this._default_value)?this._default_value[e]:this._default_value[r],i.options.copy(this.options),i.set_init_value(a),i.set_name(""+this.name+r),i.set_parent_param(this),this.add_graph_input(i),this._components[e]=i,e++}}},t.prototype.process_computation=function(){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(e){switch(e.label){case 0:return[4,this.compute_components()];case 1:return e.sent(),this.set_value_from_components(),[2]}}))}))},t.prototype.set_value_from_components=function(){},t.prototype.has_expression=function(){for(var e,t=0,n=this.components;t<n.length;t++){if(null===(e=n[t].expression_controller)||void 0===e?void 0:e.active)return!0}return!1},t.prototype.compute_components=function(){return r.__awaiter(this,void 0,void 0,(function(){var e,t,n,o,i;return r.__generator(this,(function(r){switch(r.label){case 0:for(e=this.components,t=[],n=0,o=e;n<o.length;n++)(i=o[n]).is_dirty&&t.push(i.compute());return[4,Promise.all(t)];case 1:return r.sent(),this.remove_dirty_state(),[2]}}))}))},t.prototype._prefilter_invalid_raw_input=function(e){if(o.default(e))return e;var t=e;return this.components.map((function(){return t}))},t.prototype.process_raw_input=function(){var e=this.scene.cooker;e.block();for(var t=this.components,n=0,r=t;n<r.length;n++){r[n].emit_controller.block_parent_emit()}var i=this._raw_input;if(o.default(i))for(var a=0;a<t.length;a++)t[a].set(i[a]);else for(a=0;a<t.length;a++){var _=this.component_names[a];t[a].set(i[_])}e.unblock();for(a=0;a<t.length;a++)t[a].emit_controller.unblock_parent_emit();this.emit_controller.emit(s.ParamEvent.VALUE_UPDATED)},t}(i.TypedParam);t.TypedMultipleParam=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this._param=e,this._complex_data={}}return Object.defineProperty(e.prototype,"required",{get:function(){var e=this._param.options.is_spare&&!this._param.parent_param,t=!this._param.is_default;return e||t},enumerable:!0,configurable:!0}),e.prototype.data=function(){if(this._param.parent_param)throw console.warn("no component should be saved"),"no component should be saved";return this._require_data_complex()?this._data_complex():this._data_simple()},e.prototype._data_simple=function(){return this._param.raw_input_serialized},e.prototype._data_complex=function(){if(this._complex_data={},this._param.options.is_spare&&!this._param.parent_param&&(this._complex_data.type=this._param.type,this._complex_data.default_value=this._param.default_value_serialized,this._complex_data.raw_input=this._param.raw_input_serialized,this._complex_data.options=this._param.options.current),this._param.is_default||this.add_main(),this._param.options.has_options_overridden){for(var e={},t=this._param.options.overridden_options,n=0,r=Object.keys(t);n<r.length;n++){var o=r[n],i=t[o];e[o]=JSON.stringify(i)}this._complex_data.overriden_options=e}return this._complex_data},e.prototype._require_data_complex=function(){return!!this._param.options.is_spare||!!this._param.options.has_options_overridden},e.prototype.add_main=function(){},e}();t.ParamJsonExporter=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(3),i=n(268),a=n(194),s=n(195),_=n(659),u=n(133),c=n(664),p=n(50),l=n(24),d=n(33),f=n(16),h=n(365),m=n(266),y=new Map([[p.ShaderName.VERTEX,"#include <common>"],[p.ShaderName.FRAGMENT,"#include <common>"]]),v=new Map([[p.ShaderName.VERTEX,"#include <color_vertex>"],[p.ShaderName.FRAGMENT,"vec4 diffuseColor = vec4( diffuse, opacity );"]]),g=new Map([[p.ShaderName.VERTEX,["#include <begin_vertex>","#include <beginnormal_vertex>"]],[p.ShaderName.FRAGMENT,[]]]),b=function(e){function t(t){var n=e.call(this)||this;return n._gl_parent_node=t,n._shaders_by_name=new Map,n._lines=new Map,n._root_nodes=[],n._leaf_nodes=[],n._uniforms_time_dependent=!1,n._resolution_dependent=!1,n}return r.__extends(t,e),t.prototype.compile=function(){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(e){return[2]}))}))},t.prototype._template_shader_for_shader_name=function(e){var t,n;switch(e){case p.ShaderName.VERTEX:return null===(t=this._template_shader)||void 0===t?void 0:t.vertexShader;case p.ShaderName.FRAGMENT:return null===(n=this._template_shader)||void 0===n?void 0:n.fragmentShader}},Object.defineProperty(t.prototype,"globals_handler",{get:function(){return this._gl_parent_node.assembler_controller.globals_handler},enumerable:!0,configurable:!0}),t.prototype.compile_allowed=function(){return null!=this._gl_parent_node.assembler_controller.globals_handler},t.prototype.shaders_by_name=function(){return this._shaders_by_name},t.prototype._build_lines=function(){for(var e=0,t=this.shader_names;e<t.length;e++){var n=t[e],r=this._template_shader_for_shader_name(n);r&&this._replace_template(r,n)}},t.prototype.set_root_nodes=function(e){this._root_nodes=e},Object.defineProperty(t.prototype,"_template_shader",{get:function(){},enumerable:!0,configurable:!0}),t.prototype.add_uniforms=function(e){for(var t=0,n=this.param_configs();t<n.length;t++){var r=n[t];e[r.uniform_name]=r.uniform}this.uniforms_time_dependent()&&(e.time={value:this._gl_parent_node.scene.time}),this.resolution_dependent()&&(e.resolution={value:new o.Vector2(1e3,1e3)})},t.prototype.root_nodes_by_shader_name=function(e){for(var t=[],n=0,r=this._root_nodes;n<r.length;n++){var o=r[n];switch(o.type){case"output":t.push(o)}}return t},t.prototype.leaf_nodes_by_shader_name=function(e){for(var t=[],n=0,r=this._leaf_nodes;n<r.length;n++){var o=r[n];switch(o.type){case h.GlobalsGlNode.type():t.push(o);break;case m.AttributeGlNode.type():}}return t},t.prototype.set_node_lines_globals=function(e,t){},t.prototype.set_node_lines_output=function(e,t){},t.prototype.set_node_lines_attribute=function(e,t){},Object.defineProperty(t.prototype,"code_builder",{get:function(){return this._code_builder=this._code_builder||new _.CodeBuilder(this,this._gl_parent_node)},enumerable:!0,configurable:!0}),t.prototype.build_code_from_nodes=function(e){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(t){switch(t.label){case 0:return[4,this.code_builder.build_from_nodes(e)];case 1:return t.sent(),[2]}}))}))},t.prototype.allow_new_param_configs=function(){this.code_builder.allow_new_param_configs()},t.prototype.disallow_new_param_configs=function(){this.code_builder.disallow_new_param_configs()},t.prototype.builder_param_configs=function(){return this.code_builder.param_configs()},t.prototype.builder_lines=function(e,t){return this.code_builder.lines(e,t)},t.prototype.all_builder_lines=function(){return this.code_builder.all_lines()},t.prototype.param_configs=function(){return(this._param_config_owner||this.code_builder).param_configs()},t.prototype.set_param_configs_owner=function(e){this._param_config_owner=e,this._param_config_owner?this.code_builder.disallow_new_param_configs():this.code_builder.allow_new_param_configs()},t.add_output_params=function(e){e.params.add_param(l.ParamType.VECTOR3,"position",[0,0,0],{hidden:!0}),e.params.add_param(l.ParamType.VECTOR3,"normal",[0,0,0],{hidden:!0}),e.params.add_param(l.ParamType.COLOR,"color",[1,1,1],{hidden:!0}),e.params.add_param(l.ParamType.FLOAT,"alpha",1,{hidden:!0}),e.params.add_param(l.ParamType.VECTOR2,"uv",[0,0],{hidden:!0})},t.prototype.add_output_params=function(e){t.add_output_params(e)},t.create_globals_node_output_connections=function(){return[new d.TypedNamedConnectionPoint("position",f.ConnectionPointType.VEC3),new d.TypedNamedConnectionPoint("normal",f.ConnectionPointType.VEC3),new d.TypedNamedConnectionPoint("color",f.ConnectionPointType.VEC3),new d.TypedNamedConnectionPoint("uv",f.ConnectionPointType.VEC2),new d.TypedNamedConnectionPoint("gl_FragCoord",f.ConnectionPointType.VEC4),new d.TypedNamedConnectionPoint("resolution",f.ConnectionPointType.VEC2),new d.TypedNamedConnectionPoint("time",f.ConnectionPointType.FLOAT)]},t.prototype.create_globals_node_output_connections=function(){return t.create_globals_node_output_connections()},t.prototype.add_globals_params=function(e){e.io.outputs.set_named_output_connection_points(this.create_globals_node_output_connections())},t.prototype.allow_attribute_exports=function(){return!1},t.prototype.reset_configs=function(){this._reset_shader_configs(),this._reset_variable_configs(),this._reset_uniforms_time_dependency(),this._reset_resolution_dependency()},Object.defineProperty(t.prototype,"shader_configs",{get:function(){return this._shader_configs=this._shader_configs||this.create_shader_configs()},enumerable:!0,configurable:!0}),t.prototype.set_shader_configs=function(e){this._shader_configs=e},Object.defineProperty(t.prototype,"shader_names",{get:function(){var e;return(null===(e=this.shader_configs)||void 0===e?void 0:e.map((function(e){return e.name()})))||[]},enumerable:!0,configurable:!0}),t.prototype._reset_shader_configs=function(){this._shader_configs=void 0},t.prototype.create_shader_configs=function(){return[new a.ShaderConfig(p.ShaderName.VERTEX,["position","normal","uv"],[]),new a.ShaderConfig(p.ShaderName.FRAGMENT,["color","alpha"],[p.ShaderName.VERTEX])]},t.prototype.shader_config=function(e){var t;return null===(t=this.shader_configs)||void 0===t?void 0:t.filter((function(t){return t.name()==e}))[0]},t.prototype.variable_configs=function(){return this._variable_configs=this._variable_configs||this.create_variable_configs()},t.prototype.set_variable_configs=function(e){this._variable_configs=e},t.prototype.variable_config=function(e){return this.variable_configs().filter((function(t){return t.name()==e}))[0]},t.create_variable_configs=function(){return[new s.VariableConfig("position",{default_from_attribute:!0,prefix:"vec3 transformed = "}),new s.VariableConfig("normal",{default_from_attribute:!0,prefix:"vec3 objectNormal = "}),new s.VariableConfig("color",{prefix:"diffuseColor.xyz = "}),new s.VariableConfig("alpha",{prefix:"diffuseColor.a = "}),new s.VariableConfig("uv",{prefix:"vUv = ",if:u.GlobalsGeometryHandler.IF_RULE.uv})]},t.prototype.create_variable_configs=function(){return t.create_variable_configs()},t.prototype._reset_variable_configs=function(){this._variable_configs=void 0,this.variable_configs()},t.prototype.input_names_for_shader_name=function(e,t){var n;return(null===(n=this.shader_config(t))||void 0===n?void 0:n.input_names())||[]},t.prototype._reset_uniforms_time_dependency=function(){this._uniforms_time_dependent=!1},t.prototype.set_uniforms_time_dependent=function(){this._uniforms_time_dependent=!0},t.prototype.uniforms_time_dependent=function(){return this._uniforms_time_dependent},t.prototype._reset_resolution_dependency=function(){this._resolution_dependent=!1},t.prototype.set_resolution_dependent=function(){this._resolution_dependent=!0},t.prototype.resolution_dependent=function(){return this._resolution_dependent},t.prototype.insert_define_after=function(e){return y.get(e)},t.prototype.insert_body_after=function(e){return v.get(e)},t.prototype.lines_to_remove=function(e){return g.get(e)},t.prototype._replace_template=function(e,t){for(var n=this.builder_lines(t,i.LineType.FUNCTION_DECLARATION),r=this.builder_lines(t,i.LineType.DEFINE),o=this.builder_lines(t,i.LineType.BODY),a=e.split("\n"),s=[],_=this.insert_define_after(t),u=this.insert_body_after(t),c=this.lines_to_remove(t),p=!1,l=!1,d=0,f=a;d<f.length;d++){var h=f[d];1==p&&(n&&this._insert_lines(s,n),r&&this._insert_lines(s,r),p=!1),1==l&&(o&&this._insert_lines(s,o),l=!1);var m=!1;if(c)for(var y=0,v=c;y<v.length;y++){var g=v[y];h.indexOf(g)>=0&&(m=!0)}m?(s.push("// removed:"),s.push("//"+h)):s.push(h),_&&h.indexOf(_)>=0&&(p=!0),u&&h.indexOf(u)>=0&&(l=!0)}this._lines.set(t,s)},t.prototype._insert_lines=function(e,t){if(t.length>0){for(var n=0;n<3;n++)e.push("");for(var r=0,o=t;r<o.length;r++){var i=o[r];e.push(i)}for(n=0;n<3;n++)e.push("")}},t.prototype.get_custom_materials=function(){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(e){return[2,new Map]}))}))},t}(c.TypedAssembler);t.BaseGlShaderAssembler=b},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this.node=e}return e.prototype.add_params=function(){},e.prototype.update=function(){},Object.defineProperty(e.prototype,"material",{get:function(){return this.node.material},enumerable:!0,configurable:!0}),e}();t.BaseController=r},,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,o=n(2).__importDefault(n(21));!function(e){e.customDistanceMaterial="customDistanceMaterial",e.customDepthMaterial="customDepthMaterial",e.customDepthDOFMaterial="customDepthDOFMaterial"}(r||(r={}));var i=function(){function e(){}return e.node=function(e,t){return e.node(t.name)},e.clone=function(e){var t=this;return o.default(e)?e.map((function(e){return t.clone_single(e)})):this.clone_single(e)},e.clone_single=function(e){var t=e.clone();return t.linewidth=e.linewidth,t},e.apply_custom_materials=function(e,t){var n=t;if(n.custom_materials)for(var r=0,o=Object.keys(n.custom_materials);r<o.length;r++){var i=o[r],a=n.custom_materials[i];a&&(e[i]=a,a.needsUpdate=!0)}},e.assign_custom_uniforms=function(e,t,n){var r=e;if(r.custom_materials)for(var o=0,i=Object.keys(r.custom_materials);o<i.length;o++){var a=i[o],s=r.custom_materials[a];s&&(s.uniforms[t].value=n)}},e.init_custom_material_uniforms=function(e,t,n){var r=e;if(r.custom_materials)for(var o=0,i=Object.keys(r.custom_materials);o<i.length;o++){var a=i[o],s=r.custom_materials[a];s&&(s.uniforms[t]=s.uniforms[t]||n)}},e}();t.CoreMaterial=i},,,,,,function(e,t,n){"use strict";n.d(t,"a",(function(){return F}));var r={},o=void 0,i=r;function a(e,t){var n,r=e.split("."),a=i;!(r[0]in a)&&a.execScript&&a.execScript("var "+r[0]);for(;r.length&&(n=r.shift());)r.length||t===o?a=a[n]?a[n]:a[n]={}:a[n]=t}var s="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array&&"undefined"!=typeof DataView;function _(e){var t,n,r,o,i,a,_,u,c,p,l=e.length,d=0,f=Number.POSITIVE_INFINITY;for(u=0;u<l;++u)e[u]>d&&(d=e[u]),e[u]<f&&(f=e[u]);for(t=1<<d,n=new(s?Uint32Array:Array)(t),r=1,o=0,i=2;r<=d;){for(u=0;u<l;++u)if(e[u]===r){for(a=0,_=o,c=0;c<r;++c)a=a<<1|1&_,_>>=1;for(p=r<<16|u,c=a;c<t;c+=i)n[c]=p;++o}++r,o<<=1,i<<=1}return[n,d,f]}function u(e,t){switch(this.g=[],this.h=32768,this.d=this.f=this.a=this.l=0,this.input=s?new Uint8Array(e):e,this.m=!1,this.i=p,this.r=!1,!t&&(t={})||(t.index&&(this.a=t.index),t.bufferSize&&(this.h=t.bufferSize),t.bufferType&&(this.i=t.bufferType),t.resize&&(this.r=t.resize)),this.i){case c:this.b=32768,this.c=new(s?Uint8Array:Array)(32768+this.h+258);break;case p:this.b=0,this.c=new(s?Uint8Array:Array)(this.h),this.e=this.z,this.n=this.v,this.j=this.w;break;default:throw Error("invalid inflate mode")}}var c=0,p=1,l={t:c,s:p};u.prototype.k=function(){for(;!this.m;){var e=j(this,3);switch(1&e&&(this.m=!0),e>>>=1){case 0:var t=this.input,n=this.a,r=this.c,i=this.b,a=t.length,u=o,l=r.length,d=o;if(this.d=this.f=0,n+1>=a)throw Error("invalid uncompressed block header: LEN");if(u=t[n++]|t[n++]<<8,n+1>=a)throw Error("invalid uncompressed block header: NLEN");if(u===~(t[n++]|t[n++]<<8))throw Error("invalid uncompressed block header: length verify");if(n+u>t.length)throw Error("input buffer is broken");switch(this.i){case c:for(;i+u>r.length;){if(u-=d=l-i,s)r.set(t.subarray(n,n+d),i),i+=d,n+=d;else for(;d--;)r[i++]=t[n++];this.b=i,r=this.e(),i=this.b}break;case p:for(;i+u>r.length;)r=this.e({p:2});break;default:throw Error("invalid inflate mode")}if(s)r.set(t.subarray(n,n+u),i),i+=u,n+=u;else for(;u--;)r[i++]=t[n++];this.a=n,this.b=i,this.c=r;break;case 1:this.j(A,M);break;case 2:var f,h,y,v,g=j(this,5)+257,b=j(this,5)+1,x=j(this,4)+4,P=new(s?Uint8Array:Array)(m.length),T=o,w=o,C=o,O=o,E=o;for(E=0;E<x;++E)P[m[E]]=j(this,3);if(!s)for(E=x,x=P.length;E<x;++E)P[m[E]]=0;for(f=_(P),T=new(s?Uint8Array:Array)(g+b),E=0,v=g+b;E<v;)switch(w=S(this,f),w){case 16:for(O=3+j(this,2);O--;)T[E++]=C;break;case 17:for(O=3+j(this,3);O--;)T[E++]=0;C=0;break;case 18:for(O=11+j(this,7);O--;)T[E++]=0;C=0;break;default:C=T[E++]=w}h=_(s?T.subarray(0,g):T.slice(0,g)),y=_(s?T.subarray(g):T.slice(g)),this.j(h,y);break;default:throw Error("unknown BTYPE: "+e)}}return this.n()};var d,f,h=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],m=s?new Uint16Array(h):h,y=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,258,258],v=s?new Uint16Array(y):y,g=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0],b=s?new Uint8Array(g):g,x=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],P=s?new Uint16Array(x):x,T=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],w=s?new Uint8Array(T):T,C=new(s?Uint8Array:Array)(288);for(d=0,f=C.length;d<f;++d)C[d]=143>=d?8:255>=d?9:279>=d?7:8;var O,E,A=_(C),N=new(s?Uint8Array:Array)(30);for(O=0,E=N.length;O<E;++O)N[O]=5;var M=_(N);function j(e,t){for(var n,r=e.f,o=e.d,i=e.input,a=e.a,s=i.length;o<t;){if(a>=s)throw Error("input buffer is broken");r|=i[a++]<<o,o+=8}return n=r&(1<<t)-1,e.f=r>>>t,e.d=o-t,e.a=a,n}function S(e,t){for(var n,r,o=e.f,i=e.d,a=e.input,s=e.a,_=a.length,u=t[0],c=t[1];i<c&&!(s>=_);)o|=a[s++]<<i,i+=8;if((r=(n=u[o&(1<<c)-1])>>>16)>i)throw Error("invalid code length: "+r);return e.f=o>>r,e.d=i-r,e.a=s,65535&n}function R(e,t){var n,r;switch(this.input=e,this.a=0,!t&&(t={})||(t.index&&(this.a=t.index),t.verify&&(this.A=t.verify)),n=e[this.a++],r=e[this.a++],15&n){case L:this.method=L;break;default:throw Error("unsupported compression method")}if(0!=((n<<8)+r)%31)throw Error("invalid fcheck flag:"+((n<<8)+r)%31);if(32&r)throw Error("fdict flag is not supported");this.q=new u(e,{index:this.a,bufferSize:t.bufferSize,bufferType:t.bufferType,resize:t.resize})}u.prototype.j=function(e,t){var n=this.c,r=this.b;this.o=e;for(var o,i,a,s,_=n.length-258;256!==(o=S(this,e));)if(256>o)r>=_&&(this.b=r,n=this.e(),r=this.b),n[r++]=o;else for(s=v[i=o-257],0<b[i]&&(s+=j(this,b[i])),o=S(this,t),a=P[o],0<w[o]&&(a+=j(this,w[o])),r>=_&&(this.b=r,n=this.e(),r=this.b);s--;)n[r]=n[r++-a];for(;8<=this.d;)this.d-=8,this.a--;this.b=r},u.prototype.w=function(e,t){var n=this.c,r=this.b;this.o=e;for(var o,i,a,s,_=n.length;256!==(o=S(this,e));)if(256>o)r>=_&&(_=(n=this.e()).length),n[r++]=o;else for(s=v[i=o-257],0<b[i]&&(s+=j(this,b[i])),o=S(this,t),a=P[o],0<w[o]&&(a+=j(this,w[o])),r+s>_&&(_=(n=this.e()).length);s--;)n[r]=n[r++-a];for(;8<=this.d;)this.d-=8,this.a--;this.b=r},u.prototype.e=function(){var e,t,n=new(s?Uint8Array:Array)(this.b-32768),r=this.b-32768,o=this.c;if(s)n.set(o.subarray(32768,n.length));else for(e=0,t=n.length;e<t;++e)n[e]=o[e+32768];if(this.g.push(n),this.l+=n.length,s)o.set(o.subarray(r,r+32768));else for(e=0;32768>e;++e)o[e]=o[r+e];return this.b=32768,o},u.prototype.z=function(e){var t,n,r,o=this.input.length/this.a+1|0,i=this.input,a=this.c;return e&&("number"==typeof e.p&&(o=e.p),"number"==typeof e.u&&(o+=e.u)),2>o?n=(r=(i.length-this.a)/this.o[2]/2*258|0)<a.length?a.length+r:a.length<<1:n=a.length*o,s?(t=new Uint8Array(n)).set(a):t=a,this.c=t},u.prototype.n=function(){var e,t,n,r,o,i=0,a=this.c,_=this.g,u=new(s?Uint8Array:Array)(this.l+(this.b-32768));if(0===_.length)return s?this.c.subarray(32768,this.b):this.c.slice(32768,this.b);for(t=0,n=_.length;t<n;++t)for(r=0,o=(e=_[t]).length;r<o;++r)u[i++]=e[r];for(t=32768,n=this.b;t<n;++t)u[i++]=a[t];return this.g=[],this.buffer=u},u.prototype.v=function(){var e,t=this.b;return s?this.r?(e=new Uint8Array(t)).set(this.c.subarray(0,t)):e=this.c.subarray(0,t):(this.c.length>t&&(this.c.length=t),e=this.c),this.buffer=e},R.prototype.k=function(){var e,t,n=this.input;if(e=this.q.k(),this.a=this.q.a,this.A){t=(n[this.a++]<<24|n[this.a++]<<16|n[this.a++]<<8|n[this.a++])>>>0;var r=e;if("string"==typeof r){var o,i,a=r.split("");for(o=0,i=a.length;o<i;o++)a[o]=(255&a[o].charCodeAt(0))>>>0;r=a}for(var s,_=1,u=0,c=r.length,p=0;0<c;){c-=s=1024<c?1024:c;do{u+=_+=r[p++]}while(--s);_%=65521,u%=65521}if(t!==(u<<16|_)>>>0)throw Error("invalid adler-32 checksum")}return e};var L=8;a("Zlib.Inflate",R),a("Zlib.Inflate.prototype.decompress",R.prototype.k);var k,z,G,I,D={ADAPTIVE:l.s,BLOCK:l.t};if(Object.keys)k=Object.keys(D);else for(z in k=[],G=0,D)k[G++]=z;for(G=0,I=k.length;G<I;++G)a("Zlib.Inflate.BufferType."+(z=k[G]),D[z]);var F=r.Zlib},,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=r.__importDefault(n(45)),i=r.__importDefault(n(21)),a=n(93),s=n(350),_=n(103),u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),Object.defineProperty(t.prototype,"is_numeric",{get:function(){return!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"is_default",{get:function(){return this._raw_input==this.default_value},enumerable:!0,configurable:!0}),t.prototype._prefilter_invalid_raw_input=function(e){return i.default(e)?e[0]:e},t.prototype.process_raw_input=function(){this.states.error.clear();var e=this.convert(this._raw_input);null!=e?(this._expression_controller&&(this._expression_controller.set_expression(void 0,!1),this.emit_controller.emit(_.ParamEvent.EXPRESSION_UPDATED)),e!=this._value&&(this._update_value(e),this.set_successors_dirty(this))):o.default(this._raw_input)?(this._expression_controller=this._expression_controller||new s.ExpressionController(this),this._raw_input!=this._expression_controller.expression&&(this._expression_controller.set_expression(this._raw_input),this.emit_controller.emit(_.ParamEvent.EXPRESSION_UPDATED))):this.states.error.set("param input is invalid ("+this.full_path()+")")},t.prototype.process_computation=function(){var e;return r.__awaiter(this,void 0,void 0,(function(){var t,n;return r.__generator(this,(function(r){switch(r.label){case 0:return null===(e=this.expression_controller)||void 0===e||!e.active||this.expression_controller.requires_entities?[3,2]:[4,this.expression_controller.compute_expression()];case 1:t=r.sent(),this.expression_controller.is_errored?this.states.error.set('expression error: "'+this.expression_controller.expression+'" ('+this.expression_controller.error_message+")"):null!=(n=this.convert(t))?(this.states.error.active&&this.states.error.clear(),this._update_value(n)):this.states.error.set("expression returns an invalid type ("+t+") ("+this.expression_controller.expression+")"),r.label=2;case 2:return[2]}}))}))},t.prototype._update_value=function(e){this._value=e,this.parent_param&&this.parent_param.set_value_from_components(),this.options.execute_callback(),this.emit_controller.emit(_.ParamEvent.VALUE_UPDATED),this.remove_dirty_state()},t}(a.TypedParam);t.TypedNumericParam=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){}return e.unreachable=function(e){throw new Error("Didn't expect to get here")},e}();t.TypeAssert=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(49),o=n(267),i=function(){function e(e){this._scene=e,this._data={}}return e.prototype.data=function(){this._scene.nodes_controller.reset_node_context_signatures();var e=o.JsonExportDispatcher.dispatch_node(this._scene.root),t=e.data(),n=e.ui_data();return this._data={properties:{frame:this._scene.frame||1,frame_range:this._scene.frame_range,frame_range_locked:this._scene.time_controller.frame_range_locked,master_camera_node_path:this._scene.cameras_controller.master_camera_node_path},root:t,ui:n},this._data},e.sanitize_string=function(e){return e=e.replace(/'/g,"'"),e=r.CoreString.escape_line_breaks(e)},e}();t.SceneJsonExporter=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t,n){this._name=e,this._input_names=t,this._dependencies=n}return e.prototype.name=function(){return this._name},e.prototype.input_names=function(){return this._input_names},e.prototype.dependencies=function(){return this._dependencies},e}();t.ShaderConfig=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){void 0===t&&(t={}),this._name=e,this._options=t}return e.prototype.name=function(){return this._name},e.prototype.default_from_attribute=function(){return this._options.default_from_attribute||!1},e.prototype.default=function(){return this._options.default},e.prototype.if_condition=function(){return this._options.if},e.prototype.prefix=function(){return this._options.prefix||""},e.prototype.suffix=function(){return this._options.suffix||""},e}();t.VariableConfig=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(660),o=function(){function e(){this._param_configs=[]}return e.prototype.reset=function(){this._param_configs=[]},e.prototype.push=function(e){this._param_configs.push(e)},e.prototype.create_and_push=function(e,t,n,o){var i=new r.ParamConfig(e,t,n,o);this._param_configs.push(i)},Object.defineProperty(e.prototype,"list",{get:function(){return this._param_configs},enumerable:!0,configurable:!0}),e}();t.ParamConfigsController=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(159),i=n(68),a=n(9),s=n(5);function _(e){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.color=s.ParamConfig.COLOR([1,1,1]),t.use_vertex_colors=s.ParamConfig.BOOLEAN(0),t.transparent=s.ParamConfig.BOOLEAN(0),t.opacity=s.ParamConfig.FLOAT(1),t.alpha_test=s.ParamConfig.FLOAT(0),t.use_fog=s.ParamConfig.BOOLEAN(0),t}return r.__extends(t,e),t}(e)}t.ColorParamConfig=_;var u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t}(a.Material),c=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}r.__extends(t,e)}(_(s.NodeParamsConfig)),function(e){function t(){return null!==e&&e.apply(this,arguments)||this}r.__extends(t,e),t.prototype.create_material=function(){return new u}}(i.TypedMatNode),function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.update=function(e){var t=e.material,n=e.pv;t.color.copy(n.color);var r=n.use_vertex_colors;r!=t.vertexColors&&(t.vertexColors=r,t.needsUpdate=!0),t.opacity=n.opacity,t.transparent=n.transparent||n.opacity<1,t.depthTest=!0,t.alphaTest=n.alpha_test,t.fog=n.use_fog},t}(o.BaseController));t.ColorsController=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(159),i=n(68),a=n(9),s=n(5);function _(e){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.transparent=s.ParamConfig.BOOLEAN(0),t.opacity=s.ParamConfig.FLOAT(1),t.alpha_test=s.ParamConfig.FLOAT(0),t.use_fog=s.ParamConfig.BOOLEAN(0),t}return r.__extends(t,e),t}(e)}t.ColorParamConfig=_;var u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t}(a.Material),c=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}r.__extends(t,e)}(_(s.NodeParamsConfig)),function(e){function t(){return null!==e&&e.apply(this,arguments)||this}r.__extends(t,e),t.prototype.create_material=function(){return new u}}(i.TypedMatNode),function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.update=function(e){var t=e.material,n=e.pv;t.uniforms.opacity&&(t.uniforms.opacity.value=n.opacity),t.transparent=n.transparent||n.opacity<1,t.depthTest=!0,t.alphaTest=n.alpha_test,t.fog=n.use_fog},t}(o.BaseController));t.ColorsController=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(68),i=n(27),a=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._children_controller_context=i.NodeContext.GL,t}return r.__extends(t,e),t.prototype.initialize_base_node=function(){var t;e.prototype.initialize_base_node.call(this),this.lifecycle.add_on_create_hook(this.assembler_controller.on_create.bind(this.assembler_controller)),null===(t=this.children_controller)||void 0===t||t.init()},t.prototype.create_material=function(){return this.assembler_controller.assembler.create_material()},Object.defineProperty(t.prototype,"assembler_controller",{get:function(){return this._assembler_controller=this._assembler_controller||this._create_assembler_controller()},enumerable:!0,configurable:!0}),t.prototype.create_node=function(t){return e.prototype.create_node.call(this,t)},t.prototype.children=function(){return e.prototype.children.call(this)},t.prototype.nodes_by_type=function(t){return e.prototype.nodes_by_type.call(this,t)},t.prototype.compile_if_required=function(){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(e){return this.assembler_controller.compile_required()&&this._compile(),[2]}))}))},t.prototype._compile=function(){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(e){switch(e.label){case 0:return this.material?[4,this.assembler_controller.assembler.compile_material(this.material)]:[3,3];case 1:return e.sent(),[4,this.assembler_controller.post_compile()];case 2:e.sent(),e.label=3;case 3:return[2]}}))}))},t}(o.TypedMatNode);t.TypedBuilderMatNode=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(275),i=n(5),a=n(83),s=n(94),_=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}r.__extends(t,e)}(a.TransformedParamConfig(i.NodeParamsConfig)),function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.flags=new s.FlagsControllerD(t),t.transform_controller=new a.TransformController(t),t}return r.__extends(t,e),t.prototype.initialize_base_node=function(){e.prototype.initialize_base_node.call(this),this.transform_controller.initialize_node()},t.prototype.cook=function(){this.transform_controller.update(),this.update_light_params(),this.update_shadow_params(),this.cook_controller.end_cook()},t}(o.TypedLightObjNode));t.BaseLightTransformedObjNode=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(22),i=n(56),a=n(5),s=n(69),_=n(94);function u(e){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.show_helper=a.ParamConfig.BOOLEAN(1),t.helper_size=a.ParamConfig.FLOAT(1,{visible_if:{show_helper:1}}),t}return r.__extends(t,e),t}(e)}t.BaseLightHelperParamConfig=u;!function(e){function t(){return null!==e&&e.apply(this,arguments)||this}r.__extends(t,e)}(u(a.NodeParamsConfig));var c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.flags=new _.FlagsControllerD(t),t}return r.__extends(t,e),t}(s.TypedObjNode);t.BaseLightHelperObjNode=c;var p=function(){function e(e,t){this.node=e,this._name=t,this._object=new o.Mesh,this._material=new i.MeshBasicMaterial({wireframe:!0,fog:!1})}return e.prototype.build=function(){this._object.name=this._name,this.build_helper()},Object.defineProperty(e.prototype,"object",{get:function(){return this._object},enumerable:!0,configurable:!0}),e}();t.BaseLightHelper=p},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t,n){this.node=e,this._helper_constructor=t,this._name=n}return e.prototype.initialize_node=function(){var e=this;this.node.flags.display.add_hook((function(){e.update_helper_attachment()}))},e.prototype.update_helper_attachment=function(){var e,t,n,r;this.node.flags.display.active?(r=null===(e=this.helper)||void 0===e?void 0:e.object)&&(this.node.object.add(r),null===(t=this._helper)||void 0===t||t.update()):(r=null===(n=this._helper)||void 0===n?void 0:n.object)&&this.node.object.remove(r)},Object.defineProperty(e.prototype,"helper",{get:function(){if(this.node.flags.display.active)return this._helper=this._helper||this._create_helper()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"visible",{get:function(){return this.node.flags.display.active&&this.node.pv.show_helper},enumerable:!0,configurable:!0}),e.prototype._create_helper=function(){var e=new this._helper_constructor(this.node,this._name);return e.build(),this.node.light.add(e.object),e},e.prototype.update=function(){this.visible?(this._helper||(this._helper=this._create_helper()),this._helper&&(this._helper.object.visible=!0,this._helper.update())):this._helper&&(this._helper.object.visible=!1)},e}();t.HelperController=r},,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(69),i=n(40),a=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}r.__extends(t,e)}(n(5).NodeParamsConfig),function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._attachable_to_hierarchy=!1,t}return r.__extends(t,e),t.prototype.create_object=function(){return new i.Group},t.prototype.cook=function(){this.cook_controller.end_cook()},t}(o.TypedObjNode));t.BaseManagerObjNode=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(5);t.LayerParamConfig=function(e){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.layer=o.ParamConfig.INTEGER(0,{range:[0,31],range_locked:[!0,!0]}),t}return r.__extends(t,e),t}(e)};var i=function(){function e(e){this.node=e}return e.prototype.update=function(){var e=this.node.object;e.layers.set(0),e.layers.enable(this.node.params.integer("layer"))},e}();t.LayersController=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(410),i=n(0),a=n(3),s=r.__importDefault(n(81)),_=n(1013),u=n(814),c=n(27),p=n(66);function l(e){var t;return{node_selection:{context:c.NodeContext.POST},visible_if:(t={do_post_process:1},t["use_post_process_node"+e]=1,t)}}var d=n(5);t.CameraPostProcessParamConfig=function(e){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.post_process=d.ParamConfig.FOLDER(),t.do_post_process=d.ParamConfig.BOOLEAN(0),t.use_post_process_node0=d.ParamConfig.BOOLEAN(0,{visible_if:{do_post_process:1}}),t.post_process_node0=d.ParamConfig.OPERATOR_PATH("",l(0)),t.use_post_process_node1=d.ParamConfig.BOOLEAN(0,{visible_if:{do_post_process:1}}),t.post_process_node1=d.ParamConfig.OPERATOR_PATH("",l(1)),t.use_post_process_node2=d.ParamConfig.BOOLEAN(0,{visible_if:{do_post_process:1}}),t.post_process_node2=d.ParamConfig.OPERATOR_PATH("",l(2)),t.use_post_process_node3=d.ParamConfig.BOOLEAN(0,{visible_if:{do_post_process:1}}),t.post_process_node3=d.ParamConfig.OPERATOR_PATH("",l(3)),t}return r.__extends(t,e),t}(e)};var f=function(){function e(e){this.node=e,this._renderers_by_canvas_id={},this._composers_by_canvas_id={},this._resolution_by_canvas_id={},this._composers_set_in_progress_by_canvas_id={},this._fetch_post_process_nodes_in_progress=!1,this._post_process_nodes=[],this._post_process_use_node_path_params=[],this._post_process_node_path_params=[]}return e.prototype.render=function(e,t,n){var r=this.renderer(e);if(r)if(this.node.pv.do_post_process){var o=this.composer(e);o&&(o.setSize(t.x,t.y),o.render())}else this.node.setup_for_aspect_ratio(n),r.render(this.node.scene.default_scene,this.node.object)},e.prototype.renderer=function(e){return this._renderers_by_canvas_id[e.id]},e.prototype.create_renderer=function(e,t){var n=p.POLY.renderers_controller.rendering_context(e),r=new o.WebGLRenderer({canvas:e,antialias:!0,alpha:!0,context:n});return r.shadowMap.enabled=!0,r.physicallyCorrectLights=!0,r.toneMapping=i.ACESFilmicToneMapping,r.toneMappingExposure=1,r.outputEncoding=i.sRGBEncoding,p.POLY.renderers_controller.register_renderer(r),this._renderers_by_canvas_id[e.id]=r,this.set_renderer_size(e,t),r.setPixelRatio(window.devicePixelRatio),r},e.prototype.delete_renderer=function(e){var t=this.renderer(e);t&&p.POLY.renderers_controller.deregister_renderer(t)},e.prototype.set_renderer_size=function(e,t){this._resolution_by_canvas_id[e.id]=this._resolution_by_canvas_id[e.id]||new a.Vector2,this._resolution_by_canvas_id[e.id].copy(t);var n=this.renderer(e);n&&n.setSize(t.x,t.y);var r=this.composer(e);r&&r.setSize(t.x,t.y)},e.prototype.composer=function(e){return this._composers_by_canvas_id[e.id]=this._composers_by_canvas_id[e.id]||this._create_composer(e)},e.prototype._create_composer=function(e){var t=this.renderer(e);if(t){var n=new _.EffectComposer(t);return n.setPixelRatio(2*window.devicePixelRatio),this.set_composer_passes(e.id,n,t),n}},e.prototype.update_composer_passes=function(){return r.__awaiter(this,void 0,void 0,(function(){var e,t,n,o,i,a;return r.__generator(this,(function(r){switch(r.label){case 0:if(!this.node.pv.do_post_process)return[3,6];if(this._post_process_nodes=[],this._fetch_post_process_nodes_in_progress)return[2];if(this._fetch_post_process_nodes_in_progress=!0,!this.composer_passes_nodes_changed())return[3,5];this._post_process_nodes=[],e=0,t=s.default(4),r.label=1;case 1:return e<t.length?(n=t[e],o=this._post_process_use_node_path_params[n],o.value?(i=this._post_process_node_path_params[n],(a=i.found_node())?[4,a.request_container()]:[3,3]):[3,3]):[3,4];case 2:r.sent(),this._post_process_nodes.push(a),r.label=3;case 3:return e++,[3,1];case 4:this.set_composers_passes(),r.label=5;case 5:return this._fetch_post_process_nodes_in_progress=!1,[3,7];case 6:this._post_process_nodes=[],r.label=7;case 7:return[2]}}))}))},e.prototype.set_composers_passes=function(){for(var e=0,t=Object.keys(this._composers_by_canvas_id);e<t.length;e++){var n=t[e],r=this._composers_by_canvas_id[n],o=this._renderers_by_canvas_id[n];r&&this.set_composer_passes(n,r,o)}},e.prototype.set_composer_passes=function(e,t,n){if(!this._composers_set_in_progress_by_canvas_id[e]){this._composers_set_in_progress_by_canvas_id[e]=!0,this.clear_render_passes(t);var r=new u.RenderPass(this.node.scene.default_scene,this.node.object);r.clearAlpha=0,t.addPass(r);for(var o=0,i=this._post_process_nodes;o<i.length;o++){i[o].apply_to_composer(t,this.node.object,this._resolution_by_canvas_id[e],this.node)}delete this._composers_set_in_progress_by_canvas_id[e]}},e.prototype.clear_render_passes=function(e){for(var t;t=e.passes.pop();)if(t){var n=t;if("function"==typeof n.dispose)try{n.dispose()}catch(e){console.warn(e)}}e.passes=[]},e.prototype.composer_passes_nodes_changed=function(){return!0},e}();t.PostProcessController=f},,,,,,,,,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this._param=e}return e.prototype.process_data=function(e){var t=e.raw_input;void 0!==t&&this._param.set(t),this.add_main(e)},e.prototype.add_main=function(e){},e}();t.ParamJsonImporter=r},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(90),i=n(620),a=n(27),s=n(113),_=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.container_controller=new s.TypedContainerController(t,i.EventContainer),t._eval_all_params_on_dirty_bound=t._eval_all_params_on_dirty.bind(t),t}return r.__extends(t,e),t.node_context=function(){return a.NodeContext.EVENT},t.prototype.initialize_base_node=function(){this.io.connections.init_inputs(),this.ui_data.set_layout_horizontal(),this.add_post_dirty_hook("_eval_all_params_on_dirty",this._eval_all_params_on_dirty_bound)},t.prototype._eval_all_params_on_dirty=function(){this.params.eval_all()},t.prototype.process_event=function(e,t,n){},t}(o.TypedNode);t.TypedEventNode=_;var u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t}(_);t.BaseEventNodeClass=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2).__importDefault(n(155)),o=n(67),i=n(61),a=function(){function e(e){this.node=e,this._graph_node=new o.CoreGraphNode(e.scene,"node_name_controller")}return Object.defineProperty(e.prototype,"graph_node",{get:function(){return this._graph_node},enumerable:!0,configurable:!0}),e.base_name=function(e){var t=e.type,n=t[t.length-1];return r.default(parseInt(n))||(t+="_"),t+"1"},e.prototype.request_name_to_parent=function(e){var t=this.node.parent;t&&t.children_allowed()&&t.children_controller?t.children_controller.set_child_name(this.node,e):console.warn("request_name_to_parent failed, no parent found")},e.prototype.set_name=function(e){e!=this.node.name&&this.request_name_to_parent(e)},e.prototype.update_name_from_parent=function(e){var t;this.node._set_core_name(e),this.post_set_name(),this.post_set_full_path(),this.node.children_allowed()&&(null===(t=this.node.children_controller)||void 0===t||t.children().forEach((function(e){e.name_controller.post_set_full_path()}))),this.node.lifecycle.creation_completed&&(this.node.scene.missing_expression_references_controller.check_for_missing_references(this.node),this.node.scene.expressions_controller.regenerate_referring_expressions(this.node)),this.node.emit(i.NodeEvent.NAME_UPDATED)},e.prototype.add_post_set_name_hook=function(e){this._on_set_name_hooks=this._on_set_name_hooks||[],this._on_set_name_hooks.push(e)},e.prototype.add_post_set_full_path_hook=function(e){this._on_set_full_path_hooks=this._on_set_full_path_hooks||[],this._on_set_full_path_hooks.push(e)},e.prototype.post_set_name=function(){if(this._on_set_name_hooks)for(var e=0,t=this._on_set_name_hooks;e<t.length;e++){(0,t[e])()}},e.prototype.post_set_full_path=function(){if(this._on_set_full_path_hooks)for(var e=0,t=this._on_set_full_path_hooks;e<t.length;e++){(0,t[e])()}},e}();t.NameController=a},,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=r.__importDefault(n(92)),i=r.__importDefault(n(190)),a=r.__importDefault(n(347)),s=n(24),_=n(103),u=n(67);!function(e){e.TYPESCRIPT="typescript"}(t.StringParamLanguage||(t.StringParamLanguage={}));var c=function(){function e(e){this._param=e,this._programatic_visible_state=!0,this._update_visibility_and_remove_dirty_bound=this.update_visibility_and_remove_dirty.bind(this),this._ui_data_dependency_set=!1}return e.prototype.set=function(e){this._default_options=e,this._options=i.default(this._default_options)},e.prototype.copy=function(e){this._default_options=i.default(e.default),this._options=i.default(e.current)},e.prototype.set_option=function(e,t){return Object.assign(this._options,e,t)},Object.defineProperty(e.prototype,"param",{get:function(){return this._param},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"node",{get:function(){return this._param.node},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"default",{get:function(){return this._default_options},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"current",{get:function(){return this._options},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"has_options_overridden",{get:function(){return!a.default(this._options,this._default_options)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"overridden_options",{get:function(){for(var e={},t=0,n=Object.keys(this._options);t<n.length;t++){var r=n[t];a.default(this._options[r],this._default_options[r])||Object.assign(e,r,i.default(this._options[r]))}return e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"overridden_option_names",{get:function(){return Object.keys(this.overridden_options)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"always_reference_asset",{get:function(){return this._options.always_reference_asset||!1},enumerable:!0,configurable:!0}),e.prototype.has_callback=function(){return null!=this._options.callback||null!=this._options.callback_string},e.prototype.execute_callback=function(){if(this.node&&this.node.scene.loading_controller.loaded){var e=this.get_callback();null!=e&&this.node&&!this.node.cook_controller.is_cooking&&e(this.node,this.param)}},e.prototype.get_callback=function(){if(this.has_callback())return this._options.callback=this._options.callback||this.create_callback_from_string()},e.prototype.create_callback_from_string=function(){var e=this,t=this._options.callback_string;if(t){var n=new Function("node","scene","window","location",t);return function(){n(e.node,e.node.scene,null,null)}}},e.prototype.makes_node_dirty_when_dirty=function(){var e;if(null!=this.param.parent_param)return!1;var t=!0;return null!=(e=this._options.cook)&&(t=e),t},Object.defineProperty(e.prototype,"desktop_browse_option",{get:function(){return this._options.desktop_browse},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"desktop_browse_allowed",{get:function(){return null!=this.desktop_browse_option},enumerable:!0,configurable:!0}),e.prototype.desktop_browse_file_type=function(){return this.desktop_browse_option?this.desktop_browse_option.file_type:null},Object.defineProperty(e.prototype,"is_expression_for_entities",{get:function(){var e=this._options.expression;return e&&e.for_entities||!1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"level",{get:function(){return this._options.level||0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"has_menu",{get:function(){return null!=this.menu_options},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"menu_options",{get:function(){return this._options.menu},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"menu_entries",{get:function(){return this.menu_options?this.menu_options.entries:[]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"has_menu_radio",{get:function(){return this.has_menu},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"is_multiline",{get:function(){return!0===this._options.multiline},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"language",{get:function(){return this._options.language},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"is_code",{get:function(){return null!=this.language},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"node_selection_options",{get:function(){return this._options.node_selection},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"node_selection_context",{get:function(){if(this.node_selection_options)return this.node_selection_options.context},enumerable:!0,configurable:!0}),e.prototype.dependent_on_found_node=function(){return!("dependent_on_found_node"in this._options)||this._options.dependent_on_found_node},Object.defineProperty(e.prototype,"range",{get:function(){return this._options.range||[0,1]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"step",{get:function(){return this._options.step||.01},enumerable:!0,configurable:!0}),e.prototype.range_locked=function(){return this._options.range_locked||[!1,!1]},e.prototype.ensure_in_range=function(e){var t=this.range;return e>=t[0]&&e<=t[1]?e:e<t[0]?!0===this.range_locked()[0]?t[0]:e:!0===this.range_locked()[1]?t[1]:e},Object.defineProperty(e.prototype,"is_spare",{get:function(){return this._options.spare||!1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"texture_options",{get:function(){return this._options.texture},enumerable:!0,configurable:!0}),e.prototype.texture_as_env=function(){var e=this.texture_options;return null!=e&&!0===e.env},Object.defineProperty(e.prototype,"is_hidden",{get:function(){return!0===this._options.hidden||!1===this._programatic_visible_state},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"is_visible",{get:function(){return!this.is_hidden},enumerable:!0,configurable:!0}),e.prototype.set_visible_state=function(e){this._options.hidden=!e,this.param.emit(_.ParamEvent.VISIBLE_UPDATED)},Object.defineProperty(e.prototype,"is_label_hidden",{get:function(){var e=this.param.type;return!1===this._options.label||e===s.ParamType.BUTTON||e===s.ParamType.SEPARATOR||e===s.ParamType.BOOLEAN&&this.is_field_hidden()},enumerable:!0,configurable:!0}),e.prototype.is_field_hidden=function(){return!1===this._options.field},e.prototype.ui_data_depends_on_other_params=function(){return"visible_if"in this._options},e.prototype.visibility_predecessors=function(){var e=this,t=Object.keys(this._options.visible_if||{}),n=this.param.node;return o.default(t.map((function(t){var r=n.params.get(t);if(r)return r;console.error("param "+t+" not found as visibility condition for "+e.param.name+" in node "+e.param.node.type)})))},e.prototype.set_ui_data_dependency=function(){if(!this._ui_data_dependency_set){this._ui_data_dependency_set=!0;var e=this.visibility_predecessors();if(e.length>0){this._visibility_graph_node=new u.CoreGraphNode(this.param.scene,"param_visibility");for(var t=0,n=e;t<n.length;t++){var r=n[t];this._visibility_graph_node.add_graph_input(r)}this._visibility_graph_node.add_post_dirty_hook("_update_visibility_and_remove_dirty",this._update_visibility_and_remove_dirty_bound)}}},e.prototype.update_visibility_and_remove_dirty=function(){this.update_visibility(),this.param.remove_dirty_state()},e.prototype.update_visibility=function(){return r.__awaiter(this,void 0,void 0,(function(){var e,t,n,o,i,a,s,u;return r.__generator(this,(function(r){switch(r.label){case 0:return(e=this._options.visible_if)?(t=this.visibility_predecessors(),n=t.map((function(e){return e.compute()})),this._programatic_visible_state=!0,[4,Promise.all(n)]):[3,2];case 1:for(r.sent(),o=0,i=t;o<i.length;o++)a=i[o],s=e[a.name],u=a.value,s!=u&&(this._programatic_visible_state=!1);this.param.emit(_.ParamEvent.VISIBLE_UPDATED),r.label=2;case 2:return[2]}}))}))},e}();t.OptionsController=c},,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2).__importDefault(n(45));t.VARIABLE_PREFIX="$";var o=function(){function e(e){this.param=e,this._set_error_from_error_bound=this._set_error_from_error.bind(this)}return e.prototype.clear_error=function(){this._error_message=void 0},e.prototype.set_error=function(e){this._error_message=this._error_message||e},e.prototype._set_error_from_error=function(e){r.default(e)?this._error_message=e:this._error_message=e.message},Object.defineProperty(e.prototype,"is_errored",{get:function(){return null!=this._error_message},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"error_message",{get:function(){return this._error_message},enumerable:!0,configurable:!0}),e.prototype.reset=function(){this._error_message=void 0},e.prototype.traverse_node=function(e){var t="traverse_"+e.type;if(this[t])return this[t](e);this.set_error("expression unknown node type: "+e.type)},e.prototype.traverse_BinaryExpression=function(e){return this.traverse_node(e.left)+" "+e.operator+" "+this.traverse_node(e.right)},e.prototype.traverse_LogicalExpression=function(e){return this.traverse_node(e.left)+" "+e.operator+" "+this.traverse_node(e.right)},e.prototype.traverse_MemberExpression=function(e){return this.traverse_node(e.object)+"."+this.traverse_node(e.property)},e.prototype.traverse_ConditionalExpression=function(e){return"("+this.traverse_node(e.test)+") ? ("+this.traverse_node(e.consequent)+") : ("+this.traverse_node(e.alternate)+")"},e.prototype.traverse_Compound=function(e){for(var n=e.body,r=[],o=0;o<n.length;o++){var i=n[o];"Identifier"==i.type?i.name[0]==t.VARIABLE_PREFIX?r.push("`${"+this.traverse_node(i)+"}`"):r.push("'"+i.name+"'"):r.push("`${"+this.traverse_node(i)+"}`")}return r.join(" + ")},e.prototype.traverse_Literal=function(e){return""+e.raw},e}();t.BaseTraverser=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2);t.AsyncFunction=Object.getPrototypeOf((function(){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(e){return[2]}))}))})).constructor},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=r.__importDefault(n(45)),i=n(93),a=n(351),s=n(24),_=n(350),u=n(103),c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.type=function(){return s.ParamType.STRING},Object.defineProperty(t.prototype,"default_value_serialized",{get:function(){return this.default_value},enumerable:!0,configurable:!0}),t.prototype._clone_raw_input=function(e){return""+e},Object.defineProperty(t.prototype,"raw_input_serialized",{get:function(){return""+this._raw_input},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"value_serialized",{get:function(){return""+this.value},enumerable:!0,configurable:!0}),t.are_raw_input_equal=function(e,t){return e==t},t.are_values_equal=function(e,t){return e==t},Object.defineProperty(t.prototype,"is_default",{get:function(){return this._raw_input==this.default_value},enumerable:!0,configurable:!0}),t.prototype.convert=function(e){return o.default(e)?e:""+e},Object.defineProperty(t.prototype,"raw_input",{get:function(){return this._raw_input},enumerable:!0,configurable:!0}),t.prototype.process_raw_input=function(){this.states.error.clear(),this._value_elements(this._raw_input).length>=3?(this._expression_controller=this._expression_controller||new _.ExpressionController(this),this._raw_input!=this._expression_controller.expression&&(this._expression_controller.set_expression(this._raw_input),this.set_dirty(),this.emit_controller.emit(u.ParamEvent.EXPRESSION_UPDATED))):this._raw_input!=this._value&&(this._value=this._raw_input,this.remove_dirty_state(),this.set_successors_dirty(this),this.emit_controller.emit(u.ParamEvent.VALUE_UPDATED),this._expression_controller&&(this._expression_controller.set_expression(void 0,!1),this.emit_controller.emit(u.ParamEvent.EXPRESSION_UPDATED)))},t.prototype.process_computation=function(){var e;return r.__awaiter(this,void 0,void 0,(function(){var t,n;return r.__generator(this,(function(r){switch(r.label){case 0:return null===(e=this.expression_controller)||void 0===e||!e.active||this.expression_controller.requires_entities?[3,2]:[4,this.expression_controller.compute_expression()];case 1:t=r.sent(),this.expression_controller.is_errored?this.states.error.set("expression error: "+this.expression_controller.error_message):(null!=(n=this.convert(t))?(this._value=n,this.emit_controller.emit(u.ParamEvent.VALUE_UPDATED)):this.states.error.set("expression returns an invalid type ("+t+")"),this.remove_dirty_state()),r.label=2;case 2:return[2]}}))}))},t.prototype._value_elements=function(e){return a.ParsedTree.string_value_elements(e)},t}(i.TypedParam);t.StringParam=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=r.__importDefault(n(188)),i=n(34),a=n(16),s=n(24),_=n(134);t.ConnectionPointTypesAvailableForAttribute=[a.ConnectionPointType.FLOAT,a.ConnectionPointType.VEC2,a.ConnectionPointType.VEC3,a.ConnectionPointType.VEC4];var u=n(5),c=new(function(e){function n(){var n=null!==e&&e.apply(this,arguments)||this;return n.name=u.ParamConfig.STRING(""),n.type=u.ParamConfig.INTEGER(0,{menu:{entries:t.ConnectionPointTypesAvailableForAttribute.map((function(e,t){return{name:e,value:t}}))}}),n}return r.__extends(n,e),n}(u.NodeParamsConfig)),p=function(e){function n(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=c,t._on_create_set_name_if_none_bound=t._on_create_set_name_if_none.bind(t),t.gl_connections_controller=new _.GlConnectionsController(t),t}return r.__extends(n,e),n.type=function(){return"attribute"},n.prototype.initialize_node=function(){var e=this;this.add_post_dirty_hook("_set_mat_to_recompile",this._set_mat_to_recompile_if_is_exporting.bind(this)),this.lifecycle.add_on_create_hook(this._on_create_set_name_if_none_bound),this.gl_connections_controller.initialize_node(),this.gl_connections_controller.set_expected_input_types_function((function(){return[]})),this.gl_connections_controller.set_expected_output_types_function((function(){return[t.ConnectionPointTypesAvailableForAttribute[e.pv.type]]}))},n.prototype.create_params=function(){var e;(null===(e=this.material_node)||void 0===e?void 0:e.assembler_controller.allow_attribute_exports())&&this.add_param(s.ParamType.BOOLEAN,"export_when_connected",0)},Object.defineProperty(n.prototype,"input_name",{get:function(){return n.INPUT_NAME},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"output_name",{get:function(){return n.OUTPUT_NAME},enumerable:!0,configurable:!0}),n.prototype.set_lines=function(e){var t;null===(t=this.material_node)||void 0===t||t.assembler_controller.assembler.set_node_lines_attribute(this,e)},Object.defineProperty(n.prototype,"attribute_name",{get:function(){return o.default(this.pv.name)},enumerable:!0,configurable:!0}),n.prototype.gl_type=function(){return this.io.outputs.named_output_connection_points[0].type},n.prototype.connected_input_node=function(){return this.io.inputs.named_input(n.INPUT_NAME)},n.prototype.connected_input_connection_point=function(){return this.io.inputs.named_input_connection_point(n.INPUT_NAME)},n.prototype.output_connection_point=function(){return this.io.outputs.named_output_connection_points_by_name(this.input_name)},Object.defineProperty(n.prototype,"is_importing",{get:function(){return this.io.outputs.used_output_names().length>0},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"is_exporting",{get:function(){return!!this.pv.export_when_connected&&null!=this.io.inputs.named_input(n.INPUT_NAME)},enumerable:!0,configurable:!0}),n.prototype._set_mat_to_recompile_if_is_exporting=function(){this.is_exporting&&this._set_mat_to_recompile()},n.prototype._on_create_set_name_if_none=function(){""==this.pv.name&&this.p.name.set(this.name)},n.INPUT_NAME="export",n.OUTPUT_NAME="val",n}(i.TypedGlNode);t.AttributeGlNode=p},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(653),o=n(157),i=n(654),a=n(655),s=n(656),_=n(657),u=n(191),c=n(355),p=n(265),l=n(128),d=function(){function e(){}return e.dispatch_node=function(e){return new r.NodeJsonExporter(e)},e.dispatch_param=function(e){return e instanceof u.TypedNumericParam?new i.ParamNumericJsonExporter(e):e instanceof c.OperatorPathParam?new a.ParamOperatorPathJsonExporter(e):e instanceof p.StringParam?new s.ParamStringJsonExporter(e):e instanceof l.RampParam?new _.ParamRampJsonExporter(e):new o.ParamJsonExporter(e)},e}();t.JsonExportDispatcher=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.FUNCTION_DECLARATION="function_declaration",e.DEFINE="define",e.BODY="body"}(t.LineType||(t.LineType={}))},,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){}return e.find_output_nodes=function(e){return e.nodes_by_type("output")},e.find_attribute_export_nodes=function(e){return e.nodes_by_type("attribute").filter((function(e){return e.is_exporting}))},e}();t.GlNodeFinder=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(677),i=n(366),a=n(5),s=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.allow_pan=a.ParamConfig.BOOLEAN(1),t.allow_rotate=a.ParamConfig.BOOLEAN(1),t.allow_zoom=a.ParamConfig.BOOLEAN(1),t.tdamping=a.ParamConfig.BOOLEAN(1),t.damping=a.ParamConfig.FLOAT(.1,{visible_if:{tdamping:!0}}),t.screen_space_panning=a.ParamConfig.BOOLEAN(1),t.rotate_speed=a.ParamConfig.FLOAT(.5),t.min_distance=a.ParamConfig.FLOAT(1,{range:[0,100],range_locked:[!0,!1]}),t.max_distance=a.ParamConfig.FLOAT(50,{range:[0,100],range_locked:[!0,!1]}),t.polar_angle_range=a.ParamConfig.VECTOR2([0,"$PI"]),t}return r.__extends(t,e),t}(a.NodeParamsConfig)),_=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=s,t}return r.__extends(t,e),t.type=function(){return"camera_orbit_controls"},t.prototype.create_controls_instance=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(n){return[2,new i.OrbitControls(e,t)]}))}))},t.prototype.setup_controls=function(e){e.enablePan=this.pv.allow_pan,e.enableRotate=this.pv.allow_rotate,e.enableZoom=this.pv.allow_zoom,e.enableDamping=this.pv.tdamping,e.dampingFactor=this.pv.damping,e.rotateSpeed=this.pv.rotate_speed,e.screenSpacePanning=this.pv.screen_space_panning,e.minDistance=this.pv.min_distance,e.maxDistance=this.pv.max_distance,e.minPolarAngle=this.pv.polar_angle_range.x,e.maxPolarAngle=this.pv.polar_angle_range.y,e.enableKeys=!1},t.prototype.set_from_camera_node=function(e,t){var n=t.params.vector3("target");e.target.copy(n)},t}(o.TypedCameraControlsEventNode);t.CameraOrbitControlsEventNode=_},,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(159),i=n(135),a=n(5),s=n(27);t.TextureMapParamConfig=function(e){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.use_map=a.ParamConfig.BOOLEAN(0),t.map=a.ParamConfig.OPERATOR_PATH(i.FileCopNode.DEFAULT_NODE_PATH.UV,{visible_if:{use_map:1}}),t}return r.__extends(t,e),t}(e)},t.BooleanParamOptions=function(e){return{cook:!1,callback:function(t,n){e.update(t)}}},t.OperatorPathOptions=function(e,t){var n;return{visible_if:(n={},n[t]=1,n),node_selection:{context:s.NodeContext.COP},cook:!1,callback:function(t,n){e.update(t)}}};var _=function(e){function t(t,n){var r=e.call(this,t)||this;return r.node=t,r._update_options=n,null==r._update_options.define&&(r._update_options.define=!0),r}return r.__extends(t,e),t.prototype.add_hooks=function(e,t){var n=this;e.add_post_dirty_hook("TextureController",(function(){n.update()})),t.add_post_dirty_hook("TextureController",(function(){n.update()}))},t.update=function(e){},t.prototype._update=function(e,t,n,o){return r.__awaiter(this,void 0,void 0,(function(){var i,a,s;return r.__generator(this,(function(r){switch(r.label){case 0:return this._update_options.uniforms?(i=e,s=t,[4,this._update_texture_on_uniforms(i,s,n,o)]):[3,2];case 1:r.sent(),r.label=2;case 2:return this._update_options.direct_params?(a=e,s=t,[4,this._update_texture_on_material(a,s,n,o)]):[3,4];case 3:r.sent(),r.label=4;case 4:return[2]}}))}))},t.prototype._update_texture_on_uniforms=function(e,t,n,o){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(r){return this._update_required_attribute(e,e.uniforms,t,n,o,this._apply_texture_on_uniforms.bind(this),this._remove_texture_from_uniforms.bind(this)),[2]}))}))},t.prototype._apply_texture_on_uniforms=function(e,t,n,r){var o=null!=t[n]&&null!=t[n].value,i=!1;o&&(t[n].value.uuid!=r.uuid&&(i=!0));if(!o||i){if(t[n].value=r,this._do_update_define()){var a=this._define_name(""+n);e.defines[a]=1}e.defines.USE_UV=1,e.needsUpdate=!0}},t.prototype._remove_texture_from_uniforms=function(e,t,n){if(t[n].value){if(t[n].value=null,this._do_update_define()){var r=this._define_name(""+n);delete e.defines[r]}e.needsUpdate=!0}},t.prototype._define_name=function(e){return"USE_"+e.replace("_","").toUpperCase()},t.prototype._update_texture_on_material=function(e,t,n,o){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(r){return this._update_required_attribute(e,e,t,n,o,this._apply_texture_on_material.bind(this),this._remove_texture_from_material.bind(this)),[2]}))}))},t.prototype._apply_texture_on_material=function(e,t,n,r){var o=null!=t[n],i=!1;o&&(t[n].uuid!=r.uuid&&(i=!0));o&&!i||(t[n]=r,e.needsUpdate=!0)},t.prototype._remove_texture_from_material=function(e,t,n){t[n]&&(t[n]=null,e.needsUpdate=!0)},t.prototype._update_required_attribute=function(e,t,n,o,i,a,_){return r.__awaiter(this,void 0,void 0,(function(){var u,c,p;return r.__generator(this,(function(r){switch(r.label){case 0:return o.is_dirty?[4,o.compute()]:[3,2];case 1:r.sent(),r.label=2;case 2:return o.value?i.is_dirty?[4,i.compute()]:[3,4]:[3,9];case 3:r.sent(),r.label=4;case 4:return(u=i.found_node())?u.node_context()!=s.NodeContext.COP?[3,6]:[4,u.request_container()]:[3,8];case 5:return c=r.sent(),(p=c.texture())?(a(e,t,n,p),[2]):(this.node.states.error.set("found node has no texture"),[3,7]);case 6:this.node.states.error.set("found map node is not a COP node"),r.label=7;case 7:return[3,9];case 8:this.node.states.error.set("could not find map node "+i.name+" with path "+i.value),r.label=9;case 9:return _(e,t,n),[2]}}))}))},t.prototype._do_update_define=function(){return null==this._update_options.define||this._update_options.define},t}(o.BaseController);t.BaseTextureMapController=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(106),i=n(769),a=n(770),s=n(771),_=new Map([]);_.set(o.CustomMaterialName.DISTANCE,i.ShaderAssemblerCustomMeshDistance),_.set(o.CustomMaterialName.DEPTH,a.ShaderAssemblerCustomMeshDepth),_.set(o.CustomMaterialName.DEPTH_DOF,s.ShaderAssemblerCustomMeshDepthDOF);var u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.custom_assembler_class_by_custom_name=function(){return _},t}(o.ShaderAssemblerMaterial);t.ShaderAssemblerMesh=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(69),i=n(7),a=n(94),s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.flags=new a.FlagsControllerD(t),t.render_order=o.ObjNodeRenderOrder.LIGHT,t._color_with_intensity=new i.Color(0),t._used_in_scene=!0,t._cook_main_without_inputs_when_dirty_bound=t._cook_main_without_inputs_when_dirty.bind(t),t}return r.__extends(t,e),Object.defineProperty(t.prototype,"light",{get:function(){return this._light},enumerable:!0,configurable:!0}),t.prototype.initialize_base_node=function(){var t=this;e.prototype.initialize_base_node.call(this),this._light=this.create_light(),this.object.add(this._light),this.flags.display.add_hook((function(){t.update_light_attachment()})),this.dirty_controller.add_post_dirty_hook("_cook_main_without_inputs_when_dirty",this._cook_main_without_inputs_when_dirty_bound)},t.prototype._cook_main_without_inputs_when_dirty=function(){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(e){switch(e.label){case 0:return[4,this.cook_controller.cook_main_without_inputs()];case 1:return e.sent(),[2]}}))}))},t.prototype.update_light_attachment=function(){this.flags.display.active?(this.object.add(this.light),this._cook_main_without_inputs_when_dirty()):this.object.remove(this.light)},t.prototype.create_shadow_params_main=function(){if(null!=this._light.shadow)return this.create_shadow_params()},t.prototype.create_light_params=function(){},t.prototype.update_light_params=function(){},t.prototype.create_shadow_params=function(){},t.prototype.cook=function(){this.update_light_params(),this.update_shadow_params(),this.cook_controller.end_cook()},t.prototype.update_shadow_params=function(){},Object.defineProperty(t.prototype,"color_with_intensity",{get:function(){var e=this.params.color("color"),t=this.params.float("intensity");return this._color_with_intensity.copy(e).multiplyScalar(t),this._color_with_intensity},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"active",{get:function(){return this.flags.display.active},enumerable:!0,configurable:!0}),t}(o.TypedObjNode);t.TypedLightObjNode=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(1),i=n(3),a=n(7),s=n(53),_=n(114),u=n(35),c=n(162),p=n(49),l=r.__importDefault(n(190)),d=r.__importDefault(n(45)),f=r.__importDefault(n(21)),h=r.__importDefault(n(44)),m=n(381),y=function(e){function t(t,n){var r=e.call(this,n)||this;return r._object=t,null==r._object.userData.attributes&&(r._object.userData.attributes={}),r}return r.__extends(t,e),t.prototype.object=function(){return this._object},t.prototype.geometry=function(){return this._object.geometry},t.prototype.core_geometry=function(){var e=this.geometry();return new s.CoreGeometry(e)},t.prototype.points=function(){return this.core_geometry().points()},t.prototype.points_from_group=function(e){if(e){var t=p.CoreString.indices(e);if(t){var n=this.points();return t.map((function(e){return n[e]}))}return[]}return this.points()},t.prototype.compute_vertex_normals=function(){this.core_geometry().compute_vertex_normals()},t.prototype.add_attribute=function(e,t){var n;n=h.default(t)||f.default(t)||d.default(t)?t:t.toArray(),this._object.userData.attributes[e]=n},t.prototype.add_numeric_attrib=function(e,t){this.add_attribute(e,t)},t.prototype.set_attrib_value=function(e,t){this.add_attribute(e,t)},t.prototype.add_numeric_vertex_attrib=function(e,t,n){null==n&&(n=_.CoreAttribute.default_value(t)),this.core_geometry().add_numeric_attrib(e,t,n)},t.prototype.attribute_names=function(){return Object.keys(this._object.userData.attributes)},t.prototype.attrib_names=function(){return this.attribute_names()},t.prototype.has_attrib=function(e){return this.attribute_names().includes(e)},t.prototype.rename_attribute=function(e,t){this.add_attribute(t,this.attrib_value(e)),this.delete_attribute(e)},t.prototype.delete_attribute=function(e){delete this._object.userData.attributes[e]},t.prototype.attrib_value=function(e){if("ptnum"===e)return this.index;var t=this._object.userData.attributes[e];return null==t&&"name"==e&&(t=this._object.name),t},t.prototype.name=function(){return this.attrib_value("name")},t.prototype.human_type=function(){return u.CoreConstant.CONSTRUCTOR_NAMES_BY_CONSTRUCTOR_NAME[this._object.constructor.name]},t.prototype.attrib_type=function(e){var t=this.attrib_value(e);return d.default(t)?u.CoreConstant.ATTRIB_TYPE.STRING:u.CoreConstant.ATTRIB_TYPE.NUMERIC},t.prototype.attrib_size=function(e){var t=this.attrib_value(e);if(null==t)return 0;if(d.default(t)||h.default(t))return 1;switch(t.constructor){case i.Vector2:return 2;case o.Vector3:return 3;default:return 0}},t.prototype.clone=function(){return t.clone(this._object)},t.clone=function(e){var n=e.clone(),r=new Map,o=new Map;return t.parallelTraverse(e,n,(function(e,t){r.set(t,e),o.set(e,t)})),n.traverse((function(t){var n=r.get(t),i=t;if(i.geometry){var _=n.geometry;i.geometry=s.CoreGeometry.clone(_);var u=i.geometry;u.userData&&(u.userData=l.default(_.userData))}if(i.material){i.material=n.material,c.CoreMaterial.apply_custom_materials(t,i.material);var p=i.material;null==p.color&&(p.color=new a.Color(1,1,1))}e.userData&&(t.userData=l.default(n.userData));var d=n;d.animations&&(t.animations=d.animations.map((function(e){return e.clone()})));var f=t;if(f.isSkinnedMesh){var h=f,m=n,y=m.skeleton.bones;h.skeleton=m.skeleton.clone(),h.bindMatrix.copy(m.bindMatrix);var v=y.map((function(e){return o.get(e)}));h.skeleton.bones=v,h.bind(h.skeleton,h.bindMatrix)}})),n},t.parallelTraverse=function(e,t,n){n(e,t);for(var r=0;r<e.children.length;r++)this.parallelTraverse(e.children[r],t.children[r],n)},t}(m.CoreEntity);t.CoreObject=y},function(e,t,n){"use strict";n.r(t),n.d(t,"BufferGeometryUtils",(function(){return c}));var r=n(4),o=n(6),i=n(141),a=n(97),s=n(0),_=n(3),u=n(1),c={computeTangents:function(e){var t=e.index,n=e.attributes;if(null!==t&&void 0!==n.position&&void 0!==n.normal&&void 0!==n.uv){var o=t.array,i=n.position.array,a=n.normal.array,s=n.uv.array,c=i.length/3;void 0===n.tangent&&e.setAttribute("tangent",new r.BufferAttribute(new Float32Array(4*c),4));for(var p=n.tangent.array,l=[],d=[],f=0;f<c;f++)l[f]=new u.Vector3,d[f]=new u.Vector3;var h=new u.Vector3,m=new u.Vector3,y=new u.Vector3,v=new _.Vector2,g=new _.Vector2,b=new _.Vector2,x=new u.Vector3,P=new u.Vector3,T=e.groups;0===T.length&&(T=[{start:0,count:o.length}]);f=0;for(var w=T.length;f<w;++f)for(var C=k=(L=T[f]).start,O=k+L.count;C<O;C+=3)z(o[C+0],o[C+1],o[C+2]);var E,A,N,M=new u.Vector3,j=new u.Vector3,S=new u.Vector3,R=new u.Vector3;for(f=0,w=T.length;f<w;++f){var L,k;for(C=k=(L=T[f]).start,O=k+L.count;C<O;C+=3)G(o[C+0]),G(o[C+1]),G(o[C+2])}}else console.warn("THREE.BufferGeometry: Missing required attributes (index, position, normal or uv) in BufferGeometry.computeTangents()");function z(e,t,n){h.fromArray(i,3*e),m.fromArray(i,3*t),y.fromArray(i,3*n),v.fromArray(s,2*e),g.fromArray(s,2*t),b.fromArray(s,2*n),m.sub(h),y.sub(h),g.sub(v),b.sub(v);var r=1/(g.x*b.y-b.x*g.y);isFinite(r)&&(x.copy(m).multiplyScalar(b.y).addScaledVector(y,-g.y).multiplyScalar(r),P.copy(y).multiplyScalar(g.x).addScaledVector(m,-b.x).multiplyScalar(r),l[e].add(x),l[t].add(x),l[n].add(x),d[e].add(P),d[t].add(P),d[n].add(P))}function G(e){S.fromArray(a,3*e),R.copy(S),A=l[e],M.copy(A),M.sub(S.multiplyScalar(S.dot(A))).normalize(),j.crossVectors(R,A),N=j.dot(d[e]),E=N<0?-1:1,p[4*e]=M.x,p[4*e+1]=M.y,p[4*e+2]=M.z,p[4*e+3]=E}},mergeBufferGeometries:function(e,t){for(var n=null!==e[0].index,r=new Set(Object.keys(e[0].attributes)),i=new Set(Object.keys(e[0].morphAttributes)),a={},s={},_=e[0].morphTargetsRelative,u=new o.BufferGeometry,c=0,p=0;p<e.length;++p){var l=e[p];if(n!==(null!==l.index))return null;for(var d in l.attributes){if(!r.has(d))return null;void 0===a[d]&&(a[d]=[]),a[d].push(l.attributes[d])}if(_!==l.morphTargetsRelative)return null;for(var d in l.morphAttributes){if(!i.has(d))return null;void 0===s[d]&&(s[d]=[]),s[d].push(l.morphAttributes[d])}if(u.userData.mergedUserData=u.userData.mergedUserData||[],u.userData.mergedUserData.push(l.userData),t){var f;if(n)f=l.index.count;else{if(void 0===l.attributes.position)return null;f=l.attributes.position.count}u.addGroup(c,f,p),c+=f}}if(n){var h=0,m=[];for(p=0;p<e.length;++p){for(var y=e[p].index,v=0;v<y.count;++v)m.push(y.getX(v)+h);h+=e[p].attributes.position.count}u.setIndex(m)}for(var d in a){var g=this.mergeBufferAttributes(a[d]);if(!g)return null;u.setAttribute(d,g)}for(var d in s){var b=s[d][0].length;if(0===b)break;u.morphAttributes=u.morphAttributes||{},u.morphAttributes[d]=[];for(p=0;p<b;++p){var x=[];for(v=0;v<s[d].length;++v)x.push(s[d][v][p]);var P=this.mergeBufferAttributes(x);if(!P)return null;u.morphAttributes[d].push(P)}}return u},mergeBufferAttributes:function(e){for(var t,n,o,i=0,a=0;a<e.length;++a){var s=e[a];if(s.isInterleavedBufferAttribute)return null;if(void 0===t&&(t=s.array.constructor),t!==s.array.constructor)return null;if(void 0===n&&(n=s.itemSize),n!==s.itemSize)return null;if(void 0===o&&(o=s.normalized),o!==s.normalized)return null;i+=s.array.length}var _=new t(i),u=0;for(a=0;a<e.length;++a)_.set(e[a].array,u),u+=e[a].array.length;return new r.BufferAttribute(_,n,o)},interleaveAttributes:function(e){for(var t,n=0,r=0,o=0,s=e.length;o<s;++o){var _=e[o];if(void 0===t&&(t=_.array.constructor),t!==_.array.constructor)return console.warn("AttributeBuffers of different types cannot be interleaved"),null;n+=_.array.length,r+=_.itemSize}var u=new i.a(new t(n),r),c=0,p=[],l=["getX","getY","getZ","getW"],d=["setX","setY","setZ","setW"],f=0;for(s=e.length;f<s;f++){var h=(_=e[f]).itemSize,m=_.count,y=new a.InterleavedBufferAttribute(u,h,c,_.normalized);p.push(y),c+=h;for(var v=0;v<m;v++)for(var g=0;g<h;g++)y[d[g]](v,_[l[g]](v))}return p},estimateBytesUsed:function(e){var t=0;for(var n in e.attributes){var r=e.getAttribute(n);t+=r.count*r.itemSize*r.array.BYTES_PER_ELEMENT}var o=e.getIndex();return t+=o?o.count*o.itemSize*o.array.BYTES_PER_ELEMENT:0},mergeVertices:function(e,t=1e-4){t=Math.max(t,Number.EPSILON);for(var n={},o=e.getIndex(),i=e.getAttribute("position"),a=o?o.count:i.count,s=0,_=Object.keys(e.attributes),u={},c={},p=[],l=["getX","getY","getZ","getW"],d=0,f=_.length;d<f;d++){u[b=_[d]]=[],(w=e.morphAttributes[b])&&(c[b]=new Array(w.length).fill().map(()=>[]))}var h=Math.log10(1/t),m=Math.pow(10,h);for(d=0;d<a;d++){var y=o?o.getX(d):d,v="",g=0;for(f=_.length;g<f;g++)for(var b=_[g],x=(T=e.getAttribute(b)).itemSize,P=0;P<x;P++)v+=`${~~(T[l[P]](y)*m)},`;if(v in n)p.push(n[v]);else{for(g=0,f=_.length;g<f;g++){b=_[g];var T=e.getAttribute(b),w=e.morphAttributes[b],C=(x=T.itemSize,u[b]),O=c[b];for(P=0;P<x;P++){var E=l[P];if(C.push(T[E](y)),w)for(var A=0,N=w.length;A<N;A++)O[A].push(w[A][E](y))}}n[v]=s,p.push(s),s++}}const M=e.clone();for(d=0,f=_.length;d<f;d++){b=_[d];var j=e.getAttribute(b),S=new j.array.constructor(u[b]);T=new r.BufferAttribute(S,j.itemSize,j.normalized);if(M.setAttribute(b,T),b in c)for(g=0;g<c[b].length;g++){var R=e.morphAttributes[b][g],L=(S=new R.array.constructor(c[b][g]),new r.BufferAttribute(S,R.itemSize,R.normalized));M.morphAttributes[b][g]=L}}return M.setIndex(p),M},toTrianglesDrawMode:function(e,t){if(t===s.TrianglesDrawMode)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),e;if(t===s.TriangleFanDrawMode||t===s.TriangleStripDrawMode){var n=e.getIndex();if(null===n){var r=[],o=e.getAttribute("position");if(void 0===o)return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),e;for(var i=0;i<o.count;i++)r.push(i);e.setIndex(r),n=e.getIndex()}var a=n.count-2,_=[];if(t===s.TriangleFanDrawMode)for(i=1;i<=a;i++)_.push(n.getX(0)),_.push(n.getX(i)),_.push(n.getX(i+1));else for(i=0;i<a;i++)i%2==0?(_.push(n.getX(i)),_.push(n.getX(i+1)),_.push(n.getX(i+2))):(_.push(n.getX(i+2)),_.push(n.getX(i+1)),_.push(n.getX(i)));_.length/3!==a&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");var u=e.clone();return u.setIndex(_),u.clearGroups(),u}return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",t),e}}},,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(362),i=n(133),a=n(50),s=n(29),_=n(16),u=function(e){function t(t){var n=e.call(this)||this;return n._uv_name=t,n}return r.__extends(t,e),t.prototype.set_texture_allocations_controller=function(e){this._texture_allocations_controller=e},t.prototype.handle_globals_node=function(e,t,n){if(this._texture_allocations_controller){var r=e.io.outputs.named_output_connection_points_by_name(t),o=e.gl_var_name(t);if(this._texture_allocations_controller.variable(t)&&r){var a=r.type,s=a+" "+o+" = "+this.read_attribute(e,a,t,n);n.add_body_lines(e,[s])}else this.globals_geometry_handler=this.globals_geometry_handler||new i.GlobalsGeometryHandler,this.globals_geometry_handler.handle_globals_node(e,t,n)}},t.prototype.read_attribute=function(e,t,n,r){if(this._texture_allocations_controller){var o=this._texture_allocations_controller.variable(n);if(!o)return i.GlobalsGeometryHandler.read_attribute(e,t,n,r);this.add_particles_sim_uv_attribute(e,r);var a=o.component,u=o.allocation;if(u){var c=u.texture_name,p=new s.UniformGLDefinition(e,_.ConnectionPointType.SAMPLER_2D,c);return r.add_definitions(e,[p]),"texture2D( "+c+", "+this._uv_name+" )."+a}}},t.prototype.add_particles_sim_uv_attribute=function(e,n){var r=new s.AttributeGLDefinition(e,_.ConnectionPointType.VEC2,t.UV_ATTRIB),o=new s.VaryingGLDefinition(e,_.ConnectionPointType.VEC2,t.UV_VARYING);n.add_definitions(e,[r,o],a.ShaderName.VERTEX),n.add_definitions(e,[o],a.ShaderName.FRAGMENT),n.add_body_lines(e,[t.UV_VARYING+" = "+t.UV_ATTRIB],a.ShaderName.VERTEX)},t.UV_ATTRIB="particles_sim_uv_attrib",t.UV_VARYING="particles_sim_uv_varying",t.PARTICLE_SIM_UV="particleUV",t}(o.GlobalsBaseController);t.GlobalsTextureHandler=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(53),o=n(4),i=n(6),a=function(){function e(){}return e.accumulated_curve_point_indices=function(e){for(var t,n=[],r=[],o=null,i=0;i<e.length;i++)if(i%2==1){t=e[i];var a=e[i-1];null==o||a===o?(0===n.length&&n.push(a),n.push(t),o=t):(r.push(n),n=[a,t],o=t)}return r.push(n),r},e.create_line_segment_geometry=function(e,t,n,r){var a=[],s={};n.forEach((function(e){s[e]=[]})),t.forEach((function(t,o){var i=e[t];n.forEach((function(e){var t=i.attrib_value(e);(t=r[e]>1?t.toArray():[t]).forEach((function(t){s[e].push(t)}))})),o>0&&(a.push(o-1),a.push(o))}));var _=new i.BufferGeometry;return n.forEach((function(e){var t=r[e],n=s[e];_.setAttribute(e,new o.Float32BufferAttribute(n,t))})),_.setIndex(a),_},e.line_segment_to_geometries=function(e){var t,n=this,o=[],i=new r.CoreGeometry(e),a=i.attrib_names(),s=i.points(),_=(null===(t=e.getIndex())||void 0===t?void 0:t.array)||[],u=this.accumulated_curve_point_indices(_);if(console.log(_,u),u.length>0){var c=i.attrib_sizes();u.forEach((function(t,r){e=n.create_line_segment_geometry(s,t,a,c),o.push(e)}))}return o},e}();t.CoreGeometryUtilCurve=a},function(e,t){},,,,,,,,,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(416),i=n(417),a=n(418),s=n(529),_=n(530),u=n(533),c=n(622),p=n(623),l=n(624),d=n(625),f=n(627),h=n(631),m=n(633),y=n(635),v=n(636),g=n(637),b=n(55),x=function(){function e(){this._default_scene=new b.Scene,this._cameras_controller=new o.CamerasController(this),this._cooker=new i.Cooker(this),this.cook_controller=new s.CookController,this._graph=new a.CoreGraph,this._missing_expression_references_controller=new d.MissingReferencesController,this._expressions_controller=new l.ExpressionsController,this._nodes_controller=new f.NodesController(this),this._time_controller=new m.TimeController(this),this._graph.set_scene(this),this.nodes_controller.init()}return Object.defineProperty(e.prototype,"default_scene",{get:function(){return this._default_scene},enumerable:!0,configurable:!0}),e.prototype.set_uuid=function(e){return this._uuid=e},Object.defineProperty(e.prototype,"uuid",{get:function(){return this._uuid},enumerable:!0,configurable:!0}),e.prototype.set_name=function(e){return this._name=e},Object.defineProperty(e.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cameras_controller",{get:function(){return this._cameras_controller},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cooker",{get:function(){return this._cooker},enumerable:!0,configurable:!0}),e.prototype.wait_for_cooks_completed=function(){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(e){return[2,this.cook_controller.wait_for_cooks_completed()]}))}))},Object.defineProperty(e.prototype,"dispatch_controller",{get:function(){return this._dispatch_controller=this._dispatch_controller||new _.DispatchController(this)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"events_controller",{get:function(){return this._events_controller=this._events_controller||new u.EventsController(this)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"graph",{get:function(){return this._graph},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"lifecycle_controller",{get:function(){return this._lifecycle_controller=this._lifecycle_controller||new c.LifeCycleController(this)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"loading_controller",{get:function(){return this._loading_controller=this._loading_controller||new p.LoadingController(this)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"missing_expression_references_controller",{get:function(){return this._missing_expression_references_controller},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"expressions_controller",{get:function(){return this._expressions_controller},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"nodes_controller",{get:function(){return this._nodes_controller},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"performance",{get:function(){return this._performance=this._performance||new h.CorePerformance},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"time_controller",{get:function(){return this._time_controller},enumerable:!0,configurable:!0}),e.prototype.set_frame=function(e){this.time_controller.set_frame(e)},Object.defineProperty(e.prototype,"frame",{get:function(){return this.time_controller.frame},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"time",{get:function(){return this.time_controller.time},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"frame_range",{get:function(){return this.time_controller.frame_range},enumerable:!0,configurable:!0}),e.prototype.play=function(){this.time_controller.play()},e.prototype.pause=function(){this.time_controller.pause()},Object.defineProperty(e.prototype,"serializer",{get:function(){return this._serializer=this._serializer||new y.PolySceneSerializer(this)},enumerable:!0,configurable:!0}),e.prototype.to_json=function(){return this.serializer.to_json()},Object.defineProperty(e.prototype,"uniforms_controller",{get:function(){return this._uniforms_controller=this._uniforms_controller||new v.UniformsController(this)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"webgl_controller",{get:function(){return this._webgl_controller=this._webgl_controller||new g.WebGLController},enumerable:!0,configurable:!0}),e.prototype.batch_update=function(e){this._cooker.block(),e(),this._cooker.unblock()},e.prototype.node=function(e){return this.nodes_controller.node(e)},Object.defineProperty(e.prototype,"root",{get:function(){return this.nodes_controller.root},enumerable:!0,configurable:!0}),e}();t.PolyScene=x},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(257),i=n(33),a=n(16),s=n(356),_=n(5),u=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.active=_.ParamConfig.BOOLEAN(!0,{callback:function(e,t){c.PARAM_CALLBACK_toggle_active(e)}}),t}return r.__extends(t,e),t}(_.NodeParamsConfig)),c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=u,t}return r.__extends(t,e),t.type=function(){return"mouse_event"},t.prototype.initialize_node=function(){var e=this;this.io.outputs.set_named_output_connection_points(s.ACCEPTED_MOUSE_EVENT_TYPES.map((function(e){return new i.TypedNamedConnectionPoint(e,a.ConnectionPointType.BOOL)}))),this.lifecycle.add_on_add_hook((function(){e.scene.events_controller.register_event_node(e)})),this.lifecycle.add_delete_hook((function(){e.scene.events_controller.unregister_event_node(e)}))},t.prototype.process_event=function(e,t,n){if(this.pv.active){var r=this.io.outputs.get_output_index(e.type);if(r>=0)for(var o=0,i=this.io.connections.output_connections().filter((function(e){return e.output_index==r})).map((function(e){return e.node_dest}));o<i.length;o++){i[o].process_event(e,t,n)}}},t.prototype._update_register=function(){this.pv.active?this.scene.events_controller.register_event_node(this):this.scene.events_controller.unregister_event_node(this)},t.PARAM_CALLBACK_toggle_active=function(e){e._update_register()},t}(o.TypedEventNode);t.MouseEventNode=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(e){this.node=e};t.BaseState=r},,,,,,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this.node=e}return e.prototype.to_json=function(e){var t,n,r,o;void 0===e&&(e=!1);var i={name:this.node.name,type:this.node.type,graph_node_id:this.node.graph_node_id,is_dirty:this.node.is_dirty,ui_data_json:this.node.ui_data.to_json(),error_message:this.node.states.error.message,children:this.children_ids(),inputs:this.input_ids(),input_connection_output_indices:this.connection_input_indices(),named_input_connections:this.named_input_connections(),named_output_connections:this.named_output_connections(),param_ids:this.to_json_params(e),override_clonable_state:this.node.io.inputs.override_clonable_state(),inputs_clonable_state_with_override:this.node.io.inputs.inputs_clonable_state_with_override(),flags:{display:null===(n=null===(t=this.node.flags)||void 0===t?void 0:t.display)||void 0===n?void 0:n.active,bypass:null===(o=null===(r=this.node.flags)||void 0===r?void 0:r.bypass)||void 0===o?void 0:o.active},selection:void 0};return this.node.children_allowed()&&this.node.children_controller&&(i.selection=this.node.children_controller.selection.to_json()),i},e.prototype.children_ids=function(){return this.node.children().map((function(e){return e.graph_node_id}))},e.prototype.input_ids=function(){return this.node.io.inputs.inputs().map((function(e){return null!=e?e.graph_node_id:void 0}))},e.prototype.connection_input_indices=function(){var e;return null===(e=this.node.io.connections.input_connections())||void 0===e?void 0:e.map((function(e){return null!=e?e.output_index:void 0}))},e.prototype.named_input_connections=function(){return this.node.io.inputs.named_input_connection_points.map((function(e){return e.to_json()}))},e.prototype.named_output_connections=function(){return this.node.io.outputs.named_output_connection_points.map((function(e){return e.to_json()}))},e.prototype.to_json_params_from_names=function(e,t){var n=this;return void 0===t&&(t=!1),e.map((function(e){return n.node.params.get(e).graph_node_id}))},e.prototype.to_json_params=function(e){return void 0===e&&(e=!1),this.to_json_params_from_names(this.node.params.names,e)},e}();t.NodeSerializer=r},function(e,t,n){"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0});var o=n(580),i=n(603),a=n(604),s=n(354),_=n(605),u=n(606),c=n(355),p=n(128),l=n(608),d=n(265),f=n(609),h=n(610),m=n(611),y=n(24);t.ParamConstructorByType=((r={})[y.ParamType.BOOLEAN]=o.BooleanParam,r[y.ParamType.BUTTON]=i.ButtonParam,r[y.ParamType.COLOR]=a.ColorParam,r[y.ParamType.FLOAT]=s.FloatParam,r[y.ParamType.FOLDER]=_.FolderParam,r[y.ParamType.INTEGER]=u.IntegerParam,r[y.ParamType.OPERATOR_PATH]=c.OperatorPathParam,r[y.ParamType.RAMP]=p.RampParam,r[y.ParamType.SEPARATOR]=l.SeparatorParam,r[y.ParamType.STRING]=d.StringParam,r[y.ParamType.VECTOR2]=f.Vector2Param,r[y.ParamType.VECTOR3]=h.Vector3Param,r[y.ParamType.VECTOR4]=m.Vector4Param,r)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(581),i=function(){function e(e){this.param=e}return Object.defineProperty(e.prototype,"active",{get:function(){return null!=this._expression},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"expression",{get:function(){return this._expression},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"is_errored",{get:function(){return!!this._manager&&this._manager.is_errored},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"error_message",{get:function(){return this._manager?this._manager.error_message:null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"requires_entities",{get:function(){return this.param.options.is_expression_for_entities},enumerable:!0,configurable:!0}),e.prototype.set_expression=function(e,t){var n;void 0===t&&(t=!0),this.param.scene.missing_expression_references_controller.deregister_param(this.param),this.param.scene.expressions_controller.deregister_param(this.param),this._expression!=e&&(this._expression=e,this._expression?(this._manager=this._manager||new o.ExpressionManager(this.param),this._manager.parse_expression(this._expression)):null===(n=this._manager)||void 0===n||n.reset(),t&&this.param.set_dirty())},e.prototype.update_from_method_dependency_name_change=function(){this._manager&&this.active&&this._manager.update_from_method_dependency_name_change()},e.prototype.compute_expression=function(){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(e){switch(e.label){case 0:return this._manager&&this.active?[4,this._manager.compute_function()]:[3,2];case 1:return[2,e.sent()];case 2:return[2]}}))}))},e.prototype.compute_expression_for_entities=function(e,t){var n,o;return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(r){switch(r.label){case 0:return this.set_entities(e,t),[4,this.compute_expression()];case 1:return r.sent(),(null===(n=this._manager)||void 0===n?void 0:n.error_message)&&this.param.node.states.error.set("expression evalution error: "+(null===(o=this._manager)||void 0===o?void 0:o.error_message)),this.reset_entities(),[2]}}))}))},e.prototype.compute_expression_for_points=function(e,t){return this.compute_expression_for_entities(e,t)},e.prototype.compute_expression_for_objects=function(e,t){return this.compute_expression_for_entities(e,t)},Object.defineProperty(e.prototype,"entities",{get:function(){return this._entities},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"entity_callback",{get:function(){return this._entity_callback},enumerable:!0,configurable:!0}),e.prototype.set_entities=function(e,t){this._entities=e,this._entity_callback=t},e.prototype.reset_entities=function(){this._entities=void 0,this._entity_callback=void 0},e}();t.ExpressionController=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=r.__importDefault(n(45)),i=r.__importDefault(n(582));i.default.addUnaryOp("@");i.default.addBinaryOp("**",10);var a=function(){function e(){}return e.prototype.parse_expression=function(e){try{this.reset(),this.node=i.default(e)}catch(n){var t="could not parse the expression '"+e+"' (error: "+n+")";this.error_message=t}},e.prototype.parse_expression_for_string_param=function(t){try{this.reset();for(var n=e.string_value_elements(t),r=[],o=0;o<n.length;o++){var a=n[o],s=void 0;s=o%2==1?i.default(a):{type:"Literal",value:"'"+a+"'",raw:"'"+a+"'"},r.push(s)}this.node={type:"CallExpression",arguments:r,callee:{type:"Identifier",name:"str_concat"}}}catch(e){var _="could not parse the expression '"+t+"' (error: "+e+")";this.error_message=_}},e.string_value_elements=function(e){return null!=e&&o.default(e)?e.split("`"):[]},e.prototype.reset=function(){this.node=void 0,this.error_message=void 0},e}();t.ParsedTree=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(101),o=function(){function e(){this.index=-1,this.path_elements=[],this._named_nodes=[],this.graph_node_ids=[],this.node_element_by_graph_node_id={}}return e.prototype.add_node=function(e,t){this.index+=1,e==t.name&&(this.named_nodes[this.index]=t),this.graph_node_ids[this.index]=t.graph_node_id,this.node_element_by_graph_node_id[t.graph_node_id]=e},e.prototype.add_path_element=function(e){this.index+=1,this.path_elements[this.index]=e},Object.defineProperty(e.prototype,"named_nodes",{get:function(){return this._named_nodes},enumerable:!0,configurable:!0}),e.prototype.update_from_name_change=function(e){this.named_nodes.map((function(e){return null==e?void 0:e.graph_node_id})).includes(e.graph_node_id)&&(this.node_element_by_graph_node_id[e.graph_node_id]=e.name)},e.prototype.to_path=function(){for(var e=new Array(this.index),t=0;t<=this.index;t++){var n=this.named_nodes[t];if(n)e[t]=this.node_element_by_graph_node_id[n.graph_node_id];else{var o=this.path_elements[t];o&&(e[t]=o)}}var i=e.join(r.CoreWalker.SEPARATOR),a=i[0];return a&&(r.CoreWalker.NON_LETTER_PREFIXES.includes(a)||(i=""+r.CoreWalker.SEPARATOR+i)),i},e}();t.DecomposedPath=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(e){return function(t){return Math.pow(t,e)}},o=function(e){return function(t){return 1-Math.abs(Math.pow(t-1,e))}},i=function(e){return function(t){return t<.5?r(e)(2*t)/2:o(e)(2*t-1)/2+.5}};t.Easing={linear:i(1),ease_i:function(e,t){return r(t)(e)},ease_o:function(e,t){return o(t)(e)},ease_io:function(e,t){return i(t)(e)},ease_i2:r(2),ease_o2:o(2),ease_io2:i(2),ease_i3:i(3),ease_o3:i(3),ease_io3:i(3),ease_i4:i(4),ease_o4:i(4),ease_io4:i(4),ease_i_sin:function(e){return 1+Math.sin(Math.PI/2*e-Math.PI/2)},ease_o_sin:function(e){return Math.sin(Math.PI/2*e)},ease_io_sin:function(e){return(1+Math.sin(Math.PI*e-Math.PI/2))/2},ease_i_elastic:function(e){return(.04-.04/e)*Math.sin(25*e)+1},ease_o_elastic:function(e){return.04*e/--e*Math.sin(25*e)},ease_io_elastic:function(e){return(e-=.5)<0?(.02+.01/e)*Math.sin(50*e):(.02-.01/e)*Math.sin(50*e)+1}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=r.__importDefault(n(44)),i=n(191),a=n(24),s=n(49),_=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.type=function(){return a.ParamType.FLOAT},Object.defineProperty(t.prototype,"default_value_serialized",{get:function(){return this.default_value},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"raw_input_serialized",{get:function(){return this._raw_input},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"value_serialized",{get:function(){return this.value},enumerable:!0,configurable:!0}),t.are_raw_input_equal=function(e,t){return e==t},t.are_values_equal=function(e,t){return e==t},t.convert=function(e){if(o.default(e))return e;if(s.CoreString.is_number(e)){var t=parseFloat(e);if(o.default(t))return t}return null},t.prototype.convert=function(e){var n=t.convert(e);return n?this.options.ensure_in_range(n):n},t}(i.TypedNumericParam);t.FloatParam=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(93),i=n(101),a=n(24),s=n(103),_=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._found_node=null,t}return r.__extends(t,e),t.type=function(){return a.ParamType.OPERATOR_PATH},Object.defineProperty(t.prototype,"default_value_serialized",{get:function(){return this.default_value},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"raw_input_serialized",{get:function(){return""+this._raw_input},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"value_serialized",{get:function(){return""+this.value},enumerable:!0,configurable:!0}),t.are_raw_input_equal=function(e,t){return e==t},t.are_values_equal=function(e,t){return e==t},Object.defineProperty(t.prototype,"is_default",{get:function(){return this._value==this.default_value},enumerable:!0,configurable:!0}),t.prototype.process_raw_input=function(){this._value=this._raw_input,this.set_dirty(),this.emit_controller.emit(s.ParamEvent.VALUE_UPDATED)},t.prototype.process_computation=function(){var e,t;return r.__awaiter(this,void 0,void 0,(function(){var n,o,a,s,_;return r.__generator(this,(function(r){return n=this._value,o=null,null!=n&&""!==n&&(o=i.CoreWalker.find_node(this.node,n)),this._found_node!==o&&(a=this.options.dependent_on_found_node(),this._found_node&&a&&this.remove_graph_input(this._found_node),this._found_node=o,o&&(s=this.options.node_selection_context,_=null===(t=null===(e=o.parent)||void 0===e?void 0:e.children_controller)||void 0===t?void 0:t.context,s==_||null==s?a&&this.add_graph_input(o):this.states.error.set("node context is "+s+" but the params expects a "+_)),this.options.execute_callback()),this.remove_dirty_state(),[2]}))}))},t.prototype.found_node=function(){return this._found_node},t}(o.TypedParam);t.OperatorPathParam=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,o=n(2),i=n(621);!function(e){e.DOWN="mousedown",e.MOVE="mousemove",e.UP="mouseup",e.ENTER="mouseenter",e.LEAVE="mouseleave"}(r||(r={})),t.ACCEPTED_MOUSE_EVENT_TYPES=[r.DOWN,r.MOVE,r.UP,r.ENTER,r.LEAVE];var a=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return o.__extends(n,e),n.prototype.accepts_event=function(e){return t.ACCEPTED_MOUSE_EVENT_TYPES.includes(e.type)},n}(i.BaseEventsController);t.MouseEventsController=a},,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this.node=e,this._state=!0,this._hooks=null}return e.prototype.add_hook=function(e){this._hooks=this._hooks||[],this._hooks.push(e)},e.prototype.on_update=function(){},e.prototype.set=function(e){this._state!=e&&(this._state=e,this.on_update(),this.run_hooks())},Object.defineProperty(e.prototype,"active",{get:function(){return this._state},enumerable:!0,configurable:!0}),e.prototype.toggle=function(){this.set(!this._state)},e.prototype.run_hooks=function(){if(this._hooks)for(var e=0,t=this._hooks;e<t.length;e++){(0,t[e])()}},e}();t.BaseFlag=r},,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){this._id=e.__next_id++}return e.prototype.id=function(){return this._id},e.prototype.handle_globals_node=function(e,t,n){},e.__next_id=0,e}();t.GlobalsBaseController=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){void 0===e&&(e=[]),this._definitions=e,this._errored=!1}return Object.defineProperty(e.prototype,"errored",{get:function(){return this._errored},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"error_message",{get:function(){return this._error_message},enumerable:!0,configurable:!0}),e.prototype.uniq=function(){for(var e=new Map,t=[],n=0,r=this._definitions;n<r.length;n++){var o=r[n];if(!this._errored){var i=o.name,a=e.get(i);a?a.data_type!=o.data_type&&(this._errored=!0,this._error_message="attempt to create "+o.name+" with types "+o.data_type,console.warn("emitting error message",this._error_message)):(e.set(i,o),t.push(i))}}for(var s=[],_=0,u=t;_<u.length;_++){var c=u[_];(o=e.get(c))&&s.push(o)}return s},e}();t.TypedGLDefinitionCollection=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=r.__importDefault(n(92)),i=r.__importDefault(n(91)),a=n(129),s=n(50),_=function(){function e(e,t){this._assembler=e,this._gl_parent_node=t,this._leaves_graph_id=new Map,this._graph_ids_by_shader_name=new Map,this._outputs_by_graph_id=new Map,this._depth_by_graph_id=new Map,this._graph_id_by_depth=new Map,this._graph=this._gl_parent_node.scene.graph}return e.prototype.reset=function(){var e=this;this._leaves_graph_id.clear(),this._outputs_by_graph_id.clear(),this._depth_by_graph_id.clear(),this._graph_id_by_depth.clear(),this.shader_names().forEach((function(t){e._graph_ids_by_shader_name.set(t,new Map)}))},e.prototype.shader_names=function(){return this._assembler.shader_names},e.prototype.input_names_for_shader_name=function(e,t){return this._assembler.input_names_for_shader_name(e,t)},e.prototype.traverse=function(e){var t=this;this.reset();for(var n=0,r=this.shader_names();n<r.length;n++){var o=r[n];this._leaves_graph_id.set(o,new Map)}for(var i=0,s=this.shader_names();i<s.length;i++){o=s[i];this._shader_name=o;for(var _=0,u=e;_<u.length;_++){var c=u[_];this.find_leaves_from_root_node(c),this.set_nodes_depth()}}this._depth_by_graph_id.forEach((function(e,n){null!=e&&a.MapUtils.push_on_array_at_entry(t._graph_id_by_depth,e,n)}))},e.prototype.leaves_from_nodes=function(e){var t;this._shader_name=s.ShaderName.LEAVES_FROM_NODES_SHADER,this._graph_ids_by_shader_name.set(this._shader_name,new Map),this._leaves_graph_id.set(this._shader_name,new Map);for(var n=0,r=e;n<r.length;n++){var o=r[n];this.find_leaves(o)}var i=[];return null===(t=this._leaves_graph_id.get(this._shader_name))||void 0===t||t.forEach((function(e,t){i.push(t)})),this._graph.nodes_from_ids(i)},e.prototype.nodes_for_shader_name=function(e){var t=this,n=[];this._graph_id_by_depth.forEach((function(e,t){n.push(t)})),n.sort((function(e,t){return e-t}));var r=[];return n.forEach((function(n){var o=t._graph_id_by_depth.get(n);o&&o.forEach((function(n){var o;if(null===(o=t._graph_ids_by_shader_name.get(e))||void 0===o?void 0:o.get(n)){var i=t._graph.node_from_id(n);r.push(i)}}))})),r},e.prototype.sorted_nodes=function(){var e=this,t=[];this._graph_id_by_depth.forEach((function(e,n){t.push(n)})),t.sort((function(e,t){return e-t}));var n=[];return t.forEach((function(t){var r=e._graph_id_by_depth.get(t);if(r)for(var o=0,i=r;o<i.length;o++){var a=i[o],s=e._graph.node_from_id(a);s&&n.push(s)}})),n},e.prototype.find_leaves_from_root_node=function(e){var t,n=this;null===(t=this._graph_ids_by_shader_name.get(this._shader_name))||void 0===t||t.set(e.graph_node_id,!0);var r=this.input_names_for_shader_name(e,this._shader_name);if(r)for(var o=0,s=r;o<s.length;o++){var _=s[o],u=e.io.inputs.named_input(_);u&&(a.MapUtils.push_on_array_at_entry(this._outputs_by_graph_id,u.graph_node_id,e.graph_node_id),this.find_leaves(u))}this._outputs_by_graph_id.forEach((function(e,t){n._outputs_by_graph_id.set(t,i.default(e))}))},e.prototype.find_leaves=function(e){var t,n=this;null===(t=this._graph_ids_by_shader_name.get(this._shader_name))||void 0===t||t.set(e.graph_node_id,!0);var r=o.default(e.io.inputs.inputs()),s=i.default(r.map((function(e){return e.graph_node_id}))).map((function(e){return n._graph.node_from_id(e)}));if(s.length>0)for(var _=0,u=s;_<u.length;_++){var c=u[_];a.MapUtils.push_on_array_at_entry(this._outputs_by_graph_id,c.graph_node_id,e.graph_node_id),this.find_leaves(c)}else this._leaves_graph_id.get(this._shader_name).set(e.graph_node_id,!0)},e.prototype.set_nodes_depth=function(){var e=this;this._leaves_graph_id.forEach((function(t,n){t.forEach((function(t,n){e.set_node_depth(n)}))}))},e.prototype.set_node_depth=function(e,t){var n=this;void 0===t&&(t=0);var r=this._depth_by_graph_id.get(e);null!=r?this._depth_by_graph_id.set(e,Math.max(r,t)):this._depth_by_graph_id.set(e,t);var o=this._outputs_by_graph_id.get(e);o&&o.forEach((function(e){n.set_node_depth(e,t+1)}))},e}();t.TypedNodeTraverser=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(34),i=new(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t}(n(5).NodeParamsConfig)),a=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=i,t}return r.__extends(t,e),t.type=function(){return"globals"},t.prototype.create_params=function(){var e;null===(e=this.material_node)||void 0===e||e.assembler_controller.add_globals_params(this)},t.prototype.set_lines=function(e){var t,n;null===(n=null===(t=this.material_node)||void 0===t?void 0:t.assembler_controller)||void 0===n||n.assembler.set_node_lines_globals(this,e)},t}(o.TypedGlNode);t.GlobalsGlNode=a},function(e,t,n){"use strict";n.r(t),n.d(t,"OrbitControls",(function(){return u})),n.d(t,"MapControls",(function(){return c}));var r=n(43),o=n(0),i=n(42),a=n(295),s=n(3),_=n(1),u=function(e,t){var n,r,u,c,p;void 0===t&&console.warn('THREE.OrbitControls: The second parameter "domElement" is now mandatory.'),t===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),this.object=e,this.domElement=t,this.enabled=!0,this.target=new _.Vector3,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!1,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.enableKeys=!0,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={LEFT:o.MOUSE.ROTATE,MIDDLE:o.MOUSE.DOLLY,RIGHT:o.MOUSE.PAN},this.touches={ONE:o.TOUCH.ROTATE,TWO:o.TOUCH.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=function(){return g.phi},this.getAzimuthalAngle=function(){return g.theta},this.saveState=function(){l.target0.copy(l.target),l.position0.copy(l.object.position),l.zoom0=l.object.zoom},this.reset=function(){l.target.copy(l.target0),l.object.position.copy(l.position0),l.object.zoom=l.zoom0,l.object.updateProjectionMatrix(),l.dispatchEvent(d),l.update(),y=m.NONE},this.update=(n=new _.Vector3,r=(new i.Quaternion).setFromUnitVectors(e.up,new _.Vector3(0,1,0)),u=r.clone().inverse(),c=new _.Vector3,p=new i.Quaternion,function(){var e=l.object.position;return n.copy(e).sub(l.target),n.applyQuaternion(r),g.setFromVector3(n),l.autoRotate&&y===m.NONE&&L(2*Math.PI/60/60*l.autoRotateSpeed),l.enableDamping?(g.theta+=b.theta*l.dampingFactor,g.phi+=b.phi*l.dampingFactor):(g.theta+=b.theta,g.phi+=b.phi),g.theta=Math.max(l.minAzimuthAngle,Math.min(l.maxAzimuthAngle,g.theta)),g.phi=Math.max(l.minPolarAngle,Math.min(l.maxPolarAngle,g.phi)),g.makeSafe(),g.radius*=x,g.radius=Math.max(l.minDistance,Math.min(l.maxDistance,g.radius)),!0===l.enableDamping?l.target.addScaledVector(P,l.dampingFactor):l.target.add(P),n.setFromSpherical(g),n.applyQuaternion(u),e.copy(l.target).add(n),l.object.lookAt(l.target),!0===l.enableDamping?(b.theta*=1-l.dampingFactor,b.phi*=1-l.dampingFactor,P.multiplyScalar(1-l.dampingFactor)):(b.set(0,0,0),P.set(0,0,0)),x=1,!!(T||c.distanceToSquared(l.object.position)>v||8*(1-p.dot(l.object.quaternion))>v)&&(l.dispatchEvent(d),c.copy(l.object.position),p.copy(l.object.quaternion),T=!1,!0)}),this.dispose=function(){l.domElement.removeEventListener("contextmenu",oe,!1),l.domElement.removeEventListener("mousedown",K,!1),l.domElement.removeEventListener("wheel",$,!1),l.domElement.removeEventListener("touchstart",te,!1),l.domElement.removeEventListener("touchend",re,!1),l.domElement.removeEventListener("touchmove",ne,!1),document.removeEventListener("mousemove",Z,!1),document.removeEventListener("mouseup",Q,!1),l.domElement.removeEventListener("keydown",ee,!1)};var l=this,d={type:"change"},f={type:"start"},h={type:"end"},m={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},y=m.NONE,v=1e-6,g=new a.a,b=new a.a,x=1,P=new _.Vector3,T=!1,w=new s.Vector2,C=new s.Vector2,O=new s.Vector2,E=new s.Vector2,A=new s.Vector2,N=new s.Vector2,M=new s.Vector2,j=new s.Vector2,S=new s.Vector2;function R(){return Math.pow(.95,l.zoomSpeed)}function L(e){b.theta-=e}function k(e){b.phi-=e}var z,G=(z=new _.Vector3,function(e,t){z.setFromMatrixColumn(t,0),z.multiplyScalar(-e),P.add(z)}),I=function(){var e=new _.Vector3;return function(t,n){!0===l.screenSpacePanning?e.setFromMatrixColumn(n,1):(e.setFromMatrixColumn(n,0),e.crossVectors(l.object.up,e)),e.multiplyScalar(t),P.add(e)}}(),D=function(){var e=new _.Vector3;return function(t,n){var r=l.domElement;if(l.object.isPerspectiveCamera){var o=l.object.position;e.copy(o).sub(l.target);var i=e.length();i*=Math.tan(l.object.fov/2*Math.PI/180),G(2*t*i/r.clientHeight,l.object.matrix),I(2*n*i/r.clientHeight,l.object.matrix)}else l.object.isOrthographicCamera?(G(t*(l.object.right-l.object.left)/l.object.zoom/r.clientWidth,l.object.matrix),I(n*(l.object.top-l.object.bottom)/l.object.zoom/r.clientHeight,l.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),l.enablePan=!1)}}();function F(e){l.object.isPerspectiveCamera?x/=e:l.object.isOrthographicCamera?(l.object.zoom=Math.max(l.minZoom,Math.min(l.maxZoom,l.object.zoom*e)),l.object.updateProjectionMatrix(),T=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),l.enableZoom=!1)}function B(e){l.object.isPerspectiveCamera?x*=e:l.object.isOrthographicCamera?(l.object.zoom=Math.max(l.minZoom,Math.min(l.maxZoom,l.object.zoom/e)),l.object.updateProjectionMatrix(),T=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),l.enableZoom=!1)}function V(e){w.set(e.clientX,e.clientY)}function U(e){E.set(e.clientX,e.clientY)}function q(e){if(1==e.touches.length)w.set(e.touches[0].pageX,e.touches[0].pageY);else{var t=.5*(e.touches[0].pageX+e.touches[1].pageX),n=.5*(e.touches[0].pageY+e.touches[1].pageY);w.set(t,n)}}function Y(e){if(1==e.touches.length)E.set(e.touches[0].pageX,e.touches[0].pageY);else{var t=.5*(e.touches[0].pageX+e.touches[1].pageX),n=.5*(e.touches[0].pageY+e.touches[1].pageY);E.set(t,n)}}function H(e){var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY,r=Math.sqrt(t*t+n*n);M.set(0,r)}function X(e){if(1==e.touches.length)C.set(e.touches[0].pageX,e.touches[0].pageY);else{var t=.5*(e.touches[0].pageX+e.touches[1].pageX),n=.5*(e.touches[0].pageY+e.touches[1].pageY);C.set(t,n)}O.subVectors(C,w).multiplyScalar(l.rotateSpeed);var r=l.domElement;L(2*Math.PI*O.x/r.clientHeight),k(2*Math.PI*O.y/r.clientHeight),w.copy(C)}function J(e){if(1==e.touches.length)A.set(e.touches[0].pageX,e.touches[0].pageY);else{var t=.5*(e.touches[0].pageX+e.touches[1].pageX),n=.5*(e.touches[0].pageY+e.touches[1].pageY);A.set(t,n)}N.subVectors(A,E).multiplyScalar(l.panSpeed),D(N.x,N.y),E.copy(A)}function W(e){var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY,r=Math.sqrt(t*t+n*n);j.set(0,r),S.set(0,Math.pow(j.y/M.y,l.zoomSpeed)),F(S.y),M.copy(j)}function K(e){if(!1!==l.enabled){var t;switch(e.preventDefault(),l.domElement.focus?l.domElement.focus():window.focus(),e.button){case 0:t=l.mouseButtons.LEFT;break;case 1:t=l.mouseButtons.MIDDLE;break;case 2:t=l.mouseButtons.RIGHT;break;default:t=-1}switch(t){case o.MOUSE.DOLLY:if(!1===l.enableZoom)return;!function(e){M.set(e.clientX,e.clientY)}(e),y=m.DOLLY;break;case o.MOUSE.ROTATE:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===l.enablePan)return;U(e),y=m.PAN}else{if(!1===l.enableRotate)return;V(e),y=m.ROTATE}break;case o.MOUSE.PAN:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===l.enableRotate)return;V(e),y=m.ROTATE}else{if(!1===l.enablePan)return;U(e),y=m.PAN}break;default:y=m.NONE}y!==m.NONE&&(document.addEventListener("mousemove",Z,!1),document.addEventListener("mouseup",Q,!1),l.dispatchEvent(f))}}function Z(e){if(!1!==l.enabled)switch(e.preventDefault(),y){case m.ROTATE:if(!1===l.enableRotate)return;!function(e){C.set(e.clientX,e.clientY),O.subVectors(C,w).multiplyScalar(l.rotateSpeed);var t=l.domElement;L(2*Math.PI*O.x/t.clientHeight),k(2*Math.PI*O.y/t.clientHeight),w.copy(C),l.update()}(e);break;case m.DOLLY:if(!1===l.enableZoom)return;!function(e){j.set(e.clientX,e.clientY),S.subVectors(j,M),S.y>0?F(R()):S.y<0&&B(R()),M.copy(j),l.update()}(e);break;case m.PAN:if(!1===l.enablePan)return;!function(e){A.set(e.clientX,e.clientY),N.subVectors(A,E).multiplyScalar(l.panSpeed),D(N.x,N.y),E.copy(A),l.update()}(e)}}function Q(e){!1!==l.enabled&&(document.removeEventListener("mousemove",Z,!1),document.removeEventListener("mouseup",Q,!1),l.dispatchEvent(h),y=m.NONE)}function $(e){!1===l.enabled||!1===l.enableZoom||y!==m.NONE&&y!==m.ROTATE||(e.preventDefault(),e.stopPropagation(),l.dispatchEvent(f),function(e){e.deltaY<0?B(R()):e.deltaY>0&&F(R()),l.update()}(e),l.dispatchEvent(h))}function ee(e){!1!==l.enabled&&!1!==l.enableKeys&&!1!==l.enablePan&&function(e){var t=!1;switch(e.keyCode){case l.keys.UP:D(0,l.keyPanSpeed),t=!0;break;case l.keys.BOTTOM:D(0,-l.keyPanSpeed),t=!0;break;case l.keys.LEFT:D(l.keyPanSpeed,0),t=!0;break;case l.keys.RIGHT:D(-l.keyPanSpeed,0),t=!0}t&&(e.preventDefault(),l.update())}(e)}function te(e){if(!1!==l.enabled){switch(e.preventDefault(),e.touches.length){case 1:switch(l.touches.ONE){case o.TOUCH.ROTATE:if(!1===l.enableRotate)return;q(e),y=m.TOUCH_ROTATE;break;case o.TOUCH.PAN:if(!1===l.enablePan)return;Y(e),y=m.TOUCH_PAN;break;default:y=m.NONE}break;case 2:switch(l.touches.TWO){case o.TOUCH.DOLLY_PAN:if(!1===l.enableZoom&&!1===l.enablePan)return;!function(e){l.enableZoom&&H(e),l.enablePan&&Y(e)}(e),y=m.TOUCH_DOLLY_PAN;break;case o.TOUCH.DOLLY_ROTATE:if(!1===l.enableZoom&&!1===l.enableRotate)return;!function(e){l.enableZoom&&H(e),l.enableRotate&&q(e)}(e),y=m.TOUCH_DOLLY_ROTATE;break;default:y=m.NONE}break;default:y=m.NONE}y!==m.NONE&&l.dispatchEvent(f)}}function ne(e){if(!1!==l.enabled)switch(e.preventDefault(),e.stopPropagation(),y){case m.TOUCH_ROTATE:if(!1===l.enableRotate)return;X(e),l.update();break;case m.TOUCH_PAN:if(!1===l.enablePan)return;J(e),l.update();break;case m.TOUCH_DOLLY_PAN:if(!1===l.enableZoom&&!1===l.enablePan)return;!function(e){l.enableZoom&&W(e),l.enablePan&&J(e)}(e),l.update();break;case m.TOUCH_DOLLY_ROTATE:if(!1===l.enableZoom&&!1===l.enableRotate)return;!function(e){l.enableZoom&&W(e),l.enableRotate&&X(e)}(e),l.update();break;default:y=m.NONE}}function re(e){!1!==l.enabled&&(l.dispatchEvent(h),y=m.NONE)}function oe(e){!1!==l.enabled&&e.preventDefault()}l.domElement.addEventListener("contextmenu",oe,!1),l.domElement.addEventListener("mousedown",K,!1),l.domElement.addEventListener("wheel",$,!1),l.domElement.addEventListener("touchstart",te,!1),l.domElement.addEventListener("touchend",re,!1),l.domElement.addEventListener("touchmove",ne,!1),l.domElement.addEventListener("keydown",ee,!1),-1===l.domElement.tabIndex&&(l.domElement.tabIndex=0),this.update()};u.prototype=Object.create(r.a.prototype),u.prototype.constructor=u;var c=function(e,t){u.call(this,e,t),this.mouseButtons.LEFT=o.MOUSE.PAN,this.mouseButtons.RIGHT=o.MOUSE.ROTATE,this.touches.ONE=o.TOUCH.PAN,this.touches.TWO=o.TOUCH.DOLLY_ROTATE};c.prototype=Object.create(r.a.prototype),c.prototype.constructor=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){}return e.filter=function(e){var t=e.split("\n");console.log(t);for(var n=[],r=0,o=t;r<o.length;r++){var i=o[r];i.match(/import {.*} from '.*'/)||(i=i.replace("export ","return"),n.push(i))}return console.log("filtered_lines",n),n.join("\n")},e}();t.TranspiledFilter=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(34),i=n(5),a=n(134),s=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}r.__extends(t,e)}(i.NodeParamsConfig),function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.gl_connections_controller=new a.GlConnectionsController(t),t}return r.__extends(t,e),t.prototype.initialize_node=function(){e.prototype.initialize_node.call(this),this.gl_connections_controller.initialize_node()},t}(o.TypedGlNode));t.BaseAdaptiveGlNode=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(36),i=n(16),a=n(29);function s(e,t){void 0===t&&(t={});var n=t.method||e,s=t.out||"val",_=t.in||["in0","in1"],u=t.default_in_type,c=t.allowed_in_types,p=t.out_type,l=t.functions||[];return function(t){function o(){return null!==t&&t.apply(this,arguments)||this}return r.__extends(o,t),o.type=function(){return e},o.prototype.initialize_node=function(){t.prototype.initialize_node.call(this),this.gl_connections_controller.set_input_name_function(this._gl_input_name.bind(this)),this.gl_connections_controller.set_output_name_function(this._gl_output_name.bind(this)),this.gl_connections_controller.set_expected_input_types_function(this._expected_input_types.bind(this)),p&&this.gl_connections_controller.set_expected_output_types_function((function(){return[p]}))},o.prototype._gl_input_name=function(e){return _[e]},o.prototype._gl_output_name=function(e){return s},o.prototype.gl_method_name=function(){return n},o.prototype.gl_function_definitions=function(){var e=this;return p?l.map((function(t){return new a.FunctionGLDefinition(e,p,t)})):[]},o.prototype._expected_input_types=function(){var e=this.gl_connections_controller.first_input_connection_type();if(e&&c&&!c.includes(e)){var t=this.io.inputs.named_input_connection_points[0];e=t?t.type:u}var n=e||u||i.ConnectionPointType.FLOAT;return[n,n]},o}(o.BaseNodeGlMathFunctionArg2GlNode)}t.MathFunctionArg2Factory=s;var _=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t}(s("distance",{in:["p0","p1"],default_in_type:i.ConnectionPointType.VEC3,allowed_in_types:[i.ConnectionPointType.VEC2,i.ConnectionPointType.VEC3,i.ConnectionPointType.VEC4],out_type:i.ConnectionPointType.FLOAT}));t.DistanceGlNode=_;var u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t}(s("dot",{in:["vec0","vec1"],default_in_type:i.ConnectionPointType.VEC3,allowed_in_types:[i.ConnectionPointType.VEC2,i.ConnectionPointType.VEC3,i.ConnectionPointType.VEC4],out_type:i.ConnectionPointType.FLOAT}));t.DotGlNode=u;var c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t}(s("max"));t.MaxGlNode=c;var p=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t}(s("min"));t.MinGlNode=p;var l=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t}(s("mod"));t.ModGlNode=l;var d=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t}(s("pow",{in:["x","y"]}));t.PowGlNode=d;var f=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t}(s("reflect",{in:["I","N"],default_in_type:i.ConnectionPointType.VEC3}));t.ReflectGlNode=f;var h=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t}(s("step",{in:["edge","x"]}));t.StepGlNode=h},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(34),i=n(28),a=n(16);function s(e){return{visible_if:{type:a.ConnectionPointTypes.indexOf(e)}}}var _=n(5),u=n(134),c=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.type=_.ParamConfig.INTEGER(a.ConnectionPointTypes.indexOf(a.ConnectionPointType.FLOAT),{menu:{entries:a.ConnectionPointTypes.map((function(e,t){return{name:e,value:t}}))}}),t.bool=_.ParamConfig.BOOLEAN(0,s(a.ConnectionPointType.BOOL)),t.int=_.ParamConfig.INTEGER(0,s(a.ConnectionPointType.INT)),t.float=_.ParamConfig.FLOAT(0,s(a.ConnectionPointType.FLOAT)),t.vec2=_.ParamConfig.VECTOR2([0,0],s(a.ConnectionPointType.VEC2)),t.vec3=_.ParamConfig.VECTOR3([0,0,0],s(a.ConnectionPointType.VEC3)),t.vec4=_.ParamConfig.VECTOR4([0,0,0,0],s(a.ConnectionPointType.VEC4)),t}return r.__extends(t,e),t}(_.NodeParamsConfig)),p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=c,t.gl_connections_controller=new u.GlConnectionsController(t),t._allow_inputs_created_from_params=!1,t}return r.__extends(t,e),t.type=function(){return"constant"},t.prototype.initialize_node=function(){var e=this;this.gl_connections_controller.initialize_node(),this.gl_connections_controller.set_output_name_function((function(e){return t.OUTPUT_NAME})),this.gl_connections_controller.set_expected_input_types_function((function(){return[]})),this.gl_connections_controller.set_expected_output_types_function((function(){return[e._current_connection_type]}))},t.prototype.set_lines=function(e){var t=this._current_param;if(t){var n=this._current_connection_type,r=i.ThreeToGl.any(t.value),o=n+" "+this._current_var_name+" = "+r;e.add_body_lines(this,[o])}else console.warn("no param found for constant node for type '"+this.pv.type+"'")},Object.defineProperty(t.prototype,"_current_connection_type",{get:function(){null==this.pv.type&&console.warn("constant gl node type if not valid");var e=a.ConnectionPointTypes[this.pv.type];return null==e&&console.warn("constant gl node type if not valid"),e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"_current_param",{get:function(){this._params_by_type=this._params_by_type||new Map([[a.ConnectionPointType.BOOL,this.p.bool],[a.ConnectionPointType.INT,this.p.int],[a.ConnectionPointType.FLOAT,this.p.float],[a.ConnectionPointType.VEC2,this.p.vec2],[a.ConnectionPointType.VEC3,this.p.vec3],[a.ConnectionPointType.VEC4,this.p.vec4]]);var e=a.ConnectionPointTypes[this.pv.type];return this._params_by_type.get(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"_current_var_name",{get:function(){return this.gl_var_name(t.OUTPUT_NAME)},enumerable:!0,configurable:!0}),t.OUTPUT_NAME="val",t}(o.TypedGlNode);t.ConstantGlNode=p},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(36),i=n(16),a=n(29);function s(e,t){void 0===t&&(t={});var n=t.method||e,s=t.out||"val",_=t.in||["in0","in1","in2"],u=t.default||{},c=t.out_type||i.ConnectionPointType.FLOAT,p=t.functions||[];return function(t){function o(){return null!==t&&t.apply(this,arguments)||this}return r.__extends(o,t),o.type=function(){return e},o.prototype.initialize_node=function(){t.prototype.initialize_node.call(this),this.gl_connections_controller.set_input_name_function(this._gl_input_name.bind(this)),this.gl_connections_controller.set_output_name_function(this._gl_output_name.bind(this)),this.gl_connections_controller.set_expected_output_types_function(this._expected_output_types.bind(this))},o.prototype._gl_input_name=function(e){return _[e]},o.prototype._gl_output_name=function(e){return s},o.prototype.gl_method_name=function(){return n},o.prototype._expected_output_types=function(){return[c]},o.prototype.gl_input_default_value=function(e){return u[e]},o.prototype.gl_function_definitions=function(){var e=this;return p.map((function(t){return new a.FunctionGLDefinition(e,c,t)}))},o}(o.BaseNodeGlMathFunctionArg3GlNode)}t.MathFunctionArg3Factory=s;var _=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t}(s("clamp",{in:["value","min","max"],default:{max:1}}));t.ClampGlNode=_;var u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t}(s("face_forward",{in:["N","I","Nref"]}));t.FaceforwardGlNode=u;var c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t}(s("smoothstep",{in:["edge0","edge1","x"]}));t.SmoothStepGlNode=c},function(e,t,n){"use strict";n.r(t),t.default="\nfloat fit01(float val, float src_min, float src_max){\n\tfloat size = src_max - src_min;\n\treturn (val - src_min) / size;\n}\nvec2 fit01(vec2 val, vec2 src_min, vec2 src_max){\n\treturn vec2(\n\t\tfit01(val.x, src_min.x, src_max.x),\n\t\tfit01(val.y, src_min.y, src_max.y)\n\t);\n}\nvec3 fit01(vec3 val, vec3 src_min, vec3 src_max){\n\treturn vec3(\n\t\tfit01(val.x, src_min.x, src_max.x),\n\t\tfit01(val.y, src_min.y, src_max.y),\n\t\tfit01(val.z, src_min.z, src_max.z)\n\t);\n}\nvec4 fit01(vec4 val, vec4 src_min, vec4 src_max){\n\treturn vec4(\n\t\tfit01(val.x, src_min.x, src_max.x),\n\t\tfit01(val.y, src_min.y, src_max.y),\n\t\tfit01(val.z, src_min.z, src_max.z),\n\t\tfit01(val.w, src_min.w, src_max.w)\n\t);\n}\n\nfloat fit(float val, float src_min, float src_max, float dest_min, float dest_max){\n\tfloat  src_range = src_max - src_min;\n\tfloat dest_range = dest_max - dest_min;\n\n\tfloat r = (val - src_min) / src_range;\n\treturn (r * dest_range) + dest_min;\n}\nvec2 fit(vec2 val, vec2 src_min, vec2 src_max, vec2 dest_min, vec2 dest_max){\n\treturn vec2(\n\t\tfit(val.x, src_min.x, src_max.x, dest_min.x, dest_max.x),\n\t\tfit(val.y, src_min.y, src_max.y, dest_min.y, dest_max.y)\n\t);\n}\nvec3 fit(vec3 val, vec3 src_min, vec3 src_max, vec3 dest_min, vec3 dest_max){\n\treturn vec3(\n\t\tfit(val.x, src_min.x, src_max.x, dest_min.x, dest_max.x),\n\t\tfit(val.y, src_min.y, src_max.y, dest_min.y, dest_max.y),\n\t\tfit(val.z, src_min.z, src_max.z, dest_min.z, dest_max.z)\n\t);\n}\nvec4 fit(vec4 val, vec4 src_min, vec4 src_max, vec4 dest_min, vec4 dest_max){\n\treturn vec4(\n\t\tfit(val.x, src_min.x, src_max.x, dest_min.x, dest_max.x),\n\t\tfit(val.y, src_min.y, src_max.y, dest_min.y, dest_max.y),\n\t\tfit(val.z, src_min.z, src_max.z, dest_min.z, dest_max.z),\n\t\tfit(val.w, src_min.w, src_max.w, dest_min.w, dest_max.w)\n\t);\n}\n"},function(e,t,n){"use strict";n.r(t),t.default="uniform float mNear;\nuniform float mFar;\n\nvarying float vViewZDepth;\n\nvoid main() {\n\n\tfloat color = 1.0 - smoothstep( mNear, mFar, vViewZDepth );\n\tgl_FragColor = vec4( vec3( color ), 1.0 );\n\n}\n"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(59),i=n(0),a=n(68),s=n(5),_=n(197),u=n(105),c=n(116),p=n(117),l=n(118),d=n(375);t.SHADER_DEFAULTS={metalness:1,roughness:.5};var f=new(function(e){function n(){var n=null!==e&&e.apply(this,arguments)||this;return n.metalness=s.ParamConfig.FLOAT(t.SHADER_DEFAULTS.metalness),n.roughness=s.ParamConfig.FLOAT(t.SHADER_DEFAULTS.roughness),n}return r.__extends(n,e),n}(d.TextureEnvMapParamConfig(l.TextureAlphaMapParamConfig(p.TextureMapParamConfig(c.SkinningParamConfig(u.SideParamConfig(_.ColorParamConfig(s.NodeParamsConfig)))))))),h=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=f,t.texture_map_controller=new p.TextureMapController(t,{direct_params:!0}),t.texture_alpha_map_controller=new l.TextureAlphaMapController(t,{direct_params:!0}),t.texture_env_map_controller=new d.TextureEnvMapController(t,{direct_params:!0}),t}return r.__extends(t,e),t.type=function(){return"mesh_standard"},t.prototype.create_material=function(){return new o.MeshStandardMaterial({vertexColors:!1,side:i.FrontSide,color:16777215,opacity:1,metalness:1,roughness:0})},t.prototype.initialize_node=function(){var e=this;this.params.set_post_create_params_hook((function(){e.texture_map_controller.initialize_node(),e.texture_alpha_map_controller.initialize_node(),e.texture_env_map_controller.initialize_node()}))},t.prototype.cook=function(){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(e){return _.ColorsController.update(this),u.SideController.update(this),c.SkinningController.update(this),this.texture_map_controller.update(),this.texture_alpha_map_controller.update(),this.texture_env_map_controller.update(),this._material&&(this._material.envMapIntensity=this.pv.env_map_intensity,this._material.roughness=this.pv.roughness,this._material.metalness=this.pv.metalness),this.set_material(this.material),[2]}))}))},t}(a.TypedMatNode);t.MeshStandardMatNode=h},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(9),i=n(135),a=n(68),s=n(273),_=n(5);function u(e){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.use_env_map=_.ParamConfig.BOOLEAN(0,s.BooleanParamOptions(c)),t.env_map=_.ParamConfig.OPERATOR_PATH(i.FileCopNode.DEFAULT_NODE_PATH.ENV_MAP,s.OperatorPathOptions(c,"use_env_map")),t.env_map_intensity=_.ParamConfig.FLOAT(1,{visible_if:{use_env_map:1}}),t}return r.__extends(t,e),t}(e)}t.TextureEnvMapParamConfig=u;(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}r.__extends(t,e)})(o.Material),function(e){function t(){return null!==e&&e.apply(this,arguments)||this}r.__extends(t,e)}(u(_.NodeParamsConfig)),function(e){function t(){return null!==e&&e.apply(this,arguments)||this}r.__extends(t,e)}(a.TypedMatNode);var c=function(e){function t(t,n){return e.call(this,t,n)||this}return r.__extends(t,e),t.prototype.initialize_node=function(){this.add_hooks(this.node.p.use_env_map,this.node.p.env_map)},t.prototype.update=function(){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(e){return this._update(this.node.material,"envMap",this.node.p.use_env_map,this.node.p.env_map),[2]}))}))},t.update=function(e){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(t){return e.texture_env_map_controller.update(),[2]}))}))},t}(s.BaseTextureMapController);t.TextureEnvMapController=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(5),i=n(198),a=n(105),s=n(116),_=n(117),u=n(118),c=n(781),p=n(199),l=n(132),d=new(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t}(u.TextureAlphaMapParamConfig(_.TextureMapParamConfig(s.SkinningParamConfig(a.SideParamConfig(i.ColorParamConfig(o.NodeParamsConfig))))))),f=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=d,t}return r.__extends(t,e),t.type=function(){return"points_builder"},t.prototype.initialize_node=function(){},t.prototype._create_assembler_controller=function(){return new l.GlAssemblerController(this,c.ShaderAssemblerPoints)},t.prototype.cook=function(){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(e){switch(e.label){case 0:return[4,this.compile_if_required()];case 1:return e.sent(),i.ColorsController.update(this),a.SideController.update(this),s.SkinningController.update(this),this.set_material(this.material),[2]}}))}))},t}(p.TypedBuilderMatNode);t.PointsBuilderMatNode=f},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=r.__importDefault(n(155)),i=n(84),a=n(69),s=n(812),_=n(205),u=n(206),c=n(815),p=n(136),l=n(27),d={type:"change"};t.BASE_CAMERA_DEFAULT={near:1,far:100};var f=n(94),h=n(206),m=n(136),y=n(205),v=n(5),g=n(83),b=n(69);function x(e){return function(e){function n(){var n=null!==e&&e.apply(this,arguments)||this;return n.camera=v.ParamConfig.FOLDER(),n.controls=v.ParamConfig.OPERATOR_PATH("",{node_selection:{context:l.NodeContext.EVENT}}),n.target=v.ParamConfig.VECTOR3([0,0,0],{cook:!1}),n.near=v.ParamConfig.FLOAT(t.BASE_CAMERA_DEFAULT.near,{range:[0,100]}),n.far=v.ParamConfig.FLOAT(t.BASE_CAMERA_DEFAULT.far,{range:[0,100]}),n.set_master_camera=v.ParamConfig.BUTTON(null,{callback:function(e,t){w.PARAM_CALLBACK_set_master_camera(e)}}),n}return r.__extends(n,e),n}(e)}t.CameraTransformParamConfig=x;var P=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t}(h.CameraPostProcessParamConfig(m.CameraBackgroundParamConfig(g.TransformedParamConfig(y.LayerParamConfig(x(v.NodeParamsConfig))))));t.BaseCameraObjParamsConfig=P;var T=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.render_order=a.ObjNodeRenderOrder.CAMERA,t._aspect=-1,t.transform_controller=new g.TransformController(t),t.flags=new f.FlagsControllerD(t),t}return r.__extends(t,e),Object.defineProperty(t.prototype,"object",{get:function(){return this._object},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"background_controller",{get:function(){return this._background_controller=this._background_controller||new this.background_controller_constructor(this)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"background_controller_constructor",{get:function(){return p.BaseBackgroundController},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"controls_controller",{get:function(){return this._controls_controller=this._controls_controller||new s.ControlsController(this)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"layers_controller",{get:function(){return this._layers_controller=this._layers_controller||new _.LayersController(this)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"post_process_controller",{get:function(){return this._post_process_controller=this._post_process_controller||new u.PostProcessController(this)},enumerable:!0,configurable:!0}),t.prototype.initialize_base_node=function(){e.prototype.initialize_base_node.call(this),this.io.outputs.set_has_one_output(),this.transform_controller.initialize_node()},t.prototype.cook=function(){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(e){switch(e.label){case 0:return this.transform_controller.update(),this.layers_controller.update(),[4,this.background_controller.update()];case 1:return e.sent(),this._object.near==this.pv.near&&this._object.far==this.pv.far||(this._object.near=this.pv.near,this._object.far=this.pv.far,this._object.updateProjectionMatrix()),[4,this.post_process_controller.update_composer_passes()];case 2:return e.sent(),this.update_camera(),this.controls_controller.update_controls(),this._object.dispatchEvent(d),this.cook_controller.end_cook(),[2]}}))}))},t.prototype.on_create=function(){},t.prototype.on_delete=function(){},t.prototype.camera=function(){return this._object},t.prototype.update_camera=function(){},t.PARAM_CALLBACK_set_master_camera=function(e){e.set_as_master_camera()},t.prototype.set_as_master_camera=function(){this.scene.cameras_controller.set_master_camera_node_path(this.full_path())},t.prototype.setup_for_aspect_ratio=function(e){o.default(e)||e&&this._aspect!=e&&(this._aspect=e,this._update_for_aspect_ratio())},t.prototype._update_for_aspect_ratio=function(){},t.prototype.update_transform_params_from_object=function(){i.CoreTransform.set_params_from_object(this._object,this)},t.prototype.create_viewer=function(e){return new c.ThreejsViewer(e,this.scene,this)},t}(b.TypedObjNode);t.TypedCameraObjNode=T;var w=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t}(T);t.BaseCameraObjNodeClass=w},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=r.__importDefault(n(91)),i=r.__importDefault(n(92)),a=r.__importDefault(n(155)),s=r.__importDefault(n(188)),_=r.__importDefault(n(82)),u=r.__importDefault(n(207)),c=n(1),p=n(40),l=n(58),d=n(276),f=n(53),h=n(114),m=n(49),y=n(35),v=function(){function e(){this.touch()}return e.prototype.timestamp=function(){return this._timestamp},e.prototype.touch=function(){this._timestamp=performance.now(),this.reset()},e.prototype.reset=function(){this._bounding_box=void 0,this._core_geometries=void 0,this._core_objects=void 0},e.prototype.clone=function(){var t=new e;if(this._objects){for(var n=[],r=0,o=this._objects;r<o.length;r++){var i=o[r];n.push(d.CoreObject.clone(i))}t.set_objects(n)}return t},e.prototype.set_objects=function(e){this._objects=e,this.touch()},e.prototype.objects=function(){return this._objects},e.prototype.core_objects=function(){return this._core_objects=this._core_objects||this._create_core_objects()},e.prototype._create_core_objects=function(){var e=[];if(this._objects)for(var t=function(t){n._objects[t].traverse((function(n){var r=new d.CoreObject(n,t);e.push(r)}))},n=this,r=0;r<this._objects.length;r++)t(r);return e},e.prototype.geometries=function(){for(var e=[],t=0,n=this.core_objects();t<n.length;t++){var r=n[t].object().geometry;r&&e.push(r)}return e},e.prototype.core_geometries=function(){return this._core_geometries=this._core_geometries||this.create_core_geometries()},e.prototype.create_core_geometries=function(){for(var e=[],t=0,n=this.geometries();t<n.length;t++){var r=n[t];e.push(new f.CoreGeometry(r))}return e},e.prototype.__geometry_from_object=function(e,t){if(t.geometry)return e.push(t.geometry)},e.geometry_from_object=function(e){return e.isMesh||e.isLine||e.isPoints?e.geometry:null},e.prototype.faces=function(){return _.default(this.core_geometries().map((function(e){return e.faces()})))},e.prototype.points=function(){return _.default(this.core_geometries().map((function(e){return e.points()})))},e.prototype.points_count=function(){return u.default(this.core_geometries().map((function(e){return e.points_count()})))},e.prototype.points_from_group=function(e){if(e){var t=m.CoreString.indices(e),n=this.points();return i.default(t.map((function(e){return n[e]})))}return this.points()},e.from_objects=function(t){var n=new e;return n.set_objects(t),n},e.prototype.objects_from_group=function(e){return this.core_objects_from_group(e).map((function(e){return e.object()}))},e.prototype.core_objects_from_group=function(e){if(""!==(e=s.default(e))){var t=parseInt(e);return a.default(t)?this.core_objects().filter((function(t){return m.CoreString.match_mask(e,t.name())})):i.default([this.core_objects()[t]])}return this.core_objects()},e.prototype.bounding_box=function(){return this._bounding_box=this._bounding_box||this._compute_bounding_box()},e.prototype.center=function(){var e=new c.Vector3;return this.bounding_box().getCenter(e),e},e.prototype.size=function(){var e=new c.Vector3;return this.bounding_box().getSize(e),e},e.prototype._compute_bounding_box=function(){var e;if(this._objects)for(var t=0,n=this._objects;t<n.length;t++){var r=n[t],o=r.geometry;o.computeBoundingBox(),e?e.expandByObject(r):o.boundingBox&&(e=o.boundingBox.clone())}return e=e||new l.Box3(new c.Vector3(-1,-1,-1),new c.Vector3(1,1,1))},e.prototype.compute_vertex_normals=function(){for(var e=0,t=this.core_objects();e<t.length;e++){t[e].compute_vertex_normals()}},e.prototype.has_attrib=function(e){var t;return null!=(t=this.core_geometries()[0])&&t.has_attrib(e)},e.prototype.attrib_type=function(e){var t=this.core_geometries()[0];return null!=t?t.attrib_type(e):null},e.prototype.rename_attrib=function(t,n,r){switch(r){case y.CoreConstant.ATTRIB_CLASS.VERTEX:if(this.has_attrib(t)&&this._objects)for(var o=0,i=this._objects;o<i.length;o++){i[o].traverse((function(r){var o=e.geometry_from_object(r);o&&new f.CoreGeometry(o).rename_attribute(t,n)}))}break;case y.CoreConstant.ATTRIB_CLASS.OBJECT:if(this.has_attrib(t)&&this._objects)for(var a=0,s=this._objects;a<s.length;a++){s[a].traverse((function(e){new d.CoreObject(e,0).rename_attribute(t,n)}))}}},e.prototype.attrib_names=function(){var e;return null!=(e=this.core_geometries()[0])?e.attrib_names():[]},e.prototype.object_attrib_names=function(){var e;return null!=(e=this.core_objects()[0])?e.attrib_names():[]},e.prototype.attrib_names_matching_mask=function(e){for(var t=m.CoreString.attrib_names(e),n=[],r=0,i=this.attrib_names();r<i.length;r++)for(var a=i[r],s=0,_=t;s<_.length;s++){var u=_[s];m.CoreString.match_mask(a,u)&&n.push(a)}return o.default(n)},e.prototype.attrib_sizes=function(){var e;return null!=(e=this.core_geometries()[0])?e.attrib_sizes():{}},e.prototype.attrib_size=function(e){var t;return null!=(t=this.core_geometries()[0])?t.attrib_size(e):0},e.prototype.add_numeric_vertex_attrib=function(e,t,n){null==n&&(n=h.CoreAttribute.default_value(t));for(var r=0,o=this.core_geometries();r<o.length;r++){o[r].add_numeric_attrib(e,t,n)}},e.prototype.add_numeric_object_attrib=function(e,t,n){null==n&&(n=h.CoreAttribute.default_value(t));for(var r=0,o=this.core_objects();r<o.length;r++){o[r].add_numeric_attrib(e,n)}},e.clone=function(e){var t=new p.Group;return e.children.forEach((function(e){var n=d.CoreObject.clone(e);t.add(n)})),t},e}();t.CoreGroup=v},,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,o=n(2),i=n(20),a=n(1),s=n(3),_=n(114),u=n(381),c="position",p="normal";!function(e){e.x="x",e.y="y",e.z="z",e.w="w",e.r="r",e.g="g",e.b="b"}(r||(r={}));var l={x:0,y:1,z:2,w:3,r:0,g:1,b:2},d=function(e){function t(t,n){var r=e.call(this,n)||this;return r._core_geometry=t,r._geometry=r._core_geometry.geometry(),r}return o.__extends(t,e),t.prototype.geometry_wrapper=function(){return this._core_geometry},t.prototype.geometry=function(){return this._geometry=this._geometry||this._core_geometry.geometry()},t.prototype.attrib_size=function(e){return e=_.CoreAttribute.remap_name(e),this._geometry.getAttribute(e).itemSize},t.prototype.has_attrib=function(e){var t=_.CoreAttribute.remap_name(e);return this._core_geometry.has_attrib(t)},t.prototype.attrib_value=function(e){if("ptnum"===e)return this.index;var t=null,n=null;"."===e[e.length-2]&&(t=e[e.length-1],n=l[t],e=e.substring(0,e.length-2));var r=_.CoreAttribute.remap_name(e),o=this._geometry.getAttribute(r);if(!o){var u="attrib "+e+" not found. availables are: "+Object.keys(this._geometry.attributes||{}).join(",");throw console.warn(u),u}var c=o.array;if(this._core_geometry.is_attrib_indexed(r)){var p=this.attrib_value_index(r);return this._core_geometry.user_data_attrib(r)[p]}var d=o.itemSize,f=this._index*d;if(null==n)switch(d){case 1:return c[f];case 2:return new s.Vector2(c[f+0],c[f+1]);case 3:return new a.Vector3(c[f+0],c[f+1],c[f+2]);case 4:return new i.Vector4(c[f+0],c[f+1],c[f+2],c[f+3]);default:throw"size not valid ("+d+")"}else switch(d){case 1:return c[f];default:return c[f+n]}},t.prototype.attrib_value_index=function(e){return this._core_geometry.is_attrib_indexed(e)?this._geometry.getAttribute(e).array[this._index]:-1},t.prototype.position=function(){var e=this._geometry.getAttribute(c).array;return this._position=this._position||new a.Vector3,this._position.fromArray(e,3*this._index)},t.prototype.set_position=function(e){this.set_attrib_value_vector3(c,e)},t.prototype.normal=function(){var e=this._geometry.getAttribute(p).array;return this._normal=this._normal||new a.Vector3,this._normal.fromArray(e,3*this._index)},t.prototype.set_normal=function(e){return this.set_attrib_value_vector3(p,e)},t.prototype.set_attrib_value=function(e,t){if(null!=t){if(null==e)throw"Point.set_attrib_value requires a name";var n=this._geometry.getAttribute(e),r=n.array,o=n.itemSize;switch(o){case 1:r[this._index]=t;break;case 2:var i=t;r[2*this._index+0]=i.x,r[2*this._index+1]=i.y;break;case 3:if(null!=t.r){var a=t;r[3*this._index+0]=a.r,r[3*this._index+1]=a.g,r[3*this._index+2]=a.b}else{var s=t;r[3*this._index+0]=s.x,r[3*this._index+1]=s.y,r[3*this._index+2]=s.z}break;default:throw console.warn("Point.set_attrib_value does not yet allow attrib size "+o),"attrib size "+o+" not implemented"}}},t.prototype.set_attrib_value_vector3=function(e,t){if(null!=t){if(null==e)throw"Point.set_attrib_value requires a name";var n=this._geometry.getAttribute(e).array,r=3*this._index;n[r]=t.x,n[r+1]=t.y,n[r+2]=t.z}},t.prototype.set_attrib_index=function(e,t){return this._geometry.getAttribute(e).array[this._index]=t},t}(u.CoreEntity);t.CorePoint=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this._index=e}return Object.defineProperty(e.prototype,"index",{get:function(){return this._index},enumerable:!0,configurable:!0}),e}();t.CoreEntity=r},,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=function(){function e(e){void 0===e&&(e={}),this._array_index=0,this._count=0,this._current_count_index=0,this._resolve=null,this._max_time_per_chunk=e.max_time_per_chunk||10,this._check_every_interations=e.check_every_interations||100}return e.prototype.start_with_count=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var n=this;return r.__generator(this,(function(r){if(this._count=e,this._current_count_index=0,this._iteratee_method_count=t,this._bound_next_with_count=this.next_with_count.bind(this),this._resolve)throw"an iterator cannot be started twice";return[2,new Promise((function(e,t){n._resolve=e,n.next_with_count()}))]}))}))},e.prototype.next_with_count=function(){var e=performance.now();if(this._iteratee_method_count&&this._bound_next_with_count)for(;this._current_count_index<this._count;)if(this._iteratee_method_count(this._current_count_index),this._current_count_index++,this._current_count_index%this._check_every_interations==0&&performance.now()-e>this._max_time_per_chunk){setTimeout(this._bound_next_with_count,1);break}this._current_count_index>=this._count&&this._resolve&&this._resolve()},e.prototype.start_with_array=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var n=this;return r.__generator(this,(function(r){if(this._array=e,this._array_index=0,this._iteratee_method_array=t,this._bound_next_with_array=this.next_with_array.bind(this),this._resolve)throw"an iterator cannot be started twice";return[2,new Promise((function(e,t){n._resolve=e,n.next_with_array()}))]}))}))},e.prototype.next_with_array=function(){var e=performance.now();if(this._iteratee_method_array&&this._bound_next_with_array&&this._array)for(;this._current_array_element=this._array[this._array_index];)if(this._iteratee_method_array(this._current_array_element,this._array_index),this._array_index++,this._array_index%this._check_every_interations==0&&performance.now()-e>this._max_time_per_chunk){setTimeout(this._bound_next_with_array,1);break}void 0===this._current_array_element&&this._resolve&&this._resolve()},e}();t.CoreIterator=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(104),o=n(3),i=n(4),a=n(6),s=function(){function e(){}return e.positions=function(e,t,n){void 0===n&&(n=360);for(var i=r.CoreMath.degrees_to_radians(n)/t,a=[],s=0;s<t;s++){var _=i*s,u=e*Math.cos(_),c=e*Math.sin(_);a.push(new o.Vector2(u,c))}return a},e.create=function(e,t,n){void 0===n&&(n=360);for(var r,o=this.positions(e,t,n),s=[],_=[],u=0;u<o.length;u++)r=o[u],s.push(r.x),s.push(r.y),s.push(0),u>0&&(_.push(u-1),_.push(u));_.push(t-1),_.push(0);var c=new a.BufferGeometry;return c.setAttribute("position",new i.Float32BufferAttribute(s,3)),c.setIndex(_),c},e}();t.CoreGeometryUtilCircle=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2).__importDefault(n(44)),o=n(1),i=n(3),a=n(42),s=n(15),_=n(294),u=n(228),c=n(53),p={SCALE:new o.Vector3(1,1,1),PSCALE:1,EYE:new o.Vector3(0,0,0),UP:new o.Vector3(0,1,0)},l=new o.Vector3(1,1,1),d=new i.Vector2(0,0),f=function(){function e(e){this._group_wrapper=e,this._matrices={},this._is_pscale_present=this._group_wrapper.has_attrib("pscale"),this._is_scale_present=this._group_wrapper.has_attrib("scale"),this._is_normal_present=this._group_wrapper.has_attrib("normal"),this._is_up_present=this._group_wrapper.has_attrib("up"),this._do_rotate_matrices=this._is_normal_present}return e.prototype.matrices=function(){var e=this;return this._matrices={},this._matrices.translate=new s.Matrix4,this._matrices.rotate=new s.Matrix4,this._matrices.scale=new s.Matrix4,this._group_wrapper.points().map((function(t){return e._matrix_from_point(t)}))},e.prototype._matrix_from_point=function(e){var t=e.position(),n=this._is_scale_present?e.attrib_value("scale"):p.SCALE,r=this._is_pscale_present?e.attrib_value("pscale"):p.PSCALE;n=n.clone().multiplyScalar(r);var o=new s.Matrix4;o.identity();var i=this._matrices.scale;i.makeScale(n.x,n.y,n.z);var a=this._matrices.translate;if(a.makeTranslation(t.x,t.y,t.z),o.multiply(a),this._do_rotate_matrices){var _=this._matrices.rotate,u=p.EYE,c=e.attrib_value("normal").multiplyScalar(-1),l=this._is_up_present?e.attrib_value("up"):p.UP;l.normalize(),_.lookAt(u,c,l),o.multiply(_)}return o.multiply(i),o},e.create_instance_buffer_geo=function(t,n,i){var s=n.points(),p=new _.InstancedBufferGeometry;p.copy(t);var f=s.length,h=new Float32Array(3*f),m=new Float32Array(3*f),y=new Float32Array(3*f),v=new Float32Array(4*f),g=n.has_attrib("color"),b=new o.Vector3(0,0,0),x=new a.Quaternion,P=new o.Vector3(1,1,1),T=new e(n).matrices();s.forEach((function(e,t){var n=3*t,r=4*t;T[t].decompose(b,x,P),b.toArray(h,n),x.toArray(v,r),P.toArray(y,n),(g?e.attrib_value("color"):l).toArray(m,n)}));var w=n.has_attrib("uv");if(w){var C=new Float32Array(2*f);s.forEach((function(e,t){var n=2*t;(w?e.attrib_value("uv"):d).toArray(C,n)})),p.setAttribute("instanceUv",new u.InstancedBufferAttribute(C,2))}return p.setAttribute("instancePosition",new u.InstancedBufferAttribute(h,3)),p.setAttribute("instanceScale",new u.InstancedBufferAttribute(y,3)),p.setAttribute("instanceOrientation",new u.InstancedBufferAttribute(v,4)),p.setAttribute("instanceColor",new u.InstancedBufferAttribute(m,3)),n.attrib_names_matching_mask(i).forEach((function(e){var t=n.attrib_size(e),o=new Float32Array(f*t);s.forEach((function(n,i){var a=n.attrib_value(e);r.default(a)?o[i]=a:a.toArray(o,i*t)})),p.setAttribute(e,new u.InstancedBufferAttribute(o,t))})),new c.CoreGeometry(p).mark_as_instance(),p},e}();t.CoreInstancer=f},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=r.__importDefault(n(21)),i=r.__importDefault(n(60)),a=r.__importDefault(n(45)),s=r.__importDefault(n(82)),_=n(96),u=n(4),c={BufferGeometry:n(6).BufferGeometry,Float32BufferAttribute:u.Float32BufferAttribute,Points:_.Points},p=n(49),l=n(53),d=n(35),f=n(858),h=n(114),m=function(){function e(e){void 0===e&&(e={}),this._attribute_datas_by_name={},this._options={},this._options.data_keys_prefix=e.data_keys_prefix,this._options.skip_entries=e.skip_entries,this._options.do_convert=e.do_convert||!1,this._options.convert_to_numeric=e.convert_to_numeric}return e.prototype.load=function(e,t,n,o){var i=this;fetch(e).then((function(e){return r.__awaiter(i,void 0,void 0,(function(){var n,o;return r.__generator(this,(function(r){switch(r.label){case 0:return n=this,[4,e.json()];case 1:return n._json=r.sent(),null!=this._options.data_keys_prefix&&""!=this._options.data_keys_prefix&&(this._json=this.get_prefixed_json(this._json,this._options.data_keys_prefix.split("."))),o=this.create_object(),t(o),[2]}}))}))})).catch((function(e){console.log("error",e),o(e)}))},e.prototype.get_prefixed_json=function(e,t){if(0==t.length)return e;var n=t.shift();return n?this.get_prefixed_json(e[n],t):[]},e.prototype.set_json=function(e){return this._json=e},e.prototype.create_object=function(){var e=new c.BufferGeometry,t=new l.CoreGeometry(e);if(null!=this._json){var n=this._json.length;t.init_position_attribute(n),this._find_attributes();for(var r=p.CoreString.attrib_names(this._options.convert_to_numeric||""),o=0,i=Object.keys(this._attribute_datas_by_name);o<i.length;o++){var _=i[o],u=s.default(this._attribute_values_for_name(_)),f=this._attribute_datas_by_name[_],m=f.size();if(f.type()===d.CoreConstant.ATTRIB_TYPE.STRING)if(this._options.do_convert&&p.CoreString.matches_one_mask(_,r)){var y=u.map((function(e){return a.default(e)?parseFloat(e)||0:e}));e.setAttribute(_,new c.Float32BufferAttribute(y,m))}else{var v=h.CoreAttribute.array_to_indexed_arrays(u);t.set_indexed_attribute(_,v.values,v.indices)}else{y=u;e.setAttribute(_,new c.Float32BufferAttribute(y,m))}}}return new c.Points(e,d.CoreConstant.MATERIALS[c.Points.name])},e.prototype._find_attributes=function(){var e,t=p.CoreString.attrib_names(this._options.skip_entries||"");if(this._json&&null!=(e=this._json[0]))for(var n=0,r=Object.keys(e);n<r.length;n++){var o=r[n],i=e[o];if(this._value_has_subentries(i))for(var a=0,s=Object.keys(i);a<s.length;a++){var _=[o,s[a]].join(":"),u=i[o];p.CoreString.matches_one_mask(_,t)||(this._attribute_datas_by_name[_]=f.CoreAttributeData.from_value(u))}else p.CoreString.matches_one_mask(o,t)||(this._attribute_datas_by_name[o]=f.CoreAttributeData.from_value(i))}},e.prototype._attribute_values_for_name=function(e){var t=this;return this._json?this._json.map((function(n){var r=e.split(":")[0],o=n[r];return t._value_has_subentries(o)?o[e.substring(r.length+1)]||0:o||0})):[]},e.prototype._value_has_subentries=function(e){return i.default(e)&&!o.default(e)},e}();t.JsonDataLoader=m},,function(e,t,n){"use strict";n.r(t),n.d(t,"DRACOLoader",(function(){return s}));var r=n(4),o=n(6),i=n(30),a=n(18),s=function(e){a.a.call(this,e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}};s.prototype=Object.assign(Object.create(a.a.prototype),{constructor:s,setDecoderPath:function(e){return this.decoderPath=e,this},setDecoderConfig:function(e){return this.decoderConfig=e,this},setWorkerLimit:function(e){return this.workerLimit=e,this},setVerbosity:function(){console.warn("THREE.DRACOLoader: The .setVerbosity() method has been removed.")},setDrawMode:function(){console.warn("THREE.DRACOLoader: The .setDrawMode() method has been removed.")},setSkipDequantization:function(){console.warn("THREE.DRACOLoader: The .setSkipDequantization() method has been removed.")},load:function(e,t,n,r){var o=new i.a(this.manager);o.setPath(this.path),o.setResponseType("arraybuffer"),"use-credentials"===this.crossOrigin&&o.setWithCredentials(!0),o.load(e,e=>{var n={attributeIDs:this.defaultAttributeIDs,attributeTypes:this.defaultAttributeTypes,useUniqueIDs:!1};this.decodeGeometry(e,n).then(t).catch(r)},n,r)},decodeDracoFile:function(e,t,n,r){var o={attributeIDs:n||this.defaultAttributeIDs,attributeTypes:r||this.defaultAttributeTypes,useUniqueIDs:!!n};this.decodeGeometry(e,o).then(t)},decodeGeometry:function(e,t){for(var n in t.attributeTypes){var r=t.attributeTypes[n];void 0!==r.BYTES_PER_ELEMENT&&(t.attributeTypes[n]=r.name)}var o,i=JSON.stringify(t);if(s.taskCache.has(e)){var a=s.taskCache.get(e);if(a.key===i)return a.promise;if(0===e.byteLength)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}var _=this.workerNextTaskID++,u=e.byteLength,c=this._getWorker(_,u).then(n=>(o=n,new Promise((n,r)=>{o._callbacks[_]={resolve:n,reject:r},o.postMessage({type:"decode",id:_,taskConfig:t,buffer:e},[e])}))).then(e=>this._createGeometry(e.geometry));return c.finally(()=>{o&&_&&this._releaseTask(o,_)}),s.taskCache.set(e,{key:i,promise:c}),c},_createGeometry:function(e){var t=new o.BufferGeometry;e.index&&t.setIndex(new r.BufferAttribute(e.index.array,1));for(var n=0;n<e.attributes.length;n++){var i=e.attributes[n],a=i.name,s=i.array,_=i.itemSize;t.setAttribute(a,new r.BufferAttribute(s,_))}return t},_loadLibrary:function(e,t){var n=new i.a(this.manager);return n.setPath(this.decoderPath),n.setResponseType(t),new Promise((t,r)=>{n.load(e,t,void 0,r)})},preload:function(){return this._initDecoder(),this},_initDecoder:function(){if(this.decoderPending)return this.decoderPending;var e="object"!=typeof WebAssembly||"js"===this.decoderConfig.type,t=[];return e?t.push(this._loadLibrary("draco_decoder.js","text")):(t.push(this._loadLibrary("draco_wasm_wrapper.js","text")),t.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(t).then(t=>{var n=t[0];e||(this.decoderConfig.wasmBinary=t[1]);var r=s.DRACOWorker.toString(),o=["/* draco decoder */",n,"","/* worker */",r.substring(r.indexOf("{")+1,r.lastIndexOf("}"))].join("\n");this.workerSourceURL=URL.createObjectURL(new Blob([o]))}),this.decoderPending},_getWorker:function(e,t){return this._initDecoder().then(()=>{var n;this.workerPool.length<this.workerLimit?((n=new Worker(this.workerSourceURL))._callbacks={},n._taskCosts={},n._taskLoad=0,n.postMessage({type:"init",decoderConfig:this.decoderConfig}),n.onmessage=function(e){var t=e.data;switch(t.type){case"decode":n._callbacks[t.id].resolve(t);break;case"error":n._callbacks[t.id].reject(t);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+t.type+'"')}},this.workerPool.push(n)):this.workerPool.sort((function(e,t){return e._taskLoad>t._taskLoad?-1:1}));return(n=this.workerPool[this.workerPool.length-1])._taskCosts[e]=t,n._taskLoad+=t,n})},_releaseTask:function(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]},debug:function(){console.log("Task load: ",this.workerPool.map(e=>e._taskLoad))},dispose:function(){for(var e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this}}),s.DRACOWorker=function(){var e,t;function n(e,t,n,r,o,i){var a,s,_=i.num_components(),u=n.num_points()*_;switch(o){case Float32Array:a=new e.DracoFloat32Array,t.GetAttributeFloatForAllPoints(n,i,a),s=new Float32Array(u);break;case Int8Array:a=new e.DracoInt8Array,t.GetAttributeInt8ForAllPoints(n,i,a),s=new Int8Array(u);break;case Int16Array:a=new e.DracoInt16Array,t.GetAttributeInt16ForAllPoints(n,i,a),s=new Int16Array(u);break;case Int32Array:a=new e.DracoInt32Array,t.GetAttributeInt32ForAllPoints(n,i,a),s=new Int32Array(u);break;case Uint8Array:a=new e.DracoUInt8Array,t.GetAttributeUInt8ForAllPoints(n,i,a),s=new Uint8Array(u);break;case Uint16Array:a=new e.DracoUInt16Array,t.GetAttributeUInt16ForAllPoints(n,i,a),s=new Uint16Array(u);break;case Uint32Array:a=new e.DracoUInt32Array,t.GetAttributeUInt32ForAllPoints(n,i,a),s=new Uint32Array(u);break;default:throw new Error("THREE.DRACOLoader: Unexpected attribute type.")}for(var c=0;c<u;c++)s[c]=a.GetValue(c);return e.destroy(a),{name:r,array:s,itemSize:_}}onmessage=function(r){var o=r.data;switch(o.type){case"init":e=o.decoderConfig,t=new Promise((function(t){e.onModuleLoaded=function(e){t({draco:e})},DracoDecoderModule(e)}));break;case"decode":var i=o.buffer,a=o.taskConfig;t.then(e=>{var t=e.draco,r=new t.Decoder,s=new t.DecoderBuffer;s.Init(new Int8Array(i),i.byteLength);try{var _=function(e,t,r,o){var i,a,s=o.attributeIDs,_=o.attributeTypes,u=t.GetEncodedGeometryType(r);if(u===e.TRIANGULAR_MESH)i=new e.Mesh,a=t.DecodeBufferToMesh(r,i);else{if(u!==e.POINT_CLOUD)throw new Error("THREE.DRACOLoader: Unexpected geometry type.");i=new e.PointCloud,a=t.DecodeBufferToPointCloud(r,i)}if(!a.ok()||0===i.ptr)throw new Error("THREE.DRACOLoader: Decoding failed: "+a.error_msg());var c={index:null,attributes:[]};for(var p in s){var l,d,f=self[_[p]];if(o.useUniqueIDs)d=s[p],l=t.GetAttributeByUniqueId(i,d);else{if(-1===(d=t.GetAttributeId(i,e[s[p]])))continue;l=t.GetAttribute(i,d)}c.attributes.push(n(e,t,i,p,f,l))}if(u===e.TRIANGULAR_MESH){for(var h=i.num_faces(),m=new Uint32Array(3*h),y=new e.DracoInt32Array,v=0;v<h;++v){t.GetFaceFromMesh(i,v,y);for(var g=0;g<3;++g)m[3*v+g]=y.GetValue(g)}c.index={array:m,itemSize:1},e.destroy(y)}return e.destroy(i),c}(t,r,s,a),u=_.attributes.map(e=>e.array.buffer);_.index&&u.push(_.index.array.buffer),self.postMessage({type:"decode",id:o.id,geometry:_},u)}catch(e){console.error(e),self.postMessage({type:"error",id:o.id,error:e.message})}finally{t.destroy(s),t.destroy(r)}})}}},s.taskCache=new WeakMap,s.setDecoderPath=function(){console.warn("THREE.DRACOLoader: The .setDecoderPath() method has been removed. Use instance methods.")},s.setDecoderConfig=function(){console.warn("THREE.DRACOLoader: The .setDecoderConfig() method has been removed. Use instance methods.")},s.releaseDecoderModule=function(){console.warn("THREE.DRACOLoader: The .releaseDecoderModule() method has been removed. Use instance methods.")},s.getDecoderModule=function(){console.warn("THREE.DRACOLoader: The .getDecoderModule() method has been removed. Use instance methods.")}},,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(4),i=n(53),a=r.__importDefault(n(82)),s=r.__importDefault(n(361)),_=r.__importDefault(n(357)),u=function(){function e(e,t,n){this.geometry=e,this.geometry1=t,this.geometry0=n}return e.prototype.process=function(){var e=this,t=new i.CoreGeometry(this.geometry0),n=new i.CoreGeometry(this.geometry1),r=t.segments(),u=n.segments();if(0!==r.length&&0!==u.length){var c=r.length<u.length?[t,n]:[n,t],p=c[0],l=c[1],d=p.segments(),f=l.segments(),h=p.points(),m=l.points(),y=h.length,v=_.default(h,m),g=[];d.forEach((function(e,t){var n=f[t];g.push(e[0]),g.push(e[1]),g.push(n[0]+y),g.push(e[1]),g.push(n[1]+y),g.push(n[0]+y)})),s.default(p.attrib_names(),l.attrib_names()).forEach((function(t){var n=p.attrib_size(t),r=v.map((function(e){return e.attrib_value(t)}));n>1&&(r=a.default(r.map((function(e){return e.toArray()})))),e.geometry.setAttribute(t,new o.Float32BufferAttribute(r,n))})),this.geometry.setIndex(g),this.geometry.computeVertexNormals()}},e}();t.CoreGeometryOperationSkin=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(1007),o=n(218),i=n(1008),a=n(1009),s=n(1010),_=n(156),u=n(265),c=n(128),p=function(){function e(){}return e.dispatch_node=function(e){return new r.NodeJsonImporter(e)},e.dispatch_param=function(e){return e instanceof _.TypedMultipleParam?new i.ParamMultipleJsonImporter(e):e instanceof u.StringParam?new a.ParamStringJsonImporter(e):e instanceof c.RampParam?new s.ParamRampJsonImporter(e):new o.ParamJsonImporter(e)},e}();t.JsonImportDispatcher=p},,,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(296);n(638).AllRegister.run();var i=n(193),a=r.__importDefault(n(1005)),s=n(1006),_=function(){function e(){}return e.load_scene=function(){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(e){switch(e.label){case 0:return[4,s.SceneJsonImporter.load_data(a.default)];case 1:return[2,e.sent()]}}))}))},e.create_scene=function(){var e=new o.PolyScene;e.root.create_node("ambient_light"),e.loading_controller.mark_as_loaded();var t=e.root.create_node("perspective_camera");e.cameras_controller.set_master_camera_node_path(t.full_path()),t.p.t.z.set(10);var n=e.root.create_node("geo");return n.flags.display.set(!0),n.create_node("box").flags.display.set(!0),n.p.r.y.set("$F+20"),e},e.test_save_and_load=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,n,o;return r.__generator(this,(function(r){switch(r.label){case 0:return t=new i.SceneJsonExporter(e).data(),console.log(JSON.stringify(t)),[4,s.SceneJsonImporter.load_data(t)];case 1:return n=r.sent(),o=new i.SceneJsonExporter(n).data(),console.log(JSON.stringify(o)),[2]}}))}))},e}();t.Tester=_;var u=document.createElement("style");u.innerText="html, body, canvas, .canvas_container {height: 100%; margin: 0px;} canvas {display: block;}",document.body.appendChild(u);var c=document.createElement("div");c.classList.add("canvas_container"),document.body.appendChild(c),_.load_scene().then((function(e){var t;window.scene=e,null===(t=e.cameras_controller.master_camera_node)||void 0===t||t.create_viewer(c),e.play()}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this.scene=e,this._master_camera_node_path=null}return e.prototype.set_master_camera_node_path=function(e){this._master_camera_node_path=e},Object.defineProperty(e.prototype,"master_camera_node_path",{get:function(){return this._master_camera_node_path},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"master_camera_node",{get:function(){return this.master_camera_node_path?this.scene.node(this.master_camera_node_path):(console.warn("master camera node not found"),this._find_any_camera())},enumerable:!0,configurable:!0}),e.prototype._find_any_camera=function(){var e=this.scene.root;return e.nodes_by_type("perspective_camera")[0]||e.nodes_by_type("orthographic_camera")[0]},e}();t.CamerasController=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this._scene=e,this._queue=new Map,this._block_level=0,this._process_item_bound=this._process_item.bind(this),this._block_level=0}return e.prototype.block=function(){this._block_level+=1},e.prototype.unblock=function(){this._block_level-=1,this._block_level<0&&(this._block_level=0),this.process_queue()},Object.defineProperty(e.prototype,"blocked",{get:function(){return this._block_level>0},enumerable:!0,configurable:!0}),e.prototype.enqueue=function(e,t){this._queue.set(e.graph_node_id,t)},e.prototype.process_queue=function(){this.blocked||this._queue.forEach(this._process_item_bound)},e.prototype._process_item=function(e,t){var n=this._scene.graph.node_from_id(t);n&&(this._queue.delete(t),n.dirty_controller.run_post_dirty_hooks(e))},e}();t.Cooker=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(419),o=function(){function e(){this._next_id=0,this._graph=new r.Graph({directed:!0,compound:!1,multigraph:!0})}return e.prototype.graph=function(){return this._graph},e.prototype.set_scene=function(e){this._scene=e},e.prototype.scene=function(){return this._scene},e.prototype.next_id=function(){return""+(this._next_id+=1)},e.prototype.setNode=function(e){this._graph.setNode(e.graph_node_id,e)},e.prototype.removeNode=function(e){this._graph.removeNode(e.graph_node_id)},e.prototype.nodes_from_ids=function(e){for(var t=[],n=0,r=e;n<r.length;n++){var o=r[n],i=this.node_from_id(o);i&&t.push(i)}return t},e.prototype.node_from_id=function(e){return this._graph.node(e)},e.prototype.connect=function(e,t){var n=e.graph_node_id,o=t.graph_node_id;if(this._graph.hasNode(n)&&this._graph.hasNode(o)){this._graph.setEdge(n,o);var i=!1;return!(!this._scene||this._scene.loading_controller.is_loading)&&(i=!r.alg.isAcyclic(this._graph)),i?(this._graph.removeEdge(n,o),!1):(e.dirty_controller.clear_successors_cache_with_predecessors(),!0)}return console.warn("attempt to connect non existing node "+n+" or "+o),!1},e.prototype.disconnect=function(e,t){if(e&&t){var n=e.graph_node_id,r=t.graph_node_id;this._graph.removeEdge(n,r),e.dirty_controller.clear_successors_cache_with_predecessors()}},e.prototype.disconnect_predecessors=function(e){for(var t=0,n=this.predecessors(e);t<n.length;t++){var r=n[t];this.disconnect(r,e)}},e.prototype.disconnect_successors=function(e){for(var t=0,n=this.successors(e);t<n.length;t++){var r=n[t];this.disconnect(e,r)}},e.prototype.predecessor_ids=function(e){return this._graph.predecessors(e)||[]},e.prototype.predecessors=function(e){var t=this.predecessor_ids(e.graph_node_id);return this.nodes_from_ids(t)},e.prototype.successor_ids=function(e){return this._graph.successors(e)||[]},e.prototype.successors=function(e){var t=this.successor_ids(e.graph_node_id)||[];return this.nodes_from_ids(t)},e.prototype.all_next_ids=function(e,t){for(var n=[],r=this[t](e.graph_node_id);r.length>0;){for(var o=[],i=0,a=r;i<a.length;i++)for(var s=a[i],_=0,u=this[t](s);_<u.length;_++){var c=u[_];o.push(c)}for(var p=0,l=r;p<l.length;p++){var d=l[p];n.push(d)}for(var f=0,h=o;f<h.length;f++){d=h[f];r.push(d)}r=o}return n},e.prototype.all_predecessor_ids=function(e){return this.all_next_ids(e,"predecessor_ids")},e.prototype.all_successor_ids=function(e){return this.all_next_ids(e,"successor_ids")},e.prototype.all_predecessors=function(e){var t=this.all_predecessor_ids(e);return this.nodes_from_ids(t)},e.prototype.all_successors=function(e){var t=this.all_successor_ids(e);return this.nodes_from_ids(t)},e}();t.CoreGraph=o},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=function(){function e(){this._cooking_nodes_by_id=new Map,this._resolves=[]}return e.prototype.add_node=function(e){this._cooking_nodes_by_id.set(e.graph_node_id,e)},e.prototype.remove_node=function(e){this._cooking_nodes_by_id.delete(e.graph_node_id),0==this._cooking_nodes_by_id.size&&this.flush()},e.prototype.flush=function(){for(var e;e=this._resolves.pop();)e()},e.prototype.wait_for_cooks_completed=function(){return r.__awaiter(this,void 0,void 0,(function(){var e=this;return r.__generator(this,(function(t){return 0==this._cooking_nodes_by_id.size?[2]:[2,new Promise((function(t,n){e._resolves.push(t)}))]}))}))},e}();t.CookController=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n(66);var r=n(66),o=function(){function e(e){this.scene=e}return e.prototype.set_listener=function(e){this._events_listener=e},Object.defineProperty(e.prototype,"events_listener",{get:function(){return this._events_listener},enumerable:!0,configurable:!0}),e.prototype.dispatch=function(e,t,n){var r;null===(r=this._events_listener)||void 0===r||r.process_events(e,t,n)},Object.defineProperty(e.prototype,"emit_allowed",{get:function(){return this.scene.loading_controller.loaded&&null!=this._events_listener&&this.scene.loading_controller.auto_updating&&!r.POLY.player_mode()},enumerable:!0,configurable:!0}),e}();t.DispatchController=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o={antialias:!0},i=function(){function e(){this._next_renderer_id=0,this._next_env_map_id=0,this._renderers={},this._env_maps={},this._require_webgl2=!1,this._resolves=[]}return e.prototype.set_require_webgl2=function(){this._require_webgl2||(this._require_webgl2=!0)},e.prototype.rendering_context=function(e){var t=null;return this._require_webgl2&&(t=this._rendering_context_webgl(e,!0)),t||(t=this._rendering_context_webgl(e,!1)),t},e.prototype._rendering_context_webgl=function(e,t){var n=t?"webgl2":"webgl",r=e.getContext(n,o);return r||(n=t?"experimental-webgl2":"experimental-webgl",r=e.getContext(n,o)),r},e.prototype.register_renderer=function(e){if(e._polygon_id)throw new Error("render already registered");e._polygon_id=this._next_renderer_id+=1,this._renderers[e._polygon_id]=e,1==Object.keys(this._renderers).length&&this.flush_callbacks_with_renderer(e)},e.prototype.deregister_renderer=function(e){delete this._renderers[e._polygon_id],e.dispose()},e.prototype.first_renderer=function(){var e=Object.keys(this._renderers)[0];return e?this._renderers[e]:null},e.prototype.renderers=function(){return Object.values(this._renderers)},e.prototype.flush_callbacks_with_renderer=function(e){for(var t;t=this._resolves.pop();)t(e)},e.prototype.wait_for_renderer=function(){return r.__awaiter(this,void 0,void 0,(function(){var e,t=this;return r.__generator(this,(function(n){return(e=this.first_renderer())?[2,e]:[2,new Promise((function(e,n){t._resolves.push(e)}))]}))}))},e}();t.RenderersController=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){this._node_register={},this._node_register_categories={},this._node_register_options={}}return e.prototype.register_node=function(e,t,n){var r=e.node_context(),o=e.type();if(this._node_register[r]=this._node_register[r]||{},this._node_register[r][o])throw new Error("node "+r+"/"+o+" already registered");this._node_register[r][o]=e,t&&(this._node_register_categories[r]=this._node_register_categories[r]||{},this._node_register_categories[r][o]=t),this._node_register_options[r]=this._node_register_options[r]||{},n&&(this._node_register_options[r][o]=n)},e.prototype.deregister_node=function(e,t){delete this._node_register[e][t],delete this._node_register_categories[e][t],delete this._node_register_options[e][t]},e.prototype.registered_nodes_for_context_and_parent_type=function(e,t){var n=this;return this._node_register[e]?Object.values(this._node_register[e]).filter((function(r){var o,i=n._node_register_options[e][r.type()];if(!i)return!0;var a=i.only,s=i.except,_=e+"/"+t;return a?a.includes(_):s?!s.includes(_):!i||(null===(o=i.only)||void 0===o?void 0:o.includes(t))})):[]},e.prototype.registered_nodes=function(e,t){for(var n={},r=0,o=this.registered_nodes_for_context_and_parent_type(e,t);r<o.length;r++){var i=o[r];n[i.type()]=i}return n},e.prototype.registered_category=function(e,t){return this._node_register_categories[e][t]},e}();t.NodesRegister=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(338),o=n(356),i=function(){function e(e){this._mouse_events_controller=new o.MouseEventsController,this._controllers=[this._mouse_events_controller]}return e.prototype.register_event_node=function(e){var t=this._get_controller_for_node(e);t&&t.register_node(e)},e.prototype.unregister_event_node=function(e){var t=this._get_controller_for_node(e);t&&t.unregister_node(e)},e.prototype.process_event=function(e,t,n){for(var r=0,o=this._controllers;r<o.length;r++){var i=o[r];if(i.accepts_event(e))return void i.process(e,t,n)}},e.prototype._get_controller_for_node=function(e){switch(e.type){case r.MouseEventNode.type():return this._mouse_events_controller}},e}();t.EventsController=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this.node=e,this._dirty_count=0,this._dirty=!0}return Object.defineProperty(e.prototype,"is_dirty",{get:function(){return!0===this._dirty},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dirty_timestamp",{get:function(){return this._dirty_timestamp},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dirty_count",{get:function(){return this._dirty_count},enumerable:!0,configurable:!0}),e.prototype.add_post_dirty_hook=function(e,t){this._post_dirty_hook_names=this._post_dirty_hook_names||[],this._post_dirty_hooks=this._post_dirty_hooks||[],this._post_dirty_hook_names.includes(e)?console.warn("hook with name "+e+" already exists",this.node):(this._post_dirty_hook_names.push(e),this._post_dirty_hooks.push(t))},e.prototype.remove_post_dirty_hook=function(e){if(this._post_dirty_hook_names&&this._post_dirty_hooks){var t=this._post_dirty_hook_names.indexOf(e);t>=0&&(this._post_dirty_hook_names.splice(t,1),this._post_dirty_hooks.splice(t,1))}},e.prototype.has_hook=function(e){return!!this._post_dirty_hook_names&&this._post_dirty_hook_names.includes(e)},e.prototype.remove_dirty_state=function(){this._dirty=!1},e.prototype.set_forbidden_trigger_nodes=function(e){this._forbidden_trigger_nodes=e.map((function(e){return e.graph_node_id}))},e.prototype.set_dirty=function(e,t){null==t&&(t=!0),e&&this._forbidden_trigger_nodes&&this._forbidden_trigger_nodes.includes(e.graph_node_id)||(null==e&&(e=this.node),this._dirty=!0,this._dirty_timestamp=performance.now(),this._dirty_count+=1,this.run_post_dirty_hooks(e),!0===t&&this.set_successors_dirty(e))},e.prototype.run_post_dirty_hooks=function(e){if(this._post_dirty_hooks){var t=this.node.scene.cooker;if(t.blocked)t.enqueue(this.node,e);else for(var n=0,r=this._post_dirty_hooks;n<r.length;n++){(0,r[n])(e)}}},e.prototype.set_successors_dirty=function(e){this._cached_successors=this._cached_successors||this.node.graph_all_successors();for(var t=0,n=this._cached_successors;t<n.length;t++){n[t].dirty_controller.set_dirty(e,!1)}},e.prototype.clear_successors_cache=function(){this._cached_successors=void 0},e.prototype.clear_successors_cache_with_predecessors=function(){this.clear_successors_cache();for(var e=0,t=this.node.graph_all_predecessors();e<t.length;e++){t[e].dirty_controller.clear_successors_cache()}},e}();t.DirtyController=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=n(7),i=n(61),a=function(){function e(e,t,n){void 0===t&&(t=0),void 0===n&&(n=0),this.node=e,this._position=new r.Vector2,this._width=50,this._border_radius=3,this._color=new o.Color(.75,.75,.75),this._layout_vertical=!0,this._json={x:0,y:0},this._position.x=t,this._position.y=n}return e.prototype.set_border_radius=function(e){this._border_radius=e},e.prototype.border_radius=function(){return this._border_radius},e.prototype.set_width=function(e){this._width=e},e.prototype.width=function(){return this._width},e.prototype.set_comment=function(e){this._comment=e,this.node.emit(i.NodeEvent.UI_DATA_COMMENT_UPDATED)},Object.defineProperty(e.prototype,"comment",{get:function(){return this._comment},enumerable:!0,configurable:!0}),e.prototype.set_color=function(e){this._color=e},e.prototype.color=function(){return this._color},e.prototype.set_layout_horizontal=function(){this._layout_vertical=!1},e.prototype.is_layout_vertical=function(){return this._layout_vertical},e.prototype.copy=function(e){this._position.copy(e.position),this._color.copy(e.color())},Object.defineProperty(e.prototype,"position",{get:function(){return this._position},enumerable:!0,configurable:!0}),e.prototype.set_position=function(e,t){if(void 0===t&&(t=0),e instanceof r.Vector2)this._position.copy(e);else{var n=e;this._position.set(n,t)}this.node.emit(i.NodeEvent.UI_DATA_POSITION_UPDATED)},e.prototype.translate=function(e,t){void 0===t&&(t=!1),this._position.add(e),t&&(this._position.x=Math.round(this._position.x),this._position.y=Math.round(this._position.y)),this.node.emit(i.NodeEvent.UI_DATA_POSITION_UPDATED)},e.prototype.to_json=function(){return this._json.x=this._position.x,this._json.y=this._position.y,this._json.comment=this._comment,this._json},e}();t.UIData=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(537),o=n(538),i=function(e){this.node=e,this.time_dependent=new r.TimeDependentState(this.node),this.error=new o.ErrorState(this.node)};t.StatesController=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),Object.defineProperty(t.prototype,"active",{get:function(){return this.are_params_time_dependent()||this.are_inputs_time_dependent()},enumerable:!0,configurable:!0}),t.prototype.are_params_time_dependent=function(){for(var e=0,t=this.node.params.names;e<t.length;e++){var n=t[e],r=this.node.params.get(n);if(r&&r.states.time_dependent.active)return!0}return!1},t.prototype.are_inputs_time_dependent=function(){for(var e=0,t=this.node.io.inputs.inputs();e<t.length;e++){var n=t[e];if(n&&n.states.time_dependent.active)return!0}return!1},t.prototype.force_time_dependent=function(){var e=this.node.graph_predecessors().map((function(e){return e.graph_node_id})),t=this.node.scene.time_controller.graph_node;e.includes(t.graph_node_id)||this.node.add_graph_input(t)},t.prototype.unforce_time_dependent=function(){var e=this.node.scene.time_controller.graph_node;this.node.remove_graph_input(e)},t}(n(339).BaseState);t.TimeDependentState=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(61),i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.set=function(e){this._message!=e&&(console.warn("error",e,this.node.full_path()),this._message=e,this.on_update())},Object.defineProperty(t.prototype,"message",{get:function(){return this._message},enumerable:!0,configurable:!0}),t.prototype.clear=function(){this.set(void 0)},Object.defineProperty(t.prototype,"active",{get:function(){return null!=this._message},enumerable:!0,configurable:!0}),t.prototype.on_update=function(){null!=this._message&&this.node.set_container(null,"from error '"+this._message+"'"),this.node.emit(o.NodeEvent.ERROR_UPDATED)},t}(n(339).BaseState);t.ErrorState=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(258),o=n(101),i=function(){function e(e){this.node=e,this._parent=null}return Object.defineProperty(e.prototype,"parent",{get:function(){return this._parent},enumerable:!0,configurable:!0}),e.prototype.set_parent=function(e){e!=this.node.parent_controller.parent&&(this._parent=e,this._parent&&this.node.name_controller.request_name_to_parent(r.NameController.base_name(this.node)))},e.prototype.is_selected=function(){var e,t,n;return(null===(n=null===(t=null===(e=this.parent)||void 0===e?void 0:e.children_controller)||void 0===t?void 0:t.selection)||void 0===n?void 0:n.contains(this.node))||!1},e.prototype.full_path=function(){var e=o.CoreWalker.SEPARATOR;if(null!=this._parent){var t=this._parent.full_path();return t===e?t+this.node.name:t+e+this.node.name}return e},e.prototype.on_set_parent=function(){if(this._on_set_parent_hooks)for(var e=0,t=this._on_set_parent_hooks;e<t.length;e++){(0,t[e])()}},e.prototype.find_node=function(e){if(null==e)return null;if(e===o.CoreWalker.CURRENT||e===o.CoreWalker.CURRENT_WITH_SLASH)return this.node;if(e===o.CoreWalker.PARENT||e===o.CoreWalker.PARENT_WITH_SLASH)return this.node.parent;var t=o.CoreWalker.SEPARATOR;e[0]===t&&(e=e.substring(1,e.length));var n=e.split(t);if(1===n.length){var r=n[0];return this.node.children_controller?this.node.children_controller.child_by_name(r):null}return o.CoreWalker.find_node(this.node,e)},e}();t.HierarchyParentController=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(49),i=n(67),a=r.__importDefault(n(345)),s=r.__importDefault(n(99)),_=r.__importDefault(n(102)),u=r.__importDefault(n(256)),c=n(61),p=n(258),l=n(565),d=n(66),f=function(){function e(e,t){this.node=e,this._context=t,this._children={},this._children_by_type={},this._children_and_grandchildren_by_context={},this._is_dependent_on_children=!1}return Object.defineProperty(e.prototype,"selection",{get:function(){return this._selection=this._selection||new l.CoreNodeSelection(this.node)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"context",{get:function(){return this._context},enumerable:!0,configurable:!0}),e.prototype.init=function(e){void 0===e&&(e=!1),this._children={},e&&(this._is_dependent_on_children=e,this._is_dependent_on_children&&(this._children_node=new i.CoreGraphNode(this.node.scene,"children"),this.node.add_graph_input(this._children_node)))},e.prototype.set_child_name=function(e,t){var n;if(t=(t=t.replace(/[^A-Za-z0-9]/g,"_")).replace(/^[0-9]/,"_"),null!=(n=this._children[t])){if(e.name===t&&n.graph_node_id===e.graph_node_id)return;return t=o.CoreString.increment(t),this.set_child_name(e,t)}var r=e.name;this._children[r]&&delete this._children[r],this._children[t]=e,e.name_controller.update_name_from_parent(t),this._add_to_nodes_by_type(e),this.node.scene.nodes_controller.add_to_instanciated_node(e)},e.prototype.node_context_signature=function(){return this.node.node_context()+"/"+this.node.type},e.prototype.available_children_classes=function(){return d.POLY.registered_nodes(this._context,this.node.type)},e.prototype.is_valid_child_type=function(e){return null!=this.available_children_classes()[e]},e.prototype.create_node=function(e){var t=this.available_children_classes()[e];if(null==t){var n="child node type '"+e+"' not found for node '"+this.node.full_path()+"'. Available types are: "+Object.keys(this.available_children_classes()).join(", ")+", "+this._context+", "+this.node.type;throw console.error(n),n}var r=new t(this.node.scene,"child_node_"+e);return r.initialize_base_and_node(),this.add_node(r),r.lifecycle.set_creation_completed(),r},e.prototype.add_node=function(e){if(e.set_parent(this.node),e.params.init(),e.parent_controller.on_set_parent(),e.name_controller.post_set_full_path(),e.children_allowed()&&e.children_controller)for(var t=0,n=e.children_controller.children();t<n.length;t++){n[t].name_controller.post_set_full_path()}return this.node.emit(c.NodeEvent.CREATED,{child_node_json:e.to_json()}),this.node.scene.lifecycle_controller.on_create_hook_allowed()&&e.lifecycle.run_on_create_hooks(),e.lifecycle.run_on_add_hooks(),this.set_child_name(e,p.NameController.base_name(e)),this.node.lifecycle.run_on_child_add_hooks(e),this._is_dependent_on_children&&this._children_node&&this._children_node.add_graph_input(e),e.require_webgl2()&&this.node.scene.webgl_controller.set_require_webgl2(),this.node.scene.missing_expression_references_controller.check_for_missing_references(e),e},e.prototype.remove_node=function(e){var t,n;if(e.parent!=this.node)return console.warn("node "+e.name+" not under parent "+this.node.full_path());e.set_successors_dirty(this.node),this._is_dependent_on_children&&this._children_node&&this._children_node.remove_graph_input(e),this.selection.contains(e)&&this.selection.remove([e]);var r=e.io.connections.first_input_connection();null===(t=e.io.connections.input_connections())||void 0===t||t.forEach((function(e){e&&e.disconnect({set_input:!0})})),null===(n=e.io.connections.output_connections())||void 0===n||n.forEach((function(e){if(e&&(e.disconnect({set_input:!0}),r)){var t=r.node_src,n=e.output_index,o=e.node_dest,i=e.input_index;o.io.inputs.set_input(i,t,n)}})),e.graph_disconnect_successors(),e.set_parent(null),delete this._children[e.name],this._remove_from_nodes_by_type(e),this.node.scene.nodes_controller.remove_from_instanciated_node(e),this.node.lifecycle.run_on_child_remove_hooks(e),e.lifecycle.run_on_delete_hooks(),e.emit(c.NodeEvent.DELETED,{parent_id:this.node.graph_node_id})},e.prototype._add_to_nodes_by_type=function(e){var t=e.graph_node_id,n=e.type;this._children_by_type[n]=this._children_by_type[n]||[],a.default(this._children_by_type[n],t)||this._children_by_type[n].push(t),this.add_to_children_and_grandchildren_by_context(e)},e.prototype._remove_from_nodes_by_type=function(e){var t=e.graph_node_id,n=e.type;if(this._children_by_type[n]){var r=this._children_by_type[n].indexOf(t);r>=0&&(this._children_by_type[n].splice(r,1),0==this._children_by_type[n].length&&delete this._children_by_type[n])}this.remove_from_children_and_grandchildren_by_context(e)},e.prototype.add_to_children_and_grandchildren_by_context=function(e){var t,n=e.graph_node_id,r=e.node_context();this._children_and_grandchildren_by_context[r]=this._children_and_grandchildren_by_context[r]||[],a.default(this._children_and_grandchildren_by_context[r],n)||this._children_and_grandchildren_by_context[r].push(n),this.node.parent&&this.node.parent.children_allowed()&&(null===(t=this.node.parent.children_controller)||void 0===t||t.add_to_children_and_grandchildren_by_context(e))},e.prototype.remove_from_children_and_grandchildren_by_context=function(e){var t,n=e.graph_node_id,r=e.node_context();if(this._children_and_grandchildren_by_context[r]){var o=this._children_and_grandchildren_by_context[r].indexOf(n);o>=0&&(this._children_and_grandchildren_by_context[r].splice(o,1),0==this._children_and_grandchildren_by_context[r].length&&delete this._children_and_grandchildren_by_context[r])}this.node.parent&&this.node.parent.children_allowed()&&(null===(t=this.node.parent.children_controller)||void 0===t||t.remove_from_children_and_grandchildren_by_context(e))},e.prototype.nodes_by_type=function(e){var t=this._children_by_type[e]||[],n=this.node.scene.graph,r=[];return t.forEach((function(e){var t=n.node_from_id(e);t&&r.push(t)})),r},e.prototype.child_by_name=function(e){return this._children[e]},e.prototype.has_children_and_grandchildren_with_context=function(e){return null!=this._children_and_grandchildren_by_context[e]},e.prototype.children=function(){return u.default(this._children)},e.prototype.children_names=function(){return _.default(s.default(this._children))},e.prototype.traverse_children=function(e){for(var t,n=0,r=this.children();n<r.length;n++){var o=r[n];e(o),null===(t=o.children_controller)||void 0===t||t.traverse_children(e)}},e}();t.HierarchyChildrenController=f},,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=r.__importDefault(n(346)),i=r.__importDefault(n(331)),a=r.__importDefault(n(347)),s=n(61),_=function(){function e(e){this._node=e,this._node_ids=[],this._json=[]}return e.prototype.node=function(){return this._node},e.prototype.nodes=function(){return this._node.scene.graph.nodes_from_ids(this._node_ids)},e.prototype.contains=function(e){return this._node_ids.includes(e.graph_node_id)},e.prototype.equals=function(e){var t=e.map((function(e){return e.graph_node_id})).sort();return a.default(t,this._node_ids)},e.prototype.clear=function(){this._node_ids=[],this.send_update_event()},e.prototype.set=function(e){this._node_ids=[],this.add(e)},e.prototype.add=function(e){var t=e.map((function(e){return e.graph_node_id}));this._node_ids=i.default(this._node_ids,t),this.send_update_event()},e.prototype.remove=function(e){var t=e.map((function(e){return e.graph_node_id}));this._node_ids=o.default(this._node_ids,t),this.send_update_event()},e.prototype.send_update_event=function(){this._node.emit(s.NodeEvent.SELECTION_UPDATED)},e.prototype.to_json=function(){return this._json=this._json||[],this._json=this._node_ids.map((function(e){return e})),this._json},e}();t.CoreNodeSelection=_},,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this.node=e,this._creation_completed=!1}return e.prototype.set_creation_completed=function(){this._creation_completed=!0},Object.defineProperty(e.prototype,"creation_completed",{get:function(){return this.node.scene.loading_controller.loaded&&this._creation_completed},enumerable:!0,configurable:!0}),e.prototype.add_on_child_add_hook=function(e){this._on_child_add_hooks=this._on_child_add_hooks||[],this._on_child_add_hooks.push(e)},e.prototype.run_on_child_add_hooks=function(e){this.execute_hooks_with_child_node(this._on_child_add_hooks,e)},e.prototype.add_on_child_remove_hook=function(e){this._on_child_remove_hooks=this._on_child_remove_hooks||[],this._on_child_remove_hooks.push(e)},e.prototype.run_on_child_remove_hooks=function(e){this.execute_hooks_with_child_node(this._on_child_remove_hooks,e)},e.prototype.add_on_create_hook=function(e){this._on_create_hooks=this._on_create_hooks||[],this._on_create_hooks.push(e)},e.prototype.run_on_create_hooks=function(){this.execute_hooks(this._on_create_hooks)},e.prototype.add_on_add_hook=function(e){this._on_add_hooks=this._on_add_hooks||[],this._on_add_hooks.push(e)},e.prototype.run_on_add_hooks=function(){this.execute_hooks(this._on_add_hooks)},e.prototype.add_delete_hook=function(e){this._on_delete_hooks=this._on_delete_hooks||[],this._on_delete_hooks.push(e)},e.prototype.run_on_delete_hooks=function(){this.execute_hooks(this._on_delete_hooks)},e.prototype.execute_hooks=function(e){if(e)for(var t=0,n=e;t<n.length;t++){(0,n[t])()}},e.prototype.execute_hooks_with_child_node=function(e,t){if(e)for(var n=0,r=e;n<r.length;n++){(0,r[n])(t)}},e}();t.LifeCycleController=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(66),i=function(){function e(e){this.node=e,this._cooking=!1,this._cooks_count=0,this._max_cook_time=-1,this._cook_time_with_inputs=0,this._cook_time=0,this._cook_time_params=0,this._inputs_evaluation_required=!0}return e.prototype.disallow_inputs_evaluation=function(){this._inputs_evaluation_required=!1},Object.defineProperty(e.prototype,"is_cooking",{get:function(){return!0===this._cooking},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cooks_count",{get:function(){return this._cooks_count},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cook_time",{get:function(){return this._cook_time},enumerable:!0,configurable:!0}),e.prototype._init_cooking_state=function(){this._cooking=!0,this._cooking_dirty_timestamp=this.node.dirty_controller.dirty_timestamp},e.prototype._init_cooking_start_time=function(e){null==e&&(e=this.node.scene.performance.started),e&&(this._cook_time_start=performance.now())},e.prototype._start_cook_if_no_errors=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t;return r.__generator(this,(function(n){switch(n.label){case 0:return this.node.states.error.active?(this.end_cook(),[3,4]):[3,1];case 1:return n.trys.push([1,3,,4]),[4,this.node.cook(e)];case 2:return n.sent(),[3,4];case 3:return t=n.sent(),this.node.states.error.set("node internal error: '"+t+"'."),console.error(this.node.full_path(),t),this.end_cook(),[3,4];case 4:return[2]}}))}))},e.prototype.cook_main=function(){return r.__awaiter(this,void 0,void 0,(function(){var e,t,n,o,i;return r.__generator(this,(function(r){switch(r.label){case 0:return this.is_cooking?[2]:(this._init_cooking_state(),(e=this.node.scene.performance.started)&&(this._cook_time_with_inputs_start=performance.now()),this.node.states.error.clear(),[4,this.evaluate_inputs_and_params()]);case 1:if(t=r.sent(),this._init_cooking_start_time(e),n=[],t)for(o=void 0,i=0;i<t.length;i++)(o=t[i])&&(this.node.io.inputs.input_clonable_state_with_override(i)?n.push(o.core_content_cloned()):n.push(o.core_content()));return[4,this._start_cook_if_no_errors(n)];case 2:return r.sent(),[2]}}))}))},e.prototype.cook_main_without_inputs=function(){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(e){switch(e.label){case 0:return this.node.scene.cook_controller.add_node(this.node),this.is_cooking?(console.warn("cook_main_without_inputs already cooking",this.node.full_path()),[2]):(this._init_cooking_state(),this._init_cooking_start_time(),this.node.states.error.clear(),[4,this.node.params.eval_all()]);case 1:return e.sent(),[4,this._start_cook_if_no_errors([])];case 2:return e.sent(),[2]}}))}))},e.prototype.end_cook=function(e){this._increment_cooks_count();var t=this.node.dirty_controller.dirty_timestamp;null==t||t===this._cooking_dirty_timestamp?(this.node.remove_dirty_state(),this._terminate_cook_process()):(o.POLY.log("COOK AGAIN",t,this._cooking_dirty_timestamp,this.node.full_path()),this._cooking=!1,this.cook_main())},e.prototype._terminate_cook_process=function(){this.is_cooking&&(this._cooking=!1,this._record_cook_time(),setTimeout(this.node.container_controller.notify_requesters.bind(this.node.container_controller),0))},e.prototype._increment_cooks_count=function(){this.is_cooking&&null!=this._cook_time_start&&(this._cooks_count+=1)},e.prototype._record_cook_time=function(){if(this.node.scene.performance.started){var e=performance.now();null!=this._cook_time_with_inputs_start&&(this._cook_time_with_inputs=e-this._cook_time_with_inputs_start,this._cook_time_with_inputs_start=void 0),null!=this._cook_time_params_start&&null!=this._cook_time_start&&(this._cook_time_params=this._cook_time_start-this._cook_time_params_start),null!=this._cook_time_start&&(this._cook_time=e-this._cook_time_start,this._cook_time_start=void 0),this._max_cook_time=Math.max(this._max_cook_time,this._cook_time)}this.node.scene.performance.started&&this.node.scene.performance.record_node_cook_data(this.node)},e.prototype.evaluate_inputs_and_params=function(){return r.__awaiter(this,void 0,void 0,(function(){var e;return r.__generator(this,(function(t){switch(t.label){case 0:return e=[],this._inputs_evaluation_required?[4,this.node.io.inputs.eval_required_inputs_p()]:[3,2];case 1:e=t.sent(),t.label=2;case 2:return this.node.scene.performance.started&&(this._cook_time_params_start=performance.now()),[4,this.node.params.eval_all()];case 3:return t.sent(),[2,e]}}))}))},Object.defineProperty(e.prototype,"cook_time_with_inputs",{get:function(){return this._cook_time_with_inputs},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cook_time_params",{get:function(){return this._cook_time_params},enumerable:!0,configurable:!0}),e.prototype._time_with_precision=function(e){return Math.round(1e3*e)/1e3},e}();t.CookController=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,o=n(2).__importDefault(n(570)),i=n(90),a=n(93);!function(e){e.SUCCESSORS="graph_successors",e.PREDECESSORS="graph_predecessors"}(r||(r={}));var s=function(){function e(e){this.node=e}return e.prototype.scene_successors=function(){return this._find_scene_node_scene_nodes(r.SUCCESSORS)},e.prototype.scene_predecessors=function(){return this._find_scene_node_scene_nodes(r.PREDECESSORS)},e.prototype._find_scene_node_scene_nodes=function(e){for(var t=this,n=[],i=0,a=this.node.params.all;i<a.length;i++){var s=a[i];n.push(s)}n.push(this.node);for(var _=[],u=0,c=n;u<c.length;u++){var p=c[u];this._find_base_nodes_from_node(p,e,_)}if(e==r.SUCCESSORS)for(var l=0,d=this.param_nodes_referree();l<d.length;l++){var f=d[l];_.push(f)}_=_.filter((function(e){return e.graph_node_id!=t.node.graph_node_id}));var h=o.default(_,(function(e){return e.graph_node_id})),m=[];return Object.keys(h).forEach((function(e){m.push(h[e][0])})),m},e.prototype._find_base_nodes_from_node=function(e,t,n){for(var r,o,s=0,_=e[t]();s<_.length;s++){var u=_[s];u instanceof a.BaseParamClass?n.push(u.node):(r=u,("string"==typeof(o=i.BaseNodeClass)?typeof r===o:r instanceof o)?n.push(u):this._find_base_nodes_from_node(u,t,n))}return n},e.prototype.add_param_referree=function(e){this._params_referrees_by_graph_node_id=this._params_referrees_by_graph_node_id||{},this._params_referrees_by_graph_node_id[e.graph_node_id]=e},e.prototype.remove_param_referree=function(e){this._params_referrees_by_graph_node_id&&delete this._params_referrees_by_graph_node_id[e.graph_node_id]},e.prototype.params_referree=function(){var e=[];if(this._params_referrees_by_graph_node_id)for(var t=0,n=Object.keys(this._params_referrees_by_graph_node_id);t<n.length;t++){var r=n[t];e.push(this._params_referrees_by_graph_node_id[r])}return e},e.prototype.param_nodes_referree=function(){for(var e,t={},n=0,r=this.params_referree();n<r.length;n++){t[(e=r[n].node).graph_node_id]=e}for(var o=[],i=0,a=Object.keys(t);i<a.length;i++){var s=a[i];o.push(t[s])}return o},e}();t.DependenciesController=s},,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this.param=e,this._blocked_emit=!1,this._blocked_parent_emit=!1,this._count_by_event_name={}}return Object.defineProperty(e.prototype,"emit_allowed",{get:function(){return!0!==this._blocked_emit&&(!this.param.scene.loading_controller.is_loading&&this.param.scene.dispatch_controller.emit_allowed)},enumerable:!0,configurable:!0}),e.prototype.block_emit=function(){return this._blocked_emit=!0,this.param.is_multiple&&this.param.components&&this.param.components.forEach((function(e){return e.emit_controller.block_emit()})),!0},e.prototype.unblock_emit=function(){return this._blocked_emit=!1,this.param.is_multiple&&this.param.components&&this.param.components.forEach((function(e){return e.emit_controller.unblock_emit()})),!0},e.prototype.block_parent_emit=function(){return this._blocked_parent_emit=!0,!0},e.prototype.unblock_parent_emit=function(){return this._blocked_parent_emit=!1,!0},e.prototype.increment_count=function(e){this._count_by_event_name[e]=this._count_by_event_name[e]||0,this._count_by_event_name[e]+=1},e.prototype.events_count=function(e){return this._count_by_event_name[e]||0},e.prototype.emit=function(e){this.emit_allowed&&(this.param.emit(e),null!=this.param.parent_param&&!0!==this._blocked_parent_emit&&this.param.parent_param.emit(e))},e}();t.EmitController=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this.param=e}return e.prototype.to_json=function(){var e={name:this.param.name,type:this.param.type,raw_input:this.raw_input(),value:this.value(),expression:this.expression(),graph_node_id:this.param.graph_node_id,error_message:this.error_message(),is_visible:this.is_visible(),components:void 0};return this.param.is_multiple&&this.param.components&&(e.components=this.param.components.map((function(e){return e.graph_node_id}))),e},e.prototype.raw_input=function(){return this.param.raw_input_serialized},e.prototype.value=function(){return this.param.value_serialized},e.prototype.expression=function(){var e;return this.param.has_expression()?null===(e=this.param.expression_controller)||void 0===e?void 0:e.expression:void 0},e.prototype.error_message=function(){return this.param.states.error.message},e.prototype.is_visible=function(){return this.param.options.is_visible},e}();t.ParamSerializer=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(577),o=n(578),i=function(e){this.param=e,this.time_dependent=new r.TimeDependentState(this.param),this.error=new o.ErrorState(this.param)};t.StatesController=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this.param=e}return Object.defineProperty(e.prototype,"active",{get:function(){var e=this.param.scene.time_controller.graph_node.graph_node_id;return this.param.graph_predecessor_ids().includes(e)},enumerable:!0,configurable:!0}),e}();t.TimeDependentState=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(103),o=function(){function e(e){this.param=e}return e.prototype.set=function(e){this._message!=e&&(this._message=e,this._message&&console.log(this.param.full_path(),this._message),this.param.emit_controller.emit(r.ParamEvent.ERROR_UPDATED))},Object.defineProperty(e.prototype,"message",{get:function(){return this._message},enumerable:!0,configurable:!0}),e.prototype.clear=function(){this.set(void 0)},Object.defineProperty(e.prototype,"active",{get:function(){return null!=this._message},enumerable:!0,configurable:!0}),e}();t.ErrorState=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(67),i=n(24),a=n(349),s=n(61),_=function(){function e(e){this.node=e,this._param_create_mode=!1,this._params_by_name={},this._params_list=[],this._param_names=[],this._non_spare_params=[],this._spare_params=[],this._non_spare_param_names=[],this._spare_param_names=[],this._params_added_since_last_params_eval=!1}return e.prototype.init_dependency_node=function(){this._params_node||(this._params_node=new o.CoreGraphNode(this.node.scene,"params"),this.node.add_graph_input(this._params_node))},e.prototype.init=function(){this.init_dependency_node(),this._param_create_mode=!0,this.init_from_params_config(),this.node.create_params(),this._post_create_params()},e.prototype._post_create_params=function(){this._update_caches(),this.init_param_accessors(),this._param_create_mode=!1,this.run_post_create_params_hook()},e.prototype.update_params=function(e){var t=!1,n=!1;if(e.names_to_delete)for(var r=0,o=e.names_to_delete;r<o.length;r++){var i=o[r];this.has(i)&&(this.delete_param(i),n=!0)}if(e.to_add)for(var a=0,_=e.to_add;a<_.length;a++){var u=_[a];this.add_param(u.type,u.name,u.init_value,u.options)&&(t=!0)}(n||t)&&(this._update_caches(),this.init_param_accessors(),this.node.emit(s.NodeEvent.PARAMS_UPDATED))},e.prototype.post_create_spare_params=function(){this._update_caches(),this.init_param_accessors()},e.prototype.init_from_params_config=function(){var e=this.node.params_config;if(e)for(var t=0,n=Object.keys(e);t<n.length;t++){var r=n[t],o=e[r];this.add_param(o.type,r,o.init_value,o.options)}},e.prototype.init_param_accessors=function(){var e=Object.getOwnPropertyNames(this.node.pv);this._remove_unneeded_accessors(e),e=Object.getOwnPropertyNames(this.node.pv);for(var t=function(t){var r=t.options.is_spare;(!e.includes(t.name)||r)&&(Object.defineProperty(n.node.pv,t.name,{get:function(){return t.value},configurable:r}),Object.defineProperty(n.node.p,t.name,{get:function(){return t},configurable:r}))},n=this,r=0,o=this.all;r<o.length;r++){t(o[r])}},e.prototype._remove_unneeded_accessors=function(e){for(var t=this._param_names,n=[],r=0,o=e;r<o.length;r++){var i=o[r];t.includes(i)||n.push(i)}for(var a=0,s=n;a<s.length;a++){var _=s[a];Object.defineProperty(this.node.pv,_,{get:function(){},configurable:!0}),Object.defineProperty(this.node.p,_,{get:function(){},configurable:!0})}},Object.defineProperty(e.prototype,"params_node",{get:function(){return this._params_node},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"all",{get:function(){return this._params_list},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"non_spare",{get:function(){return this._non_spare_params},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"spare",{get:function(){return this._spare_params},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"names",{get:function(){return this._param_names},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"non_spare_names",{get:function(){return this._non_spare_param_names},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"spare_names",{get:function(){return this._spare_param_names},enumerable:!0,configurable:!0}),e.prototype.set_with_type=function(e,t,n){var r=this.param_with_type(e,n);r?r.set(t):console.warn("param "+e+" not found with type "+n)},e.prototype.set_float=function(e,t){this.set_with_type(e,t,i.ParamType.FLOAT)},e.prototype.set_vector3=function(e,t){this.set_with_type(e,t,i.ParamType.VECTOR3)},e.prototype.has_param=function(e){return null!=this._params_by_name[e]},e.prototype.has=function(e){return this.has_param(e)},e.prototype.get=function(e){return this.param(e)},e.prototype.param_with_type=function(e,t){var n=this.param(e);if(n&&n.type==t)return n},e.prototype.get_float=function(e){return this.param_with_type(e,i.ParamType.FLOAT)},e.prototype.get_operator_path=function(e){return this.param_with_type(e,i.ParamType.OPERATOR_PATH)},e.prototype.value=function(e){var t;return null===(t=this.param(e))||void 0===t?void 0:t.value},e.prototype.value_with_type=function(e,t){var n;return null===(n=this.param_with_type(e,t))||void 0===n?void 0:n.value},e.prototype.boolean=function(e){return this.value_with_type(e,i.ParamType.BOOLEAN)},e.prototype.float=function(e){return this.value_with_type(e,i.ParamType.FLOAT)},e.prototype.integer=function(e){return this.value_with_type(e,i.ParamType.INTEGER)},e.prototype.string=function(e){return this.value_with_type(e,i.ParamType.STRING)},e.prototype.vector2=function(e){return this.value_with_type(e,i.ParamType.VECTOR2)},e.prototype.vector3=function(e){return this.value_with_type(e,i.ParamType.VECTOR3)},e.prototype.color=function(e){return this.value_with_type(e,i.ParamType.COLOR)},e.prototype.param=function(e){var t=this._params_by_name[e];return null!=t?t:(console.warn("tried to access param '"+e+"' in node "+this.node.full_path()+", but existing params are: "+this.names+" on node "+this.node.full_path()),null)},e.prototype.delete_param=function(e){var t=this._params_by_name[e];if(!t)throw new Error("param '"+e+"' does not exist on node "+this.node.full_path());if(this._params_node&&this._params_node.remove_graph_input(this._params_by_name[e]),t.set_node(null),delete this._params_by_name[e],t.is_multiple&&t.components)for(var n=0,r=t.components;n<r.length;n++){var o=r[n].name;delete this._params_by_name[o]}},e.prototype.add_param=function(e,t,n,r){void 0===r&&(r={});var o=r.spare||!1;!1!==this._param_create_mode||o||console.warn("node "+this.node.full_path()+" ("+this.node.type+") param '"+t+"' cannot be created outside of create_params"),null==this.node.scene&&console.warn("node "+this.node.full_path()+" ("+this.node.type+") has no scene assigned");var i=a.ParamConstructorByType[e];if(null!=i){var s=this._params_by_name[t];s&&(o?s.type!=e&&this.delete_param(s.name):console.warn("a param named "+t+" already exists",this.node));var _=new i(this.node.scene);if(_.options.set(r),_.set_name(t),_.set_init_value(n),_.init_components(),_.set(n),_.set_node(this.node),this._params_by_name[_.name]=_,_.is_multiple&&_.components)for(var u=0,c=_.components;u<c.length;u++){var p=c[u];this._params_by_name[p.name]=p}return this._params_added_since_last_params_eval=!0,_}},e.prototype._update_caches=function(){this._params_list=Object.values(this._params_by_name),this._param_names=Object.keys(this._params_by_name),this._non_spare_params=Object.values(this._params_by_name).filter((function(e){return!e.options.is_spare})),this._spare_params=Object.values(this._params_by_name).filter((function(e){return e.options.is_spare})),this._non_spare_param_names=Object.values(this._params_by_name).filter((function(e){return!e.options.is_spare})).map((function(e){return e.name})),this._spare_param_names=Object.values(this._params_by_name).filter((function(e){return e.options.is_spare})).map((function(e){return e.name}))},e.prototype._eval_param=function(e){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(t){switch(t.label){case 0:return e.is_dirty?[4,e.compute()]:[3,2];case 1:return t.sent(),e.states.error.active&&this.node.states.error.set("param '"+e.name+"' error: "+e.states.error.message),[3,2];case 2:return[2]}}))}))},e.prototype.eval_params=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,n;return r.__generator(this,(function(r){switch(r.label){case 0:for(t=[],n=0;n<e.length;n++)e[n].is_dirty&&t.push(this._eval_param(e[n]));return[4,Promise.all(t)];case 1:return r.sent(),this.node.states.error.active&&this.node.set_container(null),[2]}}))}))},e.prototype.eval_all=function(){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(e){switch(e.label){case 0:return this._params_node&&(this._params_node.is_dirty||this._params_added_since_last_params_eval)?[4,this.eval_params(this._params_list)]:[3,2];case 1:e.sent(),this._params_node.remove_dirty_state(),this._params_added_since_last_params_eval=!1,e.label=2;case 2:return[2]}}))}))},e.prototype.set_post_create_params_hook=function(e){this._post_create_params_hook=e},e.prototype.add_on_scene_load_hook=function(e,t){this._on_scene_load_hook_names=this._on_scene_load_hook_names||[],this._on_scene_load_hooks=this._on_scene_load_hooks||[],this._on_scene_load_hook_names.includes(e)?console.warn("hook with name "+e+" already exists",this.node):(this._on_scene_load_hook_names.push(e),this._on_scene_load_hooks.push(t))},e.prototype.run_post_create_params_hook=function(){this._post_create_params_hook&&this._post_create_params_hook()},e.prototype.run_on_scene_load_hooks=function(){if(this._on_scene_load_hooks)for(var e=0,t=this._on_scene_load_hooks;e<t.length;e++){(0,t[e])()}},e}();t.ParamsController=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=r.__importDefault(n(44)),i=r.__importDefault(n(262)),a=r.__importDefault(n(45)),s=n(191),_=n(24),u=n(49),c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.type=function(){return _.ParamType.BOOLEAN},Object.defineProperty(t.prototype,"default_value_serialized",{get:function(){return a.default(this.default_value)?this.default_value:this.convert(this.default_value)||!1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"raw_input_serialized",{get:function(){return this._raw_input},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"value_serialized",{get:function(){return this.value},enumerable:!0,configurable:!0}),t.are_raw_input_equal=function(e,t){return e==t},t.are_values_equal=function(e,t){return e==t},t.prototype.convert=function(e){if(i.default(e))return e;if(o.default(e))return e>=1;if(a.default(e)){if(u.CoreString.is_boolean(e))return u.CoreString.to_boolean(e);if(u.CoreString.is_number(e))return parseFloat(e)>=1}return null},t}(s.TypedNumericParam);t.BooleanParam=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(351),i=n(583),a=n(601),s=n(602),_=n(24),u=function(){function e(e){this.param=e,this.parse_completed=!1,this.parse_started=!1,this.parsed_tree=new o.ParsedTree,this.function_generator=new i.FunctionGenerator(this.param),this.dependencies_controller=new s.DependenciesController(this.param)}return e.prototype.parse_expression=function(e){if(this.parse_started)throw new Error("parse in progress for param "+this.param.full_path());this.parse_started=!0,this.parse_completed=!1,this.parsed_tree=this.parsed_tree||new o.ParsedTree,this.reset(),this.param.type==_.ParamType.STRING?this.parsed_tree.parse_expression_for_string_param(e):this.parsed_tree.parse_expression(e),this.function_generator.parse_tree(this.parsed_tree),null==this.function_generator.error_message&&(this.dependencies_controller.update(this.function_generator),this.dependencies_controller.error_message?this.param.states.error.set(this.dependencies_controller.error_message):(this.parse_completed=!0,this.parse_started=!1))},e.prototype.compute_function=function(){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(e){switch(e.label){case 0:if(!this.compute_allowed())return[3,5];e.label=1;case 1:return e.trys.push([1,3,,4]),[4,this.function_generator.eval_function()];case 2:return[2,e.sent()];case 3:return e.sent(),[2,new Promise((function(e,t){return e()}))];case 4:return[3,6];case 5:return[2,new Promise((function(e,t){e(null)}))];case 6:return[2]}}))}))},e.prototype.reset=function(){this.parse_completed=!1,this.parse_started=!1,this.dependencies_controller.reset(),this.function_generator.reset()},Object.defineProperty(e.prototype,"is_errored",{get:function(){return this.function_generator.is_errored},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"error_message",{get:function(){return this.function_generator.error_message},enumerable:!0,configurable:!0}),e.prototype.compute_allowed=function(){return this.function_generator.eval_allowed()},e.prototype.update_from_method_dependency_name_change=function(){this.expression_string_generator=this.expression_string_generator||new a.ExpressionStringGenerator(this.param);var e=this.expression_string_generator.parse_tree(this.parsed_tree);e?this.param.set(e):console.warn("failed to regenerate expression")},e}();t.ExpressionManager=u},,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(584),i=n(585),a=n(114),s=r.__importDefault(n(45)),_={math_random:"random"},u=n(353),c=Object.keys(u.Easing),p={};["abs","acos","acosh","asin","asinh","atan","atan2","atanh","ceil","cos","cosh","exp","expm1","floor","log","log1p","log2","log10","max","min","pow","round","sign","sin","sinh","sqrt","tan","tanh"].forEach((function(e){p[e]="Math."+e})),["cbrt","hypot","log10","trunc"].forEach((function(e){p[e]="Math."+e})),Object.keys(_).forEach((function(e){var t=_[e];p[e]="Math."+t})),["fit","fit01","fract","deg2rad","rad2deg","rand","clamp"].forEach((function(e){p[e]="Core.Math."+e})),c.forEach((function(e){p[e]="Core.Math.Easing."+e})),["precision"].forEach((function(e){p[e]="Core.String."+e}));var l={if:o.LiteralConstructsController.if},d={};["E","LN2","LN10","LOG10E","LOG2E","PI","SQRT1_2","SQRT2"].forEach((function(e){d[e]="Math."+e}));var f=i.MethodModule,h=n(263),m={x:0,y:1,z:2,w:3,r:0,g:1,b:2},y=n(263),v=n(600),g=n(104),b=n(49),x=n(264),P=function(e){function t(t){var n=e.call(this,t)||this;return n.param=t,n._attribute_requirements_controller=new v.AttributeRequirementsController,n.methods=[],n.method_index=-1,n.method_dependencies=[],n.immutable_dependencies=[],n}return r.__extends(t,e),t.prototype.parse_tree=function(e){if(this.reset(),null==e.error_message){try{if(this._attribute_requirements_controller.reset(),e.node){var t=this.traverse_node(e.node);t&&!this.is_errored&&(this.function_main_string=t)}else console.warn("no parsed_tree.node")}catch(e){console.warn("error in expression for param "+this.param.full_path()),console.warn(e)}if(this.function_main_string)try{this.function=new x.AsyncFunction("Core","param","methods","_set_error_from_error","\n\t\t\t\t\ttry {\n\t\t\t\t\t\t"+this.function_body()+"\n\t\t\t\t\t} catch(e) {\n\t\t\t\t\t\t_set_error_from_error(e)\n\t\t\t\t\t\treturn null;\n\t\t\t\t\t}")}catch(e){console.warn(e),this.set_error("cannot generate function")}else this.set_error("cannot generate function body")}else this.set_error("cannot parse expression")},t.prototype.reset=function(){e.prototype.reset.call(this),this.function_main_string=void 0,this.methods=[],this.method_index=-1,this.function=void 0,this.method_dependencies=[],this.immutable_dependencies=[]},t.prototype.function_body=function(){return this.param.options.is_expression_for_entities?"\n\t\t\tconst entities = param.expression_controller.entities;\n\t\t\tif(entities){\n\t\t\t\treturn new Promise( async (resolve, reject)=>{\n\t\t\t\t\tlet entity;\n\t\t\t\t\tconst entity_callback = param.expression_controller.entity_callback;\n\t\t\t\t\t"+this._attribute_requirements_controller.assign_attributes_lines()+"\n\t\t\t\t\tif( "+this._attribute_requirements_controller.attribute_presence_check_line()+" ){\n\t\t\t\t\t\t"+this._attribute_requirements_controller.assign_arrays_lines()+"\n\t\t\t\t\t\tfor(let index=0; index < entities.length; index++){\n\t\t\t\t\t\t\tentity = entities[index];\n\t\t\t\t\t\t\tresult = "+this.function_main_string+";\n\t\t\t\t\t\t\tentity_callback(entity, result);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tresolve()\n\t\t\t\t\t} else {\n\t\t\t\t\t\tconst error = new Error('attribute not found')\n\t\t\t\t\t\t_set_error_from_error(error)\n\t\t\t\t\t\treject(error)\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t}\n\t\t\treturn []":"\n\t\t\treturn new Promise( async (resolve, reject)=>{\n\t\t\t\ttry {\n\t\t\t\t\tconst value = "+this.function_main_string+"\n\t\t\t\t\tresolve(value)\n\t\t\t\t} catch(e) {\n\t\t\t\t\t_set_error_from_error(e)\n\t\t\t\t\treject()\n\t\t\t\t}\n\t\t\t})\n\t\t\t"},t.prototype.eval_allowed=function(){return null!=this.function},t.prototype.eval_function=function(){if(this.function){this.clear_error();var e={Math:g.CoreMath,String:b.CoreString};return this.function(e,this.param,this.methods,this._set_error_from_error_bound)}},t.prototype.traverse_CallExpression=function(e){var t=this,n=e.arguments.map((function(e){return t.traverse_node(e)})),r=e.callee.name;if(r){var o=l[r];if(o)return o(n);var i=""+n.join(", "),a=p[r];if(a)return a+"("+i+")";if(f[r]){var s=e.arguments[0],_="return "+n[0],u=[];try{u=new Function(_)()}catch(e){}return this._create_method_and_dependencies(r,u,s),"(await methods["+this.method_index+"].process_arguments(["+i+"]))"}}this.set_error("unknown method: "+r)},t.prototype.traverse_BinaryExpression=function(e){return"("+this.traverse_node(e.left)+" "+e.operator+" "+this.traverse_node(e.right)+")"},t.prototype.traverse_LogicalExpression=function(e){return"("+this.traverse_node(e.left)+" "+e.operator+" "+this.traverse_node(e.right)+")"},t.prototype.traverse_MemberExpression=function(e){return this.traverse_node(e.object)+"."+this.traverse_node(e.property)},t.prototype.traverse_UnaryExpression=function(e){if("@"===e.operator){var t=e.argument,n=void 0,r=void 0;switch(t.type){case"Identifier":n=t.name;break;case"MemberExpression":var o=t,i=o.object,s=o.property;n=i.name,r=s.name}if(n){if("ptnum"==(n=a.CoreAttribute.remap_name(n)))return"((entity != null) ? entity.index : 0)";var _=this._attribute_requirements_controller.var_attribute_size(n),u=this._attribute_requirements_controller.var_array(n);return this._attribute_requirements_controller.add(n),r?u+"[entity.index*"+_+"+"+m[r]+"]":u+"[entity.index*"+_+"]"}return console.warn("attribute not found"),""}return""+e.operator+this.traverse_node(e.argument)},t.prototype.traverse_Literal=function(e){return""+e.raw},t.prototype.traverse_Identifier=function(e){if(e.name[0]!=h.VARIABLE_PREFIX)return e.name;var t=e.name.substr(1),n=d[t];if(n)return n;var r="traverse_Identifier_"+t;if(this[r])return this[r]();this.set_error("identifier unknown: "+e.name)},t.prototype.traverse_Identifier_F=function(){return this.immutable_dependencies.push(this.param.scene.time_controller.graph_node),"param.scene.time_controller.frame"},t.prototype.traverse_Identifier_FPS=function(){return this.immutable_dependencies.push(this.param.scene.time_controller.graph_node),"param.scene.time_controller.fps"},t.prototype.traverse_Identifier_T=function(){return this.immutable_dependencies.push(this.param.scene.time_controller.graph_node),"param.scene.time_controller.time"},t.prototype.traverse_Identifier_CH=function(){return"'"+this.param.name+"'"},t.prototype.traverse_Identifier_CEX=function(){return this._method_centroid("x")},t.prototype.traverse_Identifier_CEY=function(){return this._method_centroid("y")},t.prototype.traverse_Identifier_CEZ=function(){return this._method_centroid("z")},t.prototype._method_centroid=function(e){var t=[0,"'"+e+"'"].join(", ");return this._create_method_and_dependencies("centroid",0),"(await methods["+this.method_index+"].process_arguments(["+t+"]))"},t.prototype._create_method_and_dependencies=function(e,t,n){var r=new(0,f[e])(this.param);this.method_index+=1,this.methods[this.method_index]=r;var o=r.find_dependency(t);o?(n&&o.set_jsep_node(n),this.method_dependencies.push(o)):n&&s.default(t)&&this.param.scene.missing_expression_references_controller.register(this.param,n,t)},t}(y.BaseTraverser);t.FunctionGenerator=P},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){}return e.if=function(e){return"("+e[0]+") ? ("+e[1]+") : ("+e[2]+")"},e}();t.LiteralConstructsController=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(586),o=n(588),i=n(589),a=n(590),s=n(591),_=n(592),u=n(593),c=n(594),p=n(595),l=n(596),d=n(597),f=n(598),h=n(599);t.MethodModule={bbox:r.Bbox,ch:i.Ch,centroid:o.Centroid,cop_res:s.CopRes,local:_.Local,opdigits:u.Opdigits,point:c.Point,points_count:p.PointsCount,copy:a.Copy,str_chars_count:l.StrCharsCount,str_concat:d.StrConcat,str_index:f.StrIndex,str_sub:h.StrSub}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(62),i=n(1),a=["min","max","size","center"],s=["x","y","z"],_=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.required_arguments=function(){return[["string","path to node"],["string","vector name, min, max, size or center"],["string","component_name, x,y or z"]]},t.prototype.find_dependency=function(e){return this.create_dependency_from_index_or_path(e)},t.prototype.process_arguments=function(e){var t=this,n=0;return new Promise((function(o,i){return r.__awaiter(t,void 0,void 0,(function(){var t,a,s,_,u;return r.__generator(this,(function(r){switch(r.label){case 0:if(3!=e.length)return[3,5];t=e[0],a=e[1],s=e[2],_=null,r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this.get_referenced_node_container(t)];case 2:return _=r.sent(),[3,4];case 3:return u=r.sent(),i(u),[3,4];case 4:return _&&(n=this._get_value_from_container(_,a,s),o(n)),[3,6];case 5:o(0),r.label=6;case 6:return[2]}}))}))}))},t.prototype._get_value_from_container=function(e,t,n){if(a.indexOf(t)>=0){var r=e.bounding_box(),o=new i.Vector3;switch(t){case"size":r.getSize(o);break;case"center":r.getCenter(o);break;default:o=r[t]}return s.indexOf(n)>=0?o[n]:-1}return-1},t}(o.BaseMethod);t.Bbox=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=r.__importDefault(n(44)),i=function(e){function t(t,n,r){var o=e.call(this,t.scene,"MethodDependency")||this;return o.param=t,o.path_argument=n,o.decomposed_path=r,o._update_from_name_change_bound=o._update_from_name_change.bind(o),o.add_post_dirty_hook("_update_from_name_change",o._update_from_name_change_bound),o}return r.__extends(t,e),t.prototype._update_from_name_change=function(e){if(e&&this.decomposed_path){var t=e;this.decomposed_path.update_from_name_change(t);var n=this.decomposed_path.to_path(),r=this.jsep_node;r&&(r.value=(""+r.value).replace(""+this.path_argument,n),r.raw=r.raw.replace(""+this.path_argument,n)),this.param.expression_controller&&this.param.expression_controller.update_from_method_dependency_name_change()}},t.prototype.reset=function(){this.graph_disconnect_predecessors()},t.prototype.listen_for_name_changes=function(){var e=this;this.jsep_node&&this.decomposed_path&&this.decomposed_path.named_nodes.forEach((function(t){if(t){var n=t;n.name_controller&&e.add_graph_input(n.name_controller.graph_node)}}))},t.prototype.set_jsep_node=function(e){this.jsep_node=e},t.prototype.set_resolved_graph_node=function(e){this.resolved_graph_node=e},t.prototype.set_unresolved_path=function(e){this.unresolved_path=e},t.create=function(e,n,r,i){var a=o.default(n),s=new t(e,n,i);if(r)s.set_resolved_graph_node(r);else if(!a){var _=n;s.set_unresolved_path(_)}return s},t}(n(67).CoreGraphNode);t.MethodDependency=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.required_arguments=function(){return[["string","path to node"],["string","component_name, x,y or z"]]},t.prototype.find_dependency=function(e){return this.create_dependency_from_index_or_path(e)},t.prototype.process_arguments=function(e){var t=this;return new Promise((function(n,o){return r.__awaiter(t,void 0,void 0,(function(){var t,i,a,s,_,u,c;return r.__generator(this,(function(r){switch(r.label){case 0:if(2!=e.length)return[3,5];t=e[0],i=e[1],a=null,r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this.get_referenced_node_container(t)];case 2:return a=r.sent(),[3,4];case 3:return s=r.sent(),o(s),[3,4];case 4:return a&&(_=a.bounding_box(),u=_.min.clone().add(_.max).multiplyScalar(.5),c=u[i],n(null!=c?c:0)),[3,6];case 5:n(0),r.label=6;case 6:return[2]}}))}))}))},t}(n(62).BaseMethod);t.Centroid=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(62),i=n(352),a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.required_arguments=function(){return[["string","path to param"]]},t.prototype.find_dependency=function(e){var t=new i.DecomposedPath,n=this.get_referenced_param(e,t);return n?this.create_dependency(n,e,t):(console.warn("could not find param"),null)},t.prototype.process_arguments=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,n,o,i;return r.__generator(this,(function(r){switch(r.label){case 0:return t=0,1!=e.length?[3,2]:(n=e[0],(o=this.get_referenced_param(n))?[4,o.compute()]:[3,2]);case 1:r.sent(),null!=(i=o.value)&&(t=i),r.label=2;case 2:return[2,t]}}))}))},t}(o.BaseMethod);t.Ch=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(62),i=n(101),a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.required_arguments=function(){return[["string","path to copy"],["integer","default value"]]},t.optional_arguments=function(){return[["string","attribute name (optional)"]]},t.prototype.find_dependency=function(e){var t=this.find_referenced_graph_node(e);if(t&&"copy"==t.type){var n=t.stamp_node;return this.create_dependency(n,e)}return null},t.prototype.process_arguments=function(e){var t=this;return new Promise((function(n,r){if(2==e.length||3==e.length){var o=e[0],a=e[1],s=e[2],_=i.CoreWalker.find_node(t.node,o),u=void 0;_&&"copy"==_.type&&(u=_.stamp_value(s)),null==u&&(u=a),n(u)}else n(0)}))},t}(o.BaseMethod);t.Copy=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.required_arguments=function(){return[["string","path to node"],["string","component_name: x or y"]]},t.prototype.find_dependency=function(e){return this.create_dependency_from_index_or_path(e)},t.prototype.process_arguments=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,n,o,i,a;return r.__generator(this,(function(r){switch(r.label){case 0:return t=0,2!=e.length?[3,2]:(n=e[0],o=e[1],[4,this.get_referenced_node_container(n)]);case 1:(i=r.sent())&&(a=i.resolution(),[0,"0","x"].includes(o)?t=a[0]:[1,"1","y"].includes(o)&&(t=a[1])),r.label=2;case 2:return[2,t]}}))}))},t}(n(62).BaseMethod);t.CopRes=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(62),i=n(66),a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.required_arguments=function(){return[["string","path"]]},t.prototype.process_arguments=function(e){var t=this;return new Promise((function(n,r){t.request_asset_url(e[0]).then((function(e){n(e)}))}))},t.prototype.request_asset_url=function(e){var t=this;return new Promise((function(n,r){if(!i.POLY.desktop_controller().active())return n("");i.POLY.desktop_controller().add_local_path(e,t.param),n(i.POLY.desktop_controller().local_path_server_url(e))}))},t}(o.BaseMethod);t.Local=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(62),i=n(49),a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.required_arguments=function(){return[["string","path to node"]]},t.prototype.find_dependency=function(e){var t=this.find_referenced_graph_node(e);if(t){var n=t;if(n.name_controller){var r=n.name_controller.graph_node;return this.create_dependency(r,e)}}return null},t.prototype.process_arguments=function(e){var t=this;return new Promise((function(n,r){if(1==e.length){var o=e[0],a=t.get_referenced_node(o);if(a){var s=a.name;n(i.CoreString.tail_digits(s))}else n(0)}else n(0)}))},t}(o.BaseMethod);t.Opdigits=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.required_arguments=function(){return[["string","path to node"],["index","point index"],["string","attribute name"]]},t.prototype.find_dependency=function(e){return this.create_dependency_from_index_or_path(e)},t.prototype.process_arguments=function(e){var t=this;return new Promise((function(n,o){return r.__awaiter(t,void 0,void 0,(function(){var t,i,a,s,_,u;return r.__generator(this,(function(r){switch(r.label){case 0:if(3!=e.length)return[3,5];t=e[0],i=e[1],a=e[2],s=null,r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this.get_referenced_node_container(t)];case 2:return s=r.sent(),[3,4];case 3:return _=r.sent(),o(_),[3,4];case 4:return s&&(u=this._get_value_from_container(s,i,a),n(u)),[3,6];case 5:n(0),r.label=6;case 6:return[2]}}))}))}))},t.prototype._get_value_from_container=function(e,t,n){var r=e.core_content();if(r){var o=r.points()[n];return o?o.attrib_value(t):0}return null},t}(n(62).BaseMethod);t.Point=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.required_arguments=function(){return[["string","path to node"]]},t.prototype.find_dependency=function(e){return this.create_dependency_from_index_or_path(e)},t.prototype.process_arguments=function(e){var t=this;return new Promise((function(n,o){return r.__awaiter(t,void 0,void 0,(function(){var t,i,a,s;return r.__generator(this,(function(r){switch(r.label){case 0:if(1!=e.length)return[3,5];t=e[0],i=void 0,r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this.get_referenced_node_container(t)];case 2:return i=r.sent(),[3,4];case 3:return a=r.sent(),o(a),[2];case 4:return i&&(s=i.points_count(),n(s)),[3,6];case 5:n(0),r.label=6;case 6:return[2]}}))}))}))},t}(n(62).BaseMethod);t.PointsCount=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.required_arguments=function(){return[["string","string to count characters of"]]},t.prototype.process_arguments=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,n;return r.__generator(this,(function(r){return t=0,1==e.length&&(n=e[0],t=n.length),[2,t]}))}))},t}(n(62).BaseMethod);t.StrCharsCount=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.required_arguments=function(){return[]},t.prototype.process_arguments=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,n,o,i;return r.__generator(this,(function(r){for(t="",n=0,o=e;n<o.length;n++)null==(i=o[n])&&(i=""),t+=""+i;return[2,t]}))}))},t}(n(62).BaseMethod);t.StrConcat=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.required_arguments=function(){return[["string","string to get index from"],["string","char to find index of"]]},t.prototype.process_arguments=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,n,o;return r.__generator(this,(function(r){return t=-1,2==e.length&&(n=e[0],o=e[1],t=n.indexOf(o)),[2,t]}))}))},t}(n(62).BaseMethod);t.StrIndex=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.required_arguments=function(){return[["string","string to get range from"],["integer","range start"],["integer","range size"]]},t.prototype.process_arguments=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,n,o,i;return r.__generator(this,(function(r){return t="",n=e[0],o=e[1]||0,i=e[2]||1,n&&(t=n.substr(o,i)),[2,t]}))}))},t}(n(62).BaseMethod);t.StrSub=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){}return e.prototype.reset=function(){this._attribute_names&&this._attribute_names.clear()},e.prototype.assign_attributes_lines=function(){var t;if(this._attribute_names){var n=[];return null===(t=this._attribute_names)||void 0===t||t.forEach((function(t){n.push(e.assign_attribute_line(t))})),n.join(";\n")}return""},e.prototype.assign_arrays_lines=function(){var t;if(this._attribute_names){var n=[];return null===(t=this._attribute_names)||void 0===t||t.forEach((function(t){n.push(e.assign_item_size_line(t)),n.push(e.assign_array_line(t))})),n.join(";\n")}return""},e.prototype.attribute_presence_check_line=function(){var t;if(this._attribute_names){var n=[];return null===(t=this._attribute_names)||void 0===t||t.forEach((function(t){var r=e.var_attribute(t);n.push(r)})),n.join(" && ")}return"true"},e.prototype.add=function(e){this._attribute_names=this._attribute_names||new Set,this._attribute_names.add(e)},e.assign_attribute_line=function(e){return"const "+this.var_attribute(e)+" = entities[0].geometry().attributes['"+e+"']"},e.assign_item_size_line=function(e){var t=this.var_attribute(e);return"const "+this.var_attribute_size(e)+" = "+t+".itemSize"},e.assign_array_line=function(e){var t=this.var_attribute(e);return"const "+this.var_array(e)+" = "+t+".array"},e.var_attribute=function(e){return"attrib_"+e},e.var_attribute_size=function(e){return"attrib_size_"+e},e.var_array=function(e){return"array_"+e},e.prototype.var_attribute_size=function(t){return e.var_attribute_size(t)},e.prototype.var_array=function(t){return e.var_array(t)},e}();t.AttributeRequirementsController=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=function(e){function t(t){var n=e.call(this,t)||this;return n.param=t,n}return r.__extends(t,e),t.prototype.parse_tree=function(e){if(null==e.error_message&&e.node)try{return this.traverse_node(e.node)}catch(e){this.set_error("could not traverse tree")}else this.set_error("cannot parse tree")},t.prototype.traverse_CallExpression=function(e){var t=this,n=""+e.arguments.map((function(e){return t.traverse_node(e)})).join(", ");return e.callee.name+"("+n+")"},t.prototype.traverse_UnaryExpression=function(e){return""+e.operator+this.traverse_node(e.argument)},t.prototype.traverse_Identifier=function(e){return""+e.name},t}(n(263).BaseTraverser);t.ExpressionStringGenerator=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this.param=e,this.cyclic_graph_detected=!1,this.method_dependencies=[]}return e.prototype.set_error=function(e){this.error_message=this.error_message||e},e.prototype.reset=function(){this.param.graph_disconnect_predecessors(),this.method_dependencies.forEach((function(e){e.reset()})),this.method_dependencies=[]},e.prototype.update=function(e){this.cyclic_graph_detected=!1,this.connect_immutable_dependencies(e),this.method_dependencies=e.method_dependencies,this.handle_method_dependencies(),this.listen_for_name_changes()},e.prototype.connect_immutable_dependencies=function(e){var t=this;e.immutable_dependencies.forEach((function(e){if(0==t.cyclic_graph_detected&&0==t.param.add_graph_input(e))return t.cyclic_graph_detected=!0,t.set_error("cannot create expression, infinite graph detected"),void t.reset()}))},e.prototype.handle_method_dependencies=function(){var e=this;this.method_dependencies.forEach((function(t){0==e.cyclic_graph_detected&&e.handle_method_dependency(t)}))},e.prototype.handle_method_dependency=function(e){var t=e.resolved_graph_node;if(t&&!this.param.add_graph_input(t))return this.cyclic_graph_detected=!0,this.set_error("cannot create expression, infinite graph detected"),void this.reset()},e.prototype.listen_for_name_changes=function(){this.method_dependencies.forEach((function(e){e.listen_for_name_changes()}))},e}();t.DependenciesController=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(93),i=n(24),a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.type=function(){return i.ParamType.BUTTON},Object.defineProperty(t.prototype,"default_value_serialized",{get:function(){return this.default_value},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"raw_input_serialized",{get:function(){return this._raw_input},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"value_serialized",{get:function(){return this.value},enumerable:!0,configurable:!0}),t.are_raw_input_equal=function(e,t){return!0},t.are_values_equal=function(e,t){return!0},t.prototype.press_button=function(){this.options.execute_callback()},t}(o.TypedParam);t.ButtonParam=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(156),i=r.__importDefault(n(21)),a=n(7),s=n(24),_=["r","g","b"],u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._value=new a.Color,t}return r.__extends(t,e),t.type=function(){return s.ParamType.COLOR},Object.defineProperty(t,"component_names",{get:function(){return _},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"default_value_serialized",{get:function(){return i.default(this.default_value)?this.default_value:this.default_value.toArray()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"value_serialized",{get:function(){return this.value.toArray()},enumerable:!0,configurable:!0}),t.prototype._clone_raw_input=function(e){return e instanceof a.Color?e.clone():[e[0],e[1],e[2]]},t.are_raw_input_equal=function(e,t){return e instanceof a.Color?t instanceof a.Color?e.equals(t):e.r==t[0]&&e.g==t[1]&&e.b==t[2]:t instanceof a.Color?e[0]==t.r&&e[1]==t.g&&e[2]==t.b:e[0]==t[0]&&e[1]==t[1]&&e[2]==t[2]},t.are_values_equal=function(e,t){return e.equals(t)},t.prototype.init_components=function(){e.prototype.init_components.call(this),this.r=this.components[0],this.g=this.components[1],this.b=this.components[2]},t.prototype.set_value_from_components=function(){this._value.r=this.r.value,this._value.g=this.g.value,this._value.b=this.b.value},t}(o.TypedMultipleParam);t.ColorParam=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(93),i=n(24),a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.type=function(){return i.ParamType.FOLDER},Object.defineProperty(t.prototype,"default_value_serialized",{get:function(){return this.default_value},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"raw_input_serialized",{get:function(){return this._raw_input},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"value_serialized",{get:function(){return this.value},enumerable:!0,configurable:!0}),t.are_raw_input_equal=function(e,t){return!0},t.are_values_equal=function(e,t){return!0},t}(o.TypedParam);t.FolderParam=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=r.__importDefault(n(44)),i=n(191),a=n(24),s=n(49),_=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.type=function(){return a.ParamType.INTEGER},Object.defineProperty(t.prototype,"default_value_serialized",{get:function(){return this.default_value},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"raw_input_serialized",{get:function(){return this.raw_input},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"value_serialized",{get:function(){return this.value},enumerable:!0,configurable:!0}),t.are_raw_input_equal=function(e,t){return e==t},t.are_values_equal=function(e,t){return e==t},t.convert=function(e){if(o.default(e))return Math.round(e);if(s.CoreString.is_number(e)){var t=parseInt(e);if(o.default(t))return t}return null},t.prototype.convert=function(e){var n=t.convert(e);return n?this.options.ensure_in_range(n):n},t}(i.TypedNumericParam);t.IntegerParam=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,o=n(14),i=function(){function e(e,t){void 0===e&&(e=0),void 0===t&&(t=0),this._position=e,this._value=t}return e.prototype.to_json=function(){return{position:this._position,value:this._value}},Object.defineProperty(e.prototype,"position",{get:function(){return this._position},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0}),e.prototype.copy=function(e){this._position=e.position,this._value=e.value},e.prototype.clone=function(){var t=new e;return t.copy(this),t},e.prototype.is_equal=function(e){return this._position==e.position&&this._value==e.value},e.prototype.is_equal_json=function(e){return this._position==e.position&&this._value==e.value},e.prototype.from_json=function(e){this._position=e.position,this._value=e.value},e.are_equal_json=function(e,t){return e.position==t.position&&e.value==t.value},e.from_json=function(t){return new e(t.position,t.value)},e}();t.RampPoint=i,function(e){e.LINEAR="linear"}(r=t.RampInterpolation||(t.RampInterpolation={}));var a=function(){function e(e,t){void 0===e&&(e=r.LINEAR),void 0===t&&(t=[]),this._interpolation=e,this._points=t,this._uuid=o.MathUtils.generateUUID()}return Object.defineProperty(e.prototype,"uuid",{get:function(){return this._uuid},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"interpolation",{get:function(){return this._interpolation},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"points",{get:function(){return this._points},enumerable:!0,configurable:!0}),e.from_json=function(t){for(var n=[],r=0,o=t.points;r<o.length;r++){var a=o[r];n.push(i.from_json(a))}return new e(t.interpolation,n)},e.prototype.to_json=function(){return{interpolation:this._interpolation,points:this._points.map((function(e){return e.to_json()}))}},e.prototype.clone=function(){var t=new e;return t.copy(this),t},e.prototype.copy=function(e){this._interpolation=e.interpolation;for(var t=0,n=0,r=e.points;n<r.length;n++){var o=r[n],i=this._points[t];i?i.copy(o):this._points.push(o.clone()),t+=1}},e.prototype.is_equal=function(e){if(this._interpolation!=e.interpolation)return!1;var t=e.points;if(this._points.length!=t.length)return!1;for(var n=0,r=0,o=this._points;r<o.length;r++){var i=o[r],a=t[n];if(!i.is_equal(a))return!1;n+=1}return!0},e.prototype.is_equal_json=function(e){if(this._interpolation!=e.interpolation)return!1;if(this._points.length!=e.points.length)return!1;for(var t=0,n=0,r=this._points;n<r.length;n++){var o=r[n],i=e.points[t];if(!o.is_equal_json(i))return!1;t+=1}return!0},e.are_json_equal=function(e,t){if(e.interpolation!=t.interpolation)return!1;if(e.points.length!=t.points.length)return!1;for(var n=0,r=0,o=e.points;r<o.length;r++){var a=o[r],s=t.points[n];if(!i.are_equal_json(a,s))return!1;n+=1}return!0},e.prototype.from_json=function(e){this._interpolation=e.interpolation;for(var t=0,n=0,r=e.points;n<r.length;n++){var o=r[n],a=this._points[t];a?a.from_json(o):this._points.push(i.from_json(o)),t+=1}},e}();t.RampValue=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(93),i=n(24),a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.type=function(){return i.ParamType.SEPARATOR},Object.defineProperty(t.prototype,"default_value_serialized",{get:function(){return this.default_value},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"raw_input_serialized",{get:function(){return this._raw_input},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"value_serialized",{get:function(){return this.value},enumerable:!0,configurable:!0}),t.are_raw_input_equal=function(e,t){return!0},t.are_values_equal=function(e,t){return!0},t}(o.TypedParam);t.SeparatorParam=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(156),i=r.__importDefault(n(21)),a=n(3),s=n(24),_=["x","y"],u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._value=new a.Vector2,t}return r.__extends(t,e),t.type=function(){return s.ParamType.VECTOR2},Object.defineProperty(t,"component_names",{get:function(){return _},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"default_value_serialized",{get:function(){return i.default(this.default_value)?this.default_value:this.default_value.toArray()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"value_serialized",{get:function(){return this.value.toArray()},enumerable:!0,configurable:!0}),t.prototype._clone_raw_input=function(e){return e instanceof a.Vector2?e.clone():[e[0],e[1]]},t.are_raw_input_equal=function(e,t){return e instanceof a.Vector2?t instanceof a.Vector2?e.equals(t):e.x==t[0]&&e.y==t[1]:t instanceof a.Vector2?e[0]==t.x&&e[1]==t.y:e[0]==t[0]&&e[1]==t[1]},t.are_values_equal=function(e,t){return e.equals(t)},t.prototype.init_components=function(){e.prototype.init_components.call(this),this.x=this.components[0],this.y=this.components[1]},t.prototype.set_value_from_components=function(){this._value.x=this.x.value,this._value.y=this.y.value},t}(o.TypedMultipleParam);t.Vector2Param=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(156),i=r.__importDefault(n(21)),a=n(1),s=n(24),_=["x","y","z"],u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._value=new a.Vector3,t}return r.__extends(t,e),t.type=function(){return s.ParamType.VECTOR3},Object.defineProperty(t,"component_names",{get:function(){return _},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"default_value_serialized",{get:function(){return i.default(this.default_value)?this.default_value:this.default_value.toArray()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"value_serialized",{get:function(){return this.value.toArray()},enumerable:!0,configurable:!0}),t.prototype._clone_raw_input=function(e){return e instanceof a.Vector3?e.clone():[e[0],e[1],e[2]]},t.are_raw_input_equal=function(e,t){return e instanceof a.Vector3?t instanceof a.Vector3?e.equals(t):e.x==t[0]&&e.y==t[1]&&e.z==t[2]:t instanceof a.Vector3?e[0]==t.x&&e[1]==t.y&&e[2]==t.z:e[0]==t[0]&&e[1]==t[1]&&e[2]==t[2]},t.are_values_equal=function(e,t){return e.equals(t)},t.prototype.init_components=function(){e.prototype.init_components.call(this),this.x=this.components[0],this.y=this.components[1],this.z=this.components[2]},t.prototype.set_value_from_components=function(){this._value.x=this.x.value,this._value.y=this.y.value,this._value.z=this.z.value},t}(o.TypedMultipleParam);t.Vector3Param=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(156),i=r.__importDefault(n(21)),a=n(20),s=n(24),_=["x","y","z","w"],u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._value=new a.Vector4,t}return r.__extends(t,e),t.type=function(){return s.ParamType.VECTOR4},Object.defineProperty(t,"component_names",{get:function(){return _},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"default_value_serialized",{get:function(){return i.default(this.default_value)?this.default_value:this.default_value.toArray()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"value_serialized",{get:function(){return this.value.toArray()},enumerable:!0,configurable:!0}),t.prototype._clone_raw_input=function(e){return e instanceof a.Vector4?e.clone():[e[0],e[1],e[2],e[3]]},t.are_raw_input_equal=function(e,t){return e instanceof a.Vector4?t instanceof a.Vector4?e.equals(t):e.x==t[0]&&e.y==t[1]&&e.z==t[2]&&e.w==t[3]:t instanceof a.Vector4?e[0]==t.x&&e[1]==t.y&&e[2]==t.z&&e[3]==t.w:e[0]==t[0]&&e[1]==t[1]&&e[2]==t[2]&&e[3]==t[3]},t.are_values_equal=function(e,t){return e.equals(t)},t.prototype.init_components=function(){e.prototype.init_components.call(this),this.x=this.components[0],this.y=this.components[1],this.z=this.components[2],this.w=this.components[3]},t.prototype.set_value_from_components=function(){this._value.x=this.x.value,this._value.y=this.y.value,this._value.z=this.z.value,this._value.w=this.w.value},t}(o.TypedMultipleParam);t.Vector4Param=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){};t.ParamsValueAccessor=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this._frame=0}return e.prototype.copy=function(e){this._frame=e.frame},Object.defineProperty(e.prototype,"frame",{get:function(){return this._frame},enumerable:!0,configurable:!0}),e}();t.ProcessingContext=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(615),o=n(616),i=n(618),a=function(){function e(e){this.node=e,this._connections=new r.ConnectionsController(this.node)}return Object.defineProperty(e.prototype,"connections",{get:function(){return this._connections},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"inputs",{get:function(){return this._inputs=this._inputs||new o.InputsController(this.node)},enumerable:!0,configurable:!0}),e.prototype.has_inputs=function(){return null!=this._inputs},Object.defineProperty(e.prototype,"outputs",{get:function(){return this._outputs=this._outputs||new i.OutputsController(this.node)},enumerable:!0,configurable:!0}),e.prototype.has_outputs=function(){return null!=this._outputs},e}();t.IOController=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2).__importDefault(n(92)),o=function(){function e(e){this._node=e,this._output_connections=new Map}return e.prototype.init_inputs=function(){var e=this._node.io.inputs.max_inputs_count;this._input_connections=new Array(e)},e.prototype.add_input_connection=function(e){this._input_connections?this._input_connections[e.input_index]=e:console.warn("input connections array not initialized")},e.prototype.remove_input_connection=function(e){if(this._input_connections)if(e.input_index<this._input_connections.length){this._input_connections[e.input_index]=void 0;for(var t=!0,n=e.input_index;n<this._input_connections.length;n++)this._input_connections[n]&&(t=!1);t&&(this._input_connections=this._input_connections.slice(0,e.input_index))}else console.warn("attempt to remove an input connection at index "+e.input_index);else console.warn("input connections array not initialized")},e.prototype.input_connection=function(e){if(this._input_connections)return this._input_connections[e]},e.prototype.first_input_connection=function(){return r.default(this._input_connections)[0]},e.prototype.input_connections=function(){return this._input_connections},e.prototype.add_output_connection=function(e){var t=e.output_index,n=e.id,r=this._output_connections.get(t);r||(r=new Map,this._output_connections.set(t,r)),r.set(n,e)},e.prototype.remove_output_connection=function(e){var t=e.output_index,n=e.id,r=this._output_connections.get(t);r&&r.delete(n)},e.prototype.output_connections=function(){var e=[];return this._output_connections.forEach((function(t,n){t.forEach((function(t,n){t&&e.push(t)}))})),e},e}();t.ConnectionsController=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=r.__importDefault(n(180)),i=r.__importDefault(n(45)),a=n(617),s=n(67),_=n(61),u=n(17),c=n(192),p=function(){function e(e){this.node=e,this._graph_node_inputs=[],this._inputs=[],this._has_named_inputs=!1,this._min_inputs_count=0,this._max_inputs_count=0,this._depends_on_inputs=!0,this._override_clonable_state=!1}return e.prototype.set_depends_on_inputs=function(e){this._depends_on_inputs=e},e.prototype.set_min_inputs_count=function(e){this._min_inputs_count=e},e.prototype.set_max_inputs_count=function(e){this._max_inputs_count=e,this.init_graph_node_inputs()},e.prototype.named_input_connection_points_by_name=function(e){if(this._named_input_connection_points)for(var t=0,n=this._named_input_connection_points;t<n.length;t++){var r=n[t];if(r.name==e)return r}},e.prototype.set_named_input_connection_points=function(e){this._has_named_inputs=!0,this._named_input_connection_points=e,this.set_min_inputs_count(0),this.set_max_inputs_count(e.length),this.init_graph_node_inputs(),this.node.emit(_.NodeEvent.NAMED_INPUTS_UPDATED)},Object.defineProperty(e.prototype,"has_named_inputs",{get:function(){return this._has_named_inputs},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"named_input_connection_points",{get:function(){return this._named_input_connection_points||[]},enumerable:!0,configurable:!0}),e.prototype.init_graph_node_inputs=function(){for(var e=0;e<this._max_inputs_count;e++)this._graph_node_inputs[e]=this._graph_node_inputs[e]||this._create_graph_node_input(e)},e.prototype._create_graph_node_input=function(e){var t=new s.CoreGraphNode(this.node.scene,"input_"+e);return this.node.add_graph_input(t),t},Object.defineProperty(e.prototype,"max_inputs_count",{get:function(){return this._max_inputs_count||0},enumerable:!0,configurable:!0}),e.prototype.input_graph_node=function(e){return this._graph_node_inputs[e]},e.prototype.set_count=function(e,t){null==t&&(t=e),this.set_min_inputs_count(e),this.set_max_inputs_count(t),this.init_inputs_clonable_state(),this.init_connections_controller_inputs()},e.prototype.init_connections_controller_inputs=function(){this.node.io.connections.init_inputs()},e.prototype.eval_required_inputs_p=function(){return r.__awaiter(this,void 0,void 0,(function(){var e,t,n,o=this;return r.__generator(this,(function(r){switch(r.label){case 0:return e=[],this._max_inputs_count>0?(t=[],this.inputs().forEach((function(e,n){e&&t.push(n)})),t.length<this._min_inputs_count?(this.node.states.error.set("inputs are missing"),[3,3]):[3,1]):[3,3];case 1:return t.length>0?(n=t.map((function(e){return o.node.io.inputs.eval_required_input(e)})),[4,Promise.all(n)]):[3,3];case 2:e=r.sent(),r.label=3;case 3:return[2,e]}}))}))},e.prototype.eval_required_input=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,n,o;return r.__generator(this,(function(r){switch(r.label){case 0:return[4,this.node.container_controller.request_input_container(e)];case 1:return(t=r.sent())&&t.core_content()||(n=this.input(e))&&(o=n.states.error.message)&&this.node.states.error.set("input "+e+" is invalid (error: "+o+")"),[2,t]}}))}))},e.prototype.get_named_input_index=function(e){if(this._named_input_connection_points)for(var t=0;t<this._named_input_connection_points.length;t++)if(this._named_input_connection_points[t].name==e)return t;return-1},e.prototype.get_input_index=function(e){if(i.default(e)){if(this.has_named_inputs)return this.get_named_input_index(e);throw new Error("node "+this.node.full_path()+" has no named inputs")}return e},e.prototype.set_input=function(e,t,n){void 0===n&&(n=0);var r=this.get_input_index(e)||0;if(r<0){var o="invalid input ("+e+") for node "+this.node.full_path();throw console.warn(o),new Error(o)}var i=0;if(t&&t.io.outputs.has_named_outputs&&(null==(i=t.io.outputs.get_output_index(n))||i<0))console.warn("node "+t.full_path()+" does not have an output named "+n);else{var s=this._graph_node_inputs[r];if(null==s){o="graph_input_node not found at index "+r;throw console.warn(o),new Error(o)}if(!t||this.node.parent==t.parent){var u=this._inputs[r],c=null,p=void 0;this.node.io.connections&&(p=this.node.io.connections.input_connection(r)),p&&(c=p.output_index),t===u&&i==c||(null!=u&&this._depends_on_inputs&&s.remove_graph_input(u),null!=t?s.add_graph_input(t)?(this._depends_on_inputs||s.remove_graph_input(t),p&&p.disconnect({set_input:!1}),this._inputs[r]=t,new a.NodeConnection(t,this.node,i,r)):console.warn("cannot connect "+t.full_path()+" to "+this.node.full_path()):(this._inputs[r]=null,p&&p.disconnect({set_input:!1})),this._run_on_set_input_hooks(),s.set_successors_dirty(),this.node.emit(_.NodeEvent.INPUTS_UPDATED))}}},e.prototype.remove_input=function(e){var t=this;o.default(this.inputs(),(function(n,r){null!=n&&null!=e&&n.graph_node_id===e.graph_node_id&&t.set_input(r,null)}))},e.prototype.input=function(e){return this._inputs[e]},e.prototype.named_input=function(e){if(this.has_named_inputs){var t=this.get_input_index(e);return this._inputs[t]}return null},e.prototype.named_input_connection_point=function(e){if(this.has_named_inputs&&this._named_input_connection_points){var t=this.get_input_index(e);return this._named_input_connection_points[t]}},e.prototype.has_named_input=function(e){return this.get_named_input_index(e)>=0},e.prototype.has_input=function(e){return null!=this._inputs[e]},e.prototype.inputs=function(){return this._inputs},e.prototype.override_clonable_state_allowed=function(){for(var e=!1,t=0,n=this.inputs_clonable_state();t<n.length;t++){n[t]==u.InputCloneMode.FROM_NODE&&(e=!0)}return e},e.prototype.inputs_clonable_state=function(){return this._inputs_clonable_states=this._inputs_clonable_states||this.init_inputs_clonable_state()},e.prototype.input_cloned=function(e){return this.input_clonable_state_with_override(e)},e.prototype.inputs_clonable_state_with_override=function(){for(var e=[],t=this.inputs_clonable_state(),n=0;n<t.length;n++)e.push(this.input_clonable_state_with_override(n));return e},e.prototype.input_clonable_state_with_override=function(e){var t=this.inputs_clonable_state()[e];switch(t){case u.InputCloneMode.ALWAYS:return!0;case u.InputCloneMode.NEVER:return!1;case u.InputCloneMode.FROM_NODE:return!this._override_clonable_state}return c.TypeAssert.unreachable(t)},e.prototype.init_inputs_clonable_state=function(e){return void 0===e&&(e=null),e&&(this._user_inputs_clonable_states=e),this._inputs_clonable_states=this._user_inputs_clonable_states||this._default_inputs_clonale_state_values(),this._inputs_clonable_states},e.prototype._default_inputs_clonale_state_values=function(){for(var e=[],t=0;t<this._max_inputs_count;t++)e.push(u.InputCloneMode.ALWAYS);return e},e.prototype.set_override_clonable_state=function(e){this._override_clonable_state=e,this.node.emit(_.NodeEvent.OVERRIDE_CLONABLE_STATE_UPDATE)},e.prototype.override_clonable_state=function(){return this._override_clonable_state},e.prototype.add_on_set_input_hook=function(e,t){this._on_update_hooks=this._on_update_hooks||[],this._on_update_hook_names=this._on_update_hook_names||[],this._on_update_hook_names.includes(e)?console.warn("hook with name "+e+" already exists",this.node):(this._on_update_hooks.push(t),this._on_update_hook_names.push(e))},e.prototype._run_on_set_input_hooks=function(){if(this._on_update_hooks)for(var e=0,t=this._on_update_hooks;e<t.length;e++){(0,t[e])()}},e}();t.InputsController=p},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(t,n,r,o){void 0===r&&(r=0),void 0===o&&(o=0),this._node_src=t,this._node_dest=n,this._output_index=r,this._input_index=o,this._id=e._next_id++,this._node_src.io.connections&&this._node_dest.io.connections&&(this._node_src.io.connections.add_output_connection(this),this._node_dest.io.connections.add_input_connection(this))}return Object.defineProperty(e.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"node_src",{get:function(){return this._node_src},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"node_dest",{get:function(){return this._node_dest},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"output_index",{get:function(){return this._output_index},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"input_index",{get:function(){return this._input_index},enumerable:!0,configurable:!0}),e.prototype.disconnect=function(e){void 0===e&&(e={}),this._node_src.io.connections&&this._node_dest.io.connections&&(this._node_src.io.connections.remove_output_connection(this),this._node_dest.io.connections.remove_input_connection(this)),!0===e.set_input&&this._node_dest.io.inputs.set_input(this._input_index,null)},e._next_id=0,e}();t.NodeConnection=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=r.__importDefault(n(44)),i=r.__importDefault(n(91)),a=r.__importDefault(n(45)),s=n(61),_=function(){function e(e){this.node=e,this._has_outputs=!1,this._has_named_outputs=!1}return e.prototype.set_has_one_output=function(){this._has_outputs=!0},e.prototype.set_has_no_output=function(){this._has_outputs=!1},Object.defineProperty(e.prototype,"has_outputs",{get:function(){return this._has_outputs},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"has_named_outputs",{get:function(){return this._has_named_outputs},enumerable:!0,configurable:!0}),e.prototype.has_named_output=function(e){return this.get_named_output_index(e)>=0},Object.defineProperty(e.prototype,"named_output_connection_points",{get:function(){return this._named_output_connection_points||[]},enumerable:!0,configurable:!0}),e.prototype.named_output_connection=function(e){if(this._named_output_connection_points)return this._named_output_connection_points[e]},e.prototype.get_named_output_index=function(e){if(this._named_output_connection_points)for(var t=0;t<this._named_output_connection_points.length;t++)if(this._named_output_connection_points[t].name==e)return t;return-1},e.prototype.get_output_index=function(e){return null!=e?a.default(e)?this.has_named_outputs?this.get_named_output_index(e):(console.warn("node "+this.node.full_path()+" has no named outputs"),-1):e:-1},e.prototype.named_output_connection_points_by_name=function(e){if(this._named_output_connection_points)for(var t=0,n=this._named_output_connection_points;t<n.length;t++){var r=n[t];if(r.name==e)return r}},e.prototype.set_named_output_connection_points=function(e,t){void 0===t&&(t=!0),this._has_named_outputs=!0,this._named_output_connection_points=e,t&&this.node.scene&&this.node.set_dirty(this.node),this.node.emit(s.NodeEvent.NAMED_OUTPUTS_UPDATED)},e.prototype.used_output_names=function(){var e=this;if(this.node.io.connections){var t=i.default(this.node.io.connections.output_connections().map((function(e){return e?e.output_index:null}))),n=[];return t.forEach((function(e){o.default(e)&&n.push(e)})),n.map((function(t){return e.named_output_connection_points[t].name}))}return[]},e}();t.OutputsController=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){};t.ParamsAccessor=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.set_content=function(t){e.prototype.set_content.call(this,t)},t}(n(115).TypedContainer);t.EventContainer=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){this._nodes_by_graph_node_id=new Map}return e.prototype.register_node=function(e){this._nodes_by_graph_node_id.set(e.graph_node_id,e)},e.prototype.unregister_node=function(e){this._nodes_by_graph_node_id.delete(e.graph_node_id)},e.prototype.process=function(e,t,n){this._nodes_by_graph_node_id.forEach((function(r){return r.process_event(e,t,n)}))},e}();t.BaseEventsController=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this.scene=e,this._lifecycle_on_create_allowed=!0}return e.prototype.on_create_hook_allowed=function(){return this.scene.loading_controller.loaded&&this._lifecycle_on_create_allowed},e.prototype.on_create_prevent=function(e){this._lifecycle_on_create_allowed=!1,e(),this._lifecycle_on_create_allowed=!0},e}();t.LifeCycleController=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=function(){function e(e){this.scene=e,this._loading_state=!0,this._auto_updating=!0,this._first_object_loaded=!1}return e.prototype.mark_as_loading=function(){this._set_loading_state(!0)},e.prototype.mark_as_loaded=function(){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(e){switch(e.label){case 0:return[4,this._set_loading_state(!1)];case 1:return e.sent(),[2]}}))}))},e.prototype._set_loading_state=function(e){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(t){switch(t.label){case 0:return this._loading_state=e,[4,this.set_auto_update(!this._loading_state)];case 1:return t.sent(),[2]}}))}))},Object.defineProperty(e.prototype,"is_loading",{get:function(){return this._loading_state},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"loaded",{get:function(){return!this._loading_state},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"auto_updating",{get:function(){return this._auto_updating},enumerable:!0,configurable:!0}),e.prototype.set_auto_update=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t;return r.__generator(this,(function(n){switch(n.label){case 0:return this._auto_updating===e?[3,4]:(this._auto_updating=e,this._auto_updating?(t=this.scene.root)?[4,t.process_queue()]:[3,2]:[3,3]);case 1:n.sent(),n.label=2;case 2:return[3,3];case 3:return[3,4];case 4:return[2]}}))}))},e.prototype.on_first_object_loaded=function(){var e;if(!this._first_object_loaded){this._first_object_loaded=!0;var t=document.getElementById("scene_loading_container");t&&(null===(e=t.parentElement)||void 0===e||e.removeChild(t))}},e}();t.LoadingController=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){this._params_by_id=new Map}return e.prototype.register_param=function(e){this._params_by_id.set(e.graph_node_id,e)},e.prototype.deregister_param=function(e){this._params_by_id.delete(e.graph_node_id)},e.prototype.regenerate_referring_expressions=function(e){e.name_controller.graph_node.set_successors_dirty(e)},e}();t.ExpressionsController=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(626),o=n(129),i=function(){function e(){this.references=new Map}return e.prototype.register=function(e,t,n){var i=new r.MissingExpressionReference(e,n);return o.MapUtils.push_on_array_at_entry(this.references,e.graph_node_id,i),i},e.prototype.deregister_param=function(e){this.references.delete(e.graph_node_id)},e.prototype.check_for_missing_references=function(e){this._check_for_missing_references_for_node(e);for(var t=0,n=e.params.all;t<n.length;t++){var r=n[t];this._check_for_missing_references_for_param(r)}},e.prototype._check_for_missing_references_for_node=function(e){var t=this,n=e.graph_node_id;this.references.forEach((function(r,o){for(var i=!1,a=0,s=r;a<s.length;a++){var _=s[a];_.matches_path(e.full_path())&&(i=!0,_.resolve_missing_dependencies())}i&&t.references.delete(n)}))},e.prototype._check_for_missing_references_for_param=function(e){var t=this,n=e.graph_node_id;this.references.forEach((function(r,o){for(var i=!1,a=0,s=r;a<s.length;a++){var _=s[a];_.matches_path(e.full_path())&&(i=!0,_.resolve_missing_dependencies())}i&&t.references.delete(n)}))},e}();t.MissingReferencesController=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(101),o=function(){function e(e,t){this.param=e,this.path=t}return e.prototype.matches_path=function(e){return r.CoreWalker.make_absolute_path(this.param.node,this.path)==e},e.prototype.update_from_method_dependency_name_change=function(){var e;null===(e=this.param.expression_controller)||void 0===e||e.update_from_method_dependency_name_change()},e.prototype.resolve_missing_dependencies=function(){var e=this.param.raw_input_serialized;this.param.set(this.param.default_value),this.param.set(e)},e}();t.MissingExpressionReference=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=r.__importDefault(n(357)),i=r.__importDefault(n(82)),a=r.__importDefault(n(92)),s=n(628),_=n(49),u=function(){function e(e){this.scene=e,this._node_context_signatures={},this._instanciated_nodes_by_context_and_type={}}return e.prototype.init=function(){this._root=new s.ObjectsManagerNode(this.scene),this._root.initialize_base_and_node(),this._root.init_default_scene()},Object.defineProperty(e.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),e.prototype.objects_from_mask=function(e){var t=e.split(" "),n=this.root.children(),r=(n=n.filter((function(e){return _.CoreString.matches_one_mask(e.name,t)}))).map((function(e){return e.object}));return a.default(r)},e.prototype.clear=function(){for(var e,t=0,n=this.root.children();t<n.length;t++){var r=n[t];null===(e=this.root.children_controller)||void 0===e||e.remove_node(r)}},e.prototype.node=function(e){return"/"===e?this.root:this.root.node(e)},e.prototype.all_nodes=function(){for(var e=[this.root],t=[this.root],n=0;t.length>0&&n<10;){var r=i.default(t.map((function(e){return e.children_allowed()?e.children():[]})));e=o.default(e,r),t=r,n+=1}return i.default(e)},e.prototype.reset_node_context_signatures=function(){this._node_context_signatures={}},e.prototype.register_node_context_signature=function(e){e.children_allowed()&&e.children_controller&&(this._node_context_signatures[e.children_controller.node_context_signature()]=!0)},e.prototype.node_context_signatures=function(){return Object.keys(this._node_context_signatures).sort().map((function(e){return e.toLowerCase()}))},e.prototype.add_to_instanciated_node=function(e){var t=e.node_context(),n=e.type;this._instanciated_nodes_by_context_and_type[t]=this._instanciated_nodes_by_context_and_type[t]||{},this._instanciated_nodes_by_context_and_type[t][n]=this._instanciated_nodes_by_context_and_type[t][n]||{},this._instanciated_nodes_by_context_and_type[t][n][e.graph_node_id]=e},e.prototype.remove_from_instanciated_node=function(e){var t=e.node_context(),n=e.type;delete this._instanciated_nodes_by_context_and_type[t][n][e.graph_node_id]},e.prototype.instanciated_nodes=function(e,t){var n=[];if(this._instanciated_nodes_by_context_and_type[e]){var r=this._instanciated_nodes_by_context_and_type[e][t];if(r)for(var o=0,i=Object.keys(r);o<i.length;o++){var a=i[o];n.push(r[a])}}return n},e}();t.NodesController=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(40),i=n(629),a=n(66),s=n(27),_=new(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t}(n(5).NodeParamsConfig)),u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=_,t._object=new o.Group,t._queued_nodes_by_id={},t._queued_nodes_by_path={},t._expected_geo_nodes={},t._process_queue_start=-1,t._children_controller_context=s.NodeContext.OBJ,t}return r.__extends(t,e),t.type=function(){return"obj"},t.prototype.initialize_node=function(){var e;null===(e=this.children_controller)||void 0===e||e.init(),this.lifecycle.add_on_child_add_hook(this._on_child_add.bind(this)),this.lifecycle.add_on_child_remove_hook(this._on_child_remove.bind(this))},t.prototype.init_default_scene=function(){this._object.name="_WORLD_",this._scene.default_scene.add(this._object)},t.prototype.object=function(){return this._object},t.prototype.create_node=function(t){return e.prototype.create_node.call(this,t)},t.prototype.children=function(){return e.prototype.children.call(this)},t.prototype.nodes_by_type=function(t){return e.prototype.nodes_by_type.call(this,t)},t.prototype.multiple_display_flags_allowed=function(){return!0},t.prototype.add_to_queue=function(e){var t=e.graph_node_id;if(null==this._queued_nodes_by_id[t])return this._queued_nodes_by_id[t]=e},t.prototype.process_queue=function(){return r.__awaiter(this,void 0,void 0,(function(){var e,t,n,o,i,s,_,u,c,p=this;return r.__generator(this,(function(r){switch(r.label){case 0:for(this._queued_nodes_by_path={},e=Object.keys(this._queued_nodes_by_id),t=0,n=e;t<n.length;t++)o=n[t],i=this._queued_nodes_by_id[o],delete this._queued_nodes_by_id[o],s="_____"+i.render_order+"__"+i.full_path(),this._queued_nodes_by_path[s]=i;return _=Object.keys(this._queued_nodes_by_path).sort().map((function(e){var t=p._queued_nodes_by_path[e];return p.update_object(t)})),u=this,(c=this._expected_geo_nodes)?[3,2]:[4,this.expected_loading_geo_nodes_by_id()];case 1:c=r.sent(),r.label=2;case 2:return u._expected_geo_nodes=c,this._process_queue_start=performance.now(),Promise.all(_).then((function(){a.POLY.log("SCENE LOADED '"+p.scene.name+"' in "+(performance.now()-p._process_queue_start))})),[2]}}))}))},t.prototype.update_object=function(e){this.scene.loading_controller.auto_updating?this.add_to_scene(e):this.add_to_queue(e)},t.prototype.get_parent_for_node=function(e){if(e.attachable_to_hierarchy){var t=e.io.inputs.input(0);return t?t.children_group:this._object}return null},t.prototype.add_to_scene=function(e){if(e.attachable_to_hierarchy){var t=this.get_parent_for_node(e);t&&(e.used_in_scene?e.add_object_to_parent(t):e.remove_object_from_parent())}},t.prototype.remove_from_scene=function(e){e.remove_object_from_parent()},t.prototype.are_children_cooking=function(){for(var e=0,t=this.children();e<t.length;e++){if(t[e].is_display_node_cooking())return!0}return!1},t.prototype.expected_loading_geo_nodes_by_id=function(){return r.__awaiter(this,void 0,void 0,(function(){var e,t,n,o,i;return r.__generator(this,(function(r){switch(r.label){case 0:e=this.nodes_by_type("geo"),t={},n=0,o=e,r.label=1;case 1:return n<o.length?[4,(i=o[n]).is_displayed()]:[3,4];case 2:r.sent()&&(t[i.graph_node_id]=i),r.label=3;case 3:return n++,[3,1];case 4:return[2,t]}}))}))},t.prototype.add_to_parent_transform=function(e){this.update_object(e)},t.prototype.remove_from_parent_transform=function(e){this.update_object(e)},t.prototype._on_child_add=function(e){e&&this.update_object(e)},t.prototype._on_child_remove=function(e){e&&this.remove_from_scene(e)},t}(i.TypedBaseManagerNode);t.ObjectsManagerNode=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(90),i=n(27),a=n(113),s=n(630),_=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.container_controller=new a.TypedContainerController(t,s.ManagerContainer),t}return r.__extends(t,e),t.node_context=function(){return i.NodeContext.MANAGER},t}(o.TypedNode);t.TypedBaseManagerNode=_;var u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t}(_);t.BaseManagerNodeClass=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.set_content=function(t){e.prototype.set_content.call(this,t)},t}(n(115).TypedContainer);t.ManagerContainer=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=r.__importDefault(n(91)),i=r.__importDefault(n(169)),a=r.__importDefault(n(102)),s=n(632),_=function(){function e(){this._started=!1,this._start_time=0,this._previous_timestamp=0,this._nodes_cook_data={},this._durations_by_name={},this._durations_count_by_name={}}return e.prototype.profile=function(e,t){var n=performance.now();t();var r=performance.now()-n;console.log(e+": "+r)},e.prototype.start=function(){this._started||(this.reset(),this._started=!0,this._start_time=performance.now(),this._nodes_cook_data={},this._previous_timestamp=this._start_time)},e.prototype.stop=function(){this.reset()},e.prototype.reset=function(){this._started=!1,this._start_time=null,this._durations_by_name={},this._durations_count_by_name={},this._nodes_cook_data={}},Object.defineProperty(e.prototype,"started",{get:function(){return this._started},enumerable:!0,configurable:!0}),e.prototype.record_node_cook_data=function(e){var t=e.graph_node_id;null==this._nodes_cook_data[t]&&(this._nodes_cook_data[t]=new s.PerformanceNode(e)),this._nodes_cook_data[t].update_cook_data()},e.prototype.record=function(e){this.started||this.start();var t=performance.now();return null==this._durations_by_name[e]&&(this._durations_by_name[e]=0),this._durations_by_name[e]+=t-this._previous_timestamp,null==this._durations_count_by_name[e]&&(this._durations_count_by_name[e]=0),this._durations_count_by_name[e]+=1,this._previous_timestamp=t},e.prototype.print=function(){this.print_node_cook_data(),this.print_recordings()},e.prototype.print_node_cook_data=function(){var e=Object.values(this._nodes_cook_data),t=(e=a.default(e,(function(e){return-e.cook_time_total}))).map((function(e){return e.print_object()}));console.log("--------------- NODES COOK TIME -----------");for(var n=[],r=0,o=a.default(t,(function(e){return-e.cook_time_total}));r<o.length;r++){var i=o[r];n.push(i)}return console.table(n),t},e.prototype.print_recordings=function(){for(var e=i.default(this._durations_by_name),t=i.default(this._durations_count_by_name),n=[],r={},a=0,s=Object.keys(e);a<s.length;a++){var _=s[a],u=e[_];n.push(u),null==r[u]&&(r[u]=[]),r[u].push(_)}n.sort((function(e,t){return e-t}));var c=o.default(n);console.log("--------------- PERF RECORDINGS -----------");for(var p=[],l=0,d=c;l<d.length;l++)for(var f=0,h=r[u=d[l]];f<h.length;f++){var m=h[f],y=t[m],v={duration:u,name:m,count:y,duration_per_iteration:u/y};p.push(v)}return console.table(p),p},e}();t.CorePerformance=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this._node=e,this._cooks_count=0,this._cook_time_total=0,this._cook_time_total_with_inputs=0,this._cook_time_total_params=0}return e.prototype.update_cook_data=function(){this._cooks_count+=1,this._cook_time_total+=this._node.cook_controller.cook_time,this._cook_time_total_with_inputs+=this._node.cook_controller.cook_time_with_inputs,this._cook_time_total_params+=this._node.cook_controller.cook_time_params},Object.defineProperty(e.prototype,"cook_time_total",{get:function(){return this._cook_time_total},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cook_time_per_iteration",{get:function(){return this._cooks_count>0?this._cook_time_total/this._cooks_count:0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cook_time_total_with_inputs",{get:function(){return this._cook_time_total_with_inputs},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cook_time_total_with_inputs_per_iteration",{get:function(){return this._cooks_count>0?this._cook_time_total_with_inputs/this._cooks_count:0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cook_time_total_params",{get:function(){return this._cook_time_total_params},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cook_time_total_params_per_iteration",{get:function(){return this._cooks_count>0?this._cook_time_total_params/this._cooks_count:0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cooks_count",{get:function(){return this._cooks_count},enumerable:!0,configurable:!0}),e.prototype.print_object=function(){return{full_path:this._node.full_path(),cooks_count:this.cooks_count,cook_time_total:this.cook_time_total,cook_time_per_iteration:this.cook_time_per_iteration,cook_time_total_with_inputs:this.cook_time_total_with_inputs,cook_time_total_with_inputs_per_iteration:this.cook_time_total_with_inputs_per_iteration,cook_time_total_params:this.cook_time_total_params,cook_time_total_params_per_iteration:this.cook_time_total_params_per_iteration}},e}();t.PerformanceNode=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(67),o=n(634),i=function(){function e(e){this.scene=e,this.self=this,this._frame=1,this._time=0,this._prev_performance_now=0,this._frame_range=[1,600],this._frame_range_locked=[!0,!0],this._playing=!1,this._graph_node=new r.CoreGraphNode(e,"time controller")}return Object.defineProperty(e.prototype,"graph_node",{get:function(){return this._graph_node},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"frame",{get:function(){return this._frame},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"time",{get:function(){return this._time},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"frame_range",{get:function(){return this._frame_range},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"frame_range_locked",{get:function(){return this._frame_range_locked},enumerable:!0,configurable:!0}),e.prototype.set_frame_range=function(e,t){this._frame_range[0]=Math.floor(e),this._frame_range[1]=Math.floor(t),this.scene.dispatch_controller.dispatch(this._graph_node,o.SceneEvent.FRAME_RANGE_UPDATED)},e.prototype.set_frame_range_locked=function(e,t){this._frame_range_locked[0]=e,this._frame_range_locked[1]=t,this.scene.dispatch_controller.dispatch(this._graph_node,o.SceneEvent.FRAME_RANGE_UPDATED)},e.prototype.set_time=function(e,t){if(void 0===t&&(t=!0),e!=this._time){if(this._time=e,t){var n=Math.floor(60*this._time);this._frame=n}this.scene.dispatch_controller.dispatch(this._graph_node,o.SceneEvent.FRAME_UPDATED),this.scene.uniforms_controller.update_time_dependent_uniform_owners(),this.scene.cooker.block(),this.graph_node.set_successors_dirty(),this.scene.cooker.unblock()}},e.prototype.set_frame=function(e,t){void 0===t&&(t=!0),e!=this._frame&&(e=this._ensure_frame_within_bounds(e))!=this._frame&&(this._frame=e,t&&this.set_time(this._frame/60,!1))},e.prototype.increment_time_if_playing=function(){this._playing&&(this.scene.root.are_children_cooking()||this.increment_time())},e.prototype.increment_time=function(){var e=performance.now(),t=(e-this._prev_performance_now)/1e3,n=this._time+t;this._prev_performance_now=e,this.set_time(n)},e.prototype._ensure_frame_within_bounds=function(e){return this._frame_range_locked[0]&&e<this._frame_range[0]?this._frame_range[1]:this._frame_range_locked[1]&&e>this._frame_range[1]?this._frame_range[0]:e},Object.defineProperty(e.prototype,"playing",{get:function(){return!0===this._playing},enumerable:!0,configurable:!0}),e.prototype.pause=function(){1==this._playing&&(this._playing=!1,this.scene.dispatch_controller.dispatch(this._graph_node,o.SceneEvent.PLAY_STATE_UPDATED))},e.prototype.play=function(){!0!==this._playing&&(this._playing=!0,this._prev_performance_now=performance.now(),this.scene.dispatch_controller.dispatch(this._graph_node,o.SceneEvent.PLAY_STATE_UPDATED))},e.prototype.toggle_play_pause=function(){this.playing?this.pause():this.play()},e}();t.TimeController=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.FRAME_RANGE_UPDATED="scene_frame_range_updated",e.FRAME_UPDATED="scene_frame_updated",e.PLAY_STATE_UPDATED="scene_play_state_updated"}(t.SceneEvent||(t.SceneEvent={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(348),o=function(){function e(e){this.scene=e}return e.prototype.to_json=function(e){void 0===e&&(e=!1);for(var t={},n={},o=0,i=this.scene.nodes_controller.all_nodes();o<i.length;o++){var a=i[o],s=new r.NodeSerializer(a);t[a.graph_node_id]=s.to_json(e);for(var _=0,u=a.params.all;_<u.length;_++){var c=u[_];n[c.graph_node_id]=c.to_json()}}return{nodes_by_graph_node_id:t,params_by_graph_node_id:n}},e}();t.PolySceneSerializer=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=function(){function e(e){this.scene=e,this._time_dependent_uniform_owners={},this._time_dependent_uniform_owners_ids=null,this._resolution=new r.Vector2(1,1),this._resolution_dependent_uniform_owners={},this._resolution_dependent_uniform_owners_ids=[]}return e.prototype.add_time_dependent_uniform_owner=function(e,t){this._time_dependent_uniform_owners[e]=t,this._update_time_dependent_uniform_owners_ids()},e.prototype.remove_time_dependent_uniform_owner=function(e){delete this._time_dependent_uniform_owners[e],this._update_time_dependent_uniform_owners_ids()},e.prototype._update_time_dependent_uniform_owners_ids=function(){this._time_dependent_uniform_owners_ids=Object.keys(this._time_dependent_uniform_owners)},e.prototype.update_time_dependent_uniform_owners=function(){var e=this.scene.time;if(this._time_dependent_uniform_owners_ids)for(var t=0,n=this._time_dependent_uniform_owners_ids;t<n.length;t++){var r=n[t];this._time_dependent_uniform_owners[r].time.value=e}},e.prototype.add_resolution_dependent_uniform_owner=function(e,t){this._resolution_dependent_uniform_owners[e]=t,this._update_resolution_dependent_uniform_owners_ids(),this._resolution&&this.update_resolution_dependent_uniforms(t)},e.prototype.remove_resolution_dependent_uniform_owner=function(e){delete this._resolution_dependent_uniform_owners[e],this._update_resolution_dependent_uniform_owners_ids()},e.prototype._update_resolution_dependent_uniform_owners_ids=function(){this._resolution_dependent_uniform_owners_ids=Object.keys(this._resolution_dependent_uniform_owners)},e.prototype.update_resolution_dependent_uniform_owners=function(e){this._resolution.copy(e);for(var t=0,n=this._resolution_dependent_uniform_owners_ids;t<n.length;t++){var r=n[t],o=this._resolution_dependent_uniform_owners[r];this.update_resolution_dependent_uniforms(o)}},e.prototype.update_resolution_dependent_uniforms=function(e){e.resolution.value.x=this._resolution.x*window.devicePixelRatio,e.resolution.value.y=this._resolution.y*window.devicePixelRatio},e}();t.UniformsController=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(66),o=function(){function e(){this._require_webgl2=!1}return e.prototype.require_webgl2=function(){return this._require_webgl2},e.prototype.set_require_webgl2=function(){this._require_webgl2||(this._require_webgl2=!0,r.POLY.renderers_controller.set_require_webgl2())},e}();t.WebGLController=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(639),o=n(675),i=n(680),a=n(764),s=n(788),_=n(825),u=n(66),c=function(){function e(){}return e.run=function(){r.CopRegister.run(u.POLY),o.EventRegister.run(u.POLY),i.GlRegister.run(u.POLY),a.MatRegister.run(u.POLY),s.ObjRegister.run(u.POLY),_.SopRegister.run(u.POLY)},e}();t.AllRegister=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(130),o=n(640),i=n(667),a=n(135),s=n(673),_=n(674),u=function(){function e(){}return e.run=function(e){e.register_node(o.BuilderCopNode,r.CATEGORY_COP.ADVANCED),e.register_node(i.EnvMapCopNode,r.CATEGORY_COP.INPUT),e.register_node(a.FileCopNode,r.CATEGORY_COP.INPUT),e.register_node(s.NullCopNode,r.CATEGORY_COP.MISC),e.register_node(_.SwitchCopNode,r.CATEGORY_COP.MISC)},e}();t.CopRegister=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(410),i=n(75),a=n(26),s=n(55),_=n(0),u=n(54),c=n(0),p=n(22),l=n(0),d=n(0),f=n(70),h=n(0),m=n(77),y=n(131),v=n(132),g=n(658),b="\nvoid main()\t{\n\tgl_Position = vec4( position, 1.0 );\n}\n",x=n(5),P=n(133),T=n(270),w=n(27),C=n(666),O=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.resolution=x.ParamConfig.VECTOR2([256,256]),t}return r.__extends(t,e),t}(x.NodeParamsConfig)),E=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=O,t._assembler_controller=t._create_assembler_controller(),t._texture_mesh=new p.Mesh(new u.PlaneBufferGeometry(2,2)),t._texture_material=new a.ShaderMaterial({uniforms:{},vertexShader:b,fragmentShader:""}),t._texture_scene=new s.Scene,t._texture_camera=new m.Camera,t._children_controller_context=w.NodeContext.GL,t}return r.__extends(t,e),t.type=function(){return"builder"},t.prototype._create_assembler_controller=function(){var e=new P.GlobalsGeometryHandler,t=new v.GlAssemblerController(this,g.ShaderAssemblerTexture);return t.set_assembler_globals_handler(e),t},Object.defineProperty(t.prototype,"assembler_controller",{get:function(){return this._assembler_controller},enumerable:!0,configurable:!0}),t.prototype.initialize_node=function(){var e,t=this;this.lifecycle.add_on_create_hook(this.assembler_controller.on_create.bind(this.assembler_controller)),null===(e=this.children_controller)||void 0===e||e.init(),this._texture_mesh.material=this._texture_material,this._texture_scene.add(this._texture_mesh),this._texture_camera.position.z=1,this.dirty_controller.add_post_dirty_hook("_reset_if_resolution_changed",this._reset_if_resolution_changed.bind(this)),this.params.set_post_create_params_hook((function(){t._render_target=t._create_render_target(),t._renderer=t._create_renderer(t._render_target)}))},t.prototype.create_node=function(t){return e.prototype.create_node.call(this,t)},t.prototype.children=function(){return e.prototype.children.call(this)},t.prototype.nodes_by_type=function(t){return e.prototype.nodes_by_type.call(this,t)},t.prototype._reset_if_resolution_changed=function(e){e&&e.graph_node_id==this.p.resolution.graph_node_id&&this._reset()},t.prototype._reset=function(){this._render_target=this._create_render_target(),this._renderer=this._create_renderer(this._render_target),this._pixelBuffer=this._create_pixel_buffer()},t.prototype._create_pixel_buffer=function(){var e=this.pv.resolution.x,t=this.pv.resolution.y;return new Float32Array(e*t*4)},t.prototype.cook=function(){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(e){switch(e.label){case 0:return[4,this.compile_if_required()];case 1:return e.sent(),this.render_on_target(),[2]}}))}))},t.prototype.shaders_by_name=function(){return{fragment:this._fragment_shader}},t.prototype.compile_if_required=function(){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(e){switch(e.label){case 0:return this.assembler_controller.compile_required()?[4,this.run_assembler()]:[3,2];case 1:e.sent(),this.assembler_controller.post_compile(),e.label=2;case 2:return[2]}}))}))},t.prototype.run_assembler=function(){return r.__awaiter(this,void 0,void 0,(function(){var e,t,n,o;return r.__generator(this,(function(r){switch(r.label){case 0:return(e=T.GlNodeFinder.find_output_nodes(this)).length>1?(this.states.error.set("only one output node allowed"),[2]):(t=e[0])?(this.assembler_controller.assembler.set_root_nodes([t]),[4,this.assembler_controller.assembler.update_fragment_shader()]):[3,2];case 1:r.sent(),n=this.assembler_controller.assembler.fragment_shader(),o=this.assembler_controller.assembler.uniforms(),n&&o&&(this._fragment_shader=n,this._uniforms=o),this.assembler_controller.assembler.uniforms_time_dependent()?this.states.time_dependent.force_time_dependent():this.states.time_dependent.unforce_time_dependent(),r.label=2;case 2:return this._fragment_shader&&this._uniforms&&(this._texture_material.fragmentShader=this._fragment_shader,this._texture_material.uniforms=this._uniforms,this._texture_material.needsUpdate=!0,this._texture_material.uniforms.resolution={value:this.pv.resolution}),[2]}}))}))},t.prototype._create_renderer=function(e){var t=new o.WebGLRenderer({antialias:!0});return t.setPixelRatio(window.devicePixelRatio),t.autoClear=!1,t.setRenderTarget(e),t},t.prototype.render_on_target=function(){return r.__awaiter(this,void 0,void 0,(function(){var e,t,n;return r.__generator(this,(function(r){switch(r.label){case 0:return e=this.pv.resolution.x,t=this.pv.resolution.y,this._renderer&&this._render_target?(this._renderer.clear(),this._renderer.render(this._texture_scene,this._texture_camera),this._pixelBuffer=this._pixelBuffer||this._create_pixel_buffer(),this._renderer.readRenderTargetPixels(this._render_target,0,0,e,t,this._pixelBuffer),n=new f.DataTexture(this._pixelBuffer,e,t,_.RGBAFormat,d.FloatType),[4,C.CoreSleep.sleep(2e3)]):[2];case 1:return r.sent(),n?this.set_texture(n):this.cook_controller.end_cook(),[2]}}))}))},t.prototype._create_render_target=function(){var e=h.ClampToEdgeWrapping,t=h.ClampToEdgeWrapping,n=c.NearestFilter,r=c.NearestFilter;return new i.WebGLRenderTarget(this.pv.resolution.x,this.pv.resolution.y,{wrapS:e,wrapT:t,minFilter:n,magFilter:r,format:_.RGBAFormat,type:/(iPad|iPhone|iPod)/g.test(navigator.userAgent)?l.HalfFloatType:d.FloatType,stencilBuffer:!1,depthBuffer:!1})},t}(y.TypedCopNode);t.BuilderCopNode=E},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.set_content=function(t){e.prototype.set_content.call(this,t)},t.prototype.texture=function(){return this._content},t.prototype.core_content=function(){return this._content},t.prototype.core_content_cloned=function(){var e;console.log("clone",this._content);var t=null===(e=this._content)||void 0===e?void 0:e.clone();return t&&(t.needsUpdate=!0),t},t.prototype.object=function(){return this.texture()},t.prototype.infos=function(){if(null!=this._content)return[this._content]},t.prototype.resolution=function(){return this._content&&this._content.image?[this._content.image.width,this._content.image.height]:[-1,-1]},t}(n(115).TypedContainer);t.TextureContainer=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(358),i=n(61),a=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._state=!1,t}return r.__extends(t,e),t.prototype.on_update=function(){this.node.emit(i.NodeEvent.FLAG_BYPASS_UPDATED),this.node.set_dirty()},t}(o.BaseFlag);t.BypassFlag=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(358),i=n(61),a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.on_update=function(){this.node.emit(i.NodeEvent.FLAG_DISPLAY_UPDATED)},t}(o.BaseFlag);t.DisplayFlag=a},,,,,,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(16),i=n(33),a=r.__importDefault(n(169)),s=r.__importDefault(n(21)),_=r.__importDefault(n(44)),u=function(){function e(e){this.node=e,this._allow_inputs_created_from_params=!0}return e.prototype.disallow_inputs_created_from_params=function(){this._allow_inputs_created_from_params=!1},e.prototype.initialize_node=function(){this.node.params.set_post_create_params_hook(this.create_inputs_from_params.bind(this))},e.prototype.create_inputs_from_params=function(){if(this._allow_inputs_created_from_params){for(var e=[],t=0,n=this.node.params.names;t<n.length;t++){var r=n[t],a=!0;if(this._inputless_param_names&&this._inputless_param_names.length>0&&this._inputless_param_names.includes(r)&&(a=!1),a&&this.node.params.has(r)){var s=this.node.params.get(r);if(s&&!s.parent_param){var _=o.ParamTypeToConnectionPointTypeMap[s.type];if(_){var u=new i.TypedNamedConnectionPoint(s.name,_);e.push(u)}}}}this.node.io.inputs.set_named_input_connection_points(e)}},e.prototype.set_inputless_param_names=function(e){return this._inputless_param_names=e},e.prototype.create_spare_parameters=function(){for(var e=new Map,t=new Map,n={},r=0,o=this.node.params.spare_names;r<o.length;r++){var i=o[r];if(this.node.params.has(i)){var u=this.node.params.get(i);u&&(e.set(i,u.raw_input_serialized),t.set(i,u.default_value_serialized),n.names_to_delete=n.names_to_delete||[],n.names_to_delete.push(i))}}for(var c=0,p=this.node.io.inputs.named_input_connection_points;c<p.length;c++){var l=p[c],d=(i=l.name,l.param_type),f=l.init_value,h=t.get(i),m=this.node.gl_input_default_value(i);if(f=null!=m?m:null!=h?h:l.init_value,s.default(l.init_value)&&_.default(f)){for(var y=new Array(l.init_value.length),v=0;v<y.length;v++)y[v]=f;f=y}null!=f&&(n.to_add=n.to_add||[],n.to_add.push({name:i,type:d,init_value:a.default(f),options:{spare:!0}}))}if(!this.node.scene.loading_controller.is_loading){this.node.params.update_params(n);for(var g=0,b=this.node.params.spare;g<b.length;g++){var x=b[g];if(!x.parent_param){var P=e.get(x.name);P&&x.set(P)}}}},e}();t.GlNodeSpareParamsController=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(193),o=n(267),i=function(){function e(e){this._node=e}return e.prototype.data=function(){var e,t,n,r;this.is_root()||this._node.scene.nodes_controller.register_node_context_signature(this._node),this._data={type:this._node.type};var o=this.nodes_data();if(Object.keys(o).length>0){this._data.nodes=o;var i=null===(e=this._node.children_controller)||void 0===e?void 0:e.context;i&&(this._data.children_context=i)}if(this.is_root()||(this._data.params=this.params_data(),this._data.inputs=this.inputs_data()),this._node.flags&&(this._data.flags={},this._node.flags.has_bypass()&&(null===(t=this._node.flags.bypass)||void 0===t?void 0:t.active)&&(this._data.flags.bypass=this._node.flags.bypass.active),this._node.flags.has_display()&&(this._data.flags.display=null===(n=this._node.flags.display)||void 0===n?void 0:n.active)),this._node.children_allowed()){var a=null===(r=this._node.children_controller)||void 0===r?void 0:r.selection;if(a&&this._node.children().length>0){for(var s=[],_={},u=0,c=a.nodes();u<c.length;u++){_[c[u].graph_node_id]=!0}for(var p=0,l=this._node.children();p<l.length;p++){var d=l[p];d.graph_node_id in _&&s.push(d)}this._data.selection=s.map((function(e){return e.name}))}}if(this._node.io.inputs.override_clonable_state_allowed()){var f=this._node.io.inputs.override_clonable_state();f&&(this._data.override_clonable_state=f)}return this.add_custom(),this._data},e.prototype.ui_data=function(){var e={};if(!this.is_root()){var t=this._node.ui_data;e.pos=t.position.toArray();var n=t.comment;n&&(e.comment=r.SceneJsonExporter.sanitize_string(n))}var i=this._node.children();return i.length>0&&(e.nodes={},i.forEach((function(t){var n=o.JsonExportDispatcher.dispatch_node(t);e.nodes[t.name]=n.ui_data()}))),e},e.prototype.is_root=function(){return null===this._node.parent&&this._node.graph_node_id==this._node.root.graph_node_id},e.prototype.inputs_data=function(){var e=this,t=[];return this._node.io.inputs.inputs().forEach((function(n,r){if(n){var o=e._node.io.connections.input_connection(r);if(e._node.io.inputs.has_named_inputs){var i=e._node.io.inputs.named_input_connection_points[r].name,a=o.output_index,s=n.io.outputs.named_output_connection_points[a].name;t.push({name:i,node:n.name,output:s})}else t.push(n.name)}})),t},e.prototype.params_data=function(){for(var e={},t=0,n=this._node.params.names;t<n.length;t++){var r=n[t],i=this._node.params.get(r);if(i&&!i.parent_param){var a=o.JsonExportDispatcher.dispatch_param(i);if(a.required){var s=a.data();e[i.name]=s}}}return e},e.prototype.nodes_data=function(){for(var e={},t=0,n=this._node.children();t<n.length;t++){var r=n[t],i=o.JsonExportDispatcher.dispatch_node(r);e[r.name]=i.data()}return e},e.prototype.add_custom=function(){},e}();t.NodeJsonExporter=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.add_main=function(){if(!this._require_data_complex())return this._param.raw_input_serialized;this._complex_data.raw_input=this._param.raw_input_serialized},t}(n(157).ParamJsonExporter);t.ParamNumericJsonExporter=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(157),i=n(193),a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.add_main=function(){var e=this._param.raw_input;if(e=i.SceneJsonExporter.sanitize_string(e),!this._require_data_complex())return e;this._complex_data.raw_input=e},t}(o.ParamJsonExporter);t.ParamOperatorPathJsonExporter=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(157),i=n(193),a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.add_main=function(){var e=this._param.raw_input;if(e=i.SceneJsonExporter.sanitize_string(e),!this._require_data_complex())return e;this._complex_data.raw_input=e},t}(o.ParamJsonExporter);t.ParamStringJsonExporter=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.add_main=function(){if(!this._require_data_complex())return this._param.raw_input_serialized;this._complex_data.raw_input=this._param.raw_input_serialized},t}(n(157).ParamJsonExporter);t.ParamRampJsonExporter=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(158),i=n(28),a=r.__importDefault(n(665)),s=n(194),_=n(195),u=n(50),c=n(24),p=n(33),l=n(16),d=n(29),f=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),Object.defineProperty(t.prototype,"_template_shader",{get:function(){return{fragmentShader:a.default,vertexShader:void 0,uniforms:void 0}},enumerable:!0,configurable:!0}),t.prototype.fragment_shader=function(){return this._shaders_by_name.get(u.ShaderName.FRAGMENT)},t.prototype.uniforms=function(){return this._uniforms},t.prototype.update_fragment_shader=function(){return r.__awaiter(this,void 0,void 0,(function(){var e,t,n,o,i,a,s,_,c;return r.__generator(this,(function(r){switch(r.label){case 0:for(this._lines=new Map,this._shaders_by_name=new Map,e=0,t=this.shader_names;e<t.length;e++)(a=t[e])==u.ShaderName.FRAGMENT&&(n=this._template_shader.fragmentShader,this._lines.set(a,n.split("\n")));return this._root_nodes.length>0?[4,this.build_code_from_nodes(this._root_nodes)]:[3,2];case 1:r.sent(),this._build_lines(),r.label=2;case 2:for(this._uniforms=this._uniforms||{},this.add_uniforms(this._uniforms),o=0,i=this.shader_names;o<i.length;o++)a=i[o],(s=this._lines.get(a))&&this._shaders_by_name.set(a,s.join("\n"));return _=this._gl_parent_node.scene,c=this._gl_parent_node.graph_node_id,this.uniforms_time_dependent()?this._uniforms&&_.uniforms_controller.add_time_dependent_uniform_owner(c,this._uniforms):_.uniforms_controller.remove_time_dependent_uniform_owner(c),[2]}}))}))},t.prototype.add_output_params=function(e){e.add_param(c.ParamType.COLOR,"color",[1,1,1],{hidden:!0}),e.add_param(c.ParamType.FLOAT,"alpha",1,{hidden:!0})},t.prototype.add_globals_params=function(e){e.io.outputs.set_named_output_connection_points([new p.TypedNamedConnectionPoint("gl_FragCoord",l.ConnectionPointType.VEC2),new p.TypedNamedConnectionPoint("time",l.ConnectionPointType.FLOAT)])},t.prototype.create_shader_configs=function(){return[new s.ShaderConfig(u.ShaderName.FRAGMENT,["color","alpha"],[])]},t.prototype.create_variable_configs=function(){return[new _.VariableConfig("color",{prefix:"diffuseColor.xyz = "}),new _.VariableConfig("alpha",{prefix:"diffuseColor.a = ",default:"1.0"})]},t.prototype.insert_define_after=function(e){return"// INSERT DEFINE"},t.prototype.insert_body_after=function(e){return"// INSERT BODY"},t.prototype.lines_to_remove=function(e){return["// INSERT DEFINE","// INSERT BODY"]},t.prototype.handle_gl_FragCoord=function(e,t,n){"fragment"==t&&e.push("vec2 "+n+" = vec2(gl_FragCoord.x / resolution.x, gl_FragCoord.y / resolution.y)")},t.prototype.set_node_lines_output=function(e,t){var n=this.input_names_for_shader_name(e,t.current_shader_name);if(n)for(var r=0,o=n;r<o.length;r++){var a=o[r];if(e.io.inputs.named_input(a)){var s=e.variable_for_input(a),_=void 0;"color"==a&&(_="diffuseColor.xyz = "+i.ThreeToGl.any(s)),"alpha"==a&&(_="diffuseColor.a = "+i.ThreeToGl.any(s)),_&&t.add_body_lines(e,[_])}}},t.prototype.set_node_lines_globals=function(e,t){var n=t.current_shader_name;if(this.shader_config(n)){for(var r=[],o=[],i=0,a=e.io.outputs.used_output_names();i<a.length;i++){var s=a[i],_=e.gl_var_name(s);switch(s){case"time":o.push(new d.UniformGLDefinition(e,l.ConnectionPointType.FLOAT,s)),r.push("float "+_+" = "+s),this.set_uniforms_time_dependent();break;case"gl_FragCoord":this.handle_gl_FragCoord(r,n,_)}}t.add_definitions(e,o,n),t.add_body_lines(e,r)}},t}(o.BaseGlShaderAssembler);t.ShaderAssemblerTexture=f},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=r.__importDefault(n(91)),i=n(364),a=n(129),s=n(29),_=n(363),u=n(196),c=n(661),p=n(663),l=n(268),d=function(){function e(e,t){this._assembler=e,this._gl_parent_node=t,this._param_configs_controller=new u.ParamConfigsController,this._param_configs_set_allowed=!0,this._lines=new Map,this._function_declared=new Map}return e.prototype.build_from_nodes=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,n,s,_,u,p,l,d,f,h,m,y,v,g,b,x,P,T,w,C,O,E,A,N,M,j,S;return r.__generator(this,(function(r){switch(r.label){case 0:for((t=new i.TypedNodeTraverser(this._assembler,this._gl_parent_node)).traverse(e),n=new Map,s=0,_=this.shader_names();s<_.length;s++)A=_[s],n.set(A,t.nodes_for_shader_name(A));for(u=t.sorted_nodes(),p=0,l=this.shader_names();p<l.length;p++)for(A=l[p],d=this._assembler.root_nodes_by_shader_name(A),f=0,h=d;f<h.length;f++)x=h[f],a.MapUtils.push_on_array_at_entry(n,A,x);for(m=new Map,y=0,v=u;y<v.length;y++)S=v[y],m.set(S.graph_node_id,!0);for(g=0,b=e;g<b.length;g++)x=b[g],m.get(x.graph_node_id)||(u.push(x),m.set(x.graph_node_id,!0));for(P=0,T=u;P<T.length;P++)(S=T[P]).reset_code();w=0,C=u,r.label=1;case 1:return w<C.length?[4,(S=C[w]).params.eval_all()]:[3,4];case 2:r.sent(),r.label=3;case 3:return w++,[3,1];case 4:for(this._shaders_collection_controller=new c.ShadersCollectionController(this.shader_names(),this.shader_names()[0]),this.reset(),O=0,E=this.shader_names();O<E.length;O++)if(A=E[O],N=o.default(n.get(A)),this._shaders_collection_controller.set_current_shader_name(A),N)for(M=0,j=N;M<j.length;M++)S=j[M],this._param_configs_set_allowed&&S.set_param_configs(),S.set_lines(this._shaders_collection_controller);return this._param_configs_set_allowed&&this.set_param_configs(u),this.set_code_lines(u),[2]}}))}))},e.prototype.disallow_new_param_configs=function(){this._param_configs_set_allowed=!1},e.prototype.allow_new_param_configs=function(){this._param_configs_set_allowed=!0},e.prototype.shader_names=function(){return this._assembler.shader_names},e.prototype.reset=function(){for(var e=0,t=this.shader_names();e<t.length;e++){var n=t[e],r=new Map;this._lines.set(n,r),this._function_declared.set(n,new Map)}},e.prototype.param_configs=function(){return this._param_configs_controller.list||[]},e.prototype.lines=function(e,t){return this._lines.get(e).get(t)},e.prototype.all_lines=function(){return this._lines},e.prototype.set_param_configs=function(e){this._param_configs_controller.reset();for(var t=0,n=e;t<n.length;t++){var r=n[t].param_configs();if(r)for(var o=0,i=r;o<i.length;o++){var a=i[o];this._param_configs_controller.push(a)}}},e.prototype.set_code_lines=function(e){for(var t=0,n=this.shader_names();t<n.length;t++){var r=n[t];this.add_code_lines(e,r)}},e.prototype.add_code_lines=function(e,t){this.add_definitions(e,t,s.GLDefinitionType.FUNCTION,l.LineType.FUNCTION_DECLARATION),this.add_definitions(e,t,s.GLDefinitionType.UNIFORM,l.LineType.DEFINE),this.add_definitions(e,t,s.GLDefinitionType.VARYING,l.LineType.DEFINE),this.add_definitions(e,t,s.GLDefinitionType.ATTRIBUTE,l.LineType.DEFINE),this.add_code_line_for_nodes_and_line_type(e,t,l.LineType.BODY)},e.prototype.add_definitions=function(e,t,n,r){if(this._shaders_collection_controller){for(var o=[],i=0,s=e;i<s.length;i++){var u=s[i],c=this._shaders_collection_controller.definitions(t,u);if(c)for(var l=0,d=c=c.filter((function(e){return e.definition_type==n}));l<d.length;l++){var f=d[l];o.push(f)}}if(o.length>0){var h=new _.TypedGLDefinitionCollection(o),m=h.uniq();if(h.errored)throw"code builder error: "+h.error_message;for(var y=new Map,v=new Map,g=0,b=m;g<b.length;g++){var x=(f=b[g]).node.graph_node_id;v.has(x)||v.set(x,!0),a.MapUtils.push_on_array_at_entry(y,x,f)}var P=this._lines.get(t);v.forEach((function(e,t){var n=y.get(t);if(n){var o=n[0];if(o){var i=p.CodeFormatter.node_comment(o.node,r);a.MapUtils.push_on_array_at_entry(P,r,i);for(var s=0,_=n;s<_.length;s++){var u=_[s],c=p.CodeFormatter.line_wrap(u.line,r);a.MapUtils.push_on_array_at_entry(P,r,c)}var l=p.CodeFormatter.post_line_separator(r);a.MapUtils.push_on_array_at_entry(P,r,l)}}}))}}},e.prototype.add_code_line_for_nodes_and_line_type=function(e,t,n){for(var r=this,o=(e=e.filter((function(e){if(r._shaders_collection_controller){var n=r._shaders_collection_controller.body_lines(t,e);return n&&n.length>0}}))).length,i=0;i<o;i++){var a=i==e.length-1;this.add_code_line_for_node_and_line_type(e[i],t,n,a)}},e.prototype.add_code_line_for_node_and_line_type=function(e,t,n,r){if(this._shaders_collection_controller){var i=this._shaders_collection_controller.body_lines(t,e);if(i&&i.length>0){var s=this._lines.get(t),_=p.CodeFormatter.node_comment(e,n);if(a.MapUtils.push_on_array_at_entry(s,n,_),o.default(i).forEach((function(e){e=p.CodeFormatter.line_wrap(e,n),a.MapUtils.push_on_array_at_entry(s,n,e)})),n!=l.LineType.BODY||!r){var u=p.CodeFormatter.post_line_separator(n);a.MapUtils.push_on_array_at_entry(s,n,u)}}}},e}();t.CodeBuilder=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(269),i=n(20),a=n(1),s=n(3),_=n(24),u=n(349),c=n(27),p=n(192),l=function(){function e(e,t,n,r){this._type=e,this._name=t,this._default_value=n,this._uniform_name=r}return e.from_param=function(t,n){return new e(t.type,t.name,t.default_value,n)},Object.defineProperty(e.prototype,"type",{get:function(){return this._type},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"default_value",{get:function(){return this._default_value},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"uniform_name",{get:function(){return this._uniform_name},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"uniform",{get:function(){return this._uniform=this._uniform||this._create_uniform()},enumerable:!0,configurable:!0}),e.prototype._create_uniform=function(){return e.uniform_by_type(this._type)},Object.defineProperty(e.prototype,"param_options",{get:function(){var e=this._callback.bind(this);switch(this._type){case _.ParamType.OPERATOR_PATH:return{callback:e,node_selection:{context:c.NodeContext.COP}};default:return{callback:e}}},enumerable:!0,configurable:!0}),e.prototype._callback=function(e,t){this.uniform.value=t.value},e.uniform_by_type=function(e){switch(e){case _.ParamType.BOOLEAN:case _.ParamType.BUTTON:return{value:0};case _.ParamType.COLOR:return{value:new a.Vector3(0,0,0)};case _.ParamType.FLOAT:case _.ParamType.FOLDER:case _.ParamType.INTEGER:case _.ParamType.OPERATOR_PATH:return{value:0};case _.ParamType.RAMP:return{value:null};case _.ParamType.SEPARATOR:return{value:0};case _.ParamType.STRING:return{value:null};case _.ParamType.VECTOR2:return{value:new s.Vector2(0,0)};case _.ParamType.VECTOR3:return{value:new a.Vector3(0,0,0)};case _.ParamType.VECTOR4:return{value:new i.Vector4(0,0,0,0)}}p.TypeAssert.unreachable(e)},e.prototype.set_uniform_value=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,n,o;return r.__generator(this,(function(r){switch(r.label){case 0:return t=this.uniform,(n=e.params.get(this._name))?[4,n.compute()]:[3,6];case 1:if(r.sent(),!(null!=(o=n.value)&&this.has_value_changed(o)||this.is_video_texture()))return[3,6];switch(this._type){case _.ParamType.OPERATOR_PATH:return[3,2];case _.ParamType.RAMP:return[3,4]}return[3,5];case 2:return[4,this.set_uniform_value_from_texture(n,t)];case 3:return r.sent(),[3,6];case 4:return this.set_uniform_value_from_ramp(n,t),[3,6];case 5:return t.value=n.value,[3,6];case 6:return[2]}}))}))},e.prototype.set_uniform_value_from_texture=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var n,o,i;return r.__generator(this,(function(r){switch(r.label){case 0:return(n=e.found_node())?[4,n.request_container()]:[3,2];case 1:return o=r.sent(),i=o.texture(),t.value=i,[3,3];case 2:t.value=null,r.label=3;case 3:return[2]}}))}))},e.prototype.set_uniform_value_from_ramp=function(e,t){t.value=e.ramp_texture()},e.prototype.has_value_changed=function(e){var t=u.ParamConstructorByType[this._type];if(this._cached_param_value){var n=!t.are_values_equal(e,this._cached_param_value);return n&&(this._cached_param_value=t.clone_value(e)),n}return this._cached_param_value=t.clone_value(e),!1},e.prototype.is_video_texture=function(){var e=!1,t=this.uniform;if(t){var n=t.value;n&&(e=n.constructor==o.VideoTexture)}return e},e}();t.ParamConfig=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(662),o=function(){function e(e,t){this._shader_names=e,this._current_shader_name=t,this._lines_controller_by_shader_name=new Map;for(var n=0,o=this._shader_names;n<o.length;n++){var i=o[n];this._lines_controller_by_shader_name.set(i,new r.LinesController(i))}}return Object.defineProperty(e.prototype,"shader_names",{get:function(){return this._shader_names},enumerable:!0,configurable:!0}),e.prototype.set_current_shader_name=function(e){this._current_shader_name=e},Object.defineProperty(e.prototype,"current_shader_name",{get:function(){return this._current_shader_name},enumerable:!0,configurable:!0}),e.prototype.add_definitions=function(e,t,n){if(0!=t.length){n=n||this._current_shader_name;var r=this._lines_controller_by_shader_name.get(n);r&&r.add_definitions(e,t)}},e.prototype.definitions=function(e,t){var n=this._lines_controller_by_shader_name.get(e);if(n)return n.definitions(t)},e.prototype.add_body_lines=function(e,t,n){if(0!=t.length){n=n||this._current_shader_name;var r=this._lines_controller_by_shader_name.get(n);r&&r.add_body_lines(e,t)}},e.prototype.body_lines=function(e,t){var n=this._lines_controller_by_shader_name.get(e);if(n)return n.body_lines(t)},e}();t.ShadersCollectionController=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(129),o=function(){function e(e){this._shader_name=e,this._definitions_by_node_id=new Map,this._body_lines_by_node_id=new Map}return Object.defineProperty(e.prototype,"shader_name",{get:function(){return this._shader_name},enumerable:!0,configurable:!0}),e.prototype.add_definitions=function(e,t){for(var n=0,o=t;n<o.length;n++){var i=o[n];r.MapUtils.push_on_array_at_entry(this._definitions_by_node_id,e.graph_node_id,i)}},e.prototype.definitions=function(e){return this._definitions_by_node_id.get(e.graph_node_id)},e.prototype.add_body_lines=function(e,t){for(var n=0,o=t;n<o.length;n++){var i=o[n];r.MapUtils.push_on_array_at_entry(this._body_lines_by_node_id,e.graph_node_id,i)}},e.prototype.body_lines=function(e){return this._body_lines_by_node_id.get(e.graph_node_id)},e}();t.LinesController=o},function(e,t,n){"use strict";var r,o;Object.defineProperty(t,"__esModule",{value:!0});var i=n(268),a=((r={})[i.LineType.FUNCTION_DECLARATION]="",r[i.LineType.DEFINE]=";",r[i.LineType.BODY]=";",r),s=((o={})[i.LineType.FUNCTION_DECLARATION]="",o[i.LineType.DEFINE]="",o[i.LineType.BODY]="\t",o),_=function(){function e(){}return e.node_comment=function(e,t){var n="// "+e.full_path();return t==i.LineType.BODY&&(n="\t"+n),n},e.line_wrap=function(e,t){var n=!0;return 0!=e.indexOf("#if")&&0!=e.indexOf("#endif")||(n=!1),n?""+s[t]+e+a[t]:""+s[t]+e},e.post_line_separator=function(e){return e==i.LineType.BODY?"\t":""},e}();t.CodeFormatter=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){};t.TypedAssembler=r},function(e,t,n){"use strict";n.r(t),t.default="#include <common>\n\nuniform vec2 resolution;\n\n// INSERT DEFINE\n\nvoid main() {\n\n\tvec4 diffuseColor = vec4(1.0,0.0,1.0,1.0);\n\n\n\t// INSERT BODY\n\n\tgl_FragColor = vec4( diffuseColor );\n}"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){}return e.sleep=function(e){return new Promise((function(t,n){setTimeout((function(){t()}),e)}))},e}();t.CoreSleep=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(668),i=n(131),a=n(5),s=n(17),_=n(66),u=new(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t}(a.NodeParamsConfig)),c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=u,t}return r.__extends(t,e),t.type=function(){return"env_map"},t.prototype.initialize_node=function(){this.io.inputs.set_count(1),this.io.inputs.init_inputs_clonable_state([s.InputCloneMode.NEVER])},t.prototype.cook=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,n;return r.__generator(this,(function(r){switch(r.label){case 0:return t=e[0],[4,this.convert_texture_to_env_map(t)];case 1:return(n=r.sent())?this.set_texture(n):this.cook_controller.end_cook(),[2]}}))}))},t.prototype.convert_texture_to_env_map=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,n,i;return r.__generator(this,(function(r){switch(r.label){case 0:return[4,_.POLY.renderers_controller.wait_for_renderer()];case 1:return(t=r.sent())?(n=new o.PMREMGenerator(t),i=n.fromEquirectangular(e),[2,i.texture]):(this.states.error.set("no renderer found to convert the texture to an env map"),[2])}}))}))},t}(i.TypedCopNode);t.EnvMapCopNode=c},,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,o=n(2),i=n(269),a=n(286),s=n(0),_=n(101),u=n(131),c=n(66);!function(e){e.EXR="exr",e.BASIS="basis",e.HDR="hdr"}(r||(r={}));var p=function(){function e(e,t){this._node=e,this._param=t}return e.prototype.load_texture_from_url_or_op=function(t){return o.__awaiter(this,void 0,void 0,(function(){var n,r,i,a;return o.__generator(this,(function(o){switch(o.label){case 0:return n=null,"op:"!=t.substring(0,3)?[3,6]:(i=t.substring(3),(r=_.CoreWalker.find_node(this._node,i))?r instanceof u.BaseCopNodeClass?[4,r.request_container()]:[3,2]:[3,4]);case 1:return a=o.sent(),n=a.texture(),[3,3];case 2:this._node.states.error.set("found node is not a texture node"),o.label=3;case 3:return[3,5];case 4:this._node.states.error.set("no node found in path '"+i+"'"),o.label=5;case 5:return[3,8];case 6:return[4,this.load_url(t)];case 7:(n=o.sent())?this._param.options.texture_as_env()||(n=e.set_texture_for_mapping(n)):this._node.states.error.set("could not load texture "+t),o.label=8;case 8:return r&&this._param.graph_predecessors()[0]!=r&&(this._param.graph_disconnect_predecessors(),this._param.add_graph_input(r)),[2,n]}}))}))},e.prototype.load_url=function(t){return o.__awaiter(this,void 0,void 0,(function(){var n=this;return o.__generator(this,(function(r){return[2,new Promise((function(r,i){return o.__awaiter(n,void 0,void 0,(function(){var n;return o.__generator(this,(function(o){switch(o.label){case 0:return n=e._ext(t),e.VIDEO_EXTENSIONS.includes(n)?[4,this._load_as_video(t)]:[3,2];case 1:return[2,o.sent()];case 2:this.loader_for_ext(n).then((function(e){e.load(t,r,void 0,(function(e){console.warn("error",e),i()}))})),o.label=3;case 3:return[2]}}))}))}))]}))}))},e.prototype.loader_for_ext=function(e){return o.__awaiter(this,void 0,void 0,(function(){var t,i,_,u,p;return o.__generator(this,(function(l){switch(l.label){case 0:switch(t=e.toLowerCase(),t){case r.EXR:return[3,1];case r.HDR:return[3,3];case r.BASIS:return[3,5]}return[3,8];case 1:return[4,Promise.resolve().then((function(){return o.__importStar(n(670))}))];case 2:return[2,new(0,l.sent().EXRLoader)];case 3:return[4,Promise.resolve().then((function(){return o.__importStar(n(671))}))];case 4:return i=l.sent().RGBELoader,(u=new i).setDataType(s.UnsignedByteType),[2,u];case 5:return[4,Promise.resolve().then((function(){return o.__importStar(n(672))}))];case 6:return _=l.sent().BasisTextureLoader,(u=new _).setTranscoderPath("/three/js/libs/basis/"),[4,c.POLY.renderers_controller.wait_for_renderer()];case 7:return(p=l.sent())?u.detectSupport(p):console.warn("texture loader found no renderer for basis texture loader"),[2,u];case 8:return[2,new a.TextureLoader]}}))}))},e.prototype._load_as_video=function(t){return new Promise((function(n,r){var o=document.createElement("video");o.setAttribute("crossOrigin","anonymous"),o.setAttribute("autoplay",""+!0),o.setAttribute("loop",""+!0),o.onloadedmetadata=function(){o.pause();var e=new i.VideoTexture(o);n(e)};var a=document.createElement("source"),s=e._ext(t),_=e.VIDEO_SOURCE_TYPE_BY_EXT[s];_=_||e._default_video_source_type(t),a.setAttribute("type",_),a.setAttribute("src",t),o.appendChild(a)}))},e._default_video_source_type=function(e){return"video/"+this._ext(e)},e.pixel_data=function(e){var t=e.image,n=document.createElement("canvas");n.width=t.width,n.height=t.height;var r=n.getContext("2d");if(r)return r.drawImage(t,0,0,t.width,t.height),r.getImageData(0,0,t.width,t.height)},e._ext=function(e){var t=e.split(".");return t[t.length-1].toLowerCase()},e.set_texture_for_mapping=function(e){return e},e.PARAM_DEFAULT="/examples/textures/uv.jpg",e.PARAM_ENV_DEFAULT="/examples/textures/piz_compressed.exr",e.VIDEO_EXTENSIONS=["mp4","webm","ogv"],e.VIDEO_SOURCE_TYPE_BY_EXT={ogg:'video/ogg; codecs="theora, vorbis"',ogv:'video/ogg; codecs="theora, vorbis"',mp4:'video/mp4; codecs="avc1.42E01E, mp4a.40.2"'},e}();t.CoreTextureLoader=p},,function(e,t,n){"use strict";n.r(t),n.d(t,"RGBELoader",(function(){return i}));var r=n(108),o=n(0),i=function(e){r.a.call(this,e),this.type=o.UnsignedByteType};i.prototype=Object.assign(Object.create(r.a.prototype),{constructor:i,parse:function(e){var t=function(e,t){switch(e){case 1:console.error("RGBELoader Read Error: "+(t||""));break;case 2:console.error("RGBELoader Write Error: "+(t||""));break;case 3:console.error("RGBELoader Bad File Format: "+(t||""));break;default:case 4:console.error("RGBELoader: Error: "+(t||""))}return-1},n=function(e,t,n){t=t||1024;for(var r=e.pos,o=-1,i=0,a="",s=String.fromCharCode.apply(null,new Uint16Array(e.subarray(r,r+128)));0>(o=s.indexOf("\n"))&&i<t&&r<e.byteLength;)a+=s,i+=s.length,r+=128,s+=String.fromCharCode.apply(null,new Uint16Array(e.subarray(r,r+128)));return-1<o&&(!1!==n&&(e.pos+=i+o+1),a+s.slice(0,o))},r=function(){var e=new Float32Array(1),t=new Int32Array(e.buffer);function n(n){e[0]=n;var r=t[0],o=r>>16&32768,i=r>>12&2047,a=r>>23&255;return a<103?o:a>142?(o|=31744,o|=(255==a?0:1)&&8388607&r):a<113?o|=((i|=2048)>>114-a)+(i>>113-a&1):(o|=a-112<<10|i>>1,o+=1&i)}return function(e,t,r,o){var i=e[t+3],a=Math.pow(2,i-128)/255;r[o+0]=n(e[t+0]*a),r[o+1]=n(e[t+1]*a),r[o+2]=n(e[t+2]*a)}}(),i=new Uint8Array(e);i.pos=0;var a,s,_,u,c,p,l=function(e){var r,o,i=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,a=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,s=/^\s*FORMAT=(\S+)\s*$/,_=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,u={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};if(e.pos>=e.byteLength||!(r=n(e)))return t(1,"no header found");if(!(o=r.match(/^#\?(\S+)$/)))return t(3,"bad initial token");for(u.valid|=1,u.programtype=o[1],u.string+=r+"\n";!1!==(r=n(e));)if(u.string+=r+"\n","#"!==r.charAt(0)){if((o=r.match(i))&&(u.gamma=parseFloat(o[1],10)),(o=r.match(a))&&(u.exposure=parseFloat(o[1],10)),(o=r.match(s))&&(u.valid|=2,u.format=o[1]),(o=r.match(_))&&(u.valid|=4,u.height=parseInt(o[1],10),u.width=parseInt(o[2],10)),2&u.valid&&4&u.valid)break}else u.comments+=r+"\n";return 2&u.valid?4&u.valid?u:t(3,"missing image size specifier"):t(3,"missing format specifier")}(i);if(-1!==l){var d=l.width,f=l.height,h=function(e,n,r){var o,i,a,s,_,u,c,p,l,d,f,h,m,y=n,v=r;if(y<8||y>32767||2!==e[0]||2!==e[1]||128&e[2])return new Uint8Array(e);if(y!==(e[2]<<8|e[3]))return t(3,"wrong scanline width");if(!(o=new Uint8Array(4*n*r))||!o.length)return t(4,"unable to allocate buffer space");for(i=0,a=0,p=4*y,m=new Uint8Array(4),u=new Uint8Array(p);v>0&&a<e.byteLength;){if(a+4>e.byteLength)return t(1);if(m[0]=e[a++],m[1]=e[a++],m[2]=e[a++],m[3]=e[a++],2!=m[0]||2!=m[1]||(m[2]<<8|m[3])!=y)return t(3,"bad rgbe scanline format");for(c=0;c<p&&a<e.byteLength;){if((h=(s=e[a++])>128)&&(s-=128),0===s||c+s>p)return t(3,"bad scanline data");if(h)for(_=e[a++],l=0;l<s;l++)u[c++]=_;else u.set(e.subarray(a,a+s),c),c+=s,a+=s}for(d=y,l=0;l<d;l++)f=0,o[i]=u[l+f],f+=y,o[i+1]=u[l+f],f+=y,o[i+2]=u[l+f],f+=y,o[i+3]=u[l+f],i+=4;v--}return o}(i.subarray(i.pos),d,f);if(-1!==h){switch(this.type){case o.UnsignedByteType:var m=h,y=o.RGBEFormat,v=o.UnsignedByteType;break;case o.FloatType:for(var g=h.length/4*3,b=new Float32Array(g),x=0;x<g;x++)_=b,u=3*x,c=void 0,p=void 0,c=(a=h)[(s=4*x)+3],p=Math.pow(2,c-128)/255,_[u+0]=a[s+0]*p,_[u+1]=a[s+1]*p,_[u+2]=a[s+2]*p;m=b,y=o.RGBFormat,v=o.FloatType;break;case o.HalfFloatType:g=h.length/4*3;var P=new Uint16Array(g);for(x=0;x<g;x++)r(h,4*x,P,3*x);m=P,y=o.RGBFormat,v=o.HalfFloatType;break;default:console.error("THREE.RGBELoader: unsupported type: ",this.type)}return{width:d,height:f,data:m,header:l.string,gamma:l.gamma,exposure:l.exposure,format:y,type:v}}}return null},setDataType:function(e){return this.type=e,this},load:function(e,t,n,i){return r.a.prototype.load.call(this,e,(function(e,n){switch(e.type){case o.UnsignedByteType:e.encoding=o.RGBEEncoding,e.minFilter=o.NearestFilter,e.magFilter=o.NearestFilter,e.generateMipmaps=!1,e.flipY=!0;break;case o.FloatType:case o.HalfFloatType:e.encoding=o.LinearEncoding,e.minFilter=o.LinearFilter,e.magFilter=o.LinearFilter,e.generateMipmaps=!1,e.flipY=!0}t&&t(e,n)}),n,i)}})},function(e,t,n){"use strict";n.r(t),n.d(t,"BasisTextureLoader",(function(){return s}));var r=n(121),o=n(30),i=n(0),a=n(18),s=function(e){a.a.call(this,e),this.transcoderPath="",this.transcoderBinary=null,this.transcoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.workerConfig={format:null,astcSupported:!1,bptcSupported:!1,etcSupported:!1,dxtSupported:!1,pvrtcSupported:!1}};s.prototype=Object.assign(Object.create(a.a.prototype),{constructor:s,setTranscoderPath:function(e){return this.transcoderPath=e,this},setWorkerLimit:function(e){return this.workerLimit=e,this},detectSupport:function(e){var t=this.workerConfig;if(t.astcSupported=!!e.extensions.get("WEBGL_compressed_texture_astc"),t.bptcSupported=!!e.extensions.get("EXT_texture_compression_bptc"),t.etcSupported=!!e.extensions.get("WEBGL_compressed_texture_etc1"),t.dxtSupported=!!e.extensions.get("WEBGL_compressed_texture_s3tc"),t.pvrtcSupported=!!e.extensions.get("WEBGL_compressed_texture_pvrtc")||!!e.extensions.get("WEBKIT_WEBGL_compressed_texture_pvrtc"),t.astcSupported)t.format=s.BASIS_FORMAT.cTFASTC_4x4;else if(t.bptcSupported)t.format=s.BASIS_FORMAT.cTFBC7_M5;else if(t.dxtSupported)t.format=s.BASIS_FORMAT.cTFBC3;else if(t.pvrtcSupported)t.format=s.BASIS_FORMAT.cTFPVRTC1_4_RGBA;else{if(!t.etcSupported)throw new Error("THREE.BasisTextureLoader: No suitable compressed texture format found.");t.format=s.BASIS_FORMAT.cTFETC1}return this},load:function(e,t,n,r){var i=new o.a(this.manager);i.setResponseType("arraybuffer"),i.load(e,e=>{this._createTexture(e).then(t).catch(r)},n,r)},_createTexture:function(e){var t,n,o=e.byteLength,a=this._allocateWorker(o).then(r=>(t=r,n=this.workerNextTaskID++,new Promise((r,o)=>{t._callbacks[n]={resolve:r,reject:o},t.postMessage({type:"transcode",id:n,buffer:e},[e])}))).then(e=>{var t,n=this.workerConfig,{width:o,height:a,mipmaps:_,format:u}=e;switch(u){case s.BASIS_FORMAT.cTFASTC_4x4:t=new r.a(_,o,a,i.RGBA_ASTC_4x4_Format);break;case s.BASIS_FORMAT.cTFBC7_M5:t=new r.a(_,o,a,i.RGBA_BPTC_Format);break;case s.BASIS_FORMAT.cTFBC1:case s.BASIS_FORMAT.cTFBC3:t=new r.a(_,o,a,s.DXT_FORMAT_MAP[n.format],i.UnsignedByteType);break;case s.BASIS_FORMAT.cTFETC1:t=new r.a(_,o,a,i.RGB_ETC1_Format);break;case s.BASIS_FORMAT.cTFPVRTC1_4_RGB:t=new r.a(_,o,a,i.RGB_PVRTC_4BPPV1_Format);break;case s.BASIS_FORMAT.cTFPVRTC1_4_RGBA:t=new r.a(_,o,a,i.RGBA_PVRTC_4BPPV1_Format);break;default:throw new Error("THREE.BasisTextureLoader: No supported format available.")}return t.minFilter=1===_.length?i.LinearFilter:i.LinearMipmapLinearFilter,t.magFilter=i.LinearFilter,t.generateMipmaps=!1,t.needsUpdate=!0,t});return a.finally(()=>{t&&n&&(t._taskLoad-=o,delete t._callbacks[n])}),a},_initTranscoder:function(){if(!this.transcoderPending){var e=new o.a(this.manager);e.setPath(this.transcoderPath);var t=new Promise((t,n)=>{e.load("basis_transcoder.js",t,void 0,n)}),n=new o.a(this.manager);n.setPath(this.transcoderPath),n.setResponseType("arraybuffer");var r=new Promise((e,t)=>{n.load("basis_transcoder.wasm",e,void 0,t)});this.transcoderPending=Promise.all([t,r]).then(([e,t])=>{var n=s.BasisWorker.toString(),r=["/* basis_transcoder.js */",e,"/* worker */",n.substring(n.indexOf("{")+1,n.lastIndexOf("}"))].join("\n");this.workerSourceURL=URL.createObjectURL(new Blob([r])),this.transcoderBinary=t})}return this.transcoderPending},_allocateWorker:function(e){return this._initTranscoder().then(()=>{var t;this.workerPool.length<this.workerLimit?((t=new Worker(this.workerSourceURL))._callbacks={},t._taskLoad=0,t.postMessage({type:"init",config:this.workerConfig,transcoderBinary:this.transcoderBinary}),t.onmessage=function(e){var n=e.data;switch(n.type){case"transcode":t._callbacks[n.id].resolve(n);break;case"error":t._callbacks[n.id].reject(n);break;default:console.error('THREE.BasisTextureLoader: Unexpected message, "'+n.type+'"')}},this.workerPool.push(t)):this.workerPool.sort((function(e,t){return e._taskLoad>t._taskLoad?-1:1}));return(t=this.workerPool[this.workerPool.length-1])._taskLoad+=e,t})},dispose:function(){for(var e=0;e<this.workerPool.length;e++)this.workerPool[e].terminate();return this.workerPool.length=0,this}}),s.BASIS_FORMAT={cTFETC1:0,cTFETC2:1,cTFBC1:2,cTFBC3:3,cTFBC4:4,cTFBC5:5,cTFBC7_M6_OPAQUE_ONLY:6,cTFBC7_M5:7,cTFPVRTC1_4_RGB:8,cTFPVRTC1_4_RGBA:9,cTFASTC_4x4:10,cTFATC_RGB:11,cTFATC_RGBA_INTERPOLATED_ALPHA:12,cTFRGBA32:13,cTFRGB565:14,cTFBGR565:15,cTFRGBA4444:16},s.DXT_FORMAT={COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_EXT:33778,COMPRESSED_RGBA_S3TC_DXT5_EXT:33779},s.DXT_FORMAT_MAP={},s.DXT_FORMAT_MAP[s.BASIS_FORMAT.cTFBC1]=s.DXT_FORMAT.COMPRESSED_RGB_S3TC_DXT1_EXT,s.DXT_FORMAT_MAP[s.BASIS_FORMAT.cTFBC3]=s.DXT_FORMAT.COMPRESSED_RGBA_S3TC_DXT5_EXT,s.BasisWorker=function(){var e,t,n;onmessage=function(r){var o,i,a=r.data;switch(a.type){case"init":e=a.config,o=a.transcoderBinary,t=new Promise(e=>{i={wasmBinary:o,onRuntimeInitialized:e},BASIS(i)}).then(()=>{var{BasisFile:e,initializeBasis:t}=i;n=e,t()});break;case"transcode":t.then(()=>{try{for(var{width:t,height:r,hasAlpha:o,mipmaps:i,format:s}=function(t){var r=new n(new Uint8Array(t)),o=r.getImageWidth(0,0),i=r.getImageHeight(0,0),a=r.getNumLevels(0),s=r.getHasAlpha();function _(){r.close(),r.delete()}if(!s)switch(e.format){case 9:e.format=8}if(!o||!i||!a)throw _(),new Error("THREE.BasisTextureLoader:  Invalid .basis file");if(!r.startTranscoding())throw _(),new Error("THREE.BasisTextureLoader: .startTranscoding failed");for(var u=[],c=0;c<a;c++){var p=r.getImageWidth(0,c),l=r.getImageHeight(0,c),d=new Uint8Array(r.getImageTranscodedSizeInBytes(0,c,e.format));if(!r.transcodeImage(d,0,c,e.format,0,s))throw _(),new Error("THREE.BasisTextureLoader: .transcodeImage failed.");u.push({data:d,width:p,height:l})}return _(),{width:o,height:i,hasAlpha:s,mipmaps:u,format:e.format}}(a.buffer),_=[],u=0;u<i.length;++u)_.push(i[u].data.buffer);self.postMessage({type:"transcode",id:a.id,width:t,height:r,hasAlpha:o,mipmaps:i,format:s},_)}catch(e){console.error(e),self.postMessage({type:"error",id:a.id,error:e.message})}})}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(131),i=n(5),a=n(17),s=new i.NodeParamsConfig,_=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=s,t}return r.__extends(t,e),t.type=function(){return"null"},t.prototype.initialize_node=function(){this.io.inputs.set_count(1),this.io.inputs.init_inputs_clonable_state([a.InputCloneMode.NEVER])},t.prototype.cook=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t;return r.__generator(this,(function(n){return t=e[0],this.set_texture(t),[2]}))}))},t}(o.TypedCopNode);t.NullCopNode=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(131),i=n(5),a=n(17),s=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.input=i.ParamConfig.INTEGER(0,{range:[0,3],range_locked:[!0,!0]}),t}return r.__extends(t,e),t}(i.NodeParamsConfig)),_=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=s,t}return r.__extends(t,e),t.type=function(){return"switch"},t.prototype.initialize_node=function(){this.io.inputs.set_count(0,4),this.io.inputs.init_inputs_clonable_state([a.InputCloneMode.NEVER,a.InputCloneMode.NEVER,a.InputCloneMode.NEVER,a.InputCloneMode.NEVER]),this.ui_data.set_width(100),this.cook_controller.disallow_inputs_evaluation()},t.prototype.cook=function(){return r.__awaiter(this,void 0,void 0,(function(){var e,t;return r.__generator(this,(function(n){switch(n.label){case 0:return e=this.pv.input,this.io.inputs.has_input(e)?[4,this.container_controller.request_input_container(e)]:[3,2];case 1:return t=n.sent(),this.set_texture(t.texture()),[3,3];case 2:this.states.error.set("no input "+e),n.label=3;case 3:return[2]}}))}))},t}(o.TypedCopNode);t.SwitchCopNode=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(130),o=n(676),i=n(271),a=n(678),s=n(338),_=function(){function e(){}return e.run=function(e){e.register_node(o.CameraMapControlsEventNode,r.CATEGORY_EVENT.CAMERA),e.register_node(i.CameraOrbitControlsEventNode,r.CATEGORY_EVENT.CAMERA),e.register_node(a.CodeEventNode,r.CATEGORY_EVENT.MISC),e.register_node(s.MouseEventNode,r.CATEGORY_EVENT.MISC)},e}();t.EventRegister=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(366),i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.type=function(){return"camera_map_controls"},t.prototype.create_controls_instance=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(n){return[2,new o.MapControls(e,t)]}))}))},t}(n(271).CameraOrbitControlsEventNode);t.CameraMapControlsEventNode=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.apply_controls=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var n,o;return r.__generator(this,(function(r){switch(r.label){case 0:return[4,this.create_controls_instance(e,t)];case 1:return n=r.sent(),o=performance.now(),n.name=this.full_path()+":"+e.name+":"+o+":"+this.controls_id(),[4,this.params.eval_all()];case 2:return r.sent(),this.setup_controls(n),[2,n]}}))}))},t.prototype.controls_id=function(){return JSON.stringify(this.params.all.map((function(e){return e.value_serialized})))},t}(n(257).TypedEventNode);t.TypedCameraControlsEventNode=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(257),i=n(33),a=n(16),s=n(264),_="import {BaseMouseEventProcessor} from 'BaseMouseEventProcessor'\nexport class EventProcessor extends BaseMouseEventProcessor {\n\tconstructor(){\n\t}\n\tprocess_event(event: MouseEvent, canvas: HTMLCanvasElement, camera_node: any){\n\t\tthis._set_mouse_from_event_and_canvas(event, canvas)\n\t\tconsole.log(\"processing event\", this.mouse.x, this.mouse.y);\n\t}\n}\n\n\n\n\n",u=n(261),c=r.__importStar(n(679)),p=n(5),l=n(367),d=n(3),f=n(272),h=function(){function e(){this.raycaster=new f.Raycaster,this.mouse=new d.Vector2}return e.prototype.process_event=function(e,t,n){},e.prototype.set_node=function(e){this.node=e},e.prototype._set_mouse_from_event_and_canvas=function(e,t){this.mouse.x=e.clientX/t.offsetWidth*2-1,this.mouse.y=-e.clientY/t.offsetHeight*2+1},e}(),m=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.code_typescript=p.ParamConfig.STRING(_,{label:!1,language:u.StringParamLanguage.TYPESCRIPT}),t.code_javascript=p.ParamConfig.STRING("",{hidden:!0}),t}return r.__extends(t,e),t}(p.NodeParamsConfig)),y=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=m,t}return r.__extends(t,e),t.type=function(){return"code"},t.prototype.initialize_node=function(){this.io.inputs.set_named_input_connection_points([new i.TypedNamedConnectionPoint("trigger",a.ConnectionPointType.BOOL)])},t.prototype.process_event=function(e,t,n){this._compile_if_required(),this._event_processor&&this._event_processor.process_event(e,t,n)},t.prototype._compile_if_required=function(){this._event_processor&&this._last_compiled_code==this.pv.code_javascript||this._compile()},t.prototype._compile=function(){try{var e="try {\n\t\t\t\t"+l.TranspiledFilter.filter(this.pv.code_javascript)+"\n\t\t\t} catch(e) {\n\t\t\t\tthis.states.error.set(e)\n\t\t\t}",t=new s.AsyncFunction("node","BaseMouseEventProcessor","THREE",e)(this,h,c);this._event_processor=new t,this._event_processor.set_node(this),this._last_compiled_code=this.pv.code_javascript}catch(e){console.warn(e),this.states.error.set("cannot generate function ("+e+")"),this._event_processor=void 0}},t}(o.TypedEventNode);t.CodeEventNode=y},,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(130),o=n(681),i=n(682),a=n(683),s=n(684),_=n(369),u=n(685),c=n(686),p=n(688),l=n(266),d=n(370),f=n(689),h=n(691),m=n(692),y=n(694),v=n(696),g=n(728),b=n(729),x=n(365),P=n(730),T=n(732),w=n(733),C=n(734),O=n(735),E=n(736),A=n(737),N=n(738),M=n(746),j=n(747),S=n(748),R=n(749),L=n(750),k=n(751),z=n(752),G=n(753),I=n(754),D=n(755),F=n(756),B=n(758),V=n(759),U=n(760),q=n(761),Y=n(762),H=n(763),X=n(27),J=function(){function e(){}return e.run=function(e){e.register_node(s.AbsGlNode,r.CATEGORY_GL.MATH),e.register_node(s.AcosGlNode,r.CATEGORY_GL.TRIGO),e.register_node(u.AddGlNode,r.CATEGORY_GL.MATH),e.register_node(p.AlignGlNode,r.CATEGORY_GL.TRIGO),e.register_node(c.AndGlNode,r.CATEGORY_GL.LOGIC),e.register_node(s.AsinGlNode,r.CATEGORY_GL.TRIGO),e.register_node(s.AtanGlNode,r.CATEGORY_GL.TRIGO),e.register_node(l.AttributeGlNode,r.CATEGORY_GL.GLOBALS,{except:[X.NodeContext.COP+"/builder"]}),e.register_node(s.CeilGlNode,r.CATEGORY_GL.MATH),e.register_node(s.CosGlNode,r.CATEGORY_GL.TRIGO),e.register_node(d.ConstantGlNode,r.CATEGORY_GL.GLOBALS),e.register_node(f.ComplementGlNode,r.CATEGORY_GL.MATH),e.register_node(h.CrossGlNode,r.CATEGORY_GL.GEOMETRY),e.register_node(m.CycleGlNode,r.CATEGORY_GL.MATH),e.register_node(s.DegreesGlNode,r.CATEGORY_GL.CONVERSION),e.register_node(y.DiskGlNode,r.CATEGORY_GL.GEOMETRY),e.register_node(_.DistanceGlNode,r.CATEGORY_GL.GEOMETRY),e.register_node(u.DivideGlNode,r.CATEGORY_GL.MATH),e.register_node(_.DotGlNode,r.CATEGORY_GL.GEOMETRY),e.register_node(v.EasingGlNode,r.CATEGORY_GL.MATH),e.register_node(s.ExpGlNode,r.CATEGORY_GL.MATH),e.register_node(s.Exp2GlNode,r.CATEGORY_GL.MATH),e.register_node(g.FitGlNode,r.CATEGORY_GL.MATH),e.register_node(b.Fit01GlNode,r.CATEGORY_GL.MATH),e.register_node(o.FloatToIntGlNode,r.CATEGORY_GL.CONVERSION),e.register_node(i.FloatToVec2GlNode,r.CATEGORY_GL.CONVERSION),e.register_node(i.FloatToVec3GlNode,r.CATEGORY_GL.CONVERSION),e.register_node(i.FloatToVec4GlNode,r.CATEGORY_GL.CONVERSION),e.register_node(s.FloorGlNode,r.CATEGORY_GL.MATH),e.register_node(s.FractGlNode,r.CATEGORY_GL.MATH),e.register_node(x.GlobalsGlNode,r.CATEGORY_GL.GLOBALS),e.register_node(P.HsvToRgbGlNode,r.CATEGORY_GL.COLOR),e.register_node(o.IntToFloatGlNode,r.CATEGORY_GL.CONVERSION),e.register_node(s.InverseSqrtGlNode,r.CATEGORY_GL.MATH),e.register_node(T.InstanceTransformGlNode,r.CATEGORY_GL.GEOMETRY),e.register_node(w.LengthGlNode,r.CATEGORY_GL.GEOMETRY),e.register_node(C.LuminanceGlNode,r.CATEGORY_GL.COLOR),e.register_node(A.NegateGlNode,r.CATEGORY_GL.MATH),e.register_node(s.LogGlNode,r.CATEGORY_GL.MATH),e.register_node(s.Log2GlNode,r.CATEGORY_GL.MATH),e.register_node(_.MaxGlNode,r.CATEGORY_GL.MATH),e.register_node(_.MinGlNode,r.CATEGORY_GL.MATH),e.register_node(_.ModGlNode,r.CATEGORY_GL.MATH),e.register_node(O.MixGlNode,r.CATEGORY_GL.MATH),e.register_node(u.MultGlNode,r.CATEGORY_GL.MATH),e.register_node(E.MultAddGlNode,r.CATEGORY_GL.MATH),e.register_node(M.NullGlNode,r.CATEGORY_GL.UTIL),e.register_node(N.NoiseGlNode,r.CATEGORY_GL.GEOMETRY),e.register_node(s.NormalizeGlNode,r.CATEGORY_GL.MATH),e.register_node(c.OrGlNode,r.CATEGORY_GL.LOGIC),e.register_node(j.OutputGlNode,r.CATEGORY_GL.GLOBALS),e.register_node(S.ParamGlNode,r.CATEGORY_GL.GLOBALS),e.register_node(_.PowGlNode,r.CATEGORY_GL.MATH),e.register_node(L.QuatMultGlNode,r.CATEGORY_GL.QUAT),e.register_node(k.QuatFromAxisAngleGlNode,r.CATEGORY_GL.QUAT),e.register_node(z.QuatToAngleGlNode,r.CATEGORY_GL.QUAT),e.register_node(G.QuatToAxisGlNode,r.CATEGORY_GL.QUAT),e.register_node(I.RampGlNode,r.CATEGORY_GL.GLOBALS),e.register_node(D.RandomGlNode,r.CATEGORY_GL.GLOBALS),e.register_node(s.RadiansGlNode,r.CATEGORY_GL.CONVERSION),e.register_node(_.ReflectGlNode,r.CATEGORY_GL.GEOMETRY),e.register_node(R.RefractGlNode,r.CATEGORY_GL.GEOMETRY),e.register_node(F.RgbToHsvGlNode,r.CATEGORY_GL.COLOR),e.register_node(B.RotateGlNode,r.CATEGORY_GL.GEOMETRY),e.register_node(V.RoundGlNode,r.CATEGORY_GL.MATH),e.register_node(s.SignGlNode,r.CATEGORY_GL.MATH),e.register_node(s.SinGlNode,r.CATEGORY_GL.TRIGO),e.register_node(s.SqrtGlNode,r.CATEGORY_GL.MATH),e.register_node(_.StepGlNode,r.CATEGORY_GL.GEOMETRY),e.register_node(u.SubstractGlNode,r.CATEGORY_GL.MATH),e.register_node(s.TanGlNode,r.CATEGORY_GL.TRIGO),e.register_node(U.TextureGlNode,r.CATEGORY_GL.COLOR),e.register_node(q.TwoWaySwitchGlNode,r.CATEGORY_GL.TRIGO),e.register_node(a.Vec2ToFloatGlNode,r.CATEGORY_GL.CONVERSION),e.register_node(a.Vec3ToFloatGlNode,r.CATEGORY_GL.CONVERSION),e.register_node(a.Vec4ToFloatGlNode,r.CATEGORY_GL.CONVERSION),e.register_node(a.Vec4ToVectorGlNode,r.CATEGORY_GL.CONVERSION),e.register_node(Y.VectorAlignGlNode,r.CATEGORY_GL.GEOMETRY),e.register_node(H.VectorAngleGlNode,r.CATEGORY_GL.GEOMETRY)},e}();t.GlRegister=J},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(34),i=n(28),a=n(33),s=n(16),_=n(5),u=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.float=_.ParamConfig.FLOAT(0),t}return r.__extends(t,e),t}(_.NodeParamsConfig)),c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=u,t}return r.__extends(t,e),t.type=function(){return"float_to_int"},t.prototype.initialize_node=function(){this.io.outputs.set_named_output_connection_points([new a.TypedNamedConnectionPoint("int",s.ConnectionPointType.INT)])},t.prototype.set_lines=function(e){var t=this.variable_for_input("float"),n="int "+this.gl_var_name("int")+" = int("+i.ThreeToGl.float(t)+")";e.add_body_lines(this,[n])},t}(o.TypedGlNode);t.FloatToIntGlNode=c;var p=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.int=_.ParamConfig.INTEGER(0),t}return r.__extends(t,e),t}(_.NodeParamsConfig)),l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=p,t}return r.__extends(t,e),t.type=function(){return"int_to_float"},t.prototype.initialize_node=function(){this.io.outputs.set_named_output_connection_points([new a.TypedNamedConnectionPoint("float",s.ConnectionPointType.FLOAT)])},t.prototype.set_lines=function(e){var t=this.variable_for_input("int"),n="float "+this.gl_var_name("float")+" = float("+i.ThreeToGl.int(t)+")";e.add_body_lines(this,[n])},t}(o.TypedGlNode);t.IntToFloatGlNode=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(34),i=n(28),a=n(33),s=n(16),_=n(5),u=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.x=_.ParamConfig.FLOAT(0),t.y=_.ParamConfig.FLOAT(0),t}return r.__extends(t,e),t}(_.NodeParamsConfig)),c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=u,t}return r.__extends(t,e),t.type=function(){return"float_to_vec2"},t.prototype.initialize_node=function(){this.io.outputs.set_named_output_connection_points([new a.TypedNamedConnectionPoint(t.OUTPUT_NAME,s.ConnectionPointType.VEC2)])},t.prototype.set_lines=function(e){var n=this.variable_for_input("x"),r=this.variable_for_input("y"),o="vec2 "+this.gl_var_name(t.OUTPUT_NAME)+" = "+i.ThreeToGl.float2(n,r);e.add_body_lines(this,[o])},t.OUTPUT_NAME="vec2",t}(o.TypedGlNode);t.FloatToVec2GlNode=c;var p=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.x=_.ParamConfig.FLOAT(0),t.y=_.ParamConfig.FLOAT(0),t.z=_.ParamConfig.FLOAT(0),t}return r.__extends(t,e),t}(_.NodeParamsConfig)),l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=p,t}return r.__extends(t,e),t.type=function(){return"float_to_vec3"},t.prototype.initialize_node=function(){this.io.outputs.set_named_output_connection_points([new a.TypedNamedConnectionPoint(t.OUTPUT_NAME,s.ConnectionPointType.VEC3)])},t.prototype.set_lines=function(e){var n=this.variable_for_input("x"),r=this.variable_for_input("y"),o=this.variable_for_input("z"),a="vec3 "+this.gl_var_name(t.OUTPUT_NAME)+" = "+i.ThreeToGl.float3(n,r,o);e.add_body_lines(this,[a])},t.OUTPUT_NAME="vec3",t}(o.TypedGlNode);t.FloatToVec3GlNode=l;var d=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.x=_.ParamConfig.FLOAT(0),t.y=_.ParamConfig.FLOAT(0),t.z=_.ParamConfig.FLOAT(0),t.w=_.ParamConfig.FLOAT(0),t}return r.__extends(t,e),t}(_.NodeParamsConfig)),f=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=d,t}return r.__extends(t,e),t.type=function(){return"float_to_vec4"},t.prototype.initialize_node=function(){this.io.outputs.set_named_output_connection_points([new a.TypedNamedConnectionPoint(t.OUTPUT_NAME,s.ConnectionPointType.VEC4)])},t.prototype.set_lines=function(e){var n=this.variable_for_input("x"),r=this.variable_for_input("y"),o=this.variable_for_input("z"),a=this.variable_for_input("w"),s="vec4 "+this.gl_var_name(t.OUTPUT_NAME)+" = "+i.ThreeToGl.float4(n,r,o,a);e.add_body_lines(this,[s])},t.OUTPUT_NAME="vec4",t}(o.TypedGlNode);t.FloatToVec4GlNode=f},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(34),i=n(24),a=n(5),s=n(16),_=n(33),u=new(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t}(a.NodeParamsConfig)),c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=u,t}return r.__extends(t,e),t}(o.TypedGlNode);function p(e,t){var n=t.components,o=t.param_type;return function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return r.__extends(i,t),i.type=function(){return e},i.prototype.initialize_node=function(){this.io.outputs.set_named_output_connection_points(n.map((function(e){return new _.TypedNamedConnectionPoint(e,s.ConnectionPointType.FLOAT)})))},i.prototype.create_params=function(){this.add_param(o,"vec",n.map((function(e){return 0})))},i.prototype.set_lines=function(e){var t=this,n=[],r=this.variable_for_input("vec");this.io.outputs.used_output_names().forEach((function(e){var o=t.gl_var_name(e);n.push("float "+o+" = "+r+"."+e)})),e.add_body_lines(this,n)},i}(c)}var l=["x","y","z","w"],d=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t}(p("vec2_to_float",{components:["x","y"],param_type:i.ParamType.VECTOR2}));t.Vec2ToFloatGlNode=d;var f=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t}(p("vec3_to_float",{components:["x","y","z"],param_type:i.ParamType.VECTOR3}));t.Vec3ToFloatGlNode=f;var h=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t}(p("vec4_to_float",{components:l,param_type:i.ParamType.VECTOR4}));t.Vec4ToFloatGlNode=h;var m=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.type=function(){return"vec4_to_vector"},t.prototype.initialize_node=function(){this.io.outputs.set_named_output_connection_points([new _.TypedNamedConnectionPoint(t.OUTPUT_NAME_VEC3,s.ConnectionPointType.VEC3),new _.TypedNamedConnectionPoint(t.OUTPUT_NAME_W,s.ConnectionPointType.FLOAT)])},t.prototype.create_params=function(){this.add_param(i.ParamType.VECTOR4,t.INPUT_NAME_VEC4,l.map((function(e){return 0})))},t.prototype.set_lines=function(e){var n=[],r=t.INPUT_NAME_VEC4,o=t.OUTPUT_NAME_VEC3,i=t.OUTPUT_NAME_W,a=this.variable_for_input(r),s=this.io.outputs.used_output_names();if(s.indexOf(o)>=0){var _=this.gl_var_name(o);n.push("vec3 "+_+" = "+a+".xyz")}if(s.indexOf(i)>=0){_=this.gl_var_name(i);n.push("float "+_+" = "+a+".w")}e.add_body_lines(this,n)},t.INPUT_NAME_VEC4="vec4",t.OUTPUT_NAME_VEC3="vec3",t.OUTPUT_NAME_W="w",t}(c);t.Vec4ToVectorGlNode=m},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(36);function i(e,t){void 0===t&&(t={});var n=t.method||e,i=t.out||"val",a=t.in||"in";return function(t){function o(){return null!==t&&t.apply(this,arguments)||this}return r.__extends(o,t),o.type=function(){return e},o.prototype.initialize_node=function(){t.prototype.initialize_node.call(this),this.gl_connections_controller.set_input_name_function(this._gl_input_name.bind(this)),this.gl_connections_controller.set_output_name_function(this._gl_output_name.bind(this))},o.prototype._gl_input_name=function(e){return a},o.prototype._gl_output_name=function(e){return i},o.prototype.gl_method_name=function(){return n},o}(o.BaseNodeGlMathFunctionArg1GlNode)}var a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t}(i("abs"));t.AbsGlNode=a;var s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t}(i("acos",{out:"radians"}));t.AcosGlNode=s;var _=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t}(i("asin",{out:"radians"}));t.AsinGlNode=_;var u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t}(i("atan",{out:"radians"}));t.AtanGlNode=u;var c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t}(i("ceil"));t.CeilGlNode=c;var p=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t}(i("cos",{in:"radians"}));t.CosGlNode=p;var l=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t}(i("degrees",{in:"radians",out:"degrees"}));t.DegreesGlNode=l;var d=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t}(i("exp"));t.ExpGlNode=d;var f=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t}(i("exp2"));t.Exp2GlNode=f;var h=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t}(i("floor"));t.FloorGlNode=h;var m=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t}(i("fract"));t.FractGlNode=m;var y=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t}(i("inverse_sqrt",{method:"inversesqrt"}));t.InverseSqrtGlNode=y;var v=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t}(i("log"));t.LogGlNode=v;var g=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t}(i("log2"));t.Log2GlNode=g;var b=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t}(i("normalize",{out:"normalized"}));t.NormalizeGlNode=b;var x=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t}(i("radians",{in:"degrees",out:"radians"}));t.RadiansGlNode=x;var P=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t}(i("sign"));t.SignGlNode=P;var T=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t}(i("sin",{in:"radians"}));t.SinGlNode=T;var w=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t}(i("sqrt"));t.SqrtGlNode=w;var C=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t}(i("tan"));t.TanGlNode=C},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(36),i=n(16),a=n(28);function s(e,t){var n=t.in_prefix||e,s=t.out||"val",_=t.operation,u=t.allowed_in_types;return function(t){function o(){return null!==t&&t.apply(this,arguments)||this}return r.__extends(o,t),o.type=function(){return e},o.prototype.initialize_node=function(){t.prototype.initialize_node.call(this),this.gl_connections_controller.set_input_name_function(this._gl_input_name.bind(this)),this.gl_connections_controller.set_output_name_function(this._gl_output_name.bind(this)),this.gl_connections_controller.set_expected_input_types_function(this._expected_input_types.bind(this)),this.gl_connections_controller.set_expected_output_types_function(this._expected_output_types.bind(this))},o.prototype.set_lines=function(e){var t=this,n=this.io.outputs.named_output_connection_points[0].type,r=this.io.inputs.named_input_connection_points.map((function(e,n){var r=e.name,o=t.variable_for_input(r);if(o)return a.ThreeToGl.any(o)})).join(" "+this.gl_operation()+" "),o=n+" "+this.gl_var_name(this.gl_connections_controller.output_name(0))+" = "+this.gl_method_name()+"("+r+")";e.add_body_lines(this,[o])},o.prototype._gl_input_name=function(e){return""+n+e},o.prototype._gl_output_name=function(e){return s},o.prototype.gl_operation=function(){return _},o.prototype._expected_input_types=function(){var e=this.gl_connections_controller.first_input_connection_type();if(e&&u&&!u.includes(e)){var t=this.io.inputs.named_input_connection_points[0];t&&(e=t.type)}for(var n=e||i.ConnectionPointType.FLOAT,r=this.io.connections.input_connections(),o=r?Math.max(r.length+1,2):2,a=[],s=0;s<o;s++)a.push(n);return a},o.prototype._expected_output_types=function(){return[this._expected_input_types()[0]]},o}(o.BaseNodeGlMathFunctionArg2GlNode)}var _=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t}(s("add",{in_prefix:"add",out:"sum",operation:"+"}));t.AddGlNode=_;var u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t}(s("divide",{in_prefix:"div",out:"divide",operation:"/"}));t.DivideGlNode=u;var c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t}(s("substract",{in_prefix:"sub",out:"substract",operation:"-"}));t.SubstractGlNode=c;var p=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.type=function(){return"mult"},t.prototype.gl_input_default_value=function(e){return 1},t.prototype.initialize_node=function(){e.prototype.initialize_node.call(this),this.gl_connections_controller.set_expected_input_types_function(this._expected_input_types.bind(this)),this.gl_connections_controller.set_expected_output_types_function(this._expected_output_types.bind(this))},t.prototype._expected_output_type=function(){var e=this._expected_input_types();return[e[e.length-1]]},t.prototype._expected_input_types=function(){var e=this.io.connections.input_connections();if(e){var t=e[0];if(t){var n=this.io.inputs.named_input_connection_points[t.input_index].type,r=e?e.length+1:2,o=new Array(r);if(n==i.ConnectionPointType.FLOAT){var a=e?e[1]:null;if(a){var s=this.io.inputs.named_input_connection_points[a.input_index].type;return s==i.ConnectionPointType.FLOAT?o.map((function(e){return n})):[n,s]}return[n,n]}return o.map((function(){return n}))}}return[i.ConnectionPointType.FLOAT,i.ConnectionPointType.FLOAT]},t}(s("mult",{in_prefix:"mult",out:"product",operation:"*"}));t.MultGlNode=p},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(687);function i(e,t){return function(n){function o(){return null!==n&&n.apply(this,arguments)||this}return r.__extends(o,n),o.type=function(){return e},o.prototype.initialize_node=function(){n.prototype.initialize_node.call(this),this.gl_connections_controller.set_input_name_function(this._gl_input_name.bind(this)),this.gl_connections_controller.set_output_name_function(this._gl_output_name.bind(this))},o.prototype.boolean_operation=function(){return t.op},o.prototype._gl_output_name=function(t){return e},o.prototype._gl_input_name=function(t){return void 0===t&&(t=0),""+e+t},o}(o.BaseNodeGlMathFunctionArgBoolean2GlNode)}var a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t}(i("and",{op:"&&"}));t.AndGlNode=a;var s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t}(i("or",{op:"||"}));t.OrGlNode=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(36),i=n(28),a=n(16),s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.initialize_node=function(){e.prototype.initialize_node.call(this),this.gl_connections_controller.set_expected_input_types_function(this._expected_input_types.bind(this)),this.gl_connections_controller.set_expected_output_types_function(this._expected_output_types.bind(this))},t.prototype._expected_input_types=function(){return[a.ConnectionPointType.BOOL,a.ConnectionPointType.BOOL]},t.prototype._expected_output_types=function(){return[a.ConnectionPointType.BOOL]},t.prototype.set_lines=function(e){var t=this,n=this.io.inputs.named_input_connection_points.map((function(e,n){var r=e.name;return i.ThreeToGl.any(t.variable_for_input(r))})).join(" "+this.boolean_operation()+" "),r="bool "+this.gl_var_name(this.gl_connections_controller.output_name(0))+" = "+n;e.add_body_lines(this,[r])},t}(o.BaseNodeGlMathFunctionArg2GlNode);t.BaseNodeGlMathFunctionArgBoolean2GlNode=s},function(e,t,n){"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0});var o,i=n(2),a=n(36),s=i.__importDefault(n(95)),_=n(16),u=n(29);!function(e){e.DIR="dir",e.UP="up"}(o||(o={}));var c=[o.DIR,o.UP],p=((r={})[o.DIR]=[0,0,1],r[o.UP]=[0,1,0],r),l=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i.__extends(t,e),t.type=function(){return"align"},t.prototype.initialize_node=function(){e.prototype.initialize_node.call(this),this.gl_connections_controller.set_input_name_function((function(e){return c[e]})),this.gl_connections_controller.set_expected_input_types_function((function(){return[_.ConnectionPointType.VEC3,_.ConnectionPointType.VEC3]})),this.gl_connections_controller.set_expected_output_types_function((function(){return[_.ConnectionPointType.VEC4]}))},t.prototype.gl_input_default_value=function(e){return p[e]},t.prototype.gl_method_name=function(){return"align"},t.prototype.gl_function_definitions=function(){return[new u.FunctionGLDefinition(this,_.ConnectionPointType.VEC4,s.default)]},t}(a.BaseNodeGlMathFunctionArg2GlNode);t.AlignGlNode=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(36),i=r.__importDefault(n(690)),a=n(29),s=n(16),_=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.type=function(){return"complement"},t.prototype.gl_method_name=function(){return"complement"},t.prototype.gl_function_definitions=function(){return[new a.FunctionGLDefinition(this,this.gl_connections_controller.first_input_connection_type()||s.ConnectionPointType.FLOAT,i.default)]},t}(o.BaseNodeGlMathFunctionArg1GlNode);t.ComplementGlNode=_},function(e,t,n){"use strict";n.r(t),t.default="float complement(float x){return 1.0-x;}\nvec2 complement(vec2 x){return vec2(1.0-x.x, 1.0-x.y);}\nvec3 complement(vec3 x){return vec3(1.0-x.x, 1.0-x.y, 1.0-x.z);}\nvec4 complement(vec4 x){return vec4(1.0-x.x, 1.0-x.y, 1.0-x.z, 1.0-x.w);}\n"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(34),i=n(28),a=n(5),s=n(33),_=n(16),u=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.x=a.ParamConfig.VECTOR3([0,0,1]),t.y=a.ParamConfig.VECTOR3([0,1,0]),t}return r.__extends(t,e),t}(a.NodeParamsConfig)),c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=u,t}return r.__extends(t,e),t.type=function(){return"cross"},t.prototype.initialize_node=function(){e.prototype.initialize_node.call(this),this.io.outputs.set_named_output_connection_points([new s.TypedNamedConnectionPoint("cross",_.ConnectionPointType.VEC3)])},t.prototype.set_lines=function(e){var t=i.ThreeToGl.float(this.variable_for_input("x")),n=i.ThreeToGl.float(this.variable_for_input("y")),r="vec3 "+this.gl_var_name("cross")+" = cross("+t+", "+n+")";e.add_body_lines(this,[r])},t}(o.TypedGlNode);t.CrossGlNode=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=r.__importDefault(n(693)),i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t}(n(371).MathFunctionArg3Factory("cycle",{in:["in","min","max"],default:{max:1},functions:[o.default]}));t.CycleGlNode=i},function(e,t,n){"use strict";n.r(t),t.default="float cycle(float val, float val_min, float val_max){\n\tif(val >= val_min && val < val_max){\n\t\treturn val;\n\t} else {\n\t\tfloat range = val_max - val_min;\n\t\tif(val >= val_max){\n\t\t\tfloat delta = (val - val_max);\n\t\t\treturn val_min + mod(delta, range);\n\t\t} else {\n\t\t\tfloat delta = (val_min - val);\n\t\t\treturn val_max - mod(delta, range);\n\t\t}\n\t}\n}"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(34),i=n(28),a=r.__importDefault(n(695)),s=n(5),_=n(16),u=n(29),c=n(33),p=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.position=s.ParamConfig.VECTOR2([0,0]),t.center=s.ParamConfig.VECTOR2([0,0]),t.radius=s.ParamConfig.FLOAT(1),t.feather=s.ParamConfig.FLOAT(.1),t}return r.__extends(t,e),t}(s.NodeParamsConfig)),l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=p,t}return r.__extends(t,e),t.type=function(){return"disk"},t.prototype.initialize_node=function(){e.prototype.initialize_node.call(this),this.io.outputs.set_named_output_connection_points([new c.TypedNamedConnectionPoint("float",_.ConnectionPointType.FLOAT)])},t.prototype.set_lines=function(e){var t=i.ThreeToGl.vector2(this.variable_for_input("position")),n=i.ThreeToGl.vector2(this.variable_for_input("center")),r=i.ThreeToGl.float(this.variable_for_input("radius")),o=i.ThreeToGl.float(this.variable_for_input("feather")),s="float "+this.gl_var_name("float")+" = disk("+t+", "+n+", "+r+", "+o+")";e.add_body_lines(this,[s]),e.add_definitions(this,[new u.FunctionGLDefinition(this,_.ConnectionPointType.FLOAT,a.default)])},t}(o.TypedGlNode);t.DiskGlNode=l},function(e,t,n){"use strict";n.r(t),t.default="float disk(vec2 pos, vec2 center, float radius, float feather){\n\tfloat dist = distance(pos, center);\n\tif(feather <= 0.0){\n\t\tif(dist < radius){return 1.0;}else{return 0.0;}\n\t} else {\n\t\tfloat half_feather = feather * 0.5;\n\t\tif(dist < (radius - half_feather)){\n\t\t\treturn 1.0;\n\t\t} else {\n\t\t\tif(dist > (radius + half_feather)){\n\t\t\t\treturn 0.0;\n\t\t\t} else {\n\t\t\t\tfloat feather_start = (radius - half_feather);\n\t\t\t\tfloat blend = 1.0 - (dist - feather_start) / feather;\n\t\t\t\treturn blend;\n\t\t\t}\n\t\t}\n\t}\n}"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(34),i=n(28),a=r.__importDefault(n(697)),s=r.__importDefault(n(698)),_=r.__importDefault(n(699)),u=r.__importDefault(n(700)),c=r.__importDefault(n(701)),p=r.__importDefault(n(702)),l=r.__importDefault(n(703)),d=r.__importDefault(n(704)),f=r.__importDefault(n(705)),h=r.__importDefault(n(706)),m=r.__importDefault(n(707)),y=r.__importDefault(n(708)),v=r.__importDefault(n(709)),g=r.__importDefault(n(710)),b=r.__importDefault(n(711)),x=r.__importDefault(n(712)),P=r.__importDefault(n(713)),T=r.__importDefault(n(714)),w=r.__importDefault(n(715)),C=r.__importDefault(n(716)),O=r.__importDefault(n(717)),E=r.__importDefault(n(718)),A=r.__importDefault(n(719)),N=r.__importDefault(n(720)),M=r.__importDefault(n(721)),j=r.__importDefault(n(722)),S=r.__importDefault(n(723)),R=r.__importDefault(n(724)),L=r.__importDefault(n(725)),k=r.__importDefault(n(726)),z=r.__importDefault(n(727)),G=n(5),I=n(16),D=n(33),F=n(29),B=["back-in-out","back-in","back-out","bounce-in-out","bounce-in","bounce-out","circular-in-out","circular-in","circular-out","cubic-in-out","cubic-in","cubic-out","elastic-in-out","elastic-in","elastic-out","exponential-in-out","exponential-in","exponential-out","linear","quadratic-in-out","quadratic-in","quadratic-out","sine-in-out","sine-in","sine-out"],V={"circular-in-out":a.default,"exponential-in-out":s.default,"circular-in":_.default,"elastic-out":u.default,"cubic-in":c.default,"exponential-out":p.default,"quintic-out":l.default,"elastic-in-out":d.default,linear:f.default,"circular-out":h.default,"back-in-out":m.default,"back-in":y.default,"sine-in":v.default,"back-out":g.default,"quartic-in-out":b.default,"quadratic-in":x.default,"cubic-in-out":P.default,"elastic-in":T.default,"bounce-out":w.default,"quadratic-in-out":C.default,"exponential-in":O.default,"quintic-in-out":E.default,"sine-in-out":A.default,"cubic-out":N.default,"quadratic-out":M.default,"bounce-in-out":j.default,"quintic-in":S.default,"quartic-in":R.default,"quartic-out":L.default,"bounce-in":k.default,"sine-out":z.default},U={"bounce-in":[w.default],"bounce-in-out":[w.default]},q={"circular-in-out":"circularInOut","exponential-in-out":"exponentialInOut","circular-in":"circularIn","elastic-out":"elasticOut","cubic-in":"cubicIn","exponential-out":"exponentialOut","quintic-out":"quinticOut","elastic-in-out":"elasticInOut",linear:"linear","circular-out":"circularOut","back-in-out":"backInOut","back-in":"backIn","sine-in":"sineIn","back-out":"backOut","quartic-in-out":"quarticInOut","quadratic-in":"quadraticIn","cubic-in-out":"cubicInOut","elastic-in":"elasticIn","bounce-out":"bounceOut","quadratic-in-out":"quadraticInOut","exponential-in":"exponentialIn","quintic-in-out":"quinticInOut","sine-in-out":"sineInOut","cubic-out":"cubicOut","quadratic-out":"quadraticOut","bounce-in-out":"bounceInOut","quintic-in":"quinticIn","quartic-in":"quarticIn","quartic-out":"quarticOut","bounce-in":"bounceIn","sine-out":"sineOut"},Y=B.indexOf("sine-in-out"),H=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.type=G.ParamConfig.INTEGER(Y,{menu:{entries:B.map((function(e,t){return{name:e,value:t}}))}}),t.input=G.ParamConfig.FLOAT(0),t}return r.__extends(t,e),t}(G.NodeParamsConfig)),X=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=H,t}return r.__extends(t,e),t.type=function(){return"easing"},t.prototype.initialize_node=function(){e.prototype.initialize_node.call(this),this.spare_params_controller.set_inputless_param_names(["type"]),this.io.outputs.set_named_output_connection_points([new D.TypedNamedConnectionPoint("out",I.ConnectionPointType.FLOAT)])},t.prototype.set_lines=function(e){var t=this,n=B[this.pv.type],r=q[n],o=V[n],a=[new F.FunctionGLDefinition(this,I.ConnectionPointType.FLOAT,o)],s=(U[n]||[]).map((function(e){return new F.FunctionGLDefinition(t,I.ConnectionPointType.FLOAT,e)}));s&&(a=s.concat(a));var _=i.ThreeToGl.float(this.variable_for_input("input")),u="float "+this.gl_var_name("out")+" = "+r+"("+_+")";e.add_definitions(this,a),e.add_body_lines(this,[u])},t}(o.TypedGlNode);t.EasingGlNode=X},function(e,t,n){"use strict";n.r(t),t.default="float circularInOut(float t) {\n  return t < 0.5\n    ? 0.5 * (1.0 - sqrt(1.0 - 4.0 * t * t))\n    : 0.5 * (sqrt((3.0 - 2.0 * t) * (2.0 * t - 1.0)) + 1.0);\n}\n\n"},function(e,t,n){"use strict";n.r(t),t.default="float exponentialInOut(float t) {\n  return t == 0.0 || t == 1.0\n    ? t\n    : t < 0.5\n      ? +0.5 * pow(2.0, (20.0 * t) - 10.0)\n      : -0.5 * pow(2.0, 10.0 - (t * 20.0)) + 1.0;\n}\n\n"},function(e,t,n){"use strict";n.r(t),t.default="float circularIn(float t) {\n  return 1.0 - sqrt(1.0 - t * t);\n}\n\n"},function(e,t,n){"use strict";n.r(t),t.default="#ifndef HALF_PI\n#define HALF_PI 1.5707963267948966\n#endif\n\nfloat elasticOut(float t) {\n  return sin(-13.0 * (t + 1.0) * HALF_PI) * pow(2.0, -10.0 * t) + 1.0;\n}\n\n"},function(e,t,n){"use strict";n.r(t),t.default="float cubicIn(float t) {\n  return t * t * t;\n}\n\n"},function(e,t,n){"use strict";n.r(t),t.default="float exponentialOut(float t) {\n  return t == 1.0 ? t : 1.0 - pow(2.0, -10.0 * t);\n}\n\n"},function(e,t,n){"use strict";n.r(t),t.default="float quinticOut(float t) {\n  return 1.0 - (pow(t - 1.0, 5.0));\n}\n\n"},function(e,t,n){"use strict";n.r(t),t.default="#ifndef HALF_PI\n#define HALF_PI 1.5707963267948966\n#endif\n\nfloat elasticInOut(float t) {\n  return t < 0.5\n    ? 0.5 * sin(+13.0 * HALF_PI * 2.0 * t) * pow(2.0, 10.0 * (2.0 * t - 1.0))\n    : 0.5 * sin(-13.0 * HALF_PI * ((2.0 * t - 1.0) + 1.0)) * pow(2.0, -10.0 * (2.0 * t - 1.0)) + 1.0;\n}\n\n"},function(e,t,n){"use strict";n.r(t),t.default="float linear(float t) {\n  return t;\n}\n\n"},function(e,t,n){"use strict";n.r(t),t.default="float circularOut(float t) {\n  return sqrt((2.0 - t) * t);\n}\n\n"},function(e,t,n){"use strict";n.r(t),t.default="\nfloat backInOut(float t) {\n  float f = t < 0.5\n    ? 2.0 * t\n    : 1.0 - (2.0 * t - 1.0);\n\n  float g = pow(f, 3.0) - f * sin(f * PI);\n\n  return t < 0.5\n    ? 0.5 * g\n    : 0.5 * (1.0 - g) + 0.5;\n}\n\n"},function(e,t,n){"use strict";n.r(t),t.default="\nfloat backIn(float t) {\n  return pow(t, 3.0) - t * sin(t * PI);\n}\n\n"},function(e,t,n){"use strict";n.r(t),t.default="#ifndef HALF_PI\n#define HALF_PI 1.5707963267948966\n#endif\n\nfloat sineIn(float t) {\n  return sin((t - 1.0) * HALF_PI) + 1.0;\n}\n\n"},function(e,t,n){"use strict";n.r(t),t.default="\nfloat backOut(float t) {\n  float f = 1.0 - t;\n  return 1.0 - (pow(f, 3.0) - f * sin(f * PI));\n}\n\n"},function(e,t,n){"use strict";n.r(t),t.default="float quarticInOut(float t) {\n  return t < 0.5\n    ? +8.0 * pow(t, 4.0)\n    : -8.0 * pow(t - 1.0, 4.0) + 1.0;\n}\n\n"},function(e,t,n){"use strict";n.r(t),t.default="float quadraticIn(float t) {\n  return t * t;\n}\n\n"},function(e,t,n){"use strict";n.r(t),t.default="float cubicInOut(float t) {\n  return t < 0.5\n    ? 4.0 * t * t * t\n    : 0.5 * pow(2.0 * t - 2.0, 3.0) + 1.0;\n}\n\n"},function(e,t,n){"use strict";n.r(t),t.default="#ifndef HALF_PI\n#define HALF_PI 1.5707963267948966\n#endif\n\nfloat elasticIn(float t) {\n  return sin(13.0 * t * HALF_PI) * pow(2.0, 10.0 * (t - 1.0));\n}\n\n"},function(e,t,n){"use strict";n.r(t),t.default="\nfloat bounceOut(float t) {\n  const float a = 4.0 / 11.0;\n  const float b = 8.0 / 11.0;\n  const float c = 9.0 / 10.0;\n\n  const float ca = 4356.0 / 361.0;\n  const float cb = 35442.0 / 1805.0;\n  const float cc = 16061.0 / 1805.0;\n\n  float t2 = t * t;\n\n  return t < a\n    ? 7.5625 * t2\n    : t < b\n      ? 9.075 * t2 - 9.9 * t + 3.4\n      : t < c\n        ? ca * t2 - cb * t + cc\n        : 10.8 * t * t - 20.52 * t + 10.72;\n}\n\n"},function(e,t,n){"use strict";n.r(t),t.default="float quadraticInOut(float t) {\n  float p = 2.0 * t * t;\n  return t < 0.5 ? p : -p + (4.0 * t) - 1.0;\n}\n\n"},function(e,t,n){"use strict";n.r(t),t.default="float exponentialIn(float t) {\n  return t == 0.0 ? t : pow(2.0, 10.0 * (t - 1.0));\n}\n\n"},function(e,t,n){"use strict";n.r(t),t.default="float quinticInOut(float t) {\n  return t < 0.5\n    ? +16.0 * pow(t, 5.0)\n    : -0.5 * pow(2.0 * t - 2.0, 5.0) + 1.0;\n}\n\n"},function(e,t,n){"use strict";n.r(t),t.default="\nfloat sineInOut(float t) {\n  return -0.5 * (cos(PI * t) - 1.0);\n}\n\n"},function(e,t,n){"use strict";n.r(t),t.default="float cubicOut(float t) {\n  float f = t - 1.0;\n  return f * f * f + 1.0;\n}\n\n"},function(e,t,n){"use strict";n.r(t),t.default="float quadraticOut(float t) {\n  return -t * (t - 2.0);\n}\n\n"},function(e,t,n){"use strict";n.r(t),t.default="\nfloat bounceInOut(float t) {\n  return t < 0.5\n    ? 0.5 * (1.0 - bounceOut(1.0 - t * 2.0))\n    : 0.5 * bounceOut(t * 2.0 - 1.0) + 0.5;\n}\n\n\n\n"},function(e,t,n){"use strict";n.r(t),t.default="float quinticIn(float t) {\n  return pow(t, 5.0);\n}\n\n"},function(e,t,n){"use strict";n.r(t),t.default="float quarticIn(float t) {\n  return pow(t, 4.0);\n}\n\n"},function(e,t,n){"use strict";n.r(t),t.default="float quarticOut(float t) {\n  return pow(t - 1.0, 3.0) * (1.0 - t) + 1.0;\n}\n\n"},function(e,t,n){"use strict";n.r(t),t.default="\nfloat bounceIn(float t) {\n  return 1.0 - bounceOut(1.0 - t);\n}\n\n"},function(e,t,n){"use strict";n.r(t),t.default="#ifndef HALF_PI\n#define HALF_PI 1.5707963267948966\n#endif\n\nfloat sineOut(float t) {\n  return sin(t * HALF_PI);\n}\n\n"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(36),i=r.__importDefault(n(372)),a=n(29),s=n(16),_={src_min:0,src_max:1},u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.type=function(){return"fit"},t.prototype._gl_input_name=function(e){return["val","src_min","src_max","dest_min","dest_max"][e]},t.prototype.gl_input_default_value=function(e){return _[e]},t.prototype.gl_method_name=function(){return"fit"},t.prototype.gl_function_definitions=function(){return[new a.FunctionGLDefinition(this,s.ConnectionPointType.FLOAT,i.default)]},t}(o.BaseNodeGlMathFunctionArg5GlNode);t.FitGlNode=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(36),i=r.__importDefault(n(372)),a=n(29),s=n(16),_={src_min:0,src_max:1},u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.type=function(){return"fit01"},t.prototype.gl_input_name=function(e){return["val","src_min","src_max"][e]},t.prototype.gl_input_default_value=function(e){return _[e]},t.prototype.gl_method_name=function(){return"fit01"},t.prototype.gl_function_definitions=function(){return[new a.FunctionGLDefinition(this,s.ConnectionPointType.FLOAT,i.default)]},t}(o.BaseNodeGlMathFunctionArg3GlNode);t.Fit01GlNode=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(34),i=n(28),a=r.__importDefault(n(731)),s=n(16),_=n(33),u=n(29),c=n(5),p=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.hsv=c.ParamConfig.VECTOR3([1,1,1]),t}return r.__extends(t,e),t}(c.NodeParamsConfig)),l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=p,t}return r.__extends(t,e),t.type=function(){return"hsv_to_rgb"},t.prototype.initialize_node=function(){e.prototype.initialize_node.call(this),this.io.outputs.set_named_output_connection_points([new _.TypedNamedConnectionPoint("rgb",s.ConnectionPointType.VEC3)])},t.prototype.set_lines=function(e){var t=[],n=[];t.push(new u.FunctionGLDefinition(this,s.ConnectionPointType.VEC3,a.default));var r=i.ThreeToGl.vector3(this.variable_for_input(this.p.hsv.name)),o=this.gl_var_name("rgb");n.push("vec3 "+o+" = hsv2rgb("+r+")"),e.add_definitions(this,t),e.add_body_lines(this,n)},t}(o.TypedGlNode);t.HsvToRgbGlNode=l},function(e,t,n){"use strict";n.r(t),t.default="// https://github.com/hughsk/glsl-hsv2rgb\n// https://stackoverflow.com/questions/15095909/from-rgb-to-hsv-in-opengl-glsl\nvec3 hsv2rgb(vec3 c) {\n\tvec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\n\tvec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\n\treturn c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\n}"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(34),i=n(28),a=r.__importDefault(n(95)),s=n(5),_=n(16),u=n(33),c=n(29),p="position",l="normal",d="instancePosition",f="instanceOrientation",h="instanceScale",m=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.position=s.ParamConfig.VECTOR3([0,0,0]),t.normal=s.ParamConfig.VECTOR3([0,0,1]),t.instance_position=s.ParamConfig.VECTOR3([0,0,0]),t.instance_orientation=s.ParamConfig.VECTOR4([0,0,0,0]),t.instance_scale=s.ParamConfig.VECTOR3([1,1,1]),t}return r.__extends(t,e),t}(s.NodeParamsConfig)),y=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=m,t}return r.__extends(t,e),t.type=function(){return"instance_transform"},t.prototype.initialize_node=function(){e.prototype.initialize_node.call(this),this.io.outputs.set_named_output_connection_points([new u.TypedNamedConnectionPoint(this.gl_output_name_position(),_.ConnectionPointType.VEC3),new u.TypedNamedConnectionPoint(this.gl_output_name_normal(),_.ConnectionPointType.VEC3)])},t.prototype.set_lines=function(e){var t=[],n=[];n.push(new c.FunctionGLDefinition(this,_.ConnectionPointType.VEC4,a.default));var r=this.io.inputs.named_input(this.p.position.name)?i.ThreeToGl.float(this.variable_for_input(this.p.position.name)):this._default_position(),o=this.io.inputs.named_input(this.p.normal.name)?i.ThreeToGl.float(this.variable_for_input(this.p.normal.name)):this._default_normal(),s=this.io.inputs.named_input(this.p.instance_position.name)?i.ThreeToGl.float(this.variable_for_input(this.p.instance_position.name)):this._default_instance_position(e),u=this.io.inputs.named_input(this.p.instance_orientation.name)?i.ThreeToGl.float(this.variable_for_input(this.p.instance_orientation.name)):this._default_input_instance_orientation(e),p=this.io.inputs.named_input(this.p.instance_scale.name)?i.ThreeToGl.float(this.variable_for_input(this.p.instance_scale.name)):this._default_input_instance_scale(e),l=this.gl_var_name(this.gl_output_name_position()),d=this.gl_var_name(this.gl_output_name_normal());t.push("vec3 "+l+" = vec3("+r+")"),t.push(l+" *= "+p),t.push(l+" = rotate_with_quat( "+l+", "+u+" )"),t.push(l+" += "+s),t.push("vec3 "+d+" = vec3("+o+")"),t.push(d+" = rotate_with_quat( "+d+", "+u+" )"),e.add_body_lines(this,t),e.add_definitions(this,n)},t.prototype.gl_output_name_position=function(){return"position"},t.prototype.gl_output_name_normal=function(){return"normal"},t.prototype._default_position=function(){return p},t.prototype._default_normal=function(){return l},t.prototype._default_instance_position=function(e){var t,n;return null===(n=null===(t=this.material_node)||void 0===t?void 0:t.assembler_controller.assembler.globals_handler)||void 0===n?void 0:n.read_attribute(this,_.ConnectionPointType.VEC3,d,e)},t.prototype._default_input_instance_orientation=function(e){var t,n;return null===(n=null===(t=this.material_node)||void 0===t?void 0:t.assembler_controller.assembler.globals_handler)||void 0===n?void 0:n.read_attribute(this,_.ConnectionPointType.VEC4,f,e)},t.prototype._default_input_instance_scale=function(e){var t,n;return null===(n=null===(t=this.material_node)||void 0===t?void 0:t.assembler_controller.assembler.globals_handler)||void 0===n?void 0:n.read_attribute(this,_.ConnectionPointType.VEC3,h,e)},t}(o.TypedGlNode);t.InstanceTransformGlNode=y},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(36),i=n(16),a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.type=function(){return"length"},t.prototype.initialize_node=function(){e.prototype.initialize_node.call(this),this.gl_connections_controller.set_input_name_function(this._gl_input_name.bind(this)),this.gl_connections_controller.set_expected_output_types_function(this._expected_output_types.bind(this))},t.prototype._gl_input_name=function(e){return["x"][e]},t.prototype.gl_method_name=function(){return"length"},t.prototype._expected_output_types=function(){return[i.ConnectionPointType.FLOAT]},t}(o.BaseNodeGlMathFunctionArg1GlNode);t.LengthGlNode=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(34),i=n(16),a=n(33),s=n(28),_=n(5),u=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.hsv=_.ParamConfig.VECTOR3([1,1,1]),t}return r.__extends(t,e),t}(_.NodeParamsConfig)),c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=u,t}return r.__extends(t,e),t.type=function(){return"luminance"},t.prototype.initialize_node=function(){e.prototype.initialize_node.call(this),this.io.outputs.set_named_output_connection_points([new a.TypedNamedConnectionPoint("lum",i.ConnectionPointType.FLOAT)])},t.prototype.set_lines=function(e){var t=s.ThreeToGl.vector3(this.variable_for_input("color")),n="float "+this.gl_var_name("lum")+" = linearToRelativeLuminance("+t+")";e.add_body_lines(this,[n])},t}(o.TypedGlNode);t.LuminanceGlNode=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(36),i=n(16),a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.type=function(){return"mix"},t.prototype.initialize_node=function(){e.prototype.initialize_node.call(this),this.gl_connections_controller.set_input_name_function((function(e){return["value0","value1","blend"][e]})),this.gl_connections_controller.set_output_name_function(this._gl_output_name.bind(this)),this.gl_connections_controller.set_expected_input_types_function(this._expected_input_types.bind(this)),this.gl_connections_controller.set_expected_output_types_function(this._expected_output_types.bind(this))},t.prototype._gl_output_name=function(){return"mix"},t.prototype._expected_input_types=function(){var e=this.gl_connections_controller.first_input_connection_type()||i.ConnectionPointType.FLOAT;return[e,e,i.ConnectionPointType.FLOAT]},t.prototype._expected_output_types=function(){return[this._expected_input_types()[0]]},t}(o.BaseGlMathFunctionGlNode);t.MixGlNode=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,o=n(2),i=n(36),a=n(28),s={mult:1};!function(e){e.VALUE="value",e.PRE_ADD="pre_add",e.MULT="mult",e.POST_ADD="post_add"}(r||(r={}));var _=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o.__extends(t,e),t.type=function(){return"mult_add"},t.prototype._gl_input_name=function(e){return[r.VALUE,r.PRE_ADD,r.MULT,r.POST_ADD][e]},t.prototype.gl_input_default_value=function(e){return s[e]},t.prototype.set_lines=function(e){var t=a.ThreeToGl.any(this.variable_for_input(r.VALUE)),n=a.ThreeToGl.any(this.variable_for_input(r.PRE_ADD)),o=a.ThreeToGl.any(this.variable_for_input(r.MULT)),i=a.ThreeToGl.any(this.variable_for_input(r.POST_ADD)),s=this._expected_output_types()[0],_=this.io.outputs.named_output_connection_points[0].name,u=s+" "+this.gl_var_name(_)+" = ("+o+"*("+t+" + "+n+")) + "+i;e.add_body_lines(this,[u])},t}(i.BaseNodeGlMathFunctionArg4GlNode);t.MultAddGlNode=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(36),i=n(28),a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.type=function(){return"negate"},t.prototype.initialize_node=function(){e.prototype.initialize_node.call(this),this.gl_connections_controller.set_input_name_function((function(e){return["in"][e]}))},t.prototype._gl_input_name=function(e){return["in"][e]},t.prototype.set_lines=function(e){var t=i.ThreeToGl.any(this.variable_for_input(this._gl_input_name(0))),n=this.io.inputs.named_input_connection_points[0].type+" "+this.gl_var_name(this.gl_connections_controller.output_name(0))+" = -1.0 * "+t;e.add_body_lines(this,[n])},t}(o.BaseNodeGlMathFunctionArg1GlNode);t.NegateGlNode=a},function(e,t,n){"use strict";var r,o,i,a,s,_;Object.defineProperty(t,"__esModule",{value:!0});var u,c=n(2),p=c.__importDefault(n(81)),l=n(34),d=n(33),f=n(134),h=c.__importDefault(n(739)),m=c.__importDefault(n(740)),y=c.__importDefault(n(741)),v=c.__importDefault(n(742)),g=c.__importDefault(n(743)),b=c.__importDefault(n(744)),x=c.__importDefault(n(745)),P=n(16);!function(e){e.CLASSIC_PERLIN_2D="Classic Perlin 2D",e.CLASSIC_PERLIN_3D="Classic Perlin 3D",e.CLASSIC_PERLIN_4D="Classic Perlin 4D",e.NOISE_2D="noise2D",e.NOISE_3D="noise3D",e.NOISE_4D="noise4D"}(u||(u={}));var T,w=[u.CLASSIC_PERLIN_2D,u.CLASSIC_PERLIN_3D,u.CLASSIC_PERLIN_4D,u.NOISE_2D,u.NOISE_3D,u.NOISE_4D],C=((r={})[u.CLASSIC_PERLIN_2D]=m.default,r[u.CLASSIC_PERLIN_3D]=y.default,r[u.CLASSIC_PERLIN_4D]=v.default,r[u.NOISE_2D]=g.default,r[u.NOISE_3D]=b.default,r[u.NOISE_4D]=x.default,r),O=((o={})[u.CLASSIC_PERLIN_2D]=P.ConnectionPointType.VEC2,o[u.CLASSIC_PERLIN_3D]=P.ConnectionPointType.VEC3,o[u.CLASSIC_PERLIN_4D]=P.ConnectionPointType.VEC4,o[u.NOISE_2D]=P.ConnectionPointType.VEC2,o[u.NOISE_3D]=P.ConnectionPointType.VEC3,o[u.NOISE_4D]=P.ConnectionPointType.VEC4,o),E=((i={})[u.CLASSIC_PERLIN_2D]=P.ConnectionPointType.FLOAT,i[u.CLASSIC_PERLIN_3D]=P.ConnectionPointType.FLOAT,i[u.CLASSIC_PERLIN_4D]=P.ConnectionPointType.FLOAT,i[u.NOISE_2D]=P.ConnectionPointType.FLOAT,i[u.NOISE_3D]=P.ConnectionPointType.FLOAT,i[u.NOISE_4D]=P.ConnectionPointType.FLOAT,i),A=((a={})[u.CLASSIC_PERLIN_2D]="cnoise",a[u.CLASSIC_PERLIN_3D]="cnoise",a[u.CLASSIC_PERLIN_4D]="cnoise",a[u.NOISE_2D]="snoise",a[u.NOISE_3D]="snoise",a[u.NOISE_4D]="snoise",a);!function(e){e[e.NoChange=0]="NoChange",e[e.Float=1]="Float",e[e.Vec2=2]="Vec2",e[e.Vec3=3]="Vec3",e[e.Vec4=4]="Vec4"}(T||(T={}));var N,M=[T.NoChange,T.Float,T.Vec2,T.Vec3,T.Vec4],j=((s={})[T.NoChange]="Same as noise",s[T.Float]="Float",s[T.Vec2]="Vec2",s[T.Vec3]="Vec3",s[T.Vec4]="Vec4",s),S=((_={})[T.NoChange]=P.ConnectionPointType.FLOAT,_[T.Float]=P.ConnectionPointType.FLOAT,_[T.Vec2]=P.ConnectionPointType.VEC2,_[T.Vec3]=P.ConnectionPointType.VEC3,_[T.Vec4]=P.ConnectionPointType.VEC4,_),R=["x","y","z","w"],L=w.indexOf(u.NOISE_3D),k=T.NoChange,z={amp:1,freq:1};!function(e){e.AMP="amp",e.POSITION="position",e.FREQ="freq",e.OFFSET="offset"}(N||(N={}));var G=n(5),I=n(28),D=n(29),F=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.type=G.ParamConfig.INTEGER(L,{menu:{entries:w.map((function(e,t){return{name:e+" (output: "+E[e]+")",value:t}}))}}),t.output_type=G.ParamConfig.INTEGER(k,{menu:{entries:M.map((function(e){var t=M[e];return{name:j[t],value:t}}))}}),t.octaves=G.ParamConfig.INTEGER(3,{range:[1,10],range_locked:[!0,!1]}),t.amp_attenuation=G.ParamConfig.FLOAT(.5,{range:[0,1]}),t.freq_increase=G.ParamConfig.FLOAT(2,{range:[0,10]}),t.separator=G.ParamConfig.SEPARATOR(),t}return c.__extends(t,e),t}(G.NodeParamsConfig)),B=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=F,t.gl_connections_controller=new f.GlConnectionsController(t),t}return c.__extends(t,e),t.type=function(){return"noise"},t.prototype.initialize_node=function(){e.prototype.initialize_node.call(this),this.gl_connections_controller.initialize_node(),this.spare_params_controller.set_inputless_param_names(["octaves","amp_attenuation","freq_increase"]),this.io.outputs.set_named_output_connection_points([new d.TypedNamedConnectionPoint("noise",P.ConnectionPointType.FLOAT)]),this.gl_connections_controller.set_expected_input_types_function(this._expected_input_types.bind(this)),this.gl_connections_controller.set_expected_output_types_function(this._expected_output_types.bind(this))},t.prototype._gl_input_name=function(e){return[N.AMP,N.POSITION,N.FREQ,N.OFFSET][e]},t.prototype.gl_input_default_value=function(e){return z[e]},t.prototype._expected_input_types=function(){var e=w[this.pv.type],t=O[e];return[t,t,t,t]},t.prototype._expected_output_types=function(){var e=w[this.pv.type],t=M[this.pv.output_type];return t==T.NoChange?[E[e]]:[S[t]]},t.prototype.set_lines=function(e){var t=[],n=[],r=w[this.pv.type],o=C[r],i=E[r];t.push(new D.FunctionGLDefinition(this,i,h.default)),t.push(new D.FunctionGLDefinition(this,i,o)),t.push(new D.FunctionGLDefinition(this,i,this.fbm_function()));var a=this._expected_output_types()[0];if(a==i){var s=this.single_noise_line();n.push(s)}else{for(var _=P.ConnectionPointComponentsCountMap[a],u=[],c=this.gl_var_name("noise"),l=function(e){var t=R[e];u.push(""+c+t);var o=O[r],i=P.ConnectionPointComponentsCountMap[o],a=o+"("+p.default(i).map((function(t){return I.ThreeToGl.float(1e3*e)})).join(", ")+")",s=d.single_noise_line(t,t,a);n.push(s)},d=this,f=0;f<_;f++)l(f);var m=u.join(", "),y="vec"+_+" "+c+" = vec"+_+"("+m+")";n.push(y)}e.add_definitions(this,t),e.add_body_lines(this,n)},t.prototype.fbm_method_name=function(){var e=w[this.pv.type];return"fbm_"+A[e]+"_"+this.name},t.prototype.fbm_function=function(){var e=w[this.pv.type],t=A[e],n=O[e];return"\nfloat "+this.fbm_method_name()+" (in "+n+" st) {\n\tfloat value = 0.0;\n\tfloat amplitude = 1.0;\n\tfor (int i = 0; i < "+I.ThreeToGl.int(this.pv.octaves)+"; i++) {\n\t\tvalue += amplitude * "+t+"(st);\n\t\tst *= "+I.ThreeToGl.float(this.pv.freq_increase)+";\n\t\tamplitude *= "+I.ThreeToGl.float(this.pv.amp_attenuation)+";\n\t}\n\treturn value;\n}\n"},t.prototype.single_noise_line=function(e,t,n){var r=w[this.pv.type],o=this.fbm_method_name(),i=I.ThreeToGl.any(this.variable_for_input(N.AMP)),a=I.ThreeToGl.any(this.variable_for_input(N.POSITION)),s=I.ThreeToGl.any(this.variable_for_input(N.FREQ)),_=I.ThreeToGl.any(this.variable_for_input(N.OFFSET));n&&(_="("+_+"+"+n+")");var u=["("+a+"*"+s+")+"+_].join(", "),c=this.gl_var_name("noise"),p=i+"*"+o+"("+u+")";return t?"float "+c+e+" = ("+p+")."+t:E[r]+" "+c+" = "+p},t}(l.TypedGlNode);t.NoiseGlNode=B},function(e,t,n){"use strict";n.r(t),t.default="// Modulo 289 without a division (only multiplications)\nfloat mod289(float x) {\n  return x - floor(x * (1.0 / 289.0)) * 289.0;\n}\nvec2 mod289(vec2 x) {\n  return x - floor(x * (1.0 / 289.0)) * 289.0;\n}\nvec3 mod289(vec3 x) {\n  return x - floor(x * (1.0 / 289.0)) * 289.0;\n}\nvec4 mod289(vec4 x) {\n  return x - floor(x * (1.0 / 289.0)) * 289.0;\n}\n// Modulo 7 without a division\nvec3 mod7(vec3 x) {\n  return x - floor(x * (1.0 / 7.0)) * 7.0;\n}\n\n// Permutation polynomial: (34x^2 + x) mod 289\nfloat permute(float x) {\n     return mod289(((x*34.0)+1.0)*x);\n}\nvec3 permute(vec3 x) {\n  return mod289((34.0 * x + 1.0) * x);\n}\nvec4 permute(vec4 x) {\n     return mod289(((x*34.0)+1.0)*x);\n}\n\nfloat taylorInvSqrt(float r)\n{\n  return 1.79284291400159 - 0.85373472095314 * r;\n}\nvec4 taylorInvSqrt(vec4 r)\n{\n  return 1.79284291400159 - 0.85373472095314 * r;\n}\n\nvec2 fade(vec2 t) {\n  return t*t*t*(t*(t*6.0-15.0)+10.0);\n}\nvec3 fade(vec3 t) {\n  return t*t*t*(t*(t*6.0-15.0)+10.0);\n}\nvec4 fade(vec4 t) {\n  return t*t*t*(t*(t*6.0-15.0)+10.0);\n}"},function(e,t,n){"use strict";n.r(t),t.default='//\n// GLSL textureless classic 2D noise "cnoise",\n// with an RSL-style periodic variant "pnoise".\n// Author:  Stefan Gustavson (stefan.gustavson@liu.se)\n// Version: 2011-08-22\n//\n// Many thanks to Ian McEwan of Ashima Arts for the\n// ideas for permutation and gradient selection.\n//\n// Copyright (c) 2011 Stefan Gustavson. All rights reserved.\n// Distributed under the MIT license. See LICENSE file.\n// https://github.com/stegu/webgl-noise\n//\n\n\n// Classic Perlin noise\nfloat cnoise(vec2 P)\n{\n  vec4 Pi = floor(P.xyxy) + vec4(0.0, 0.0, 1.0, 1.0);\n  vec4 Pf = fract(P.xyxy) - vec4(0.0, 0.0, 1.0, 1.0);\n  Pi = mod289(Pi); // To avoid truncation effects in permutation\n  vec4 ix = Pi.xzxz;\n  vec4 iy = Pi.yyww;\n  vec4 fx = Pf.xzxz;\n  vec4 fy = Pf.yyww;\n\n  vec4 i = permute(permute(ix) + iy);\n\n  vec4 gx = fract(i * (1.0 / 41.0)) * 2.0 - 1.0 ;\n  vec4 gy = abs(gx) - 0.5 ;\n  vec4 tx = floor(gx + 0.5);\n  gx = gx - tx;\n\n  vec2 g00 = vec2(gx.x,gy.x);\n  vec2 g10 = vec2(gx.y,gy.y);\n  vec2 g01 = vec2(gx.z,gy.z);\n  vec2 g11 = vec2(gx.w,gy.w);\n\n  vec4 norm = taylorInvSqrt(vec4(dot(g00, g00), dot(g01, g01), dot(g10, g10), dot(g11, g11)));\n  g00 *= norm.x;  \n  g01 *= norm.y;  \n  g10 *= norm.z;  \n  g11 *= norm.w;  \n\n  float n00 = dot(g00, vec2(fx.x, fy.x));\n  float n10 = dot(g10, vec2(fx.y, fy.y));\n  float n01 = dot(g01, vec2(fx.z, fy.z));\n  float n11 = dot(g11, vec2(fx.w, fy.w));\n\n  vec2 fade_xy = fade(Pf.xy);\n  vec2 n_x = mix(vec2(n00, n01), vec2(n10, n11), fade_xy.x);\n  float n_xy = mix(n_x.x, n_x.y, fade_xy.y);\n  return 2.3 * n_xy;\n}\n\n// Classic Perlin noise, periodic variant\nfloat pnoise(vec2 P, vec2 rep)\n{\n  vec4 Pi = floor(P.xyxy) + vec4(0.0, 0.0, 1.0, 1.0);\n  vec4 Pf = fract(P.xyxy) - vec4(0.0, 0.0, 1.0, 1.0);\n  Pi = mod(Pi, rep.xyxy); // To create noise with explicit period\n  Pi = mod289(Pi);        // To avoid truncation effects in permutation\n  vec4 ix = Pi.xzxz;\n  vec4 iy = Pi.yyww;\n  vec4 fx = Pf.xzxz;\n  vec4 fy = Pf.yyww;\n\n  vec4 i = permute(permute(ix) + iy);\n\n  vec4 gx = fract(i * (1.0 / 41.0)) * 2.0 - 1.0 ;\n  vec4 gy = abs(gx) - 0.5 ;\n  vec4 tx = floor(gx + 0.5);\n  gx = gx - tx;\n\n  vec2 g00 = vec2(gx.x,gy.x);\n  vec2 g10 = vec2(gx.y,gy.y);\n  vec2 g01 = vec2(gx.z,gy.z);\n  vec2 g11 = vec2(gx.w,gy.w);\n\n  vec4 norm = taylorInvSqrt(vec4(dot(g00, g00), dot(g01, g01), dot(g10, g10), dot(g11, g11)));\n  g00 *= norm.x;  \n  g01 *= norm.y;  \n  g10 *= norm.z;  \n  g11 *= norm.w;  \n\n  float n00 = dot(g00, vec2(fx.x, fy.x));\n  float n10 = dot(g10, vec2(fx.y, fy.y));\n  float n01 = dot(g01, vec2(fx.z, fy.z));\n  float n11 = dot(g11, vec2(fx.w, fy.w));\n\n  vec2 fade_xy = fade(Pf.xy);\n  vec2 n_x = mix(vec2(n00, n01), vec2(n10, n11), fade_xy.x);\n  float n_xy = mix(n_x.x, n_x.y, fade_xy.y);\n  return 2.3 * n_xy;\n}\n'},function(e,t,n){"use strict";n.r(t),t.default='//\n// GLSL textureless classic 3D noise "cnoise",\n// with an RSL-style periodic variant "pnoise".\n// Author:  Stefan Gustavson (stefan.gustavson@liu.se)\n// Version: 2011-10-11\n//\n// Many thanks to Ian McEwan of Ashima Arts for the\n// ideas for permutation and gradient selection.\n//\n// Copyright (c) 2011 Stefan Gustavson. All rights reserved.\n// Distributed under the MIT license. See LICENSE file.\n// https://github.com/stegu/webgl-noise\n//\n\n// Classic Perlin noise\nfloat cnoise(vec3 P)\n{\n  vec3 Pi0 = floor(P); // Integer part for indexing\n  vec3 Pi1 = Pi0 + vec3(1.0); // Integer part + 1\n  Pi0 = mod289(Pi0);\n  Pi1 = mod289(Pi1);\n  vec3 Pf0 = fract(P); // Fractional part for interpolation\n  vec3 Pf1 = Pf0 - vec3(1.0); // Fractional part - 1.0\n  vec4 ix = vec4(Pi0.x, Pi1.x, Pi0.x, Pi1.x);\n  vec4 iy = vec4(Pi0.yy, Pi1.yy);\n  vec4 iz0 = Pi0.zzzz;\n  vec4 iz1 = Pi1.zzzz;\n\n  vec4 ixy = permute(permute(ix) + iy);\n  vec4 ixy0 = permute(ixy + iz0);\n  vec4 ixy1 = permute(ixy + iz1);\n\n  vec4 gx0 = ixy0 * (1.0 / 7.0);\n  vec4 gy0 = fract(floor(gx0) * (1.0 / 7.0)) - 0.5;\n  gx0 = fract(gx0);\n  vec4 gz0 = vec4(0.5) - abs(gx0) - abs(gy0);\n  vec4 sz0 = step(gz0, vec4(0.0));\n  gx0 -= sz0 * (step(0.0, gx0) - 0.5);\n  gy0 -= sz0 * (step(0.0, gy0) - 0.5);\n\n  vec4 gx1 = ixy1 * (1.0 / 7.0);\n  vec4 gy1 = fract(floor(gx1) * (1.0 / 7.0)) - 0.5;\n  gx1 = fract(gx1);\n  vec4 gz1 = vec4(0.5) - abs(gx1) - abs(gy1);\n  vec4 sz1 = step(gz1, vec4(0.0));\n  gx1 -= sz1 * (step(0.0, gx1) - 0.5);\n  gy1 -= sz1 * (step(0.0, gy1) - 0.5);\n\n  vec3 g000 = vec3(gx0.x,gy0.x,gz0.x);\n  vec3 g100 = vec3(gx0.y,gy0.y,gz0.y);\n  vec3 g010 = vec3(gx0.z,gy0.z,gz0.z);\n  vec3 g110 = vec3(gx0.w,gy0.w,gz0.w);\n  vec3 g001 = vec3(gx1.x,gy1.x,gz1.x);\n  vec3 g101 = vec3(gx1.y,gy1.y,gz1.y);\n  vec3 g011 = vec3(gx1.z,gy1.z,gz1.z);\n  vec3 g111 = vec3(gx1.w,gy1.w,gz1.w);\n\n  vec4 norm0 = taylorInvSqrt(vec4(dot(g000, g000), dot(g010, g010), dot(g100, g100), dot(g110, g110)));\n  g000 *= norm0.x;\n  g010 *= norm0.y;\n  g100 *= norm0.z;\n  g110 *= norm0.w;\n  vec4 norm1 = taylorInvSqrt(vec4(dot(g001, g001), dot(g011, g011), dot(g101, g101), dot(g111, g111)));\n  g001 *= norm1.x;\n  g011 *= norm1.y;\n  g101 *= norm1.z;\n  g111 *= norm1.w;\n\n  float n000 = dot(g000, Pf0);\n  float n100 = dot(g100, vec3(Pf1.x, Pf0.yz));\n  float n010 = dot(g010, vec3(Pf0.x, Pf1.y, Pf0.z));\n  float n110 = dot(g110, vec3(Pf1.xy, Pf0.z));\n  float n001 = dot(g001, vec3(Pf0.xy, Pf1.z));\n  float n101 = dot(g101, vec3(Pf1.x, Pf0.y, Pf1.z));\n  float n011 = dot(g011, vec3(Pf0.x, Pf1.yz));\n  float n111 = dot(g111, Pf1);\n\n  vec3 fade_xyz = fade(Pf0);\n  vec4 n_z = mix(vec4(n000, n100, n010, n110), vec4(n001, n101, n011, n111), fade_xyz.z);\n  vec2 n_yz = mix(n_z.xy, n_z.zw, fade_xyz.y);\n  float n_xyz = mix(n_yz.x, n_yz.y, fade_xyz.x); \n  return 2.2 * n_xyz;\n}\n\n// Classic Perlin noise, periodic variant\nfloat pnoise(vec3 P, vec3 rep)\n{\n  vec3 Pi0 = mod(floor(P), rep); // Integer part, modulo period\n  vec3 Pi1 = mod(Pi0 + vec3(1.0), rep); // Integer part + 1, mod period\n  Pi0 = mod289(Pi0);\n  Pi1 = mod289(Pi1);\n  vec3 Pf0 = fract(P); // Fractional part for interpolation\n  vec3 Pf1 = Pf0 - vec3(1.0); // Fractional part - 1.0\n  vec4 ix = vec4(Pi0.x, Pi1.x, Pi0.x, Pi1.x);\n  vec4 iy = vec4(Pi0.yy, Pi1.yy);\n  vec4 iz0 = Pi0.zzzz;\n  vec4 iz1 = Pi1.zzzz;\n\n  vec4 ixy = permute(permute(ix) + iy);\n  vec4 ixy0 = permute(ixy + iz0);\n  vec4 ixy1 = permute(ixy + iz1);\n\n  vec4 gx0 = ixy0 * (1.0 / 7.0);\n  vec4 gy0 = fract(floor(gx0) * (1.0 / 7.0)) - 0.5;\n  gx0 = fract(gx0);\n  vec4 gz0 = vec4(0.5) - abs(gx0) - abs(gy0);\n  vec4 sz0 = step(gz0, vec4(0.0));\n  gx0 -= sz0 * (step(0.0, gx0) - 0.5);\n  gy0 -= sz0 * (step(0.0, gy0) - 0.5);\n\n  vec4 gx1 = ixy1 * (1.0 / 7.0);\n  vec4 gy1 = fract(floor(gx1) * (1.0 / 7.0)) - 0.5;\n  gx1 = fract(gx1);\n  vec4 gz1 = vec4(0.5) - abs(gx1) - abs(gy1);\n  vec4 sz1 = step(gz1, vec4(0.0));\n  gx1 -= sz1 * (step(0.0, gx1) - 0.5);\n  gy1 -= sz1 * (step(0.0, gy1) - 0.5);\n\n  vec3 g000 = vec3(gx0.x,gy0.x,gz0.x);\n  vec3 g100 = vec3(gx0.y,gy0.y,gz0.y);\n  vec3 g010 = vec3(gx0.z,gy0.z,gz0.z);\n  vec3 g110 = vec3(gx0.w,gy0.w,gz0.w);\n  vec3 g001 = vec3(gx1.x,gy1.x,gz1.x);\n  vec3 g101 = vec3(gx1.y,gy1.y,gz1.y);\n  vec3 g011 = vec3(gx1.z,gy1.z,gz1.z);\n  vec3 g111 = vec3(gx1.w,gy1.w,gz1.w);\n\n  vec4 norm0 = taylorInvSqrt(vec4(dot(g000, g000), dot(g010, g010), dot(g100, g100), dot(g110, g110)));\n  g000 *= norm0.x;\n  g010 *= norm0.y;\n  g100 *= norm0.z;\n  g110 *= norm0.w;\n  vec4 norm1 = taylorInvSqrt(vec4(dot(g001, g001), dot(g011, g011), dot(g101, g101), dot(g111, g111)));\n  g001 *= norm1.x;\n  g011 *= norm1.y;\n  g101 *= norm1.z;\n  g111 *= norm1.w;\n\n  float n000 = dot(g000, Pf0);\n  float n100 = dot(g100, vec3(Pf1.x, Pf0.yz));\n  float n010 = dot(g010, vec3(Pf0.x, Pf1.y, Pf0.z));\n  float n110 = dot(g110, vec3(Pf1.xy, Pf0.z));\n  float n001 = dot(g001, vec3(Pf0.xy, Pf1.z));\n  float n101 = dot(g101, vec3(Pf1.x, Pf0.y, Pf1.z));\n  float n011 = dot(g011, vec3(Pf0.x, Pf1.yz));\n  float n111 = dot(g111, Pf1);\n\n  vec3 fade_xyz = fade(Pf0);\n  vec4 n_z = mix(vec4(n000, n100, n010, n110), vec4(n001, n101, n011, n111), fade_xyz.z);\n  vec2 n_yz = mix(n_z.xy, n_z.zw, fade_xyz.y);\n  float n_xyz = mix(n_yz.x, n_yz.y, fade_xyz.x); \n  return 2.2 * n_xyz;\n}\n'},function(e,t,n){"use strict";n.r(t),t.default='//\n// GLSL textureless classic 4D noise "cnoise",\n// with an RSL-style periodic variant "pnoise".\n// Author:  Stefan Gustavson (stefan.gustavson@liu.se)\n// Version: 2011-08-22\n//\n// Many thanks to Ian McEwan of Ashima Arts for the\n// ideas for permutation and gradient selection.\n//\n// Copyright (c) 2011 Stefan Gustavson. All rights reserved.\n// Distributed under the MIT license. See LICENSE file.\n// https://github.com/stegu/webgl-noise\n//\n\n\n\n// Classic Perlin noise\nfloat cnoise(vec4 P)\n{\n  vec4 Pi0 = floor(P); // Integer part for indexing\n  vec4 Pi1 = Pi0 + 1.0; // Integer part + 1\n  Pi0 = mod289(Pi0);\n  Pi1 = mod289(Pi1);\n  vec4 Pf0 = fract(P); // Fractional part for interpolation\n  vec4 Pf1 = Pf0 - 1.0; // Fractional part - 1.0\n  vec4 ix = vec4(Pi0.x, Pi1.x, Pi0.x, Pi1.x);\n  vec4 iy = vec4(Pi0.yy, Pi1.yy);\n  vec4 iz0 = vec4(Pi0.zzzz);\n  vec4 iz1 = vec4(Pi1.zzzz);\n  vec4 iw0 = vec4(Pi0.wwww);\n  vec4 iw1 = vec4(Pi1.wwww);\n\n  vec4 ixy = permute(permute(ix) + iy);\n  vec4 ixy0 = permute(ixy + iz0);\n  vec4 ixy1 = permute(ixy + iz1);\n  vec4 ixy00 = permute(ixy0 + iw0);\n  vec4 ixy01 = permute(ixy0 + iw1);\n  vec4 ixy10 = permute(ixy1 + iw0);\n  vec4 ixy11 = permute(ixy1 + iw1);\n\n  vec4 gx00 = ixy00 * (1.0 / 7.0);\n  vec4 gy00 = floor(gx00) * (1.0 / 7.0);\n  vec4 gz00 = floor(gy00) * (1.0 / 6.0);\n  gx00 = fract(gx00) - 0.5;\n  gy00 = fract(gy00) - 0.5;\n  gz00 = fract(gz00) - 0.5;\n  vec4 gw00 = vec4(0.75) - abs(gx00) - abs(gy00) - abs(gz00);\n  vec4 sw00 = step(gw00, vec4(0.0));\n  gx00 -= sw00 * (step(0.0, gx00) - 0.5);\n  gy00 -= sw00 * (step(0.0, gy00) - 0.5);\n\n  vec4 gx01 = ixy01 * (1.0 / 7.0);\n  vec4 gy01 = floor(gx01) * (1.0 / 7.0);\n  vec4 gz01 = floor(gy01) * (1.0 / 6.0);\n  gx01 = fract(gx01) - 0.5;\n  gy01 = fract(gy01) - 0.5;\n  gz01 = fract(gz01) - 0.5;\n  vec4 gw01 = vec4(0.75) - abs(gx01) - abs(gy01) - abs(gz01);\n  vec4 sw01 = step(gw01, vec4(0.0));\n  gx01 -= sw01 * (step(0.0, gx01) - 0.5);\n  gy01 -= sw01 * (step(0.0, gy01) - 0.5);\n\n  vec4 gx10 = ixy10 * (1.0 / 7.0);\n  vec4 gy10 = floor(gx10) * (1.0 / 7.0);\n  vec4 gz10 = floor(gy10) * (1.0 / 6.0);\n  gx10 = fract(gx10) - 0.5;\n  gy10 = fract(gy10) - 0.5;\n  gz10 = fract(gz10) - 0.5;\n  vec4 gw10 = vec4(0.75) - abs(gx10) - abs(gy10) - abs(gz10);\n  vec4 sw10 = step(gw10, vec4(0.0));\n  gx10 -= sw10 * (step(0.0, gx10) - 0.5);\n  gy10 -= sw10 * (step(0.0, gy10) - 0.5);\n\n  vec4 gx11 = ixy11 * (1.0 / 7.0);\n  vec4 gy11 = floor(gx11) * (1.0 / 7.0);\n  vec4 gz11 = floor(gy11) * (1.0 / 6.0);\n  gx11 = fract(gx11) - 0.5;\n  gy11 = fract(gy11) - 0.5;\n  gz11 = fract(gz11) - 0.5;\n  vec4 gw11 = vec4(0.75) - abs(gx11) - abs(gy11) - abs(gz11);\n  vec4 sw11 = step(gw11, vec4(0.0));\n  gx11 -= sw11 * (step(0.0, gx11) - 0.5);\n  gy11 -= sw11 * (step(0.0, gy11) - 0.5);\n\n  vec4 g0000 = vec4(gx00.x,gy00.x,gz00.x,gw00.x);\n  vec4 g1000 = vec4(gx00.y,gy00.y,gz00.y,gw00.y);\n  vec4 g0100 = vec4(gx00.z,gy00.z,gz00.z,gw00.z);\n  vec4 g1100 = vec4(gx00.w,gy00.w,gz00.w,gw00.w);\n  vec4 g0010 = vec4(gx10.x,gy10.x,gz10.x,gw10.x);\n  vec4 g1010 = vec4(gx10.y,gy10.y,gz10.y,gw10.y);\n  vec4 g0110 = vec4(gx10.z,gy10.z,gz10.z,gw10.z);\n  vec4 g1110 = vec4(gx10.w,gy10.w,gz10.w,gw10.w);\n  vec4 g0001 = vec4(gx01.x,gy01.x,gz01.x,gw01.x);\n  vec4 g1001 = vec4(gx01.y,gy01.y,gz01.y,gw01.y);\n  vec4 g0101 = vec4(gx01.z,gy01.z,gz01.z,gw01.z);\n  vec4 g1101 = vec4(gx01.w,gy01.w,gz01.w,gw01.w);\n  vec4 g0011 = vec4(gx11.x,gy11.x,gz11.x,gw11.x);\n  vec4 g1011 = vec4(gx11.y,gy11.y,gz11.y,gw11.y);\n  vec4 g0111 = vec4(gx11.z,gy11.z,gz11.z,gw11.z);\n  vec4 g1111 = vec4(gx11.w,gy11.w,gz11.w,gw11.w);\n\n  vec4 norm00 = taylorInvSqrt(vec4(dot(g0000, g0000), dot(g0100, g0100), dot(g1000, g1000), dot(g1100, g1100)));\n  g0000 *= norm00.x;\n  g0100 *= norm00.y;\n  g1000 *= norm00.z;\n  g1100 *= norm00.w;\n\n  vec4 norm01 = taylorInvSqrt(vec4(dot(g0001, g0001), dot(g0101, g0101), dot(g1001, g1001), dot(g1101, g1101)));\n  g0001 *= norm01.x;\n  g0101 *= norm01.y;\n  g1001 *= norm01.z;\n  g1101 *= norm01.w;\n\n  vec4 norm10 = taylorInvSqrt(vec4(dot(g0010, g0010), dot(g0110, g0110), dot(g1010, g1010), dot(g1110, g1110)));\n  g0010 *= norm10.x;\n  g0110 *= norm10.y;\n  g1010 *= norm10.z;\n  g1110 *= norm10.w;\n\n  vec4 norm11 = taylorInvSqrt(vec4(dot(g0011, g0011), dot(g0111, g0111), dot(g1011, g1011), dot(g1111, g1111)));\n  g0011 *= norm11.x;\n  g0111 *= norm11.y;\n  g1011 *= norm11.z;\n  g1111 *= norm11.w;\n\n  float n0000 = dot(g0000, Pf0);\n  float n1000 = dot(g1000, vec4(Pf1.x, Pf0.yzw));\n  float n0100 = dot(g0100, vec4(Pf0.x, Pf1.y, Pf0.zw));\n  float n1100 = dot(g1100, vec4(Pf1.xy, Pf0.zw));\n  float n0010 = dot(g0010, vec4(Pf0.xy, Pf1.z, Pf0.w));\n  float n1010 = dot(g1010, vec4(Pf1.x, Pf0.y, Pf1.z, Pf0.w));\n  float n0110 = dot(g0110, vec4(Pf0.x, Pf1.yz, Pf0.w));\n  float n1110 = dot(g1110, vec4(Pf1.xyz, Pf0.w));\n  float n0001 = dot(g0001, vec4(Pf0.xyz, Pf1.w));\n  float n1001 = dot(g1001, vec4(Pf1.x, Pf0.yz, Pf1.w));\n  float n0101 = dot(g0101, vec4(Pf0.x, Pf1.y, Pf0.z, Pf1.w));\n  float n1101 = dot(g1101, vec4(Pf1.xy, Pf0.z, Pf1.w));\n  float n0011 = dot(g0011, vec4(Pf0.xy, Pf1.zw));\n  float n1011 = dot(g1011, vec4(Pf1.x, Pf0.y, Pf1.zw));\n  float n0111 = dot(g0111, vec4(Pf0.x, Pf1.yzw));\n  float n1111 = dot(g1111, Pf1);\n\n  vec4 fade_xyzw = fade(Pf0);\n  vec4 n_0w = mix(vec4(n0000, n1000, n0100, n1100), vec4(n0001, n1001, n0101, n1101), fade_xyzw.w);\n  vec4 n_1w = mix(vec4(n0010, n1010, n0110, n1110), vec4(n0011, n1011, n0111, n1111), fade_xyzw.w);\n  vec4 n_zw = mix(n_0w, n_1w, fade_xyzw.z);\n  vec2 n_yzw = mix(n_zw.xy, n_zw.zw, fade_xyzw.y);\n  float n_xyzw = mix(n_yzw.x, n_yzw.y, fade_xyzw.x);\n  return 2.2 * n_xyzw;\n}\n\n// Classic Perlin noise, periodic version\nfloat pnoise(vec4 P, vec4 rep)\n{\n  vec4 Pi0 = mod(floor(P), rep); // Integer part modulo rep\n  vec4 Pi1 = mod(Pi0 + 1.0, rep); // Integer part + 1 mod rep\n  Pi0 = mod289(Pi0);\n  Pi1 = mod289(Pi1);\n  vec4 Pf0 = fract(P); // Fractional part for interpolation\n  vec4 Pf1 = Pf0 - 1.0; // Fractional part - 1.0\n  vec4 ix = vec4(Pi0.x, Pi1.x, Pi0.x, Pi1.x);\n  vec4 iy = vec4(Pi0.yy, Pi1.yy);\n  vec4 iz0 = vec4(Pi0.zzzz);\n  vec4 iz1 = vec4(Pi1.zzzz);\n  vec4 iw0 = vec4(Pi0.wwww);\n  vec4 iw1 = vec4(Pi1.wwww);\n\n  vec4 ixy = permute(permute(ix) + iy);\n  vec4 ixy0 = permute(ixy + iz0);\n  vec4 ixy1 = permute(ixy + iz1);\n  vec4 ixy00 = permute(ixy0 + iw0);\n  vec4 ixy01 = permute(ixy0 + iw1);\n  vec4 ixy10 = permute(ixy1 + iw0);\n  vec4 ixy11 = permute(ixy1 + iw1);\n\n  vec4 gx00 = ixy00 * (1.0 / 7.0);\n  vec4 gy00 = floor(gx00) * (1.0 / 7.0);\n  vec4 gz00 = floor(gy00) * (1.0 / 6.0);\n  gx00 = fract(gx00) - 0.5;\n  gy00 = fract(gy00) - 0.5;\n  gz00 = fract(gz00) - 0.5;\n  vec4 gw00 = vec4(0.75) - abs(gx00) - abs(gy00) - abs(gz00);\n  vec4 sw00 = step(gw00, vec4(0.0));\n  gx00 -= sw00 * (step(0.0, gx00) - 0.5);\n  gy00 -= sw00 * (step(0.0, gy00) - 0.5);\n\n  vec4 gx01 = ixy01 * (1.0 / 7.0);\n  vec4 gy01 = floor(gx01) * (1.0 / 7.0);\n  vec4 gz01 = floor(gy01) * (1.0 / 6.0);\n  gx01 = fract(gx01) - 0.5;\n  gy01 = fract(gy01) - 0.5;\n  gz01 = fract(gz01) - 0.5;\n  vec4 gw01 = vec4(0.75) - abs(gx01) - abs(gy01) - abs(gz01);\n  vec4 sw01 = step(gw01, vec4(0.0));\n  gx01 -= sw01 * (step(0.0, gx01) - 0.5);\n  gy01 -= sw01 * (step(0.0, gy01) - 0.5);\n\n  vec4 gx10 = ixy10 * (1.0 / 7.0);\n  vec4 gy10 = floor(gx10) * (1.0 / 7.0);\n  vec4 gz10 = floor(gy10) * (1.0 / 6.0);\n  gx10 = fract(gx10) - 0.5;\n  gy10 = fract(gy10) - 0.5;\n  gz10 = fract(gz10) - 0.5;\n  vec4 gw10 = vec4(0.75) - abs(gx10) - abs(gy10) - abs(gz10);\n  vec4 sw10 = step(gw10, vec4(0.0));\n  gx10 -= sw10 * (step(0.0, gx10) - 0.5);\n  gy10 -= sw10 * (step(0.0, gy10) - 0.5);\n\n  vec4 gx11 = ixy11 * (1.0 / 7.0);\n  vec4 gy11 = floor(gx11) * (1.0 / 7.0);\n  vec4 gz11 = floor(gy11) * (1.0 / 6.0);\n  gx11 = fract(gx11) - 0.5;\n  gy11 = fract(gy11) - 0.5;\n  gz11 = fract(gz11) - 0.5;\n  vec4 gw11 = vec4(0.75) - abs(gx11) - abs(gy11) - abs(gz11);\n  vec4 sw11 = step(gw11, vec4(0.0));\n  gx11 -= sw11 * (step(0.0, gx11) - 0.5);\n  gy11 -= sw11 * (step(0.0, gy11) - 0.5);\n\n  vec4 g0000 = vec4(gx00.x,gy00.x,gz00.x,gw00.x);\n  vec4 g1000 = vec4(gx00.y,gy00.y,gz00.y,gw00.y);\n  vec4 g0100 = vec4(gx00.z,gy00.z,gz00.z,gw00.z);\n  vec4 g1100 = vec4(gx00.w,gy00.w,gz00.w,gw00.w);\n  vec4 g0010 = vec4(gx10.x,gy10.x,gz10.x,gw10.x);\n  vec4 g1010 = vec4(gx10.y,gy10.y,gz10.y,gw10.y);\n  vec4 g0110 = vec4(gx10.z,gy10.z,gz10.z,gw10.z);\n  vec4 g1110 = vec4(gx10.w,gy10.w,gz10.w,gw10.w);\n  vec4 g0001 = vec4(gx01.x,gy01.x,gz01.x,gw01.x);\n  vec4 g1001 = vec4(gx01.y,gy01.y,gz01.y,gw01.y);\n  vec4 g0101 = vec4(gx01.z,gy01.z,gz01.z,gw01.z);\n  vec4 g1101 = vec4(gx01.w,gy01.w,gz01.w,gw01.w);\n  vec4 g0011 = vec4(gx11.x,gy11.x,gz11.x,gw11.x);\n  vec4 g1011 = vec4(gx11.y,gy11.y,gz11.y,gw11.y);\n  vec4 g0111 = vec4(gx11.z,gy11.z,gz11.z,gw11.z);\n  vec4 g1111 = vec4(gx11.w,gy11.w,gz11.w,gw11.w);\n\n  vec4 norm00 = taylorInvSqrt(vec4(dot(g0000, g0000), dot(g0100, g0100), dot(g1000, g1000), dot(g1100, g1100)));\n  g0000 *= norm00.x;\n  g0100 *= norm00.y;\n  g1000 *= norm00.z;\n  g1100 *= norm00.w;\n\n  vec4 norm01 = taylorInvSqrt(vec4(dot(g0001, g0001), dot(g0101, g0101), dot(g1001, g1001), dot(g1101, g1101)));\n  g0001 *= norm01.x;\n  g0101 *= norm01.y;\n  g1001 *= norm01.z;\n  g1101 *= norm01.w;\n\n  vec4 norm10 = taylorInvSqrt(vec4(dot(g0010, g0010), dot(g0110, g0110), dot(g1010, g1010), dot(g1110, g1110)));\n  g0010 *= norm10.x;\n  g0110 *= norm10.y;\n  g1010 *= norm10.z;\n  g1110 *= norm10.w;\n\n  vec4 norm11 = taylorInvSqrt(vec4(dot(g0011, g0011), dot(g0111, g0111), dot(g1011, g1011), dot(g1111, g1111)));\n  g0011 *= norm11.x;\n  g0111 *= norm11.y;\n  g1011 *= norm11.z;\n  g1111 *= norm11.w;\n\n  float n0000 = dot(g0000, Pf0);\n  float n1000 = dot(g1000, vec4(Pf1.x, Pf0.yzw));\n  float n0100 = dot(g0100, vec4(Pf0.x, Pf1.y, Pf0.zw));\n  float n1100 = dot(g1100, vec4(Pf1.xy, Pf0.zw));\n  float n0010 = dot(g0010, vec4(Pf0.xy, Pf1.z, Pf0.w));\n  float n1010 = dot(g1010, vec4(Pf1.x, Pf0.y, Pf1.z, Pf0.w));\n  float n0110 = dot(g0110, vec4(Pf0.x, Pf1.yz, Pf0.w));\n  float n1110 = dot(g1110, vec4(Pf1.xyz, Pf0.w));\n  float n0001 = dot(g0001, vec4(Pf0.xyz, Pf1.w));\n  float n1001 = dot(g1001, vec4(Pf1.x, Pf0.yz, Pf1.w));\n  float n0101 = dot(g0101, vec4(Pf0.x, Pf1.y, Pf0.z, Pf1.w));\n  float n1101 = dot(g1101, vec4(Pf1.xy, Pf0.z, Pf1.w));\n  float n0011 = dot(g0011, vec4(Pf0.xy, Pf1.zw));\n  float n1011 = dot(g1011, vec4(Pf1.x, Pf0.y, Pf1.zw));\n  float n0111 = dot(g0111, vec4(Pf0.x, Pf1.yzw));\n  float n1111 = dot(g1111, Pf1);\n\n  vec4 fade_xyzw = fade(Pf0);\n  vec4 n_0w = mix(vec4(n0000, n1000, n0100, n1100), vec4(n0001, n1001, n0101, n1101), fade_xyzw.w);\n  vec4 n_1w = mix(vec4(n0010, n1010, n0110, n1110), vec4(n0011, n1011, n0111, n1111), fade_xyzw.w);\n  vec4 n_zw = mix(n_0w, n_1w, fade_xyzw.z);\n  vec2 n_yzw = mix(n_zw.xy, n_zw.zw, fade_xyzw.y);\n  float n_xyzw = mix(n_yzw.x, n_yzw.y, fade_xyzw.x);\n  return 2.2 * n_xyzw;\n}\n'},function(e,t,n){"use strict";n.r(t),t.default="//\n// Description : Array and textureless GLSL 2D simplex noise function.\n//      Author : Ian McEwan, Ashima Arts.\n//  Maintainer : stegu\n//     Lastmod : 20110822 (ijm)\n//     License : Copyright (C) 2011 Ashima Arts. All rights reserved.\n//               Distributed under the MIT License. See LICENSE file.\n//               https://github.com/ashima/webgl-noise\n//               https://github.com/stegu/webgl-noise\n// \n\n\nfloat snoise(vec2 v)\n  {\n  const vec4 C = vec4(0.211324865405187,  // (3.0-sqrt(3.0))/6.0\n                      0.366025403784439,  // 0.5*(sqrt(3.0)-1.0)\n                     -0.577350269189626,  // -1.0 + 2.0 * C.x\n                      0.024390243902439); // 1.0 / 41.0\n// First corner\n  vec2 i  = floor(v + dot(v, C.yy) );\n  vec2 x0 = v -   i + dot(i, C.xx);\n\n// Other corners\n  vec2 i1;\n  //i1.x = step( x0.y, x0.x ); // x0.x > x0.y ? 1.0 : 0.0\n  //i1.y = 1.0 - i1.x;\n  i1 = (x0.x > x0.y) ? vec2(1.0, 0.0) : vec2(0.0, 1.0);\n  // x0 = x0 - 0.0 + 0.0 * C.xx ;\n  // x1 = x0 - i1 + 1.0 * C.xx ;\n  // x2 = x0 - 1.0 + 2.0 * C.xx ;\n  vec4 x12 = x0.xyxy + C.xxzz;\n  x12.xy -= i1;\n\n// Permutations\n  i = mod289(i); // Avoid truncation effects in permutation\n  vec3 p = permute( permute( i.y + vec3(0.0, i1.y, 1.0 ))\n\t\t+ i.x + vec3(0.0, i1.x, 1.0 ));\n\n  vec3 m = max(0.5 - vec3(dot(x0,x0), dot(x12.xy,x12.xy), dot(x12.zw,x12.zw)), 0.0);\n  m = m*m ;\n  m = m*m ;\n\n// Gradients: 41 points uniformly over a line, mapped onto a diamond.\n// The ring size 17*17 = 289 is close to a multiple of 41 (41*7 = 287)\n\n  vec3 x = 2.0 * fract(p * C.www) - 1.0;\n  vec3 h = abs(x) - 0.5;\n  vec3 ox = floor(x + 0.5);\n  vec3 a0 = x - ox;\n\n// Normalise gradients implicitly by scaling m\n// Approximation of: m *= inversesqrt( a0*a0 + h*h );\n  m *= 1.79284291400159 - 0.85373472095314 * ( a0*a0 + h*h );\n\n// Compute final noise value at P\n  vec3 g;\n  g.x  = a0.x  * x0.x  + h.x  * x0.y;\n  g.yz = a0.yz * x12.xz + h.yz * x12.yw;\n  return 130.0 * dot(m, g);\n}\n"},function(e,t,n){"use strict";n.r(t),t.default="//\n// Description : Array and textureless GLSL 2D/3D/4D simplex \n//               noise functions.\n//      Author : Ian McEwan, Ashima Arts.\n//  Maintainer : stegu\n//     Lastmod : 20110822 (ijm)\n//     License : Copyright (C) 2011 Ashima Arts. All rights reserved.\n//               Distributed under the MIT License. See LICENSE file.\n//               https://github.com/ashima/webgl-noise\n//               https://github.com/stegu/webgl-noise\n// \n\n\n\nfloat snoise(vec3 v)\n  { \n  const vec2  C = vec2(1.0/6.0, 1.0/3.0) ;\n  const vec4  D = vec4(0.0, 0.5, 1.0, 2.0);\n\n// First corner\n  vec3 i  = floor(v + dot(v, C.yyy) );\n  vec3 x0 =   v - i + dot(i, C.xxx) ;\n\n// Other corners\n  vec3 g = step(x0.yzx, x0.xyz);\n  vec3 l = 1.0 - g;\n  vec3 i1 = min( g.xyz, l.zxy );\n  vec3 i2 = max( g.xyz, l.zxy );\n\n  //   x0 = x0 - 0.0 + 0.0 * C.xxx;\n  //   x1 = x0 - i1  + 1.0 * C.xxx;\n  //   x2 = x0 - i2  + 2.0 * C.xxx;\n  //   x3 = x0 - 1.0 + 3.0 * C.xxx;\n  vec3 x1 = x0 - i1 + C.xxx;\n  vec3 x2 = x0 - i2 + C.yyy; // 2.0*C.x = 1/3 = C.y\n  vec3 x3 = x0 - D.yyy;      // -1.0+3.0*C.x = -0.5 = -D.y\n\n// Permutations\n  i = mod289(i); \n  vec4 p = permute( permute( permute( \n             i.z + vec4(0.0, i1.z, i2.z, 1.0 ))\n           + i.y + vec4(0.0, i1.y, i2.y, 1.0 )) \n           + i.x + vec4(0.0, i1.x, i2.x, 1.0 ));\n\n// Gradients: 7x7 points over a square, mapped onto an octahedron.\n// The ring size 17*17 = 289 is close to a multiple of 49 (49*6 = 294)\n  float n_ = 0.142857142857; // 1.0/7.0\n  vec3  ns = n_ * D.wyz - D.xzx;\n\n  vec4 j = p - 49.0 * floor(p * ns.z * ns.z);  //  mod(p,7*7)\n\n  vec4 x_ = floor(j * ns.z);\n  vec4 y_ = floor(j - 7.0 * x_ );    // mod(j,N)\n\n  vec4 x = x_ *ns.x + ns.yyyy;\n  vec4 y = y_ *ns.x + ns.yyyy;\n  vec4 h = 1.0 - abs(x) - abs(y);\n\n  vec4 b0 = vec4( x.xy, y.xy );\n  vec4 b1 = vec4( x.zw, y.zw );\n\n  //vec4 s0 = vec4(lessThan(b0,0.0))*2.0 - 1.0;\n  //vec4 s1 = vec4(lessThan(b1,0.0))*2.0 - 1.0;\n  vec4 s0 = floor(b0)*2.0 + 1.0;\n  vec4 s1 = floor(b1)*2.0 + 1.0;\n  vec4 sh = -step(h, vec4(0.0));\n\n  vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;\n  vec4 a1 = b1.xzyw + s1.xzyw*sh.zzww ;\n\n  vec3 p0 = vec3(a0.xy,h.x);\n  vec3 p1 = vec3(a0.zw,h.y);\n  vec3 p2 = vec3(a1.xy,h.z);\n  vec3 p3 = vec3(a1.zw,h.w);\n\n//Normalise gradients\n  vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));\n  p0 *= norm.x;\n  p1 *= norm.y;\n  p2 *= norm.z;\n  p3 *= norm.w;\n\n// Mix final noise value\n  vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);\n  m = m * m;\n  return 42.0 * dot( m*m, vec4( dot(p0,x0), dot(p1,x1), \n                                dot(p2,x2), dot(p3,x3) ) );\n  }\n"},function(e,t,n){"use strict";n.r(t),t.default="//\n// Description : Array and textureless GLSL 2D/3D/4D simplex \n//               noise functions.\n//      Author : Ian McEwan, Ashima Arts.\n//  Maintainer : stegu\n//     Lastmod : 20110822 (ijm)\n//     License : Copyright (C) 2011 Ashima Arts. All rights reserved.\n//               Distributed under the MIT License. See LICENSE file.\n//               https://github.com/ashima/webgl-noise\n//               https://github.com/stegu/webgl-noise\n// \n\n\n\n\n\n\n\nvec4 grad4(float j, vec4 ip)\n  {\n  const vec4 ones = vec4(1.0, 1.0, 1.0, -1.0);\n  vec4 p,s;\n\n  p.xyz = floor( fract (vec3(j) * ip.xyz) * 7.0) * ip.z - 1.0;\n  p.w = 1.5 - dot(abs(p.xyz), ones.xyz);\n  s = vec4(lessThan(p, vec4(0.0)));\n  p.xyz = p.xyz + (s.xyz*2.0 - 1.0) * s.www; \n\n  return p;\n  }\n\t\t\t\t\t\t\n// (sqrt(5) - 1)/4 = F4, used once below\n#define F4 0.309016994374947451\n\nfloat snoise(vec4 v)\n  {\n  const vec4  C = vec4( 0.138196601125011,  // (5 - sqrt(5))/20  G4\n                        0.276393202250021,  // 2 * G4\n                        0.414589803375032,  // 3 * G4\n                       -0.447213595499958); // -1 + 4 * G4\n\n// First corner\n  vec4 i  = floor(v + dot(v, vec4(F4)) );\n  vec4 x0 = v -   i + dot(i, C.xxxx);\n\n// Other corners\n\n// Rank sorting originally contributed by Bill Licea-Kane, AMD (formerly ATI)\n  vec4 i0;\n  vec3 isX = step( x0.yzw, x0.xxx );\n  vec3 isYZ = step( x0.zww, x0.yyz );\n//  i0.x = dot( isX, vec3( 1.0 ) );\n  i0.x = isX.x + isX.y + isX.z;\n  i0.yzw = 1.0 - isX;\n//  i0.y += dot( isYZ.xy, vec2( 1.0 ) );\n  i0.y += isYZ.x + isYZ.y;\n  i0.zw += 1.0 - isYZ.xy;\n  i0.z += isYZ.z;\n  i0.w += 1.0 - isYZ.z;\n\n  // i0 now contains the unique values 0,1,2,3 in each channel\n  vec4 i3 = clamp( i0, 0.0, 1.0 );\n  vec4 i2 = clamp( i0-1.0, 0.0, 1.0 );\n  vec4 i1 = clamp( i0-2.0, 0.0, 1.0 );\n\n  //  x0 = x0 - 0.0 + 0.0 * C.xxxx\n  //  x1 = x0 - i1  + 1.0 * C.xxxx\n  //  x2 = x0 - i2  + 2.0 * C.xxxx\n  //  x3 = x0 - i3  + 3.0 * C.xxxx\n  //  x4 = x0 - 1.0 + 4.0 * C.xxxx\n  vec4 x1 = x0 - i1 + C.xxxx;\n  vec4 x2 = x0 - i2 + C.yyyy;\n  vec4 x3 = x0 - i3 + C.zzzz;\n  vec4 x4 = x0 + C.wwww;\n\n// Permutations\n  i = mod289(i); \n  float j0 = permute( permute( permute( permute(i.w) + i.z) + i.y) + i.x);\n  vec4 j1 = permute( permute( permute( permute (\n             i.w + vec4(i1.w, i2.w, i3.w, 1.0 ))\n           + i.z + vec4(i1.z, i2.z, i3.z, 1.0 ))\n           + i.y + vec4(i1.y, i2.y, i3.y, 1.0 ))\n           + i.x + vec4(i1.x, i2.x, i3.x, 1.0 ));\n\n// Gradients: 7x7x6 points over a cube, mapped onto a 4-cross polytope\n// 7*7*6 = 294, which is close to the ring size 17*17 = 289.\n  vec4 ip = vec4(1.0/294.0, 1.0/49.0, 1.0/7.0, 0.0) ;\n\n  vec4 p0 = grad4(j0,   ip);\n  vec4 p1 = grad4(j1.x, ip);\n  vec4 p2 = grad4(j1.y, ip);\n  vec4 p3 = grad4(j1.z, ip);\n  vec4 p4 = grad4(j1.w, ip);\n\n// Normalise gradients\n  vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));\n  p0 *= norm.x;\n  p1 *= norm.y;\n  p2 *= norm.z;\n  p3 *= norm.w;\n  p4 *= taylorInvSqrt(dot(p4,p4));\n\n// Mix contributions from the five corners\n  vec3 m0 = max(0.6 - vec3(dot(x0,x0), dot(x1,x1), dot(x2,x2)), 0.0);\n  vec2 m1 = max(0.6 - vec2(dot(x3,x3), dot(x4,x4)            ), 0.0);\n  m0 = m0 * m0;\n  m1 = m1 * m1;\n  return 49.0 * ( dot(m0*m0, vec3( dot( p0, x0 ), dot( p1, x1 ), dot( p2, x2 )))\n               + dot(m1*m1, vec2( dot( p3, x3 ), dot( p4, x4 ) ) ) ) ;\n\n  }\n"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(36),i=n(28),a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.type=function(){return"null"},t.prototype.set_lines=function(e){var t=i.ThreeToGl.any(this.variable_for_input("in")),n=this.io.inputs.named_input_connection_points[0].type+" "+this.gl_var_name("value")+" = "+t;e.add_body_lines(this,[n])},t}(o.BaseNodeGlMathFunctionArg1GlNode);t.NullGlNode=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(34),i=new(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t}(n(5).NodeParamsConfig)),a=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=i,t}return r.__extends(t,e),t.type=function(){return"output"},t.prototype.initialize_node=function(){e.prototype.initialize_node.call(this),this.add_post_dirty_hook("_set_mat_to_recompile",this._set_mat_to_recompile.bind(this))},t.prototype.create_params=function(){var e;null===(e=this.material_node)||void 0===e||e.assembler_controller.add_output_params(this)},t.prototype.set_lines=function(e){var t;null===(t=this.material_node)||void 0===t||t.assembler_controller.assembler.set_node_lines_output(this,e)},t}(o.TypedGlNode);t.OutputGlNode=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(34),i=n(16),a=r.__importDefault(n(21)),s=n(5),_=n(24),u=n(29),c=n(196),p=n(134),l=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name=s.ParamConfig.STRING(""),t.type=s.ParamConfig.INTEGER(i.ConnectionPointTypes.indexOf(i.ConnectionPointType.FLOAT),{menu:{entries:i.ConnectionPointTypes.map((function(e,t){return{name:e,value:t}}))}}),t.as_color=s.ParamConfig.BOOLEAN(0,{visible_if:{type:i.ConnectionPointTypes.indexOf(i.ConnectionPointType.VEC3)}}),t}return r.__extends(t,e),t}(s.NodeParamsConfig)),d=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=l,t._allow_inputs_created_from_params=!1,t._on_create_set_name_if_none_bound=t._on_create_set_name_if_none.bind(t),t.gl_connections_controller=new p.GlConnectionsController(t),t}return r.__extends(t,e),t.type=function(){return"param"},t.prototype.initialize_node=function(){var e=this;this.add_post_dirty_hook("_set_mat_to_recompile",this._set_mat_to_recompile.bind(this)),this.lifecycle.add_on_create_hook(this._on_create_set_name_if_none_bound),this.gl_connections_controller.initialize_node(),this.gl_connections_controller.set_expected_input_types_function((function(){return[]})),this.gl_connections_controller.set_expected_output_types_function((function(){return[i.ConnectionPointTypes[e.pv.type]]}))},t.prototype.set_lines=function(e){var t=[],n=i.ConnectionPointTypes[this.pv.type],r=this.uniform_name();t.push(new u.UniformGLDefinition(this,n,r)),e.add_definitions(this,t)},t.prototype.set_param_configs=function(){var e=i.ConnectionPointTypes[this.pv.type],t=i.ConnectionPointInitValueMap[e],n=i.ConnectionPointTypeToParamTypeMap[e];this._param_configs_controller=this._param_configs_controller||new c.ParamConfigsController,this._param_configs_controller.reset(),n==_.ParamType.VECTOR3&&this.p.as_color.value&&a.default(t)&&3==t.length?this._param_configs_controller.create_and_push(_.ParamType.COLOR,this.pv.name,t,this.uniform_name()):this._param_configs_controller.create_and_push(n,this.pv.name,t,this.uniform_name())},t.prototype.uniform_name=function(){var e=this.io.outputs.named_output_connection_points[0];return this.gl_var_name(e.name)},t.prototype._on_create_set_name_if_none=function(){""==this.pv.name&&this.p.name.set(this.name)},t}(o.TypedGlNode);t.ParamGlNode=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(36),i=n(16),a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.type=function(){return"refract"},t.prototype.initialize_node=function(){e.prototype.initialize_node.call(this),this.gl_connections_controller.set_input_name_function((function(e){return["I","N","eta"][e]})),this.gl_connections_controller.set_output_name_function((function(e){return"refract"})),this.gl_connections_controller.set_expected_input_types_function(this._expected_input_types.bind(this)),this.gl_connections_controller.set_expected_output_types_function(this._expected_output_types.bind(this))},t.prototype.gl_method_name=function(){return"refract"},t.prototype._expected_input_types=function(){var e=this.gl_connections_controller.first_input_connection_type()||i.ConnectionPointType.VEC3;return[e,e,i.ConnectionPointType.FLOAT]},t.prototype._expected_output_types=function(){return[this._expected_input_types()[0]]},t}(o.BaseGlMathFunctionGlNode);t.RefractGlNode=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(36),i=r.__importDefault(n(95)),a=n(16),s=n(29),_=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.type=function(){return"quat_mult"},t.prototype.initialize_node=function(){e.prototype.initialize_node.call(this),this.gl_connections_controller.set_input_name_function((function(e){return["quat0","quat1"][e]})),this.gl_connections_controller.set_expected_input_types_function((function(){return[a.ConnectionPointType.VEC4,a.ConnectionPointType.VEC4]})),this.gl_connections_controller.set_expected_output_types_function((function(){return[a.ConnectionPointType.VEC4]}))},t.prototype.gl_method_name=function(){return"quat_mult"},t.prototype.gl_function_definitions=function(){return[new s.FunctionGLDefinition(this,a.ConnectionPointType.VEC4,i.default)]},t}(o.BaseNodeGlMathFunctionArg1GlNode);t.QuatMultGlNode=_},function(e,t,n){"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0});var o,i=n(2),a=n(36),s=i.__importDefault(n(95)),_=n(16),u=n(29);!function(e){e.AXIS="axis",e.ANGLE="angle"}(o||(o={}));var c=[o.AXIS,o.ANGLE],p=((r={})[o.AXIS]=[0,0,1],r[o.ANGLE]=0,r),l=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i.__extends(t,e),t.type=function(){return"quat_from_axis_angle"},t.prototype.initialize_node=function(){e.prototype.initialize_node.call(this),this.gl_connections_controller.set_input_name_function((function(e){return c[e]})),this.gl_connections_controller.set_expected_input_types_function((function(){return[_.ConnectionPointType.VEC3,_.ConnectionPointType.FLOAT]})),this.gl_connections_controller.set_expected_output_types_function((function(){return[_.ConnectionPointType.VEC4]}))},t.prototype.gl_input_default_value=function(e){return p[e]},t.prototype.gl_method_name=function(){return"quat_from_axis_angle"},t.prototype.gl_function_definitions=function(){return[new u.FunctionGLDefinition(this,_.ConnectionPointType.VEC4,s.default)]},t}(a.BaseNodeGlMathFunctionArg2GlNode);t.QuatFromAxisAngleGlNode=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(36),i=r.__importDefault(n(95)),a=n(16),s=n(29),_=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.type=function(){return"quat_to_angle"},t.prototype.initialize_node=function(){e.prototype.initialize_node.call(this),this.gl_connections_controller.set_input_name_function((function(e){return["quat"][e]})),this.gl_connections_controller.set_expected_input_types_function((function(){return[a.ConnectionPointType.VEC4]})),this.gl_connections_controller.set_expected_output_types_function((function(){return[a.ConnectionPointType.FLOAT]}))},t.prototype.gl_method_name=function(){return"quat_to_angle"},t.prototype.gl_function_definitions=function(){return[new s.FunctionGLDefinition(this,a.ConnectionPointType.FLOAT,i.default)]},t}(o.BaseNodeGlMathFunctionArg1GlNode);t.QuatToAngleGlNode=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(36),i=r.__importDefault(n(95)),a=n(16),s=n(29),_=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.type=function(){return"quat_to_axis"},t.prototype.initialize_node=function(){e.prototype.initialize_node.call(this),this.gl_connections_controller.set_input_name_function((function(e){return["quat"][e]})),this.gl_connections_controller.set_expected_input_types_function((function(){return[a.ConnectionPointType.VEC4]})),this.gl_connections_controller.set_expected_output_types_function((function(){return[a.ConnectionPointType.VEC3]}))},t.prototype.gl_method_name=function(){return"quat_to_axis"},t.prototype.gl_function_definitions=function(){return[new s.FunctionGLDefinition(this,a.ConnectionPointType.VEC3,i.default)]},t}(o.BaseNodeGlMathFunctionArg1GlNode);t.QuatToAxisGlNode=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(34),i=n(16),a=n(33),s=n(29),_=n(128),u=n(196),c=n(24),p=n(5),l=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name=p.ParamConfig.STRING("ramp"),t.input=p.ParamConfig.FLOAT(0),t}return r.__extends(t,e),t}(p.NodeParamsConfig)),d=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=l,t}return r.__extends(t,e),t.type=function(){return"ramp"},t.prototype.initialize=function(){e.prototype.initialize_node.call(this),this.io.outputs.set_named_output_connection_points([new a.TypedNamedConnectionPoint("val",i.ConnectionPointType.FLOAT)])},t.prototype.set_lines=function(e){var t=i.ConnectionPointType.FLOAT,n=this._uniform_name(),r=this.gl_var_name("val"),o=new s.UniformGLDefinition(this,i.ConnectionPointType.SAMPLER_2D,n);e.add_definitions(this,[o]);var a=this.variable_for_input(this.p.input.name),_=t+" "+r+" = texture2D("+this._uniform_name()+", vec2("+a+", 0.0)).x";e.add_body_lines(this,[_])},t.prototype.set_param_configs=function(){this._param_configs_controller=this._param_configs_controller||new u.ParamConfigsController,this._param_configs_controller.reset(),this._param_configs_controller.create_and_push(c.ParamType.RAMP,this.pv.name,_.RampParam.DEFAULT_VALUE,this._uniform_name())},t.prototype._uniform_name=function(){return"ramp_texture_"+this.gl_var_name("val")},t}(o.TypedGlNode);t.RampGlNode=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(34),i=n(28),a=n(5),s=n(16),_=n(33),u=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.seed=a.ParamConfig.VECTOR2([1,1]),t}return r.__extends(t,e),t}(a.NodeParamsConfig)),c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=u,t}return r.__extends(t,e),t.type=function(){return"random"},t.prototype.initialize_node=function(){e.prototype.initialize_node.call(this),this.io.outputs.set_named_output_connection_points([new _.TypedNamedConnectionPoint("rand",s.ConnectionPointType.FLOAT)])},t.prototype.set_lines=function(e){var t=i.ThreeToGl.vector2(this.variable_for_input("vec2")),n="float "+this.gl_var_name("float")+" = rand("+t+")";e.add_body_lines(this,[n])},t}(o.TypedGlNode);t.RandomGlNode=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(34),i=n(28),a=r.__importDefault(n(757)),s=n(5),_=n(16),u=n(29),c=n(33),p=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.rgb=s.ParamConfig.VECTOR3([1,1,1]),t}return r.__extends(t,e),t}(s.NodeParamsConfig)),l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=p,t}return r.__extends(t,e),t.type=function(){return"rgb_to_hsv"},t.prototype.initialize_node=function(){e.prototype.initialize_node.call(this),this.io.outputs.set_named_output_connection_points([new c.TypedNamedConnectionPoint("hsv",_.ConnectionPointType.VEC3)])},t.prototype.set_lines=function(e){var t=[],n=[];t.push(new u.FunctionGLDefinition(this,_.ConnectionPointType.VEC3,a.default));var r=i.ThreeToGl.vector3(this.variable_for_input("rgb")),o=this.gl_var_name("hsv");n.push("vec3 "+o+" = rgb2hsv("+r+")"),e.add_definitions(this,t),e.add_body_lines(this,n)},t}(o.TypedGlNode);t.RgbToHsvGlNode=l},function(e,t,n){"use strict";n.r(t),t.default="// https://stackoverflow.com/questions/15095909/from-rgb-to-hsv-in-opengl-glsl\nvec3 rgb2hsv(vec3 c)\n{\n\tvec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\n\tvec4 p = mix(vec4(c.bg, K.wz), vec4(c.gb, K.xy), step(c.b, c.g));\n\tvec4 q = mix(vec4(p.xyw, c.r), vec4(c.r, p.yzx), step(p.x, c.r));\n\n\tfloat d = q.x - min(q.w, q.y);\n\tfloat e = 1.0e-10;\n\treturn vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);\n}"},function(e,t,n){"use strict";var r,o,i,a;Object.defineProperty(t,"__esModule",{value:!0});var s,_=n(2),u=n(368),c=_.__importDefault(n(95)),p=n(29),l=n(16);!function(e){e[e.AXIS=0]="AXIS",e[e.QUAT=1]="QUAT"}(s||(s={}));var d=[s.AXIS,s.QUAT],f=((r={})[s.AXIS]="from axis + angle",r[s.QUAT]="from quaternion",r),h=((o={})[s.AXIS]=["vector","axis","angle"],o[s.QUAT]=["vector","quat"],o),m=((i={})[s.AXIS]="rotate_with_axis_angle",i[s.QUAT]="rotate_with_quat",i),y=((a={})[s.AXIS]=[l.ConnectionPointType.VEC3,l.ConnectionPointType.VEC3,l.ConnectionPointType.FLOAT],a[s.QUAT]=[l.ConnectionPointType.VEC3,l.ConnectionPointType.VEC4],a),v={vector:[0,0,1],axis:[0,1,0]},g=n(5),b=n(28),x=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.signature=g.ParamConfig.INTEGER(s.AXIS,{menu:{entries:d.map((function(e,t){return{name:f[e],value:t}}))}}),t}return _.__extends(t,e),t}(g.NodeParamsConfig)),P=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=x,t}return _.__extends(t,e),t.type=function(){return"rotate"},t.prototype.initialize_node=function(){e.prototype.initialize_node.call(this),this.gl_connections_controller.set_expected_input_types_function(this._expected_input_types.bind(this)),this.gl_connections_controller.set_expected_output_types_function(this._expected_output_types.bind(this)),this.gl_connections_controller.set_input_name_function(this._gl_input_name.bind(this))},t.prototype._gl_input_name=function(e){var t=d[this.pv.signature];return h[t][e]},t.prototype.gl_input_default_value=function(e){return v[e]},t.prototype.gl_method_name=function(){var e=d[this.pv.signature];return m[e]},t.prototype._expected_input_types=function(){var e=d[this.pv.signature];return y[e]},t.prototype._expected_output_types=function(){return[l.ConnectionPointType.VEC3]},t.prototype.gl_function_definitions=function(){var e=this._expected_output_types()[0];return[new p.FunctionGLDefinition(this,e,c.default)]},t.prototype.set_lines=function(e){var t=this,n=this.io.outputs.named_output_connection_points[0].type,r=this.io.inputs.named_input_connection_points.map((function(e,n){var r=e.name;return b.ThreeToGl.any(t.variable_for_input(r))})).join(", "),o=n+" "+this.gl_var_name(this.gl_connections_controller.output_name(0))+" = "+this.gl_method_name()+"("+r+")";e.add_body_lines(this,[o]),e.add_definitions(this,this.gl_function_definitions())},t}(u.BaseAdaptiveGlNode);t.RotateGlNode=P},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(36),i=n(28),a=n(16),s=["x","y","z","w"],_=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.type=function(){return"round"},t.prototype.set_lines=function(e){var t=this,n=this.io.inputs.named_input_connection_points[0],r=i.ThreeToGl.vector2(this.variable_for_input(n.name)),o=this.io.outputs.named_output_connection_points[0],_=this.gl_var_name(o.name),u=[];if(1==a.ConnectionPointComponentsCountMap[o.type])u.push(o.type+" "+_+" = "+this._simple_line(r));else{var c=s.map((function(e){return t._simple_line(r+"."+e)}));u.push(o.type+" "+_+" = "+o.type+"("+c.join(",")+")")}e.add_body_lines(this,u)},t.prototype._simple_line=function(e){return"sign("+e+")*floor(abs("+e+")+0.5)"},t}(o.BaseNodeGlMathFunctionArg1GlNode);t.RoundGlNode=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(34),i=n(135),a=n(33),s=n(16),_=n(28),u=n(29),c=n(196),p=n(24),l=n(5),d=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.param_name=l.ParamConfig.STRING("texture_map"),t.default_value=l.ParamConfig.STRING(i.FileCopNode.DEFAULT_NODE_PATH.UV),t.uv=l.ParamConfig.VECTOR2([0,0]),t}return r.__extends(t,e),t}(l.NodeParamsConfig)),f=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=d,t}return r.__extends(t,e),t.type=function(){return"texture"},t.prototype.initialize_node=function(){e.prototype.initialize_node.call(this),this.io.outputs.set_named_output_connection_points([new a.TypedNamedConnectionPoint(t.OUTPUT_NAME,s.ConnectionPointType.VEC4)])},t.prototype.set_lines=function(e){var n=_.ThreeToGl.vector2(this.variable_for_input(this.p.uv.name)),r=this.gl_var_name(t.OUTPUT_NAME),o=this._uniform_name(),i=new u.UniformGLDefinition(this,s.ConnectionPointType.SAMPLER_2D,o),a="vec4 "+r+" = texture2D("+o+", "+n+")";e.add_definitions(this,[i]),e.add_body_lines(this,[a])},t.prototype.set_param_configs=function(){this._param_configs_controller=this._param_configs_controller||new c.ParamConfigsController,this._param_configs_controller.reset(),this._param_configs_controller.create_and_push(p.ParamType.OPERATOR_PATH,this.pv.param_name,this.pv.default_value,this._uniform_name())},t.prototype._uniform_name=function(){return this.gl_var_name(this.pv.param_name)},t.OUTPUT_NAME="rgba",t}(o.TypedGlNode);t.TextureGlNode=f},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,o=n(2),i=n(34),a=n(28),s=n(134);!function(e){e.CONDITION="condition",e.IF_TRUE="if_true",e.IF_FALSE="if_false"}(r||(r={}));var _=[r.CONDITION,r.IF_TRUE,r.IF_FALSE],u=n(16),c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.gl_connections_controller=new s.GlConnectionsController(t),t}return o.__extends(t,e),t.type=function(){return"two_way_switch"},t.prototype.initialize_node=function(){e.prototype.initialize_node.call(this),this.gl_connections_controller.initialize_node(),this.gl_connections_controller.set_expected_input_types_function(this._expected_input_types.bind(this)),this.gl_connections_controller.set_expected_output_types_function(this._expected_output_types.bind(this)),this.gl_connections_controller.set_input_name_function(this._gl_input_name.bind(this)),this.gl_connections_controller.set_output_name_function(this._gl_output_name.bind(this))},t.prototype._gl_input_name=function(e){return _[e]},t.prototype._gl_output_name=function(){return"value"},t.prototype._expected_input_types=function(){var e=this.io.connections.input_connection(1)||this.io.connections.input_connection(2),t=e?this.gl_connections_controller.connection_type_from_connection(e):u.ConnectionPointType.FLOAT;return[u.ConnectionPointType.BOOL,t,t]},t.prototype._expected_output_types=function(){return[this._expected_input_types()[1]]},t.prototype.set_lines=function(e){var t=[],n=this.gl_var_name("value"),o=a.ThreeToGl.bool(this.variable_for_input(r.CONDITION)),i=a.ThreeToGl.any(this.variable_for_input(r.IF_TRUE)),s=a.ThreeToGl.any(this.variable_for_input(r.IF_FALSE)),_=this._expected_output_types()[1];t.push(_+" "+n),t.push("if("+o+"){"),t.push(n+" = "+i),t.push("} else {"),t.push(n+" = "+s),t.push("}"),e.add_body_lines(this,t)},t}(i.ParamlessTypedGlNode);t.TwoWaySwitchGlNode=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=r.__importDefault(n(95)),i=n(371),a=n(16),s={start:[0,0,1],end:[1,0,0],up:[0,1,0]},_=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype._expected_input_types=function(){var e=a.ConnectionPointType.VEC3;return[e,e,e]},t.prototype._expected_output_types=function(){return[a.ConnectionPointType.VEC4]},t.prototype.gl_input_default_value=function(e){return s[e]},t}(i.MathFunctionArg3Factory("vector_align",{in:["start","end","up"],method:"vector_align_with_up",functions:[o.default]}));t.VectorAlignGlNode=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=r.__importDefault(n(95)),i=n(369),a=n(16),s={start:[0,0,1],end:[1,0,0]},_=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype._expected_input_types=function(){var e=a.ConnectionPointType.VEC3;return[e,e]},t.prototype._expected_output_types=function(){return[a.ConnectionPointType.FLOAT]},t.prototype.gl_input_default_value=function(e){return s[e]},t}(i.MathFunctionArg2Factory("vector_angle",{in:["start","end"],method:"vector_angle",functions:[o.default]}));t.VectorAngleGlNode=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(130),o=n(765),i=n(767),a=n(773),s=n(774),_=n(374),u=n(776),c=n(780),p=n(376),l=function(){function e(){}return e.run=function(e){e.register_node(o.MeshBasicMatNode,r.CATEGORY_MAT.MESH),e.register_node(i.MeshBasicBuilderMatNode,r.CATEGORY_MAT.ADVANCED),e.register_node(a.MeshLambertMatNode,r.CATEGORY_MAT.MESH),e.register_node(s.MeshLambertBuilderMatNode,r.CATEGORY_MAT.ADVANCED),e.register_node(_.MeshStandardMatNode,r.CATEGORY_MAT.MESH),e.register_node(u.MeshStandardBuilderMatNode,r.CATEGORY_MAT.ADVANCED),e.register_node(c.PointsMatNode,r.CATEGORY_MAT.POINTS),e.register_node(p.PointsBuilderMatNode,r.CATEGORY_MAT.ADVANCED)},e}();t.MatRegister=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(56),i=n(0),a=n(68),s=n(5),_=n(197),u=n(105),c=n(116),p=n(117),l=n(118),d=new(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t}(l.TextureAlphaMapParamConfig(p.TextureMapParamConfig(c.SkinningParamConfig(u.SideParamConfig(_.ColorParamConfig(s.NodeParamsConfig))))))),f=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=d,t.texture_map_controller=new p.TextureMapController(t,{direct_params:!0}),t.texture_alpha_map_controller=new l.TextureAlphaMapController(t,{direct_params:!0}),t}return r.__extends(t,e),t.type=function(){return"mesh_basic"},t.prototype.create_material=function(){return new o.MeshBasicMaterial({vertexColors:!1,side:i.FrontSide,color:16777215,opacity:1})},t.prototype.initialize_node=function(){var e=this;this.params.set_post_create_params_hook((function(){e.texture_map_controller.initialize_node(),e.texture_alpha_map_controller.initialize_node()}))},t.prototype.cook=function(){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(e){return _.ColorsController.update(this),u.SideController.update(this),c.SkinningController.update(this),this.texture_map_controller.update(),this.texture_alpha_map_controller.update(),this.set_material(this.material),[2]}))}))},t}(a.TypedMatNode);t.MeshBasicMatNode=f},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.set_content=function(t){e.prototype.set_content.call(this,t)},t.prototype.set_material=function(e){null!=this._content&&this._content.dispose(),this.set_content(e)},t.prototype.has_material=function(){return this.has_content()},t.prototype.material=function(){return this.content()},t}(n(115).TypedContainer);t.MaterialContainer=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(5),i=n(198),a=n(105),s=n(116),_=n(117),u=n(118),c=n(768),p=n(199),l=n(132),d=new(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t}(u.TextureAlphaMapParamConfig(_.TextureMapParamConfig(s.SkinningParamConfig(a.SideParamConfig(i.ColorParamConfig(o.NodeParamsConfig))))))),f=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=d,t.texture_map_controller=new _.TextureMapController(t,{uniforms:!0}),t.texture_alpha_map_controller=new u.TextureAlphaMapController(t,{uniforms:!0}),t}return r.__extends(t,e),t.type=function(){return"mesh_basic_builder"},t.prototype.initialize_node=function(){var e=this;this.params.set_post_create_params_hook((function(){e.texture_map_controller.initialize_node(),e.texture_alpha_map_controller.initialize_node()}))},t.prototype._create_assembler_controller=function(){return new l.GlAssemblerController(this,c.ShaderAssemblerBasic)},t.prototype.cook=function(){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(e){switch(e.label){case 0:return[4,this.compile_if_required()];case 1:return e.sent(),i.ColorsController.update(this),a.SideController.update(this),s.SkinningController.update(this),[4,_.TextureMapController.update(this)];case 2:return e.sent(),[4,u.TextureAlphaMapController.update(this)];case 3:return e.sent(),this.set_material(this.material),[2]}}))}))},t}(p.TypedBuilderMatNode);t.MeshBasicBuilderMatNode=f},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(23),i=n(26),a=n(37),s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),Object.defineProperty(t.prototype,"_template_shader",{get:function(){var e=a.ShaderLib.basic;return{vertexShader:e.vertexShader,fragmentShader:e.fragmentShader,uniforms:e.uniforms}},enumerable:!0,configurable:!0}),t.prototype.create_material=function(){var e=this._template_shader,t=new i.ShaderMaterial({lights:!1,uniforms:o.UniformsUtils.clone(e.uniforms),vertexShader:e.vertexShader,fragmentShader:e.fragmentShader});return this._add_custom_materials(t),t},t}(n(274).ShaderAssemblerMesh);t.ShaderAssemblerBasic=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(23),i=n(26),a=n(37),s=n(0),_=n(0),u=n(106),c=n(50),p=new Map([[c.ShaderName.VERTEX,"#include <begin_vertex>"],[c.ShaderName.FRAGMENT,"vec4 diffuseColor = vec4( 1.0 );"]]),l=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),Object.defineProperty(t.prototype,"_template_shader",{get:function(){var e=a.ShaderLib.distanceRGBA;return{vertexShader:e.vertexShader,fragmentShader:e.fragmentShader,uniforms:e.uniforms}},enumerable:!0,configurable:!0}),t.prototype.insert_body_after=function(e){return p.get(e)},t.prototype.create_material=function(){var e=this._template_shader;return new i.ShaderMaterial({defines:{DEPTH_PACKING:[s.RGBADepthPacking,_.BasicDepthPacking][0]},uniforms:o.UniformsUtils.clone(e.uniforms),vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})},t}(u.ShaderAssemblerMaterial);t.ShaderAssemblerCustomMeshDistance=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(23),i=n(26),a=n(37),s=n(0),_=n(0),u=n(106),c=n(50),p=new Map([[c.ShaderName.VERTEX,"#include <begin_vertex>"],[c.ShaderName.FRAGMENT,"vec4 diffuseColor = vec4( 1.0 );"]]),l=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),Object.defineProperty(t.prototype,"_template_shader",{get:function(){var e=a.ShaderLib.depth;return{vertexShader:e.vertexShader,fragmentShader:e.fragmentShader,uniforms:e.uniforms}},enumerable:!0,configurable:!0}),t.prototype.insert_body_after=function(e){return p.get(e)},t.prototype.create_material=function(){var e=this._template_shader;return new i.ShaderMaterial({defines:{DEPTH_PACKING:[s.RGBADepthPacking,_.BasicDepthPacking][0]},uniforms:o.UniformsUtils.clone(e.uniforms),vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})},t}(u.ShaderAssemblerMaterial);t.ShaderAssemblerCustomMeshDepth=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(23),i=n(26),a=n(106),s=r.__importDefault(n(772)),_=r.__importDefault(n(373)),u=n(50),c=new Map([[u.ShaderName.VERTEX,"// INSERT DEFINES"]]),p=new Map([[u.ShaderName.VERTEX,"// INSERT BODY"]]),l=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),Object.defineProperty(t.prototype,"_template_shader",{get:function(){return{vertexShader:s.default,fragmentShader:_.default,uniforms:{mNear:{value:0},mFar:{value:10}}}},enumerable:!0,configurable:!0}),t.prototype.insert_define_after=function(e){return c.get(e)},t.prototype.insert_body_after=function(e){return p.get(e)},t.prototype.create_material=function(){var e=this._template_shader;return new i.ShaderMaterial({uniforms:o.UniformsUtils.clone(e.uniforms),vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})},t}(a.ShaderAssemblerMaterial);t.ShaderAssemblerCustomMeshDepthDOF=l},function(e,t,n){"use strict";n.r(t),t.default="#include <common>\n\nvarying float vViewZDepth;\n\n// INSERT DEFINES\n\n\n\nvoid main() {\n\n\t// INSERT BODY\n\n\n\t#include <project_vertex>\n\n\tvViewZDepth = - mvPosition.z;\n}"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(160),i=n(0),a=n(68),s=n(5),_=n(197),u=n(105),c=n(116),p=n(117),l=n(118),d=new(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t}(l.TextureAlphaMapParamConfig(p.TextureMapParamConfig(c.SkinningParamConfig(u.SideParamConfig(_.ColorParamConfig(s.NodeParamsConfig))))))),f=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=d,t.texture_map_controller=new p.TextureMapController(t,{direct_params:!0}),t.texture_alpha_map_controller=new l.TextureAlphaMapController(t,{direct_params:!0}),t}return r.__extends(t,e),t.type=function(){return"mesh_lambert"},t.prototype.create_material=function(){return new o.MeshLambertMaterial({vertexColors:!1,side:i.FrontSide,color:16777215,opacity:1})},t.prototype.initialize_node=function(){var e=this;this.params.set_post_create_params_hook((function(){e.texture_map_controller.initialize_node(),e.texture_alpha_map_controller.initialize_node()}))},t.prototype.cook=function(){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(e){return _.ColorsController.update(this),u.SideController.update(this),c.SkinningController.update(this),this.texture_map_controller.update(),this.texture_alpha_map_controller.update(),this.set_material(this.material),[2]}))}))},t}(a.TypedMatNode);t.MeshLambertMatNode=f},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(5),i=n(198),a=n(105),s=n(116),_=n(117),u=n(118),c=n(199),p=n(132),l=n(775),d=new(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t}(u.TextureAlphaMapParamConfig(_.TextureMapParamConfig(s.SkinningParamConfig(a.SideParamConfig(i.ColorParamConfig(o.NodeParamsConfig))))))),f=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=d,t.texture_map_controller=new _.TextureMapController(t,{uniforms:!0}),t.texture_alpha_map_controller=new u.TextureAlphaMapController(t,{uniforms:!0}),t}return r.__extends(t,e),t.type=function(){return"mesh_lambert_builder"},t.prototype.initialize_node=function(){var e=this;this.params.set_post_create_params_hook((function(){e.texture_map_controller.initialize_node(),e.texture_alpha_map_controller.initialize_node()}))},t.prototype._create_assembler_controller=function(){return new p.GlAssemblerController(this,l.ShaderAssemblerLambert)},t.prototype.cook=function(){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(e){switch(e.label){case 0:return[4,this.compile_if_required()];case 1:return e.sent(),i.ColorsController.update(this),a.SideController.update(this),s.SkinningController.update(this),[4,_.TextureMapController.update(this)];case 2:return e.sent(),[4,u.TextureAlphaMapController.update(this)];case 3:return e.sent(),this.set_material(this.material),[2]}}))}))},t}(c.TypedBuilderMatNode);t.MeshLambertBuilderMatNode=f},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(23),i=n(26),a=n(37),s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),Object.defineProperty(t.prototype,"_template_shader",{get:function(){var e=a.ShaderLib.lambert;return{vertexShader:e.vertexShader,fragmentShader:e.fragmentShader,uniforms:e.uniforms}},enumerable:!0,configurable:!0}),t.prototype.create_material=function(){var e=this._template_shader,t=new i.ShaderMaterial({lights:!0,uniforms:o.UniformsUtils.clone(e.uniforms),vertexShader:e.vertexShader,fragmentShader:e.fragmentShader});return this._add_custom_materials(t),t},t}(n(274).ShaderAssemblerMesh);t.ShaderAssemblerLambert=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(5),i=n(198),a=n(105),s=n(116),_=n(117),u=n(118),c=n(375),p=n(199),l=n(132),d=n(777),f=n(374),h=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.metalness=o.ParamConfig.FLOAT(f.SHADER_DEFAULTS.metalness,{cook:!1,callback:function(e,t){return m._update_metalness(e)}}),t.roughness=o.ParamConfig.FLOAT(f.SHADER_DEFAULTS.roughness,{cook:!1,callback:function(e,t){return m._update_roughness(e)}}),t}return r.__extends(t,e),t}(c.TextureEnvMapParamConfig(u.TextureAlphaMapParamConfig(_.TextureMapParamConfig(s.SkinningParamConfig(a.SideParamConfig(i.ColorParamConfig(o.NodeParamsConfig)))))))),m=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=h,t.texture_map_controller=new _.TextureMapController(t,{uniforms:!0}),t.texture_alpha_map_controller=new u.TextureAlphaMapController(t,{uniforms:!0}),t.texture_env_map_controller=new c.TextureEnvMapController(t,{uniforms:!0,direct_params:!0,define:!1}),t}return r.__extends(t,e),t.type=function(){return"mesh_standard_builder"},t.prototype.initialize_node=function(){var e=this;this.params.set_post_create_params_hook((function(){e.texture_map_controller.initialize_node(),e.texture_alpha_map_controller.initialize_node(),e.texture_env_map_controller.initialize_node()}))},t.prototype._create_assembler_controller=function(){return new l.GlAssemblerController(this,d.ShaderAssemblerStandard)},t.prototype.cook=function(){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(e){switch(e.label){case 0:return[4,this.compile_if_required()];case 1:return e.sent(),i.ColorsController.update(this),a.SideController.update(this),s.SkinningController.update(this),[4,_.TextureMapController.update(this)];case 2:return e.sent(),[4,u.TextureAlphaMapController.update(this)];case 3:return e.sent(),[4,c.TextureEnvMapController.update(this)];case 4:return e.sent(),this._material&&(this._material.uniforms.envMapIntensity.value=this.pv.env_map_intensity,t._update_metalness(this),t._update_roughness(this)),this.set_material(this.material),[2]}}))}))},t._update_metalness=function(e){e.material.uniforms.metalness.value=e.pv.metalness},t._update_roughness=function(e){e.material.uniforms.roughness.value=e.pv.roughness},t}(p.TypedBuilderMatNode);t.MeshStandardBuilderMatNode=m},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(23),i=n(26),a=n(37),s=n(274),_=n(158),u=n(194),c=n(195),p=r.__importDefault(n(778)),l=r.__importDefault(n(779)),d=n(50),f=n(24),h=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.is_physical=function(){return!1},Object.defineProperty(t.prototype,"_template_shader",{get:function(){var e=this.is_physical()?a.ShaderLib.physical:a.ShaderLib.standard;return{vertexShader:e.vertexShader,fragmentShader:e.fragmentShader,uniforms:e.uniforms}},enumerable:!0,configurable:!0}),t.prototype.create_material=function(){var e=this._template_shader,t={lights:!0,extensions:{derivatives:!0},uniforms:o.UniformsUtils.clone(e.uniforms),vertexShader:e.vertexShader,fragmentShader:e.fragmentShader},n=new i.ShaderMaterial(t);return n.onBeforeCompile=function(e){e.fragmentShader=e.fragmentShader.replace("#include <metalnessmap_fragment>",p.default),e.fragmentShader=e.fragmentShader.replace("#include <roughnessmap_fragment>",l.default)},this._add_custom_materials(n),n},t.prototype.add_output_params=function(e){_.BaseGlShaderAssembler.add_output_params(e),e.add_param(f.ParamType.FLOAT,"metalness",1),e.add_param(f.ParamType.FLOAT,"roughness",1)},t.prototype.create_shader_configs=function(){return[new u.ShaderConfig(d.ShaderName.VERTEX,["position","normal","uv"],[]),new u.ShaderConfig(d.ShaderName.FRAGMENT,["color","alpha","metalness","roughness"],[d.ShaderName.VERTEX])]},t.prototype.create_variable_configs=function(){return _.BaseGlShaderAssembler.create_variable_configs().concat([new c.VariableConfig("metalness",{default:"1.0",prefix:"float POLY_metalness = "}),new c.VariableConfig("roughness",{default:"1.0",prefix:"float POLY_roughness = "})])},t}(s.ShaderAssemblerMesh);t.ShaderAssemblerStandard=h},function(e,t,n){"use strict";n.r(t),t.default="float metalnessFactor = metalness * POLY_metalness;\n\n#ifdef USE_METALNESSMAP\n\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\n\t// reads channel B, compatible with a combined OcclusionRoughnessMetallic (RGB) texture\n\tmetalnessFactor *= texelMetalness.b;\n\n#endif\n"},function(e,t,n){"use strict";n.r(t),t.default="float roughnessFactor = roughness * POLY_roughness;\n\n#ifdef USE_ROUGHNESSMAP\n\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\n\t// reads channel G, compatible with a combined OcclusionRoughnessMetallic (RGB) texture\n\troughnessFactor *= texelRoughness.g;\n\n#endif\n"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(71),i=n(0),a=n(68),s=n(197),_=n(105),u=n(5);function c(e){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.size=u.ParamConfig.FLOAT(1),t.size_attenuation=u.ParamConfig.BOOLEAN(1),t}return r.__extends(t,e),t}(e)}t.PointsParamConfig=c;var p=new(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t}(_.SideParamConfig(s.ColorParamConfig(c(u.NodeParamsConfig))))),l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=p,t}return r.__extends(t,e),t.type=function(){return"points"},t.prototype.create_material=function(){return new o.PointsMaterial({vertexColors:!1,side:i.FrontSide,color:16777215,opacity:1})},t.prototype.cook=function(){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(e){return s.ColorsController.update(this),_.SideController.update(this),this.material.size=this.pv.size,this.material.sizeAttenuation=this.pv.size_attenuation,this.set_material(this.material),[2]}))}))},t}(a.TypedMatNode);t.PointsMatNode=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(23),i=n(26),a=n(37),s=n(106),_=n(194),u=n(195),c=n(158),p=n(782),l=n(784),d=n(786),f=n(24),h=n(33),m=n(16),y=n(50),v=new Map([[y.ShaderName.VERTEX,["#include <begin_vertex>","gl_PointSize = size;"]],[y.ShaderName.FRAGMENT,[]]]),g=new Map;g.set(s.CustomMaterialName.DISTANCE,l.ShaderAssemblerCustomPointsDistance),g.set(s.CustomMaterialName.DEPTH,p.ShaderAssemblerCustomPointsDepth),g.set(s.CustomMaterialName.DEPTH_DOF,d.ShaderAssemblerCustomPointsDepthDOF);var b=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.custom_assembler_class_by_custom_name=function(){return g},Object.defineProperty(t.prototype,"_template_shader",{get:function(){var e=a.ShaderLib.points;return{vertexShader:e.vertexShader,fragmentShader:e.fragmentShader,uniforms:e.uniforms}},enumerable:!0,configurable:!0}),t.prototype.create_material=function(){var e=this._template_shader,t=new i.ShaderMaterial({transparent:!0,fog:!0,defines:{USE_SIZEATTENUATION:1},uniforms:o.UniformsUtils.clone(e.uniforms),vertexShader:e.vertexShader,fragmentShader:e.fragmentShader});return this._add_custom_materials(t),t},t.prototype.add_output_params=function(e){c.BaseGlShaderAssembler.add_output_params(e),e.add_param(f.ParamType.FLOAT,"gl_PointSize",1)},t.prototype.create_globals_node_output_connections=function(){return c.BaseGlShaderAssembler.create_globals_node_output_connections().concat([new h.TypedNamedConnectionPoint("gl_PointCoord",m.ConnectionPointType.VEC2)])},t.prototype.create_shader_configs=function(){return[new _.ShaderConfig(y.ShaderName.VERTEX,["position","normal","uv","gl_PointSize"],[]),new _.ShaderConfig(y.ShaderName.FRAGMENT,["color","alpha"],[y.ShaderName.VERTEX])]},t.prototype.create_variable_configs=function(){return c.BaseGlShaderAssembler.create_variable_configs().concat([new u.VariableConfig("gl_PointSize",{default:"1.0",prefix:"gl_PointSize = ",suffix:" * size * 10.0"})])},t.prototype.lines_to_remove=function(e){return v.get(e)},t}(s.ShaderAssemblerMaterial);t.ShaderAssemblerPoints=b},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(23),i=n(26),a=n(37),s=n(0),_=n(0),u=n(106),c=r.__importDefault(n(783)),p=n(50),l=new Map([[p.ShaderName.VERTEX,"// INSERT DEFINES"]]),d=new Map([[p.ShaderName.VERTEX,"// INSERT BODY"]]),f=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),Object.defineProperty(t.prototype,"_template_shader",{get:function(){var e=a.ShaderLib.depth,t=o.UniformsUtils.clone(e.uniforms);return t.size={value:1},t.scale={value:1},{vertexShader:c.default,fragmentShader:e.fragmentShader,uniforms:t}},enumerable:!0,configurable:!0}),t.prototype.insert_define_after=function(e){return l.get(e)},t.prototype.insert_body_after=function(e){return d.get(e)},t.prototype.create_material=function(){var e=this._template_shader;return new i.ShaderMaterial({defines:{USE_SIZEATTENUATION:1,DEPTH_PACKING:[s.RGBADepthPacking,_.BasicDepthPacking][0]},uniforms:o.UniformsUtils.clone(e.uniforms),vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})},t}(u.ShaderAssemblerMaterial);t.ShaderAssemblerCustomPointsDepth=f},function(e,t,n){"use strict";n.r(t),t.default="uniform float size;\nuniform float scale;\n#include <common>\n#include <clipping_planes_pars_vertex>\nvarying float vViewZDepth;\n\n// INSERT DEFINES\n\n\n\nvoid main() {\n\n\t// INSERT BODY\n\n\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\n\tvViewZDepth = - mvPosition.z;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\n}\n\n\n"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(23),i=n(26),a=n(37),s=n(0),_=n(0),u=n(106),c=r.__importDefault(n(785)),p=n(50),l=new Map([[p.ShaderName.VERTEX,"// INSERT DEFINES"]]),d=new Map([[p.ShaderName.VERTEX,"// INSERT BODY"]]),f=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),Object.defineProperty(t.prototype,"_template_shader",{get:function(){var e=a.ShaderLib.distanceRGBA,t=o.UniformsUtils.clone(e.uniforms);return t.size={value:1},t.scale={value:1},{vertexShader:c.default,fragmentShader:e.fragmentShader,uniforms:t}},enumerable:!0,configurable:!0}),t.prototype.insert_define_after=function(e){return l.get(e)},t.prototype.insert_body_after=function(e){return d.get(e)},t.prototype.create_material=function(){var e=this._template_shader;return new i.ShaderMaterial({defines:{USE_SIZEATTENUATION:1,DEPTH_PACKING:[s.RGBADepthPacking,_.BasicDepthPacking][0]},uniforms:o.UniformsUtils.clone(e.uniforms),vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})},t}(u.ShaderAssemblerMaterial);t.ShaderAssemblerCustomPointsDistance=f},function(e,t,n){"use strict";n.r(t),t.default="uniform float size;\nuniform float scale;\n#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <clipping_planes_pars_vertex>\nvarying float vViewZDepth;\n\n// INSERT DEFINES\n\n\n\nvoid main() {\n\n\t// INSERT BODY\n\n\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\tvWorldPosition = worldPosition.xyz;\n}\n\n// #define DISTANCE\n// varying vec3 vWorldPosition;\n// #include <common>\n// #include <uv_pars_vertex>\n// #include <displacementmap_pars_vertex>\n// #include <morphtarget_pars_vertex>\n// #include <skinning_pars_vertex>\n// #include <clipping_planes_pars_vertex>\n// void main() {\n// \t#include <uv_vertex>\n// \t#include <skinbase_vertex>\n// \t#ifdef USE_DISPLACEMENTMAP\n// \t\t#include <beginnormal_vertex>\n// \t\t#include <morphnormal_vertex>\n// \t\t#include <skinnormal_vertex>\n// \t#endif\n// \t#include <begin_vertex>\n// \t#include <morphtarget_vertex>\n// \t#include <skinning_vertex>\n// \t#include <displacementmap_vertex>\n// \t#include <project_vertex>\n// \t#include <worldpos_vertex>\n// \t#include <clipping_planes_vertex>\n// \tvWorldPosition = worldPosition.xyz;\n// }\n\n\n"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(23),i=n(26),a=n(106),s=r.__importDefault(n(787)),_=r.__importDefault(n(373)),u=n(50),c=new Map([[u.ShaderName.VERTEX,"// INSERT DEFINES"]]),p=new Map([[u.ShaderName.VERTEX,"// INSERT BODY"]]),l=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),Object.defineProperty(t.prototype,"_template_shader",{get:function(){return{vertexShader:s.default,fragmentShader:_.default,uniforms:{size:{value:1},scale:{value:1},mNear:{value:0},mFar:{value:10}}}},enumerable:!0,configurable:!0}),t.prototype.insert_define_after=function(e){return c.get(e)},t.prototype.insert_body_after=function(e){return p.get(e)},t.prototype.create_material=function(){var e=this._template_shader;return new i.ShaderMaterial({depthTest:!0,defines:{USE_SIZEATTENUATION:1},uniforms:o.UniformsUtils.clone(e.uniforms),vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})},t}(a.ShaderAssemblerMaterial);t.ShaderAssemblerCustomPointsDepthDOF=l},function(e,t,n){"use strict";n.r(t),t.default="uniform float size;\nuniform float scale;\n#include <common>\n\nvarying float vViewZDepth;\n\n// INSERT DEFINES\n\n\n\nvoid main() {\n\n\t// INSERT BODY\n\n\n\t#include <project_vertex>\n\n\tvViewZDepth = - mvPosition.z;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\n}\n\n"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(130),o=n(789),i=n(791),a=n(793),s=n(795),_=n(797),u=n(799),c=n(801),p=n(802),l=n(803),d=n(804),f=n(805),h=n(807),m=n(809),y=n(810),v=n(811),g=n(822),b=function(){function e(){}return e.run=function(e){e.register_node(o.AmbientLightObjNode,r.CATEGORY_OBJ.LIGHT),e.register_node(i.AreaLightObjNode,r.CATEGORY_OBJ.LIGHT),e.register_node(a.DirectionalLightObjNode,r.CATEGORY_OBJ.LIGHT),e.register_node(s.HemisphereLightObjNode,r.CATEGORY_OBJ.LIGHT),e.register_node(_.PointLightObjNode,r.CATEGORY_OBJ.LIGHT),e.register_node(u.SpotLightObjNode,r.CATEGORY_OBJ.LIGHT),e.register_node(c.EventsObjNode,r.CATEGORY_OBJ.MANAGER),e.register_node(p.MaterialsObjNode,r.CATEGORY_OBJ.MANAGER),e.register_node(l.CopObjNode,r.CATEGORY_OBJ.MANAGER),e.register_node(d.PostProcessObjNode,r.CATEGORY_OBJ.MANAGER),e.register_node(f.GeoObjNode,r.CATEGORY_OBJ.GEOMETRY),e.register_node(h.NullObjNode,r.CATEGORY_OBJ.GEOMETRY),e.register_node(y.SceneObjNode,r.CATEGORY_OBJ.MISC),e.register_node(v.OrthographicCameraObjNode,r.CATEGORY_OBJ.CAMERA),e.register_node(g.PerspectiveCameraObjNode,r.CATEGORY_OBJ.CAMERA),e.register_node(m.FogObjNode,r.CATEGORY_OBJ.MISC)},e}();t.ObjRegister=b},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(287),i=n(275),a=n(5),s=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.color=a.ParamConfig.COLOR([1,1,1]),t.intensity=a.ParamConfig.FLOAT(1),t}return r.__extends(t,e),t}(a.NodeParamsConfig)),_=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=s,t}return r.__extends(t,e),t.type=function(){return"ambient_light"},t.prototype.create_light=function(){return new o.AmbientLight},t.prototype.initialize_node=function(){this.io.inputs.set_count(0,1)},t.prototype.update_light_params=function(){this.light.color=this.pv.color,this.light.intensity=this.pv.intensity},t}(i.TypedLightObjNode);t.AmbientLightObjNode=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.set_content=function(t){e.prototype.set_content.call(this,t)},t.prototype.set_object=function(e){return this.set_content(e)},t.prototype.has_object=function(){return this.has_content()},t.prototype.object=function(){return this.content()},t}(n(115).TypedContainer);t.ObjectContainer=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(288),i=n(792),a=n(200),s=n(83),_=n(5);function u(e){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.color=_.ParamConfig.COLOR([1,1,1]),t.intensity=_.ParamConfig.FLOAT(1,{range:[0,10]}),t.width=_.ParamConfig.FLOAT(1,{range:[0,10]}),t.height=_.ParamConfig.FLOAT(1,{range:[0,10]}),t}return r.__extends(t,e),t}(e)}t.AreaLightParamConfig=u;var c=new(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t}(u(s.TransformedParamConfig(_.NodeParamsConfig)))),p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=c,t}return r.__extends(t,e),t.type=function(){return"area_light"},t.prototype.create_light=function(){return new o.RectAreaLight(16777215,1,1,1)},t.prototype.update_light_params=function(){this.light.color=this.pv.color,this.light.intensity=this.pv.intensity,this.light.width=this.pv.width,this.light.height=this.pv.height},t.prototype.cook=function(){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(e){return i.RectAreaLightUniformsLib.initialized||(i.RectAreaLightUniformsLib.init(),i.RectAreaLightUniformsLib.initialized=!0),this.transform_controller.update(),this.update_light_params(),this.update_shadow_params(),this.cook_controller.end_cook(),[2]}))}))},t}(a.BaseLightTransformedObjNode);t.AreaLightObjNode=p},,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(163),i=n(794),a=n(5),s=n(202),_=n(200),u=n(83);function c(e){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.light=a.ParamConfig.FOLDER(),t.color=a.ParamConfig.COLOR([1,1,1]),t.intensity=a.ParamConfig.FLOAT(1),t.distance=a.ParamConfig.FLOAT(100,{range:[0,100]}),t.cast_shadows=a.ParamConfig.BOOLEAN(1),t.shadow_res=a.ParamConfig.VECTOR2([1024,1024]),t.shadow_bias=a.ParamConfig.FLOAT(.001),t.show_helper=a.ParamConfig.BOOLEAN(1),t.helper_size=a.ParamConfig.FLOAT(1,{visible_if:{show_helper:1}}),t}return r.__extends(t,e),t}(e)}t.DirectionalLightParamConfig=c;var p=new(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t}(c(u.TransformedParamConfig(a.NodeParamsConfig)))),l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=p,t._helper_controller=new s.HelperController(t,i.DirectionalLightHelper,"DirectionalLightHelper"),t}return r.__extends(t,e),t.type=function(){return"directional_light"},t.prototype.initialize_node=function(){this._helper_controller.initialize_node()},t.prototype.create_light=function(){var e=new o.DirectionalLight;return e.castShadow=!0,e.shadow.bias=-.001,e.shadow.mapSize.x=1024,e.shadow.mapSize.y=1024,e.shadow.camera.near=.1,this._target_target=e.target,this._target_target.name="DirectionalLight Default Target",this.object.add(this._target_target),e},t.prototype.update_light_params=function(){this.light.color=this.pv.color,this.light.intensity=this.pv.intensity,this.light.shadow.camera.far=this.pv.distance,this._helper_controller.update()},t.prototype.update_shadow_params=function(){this.light.castShadow=this.pv.cast_shadows,this.light.shadow.mapSize.copy(this.pv.shadow_res),this.light.shadow.bias=this.pv.shadow_bias,this.light.shadow.camera.updateProjectionMatrix()},t}(_.BaseLightTransformedObjNode);t.DirectionalLightObjNode=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(4),i=n(6),a=n(41),s=n(201),_=n(76),u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._square=new _.Line,t._line_material=new a.LineBasicMaterial({fog:!1}),t}return r.__extends(t,e),t.prototype.build_helper=function(){var e=new i.BufferGeometry;e.setAttribute("position",new o.Float32BufferAttribute([-1,1,0,1,1,0,1,-1,0,-1,-1,0,-1,1,0],3)),this._square.geometry=e,this._square.material=this._line_material,this._square.rotateX(.5*Math.PI),this.object.add(this._square)},t.prototype.update=function(){this._object.scale.setScalar(this.node.pv.helper_size),this._line_material.color.copy(this.node.light.color)},t}(s.BaseLightHelper);t.DirectionalLightHelper=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(289),i=n(796),a=n(275),s=n(5),_=n(202),u=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.sky_color=s.ParamConfig.COLOR([.2,.7,1]),t.ground_color=s.ParamConfig.COLOR([.1,.1,.25]),t.intensity=s.ParamConfig.FLOAT(1),t.position=s.ParamConfig.VECTOR3([0,1,0]),t.show_helper=s.ParamConfig.BOOLEAN(1),t.helper_size=s.ParamConfig.FLOAT(1,{visible_if:{show_helper:1}}),t}return r.__extends(t,e),t}(s.NodeParamsConfig)),c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=u,t._helper_controller=new _.HelperController(t,i.HemisphereLightHelper,"HemisphereLightHelper"),t}return r.__extends(t,e),t.type=function(){return"hemisphere_light"},t.prototype.create_light=function(){return new o.HemisphereLight},t.prototype.initialize_node=function(){this.io.inputs.set_count(0,1),this._helper_controller.initialize_node()},t.prototype.update_light_params=function(){this.light.color=this.pv.sky_color,this.light.groundColor=this.pv.ground_color,this.light.position.copy(this.pv.position),this.light.intensity=this.pv.intensity,this._helper_controller.update()},t}(a.TypedLightObjNode);t.HemisphereLightObjNode=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(7),i=n(203),a=n(4),s=n(42),_=n(1),u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._geometry=new i.OctahedronBufferGeometry(1),t._quat=new s.Quaternion,t._default_position=new _.Vector3(0,1,0),t._color1=new o.Color,t._color2=new o.Color,t}return r.__extends(t,e),t.prototype.build_helper=function(){this._geometry.rotateZ(.5*Math.PI),this._material.vertexColors=!0;var e=this._geometry.getAttribute("position"),t=new Float32Array(3*e.count);this._geometry.setAttribute("color",new a.BufferAttribute(t,3)),this._object.geometry=this._geometry,this._object.material=this._material},t.prototype.update=function(){if(this.node.pv.position){this._object.position.copy(this.node.pv.position).multiplyScalar(-1),this._quat.setFromUnitVectors(this._default_position,this.node.pv.position),this._object.setRotationFromQuaternion(this._quat),this._object.scale.setScalar(this.node.pv.helper_size);var e=this._geometry.getAttribute("color");this._color1.copy(this.node.light.color),this._color2.copy(this.node.light.groundColor);for(var t=0,n=e.count;t<n;t++){var r=t<n/2?this._color1:this._color2;e.setXYZ(t,r.r,r.g,r.b)}e.needsUpdate=!0}},t}(n(201).BaseLightHelper);t.HemisphereLightHelper=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(164),i=n(798),a=n(200),s=n(83),_=n(5),u=n(202),c=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.light=_.ParamConfig.FOLDER(),t.color=_.ParamConfig.COLOR([1,1,1]),t.intensity=_.ParamConfig.FLOAT(1),t.decay=_.ParamConfig.FLOAT(.1),t.distance=_.ParamConfig.FLOAT(100),t.cast_shadows=_.ParamConfig.BOOLEAN(1),t.shadow_res=_.ParamConfig.VECTOR2([1024,1024],{visible_if:{cast_shadows:1}}),t.shadow_bias=_.ParamConfig.FLOAT(.001,{visible_if:{cast_shadows:1}}),t.shadow_near=_.ParamConfig.FLOAT(1,{visible_if:{cast_shadows:1}}),t.shadow_far=_.ParamConfig.FLOAT(100,{visible_if:{cast_shadows:1}}),t.show_helper=_.ParamConfig.BOOLEAN(1),t.helper_size=_.ParamConfig.FLOAT(1,{visible_if:{show_helper:1}}),t}return r.__extends(t,e),t}(s.TransformedParamConfig(_.NodeParamsConfig))),p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=c,t._helper_controller=new u.HelperController(t,i.PointLightHelper,"PointLightHelper"),t}return r.__extends(t,e),t.type=function(){return"point_light"},t.prototype.initialize_node=function(){this._helper_controller.initialize_node()},t.prototype.create_light=function(){var e=new o.PointLight;return e.castShadow=!0,e.shadow.bias=-.001,e.shadow.mapSize.x=1024,e.shadow.mapSize.y=1024,e.shadow.camera.near=.1,e},t.prototype.update_light_params=function(){this.light.color=this.pv.color,this.light.intensity=this.pv.intensity,this.light.decay=this.pv.decay,this.light.distance=this.pv.distance,this._helper_controller.update()},t.prototype.update_shadow_params=function(){this.light.castShadow=this.pv.cast_shadows,this.light.shadow.mapSize.copy(this.pv.shadow_res),this.light.shadow.camera.near=this.pv.shadow_near,this.light.shadow.camera.far=this.pv.shadow_far,this.light.shadow.bias=this.pv.shadow_bias},t}(a.BaseLightTransformedObjNode);t.PointLightObjNode=p},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(161),i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.build_helper=function(){this._object.geometry=new o.SphereBufferGeometry(1,4,2),this._object.material=this._material},t.prototype.update=function(){this._object.scale.setScalar(this.node.pv.helper_size),this._material.color.copy(this.node.light.color)},t}(n(201).BaseLightHelper);t.PointLightHelper=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(165),i=n(200),a=n(83),s=n(5),_=n(202),u=n(800),c=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.light=s.ParamConfig.FOLDER(),t.color=s.ParamConfig.COLOR([1,1,1]),t.intensity=s.ParamConfig.FLOAT(1),t.angle=s.ParamConfig.FLOAT(45,{range:[0,180]}),t.penumbra=s.ParamConfig.FLOAT(.1),t.decay=s.ParamConfig.FLOAT(.1,{range:[0,1]}),t.distance=s.ParamConfig.FLOAT(100,{range:[0,100]}),t.cast_shadows=s.ParamConfig.BOOLEAN(1),t.shadow_res=s.ParamConfig.VECTOR2([1024,1024]),t.shadow_bias=s.ParamConfig.FLOAT(.001),t.show_helper=s.ParamConfig.BOOLEAN(1),t.helper_size=s.ParamConfig.FLOAT(1,{visible_if:{show_helper:1}}),t}return r.__extends(t,e),t}(a.TransformedParamConfig(s.NodeParamsConfig))),p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=c,t._helper_controller=new _.HelperController(t,u.SpotLightHelper,"SpotLightHelper"),t}return r.__extends(t,e),t.type=function(){return"spot_light"},t.prototype.initialize_node=function(){this._helper_controller.initialize_node()},t.prototype.create_light=function(){var e=new o.SpotLight;return e.castShadow=!0,e.shadow.bias=-.001,e.shadow.mapSize.x=1024,e.shadow.mapSize.y=1024,e.shadow.camera.near=.1,this._target_target=e.target,this._target_target.name="SpotLight Default Target",this.object.add(this._target_target),e},t.prototype.update_light_params=function(){this.light.color=this.pv.color,this.light.intensity=this.pv.intensity,this.light.angle=this.pv.angle*(Math.PI/180),this.light.penumbra=this.pv.penumbra,this.light.decay=this.pv.decay,this.light.distance=this.pv.distance,this._helper_controller.update()},t.prototype.update_shadow_params=function(){this.light.castShadow=this.pv.cast_shadows,this.light.shadow.mapSize.copy(this.pv.shadow_res),this.light.shadow.bias=this.pv.shadow_bias},t}(i.BaseLightTransformedObjNode);t.SpotLightObjNode=p},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(201),i=n(6),a=n(4),s=n(41),_=n(57),u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._cone=new _.LineSegments,t._line_material=new s.LineBasicMaterial({fog:!1}),t}return r.__extends(t,e),t.prototype.build_helper=function(){for(var e=new i.BufferGeometry,t=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1],n=0,r=1;n<32;n++,r++){var o=n/32*Math.PI*2,s=r/32*Math.PI*2;t.push(Math.cos(o),Math.sin(o),1,Math.cos(s),Math.sin(s),1)}e.setAttribute("position",new a.Float32BufferAttribute(t,3)),this._cone.geometry=e,this._cone.material=this._line_material,this._cone.rotateX(.5*Math.PI),this.object.add(this._cone)},t.prototype.update=function(){var e=(this.node.light.distance?this.node.light.distance:1e3)*this.node.pv.helper_size,t=e*Math.tan(this.node.light.angle);this._cone.scale.set(t,t,e),this._line_material.color.copy(this.node.light.color)},t}(o.BaseLightHelper);t.SpotLightHelper=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(204),i=n(27),a=n(69),s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.render_order=a.ObjNodeRenderOrder.EVENT,t._children_controller_context=i.NodeContext.EVENT,t}return r.__extends(t,e),t.type=function(){return"events"},t.prototype.initialize_node=function(){var e;null===(e=this.children_controller)||void 0===e||e.init()},t.prototype.create_node=function(t){return e.prototype.create_node.call(this,t)},t.prototype.children=function(){return e.prototype.children.call(this)},t.prototype.nodes_by_type=function(t){return e.prototype.nodes_by_type.call(this,t)},t}(o.BaseManagerObjNode);t.EventsObjNode=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(204),i=n(27),a=n(69),s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.render_order=a.ObjNodeRenderOrder.MAT,t._children_controller_context=i.NodeContext.MAT,t}return r.__extends(t,e),t.type=function(){return"materials"},t.prototype.initialize_node=function(){var e;null===(e=this.children_controller)||void 0===e||e.init()},t.prototype.create_node=function(t){return e.prototype.create_node.call(this,t)},t.prototype.children=function(){return e.prototype.children.call(this)},t.prototype.nodes_by_type=function(t){return e.prototype.nodes_by_type.call(this,t)},t}(o.BaseManagerObjNode);t.MaterialsObjNode=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(204),i=n(27),a=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._children_controller_context=i.NodeContext.COP,t}return r.__extends(t,e),t.type=function(){return"cop"},t.prototype.initialize_node=function(){var e;null===(e=this.children_controller)||void 0===e||e.init()},t.prototype.create_node=function(t){return e.prototype.create_node.call(this,t)},t.prototype.children=function(){return e.prototype.children.call(this)},t.prototype.nodes_by_type=function(t){return e.prototype.nodes_by_type.call(this,t)},t}(o.BaseManagerObjNode);t.CopObjNode=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(204),i=n(27),a=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._children_controller_context=i.NodeContext.POST,t}return r.__extends(t,e),t.type=function(){return"post_process"},t.prototype.initialize_node=function(){var e;null===(e=this.children_controller)||void 0===e||e.init()},t}(o.BaseManagerObjNode);t.PostProcessObjNode=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(69),i=n(40),a=n(806),s=n(27),_=n(83),u=n(94),c=n(5),p=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.display=c.ParamConfig.BOOLEAN(1),t}return r.__extends(t,e),t}(_.TransformedParamConfig(c.NodeParamsConfig))),l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=p,t.transform_controller=new _.TransformController(t),t._display_node_controller=new a.DisplayNodeController(t),t.flags=new u.FlagsControllerD(t),t._sop_group=t._create_sop_group(),t._children_controller_context=s.NodeContext.SOP,t._on_create_bound=t._on_create.bind(t),t._on_child_add_bound=t._on_child_add.bind(t),t}return r.__extends(t,e),t.type=function(){return"geo"},Object.defineProperty(t.prototype,"display_node_controller",{get:function(){return this._display_node_controller},enumerable:!0,configurable:!0}),t.prototype._create_sop_group=function(){return new i.Group},Object.defineProperty(t.prototype,"sop_group",{get:function(){return this._sop_group},enumerable:!0,configurable:!0}),t.prototype.set_sop_group_name=function(){this._sop_group.name=this.full_path()+":sop_group"},t.prototype.initialize_node=function(){var e;null===(e=this.children_controller)||void 0===e||e.init(),this.lifecycle.add_on_create_hook(this._on_create_bound),this.lifecycle.add_on_child_add_hook(this._on_child_add_bound),this.display_node_controller.initialize_node(),this.transform_controller.initialize_node(),this.object.add(this.sop_group),this.name_controller.add_post_set_full_path_hook(this.set_sop_group_name.bind(this)),this._create_sop_group()},t.prototype.create_object=function(){return new i.Group},t.prototype.request_display_node=function(){this.scene.loading_controller.auto_updating},t.prototype.is_display_node_cooking=function(){if(this.flags.display.active){var e=this._display_node_controller.display_node;return!!e&&e.is_dirty}return!1},t.prototype.create_node=function(t){return e.prototype.create_node.call(this,t)},t.prototype.children=function(){return e.prototype.children.call(this)},t.prototype.nodes_by_type=function(t){return e.prototype.nodes_by_type.call(this,t)},t.prototype._on_create=function(){this.create_node("text")},t.prototype._on_child_add=function(e){var t,n;this.scene.loading_controller.loaded&&1==this.children().length&&(null===(n=null===(t=e.flags)||void 0===t?void 0:t.display)||void 0===n||n.set(!0))},t.prototype.cook=function(){this.transform_controller.update(),this.object.visible=this.pv.display,this.cook_controller.end_cook()},t}(o.TypedObjNode);t.GeoObjNode=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(67),i=function(){function e(e){this.node=e,this._children_uuids_dict={},this._children_length=0,this._request_display_node_container_bound=this.request_display_node_container.bind(this),this._graph_node=new o.CoreGraphNode(e.scene,"DisplayNodeController"),this._graph_node.dirty_controller.add_post_dirty_hook("_request_display_node_container",this._request_display_node_container_bound)}return Object.defineProperty(e.prototype,"display_node",{get:function(){return this._display_node},enumerable:!0,configurable:!0}),e.prototype.set_parent_object=function(e){this._parent_object=e},Object.defineProperty(e.prototype,"parent_object",{get:function(){return this._parent_object||this.node.object},enumerable:!0,configurable:!0}),e.prototype.initialize_node=function(){var e=this;this.set_parent_object(this.node.sop_group),this.node.flags.display.add_hook((function(){e.node.sop_group.visible=e.used_in_scene,e.node.flags.display.active&&e.request_display_node_container()})),this.node.lifecycle.add_on_child_add_hook((function(t){var n,r;e._display_node||null===(r=null===(n=t.flags)||void 0===n?void 0:n.display)||void 0===r||r.set(!0)}))},e.prototype.set_display_node=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t;return r.__generator(this,(function(n){return this._display_node!=e&&((t=this._display_node)&&(t.flags.display.set(!1),this._graph_node.remove_graph_input(t),this.remove_children()),this._display_node=e,this._display_node&&this._graph_node.add_graph_input(this._display_node),this.request_display_node_container()),[2]}))}))},e.prototype.remove_children=function(){for(var e;e=this.parent_object.children.pop();)this.parent_object.remove(e)},Object.defineProperty(e.prototype,"used_in_scene",{get:function(){return this.node.used_in_scene&&this.node.flags.display.active&&1==this.node.pv.display},enumerable:!0,configurable:!0}),e.prototype.request_display_node_container=function(){return r.__awaiter(this,void 0,void 0,(function(){var e,t,n,o,i,a,s,_,u;return r.__generator(this,(function(r){switch(r.label){case 0:return this.node.scene.loading_controller.loaded?this.used_in_scene&&this._display_node?[4,this._display_node.request_container()]:[3,2]:[2];case 1:if(e=r.sent(),t=e.core_content()){if(n=t.objects(),!(o=n.length!=this._children_length))for(i=0,a=n;i<a.length;i++)(u=a[i]).uuid in this._children_uuids_dict||(o=!0);if(o){for(this.remove_children(),this._children_uuids_dict={},s=0,_=n;s<_.length;s++)u=_[s],this.parent_object.add(u),this._children_uuids_dict[u.uuid]=!0;this._children_length=n.length}}else this.remove_children(),this._children_uuids_dict={},this._children_length=0;r.label=2;case 2:return[2]}}))}))},e}();t.DisplayNodeController=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(69),i=n(40),a=n(83),s=n(94),_=n(808),u=n(5),c=new(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t}(a.TransformedParamConfig(u.NodeParamsConfig))),p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=c,t.transform_controller=new a.TransformController(t),t.flags=new s.FlagsControllerD(t),t._helper=new _.AxesHelper(1),t}return r.__extends(t,e),t.type=function(){return"null"},t.prototype.create_object=function(){return new i.Group},t.prototype.initialize_node=function(){var e=this;this.transform_controller.initialize_node(),this.object.add(this._helper),this.flags.display.add_hook((function(){e._helper.visible=e.flags.display.active}))},t.prototype.cook=function(){this.transform_controller.update(),this.cook_controller.end_cook()},t}(o.TypedObjNode);t.NullObjNode=p},,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(69),i=n(290),a=n(291),s={color:new(n(7).Color)(1,1,1),near:0,far:100,density:25e-5},_=n(5),u=n(94),c=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.color=_.ParamConfig.COLOR(s.color.toArray()),t.exponential=_.ParamConfig.BOOLEAN(0),t.density=_.ParamConfig.FLOAT(1),t.near=_.ParamConfig.FLOAT(0,{range:[0,100]}),t.far=_.ParamConfig.FLOAT(100,{range:[0,100]}),t}return r.__extends(t,e),t}(_.NodeParamsConfig)),p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=c,t.flags=new u.FlagsControllerD(t),t.render_order=o.ObjNodeRenderOrder.MANAGER,t._attachable_to_hierarchy=!1,t}return r.__extends(t,e),t.prototype.initialize_node=function(){this._linear_fog=new a.Fog(s.color.getHex(),s.near,s.far),this._linear_fogexp2=new i.FogExp2(s.color.getHex(),s.density)},t.type=function(){return"fog"},t.prototype.cook=function(){var e;this.pv.exponential?(this._linear_fogexp2.density=this.pv.density,e=this._linear_fogexp2):(this._linear_fog.near=this.pv.near,this._linear_fog.far=this.pv.far,e=this._linear_fog),e.color.copy(this.pv.color),this.scene.default_scene.fog=e,this.cook_controller.end_cook()},t}(o.TypedObjNode);t.FogObjNode=p},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(69),i=n(55),a=n(5),s=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.bg_color=a.ParamConfig.COLOR([0,0,0]),t}return r.__extends(t,e),t}(a.NodeParamsConfig)),_=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=s,t}return r.__extends(t,e),t.type=function(){return"scene"},t.prototype.create_object=function(){return new i.Scene},t.prototype.initialize_node=function(){e.prototype.initialize_node.call(this),this.io.outputs.set_has_one_output()},t.prototype.cook=function(){this.cook_controller.end_cook()},t}(o.TypedObjNode);t.SceneObjNode=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(63),i=n(377),a=n(821),s=-.5,_=.5,u=.5,c=-.5,p=n(5),l=n(206),d=n(136),f=n(205),h=n(83);function m(e){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.size=p.ParamConfig.FLOAT(1),t}return r.__extends(t,e),t}(e)}t.OrthographicCameraObjParamConfigMixin=m;var y=new(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t}(l.CameraPostProcessParamConfig(d.CameraBackgroundParamConfig(h.TransformedParamConfig(f.LayerParamConfig(m(i.CameraTransformParamConfig(p.NodeParamsConfig)))))))),v=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=y,t}return r.__extends(t,e),Object.defineProperty(t.prototype,"background_controller_constructor",{get:function(){return a.OrthographicCameraBackgroundController},enumerable:!0,configurable:!0}),t.type=function(){return"orthographic_camera"},t.prototype.create_object=function(){return new o.OrthographicCamera(2*s,2*_,2*u,2*c,i.BASE_CAMERA_DEFAULT.near,i.BASE_CAMERA_DEFAULT.far)},t.prototype.update_camera=function(){this._update_for_aspect_ratio()},t.prototype._update_for_aspect_ratio=function(){if(this._aspect){var e=this.pv.size||1,t=e*this._aspect;this._object.left=s*t*1,this._object.right=_*t*1,this._object.top=u*e*1,this._object.bottom=c*e*1,this._object.updateProjectionMatrix()}},t}(i.TypedCameraObjNode);t.OrthographicCameraObjNode=v},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(813),i=n(271),a=function(){function e(e){this.node=e,this._applied_controls_by_element_id={},this._controls_node=null}return e.prototype.controls_param=function(){return this.node.params.has("controls")?this.node.params.get("controls"):null},e.prototype.controls_node=function(){return r.__awaiter(this,void 0,void 0,(function(){var e,t,n;return r.__generator(this,(function(r){switch(r.label){case 0:return e=this.node.p.controls,(t=e.raw_input)&&""!=t?e.is_dirty?[4,e.compute()]:[3,2]:[3,3];case 1:r.sent(),r.label=2;case 2:if(n=e.found_node()){if(n instanceof i.CameraOrbitControlsEventNode)return[2,n];this.node.states.error.set("found node is not of a camera control type")}else this.node.states.error.set("no node has been found");r.label=3;case 3:return[2,null]}}))}))},e.prototype.update_controls=function(){return r.__awaiter(this,void 0,void 0,(function(){var e;return r.__generator(this,(function(t){switch(t.label){case 0:return[4,this.controls_node()];case 1:return(e=t.sent())&&this._controls_node!=e&&this.dispose_control_refs(),this._controls_node=e,[2]}}))}))},e.prototype.apply_controls=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,n,i,a,s;return r.__generator(this,(function(r){switch(r.label){case 0:return[4,this.controls_node()];case 1:return(t=r.sent())?(n=t.controls_id(),i=!1,this._applied_controls_by_element_id[e.id]&&this._applied_controls_by_element_id[e.id][n]&&(i=!0),i?[3,3]:(this._applied_controls_by_element_id[e.id]=this._applied_controls_by_element_id[e.id]||{},this._applied_controls_by_element_id[e.id][n]=!0,[4,t.apply_controls(this.node.object,e)])):[3,3];case 2:return a=r.sent(),s=new o.CameraControlsConfig(this.node.graph_node_id,t,a),t.set_from_camera_node(a,this.node),this.set_controls_events(a),[2,s];case 3:return[2]}}))}))},e.prototype.dispose_control_refs=function(){this._applied_controls_by_element_id={}},e.prototype.dispose_controls=function(e){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(t){return delete this._applied_controls_by_element_id[e.id],[2]}))}))},e.prototype.set_controls_events=function(e){var t=this;this.controls_start_listener=function(){t.on_controls_start(e)},this.controls_end_listener=function(){t.on_controls_end(e)},e.addEventListener("start",this.controls_start_listener),e.addEventListener("end",this.controls_end_listener)},e.prototype.on_controls_start=function(e){},e.prototype.on_controls_end=function(e){if(e.target){var t=e.target.toArray();this.node.params.set_vector3("target",t)}this.node.update_transform_params_from_object()},e}();t.ControlsController=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t,n){this._camera_node_id=e,this._controls_node=t,this._controls=n}return Object.defineProperty(e.prototype,"camera_node_id",{get:function(){return this._camera_node_id},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"controls",{get:function(){return this._controls},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"controls_node",{get:function(){return this._controls_node},enumerable:!0,configurable:!0}),e.prototype.is_equal=function(e){return e.camera_node_id==this._camera_node_id&&e.controls_node.graph_node_id==this._controls_node.graph_node_id},e}();t.CameraControlsConfig=r},function(e,t,n){"use strict";n.r(t),n.d(t,"RenderPass",(function(){return o}));var r=n(72),o=function(e,t,n,o,i){r.a.call(this),this.scene=e,this.camera=t,this.overrideMaterial=n,this.clearColor=o,this.clearAlpha=void 0!==i?i:0,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1};o.prototype=Object.assign(Object.create(r.a.prototype),{constructor:o,render:function(e,t,n){var r,o,i,a=e.autoClear;e.autoClear=!1,void 0!==this.overrideMaterial&&(i=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),this.clearColor&&(r=e.getClearColor().getHex(),o=e.getClearAlpha(),e.setClearColor(this.clearColor,this.clearAlpha)),this.clearDepth&&e.clearDepth(),e.setRenderTarget(this.renderToScreen?null:n),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),e.render(this.scene,this.camera),this.clearColor&&e.setClearColor(r,o),void 0!==this.overrideMaterial&&(this.scene.overrideMaterial=i),e.autoClear=a}})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(816),i=function(e){function t(t,n,r){var o=e.call(this,t,n,r)||this;return o._scene=n,o.do_render=!0,o._animate_method=o.animate.bind(o),o._canvas=document.createElement("canvas"),o._canvas.id=("canvas_id_"+Math.random()).replace(".","_"),o._canvas.style.display="block",o._canvas.style.outline="none",o._container.appendChild(o._canvas),o._container.classList.add("CoreThreejsViewer"),o._container.style.height="100%",o._set_events(),o}return r.__extends(t,e),t.prototype._build=function(){this._init_display(),this.activate()},t.prototype.dispose=function(){this._cancel_animate(),this.controls_controller.dispose_controls()},t.prototype._set_events=function(){var e=this;this.events_controller.init(),this.webgl_controller.init(),window.onresize=function(){e.cameras_controller.on_resize()}},t.prototype._init_display=function(){var e;if(this._canvas){this.cameras_controller.compute_size_and_aspect();var t=this.cameras_controller.size;null===(e=this.cameras_controller.camera_node)||void 0===e||e.post_process_controller.create_renderer(this._canvas,t),this.cameras_controller.prepare_current_camera(),this.animate()}},t.prototype.animate=function(){var e;this.do_render&&(this._scene.time_controller.increment_time_if_playing(),this.render(),null===(e=this._controls_controller)||void 0===e||e.update(),this._request_animation_frame_id=requestAnimationFrame(this._animate_method))},t.prototype._cancel_animate=function(){var e;this.do_render=!1,this._request_animation_frame_id&&cancelAnimationFrame(this._request_animation_frame_id),this._canvas&&(null===(e=this.cameras_controller.camera_node)||void 0===e||e.post_process_controller.delete_renderer(this._canvas))},t.prototype.render=function(){if(this.cameras_controller.camera_node&&this._canvas){var e=this.cameras_controller.size,t=this.cameras_controller.aspect;this.cameras_controller.camera_node.post_process_controller.render(this._canvas,e,t)}else console.warn("no camera to render with")},t}(o.BaseViewer);t.ThreejsViewer=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(817),i=n(818),a=n(819),s=n(820),_=function(){function e(e,t,n){var r=this;this._container=e,this._scene=t,this._active=!1,this._display_scene=this._scene.default_scene,this._init_from_scene(n).then((function(){r._build()}))}return Object.defineProperty(e.prototype,"active",{get:function(){return this._active},enumerable:!0,configurable:!0}),e.prototype.activate=function(){this._active=!0},e.prototype.deactivate=function(){this._active=!1},Object.defineProperty(e.prototype,"cameras_controller",{get:function(){return this._cameras_controller=this._cameras_controller||new o.CamerasController(this)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"controls_controller",{get:function(){return this._controls_controller=this._controls_controller||new i.ControlsController(this)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"events_controller",{get:function(){return this._events_controller=this._events_controller||new a.EventsController(this)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"webgl_controller",{get:function(){return this._webgl_controller=this._webgl_controller||new s.WebGLController(this)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"container",{get:function(){return this._container},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scene",{get:function(){return this._scene},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"canvas",{get:function(){return this._canvas},enumerable:!0,configurable:!0}),e.prototype._init_from_scene=function(e){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(t){switch(t.label){case 0:return[4,this.cameras_controller.set_camera_node(e||this._scene.cameras_controller.master_camera_node)];case 1:return t.sent(),[2]}}))}))},e.prototype.reset_container_class=function(){this.container.classList.remove("hovered")},e.prototype.set_container_class_hovered=function(){this.container.classList.add("hovered")},e}();t.BaseViewer=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(3),i=n(67),a=function(){function e(e){this.viewer=e,this._camera_node=null,this._size=new o.Vector2(100,100),this._aspect=1}return e.prototype.set_camera_node=function(e){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(t){switch(t.label){case 0:return this._camera_node&&e.graph_node_id==this._camera_node.graph_node_id?[3,2]:(this._camera_node=e,this._update_graph_node(),[4,this.viewer.controls_controller.create_controls()]);case 1:t.sent(),t.label=2;case 2:return[2]}}))}))},e.prototype._update_graph_node=function(){if(this._camera_node){var e=this._camera_node.params.get_operator_path("controls");e&&(this._graph_node=this._graph_node||this._create_graph_node(),this._graph_node&&(this._graph_node.graph_disconnect_predecessors(),this._graph_node.add_graph_input(e)))}},e.prototype._create_graph_node=function(){var e=this;if(this._camera_node){var t=new i.CoreGraphNode(this._camera_node.scene,"viewer-controls");return t.add_post_dirty_hook("this.viewer.controls_controller",(function(){return r.__awaiter(e,void 0,void 0,(function(){return r.__generator(this,(function(e){switch(e.label){case 0:return[4,this.viewer.controls_controller.create_controls()];case 1:return e.sent(),[2]}}))}))})),t}},Object.defineProperty(e.prototype,"camera_node",{get:function(){return this._camera_node},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"aspect",{get:function(){return this._aspect},enumerable:!0,configurable:!0}),e.prototype.on_resize=function(){var e;this.viewer.canvas&&(this.compute_size_and_aspect(),null===(e=this._camera_node)||void 0===e||e.post_process_controller.set_renderer_size(this.viewer.canvas,this._size),this.update_camera_aspect())},e.prototype.compute_size_and_aspect=function(){var e;this._update_size(),null===(e=this._camera_node)||void 0===e||e.scene.uniforms_controller.update_resolution_dependent_uniform_owners(this._size),this._aspect=this._get_aspect()},e.prototype._update_size=function(){this._size.x=this.viewer.container.offsetWidth,this._size.y=this.viewer.container.offsetHeight},e.prototype._get_aspect=function(){return this._size.x/this._size.y},e.prototype.update_camera_aspect=function(){var e;null===(e=this._camera_node)||void 0===e||e.setup_for_aspect_ratio(this._aspect)},e.prototype.prepare_current_camera=function(){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(e){switch(e.label){case 0:return this._camera_node?[4,this._camera_node.request_container()]:[3,3];case 1:return e.sent(),[4,this._update_from_camera_container()];case 2:e.sent(),e.label=3;case 3:return[2]}}))}))},e.prototype._update_from_camera_container=function(){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(e){switch(e.label){case 0:return this.update_camera_aspect(),[4,this.viewer.controls_controller.create_controls()];case 1:return e.sent(),[2]}}))}))},e}();t.CamerasController=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=function(){function e(e){this.viewer=e,this._active=!1,this._controls=null,this._bound_on_controls_start=this._on_controls_start.bind(this),this._bound_on_controls_end=this._on_controls_end.bind(this)}return Object.defineProperty(e.prototype,"active",{get:function(){return this._active},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"camera_node",{get:function(){return this.viewer.cameras_controller.camera_node},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"controls",{get:function(){return this._controls},enumerable:!0,configurable:!0}),e.prototype.create_controls=function(){var e;return r.__awaiter(this,void 0,void 0,(function(){var t;return r.__generator(this,(function(n){switch(n.label){case 0:return this.dispose_controls(),this.viewer.canvas?[4,null===(e=this.camera_node)||void 0===e?void 0:e.controls_controller.apply_controls(this.viewer.canvas)]:[2];case 1:return(t=n.sent())&&(this._controls=t.controls,this._controls&&(this.viewer.active?(this._controls.addEventListener("start",this._bound_on_controls_start),this._controls.addEventListener("end",this._bound_on_controls_end)):this.dispose_controls())),[2]}}))}))},e.prototype.update=function(){this._controls&&this._controls.update()},e.prototype.dispose_controls=function(){var e;this._controls&&(this.viewer.canvas&&(null===(e=this.camera_node)||void 0===e||e.controls_controller.dispose_controls(this.viewer.canvas)),this._bound_on_controls_start&&this._controls.removeEventListener("start",this._bound_on_controls_start),this._bound_on_controls_end&&this._controls.removeEventListener("end",this._bound_on_controls_end),this._controls.dispose(),this._controls=null)},e.prototype._on_controls_start=function(){this._active=!0},e.prototype._on_controls_end=function(){this._active=!1},e}();t.ControlsController=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this.viewer=e,this._bound_on_mousedown=this._on_mousedown.bind(this),this._bound_on_mousemove=this._on_mousemove.bind(this),this._bound_on_mouseup=this._on_mouseup.bind(this)}return Object.defineProperty(e.prototype,"camera_node",{get:function(){return this.viewer.cameras_controller.camera_node},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"canvas",{get:function(){return this.viewer.canvas},enumerable:!0,configurable:!0}),e.prototype.init=function(){this.canvas&&(this._bound_on_mousedown&&this.canvas.removeEventListener("mousedown",this._bound_on_mousedown),this._bound_on_mousemove&&this.canvas.removeEventListener("mousemove",this._bound_on_mousemove),this._bound_on_mouseup&&this.canvas.removeEventListener("mouseup",this._bound_on_mouseup),this._bound_on_mousedown=this._bound_on_mousedown||this._on_mousedown.bind(this),this._bound_on_mousemove=this._bound_on_mousemove||this._on_mousemove.bind(this),this._bound_on_mouseup=this._bound_on_mouseup||this._on_mouseup.bind(this),this.canvas.addEventListener("mousedown",this._bound_on_mousedown),this.canvas.addEventListener("mousemove",this._bound_on_mousemove),this.canvas.addEventListener("mouseup",this._bound_on_mouseup),this.canvas.addEventListener("touchstart",this._bound_on_mousedown,!1),this.canvas.addEventListener("touchmove",this._bound_on_mousemove,!1),this.canvas.addEventListener("touchend",this._bound_on_mouseup,!1),this.canvas.addEventListener("touchcancel",this._bound_on_mouseup,!1))},e.prototype._on_mousedown=function(e){this.viewer.scene.events_controller.process_event(e,this.canvas,this.camera_node)},e.prototype._on_mousemove=function(e){this.viewer.scene.events_controller.process_event(e,this.canvas,this.camera_node)},e.prototype._on_mouseup=function(e){this.viewer.scene.events_controller.process_event(e,this.canvas,this.camera_node)},e}();t.EventsController=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this.viewer=e}return e.prototype.init=function(){var e=this.viewer.canvas;e&&(e.onwebglcontextlost=this._on_webglcontextlost.bind(this),e.onwebglcontextrestored=this._on_webglcontextrestored.bind(this))},e.prototype._on_webglcontextlost=function(){console.warn("context lost at frame",this.viewer.scene.frame),this.request_animation_frame_id?cancelAnimationFrame(this.request_animation_frame_id):console.warn("request_animation_frame_id not initialized"),console.warn("not canceled",this.request_animation_frame_id)},e.prototype._on_webglcontextrestored=function(){console.log("context restored")},e}();t.WebGLController=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(136),i=r.__importDefault(n(155)),a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.update_screen_quad=function(){var e=this.screen_quad,t=this.node.params.float("size"),n=t,r=this.node.params.float("far");!r||i.default(t)||i.default(n)||(e.scale.x=t,e.scale.y=n,e.position.z=-.9999*r)},t}(o.BaseBackgroundController);t.OrthographicCameraBackgroundController=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(47),i=n(377),a=n(823),s=50,_=n(5),u=n(206),c=n(136),p=n(205),l=n(83);function d(e){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.fov=_.ParamConfig.FLOAT(s,{range:[0,100]}),t}return r.__extends(t,e),t}(e)}t.PerspectiveCameraObjParamConfigMixin=d;var f=new(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t}(u.CameraPostProcessParamConfig(c.CameraBackgroundParamConfig(l.TransformedParamConfig(p.LayerParamConfig(d(i.CameraTransformParamConfig(_.NodeParamsConfig)))))))),h=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=f,t}return r.__extends(t,e),t.type=function(){return"perspective_camera"},Object.defineProperty(t.prototype,"background_controller_constructor",{get:function(){return a.PerspectiveCameraBackgroundController},enumerable:!0,configurable:!0}),t.prototype.create_object=function(){return new o.PerspectiveCamera(s,1,i.BASE_CAMERA_DEFAULT.near,i.BASE_CAMERA_DEFAULT.far)},t.prototype.update_camera=function(){this._object.fov!=this.pv.fov&&(this._object.fov=this.pv.fov,this._object.updateProjectionMatrix()),this._update_for_aspect_ratio()},t.prototype._update_for_aspect_ratio=function(){this._aspect&&(this._object.aspect=this._aspect,this._object.updateProjectionMatrix())},t}(i.TypedCameraObjNode);t.PerspectiveCameraObjNode=h},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(136),i=n(1),a=r.__importDefault(n(155)),s=r.__importDefault(n(207)),_={bl:{x:-1,y:-1},br:{x:1,y:-1},tl:{x:-1,y:1},tr:{x:1,y:1}},u=["bl","br","tl","tr"],c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._bg_corner={bl:new i.Vector3,br:new i.Vector3,tl:new i.Vector3,tr:new i.Vector3},t._bg_center=new i.Vector3,t}return r.__extends(t,e),t.prototype.update_screen_quad=function(){for(var e=this,t=this.screen_quad,n=0,r=u;n<r.length;n++){var o=r[n];this._update_corner_vector(this._bg_corner[o],_[o])}var i=this._bg_corner.bl.distanceTo(this._bg_corner.br),c=this._bg_corner.bl.distanceTo(this._bg_corner.tl);this._bg_center.x=s.default(u.map((function(t){return e._bg_corner[t].x})))/4,this._bg_center.y=s.default(u.map((function(t){return e._bg_corner[t].y})))/4,this._bg_center.z=s.default(u.map((function(t){return e._bg_corner[t].z})))/4;var p=this.node.params.float("far"),l=this.node.params.float("background_ratio");if(p&&!a.default(i)&&!a.default(c)){var d=p/this._bg_center.distanceTo(this.node.object.position),f=l||1;c=i>c?i/f:i*f,t.scale.x=i*d,t.scale.y=c*d,t.position.z=-.9999*p}},t.prototype._update_corner_vector=function(e,t){this._bg_raycaster.setFromCamera(t,this.node.object),e.copy(this._bg_raycaster.ray.direction).multiplyScalar(this.node.params.float("far")).add(this._bg_raycaster.ray.origin)},t}(o.BaseBackgroundController);t.PerspectiveCameraBackgroundController=c},,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(130),o=n(826),i=n(830),a=n(831),s=n(832),_=n(833),u=n(834),c=n(835),p=n(836),l=n(839),d=n(840),f=n(841),h=n(842),m=n(846),y=n(847),v=n(848),g=n(849),b=n(850),x=n(851),P=n(852),T=n(854),w=n(855),C=n(857),O=n(859),E=n(860),A=n(861),N=n(862),M=n(863),j=n(866),S=n(867),R=n(869),L=n(870),k=n(871),z=n(872),G=n(873),I=n(874),D=n(875),F=n(876),B=n(878),V=n(879),U=n(880),q=n(881),Y=n(974),H=n(983),X=n(984),J=n(985),W=n(986),K=n(987),Z=n(988),Q=n(989),$=n(990),ee=n(991),te=n(993),ne=n(994),re=n(995),oe=n(999),ie=n(1e3),ae=n(1001),se=n(1002),_e=n(1003),ue=function(){function e(){}return e.run=function(e){e.register_node(o.AddSopNode,r.CATEGORY_SOP.INPUT),e.register_node(i.AnimationCopySopNode,r.CATEGORY_SOP.ANIMATION),e.register_node(a.AnimationMixerSopNode,r.CATEGORY_SOP.ANIMATION),e.register_node(s.AttribAddMultSopNode,r.CATEGORY_SOP.ATTRIBUTE),e.register_node(_.AttribCopySopNode,r.CATEGORY_SOP.ATTRIBUTE),e.register_node(u.AttribCreateSopNode,r.CATEGORY_SOP.ATTRIBUTE),e.register_node(c.AttribDeleteSopNode,r.CATEGORY_SOP.ATTRIBUTE),e.register_node(p.AttribNormalizeSopNode,r.CATEGORY_SOP.ATTRIBUTE),e.register_node(l.AttribPromoteSopNode,r.CATEGORY_SOP.ATTRIBUTE),e.register_node(d.AttribRemapSopNode,r.CATEGORY_SOP.ATTRIBUTE),e.register_node(f.AttribRenameSopNode,r.CATEGORY_SOP.ATTRIBUTE),e.register_node(h.AttribTransferSopNode,r.CATEGORY_SOP.ATTRIBUTE),e.register_node(m.BboxScatterSopNode,r.CATEGORY_SOP.MODIFIER),e.register_node(y.BlendSopNode,r.CATEGORY_SOP.MODIFIER),e.register_node(v.BoxSopNode,r.CATEGORY_SOP.PRIMITIVES),e.register_node(g.CacheSopNode,r.CATEGORY_SOP.MISC),e.register_node(x.CodeSopNode,r.CATEGORY_SOP.ADVANCED),e.register_node(b.CircleSopNode,r.CATEGORY_SOP.PRIMITIVES),e.register_node(P.ColorSopNode,r.CATEGORY_SOP.MODIFIER),e.register_node(T.ConeSopNode,r.CATEGORY_SOP.PRIMITIVES),e.register_node(w.CopySopNode,r.CATEGORY_SOP.MODIFIER),e.register_node(C.DataSopNode,r.CATEGORY_SOP.INPUT),e.register_node(O.DataUrlSopNode,r.CATEGORY_SOP.INPUT),e.register_node(E.DelaySopNode,r.CATEGORY_SOP.MISC),e.register_node(A.DeleteSopNode,r.CATEGORY_SOP.MODIFIER),e.register_node(N.FaceSopNode,r.CATEGORY_SOP.MODIFIER),e.register_node(M.FileSopNode,r.CATEGORY_SOP.INPUT),e.register_node(j.FuseSopNode,r.CATEGORY_SOP.MODIFIER),e.register_node(S.HexagonsSopNode,r.CATEGORY_SOP.PRIMITIVES),e.register_node(R.HierarchySopNode,r.CATEGORY_SOP.MISC),e.register_node(L.InstanceSopNode,r.CATEGORY_SOP.RENDER),e.register_node(k.JitterSopNode,r.CATEGORY_SOP.MODIFIER),e.register_node(z.LayerSopNode,r.CATEGORY_SOP.MODIFIER),e.register_node(G.LineSopNode,r.CATEGORY_SOP.PRIMITIVES),e.register_node(I.MaterialSopNode,r.CATEGORY_SOP.RENDER),e.register_node(D.MergeSopNode,r.CATEGORY_SOP.MISC),e.register_node(F.NoiseSopNode,r.CATEGORY_SOP.MISC),e.register_node(B.NormalsSopNode,r.CATEGORY_SOP.MODIFIER),e.register_node(V.NullSopNode,r.CATEGORY_SOP.MODIFIER),e.register_node(U.ObjectMergeSopNode,r.CATEGORY_SOP.INPUT),e.register_node(q.OcclusionSopNode,r.CATEGORY_SOP.RENDER),e.register_node(Y.ParticlesSystemGpuSopNode,r.CATEGORY_SOP.DYNAMICS),e.register_node(H.PeakSopNode,r.CATEGORY_SOP.MODIFIER),e.register_node(X.PlaneSopNode,r.CATEGORY_SOP.PRIMITIVES),e.register_node(J.PointSopNode,r.CATEGORY_SOP.MODIFIER),e.register_node(W.PolywireSopNode,r.CATEGORY_SOP.MODIFIER),e.register_node(K.RaySopNode,r.CATEGORY_SOP.MODIFIER),e.register_node(Z.ResampleSopNode,r.CATEGORY_SOP.MODIFIER),e.register_node(Q.ScatterSopNode,r.CATEGORY_SOP.MODIFIER),e.register_node(ee.SkinSopNode,r.CATEGORY_SOP.MODIFIER),e.register_node($.ShadowsSopNode,r.CATEGORY_SOP.MODIFIER),e.register_node(te.SphereSopNode,r.CATEGORY_SOP.PRIMITIVES),e.register_node(ne.SwitchSopNode,r.CATEGORY_SOP.MISC),e.register_node(re.TextSopNode,r.CATEGORY_SOP.PRIMITIVES),e.register_node(oe.TorusSopNode,r.CATEGORY_SOP.PRIMITIVES),e.register_node(ie.TorusKnotSopNode,r.CATEGORY_SOP.PRIMITIVES),e.register_node(ae.TransformSopNode,r.CATEGORY_SOP.MODIFIER),e.register_node(se.TubeSopNode,r.CATEGORY_SOP.PRIMITIVES),e.register_node(_e.UvProjectSopNode,r.CATEGORY_SOP.MODIFIER)},e}();t.SopRegister=ue},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=r.__importDefault(n(208)),i=n(6),a=n(4),s=n(13),_=n(35),u=n(5),c=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.create_point=u.ParamConfig.BOOLEAN(1),t.points_count=u.ParamConfig.INTEGER(1,{range:[1,100],range_locked:[!0,!1],visible_if:{create_point:!0}}),t.position=u.ParamConfig.VECTOR3([0,0,0],{visible_if:{create_point:!0}}),t.open=u.ParamConfig.BOOLEAN(0),t.connect_to_last_point=u.ParamConfig.BOOLEAN(0),t}return r.__extends(t,e),t}(u.NodeParamsConfig)),p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=c,t}return r.__extends(t,e),t.type=function(){return"add"},t.displayed_input_names=function(){return["geometry to create polygons from (optional)"]},t.prototype.initialize_node=function(){this.io.inputs.set_count(0,1)},t.prototype.cook=function(e){this._objects=[],this._create_point(),this.set_objects(this._objects)},t.prototype._create_point=function(){var e=this;if(this.pv.create_point){var t=new i.BufferGeometry,n=[];o.default(this.pv.points_count,(function(t){e.pv.position.toArray(n,3*t)})),t.setAttribute("position",new a.BufferAttribute(new Float32Array(n),3));var r=this.create_object(t,_.CoreConstant.OBJECT_TYPE.POINTS);this._objects&&this._objects.push(r)}},t}(s.TypedSopNode);t.AddSopNode=p},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2).__importDefault(n(207)),o=n(1),i=n(3),a=n(98),s=n(380),_=n(104),u=function(){function e(e,t){this._core_geometry=e,this._index=t,this._geometry=this._core_geometry.geometry()}return Object.defineProperty(e.prototype,"index",{get:function(){return this._index},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"points",{get:function(){return this._points=this._points||this._get_points()},enumerable:!0,configurable:!0}),e.prototype._get_points=function(){var e,t=(null===(e=this._geometry.index)||void 0===e?void 0:e.array)||[],n=3*this._index;return[new s.CorePoint(this._core_geometry,t[n+0]),new s.CorePoint(this._core_geometry,t[n+1]),new s.CorePoint(this._core_geometry,t[n+2])]},Object.defineProperty(e.prototype,"positions",{get:function(){return this._positions=this._positions||this._get_positions()},enumerable:!0,configurable:!0}),e.prototype._get_positions=function(){var e=this.points;return[e[0].position(),e[1].position(),e[2].position()]},Object.defineProperty(e.prototype,"triangle",{get:function(){return this._triangle=this._triangle||this._get_triangle()},enumerable:!0,configurable:!0}),e.prototype._get_triangle=function(){var e=this.positions;return new a.Triangle(e[0],e[1],e[2])},Object.defineProperty(e.prototype,"deltas",{get:function(){return this._deltas=this._deltas||this._get_deltas()},enumerable:!0,configurable:!0}),e.prototype._get_deltas=function(){return[this.positions[1].clone().sub(this.positions[0]),this.positions[2].clone().sub(this.positions[0])]},Object.defineProperty(e.prototype,"area",{get:function(){return this.triangle.getArea()},enumerable:!0,configurable:!0}),e.prototype.center=function(e){var t=this.positions;return e.x=(t[0].x+t[1].x+t[2].x)/3,e.y=(t[0].y+t[1].y+t[2].y)/3,e.z=(t[0].z+t[1].z+t[2].z)/3,e},e.prototype.random_position=function(e){var t=[_.CoreMath.rand_float(e),_.CoreMath.rand_float(6541*e)];return t[0]+t[1]>1&&(t[0]=1-t[0],t[1]=1-t[1]),this.positions[0].clone().add(this.deltas[0].clone().multiplyScalar(t[0])).add(this.deltas[1].clone().multiplyScalar(t[1]))},e.prototype.attrib_value_at_position=function(e,t){var n=new o.Vector3;this.triangle.getBarycoord(t,n);var r,i,a=n.toArray(),s=this._geometry.attributes[e].itemSize,_=this.points.map((function(t){return t.attrib_value(e)})),u=0;switch(s){case 1:i=0;for(var c=0,p=_;c<p.length;c++){i+=p[c]*a[u],u++}r=i;break;default:for(var l=0,d=_;l<d.length;l++){var f=d[l].multiplyScalar(a[u]);i?i.add(f):i=f,u++}r=i}return r},e.interpolated_value=function(e,t,n,a){var s=[t.a,t.b,t.c],_=e.getAttribute("position").array,u=s.map((function(e){return new o.Vector3(_[3*e+0],_[3*e+1],_[3*e+2])})),c=a.itemSize,p=a.array,l=[];switch(c){case 1:l=s.map((function(e){return p[e]}));break;case 2:l=s.map((function(e){return new i.Vector2(p[2*e+0],p[2*e+1])}));break;case 3:l=s.map((function(e){return new o.Vector3(p[3*e+0],p[3*e+1],p[3*e+2])}))}var d,f=s.map((function(e,t){return n.distanceTo(u[t])})),h=r.default([f[0]*f[1],f[0]*f[2],f[1]*f[2]]),m=[f[1]*f[2]/h,f[0]*f[2]/h,f[0]*f[1]/h];switch(c){case 1:d=r.default(s.map((function(e,t){return m[t]*l[t]})));break;default:d=null;for(var y=0,v=s.map((function(e,t){return l[t].multiplyScalar(m[t])}));y<v.length;y++){var g=v[y];d?d.add(g):d=g}}return d},e}();t.CoreFace=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(97),o=function(){function e(){}return e.patch=function(e){Object.assign(e,{clone:function(){return new r.InterleavedBufferAttribute(e.data.clone(),e.itemSize,e.offset,e.normalized)}})},e}();t.MonkeyPatcher=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(115),i=n(53),a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.set_objects=function(e){},t.prototype.core_content_cloned=function(){if(this._content)return this._content.clone()},t.prototype.set_content=function(t){e.prototype.set_content.call(this,t)},t.prototype.first_object=function(){if(this._content)return this._content.objects()[0]},t.prototype.first_geometry=function(){var e=this.first_object();return e?e.geometry:null},t.prototype.objects_count=function(){return this._content?this._content.objects().length:0},t.prototype.objects_visible_count=function(){var e=0;return this._content&&(e=this._content.objects().filter((function(e){return e.visible})).length),e},t.prototype.objects_count_by_type=function(){var e={},t=this._content;if(this._content&&t)for(var n=0,r=t.core_objects();n<r.length;n++){var o=r[n].human_type();null==e[o]&&(e[o]=0),e[o]+=1}return e},t.prototype.objects_names_by_type=function(){var e={},t=this._content;if(this._content&&t)for(var n=0,r=t.core_objects();n<r.length;n++){var o=r[n],i=o.human_type();e[i]=e[i]||[],e[i].push(o.name())}return e},t.prototype.vertex_attribute_names=function(){var e=[],t=this.first_geometry();return t&&(e=Object.keys(t.attributes)),e},t.prototype.vertex_attribute_sizes_by_name=function(){var e={},t=this.first_geometry();return t&&Object.keys(t.attributes).forEach((function(n){var r=t.attributes[n];e[n]=r.itemSize})),e},t.prototype.vertex_attribute_types_by_name=function(){var e={},t=this.first_geometry();if(t){var n=new i.CoreGeometry(t);Object.keys(t.attributes).forEach((function(t){e[t]=n.attrib_type(t)}))}return e},t.prototype.object_attribute_names=function(){var e=[],t=this.first_object();return t&&(e=Object.keys(t.userData.attributes||{})),e},t.prototype.points_count=function(){return this._content?this._content.points_count():0},t.prototype.bounding_box=function(){return this._content.bounding_box()},t.prototype.center=function(){return this._content.center()},t.prototype.size=function(){return this._content.size()},t}(o.TypedContainer);t.GeometryContainer=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(13),i=n(5),a=n(17),s=new(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t}(i.NodeParamsConfig)),_=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=s,t}return r.__extends(t,e),t.type=function(){return"animation_copy"},t.displayed_input_names=function(){return["geometry to copy animation to","geometry to copy animation from"]},t.prototype.initialize_node=function(){this.io.inputs.set_count(2),this.io.inputs.init_inputs_clonable_state([a.InputCloneMode.FROM_NODE,a.InputCloneMode.NEVER])},t.prototype.cook=function(e){var t=e[0],n=e[1].objects()[0],r=t.objects()[0],o=n.animations;o?(r.animations=o.map((function(e){return e.clone()})),this.set_core_group(t)):this.states.error.set("no animation found")},t}(o.TypedSopNode);t.AnimationCopySopNode=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(13),i=r.__importDefault(n(21)),a=n(1014),s=n(17),_=n(24),u=n(61),c=n(5),p=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.time=c.ParamConfig.FLOAT("$T",{range:[0,10]}),t.prepare=c.ParamConfig.BUTTON(null,{callback:function(e,t){l.PARAM_CALLBACK_prepare(e,t)}}),t}return r.__extends(t,e),t}(c.NodeParamsConfig)),l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=p,t._previous_time=null,t._mixer=null,t._actions_by_name={},t._values_by_param_name={},t}return r.__extends(t,e),t.type=function(){return"animation_mixer"},t.displayed_input_names=function(){return["geometry to be animated"]},t.prototype.initialize_node=function(){this.io.inputs.set_count(1),this.io.inputs.init_inputs_clonable_state([s.InputCloneMode.FROM_NODE])},t.prototype.cook=function(e){this._mixer?(this._update_mixer(),this.cook_controller.end_cook()):this.create_mixer(e[0])},t.prototype.create_mixer=function(e){var t=this;this._animation_target=e.objects()[0],this._mixer=new a.AnimationMixer(this._animation_target),this._remove_spare_params(),this._actions_by_name={},this._animation_target.animations&&this._animation_target.animations.forEach((function(e,n){var r=e.name,o=t._values_by_param_name[r];null==o&&(o=0==n?1:0);var i=t.add_param(_.ParamType.FLOAT,r,o,{spare:!0});if(i){var a=t._values_by_param_name[r];a&&i.set(a)}if(t._mixer){var s=t._mixer.clipAction(e);t._actions_by_name[e.name]=s}})),this.emit(u.NodeEvent.PARAMS_UPDATED),Object.keys(this._actions_by_name).forEach((function(e){t._actions_by_name[e].play()}));var n={};this._animation_target.traverse((function(e){var t=e;t.material&&(i.default(t.material)||(n[t.material.uuid]=t.material))})),Object.keys(n).forEach((function(e){var t=n[e];t.skinning=!0,t.morphTargets=!0})),this._previous_time=null,this._update_mixer(),this._update_mixer_weights(),this.set_object(this._animation_target)},t.prototype._remove_spare_params=function(){var e=this;this._values_by_param_name={};var t=this.params.spare_names,n=[];t.forEach((function(t){var r=e.params.get_float(t);r&&(e._values_by_param_name[t]=r.value,n.push(t))})),n.length>0&&this.params.update_params({names_to_delete:n})},t.prototype._update_mixer=function(){this.pv.time!=this._previous_time?this._update_mixer_time():this._update_mixer_weights()},t.prototype._update_mixer_time=function(){var e=this.pv.time-(this._previous_time||0);this._mixer&&this._mixer.update(e),this._previous_time=this.pv.time},t.prototype._update_mixer_weights=function(){for(var e=0,t=Object.keys(this._actions_by_name);e<t.length;e++){var n=t[e],r=this._actions_by_name[n],o=this.params.get_float(n).value;null!=o&&r.setEffectiveWeight(o)}},t.PARAM_CALLBACK_prepare=function(e,t){e.prepare_animation_mixer()},t.prototype.prepare_animation_mixer=function(){return r.__awaiter(this,void 0,void 0,(function(){var e;return r.__generator(this,(function(t){switch(t.label){case 0:return this._mixer=null,[4,this.io.inputs.eval_required_input(0)];case 1:return e=t.sent(),this.create_mixer(e.core_content_cloned()),this.set_dirty(),[2]}}))}))},t}(o.TypedSopNode);t.AnimationMixerSopNode=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(13),i=n(5),a=n(17),s=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name=i.ParamConfig.STRING(""),t.pre_add=i.ParamConfig.FLOAT(0,{range:[0,1]}),t.mult=i.ParamConfig.FLOAT(1,{range:[0,1]}),t.post_add=i.ParamConfig.FLOAT(0,{range:[0,1]}),t}return r.__extends(t,e),t}(i.NodeParamsConfig)),_=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=s,t}return r.__extends(t,e),t.type=function(){return"attrib_add_mult"},t.prototype.initialize_node=function(){this.io.inputs.set_count(1),this.io.inputs.init_inputs_clonable_state([a.InputCloneMode.FROM_NODE])},t.prototype.cook=function(e){for(var t=e[0],n=0,r=t.attrib_names_matching_mask(this.pv.name);n<r.length;n++)for(var o=r[n],i=0,a=t.geometries();i<a.length;i++){var s=a[i];this._update_attrib(o,s)}this.set_core_group(t)},t.prototype._update_attrib=function(e,t){var n=t.getAttribute(e);if(n){for(var r=n.array,o=this.pv.pre_add,i=this.pv.mult,a=this.pv.post_add,s=0;s<r.length;s++){var _=r[s];r[s]=(_+o)*i+a}this.io.inputs.input_cloned(0)||(n.needsUpdate=!0)}},t}(o.TypedSopNode);t.AttribAddMultSopNode=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(13),i=n(5),a=n(17),s=n(4),_=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name=i.ParamConfig.STRING(""),t.tnew_name=i.ParamConfig.BOOLEAN(0),t.new_name=i.ParamConfig.STRING("",{visible_if:{tnew_name:1}}),t}return r.__extends(t,e),t}(i.NodeParamsConfig)),u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=_,t}return r.__extends(t,e),t.type=function(){return"attrib_copy"},t.displayed_input_names=function(){return["geometry to copy attributes to","geometry to copy attributes from"]},t.prototype.initialize_node=function(){this.io.inputs.set_count(2),this.io.inputs.init_inputs_clonable_state([a.InputCloneMode.FROM_NODE,a.InputCloneMode.NEVER])},t.prototype.create_params=function(){},t.prototype.cook=function(e){for(var t=e[0],n=e[1],r=0,o=n.attrib_names_matching_mask(this.pv.name);r<o.length;r++){var i=o[r];this.copy_vertex_attribute_between_core_groups(t,n,i)}return this.set_core_group(t)},t.prototype.copy_vertex_attribute_between_core_groups=function(e,t,n){var r=t.objects(),o=e.objects();if(o.length>r.length)this.states.error.set("second input does not have enough objects to copy attributes from");else for(var i=0;i<o.length;i++){var a=o[i].geometry,s=o[i].geometry;this.copy_vertex_attribute_between_geometries(a,s,n)}},t.prototype.copy_vertex_attribute_between_geometries=function(e,t,n){var r=t.getAttribute(n);if(r){var o=r.itemSize,i=t.getAttribute("position").array.length/3,a=e.getAttribute("position").array.length/3;a>i&&this.states.error.set("not enough points in second input");var _=r.array.slice(0,a*o),u=this.pv.tnew_name?this.pv.new_name:n;e.setAttribute(u,new s.Float32BufferAttribute(_,o))}else this.states.error.set("attribute '"+n+"' does not exist on second input")},t}(o.TypedSopNode);t.AttribCopySopNode=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=r.__importDefault(n(188)),i=n(13),a=n(35),s=n(114),_=n(17),u=n(5),c=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.group=u.ParamConfig.STRING(""),t.class=u.ParamConfig.INTEGER(a.AttribClass.VERTEX,{menu:{entries:a.AttribClassMenuEntries}}),t.type=u.ParamConfig.INTEGER(a.AttribType.NUMERIC,{menu:{entries:a.AttribTypeMenuEntries}}),t.name=u.ParamConfig.STRING("new_attrib"),t.size=u.ParamConfig.INTEGER(1,{range:[1,4],range_locked:[!0,!0],visible_if:{type:a.CoreConstant.ATTRIB_TYPE.NUMERIC}}),t.value1=u.ParamConfig.FLOAT(0,{visible_if:{type:a.CoreConstant.ATTRIB_TYPE.NUMERIC,size:1},expression:{for_entities:!0}}),t.value2=u.ParamConfig.VECTOR2([0,0],{visible_if:{type:a.CoreConstant.ATTRIB_TYPE.NUMERIC,size:2},expression:{for_entities:!0}}),t.value3=u.ParamConfig.VECTOR3([0,0,0],{visible_if:{type:a.CoreConstant.ATTRIB_TYPE.NUMERIC,size:3},expression:{for_entities:!0}}),t.value4=u.ParamConfig.VECTOR4([0,0,0,0],{visible_if:{type:a.CoreConstant.ATTRIB_TYPE.NUMERIC,size:4},expression:{for_entities:!0}}),t.string=u.ParamConfig.STRING("",{visible_if:{type:a.CoreConstant.ATTRIB_TYPE.STRING},expression:{for_entities:!0}}),t}return r.__extends(t,e),t}(u.NodeParamsConfig)),p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=c,t._x_arrays_by_geometry_uuid={},t._y_arrays_by_geometry_uuid={},t._z_arrays_by_geometry_uuid={},t._w_arrays_by_geometry_uuid={},t}return r.__extends(t,e),t.type=function(){return"attrib_create"},t.prototype.initialize_node=function(){this.io.inputs.set_count(1),this.io.inputs.init_inputs_clonable_state([_.InputCloneMode.FROM_NODE])},t.prototype.cook=function(e){var t=e[0];if(this.pv.name&&""!=o.default(this.pv.name))switch(this.pv.class){case a.AttribClass.VERTEX:this.add_point_attribute(t);break;case a.AttribClass.OBJECT:this.add_object_attribute(t)}else this.states.error.set("attribute name is not valid")},t.prototype.add_point_attribute=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,n,o;return r.__generator(this,(function(r){switch(r.label){case 0:t=e.core_objects(),n=0,r.label=1;case 1:if(!(n<t.length))return[3,7];switch(o=t[n],this.pv.type){case a.CoreConstant.ATTRIB_TYPE.NUMERIC:return[3,2];case a.CoreConstant.ATTRIB_TYPE.STRING:return[3,4]}return[3,6];case 2:return[4,this.add_numeric_attribute_to_points(o)];case 3:return r.sent(),[3,6];case 4:return[4,this.add_string_attribute_to_points(o)];case 5:return r.sent(),[3,6];case 6:return n++,[3,1];case 7:return this.set_core_group(e),[2]}}))}))},t.prototype.add_object_attribute=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t;return r.__generator(this,(function(n){switch(n.label){case 0:switch(t=e.core_objects_from_group(this.pv.group),this.pv.type){case a.CoreConstant.ATTRIB_TYPE.NUMERIC:return[3,1];case a.CoreConstant.ATTRIB_TYPE.STRING:return[3,3]}return[3,5];case 1:return[4,this.add_numeric_attribute_to_object(t)];case 2:return n.sent(),[3,5];case 3:return[4,this.add_string_attribute_to_object(t)];case 4:return n.sent(),[3,5];case 5:return this.set_core_group(e),[2]}}))}))},t.prototype.add_numeric_attribute_to_points=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,n,o,i,a,s,_,u,c,p,l,d,f,h,m,y=this;return r.__generator(this,(function(v){switch(v.label){case 0:return t=e.core_geometry(),n=e.points_from_group(this.pv.group),(o=[this.p.value1,this.p.value2,this.p.value3,this.p.value4][this.pv.size-1]).has_expression()?(t.has_attrib(this.pv.name)||t.add_numeric_attrib(this.pv.name,this.pv.size,o.value),i=t.geometry(),a=i.getAttribute(this.pv.name).array,1!=this.pv.size?[3,3]:this.p.value1.expression_controller?[4,this.p.value1.expression_controller.compute_expression_for_points(n,(function(e,t){a[e.index*y.pv.size+0]=t}))]:[3,2]):[3,9];case 1:v.sent(),v.label=2;case 2:return[3,8];case 3:s=[this.p.value2,this.p.value3,this.p.value4][this.pv.size-2],_=s.components,u=new Array(_.length),c=void 0,p=[this._x_arrays_by_geometry_uuid,this._y_arrays_by_geometry_uuid,this._z_arrays_by_geometry_uuid,this._w_arrays_by_geometry_uuid],l=function(e){var t,o,s,l;return r.__generator(this,(function(r){switch(r.label){case 0:return(c=_[e]).has_expression()&&c.expression_controller?(u[e]=d._init_array_if_required(i,p[e],n.length),[4,c.expression_controller.compute_expression_for_points(n,(function(t,n){u[e][t.index]=n}))]):[3,2];case 1:return r.sent(),[3,3];case 2:for(t=c.value,o=0,s=n;o<s.length;o++)l=s[o],a[l.index*d.pv.size+e]=t;r.label=3;case 3:return[2]}}))},d=this,m=0,v.label=4;case 4:return m<_.length?[5,l(m)]:[3,7];case 5:v.sent(),v.label=6;case 6:return m++,[3,4];case 7:for(f=0;f<u.length;f++)if(h=u[f])for(m=0;m<h.length;m++)a[m*this.pv.size+f]=h[m];v.label=8;case 8:return[3,10];case 9:e.add_numeric_vertex_attrib(this.pv.name,this.pv.size,o.value),v.label=10;case 10:return[2]}}))}))},t.prototype.add_numeric_attribute_to_object=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,n,o,i,a,s,_,u,c,p,l,d,f,h=this;return r.__generator(this,(function(m){switch(m.label){case 0:return(t=[this.p.value1,this.p.value2,this.p.value3,this.p.value4][this.pv.size-1]).has_expression()?1!=this.pv.size?[3,3]:this.p.value1.expression_controller?[4,this.p.value1.expression_controller.compute_expression_for_objects(e,(function(e,t){e.set_attrib_value(h.pv.name,t)}))]:[3,2]:[3,9];case 1:m.sent(),m.label=2;case 2:return[3,8];case 3:for(n=[this.p.value2,this.p.value3,this.p.value4][this.pv.size-2],o=n.components,i={},a=0,s=e;a<s.length;a++)f=s[a],i[f.index]=[];_=function(t){var n,a,s,_;return r.__generator(this,(function(r){switch(r.label){case 0:return(n=o[t]).has_expression()&&n.expression_controller?[4,n.expression_controller.compute_expression_for_objects(e,(function(e,n){i[e.index][t]=n}))]:[3,2];case 1:return r.sent(),[3,3];case 2:for(a=0,s=e;a<s.length;a++)_=s[a],i[_.index][t]=n.value;r.label=3;case 3:return[2]}}))},u=0,m.label=4;case 4:return u<o.length?[5,_(u)]:[3,7];case 5:m.sent(),m.label=6;case 6:return u++,[3,4];case 7:for(c=0;c<e.length;c++)f=e[c],p=i[f.index],f.set_attrib_value(this.pv.name,p);m.label=8;case 8:return[3,10];case 9:for(l=0,d=e;l<d.length;l++)(f=d[l]).set_attrib_value(this.pv.name,t.value);m.label=10;case 10:return[2]}}))}))},t.prototype.add_string_attribute_to_points=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,n,o,i;return r.__generator(this,(function(r){switch(r.label){case 0:return t=e.points_from_group(this.pv.group),n=this.p.string,o=[],n.has_expression()&&n.expression_controller?[4,n.expression_controller.compute_expression_for_points(t,(function(e,t){o[e.index]=t}))]:[3,2];case 1:return r.sent(),[3,3];case 2:o.push(n.value),r.label=3;case 3:return i=s.CoreAttribute.array_to_indexed_arrays(o),e.core_geometry().set_indexed_attribute(this.pv.name,i.values,i.indices),[2]}}))}))},t.prototype.add_string_attribute_to_object=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,n,o,i=this;return r.__generator(this,(function(r){switch(r.label){case 0:return(t=this.p.string).has_expression()&&t.expression_controller?[4,t.expression_controller.compute_expression_for_objects(e,(function(e,t){e.set_attrib_value(i.pv.name,t)}))]:[3,2];case 1:return r.sent(),[3,3];case 2:for(n=0,o=e;n<o.length;n++)o[n].set_attrib_value(this.pv.name,t.value);r.label=3;case 3:return[2]}}))}))},t.prototype._init_array_if_required=function(e,t,n){var r=e.uuid,o=t[r];return o?o.length<n&&(t[r]=new Array(n)):t[r]=new Array(n),t[r]},t}(i.TypedSopNode);t.AttribCreateSopNode=p},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(13),i=n(276),a=n(53),s=n(35),_=n(17),u=n(5),c=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.class=u.ParamConfig.INTEGER(s.AttribClass.VERTEX,{menu:{entries:s.AttribClassMenuEntries}}),t.name=u.ParamConfig.STRING(""),t}return r.__extends(t,e),t}(u.NodeParamsConfig)),p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=c,t}return r.__extends(t,e),t.type=function(){return"attrib_delete"},t.displayed_input_names=function(){return["geometry to delete attributes from"]},t.prototype.initialize_node=function(){this.io.inputs.set_count(1),this.io.inputs.init_inputs_clonable_state([_.InputCloneMode.FROM_NODE])},t.prototype.cook=function(e){for(var t=e[0],n=0,r=t.attrib_names_matching_mask(this.pv.name);n<r.length;n++){var o=r[n];switch(this.pv.class){case s.AttribClass.VERTEX:this.delete_vertex_attribute(t,o);case s.AttribClass.OBJECT:this.delete_object_attribute(t,o)}}this.set_core_group(t)},t.prototype.delete_vertex_attribute=function(e,t){for(var n=0,r=e.objects();n<r.length;n++){r[n].traverse((function(e){var n=e;n.geometry&&new a.CoreGeometry(n.geometry).delete_attribute(t)}))}},t.prototype.delete_object_attribute=function(e,t){for(var n=function(e){var n=0;e.traverse((function(e){var r=e;new i.CoreObject(r,n).delete_attribute(t),n++}))},r=0,o=e.objects();r<o.length;r++){n(o[r])}},t}(o.TypedSopNode);t.AttribDeleteSopNode=p},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(13),i=n(1),a=r.__importDefault(n(209)),s=r.__importDefault(n(278)),_=r.__importDefault(n(44)),u=n(17),c=n(5),p=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name=c.ParamConfig.STRING(""),t.change_name=c.ParamConfig.BOOLEAN(!1),t.new_name=c.ParamConfig.STRING("",{visible_if:{change_name:1}}),t}return r.__extends(t,e),t}(c.NodeParamsConfig)),l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=p,t}return r.__extends(t,e),t.type=function(){return"attrib_normalize"},t.prototype.initialize_node=function(){this.io.inputs.set_count(1),this.io.inputs.init_inputs_clonable_state([u.InputCloneMode.FROM_NODE])},t.prototype.cook=function(e){var t=e[0];this._normalize_attribute(t),this.set_core_group(t)},t.prototype._normalize_attribute=function(e){var t=this,n=e.points();if(0!==n.length&&""!==this.pv.name){var r,o,u=n[0].attrib_size(this.pv.name),c=n.map((function(e){return e.attrib_value(t.pv.name)})),p=[];switch(u){case 1:if(r=s.default(c),o=a.default(c),_.default(r)&&_.default(o))for(var l=0,d=c;l<d.length;l++){var f=d[l],h=o>r?(f-r)/(o-r):1;p.push(h)}break;case 3:if(r=new i.Vector3(s.default(c.map((function(e){return e.x}))),s.default(c.map((function(e){return e.y}))),s.default(c.map((function(e){return e.z})))),o=new i.Vector3(a.default(c.map((function(e){return e.x}))),a.default(c.map((function(e){return e.y}))),a.default(c.map((function(e){return e.z})))),r instanceof i.Vector3&&o instanceof i.Vector3)for(var m=0,y=c;m<y.length;m++){f=y[m],h=new i.Vector3((f.x-r.x)/(o.x-r.x),(f.y-r.y)/(o.y-r.y),(f.z-r.z)/(o.z-r.z));p.push(h)}}var v=this.pv.name;this.pv.change_name&&(v=this.pv.new_name,e.has_attrib(v)||e.add_numeric_vertex_attrib(v,u,0)),p.forEach((function(e,t){n[t].set_attrib_value(v,e)}))}},t}(o.TypedSopNode);t.AttribNormalizeSopNode=l},,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,o=n(2),i=o.__importDefault(n(209)),a=o.__importDefault(n(278)),s=n(17),_=n(13),u=n(35),c=n(49);!function(e){e[e.MIN=0]="MIN",e[e.MAX=1]="MAX",e[e.FIRST_FOUND=3]="FIRST_FOUND"}(r=t.AttribPromoteMode||(t.AttribPromoteMode={}));var p=[{name:"min",value:r.MIN},{name:"max",value:r.MAX},{name:"first_found",value:r.FIRST_FOUND}],l=n(5),d=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.class_from=l.ParamConfig.INTEGER(u.AttribClass.VERTEX,{menu:{entries:u.AttribClassMenuEntries}}),t.class_to=l.ParamConfig.INTEGER(u.AttribClass.OBJECT,{menu:{entries:u.AttribClassMenuEntries}}),t.mode=l.ParamConfig.INTEGER(r.MIN,{menu:{entries:p}}),t.name=l.ParamConfig.STRING(""),t}return o.__extends(t,e),t}(l.NodeParamsConfig)),f=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=d,t._values_per_attrib_name={},t._filtered_values_per_attrib_name={},t}return o.__extends(t,e),t.type=function(){return"attrib_promote"},t.prototype.initialize_node=function(){this.io.inputs.set_count(1),this.io.inputs.init_inputs_clonable_state([s.InputCloneMode.FROM_NODE])},t.prototype.create_params=function(){},t.prototype.cook=function(e){this._core_group=e[0],this._values_per_attrib_name={},this._filtered_values_per_attrib_name={};for(var t=0,n=this._core_group.core_objects();t<n.length;t++){var r=n[t];this._core_object=r,this.find_values(),this.filter_values(),this.set_values()}this.set_core_group(this._core_group)},t.prototype.find_values=function(){for(var e=0,t=c.CoreString.attrib_names(this.pv.name);e<t.length;e++){var n=t[e];switch(this.pv.class_from){case u.AttribClass.VERTEX:return this.find_values_from_points(n);case u.AttribClass.OBJECT:return this.find_values_from_object(n)}}},t.prototype.find_values_from_points=function(e){if(this._core_object){var t=this._core_object.points();this._values_per_attrib_name[e]=t.map((function(t){return t.attrib_value(e)}))}},t.prototype.find_values_from_object=function(e){this._values_per_attrib_name[e]=[],this._core_object&&this._values_per_attrib_name[e].push(this._core_object.attrib_value(e))},t.prototype.filter_values=function(){for(var e=0,t=Object.keys(this._values_per_attrib_name);e<t.length;e++){var n=t[e],o=this._values_per_attrib_name[n];switch(this.pv.mode){case r.MIN:this._filtered_values_per_attrib_name[n]=a.default(o);break;case r.MAX:this._filtered_values_per_attrib_name[n]=i.default(o);break;case r.FIRST_FOUND:this._filtered_values_per_attrib_name[n]=o[0]}}},t.prototype.set_values=function(){for(var e=0,t=Object.keys(this._filtered_values_per_attrib_name);e<t.length;e++){var n=t[e],r=this._filtered_values_per_attrib_name[n];if(null!=r)switch(this.pv.class_to){case u.AttribClass.VERTEX:this.set_values_to_points(n,r);break;case u.AttribClass.OBJECT:this.set_values_to_object(n,r)}}},t.prototype.set_values_to_points=function(e,t){if(this._core_group&&this._core_object){if(!this._core_group.has_attrib(e)){this._core_group.add_numeric_vertex_attrib(e,1,t)}this._core_object.points().forEach((function(n){return n.set_attrib_value(e,t)}))}},t.prototype.set_values_to_object=function(e,t){var n;null===(n=this._core_object)||void 0===n||n.set_attrib_value(e,t)},t}(_.TypedSopNode);t.AttribPromoteSopNode=f},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=r.__importDefault(n(209)),i=r.__importDefault(n(278)),a=r.__importDefault(n(102)),s=r.__importDefault(n(91)),_=r.__importDefault(n(44)),u=n(1),c=n(13),p=n(5),l=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name=p.ParamConfig.STRING(),t.ramp=p.ParamConfig.RAMP(),t.change_name=p.ParamConfig.BOOLEAN(0),t.new_name=p.ParamConfig.STRING("",{visible_if:{change_name:1}}),t}return r.__extends(t,e),t}(p.NodeParamsConfig)),d=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=l,t}return r.__extends(t,e),t.type=function(){return"attrib_remap"},t.prototype.initialize_node=function(){this.io.inputs.set_count(1)},t.prototype.cook=function(e){var t=e[0];this._remap_attribute(t),this.set_core_group(t)},t.prototype._remap_attribute=function(e){var t=this,n=e.points();if(0!==n.length&&""!==this.pv.name){var r,c,p=n[0].attrib_size(this.pv.name),l=n.map((function(e){return e.attrib_value(t.pv.name)})),d=new Array(n.length);switch(p){case 1:if(this.pv.only_integer_values){var f=s.default(a.default(l)),h={};f.forEach((function(e,t){return h[e]=t})),d=l.map((function(e){return h[e]}))}else if(r=i.default(l),c=o.default(l),_.default(r)&&_.default(c))for(var m=0;m<l.length;m++){var y=l[m],v=c>r?(y-r)/(c-r):1;d[m]=v}break;case 3:if(r=new u.Vector3(i.default(l.map((function(e){return e.x}))),i.default(l.map((function(e){return e.y}))),i.default(l.map((function(e){return e.z})))),c=new u.Vector3(o.default(l.map((function(e){return e.x}))),o.default(l.map((function(e){return e.y}))),o.default(l.map((function(e){return e.z})))),r instanceof u.Vector3&&c instanceof u.Vector3)for(m=0;m<l.length;m++){y=l[m],v=new u.Vector3((y.x-r.x)/(c.x-r.x),(y.y-r.y)/(c.y-r.y),(y.z-r.z)/(c.z-r.z));d[m]=v}}var g=this.pv.name;this.pv.change_name&&(g=this.pv.new_name,e.has_attrib(g)||e.add_numeric_vertex_attrib(g,p,0)),d.forEach((function(e,t){n[t].set_attrib_value(g,e)}))}},t}(c.TypedSopNode);t.AttribRemapSopNode=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(13),i=n(5),a=n(35),s=n(17),_=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.class=i.ParamConfig.INTEGER(a.AttribClass.VERTEX,{menu:{entries:a.AttribClassMenuEntries}}),t.old_name=i.ParamConfig.STRING(),t.new_name=i.ParamConfig.STRING(),t}return r.__extends(t,e),t}(i.NodeParamsConfig)),u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=_,t}return r.__extends(t,e),t.type=function(){return"attrib_rename"},t.prototype.initialize_node=function(){this.io.inputs.set_count(1),this.io.inputs.init_inputs_clonable_state([s.InputCloneMode.FROM_NODE])},t.prototype.cook=function(e){var t=e[0];t.rename_attrib(this.pv.old_name,this.pv.new_name,this.pv.class),this.set_core_group(t)},t}(o.TypedSopNode);t.AttribRenameSopNode=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(13),i=n(843),a=n(844),s=n(383),_=n(5),u=n(17),c=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.src_group=_.ParamConfig.STRING(),t.dest_group=_.ParamConfig.STRING(),t.name=_.ParamConfig.STRING(),t.max_samples_count=_.ParamConfig.INTEGER(1,{range:[1,10],range_locked:[!0,!1]}),t.distance_threshold=_.ParamConfig.FLOAT(1),t.blend_width=_.ParamConfig.FLOAT(0),t}return r.__extends(t,e),t}(_.NodeParamsConfig)),p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=c,t}return r.__extends(t,e),t.type=function(){return"attrib_transfer"},t.displayed_input_names=function(){return["geometry to transfer attributes to","geometry to transfer attributes from"]},t.prototype.initialize_node=function(){this.io.inputs.set_count(2),this.io.inputs.init_inputs_clonable_state([u.InputCloneMode.FROM_NODE,u.InputCloneMode.NEVER])},t.prototype.cook=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t;return r.__generator(this,(function(n){switch(n.label){case 0:return this._core_group_dest=e[0],t=this._core_group_dest.points_from_group(this.pv.dest_group),this._core_group_src=e[1],this._attrib_names=this._core_group_src.attrib_names_matching_mask(this.pv.name),this._error_if_attribute_not_found_on_second_input(),this._build_octree_if_required(this._core_group_src),this._add_attribute_if_required(),[4,this._transfer_attributes(t)];case 1:return n.sent(),this.set_core_group(this._core_group_dest),[2]}}))}))},t.prototype._error_if_attribute_not_found_on_second_input=function(){for(var e=0,t=this._attrib_names;e<t.length;e++){var n=t[e];this._core_group_src.has_attrib(n)||this.states.error.set("attribute '"+n+"' not found on second input")}},t.prototype._build_octree_if_required=function(e){var t=null==this._octree_timestamp||this._octree_timestamp!==e.timestamp();if(this._prev_param_src_group!==this.pv.src_group||t){this._octree_timestamp=e.timestamp(),this._prev_param_src_group=this.pv.src_group;var n=this._core_group_src.points_from_group(this.pv.src_group);this._octree=new a.CoreOctree(this._core_group_src.bounding_box()),this._octree.set_points(n)}},t.prototype._add_attribute_if_required=function(){var e=this;this._attrib_names.forEach((function(t){if(!e._core_group_dest.has_attrib(t)){var n=e._core_group_src.attrib_size(t);e._core_group_dest.add_numeric_vertex_attrib(t,n,0)}}))},t.prototype._transfer_attributes=function(e){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(t){switch(t.label){case 0:return[4,(new s.CoreIterator).start_with_array(e,this._transfer_attributes_for_point.bind(this))];case 1:return t.sent(),[2]}}))}))},t.prototype._transfer_attributes_for_point=function(e){for(var t,n=this.pv.distance_threshold+this.pv.blend_width,r=(null===(t=this._octree)||void 0===t?void 0:t.find_points(e.position(),n,this.pv.max_samples_count))||[],o=0,i=this._attrib_names;o<i.length;o++){var a=i[o];this._interpolate_points(e,r,a)}},t.prototype._interpolate_points=function(e,t,n){var r;null!=(r=i.CoreInterpolate.perform(e,t,n,this.pv.distance_threshold,this.pv.blend_width))&&e.set_attrib_value(n,r)},t}(o.TypedSopNode);t.AttribTransferSopNode=p},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=r.__importDefault(n(209)),i=r.__importDefault(n(207)),a=function(){function e(){}return e.perform=function(e,t,n,r,o){switch(t.length){case 0:return 0;case 1:return this._interpolate_with_1_point(e,t[0],n,r,o);default:return this._interpolate_with_multiple_points(e,t,n,r,o)}},e._interpolate_with_1_point=function(e,t,n,r,o){var i=e.position(),a=t.position(),s=i.distanceTo(a),_=t.attrib_value(n);return this._weighted_value_from_distance(e,_,n,s,r,o)},e._weight_from_distance=function(e,t,n){return(e-t)/n},e._weighted_value_from_distance=function(e,t,n,r,o,i){if(r<=o)return t;var a=e.attrib_value(n),s=this._weight_from_distance(r,o,i);return s*a+(1-s)*t},e._interpolate_with_multiple_points=function(e,t,n,r,i){var a=this,s=t.map((function(t){return a._interpolate_with_1_point(e,t,n,r,i)}));return o.default(s)||0},e.weights=function(e,t){switch(t.length){case 1:return 1;case 2:return this._weights_from_2(e,t);default:return t=t.slice(0,3),this._weights_from_3(e,t)}},e._weights_from_2=function(e,t){var n=t.map((function(t){return e.distanceTo(t)})),r=i.default(n);return[n[1]/r,n[0]/r]},e._weights_from_3=function(e,t){var n=t.map((function(t){return e.distanceTo(t)})),r=i.default([n[0]*n[1],n[0]*n[2],n[1]*n[2]]);return[n[1]*n[2]/r,n[0]*n[2]/r,n[0]*n[1]/r]},e}();t.CoreInterpolate=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(46),i=r.__importDefault(n(102)),a=n(845),s=function(){function e(e){this._root=new a.OctreeNode(e)}return e.prototype.set_points=function(e){this._root.set_points(e)},e.prototype.traverse=function(e){this._root.traverse(e)},e.prototype.find_points=function(e,t,n){var r=new o.Sphere(e,t),a=[];return this._root.intersects_sphere(r)&&this._root.points_in_sphere(r,a),null==n||a.length>n&&(a=(a=i.default(a,(function(t){return t.position().distanceTo(e)}))).slice(0,n)),a},e}();t.CoreOctree=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(58),i=r.__importDefault(n(82)),a=function(){function e(e,t){void 0===t&&(t=0),this._bbox=e,this._level=t,this._leaves_by_octant={},this._points_by_octant_id={},this._leaves=[],this._bounding_boxes_by_octant={},this._bounding_boxes_by_octant_prepared=!1,this._center=this._bbox.max.clone().add(this._bbox.min).multiplyScalar(.5)}return e.prototype.level=function(){return this._level},e.prototype.traverse=function(e){e(this),Object.values(this._leaves_by_octant).forEach((function(t){t.traverse(e)}))},e.prototype.intersects_sphere=function(e){return!!this._bbox&&this._bbox.intersectsSphere(e)},e.prototype.points_in_sphere=function(e,t){0==this._leaves.length?i.default(Object.values(this._points_by_octant_id)).filter((function(t){return e.containsPoint(t.position())})).forEach((function(e){t.push(e)})):this._leaves.filter((function(t){return t.intersects_sphere(e)})).forEach((function(n){return n.points_in_sphere(e,t)}))},e.prototype.bounding_box=function(){return this._bbox},e.prototype.set_points=function(e){var t=this;this._points_by_octant_id={};for(var n=0,r=e;n<r.length;n++){var o=r[n];this.add_point(o)}var i=Object.keys(this._points_by_octant_id);i.length>1&&i.forEach((function(e){t.create_leaf(e)}))},e.prototype.create_leaf=function(t){var n=new e(this._leaf_bbox(t),this._level+1);this._leaves_by_octant[t]=n,this._leaves.push(n),n.set_points(this._points_by_octant_id[t])},e.prototype.add_point=function(e){var t=this._octant_id(e.position());null==this._points_by_octant_id[t]&&(this._points_by_octant_id[t]=[]),this._points_by_octant_id[t].push(e)},e.prototype._octant_id=function(e){return""+(e.x>this._center.x?1:0)+(e.y>this._center.y?1:0)+(e.z>this._center.z?1:0)},e.prototype._leaf_bbox=function(e){return this._bounding_boxes_by_octant_prepared||(this._prepare_leaves_bboxes(),this._bounding_boxes_by_octant_prepared=!0),this._bounding_boxes_by_octant[e]},e.prototype._bbox_center=function(e,t,n){var r=this._bbox.min.clone();return e&&(r.x=this._bbox.max.x),t&&(r.y=this._bbox.max.y),n&&(r.z=this._bbox.max.z),r.clone().add(this._center).multiplyScalar(.5)},e.prototype._prepare_leaves_bboxes=function(){var e=[];e.push(this._bbox_center(0,0,0)),e.push(this._bbox_center(0,0,1)),e.push(this._bbox_center(0,1,0)),e.push(this._bbox_center(0,1,1)),e.push(this._bbox_center(1,0,0)),e.push(this._bbox_center(1,0,1)),e.push(this._bbox_center(1,1,0)),e.push(this._bbox_center(1,1,1));for(var t=this._bbox.max.clone().sub(this._bbox.min).multiplyScalar(.25),n=0,r=e;n<r.length;n++){var i=r[n],a=this._octant_id(i),s=new o.Box3(i.clone().sub(t),i.clone().add(t));this._bounding_boxes_by_octant[a]=s}},e}();t.OctreeNode=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(6),i=n(4),a=r.__importDefault(n(81)),s=n(13),_=n(35),u=n(5),c=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.step_size=u.ParamConfig.FLOAT(.1),t}return r.__extends(t,e),t}(u.NodeParamsConfig)),p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=c,t}return r.__extends(t,e),t.type=function(){return"bbox_scatter"},t.displayed_input_names=function(){return["geometry to create points from"]},t.prototype.initialize_node=function(){this.io.inputs.set_count(1)},t.prototype.cook=function(e){var t=e[0],n=this.pv.step_size,r=t.bounding_box(),s={x:a.default(r.min.x,r.max.x,n),y:a.default(r.min.y,r.max.y,n),z:a.default(r.min.z,r.max.z,n)},u=[];s.x.forEach((function(e){s.y.forEach((function(t){s.z.forEach((function(n){u.push(e),u.push(t),u.push(n)}))}))}));var c=new o.BufferGeometry;c.setAttribute("position",new i.BufferAttribute(new Float32Array(u),3)),this.set_geometry(c,_.CoreConstant.OBJECT_TYPE.POINTS)},t}(s.TypedSopNode);t.BboxScatterSopNode=p},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(13),i=n(5),a=n(17),s=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.attrib_name=i.ParamConfig.STRING(),t.blend=i.ParamConfig.FLOAT(.5,{range:[0,1],range_locked:[!0,!0]}),t}return r.__extends(t,e),t}(i.NodeParamsConfig)),_=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=s,t}return r.__extends(t,e),t.type=function(){return"blend"},t.displayed_input_names=function(){return["geometry to blend from","geometry to blend to"]},t.prototype.initialize_node=function(){this.io.inputs.set_count(2),this.io.inputs.init_inputs_clonable_state([a.InputCloneMode.FROM_NODE,a.InputCloneMode.NEVER])},t.prototype.cook=function(e){for(var t,n,r=e[0],o=e[1],i=r.objects(),a=o.objects(),s=0;s<i.length;s++)t=i[s],n=a[s],this.blend(t,n,this.pv.blend);this.set_core_group(r)},t.prototype.blend=function(e,t,n){var r=e.geometry,o=t.geometry;if(null!=r&&null!=o){var i=r.getAttribute(this.pv.attrib_name),a=o.getAttribute(this.pv.attrib_name);if(null!=i&&null!=a){for(var s,_,u=i.array,c=a.array,p=0;p<u.length;p++)s=u[p],null!=(_=c[p])&&(u[p]=(1-n)*s+n*_);r.computeVertexNormals()}}},t}(o.TypedSopNode);t.BlendSopNode=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(13),i=n(84),a=n(137),s=n(17),_=n(5),u=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.size=_.ParamConfig.FLOAT(1),t.divisions=_.ParamConfig.INTEGER(1,{range:[1,10],range_locked:[!0,!1]}),t.center=_.ParamConfig.VECTOR3([0,0,0]),t}return r.__extends(t,e),t}(_.NodeParamsConfig)),c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=u,t._core_transform=new i.CoreTransform,t}return r.__extends(t,e),t.type=function(){return"box"},t.displayed_input_names=function(){return["geometry to create bounding box from (optional)"]},t.prototype.initialize_node=function(){this.io.inputs.set_count(0,1),this.io.inputs.init_inputs_clonable_state([s.InputCloneMode.NEVER])},t.prototype.cook=function(e){var t=e[0];t?this._cook_with_input(t):this._cook_without_input()},t.prototype._cook_without_input=function(){var e=this.pv.divisions,t=this.pv.size,n=new a.BoxBufferGeometry(t,t,t,e,e,e);n.translate(this.pv.center.x,this.pv.center.y,this.pv.center.z),n.computeVertexNormals(),this.set_geometry(n)},t.prototype._cook_with_input=function(e){var t=this.pv.divisions,n=e.bounding_box(),r=n.max.clone().sub(n.min),o=n.max.clone().add(n.min).multiplyScalar(.5),i=new a.BoxBufferGeometry(r.x,r.y,r.z,t,t,t),s=this._core_transform.translation_matrix(o);i.applyMatrix4(s),this.set_geometry(i)},t}(o.TypedSopNode);t.BoxSopNode=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(411),i=n(13),a=n(5),s=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.cache=a.ParamConfig.STRING("",{hidden:!0}),t.reset=a.ParamConfig.BUTTON(null,{callback:function(e,t){_.PARAM_CALLBACK_reset(e,t)}}),t}return r.__extends(t,e),t}(a.NodeParamsConfig)),_=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=s,t}return r.__extends(t,e),t.type=function(){return"cache"},t.displayed_input_names=function(){return["geometry to cache"]},t.prototype.initialize_node=function(){this.io.inputs.set_count(0,1)},t.prototype.cook=function(e){var t=""==this.pv.cache||null==this.pv.cache,n=e[0];if(t&&n){for(var r=[],i=0,a=n.objects();i<a.length;i++){var s=a[i];r.push(s.toJSON())}this.set_core_group(n),this.p.cache.set(JSON.stringify(r))}else if(this.pv.cache){for(var _=new o.ObjectLoader,u=[],c=0,p=JSON.parse(this.pv.cache);c<p.length;c++){r=p[c];var l=_.parse(r);u.push(l)}this.set_objects(u)}else this.set_objects([])},t.PARAM_CALLBACK_reset=function(e,t){e.param_callback_PARAM_CALLBACK_reset()},t.prototype.param_callback_PARAM_CALLBACK_reset=function(){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(e){return this.p.cache.set(""),this.request_container(),[2]}))}))},t}(i.TypedSopNode);t.CacheSopNode=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(1),i=n(216),a=n(13),s=n(384),_=n(35),u=n(84),c=new o.Vector3(0,0,1),p=n(5),l=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.radius=p.ParamConfig.FLOAT(1),t.segments=p.ParamConfig.INTEGER(12,{range:[1,50],range_locked:[!0,!1]}),t.open=p.ParamConfig.BOOLEAN(1),t.arc_angle=p.ParamConfig.FLOAT(360,{range:[0,360],range_locked:[!1,!1],visible_if:{open:1}}),t.direction=p.ParamConfig.VECTOR3([0,1,0]),t}return r.__extends(t,e),t}(p.NodeParamsConfig)),d=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=l,t._core_transform=new u.CoreTransform,t}return r.__extends(t,e),t.type=function(){return"circle"},t.prototype.initialize_node=function(){},t.prototype.cook=function(){this.pv.open?this._create_circle():this._create_disk()},t.prototype._create_circle=function(){var e=s.CoreGeometryUtilCircle.create(this.pv.radius,this.pv.segments,this.pv.arc_angle);this._core_transform.rotate_geometry(e,c,this.pv.direction),this.set_geometry(e,_.ObjectType.LINE_SEGMENTS)},t.prototype._create_disk=function(){var e=new i.CircleBufferGeometry(this.pv.radius,this.pv.segments);this._core_transform.rotate_geometry(e,c,this.pv.direction),this.set_geometry(e)},t}(a.TypedSopNode);t.CircleSopNode=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(13),i=n(17),a=n(261),s=n(264),_="const core_group = core_groups[0];\nconst object = core_group.objects()[0];\nobject.position.y = -1;\nnode.set_core_group(core_groups[0]);\n\n\n",u=n(5),c=n(367),p=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.code_typescript=u.ParamConfig.STRING(_,{label:!1,language:a.StringParamLanguage.TYPESCRIPT}),t.code_javascript=u.ParamConfig.STRING("",{hidden:!0}),t}return r.__extends(t,e),t}(u.NodeParamsConfig)),l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=p,t}return r.__extends(t,e),t.type=function(){return"code"},t.prototype.initialize_node=function(){this.io.inputs.set_count(0,4),this.ui_data.set_width(100),this.io.inputs.init_inputs_clonable_state([i.InputCloneMode.FROM_NODE])},t.prototype.cook=function(e){this._compile_if_required(),this._function?this._function(this,this.scene,e):this.set_core_group(e[0])},t.prototype._compile_if_required=function(){this._function&&this._last_compiled_code==this.pv.code_javascript||this._compile()},t.prototype._compile=function(){try{this._function=new s.AsyncFunction("node","scene","core_groups","try {\n\t\t\t\t\t"+c.TranspiledFilter.filter(this.pv.code_javascript)+"\n\t\t\t\t} catch(e) {\n\t\t\t\t\tthis.states.error.set(e)\n\t\t\t\t}"),this._last_compiled_code=this.pv.code_javascript}catch(e){console.warn(e),this.states.error.set("cannot generate function ("+e+")"),this._function=void 0}},t}(o.TypedSopNode);t.CodeSopNode=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(7),i=n(853),a=n(13),s=n(17),_=new o.Color(1,1,1),u=n(5),c=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.from_attribute=u.ParamConfig.BOOLEAN(0),t.attrib_name=u.ParamConfig.STRING("",{visible_if:{from_attribute:1}}),t.color=u.ParamConfig.COLOR([1,1,1],{visible_if:{from_attribute:0},expression:{for_entities:!0}}),t.as_hsv=u.ParamConfig.BOOLEAN(0,{visible_if:{from_attribute:0}}),t}return r.__extends(t,e),t}(u.NodeParamsConfig)),p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=c,t._r_arrays_by_geometry_uuid={},t._g_arrays_by_geometry_uuid={},t._b_arrays_by_geometry_uuid={},t}return r.__extends(t,e),t.type=function(){return"color"},t.displayed_input_names=function(){return["geometry to update color of"]},t.prototype.initialize_node=function(){this.io.inputs.set_count(1),this.io.inputs.init_inputs_clonable_state([s.InputCloneMode.FROM_NODE])},t.prototype.cook=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,n,o,i,a,s,_,u;return r.__generator(this,(function(r){switch(r.label){case 0:t=e[0],n=t.core_objects(),o=0,i=n,r.label=1;case 1:return o<i.length?(a=i[o],this.pv.from_attribute?(this._set_from_attribute(a),[3,5]):[3,2]):[3,6];case 2:return this.p.color.has_expression()?[4,this._eval_expressions(a)]:[3,4];case 3:return r.sent(),[3,5];case 4:this._eval_simple_values(a),r.label=5;case 5:return o++,[3,1];case 6:if(!this.io.inputs.input_cloned(0))for(s=t.geometries(),_=0,u=s;_<u.length;_++)u[_].getAttribute("color").needsUpdate=!0;return this.set_core_group(t),[2]}}))}))},t.prototype._set_from_attribute=function(e){var t=e.core_geometry();this._create_init_color(t,_);var n=t.points(),r=t.attrib_size(this.pv.attrib_name),o=t.geometry(),i=o.getAttribute(this.pv.attrib_name).array,a=o.getAttribute("color").array;switch(r){case 1:for(var s=0;s<n.length;s++){a[(c=3*s)+0]=i[s],a[c+1]=1-i[s],a[c+2]=0}break;case 2:for(s=0;s<n.length;s++){var u=2*s;a[(c=3*s)+0]=i[u+0],a[c+1]=i[u+1],a[c+2]=0}break;case 3:for(s=0;s<i.length;s++)a[s]=i[s];break;case 4:for(s=0;s<n.length;s++){var c;u=4*s;a[(c=3*s)+0]=i[u+0],a[c+1]=i[u+1],a[c+2]=i[u+2]}}},t.prototype._create_init_color=function(e,t){e.has_attrib("color")||e.add_numeric_attrib("color",3,_)},t.prototype._eval_simple_values=function(e){var t,n=e.core_geometry();this._create_init_color(n,_),this.pv.as_hsv?(t=new o.Color,i.CoreColor.set_hsv(this.pv.color.r,this.pv.color.g,this.pv.color.b,t)):t=this.pv.color,n.add_numeric_attrib("color",3,t)},t.prototype._eval_expressions=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,n,a,s,u,c,p,l,d,f,h,m,y,v;return r.__generator(this,(function(r){switch(r.label){case 0:return t=e.points(),n=e.object(),a=e.core_geometry(),this._create_init_color(a,_),(s=n.geometry)?(u=s.getAttribute("color").array,[4,this._update_from_param(s,u,t,0)]):[3,4];case 1:return c=r.sent(),[4,this._update_from_param(s,u,t,1)];case 2:return p=r.sent(),[4,this._update_from_param(s,u,t,2)];case 3:if(l=r.sent(),c&&this._commit_tmp_values(c,u,0),p&&this._commit_tmp_values(p,u,1),l&&this._commit_tmp_values(l,u,2),this.pv.as_hsv)for(d=new o.Color,f=new o.Color,h=void 0,m=0,y=t;m<y.length;m++)v=y[m],h=3*v.index,d.fromArray(u,h),i.CoreColor.set_hsv(d.r,d.g,d.b,f),f.toArray(u,h);r.label=4;case 4:return[2]}}))}))},t.prototype._update_from_param=function(e,t,n,o){return r.__awaiter(this,void 0,void 0,(function(){var i,a,s,_,u,c,p;return r.__generator(this,(function(r){switch(r.label){case 0:return i=this.p.color.components[o],a=[this.pv.color.r,this.pv.color.g,this.pv.color.b][o],s=[this._r_arrays_by_geometry_uuid,this._g_arrays_by_geometry_uuid,this._b_arrays_by_geometry_uuid][o],i.has_expression()&&i.expression_controller?(_=this._init_array_if_required(e,s,n.length),[4,i.expression_controller.compute_expression_for_points(n,(function(e,t){_[e.index]=t}))]):[3,2];case 1:return r.sent(),[3,3];case 2:for(u=0,c=n;u<c.length;u++)p=c[u],t[3*p.index+o]=a;r.label=3;case 3:return[2,_]}}))}))},t.prototype._init_array_if_required=function(e,t,n){var r=e.uuid,o=t[r];return o?o.length<n&&(t[r]=new Array(n)):t[r]=new Array(n),t[r]},t.prototype._commit_tmp_values=function(e,t,n){for(var r=0;r<e.length;r++)t[3*r+n]=e[r]},t}(a.TypedSopNode);t.ColorSopNode=p},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(14),o=function(){function e(){}return e.set_hsv=function(e,t,n,o){e=r.MathUtils.euclideanModulo(e,1),t=r.MathUtils.clamp(t,0,1),n=r.MathUtils.clamp(n,0,1),o.setHSL(e,t*n/((e=(2-t)*n)<1?e:2-e),.5*e)},e}();t.CoreColor=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(13),i=n(1),a=n(215),s=n(84),_=new i.Vector3(0,1,0),u=n(5),c=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.radius=u.ParamConfig.FLOAT(1,{range:[0,1]}),t.height=u.ParamConfig.FLOAT(1,{range:[0,1]}),t.segments_radial=u.ParamConfig.INTEGER(12,{range:[3,20],range_locked:[!0,!1]}),t.segments_height=u.ParamConfig.INTEGER(1,{range:[1,20],range_locked:[!0,!1]}),t.cap=u.ParamConfig.BOOLEAN(1),t.theta_start=u.ParamConfig.FLOAT(1,{range:[0,1]}),t.theta_length=u.ParamConfig.FLOAT("2*$PI",{range:[0,1]}),t.center=u.ParamConfig.VECTOR3([0,0,0]),t.direction=u.ParamConfig.VECTOR3([0,0,1]),t}return r.__extends(t,e),t}(u.NodeParamsConfig)),p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=c,t._core_transform=new s.CoreTransform,t}return r.__extends(t,e),t.type=function(){return"cone"},t.prototype.cook=function(){var e=new a.ConeBufferGeometry(this.pv.radius,this.pv.height,this.pv.segments_radial,this.pv.segments_height,!this.pv.cap,this.pv.theta_start,this.pv.theta_length);this._core_transform.rotate_geometry(e,_,this.pv.direction),e.translate(this.pv.center.x,this.pv.center.y,this.pv.center.z),this.set_geometry(e)},t}(o.TypedSopNode);t.ConeSopNode=p},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=r.__importDefault(n(92)),i=n(13),a=n(276),s=n(385),_=n(49),u=n(856),c=n(5),p=n(17),l=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.count=c.ParamConfig.INTEGER(1,{range:[1,20],range_locked:[!0,!1]}),t.transform_only=c.ParamConfig.BOOLEAN(0),t.copy_attributes=c.ParamConfig.BOOLEAN(0),t.attributes_to_copy=c.ParamConfig.STRING("",{visible_if:{copy_attributes:!0}}),t.use_copy_expr=c.ParamConfig.BOOLEAN(0),t}return r.__extends(t,e),t}(c.NodeParamsConfig)),d=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=l,t._attribute_names_to_copy=[],t._objects=[],t}return r.__extends(t,e),t.type=function(){return"copy"},t.displayed_input_names=function(){return["geometry to be copied","points to copy to"]},t.prototype.initialize_node=function(){this.io.inputs.set_count(1,2),this.io.inputs.init_inputs_clonable_state([p.InputCloneMode.ALWAYS,p.InputCloneMode.NEVER])},t.prototype.cook=function(){return r.__awaiter(this,void 0,void 0,(function(){var e,t,n,o;return r.__generator(this,(function(r){switch(r.label){case 0:return[4,this.container_controller.request_input_container(0)];case 1:return null==(t=r.sent())||null==(e=t.core_content())?[3,8]:this.io.inputs.has_input(1)?(n=void 0,[4,this.container_controller.request_input_container(1)]):[3,6];case 2:return null==(o=r.sent())||null==(n=o.core_content())?[3,4]:[4,this.cook_with_template(e,n)];case 3:return r.sent(),[3,5];case 4:this.states.error.set("second input required"),r.label=5;case 5:return[3,7];case 6:this.cook_without_template(e),r.label=7;case 7:return[3,9];case 8:this.states.error.set("first input required"),r.label=9;case 9:return[2]}}))}))},t.prototype.cook_with_template=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var n,o,i;return r.__generator(this,(function(r){switch(r.label){case 0:return this._objects=[],n=t.points(),o=new s.CoreInstancer(t),i=o.matrices(),this._attribute_names_to_copy=_.CoreString.attrib_names(this.pv.attributes_to_copy).filter((function(e){return t.has_attrib(e)})),[4,this._copy_moved_objects_on_template_points(e,i,n)];case 1:return r.sent(),this.set_objects(this._objects),[2]}}))}))},t.prototype._copy_moved_objects_on_template_points=function(e,t,n){return r.__awaiter(this,void 0,void 0,(function(){var o;return r.__generator(this,(function(r){switch(r.label){case 0:o=0,r.label=1;case 1:return o<n.length?[4,this._copy_moved_object_on_template_point(e,t,n,o)]:[3,4];case 2:r.sent(),r.label=3;case 3:return o++,[3,1];case 4:return[2]}}))}))},t.prototype._copy_moved_object_on_template_point=function(e,t,n,o){var i=this;return new Promise((function(a,s){return r.__awaiter(i,void 0,void 0,(function(){var i,s,_=this;return r.__generator(this,(function(r){switch(r.label){case 0:return i=t[o],s=n[o],this.stamp_node.set_point(s),[4,this._get_moved_objects_for_template_point(e,o)];case 1:return r.sent().forEach((function(e){return _.pv.copy_attributes&&_._copy_attributes_from_template(e,s),_.pv.transform_only?e.applyMatrix4(i):e.geometry.applyMatrix4(i),_._objects.push(e)})),[2,a()]}}))}))}))},t.prototype._get_moved_objects_for_template_point=function(e,t){var n=this;return new Promise((function(i,a){return r.__awaiter(n,void 0,void 0,(function(){var n;return r.__generator(this,(function(r){switch(r.label){case 0:return[4,this._stamp_instance_group_if_required(e)];case 1:return r.sent()?(n=this.pv.transform_only?o.default([e.objects()[t]]):e.clone().objects(),i(n)):i([]),[2]}}))}))}))},t.prototype._stamp_instance_group_if_required=function(e){var t=this;return new Promise((function(n,o){return r.__awaiter(t,void 0,void 0,(function(){var t,o;return r.__generator(this,(function(r){switch(r.label){case 0:return this.pv.use_copy_expr?[4,this.container_controller.request_input_container(0)]:[3,2];case 1:return t=r.sent(),o=void 0,t&&null!=(o=t.core_content())?n(o):(this.states.error.set("input failed for index "+this.stamp_value()),n()),[3,3];case 2:n(e),r.label=3;case 3:return[2]}}))}))}))},t.prototype._copy_moved_objects_for_each_instance=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t;return r.__generator(this,(function(n){switch(n.label){case 0:t=0,n.label=1;case 1:return t<this.pv.count?[4,this._copy_moved_objects_for_instance(e,t)]:[3,4];case 2:n.sent(),n.label=3;case 3:return t++,[3,1];case 4:return[2]}}))}))},t.prototype._copy_moved_objects_for_instance=function(e,t){var n=this;return new Promise((function(o,i){return r.__awaiter(n,void 0,void 0,(function(){var n,i=this;return r.__generator(this,(function(r){switch(r.label){case 0:return this.stamp_node.set_global_index(t),[4,this._stamp_instance_group_if_required(e)];case 1:return(n=r.sent())&&n.objects().forEach((function(e){var t=a.CoreObject.clone(e);i._objects.push(t)})),o(),[2]}}))}))}))},t.prototype.cook_without_template=function(e){var t=this;this._objects=[],this._copy_moved_objects_for_each_instance(e).then((function(){t.set_objects(t._objects)}))},t.prototype._copy_attributes_from_template=function(e,t){this._attribute_names_to_copy.forEach((function(n,r){var o=t.attrib_value(n);new a.CoreObject(e,r).add_attribute(n,o)}))},t.prototype.stamp_value=function(e){return this.stamp_node.value(e)},Object.defineProperty(t.prototype,"stamp_node",{get:function(){return this._stamp_node=this._stamp_node||this.create_stamp_node()},enumerable:!0,configurable:!0}),t.prototype.create_stamp_node=function(){var e=new u.CopyStamp(this.scene);return this.dirty_controller.set_forbidden_trigger_nodes([e]),e},t}(i.TypedSopNode);t.CopySopNode=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=function(e){function t(t){var n=e.call(this,t,"CopyStamp")||this;return n._global_index=0,n}return r.__extends(t,e),t.prototype.set_point=function(e){this._point=e,this.set_dirty(),this.remove_dirty_state()},t.prototype.set_global_index=function(e){this._global_index=e,this.set_dirty(),this.remove_dirty_state()},t.prototype.value=function(e){return this._point?e?this._point.attrib_value(e):this._point.index:this._global_index},t}(n(67).CoreGraphNode);t.CopyStamp=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(13),i=n(386),a=JSON.stringify([{value:-40},{value:-30},{value:-20},{value:-10},{value:0},{value:10},{value:20},{value:30},{value:40},{value:50},{value:60},{value:70},{value:80}]),s=n(5),_=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.data=s.ParamConfig.STRING(a),t}return r.__extends(t,e),t}(s.NodeParamsConfig)),u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=_,t}return r.__extends(t,e),t.type=function(){return"data"},t.prototype.cook=function(){var e=null;try{e=JSON.parse(this.pv.data)}catch(e){this.states.error.set("could not parse json")}if(e){var t=new i.JsonDataLoader;t.set_json(e);var n=t.create_object();this.set_object(n)}else this.cook_controller.end_cook()},t}(o.TypedSopNode);t.DataSopNode=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=r.__importDefault(n(21)),i=r.__importDefault(n(45)),a=n(35),s=function(){function e(e,t){this._size=e,this._type=t}return e.prototype.size=function(){return this._size},e.prototype.type=function(){return this._type},e.from_value=function(e){var t=i.default(e)?a.CoreConstant.ATTRIB_TYPE.STRING:a.CoreConstant.ATTRIB_TYPE.NUMERIC;return new this(o.default(e)?e.length:1,t)},e}();t.CoreAttributeData=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(13),i=n(386),a=n(5),s=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.url=a.ParamConfig.STRING("/examples/sop/data_url/basic.json"),t.json_data_keys_prefix=a.ParamConfig.STRING(""),t.skip_entries=a.ParamConfig.STRING(""),t.convert=a.ParamConfig.BOOLEAN(0),t.convert_to_numeric=a.ParamConfig.STRING("",{visible_if:{convert:1}}),t.reload=a.ParamConfig.BUTTON(null,{callback:function(e,t){_.PARAM_CALLBACK_reload(e,t)}}),t}return r.__extends(t,e),t}(a.NodeParamsConfig)),_=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=s,t}return r.__extends(t,e),t.type=function(){return"data_url"},t.prototype.cook=function(){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(e){return new i.JsonDataLoader({data_keys_prefix:this.pv.json_data_keys_prefix,skip_entries:this.pv.skip_entries,do_convert:this.pv.convert,convert_to_numeric:this.pv.convert_to_numeric}).load(this.pv.url,this._on_load.bind(this),void 0,this._on_error.bind(this)),[2]}))}))},t.prototype._on_load=function(e){this.set_objects([e])},t.prototype._on_error=function(e){this.states.error.set("could not load geometry from "+this.pv.url+" ("+e+")"),this.cook_controller.end_cook()},t.PARAM_CALLBACK_reload=function(e,t){e.param_callback_reload()},t.prototype.param_callback_reload=function(){this.p.url.set_dirty()},t}(o.TypedSopNode);t.DataUrlSopNode=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(13),i=n(5),a=n(17),s=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.duration=i.ParamConfig.INTEGER(1e3),t}return r.__extends(t,e),t}(i.NodeParamsConfig)),_=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=s,t}return r.__extends(t,e),t.type=function(){return"delay"},t.prototype.initialize_node=function(){this.io.inputs.set_count(1),this.io.inputs.init_inputs_clonable_state([a.InputCloneMode.ALWAYS])},t.prototype.cook=function(e){var t=this,n=e[0];setTimeout((function(){t.set_core_group(n)}),this.pv.duration)},t}(o.TypedSopNode);t.DelaySopNode=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,o=n(2),i=n(58),a=o.__importDefault(n(45)),s=o.__importDefault(n(180)),_=n(13),u=n(49),c=n(35),p=n(53),l=n(17);!function(e){e[e["=="]=0]="==",e[e["<"]=1]="<",e[e["<="]=2]="<=",e[e[">="]=3]=">=",e[e[">"]=4]=">",e[e["!="]=5]="!="}(r||(r={}));var d=[{name:"==",value:r["=="]},{name:"<",value:r["<"]},{name:"<=",value:r["<="]},{name:">=",value:r[">="]},{name:">",value:r[">"]},{name:"!=",value:r["!="]}],f=n(5),h=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.class=f.ParamConfig.INTEGER(c.AttribClass.VERTEX,{menu:{entries:c.AttribClassMenuEntries}}),t.invert=f.ParamConfig.BOOLEAN(0),t.hide_objects=f.ParamConfig.BOOLEAN(0),t.by_object_type=f.ParamConfig.BOOLEAN(0),t.object_type=f.ParamConfig.INTEGER(c.ObjectTypes.indexOf(c.ObjectType.MESH),{menu:{entries:c.ObjectTypeMenuEntries},visible_if:{by_object_type:!0}}),t.by_expression=f.ParamConfig.BOOLEAN(0),t.expression=f.ParamConfig.BOOLEAN("@ptnum==0",{visible_if:{by_expression:!0},expression:{for_entities:!0}}),t.by_attrib=f.ParamConfig.BOOLEAN(0),t.attrib_name=f.ParamConfig.STRING("",{visible_if:{by_attrib:!0}}),t.attrib_string=f.ParamConfig.STRING("",{visible_if:{by_attrib:!0}}),t.attrib_numeric=f.ParamConfig.VECTOR4([0,0,0,0],{visible_if:{by_attrib:!0}}),t.attrib_comparison_operator=f.ParamConfig.INTEGER(r["=="],{menu:{entries:d},visible_if:{by_attrib:!0}}),t.by_bbox=f.ParamConfig.BOOLEAN(0),t.bbox_size=f.ParamConfig.VECTOR3([1,1,1],{visible_if:{by_bbox:!0}}),t.bbox_center=f.ParamConfig.VECTOR3([0,0,0],{visible_if:{by_bbox:!0}}),t.by_visible=f.ParamConfig.BOOLEAN(0),t.keep_points=f.ParamConfig.BOOLEAN(1,{visible_if:{class:c.AttribClass.OBJECT}}),t}return o.__extends(t,e),t}(f.NodeParamsConfig)),m=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=h,t._marked_for_deletion_per_object_index=new Map,t}return o.__extends(t,e),t.type=function(){return"delete"},t.displayed_input_names=function(){return["geometry to delete from"]},t.prototype.initialize_node=function(){this.io.inputs.set_count(1),this.io.inputs.init_inputs_clonable_state([l.InputCloneMode.FROM_NODE])},t.prototype.cook=function(e){return o.__awaiter(this,void 0,void 0,(function(){var t;return o.__generator(this,(function(n){switch(n.label){case 0:switch(t=e[0],this._bbox_cache=void 0,this.pv.class){case c.AttribClass.VERTEX:return[3,1];case c.AttribClass.OBJECT:return[3,3]}return[3,5];case 1:return[4,this._eval_for_points(t)];case 2:return n.sent(),[3,5];case 3:return[4,this._eval_for_objects(t)];case 4:return n.sent(),[3,5];case 5:return[2]}}))}))},t.prototype._eval_for_objects=function(e){return o.__awaiter(this,void 0,void 0,(function(){var t,n,r,i,a,s,_,u,c,p,l,d=this;return o.__generator(this,(function(o){switch(o.label){case 0:for(t=[],n=e.core_objects(),this._marked_for_deletion_per_object_index=new Map,r=0,i=n;r<i.length;r++)a=i[r],this._marked_for_deletion_per_object_index.set(a.index,!1);return this.pv.by_expression?[4,this._eval_expressions_for_objects(n)]:[3,2];case 1:o.sent(),o.label=2;case 2:for(this.pv.by_object_type&&this._eval_type_for_objects(n),this.pv.by_attrib&&""!==this.pv.attrib_name&&this._eval_attrib_for_objects(n),this.pv.invert&&this._marked_for_deletion_per_object_index.forEach((function(e,t){d._marked_for_deletion_per_object_index.set(t,!e)})),u=[],this._marked_for_deletion_per_object_index.forEach((function(e,r){s=n[r],_=s.object(),d.pv.hide_objects?(t.push(_),e&&(_.visible=!1)):(e||t.push(_),e&&u.push(d._point_object(s)))})),c=0,p=u;c<p.length;c++)l=p[c],t.push(l);return this.set_objects(t),[2]}}))}))},t.prototype._eval_for_points=function(e){return o.__awaiter(this,void 0,void 0,(function(){var t,n,r,i,a,s,_;return o.__generator(this,(function(o){switch(o.label){case 0:t=e.core_objects(),r=0,o.label=1;case 1:return r<t.length?(n=t[r],(i=n.core_geometry())?(a=i.points_from_geometry(),s=a.length,this.pv.by_expression?[4,this._eval_expressions_for_points(a)]:[3,3]):[3,4]):[3,5];case 2:a=o.sent(),o.label=3;case 3:this.pv.by_attrib&&""!==this.pv.attrib_name&&(a=this._eval_attrib_for_points(a)),this.pv.by_bbox&&(a=this._eval_bbox_for_points(a)),a.length!=s&&(_=n.object(),i.geometry().dispose(),a.length>0?_.geometry=p.CoreGeometry.geometry_from_points(a,_.constructor):null!=_.parent&&_.parent.remove(_)),o.label=4;case 4:return r++,[3,1];case 5:return this.set_core_group(e),[2]}}))}))},t.prototype._eval_expressions_for_points=function(e){return o.__awaiter(this,void 0,void 0,(function(){var t,n,r,i,a,s=this;return o.__generator(this,(function(o){switch(o.label){case 0:return t=[],n=this.p.expression,this.p.expression.has_expression()&&n.expression_controller?[4,n.expression_controller.compute_expression_for_points(e,(function(e,n){var r=!n;s.pv.invert&&(r=!r),r&&t.push(e)}))]:[3,2];case 1:return o.sent(),[3,3];case 2:for(r=this.pv.expression,i=!r,this.pv.invert&&(i=!i),a=0;a<e.length;a++)i&&t.push(e[a]);o.label=3;case 3:return console.log(t),[2,t]}}))}))},t.prototype._eval_expressions_for_objects=function(e){return o.__awaiter(this,void 0,void 0,(function(){var t,n,r,i,a=this;return o.__generator(this,(function(o){switch(o.label){case 0:return(t=this.p.expression).has_expression()&&t.expression_controller?[4,t.expression_controller.compute_expression_for_objects(e,(function(e,t){a._marked_for_deletion_per_object_index.get(e.index)||a._marked_for_deletion_per_object_index.set(e.index,t)}))]:[3,2];case 1:return o.sent(),[3,3];case 2:for(n=0,r=e;n<r.length;n++)i=r[n],this._marked_for_deletion_per_object_index.set(i.index,t.value);o.label=3;case 3:return[2]}}))}))},t.prototype._eval_attrib_for_points=function(e){var t=this,n=[];if(e.length>0){var r=e[0].attrib_value(this.pv.attrib_name);(a.default(r)?u.CoreString.attrib_names(this.pv.attrib_string):[this.pv.attrib_numeric.x]).forEach((function(r){return e.forEach((function(e){var o=e.attrib_value(t.pv.attrib_name),i=!t._comparison(o,r);if(t.pv.invert&&(i=!i),i)return n.push(e)}))}))}return n},t.prototype._comparison=function(e,t){switch(this.pv.attrib_ComparisonOperator){case r["=="]:return e===t;case r["<="]:return e<=t;case r["<"]:return e<t;case r[">"]:return e>t;case r[">="]:return e>=t;case r["!="]:return e!==t}},t.prototype._eval_type_for_objects=function(e){for(var t=c.ObjectTypes[this.pv.object_type],n=0,r=e;n<r.length;n++){var o=r[n];if(!this._marked_for_deletion_per_object_index.get(o.index))o.object().constructor.name===t&&this._marked_for_deletion_per_object_index.set(o.index,!0)}},t.prototype._eval_attrib_for_objects=function(e){for(var t=0,n=e;t<n.length;t++){var r=n[t];if(!this._marked_for_deletion_per_object_index.get(r.index)){var o=r.attrib_value(this.pv.attrib_name);o===(a.default(o)?this.pv.attrib_string:this.pv.attrib_float)&&this._marked_for_deletion_per_object_index.set(r.index,!0)}}},t.prototype._eval_bbox_for_points=function(e){var t=this,n=[];return s.default(e,(function(e,r){var o=t._bbox.containsPoint(e.position());if(t.pv.invert?o:!o)return n.push(e)})),n},Object.defineProperty(t.prototype,"_bbox",{get:function(){return null!=this._bbox_cache?this._bbox_cache:this._bbox_cache=new i.Box3(this.pv.bbox_center.clone().sub(this.pv.bbox_size.clone().multiplyScalar(.5)),this.pv.bbox_center.clone().add(this.pv.bbox_size.clone().multiplyScalar(.5)))},enumerable:!0,configurable:!0}),t.prototype._point_object=function(e){var t=e.points(),n=p.CoreGeometry.geometry_from_points(t,e.object().constructor);return this.create_object(n,c.ObjectType.POINTS)},t}(_.TypedSopNode);t.DeleteSopNode=m},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(1),i=n(4),a=r.__importDefault(n(81)),s=r.__importDefault(n(208)),_=r.__importDefault(n(379)),u=n(13),c=n(17),p=n(5),l=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.make_faces_unique=p.ParamConfig.BOOLEAN(0),t.add_face_center_attribute=p.ParamConfig.BOOLEAN(0,{visible_if:{make_faces_unique:1}}),t.add_face_id=p.ParamConfig.BOOLEAN(0,{visible_if:{make_faces_unique:1}}),t.transform=p.ParamConfig.BOOLEAN(0,{visible_if:{make_faces_unique:1}}),t.scale=p.ParamConfig.FLOAT(1,{visible_if:{make_faces_unique:1,transform:1}}),t}return r.__extends(t,e),t}(p.NodeParamsConfig)),d=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=l,t}return r.__extends(t,e),t.type=function(){return"face"},t.prototype.initialize_node=function(){this.io.inputs.set_count(1),this.io.inputs.init_inputs_clonable_state([c.InputCloneMode.FROM_NODE])},t.prototype.cook=function(e){var t=e[0];this.pv.make_faces_unique&&(this._make_faces_unique(t),this.pv.add_face_center_attribute&&this._add_face_center_attribute(t),this.pv.add_face_id&&this._add_face_id(t),this.pv.transform&&this._transform_faces(t)),this.set_core_group(t)},t.prototype._make_faces_unique=function(e){for(var t,n=0,r=e.objects();n<r.length;n++){var o=r[n];if(o.isMesh){for(var u=o.geometry,c=_.default((null===(t=u.index)||void 0===t?void 0:t.array)||[],3),p=3*c.length,l=function(e){var t=u.attributes[e],n=t.itemSize,r=new Float32Array(p*n),o=0;c.forEach((function(e){e.forEach((function(e){s.default(n,(function(i){var a=t.array[e*n+i];r[o]=a,o+=1}))}))})),u.setAttribute(e,new i.BufferAttribute(r,n))},d=0,f=Object.keys(u.attributes);d<f.length;d++){l(f[d])}var h=a.default(p);u.setIndex(h)}}},t.prototype._add_face_center_attribute=function(e){var t,n,r,i=new o.Vector3;e.core_objects().forEach((function(e){var o=e.object(),a=e.core_geometry();if(o.isMesh){t=a.faces(),a.has_attrib("face_center")||a.add_numeric_attrib("face_center",3,-1);for(var s=0;s<t.length;s++){(n=t[s]).center(i),r=n.points;for(var _=0;_<r.length;_++)r[_].set_attrib_value("face_center",i)}}}))},t.prototype._add_face_id=function(e){e.core_objects().forEach((function(e){var t=e.object(),n=e.core_geometry();if(t.isMesh){var r=n.faces();n.has_attrib("face_id")||n.add_numeric_attrib("face_id",1,-1);for(var o=0;o<r.length;o++)for(var i=r[o].points,a=0;a<i.length;a++){i[a].set_attrib_value("face_id",o)}}}))},t.prototype._transform_faces=function(e){var t,n,r,i,a=new o.Vector3,s=new o.Vector3,_=this.pv.scale;e.core_objects().forEach((function(e){var o=e.object(),u=e.core_geometry();if(o.isMesh){t=u.faces(),u.has_attrib("position")||u.add_numeric_attrib("position",3,-1);for(var c=0;c<t.length;c++){(n=t[c]).center(a),r=n.points;for(var p=0;p<r.length;p++){var l=(i=r[p]).position();s.x=l.x*_+a.x*(1-_),s.y=l.y*_+a.y*(1-_),s.z=l.z*_+a.z*(1-_),i.set_attrib_value("position",s)}}}}))},t}(u.TypedSopNode);t.FaceSopNode=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=r.__importDefault(n(82)),i=n(13),a=n(864),s=n(5),_=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.url=s.ParamConfig.STRING("",{desktop_browse:{file_type:"geometry"},always_reference_asset:!0}),t.reload=s.ParamConfig.BUTTON(null,{callback:function(e,t){u.PARAM_CALLBACK_reload(e)}}),t}return r.__extends(t,e),t}(s.NodeParamsConfig)),u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=_,t}return r.__extends(t,e),t.type=function(){return"file"},t.prototype.initialize_node=function(){},t.prototype.cook=function(){new a.CoreLoaderGeometry(this.pv.url).load(this._on_load.bind(this),this._on_error.bind(this))},t.prototype._on_load=function(e){console.log("objects",e),e=o.default(e),this.set_objects(e)},t.prototype._on_error=function(e){this.states.error.set("could not load geometry from "+this.pv.url+" ("+e+")")},t.PARAM_CALLBACK_reload=function(e){e.param_callback_reload()},t.prototype.param_callback_reload=function(){this.p.url.set_dirty()},t}(i.TypedSopNode);t.FileSopNode=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(411),i=n(10),a=n(6),s=n(22),_=n(160),u=function(){function e(e){this.url=e;var t=this.url.split(".");this.ext=t[t.length-1].toLowerCase(),"zip"===this.ext&&(this.ext=t[t.length-2])}return e.prototype.load=function(e,t){this.load_auto().then((function(t){e(t)})).catch((function(e){t(e)}))},e.prototype.load_auto=function(){var e=this;return new Promise((function(t,n){return r.__awaiter(e,void 0,void 0,(function(){var e,i,a,s=this;return r.__generator(this,(function(_){switch(_.label){case 0:return e=this.url,"json"!=this.ext?[3,1]:(fetch(e).then((function(e){return r.__awaiter(s,void 0,void 0,(function(){var n,i=this;return r.__generator(this,(function(r){switch(r.label){case 0:return[4,e.json()];case 1:return n=r.sent(),(new o.ObjectLoader).parse(n,(function(e){t(i.on_load_success(e.children[0]))})),[2]}}))}))})).catch((function(e){n(e)})),[3,3]);case 1:return[4,this.loader_for_ext()];case 2:(i=_.sent())?i.load(e,(function(e){console.log(e),s.on_load_success(e).then((function(e){t(e)}))}),void 0,(function(e){n(e)})):(a="format not supported ("+this.ext+")",n(a)),_.label=3;case 3:return[2]}}))}))}))},e.prototype.on_load_success=function(e){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(t){if(e instanceof i.Object3D)switch(this.ext){case"gltf":case"glb":return[2,this.on_load_succes_gltf(e)];case"obj":case"json":default:return[2,[e]]}if(e instanceof a.BufferGeometry)switch(this.ext){case"drc":return[2,this.on_load_succes_drc(e)];default:return[2,[new s.Mesh(e)]]}switch(this.ext){case"gltf":case"glb":return[2,this.on_load_succes_gltf(e)];default:return[2,[]]}return[2,[]]}))}))},e.prototype.on_load_succes_gltf=function(e){var t=e.scene;return t.animations=e.animations,console.log("[scene]",[t]),[t]},e.prototype.on_load_succes_drc=function(e){var t=new _.MeshLambertMaterial;return[new s.Mesh(e,t)]},e.prototype.loader_for_ext=function(){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(e){switch(this.ext.toLowerCase()){case"gltf":return[2,this.loader_for_gltf()];case"glb":return[2,this.loader_for_glb()];case"drc":return[2,this.loader_for_drc()];case"obj":return[2,this.loader_for_obj()]}return[2]}))}))},e.prototype.loader_for_gltf=function(){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(e){switch(e.label){case 0:return[4,Promise.resolve().then((function(){return r.__importStar(n(387))}))];case 1:return[2,new(0,e.sent().GLTFLoader)]}}))}))},e.prototype.loader_for_glb=function(){return r.__awaiter(this,void 0,void 0,(function(){var e,t,o,i;return r.__generator(this,(function(a){switch(a.label){case 0:return[4,Promise.resolve().then((function(){return r.__importStar(n(387))}))];case 1:return e=a.sent().GLTFLoader,[4,Promise.resolve().then((function(){return r.__importStar(n(388))}))];case 2:return t=a.sent().DRACOLoader,o=new e,i=new t,"/three/js/libs/draco/gltf/",i.setDecoderPath("/three/js/libs/draco/gltf/"),i.setDecoderConfig({type:"js"}),o.setDRACOLoader(i),[2,o]}}))}))},e.prototype.loader_for_drc=function(){return r.__awaiter(this,void 0,void 0,(function(){var e,t;return r.__generator(this,(function(o){switch(o.label){case 0:return[4,Promise.resolve().then((function(){return r.__importStar(n(388))}))];case 1:return e=o.sent().DRACOLoader,t=new e,"/three/js/libs/draco/",t.setDecoderPath("/three/js/libs/draco/"),t.setDecoderConfig({type:"js"}),[2,t]}}))}))},e.prototype.loader_for_obj=function(){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(e){switch(e.label){case 0:return[4,Promise.resolve().then((function(){return r.__importStar(n(865))}))];case 1:return[2,new(0,e.sent().OBJLoader)]}}))}))},e}();t.CoreLoaderGeometry=u},function(e,t,n){"use strict";n.r(t),n.d(t,"OBJLoader",(function(){return h}));var r=n(6),o=n(30),i=n(4),a=n(40),s=n(41),_=n(57),u=n(18),c=n(9),p=n(22),l=n(227),d=n(96),f=n(71),h=function(){var e=/^[og]\s*(.+)?/,t=/^mtllib /,n=/^usemtl /,h=/^usemap /;function m(){var e={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materials:{},materialLibraries:[],startObject:function(e,t){if(this.object&&!1===this.object.fromDeclaration)return this.object.name=e,void(this.object.fromDeclaration=!1!==t);var n=this.object&&"function"==typeof this.object.currentMaterial?this.object.currentMaterial():void 0;if(this.object&&"function"==typeof this.object._finalize&&this.object._finalize(!0),this.object={name:e||"",fromDeclaration:!1!==t,geometry:{vertices:[],normals:[],colors:[],uvs:[]},materials:[],smooth:!0,startMaterial:function(e,t){var n=this._finalize(!1);n&&(n.inherited||n.groupCount<=0)&&this.materials.splice(n.index,1);var r={index:this.materials.length,name:e||"",mtllib:Array.isArray(t)&&t.length>0?t[t.length-1]:"",smooth:void 0!==n?n.smooth:this.smooth,groupStart:void 0!==n?n.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(e){var t={index:"number"==typeof e?e:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return t.clone=this.clone.bind(t),t}};return this.materials.push(r),r},currentMaterial:function(){if(this.materials.length>0)return this.materials[this.materials.length-1]},_finalize:function(e){var t=this.currentMaterial();if(t&&-1===t.groupEnd&&(t.groupEnd=this.geometry.vertices.length/3,t.groupCount=t.groupEnd-t.groupStart,t.inherited=!1),e&&this.materials.length>1)for(var n=this.materials.length-1;n>=0;n--)this.materials[n].groupCount<=0&&this.materials.splice(n,1);return e&&0===this.materials.length&&this.materials.push({name:"",smooth:this.smooth}),t}},n&&n.name&&"function"==typeof n.clone){var r=n.clone(0);r.inherited=!0,this.object.materials.push(r)}this.objects.push(this.object)},finalize:function(){this.object&&"function"==typeof this.object._finalize&&this.object._finalize(!0)},parseVertexIndex:function(e,t){var n=parseInt(e,10);return 3*(n>=0?n-1:n+t/3)},parseNormalIndex:function(e,t){var n=parseInt(e,10);return 3*(n>=0?n-1:n+t/3)},parseUVIndex:function(e,t){var n=parseInt(e,10);return 2*(n>=0?n-1:n+t/2)},addVertex:function(e,t,n){var r=this.vertices,o=this.object.geometry.vertices;o.push(r[e+0],r[e+1],r[e+2]),o.push(r[t+0],r[t+1],r[t+2]),o.push(r[n+0],r[n+1],r[n+2])},addVertexPoint:function(e){var t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addVertexLine:function(e){var t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addNormal:function(e,t,n){var r=this.normals,o=this.object.geometry.normals;o.push(r[e+0],r[e+1],r[e+2]),o.push(r[t+0],r[t+1],r[t+2]),o.push(r[n+0],r[n+1],r[n+2])},addColor:function(e,t,n){var r=this.colors,o=this.object.geometry.colors;o.push(r[e+0],r[e+1],r[e+2]),o.push(r[t+0],r[t+1],r[t+2]),o.push(r[n+0],r[n+1],r[n+2])},addUV:function(e,t,n){var r=this.uvs,o=this.object.geometry.uvs;o.push(r[e+0],r[e+1]),o.push(r[t+0],r[t+1]),o.push(r[n+0],r[n+1])},addUVLine:function(e){var t=this.uvs;this.object.geometry.uvs.push(t[e+0],t[e+1])},addFace:function(e,t,n,r,o,i,a,s,_){var u=this.vertices.length,c=this.parseVertexIndex(e,u),p=this.parseVertexIndex(t,u),l=this.parseVertexIndex(n,u);if(this.addVertex(c,p,l),this.colors.length>0&&this.addColor(c,p,l),void 0!==r&&""!==r){var d=this.uvs.length;c=this.parseUVIndex(r,d),p=this.parseUVIndex(o,d),l=this.parseUVIndex(i,d),this.addUV(c,p,l)}if(void 0!==a&&""!==a){var f=this.normals.length;c=this.parseNormalIndex(a,f),p=a===s?c:this.parseNormalIndex(s,f),l=a===_?c:this.parseNormalIndex(_,f),this.addNormal(c,p,l)}},addPointGeometry:function(e){this.object.geometry.type="Points";for(var t=this.vertices.length,n=0,r=e.length;n<r;n++)this.addVertexPoint(this.parseVertexIndex(e[n],t))},addLineGeometry:function(e,t){this.object.geometry.type="Line";for(var n=this.vertices.length,r=this.uvs.length,o=0,i=e.length;o<i;o++)this.addVertexLine(this.parseVertexIndex(e[o],n));var a=0;for(i=t.length;a<i;a++)this.addUVLine(this.parseUVIndex(t[a],r))}};return e.startObject("",!1),e}function y(e){u.a.call(this,e),this.materials=null}return y.prototype=Object.assign(Object.create(u.a.prototype),{constructor:y,load:function(e,t,n,r){var i=this,a=new o.a(i.manager);a.setPath(this.path),a.load(e,(function(e){t(i.parse(e))}),n,r)},setMaterials:function(e){return this.materials=e,this},parse:function(o){var u=new m;-1!==o.indexOf("\r\n")&&(o=o.replace(/\r\n/g,"\n")),-1!==o.indexOf("\\\n")&&(o=o.replace(/\\\n/g,""));for(var y=o.split("\n"),v="",g="",b=[],x="function"==typeof"".trimLeft,P=0,T=y.length;P<T;P++)if(v=y[P],0!==(v=x?v.trimLeft():v.trim()).length&&"#"!==(g=v.charAt(0)))if("v"===g){var w=v.split(/\s+/);switch(w[0]){case"v":u.vertices.push(parseFloat(w[1]),parseFloat(w[2]),parseFloat(w[3])),w.length>=7&&u.colors.push(parseFloat(w[4]),parseFloat(w[5]),parseFloat(w[6]));break;case"vn":u.normals.push(parseFloat(w[1]),parseFloat(w[2]),parseFloat(w[3]));break;case"vt":u.uvs.push(parseFloat(w[1]),parseFloat(w[2]))}}else if("f"===g){for(var C=v.substr(1).trim().split(/\s+/),O=[],E=0,A=C.length;E<A;E++){var N=C[E];if(N.length>0){var M=N.split("/");O.push(M)}}var j=O[0];for(E=1,A=O.length-1;E<A;E++){var S=O[E],R=O[E+1];u.addFace(j[0],S[0],R[0],j[1],S[1],R[1],j[2],S[2],R[2])}}else if("l"===g){var L=v.substring(1).trim().split(" "),k=[],z=[];if(-1===v.indexOf("/"))k=L;else for(var G=0,I=L.length;G<I;G++){var D=L[G].split("/");""!==D[0]&&k.push(D[0]),""!==D[1]&&z.push(D[1])}u.addLineGeometry(k,z)}else if("p"===g){var F=v.substr(1).trim().split(" ");u.addPointGeometry(F)}else if(null!==(b=e.exec(v))){var B=(" "+b[0].substr(1).trim()).substr(1);u.startObject(B)}else if(n.test(v))u.object.startMaterial(v.substring(7).trim(),u.materialLibraries);else if(t.test(v))u.materialLibraries.push(v.substring(7).trim());else if(h.test(v))console.warn('THREE.OBJLoader: Rendering identifier "usemap" not supported. Textures must be defined in MTL files.');else if("s"===g){if((b=v.split(" ")).length>1){var V=b[1].trim().toLowerCase();u.object.smooth="0"!==V&&"off"!==V}else u.object.smooth=!0;(ne=u.object.currentMaterial())&&(ne.smooth=u.object.smooth)}else{if("\0"===v)continue;console.warn('THREE.OBJLoader: Unexpected line: "'+v+'"')}u.finalize();var U=new a.Group;U.materialLibraries=[].concat(u.materialLibraries);for(P=0,T=u.objects.length;P<T;P++){var q=u.objects[P],Y=q.geometry,H=q.materials,X="Line"===Y.type,J="Points"===Y.type,W=!1;if(0!==Y.vertices.length){var K=new r.BufferGeometry;K.setAttribute("position",new i.Float32BufferAttribute(Y.vertices,3)),Y.normals.length>0?K.setAttribute("normal",new i.Float32BufferAttribute(Y.normals,3)):K.computeVertexNormals(),Y.colors.length>0&&(W=!0,K.setAttribute("color",new i.Float32BufferAttribute(Y.colors,3))),Y.uvs.length>0&&K.setAttribute("uv",new i.Float32BufferAttribute(Y.uvs,2));for(var Z,Q=[],$=0,ee=H.length;$<ee;$++){var te=(ie=H[$]).name+"_"+ie.smooth+"_"+W,ne=u.materials[te];if(null!==this.materials)if(ne=this.materials.create(ie.name),!X||!ne||ne instanceof s.LineBasicMaterial){if(J&&ne&&!(ne instanceof f.PointsMaterial)){var re=new f.PointsMaterial({size:10,sizeAttenuation:!1});c.Material.prototype.copy.call(re,ne),re.color.copy(ne.color),re.map=ne.map,ne=re}}else{var oe=new s.LineBasicMaterial;c.Material.prototype.copy.call(oe,ne),oe.color.copy(ne.color),ne=oe}void 0===ne&&((ne=X?new s.LineBasicMaterial:J?new f.PointsMaterial({size:1,sizeAttenuation:!1}):new l.a).name=ie.name,ne.flatShading=!ie.smooth,ne.vertexColors=W,u.materials[te]=ne),Q.push(ne)}if(Q.length>1){for($=0,ee=H.length;$<ee;$++){var ie=H[$];K.addGroup(ie.groupStart,ie.groupCount,$)}Z=X?new _.LineSegments(K,Q):J?new d.Points(K,Q):new p.Mesh(K,Q)}else Z=X?new _.LineSegments(K,Q[0]):J?new d.Points(K,Q[0]):new p.Mesh(K,Q[0]);Z.name=q.name,U.add(Z)}}return U}}),y}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(13),i=n(53),a=n(1),s=n(5),_=n(17),u=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.dist=s.ParamConfig.FLOAT(.1,{range:[0,1],range_locked:[!0,!1]}),t}return r.__extends(t,e),t}(s.NodeParamsConfig)),c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=u,t}return r.__extends(t,e),t.type=function(){return"fuse"},t.displayed_input_names=function(){return["points to fuse together"]},t.prototype.initialize_node=function(){this.io.inputs.set_count(1),this.io.inputs.init_inputs_clonable_state([_.InputCloneMode.FROM_NODE])},t.prototype.cook=function(e){for(var t,n=[],r=0,o=e[0].core_objects();r<o.length;r++){var i=o[r];(t=this._fuse_core_object(i))&&n.push(t)}this.set_objects(n)},t.prototype._fuse_core_object=function(e){var t=e.object();if(t){for(var n=e.points(),r=this.pv.dist,o={},s=0,_=n;s<_.length;s++){var u=_[s],c=u.position(),p=new a.Vector3(Math.round(c.x/r),Math.round(c.y/r),Math.round(c.z/r)).toArray().join("-");o[p]=o[p]||[],o[p].push(u)}var l=[];return Object.keys(o).forEach((function(e){l.push(o[e][0])})),t.geometry.dispose(),l.length>0?(t.geometry=i.CoreGeometry.geometry_from_points(l,t.constructor),t):void 0}},t}(o.TypedSopNode);t.FuseSopNode=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(1),i=n(13),a=n(84),s=n(35),_=n(868),u=new o.Vector3(0,1,0),c=n(5),p=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.size=c.ParamConfig.VECTOR2([1,1]),t.hexagon_radius=c.ParamConfig.FLOAT(.1),t.direction=c.ParamConfig.VECTOR3([0,1,0]),t.points_only=c.ParamConfig.BOOLEAN(0),t}return r.__extends(t,e),t}(c.NodeParamsConfig)),l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=p,t._core_transform=new a.CoreTransform,t}return r.__extends(t,e),t.type=function(){return"hexagons"},t.prototype.initialize_node=function(){},t.prototype.cook=function(){var e=new _.CoreGeometryOperationHexagon(this.pv.size,this.pv.hexagon_radius,this.pv.points_only).process();this._core_transform.rotate_geometry(e,u,this.pv.direction),this.pv.points_only?this.set_geometry(e,s.CoreConstant.OBJECT_TYPE.POINTS):this.set_geometry(e)},t}(i.TypedSopNode);t.HexagonsSopNode=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(3),i=n(6),a={BufferAttribute:n(4).BufferAttribute,BufferGeometry:i.BufferGeometry,Vector2:o.Vector2},s=r.__importDefault(n(82)),_=function(){function e(e,t,n){this._param_size=e,this._param_hexagon_radius=t,this._param_points_only=n}return e.prototype.process=function(){for(var e=this._param_hexagon_radius,t=.5*e,n=e,r=Math.cos(Math.PI/6)*this._param_hexagon_radius,o=Math.floor(this._param_size.x/n),i=Math.floor(this._param_size.y/r),_=[],u=[],c=0;c<i;c++)for(var p=0;p<o;p++)_.push([-.5*this._param_size.x+p*n+(c%2==0?t:0),0,-.5*this._param_size.y+c*r]),this._param_points_only||c>=1&&(0==p||p==o-1?0==p?u.push([p+1+(c-1)*o,p+(c-1)*o,p+c*o]):u.push([p+c*o,p+(c-1)*o,p-1+c*o]):(u.push([p+c*o,p+(c-1)*o,p-1+c*o]),u.push([p+c*o,p+1+(c-1)*o,p+(c-1)*o])));_=s.default(_);var l=new a.BufferGeometry;return l.setAttribute("position",new a.BufferAttribute(new Float32Array(_),3)),this._param_points_only||(u=s.default(u),l.setIndex(u),l.computeVertexNormals()),l},e}();t.CoreGeometryOperationHexagon=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,o=n(2),i=n(10),a={Group:n(40).Group,Object3D:i.Object3D},s=n(13);!function(e){e.ADD_PARENT="add_parent",e.REMOVE_PARENT="remove_parent"}(r=t.HierarchyMode||(t.HierarchyMode={})),t.HIERARCHY_MODES=[r.ADD_PARENT,r.REMOVE_PARENT];var _=n(5),u=new(function(e){function n(){var n=null!==e&&e.apply(this,arguments)||this;return n.mode=_.ParamConfig.INTEGER(0,{menu:{entries:t.HIERARCHY_MODES.map((function(e,t){return{name:e,value:t}}))}}),n.levels=_.ParamConfig.INTEGER(1,{range:[0,5]}),n}return o.__extends(n,e),n}(_.NodeParamsConfig)),c=function(e){function n(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=u,t}return o.__extends(n,e),n.type=function(){return"hierarchy"},n.displayed_input_names=function(){return["geometry to add or remove parents to/from"]},n.prototype.initialize_node=function(){this.io.inputs.set_count(1)},n.prototype.cook=function(e){var n=e[0];if(t.HIERARCHY_MODES[this.pv.mode]==r.ADD_PARENT){var o=this._add_parent_to_core_group(n);this.set_objects(o)}else{o=this._remove_parent_from_core_group(n);this.set_objects(o)}},n.prototype._add_parent_to_core_group=function(e){if(0==this.pv.levels)return e.objects();for(var t=[],n=void 0,r=0,o=e.objects();r<o.length;r++){var i=o[r];(n=this._add_parent_to_object(i))&&t.push(n)}return t},n.prototype._add_parent_to_object=function(e){var t=new a.Group;if(t.add(e),this.pv.levels>0)for(var n=0;n<this.pv.levels-1;n++)t=this._add_new_parent(t);return t},n.prototype._add_new_parent=function(e){var t=new a.Group;return t.add(e),t},n.prototype._remove_parent_from_core_group=function(e){if(0==this.pv.levels)return e.objects();for(var t=[],n=0,r=e.objects();n<r.length;n++)for(var o=r[n],i=0,a=this._remove_parent_from_object(o);i<a.length;i++){var s=a[i];t.push(s)}return t},n.prototype._remove_parent_from_object=function(e){for(var t=e.children,n=0;n<this.pv.levels-1;n++)t=this._get_children_from_objects(t);return t},n.prototype._get_children_from_objects=function(e){for(var t,n=[];t=e.pop();)if(t.children)for(var r=0,o=t.children;r<o.length;r++){var i=o[r];n.push(i)}return n},n}(s.TypedSopNode);t.HierarchySopNode=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(13),i=n(385),a=n(162),s=n(17),_=n(133),u=n(27),c=n(5),p=n(35),l=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.attributes_to_copy=c.ParamConfig.STRING("instance*"),t.apply_material=c.ParamConfig.BOOLEAN(1),t.material=c.ParamConfig.OPERATOR_PATH("",{visible_if:{apply_material:1},node_selection:{context:u.NodeContext.MAT},dependent_on_found_node:!1}),t}return r.__extends(t,e),t}(c.NodeParamsConfig)),d=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=l,t._on_create_bound=t._on_create.bind(t),t}return r.__extends(t,e),t.type=function(){return"instance"},t.displayed_input_names=function(){return["geometry to be instanciated","points to instance to"]},t.prototype.initialize_node=function(){e.prototype.initialize_node.call(this),this.lifecycle.add_on_create_hook(this._on_create_bound),this.io.inputs.set_count(2),this.io.inputs.init_inputs_clonable_state([s.InputCloneMode.ALWAYS,s.InputCloneMode.NEVER])},t.prototype.cook=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,n,o,i,a,s;return r.__generator(this,(function(r){switch(r.label){case 0:return t=e[0],this._geometry=void 0,(n=t.objects()[0])&&(o=n.geometry)&&(i=e[1],this._create_instance(o,i)),this._geometry?(a=p.ObjectTypeByObject(n))?(s=this.create_object(this._geometry,a),this.pv.apply_material?[4,this._apply_material(s)]:[3,2]):[3,3]:[3,5];case 1:r.sent(),r.label=2;case 2:return this.set_object(s),[3,4];case 3:this.cook_controller.end_cook(),r.label=4;case 4:return[3,6];case 5:this.cook_controller.end_cook(),r.label=6;case 6:return[2]}}))}))},t.prototype._apply_material=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,n,o,i,s;return r.__generator(this,(function(r){switch(r.label){case 0:return(t=this.p.material.found_node())?t.node_context()!=u.NodeContext.MAT?[3,2]:(n=t,this._globals_handler=this._globals_handler||new _.GlobalsGeometryHandler,(o=n).assembler_controller&&o.assembler_controller.set_assembler_globals_handler(this._globals_handler),[4,n.request_container()]):[3,4];case 1:return i=r.sent(),(s=i.material())&&(e.material=s,a.CoreMaterial.apply_custom_materials(e,s)),[3,3];case 2:this.states.error.set("found node is not a material"),r.label=3;case 3:return[3,5];case 4:this.states.error.set("material node invalid"),r.label=5;case 5:return[2]}}))}))},t.prototype._create_instance=function(e,t){this._geometry=i.CoreInstancer.create_instance_buffer_geo(e,t,this.pv.attributes_to_copy)},t.prototype._on_create=function(){var e,t=this.scene.root,n=t.node("MAT");n&&"materials"==n.type?e=n:(e=t.create_node("materials")).set_name("MAT");var r=e.node("mesh_lambert_builder1")||function(e,t){var n=e.create_node("mesh_lambert_builder");n.set_name(t);var r=n.create_node("instance_transform"),o=n.node("output1");return o||(o=n.create_node("output")),o.set_input("position",r,"position"),o.set_input("normal",r,"normal"),n}(e,"mesh_lambert_builder1");this.p.material.set(r.full_path())},t}(o.TypedSopNode);t.InstanceSopNode=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o={Vector3:n(1).Vector3},i=n(104),a=n(13),s=n(5),_=n(17),u=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.amount=s.ParamConfig.FLOAT(1),t.seed=s.ParamConfig.INTEGER(1,{range:[0,100]}),t}return r.__extends(t,e),t}(s.NodeParamsConfig)),c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=u,t}return r.__extends(t,e),t.type=function(){return"jitter"},t.displayed_input_names=function(){return["geometry to jitter points of"]},t.prototype.initialize_node=function(){this.io.inputs.set_count(1),this.io.inputs.init_inputs_clonable_state([_.InputCloneMode.FROM_NODE])},t.prototype.cook=function(e){var t=this,n=e[0];n.points().forEach((function(e,n){var r=new o.Vector3(2*(i.CoreMath.rand(75*n+764+t.pv.seed)-.5),2*(i.CoreMath.rand(5678*n+3653+t.pv.seed)-.5),2*(i.CoreMath.rand(657*n+48464+t.pv.seed)-.5));r.normalize(),r.multiplyScalar(t.pv.amount);var a=e.position().clone().add(r);e.set_position(a)})),this.set_core_group(n)},t}(a.TypedSopNode);t.JitterSopNode=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(13),i=n(5),a=n(17),s=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.layer=i.ParamConfig.INTEGER(0,{range:[0,31],range_locked:[!0,!0]}),t}return r.__extends(t,e),t}(i.NodeParamsConfig)),_=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=s,t}return r.__extends(t,e),t.type=function(){return"layer"},t.displayed_input_names=function(){return["objects to change layers of"]},t.prototype.initialize_node=function(){this.io.inputs.set_count(1),this.io.inputs.init_inputs_clonable_state([a.InputCloneMode.FROM_NODE])},t.prototype.cook=function(e){for(var t=e[0],n=0,r=t.objects();n<r.length;n++){r[n].layers.set(this.pv.layer)}this.set_core_group(t)},t}(o.TypedSopNode);t.LayerSopNode=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(4),i=n(6),a=r.__importDefault(n(208)),s=n(13),_=n(35),u=n(5),c=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.length=u.ParamConfig.FLOAT(1,{range:[0,10]}),t.points_count=u.ParamConfig.INTEGER(1,{range:[2,100],range_locked:[!0,!1]}),t.origin=u.ParamConfig.VECTOR3([0,0,0]),t.direction=u.ParamConfig.VECTOR3([0,1,0]),t}return r.__extends(t,e),t}(u.NodeParamsConfig)),p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=c,t}return r.__extends(t,e),t.type=function(){return"line"},t.prototype.initialize_node=function(){},t.prototype.cook=function(){var e=this,t=Math.max(2,this.pv.points_count),n=new Array(3*t),r=new Array(t),s=this.pv.direction.clone().normalize().multiplyScalar(this.pv.length);a.default(t,(function(o){var i=o/(t-1),a=s.clone().multiplyScalar(i);a.add(e.pv.origin),a.toArray(n,3*o),o>0&&(r[2*(o-1)]=o-1,r[2*(o-1)+1]=o)}));var u=new i.BufferGeometry;u.setAttribute("position",new o.Float32BufferAttribute(n,3)),u.setIndex(r),this.set_geometry(u,_.CoreConstant.OBJECT_TYPE.LINE_SEGMENTS)},t}(s.TypedSopNode);t.LineSopNode=p},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(13),i=n(162),a=n(133),s=n(17),_=n(27),u=n(26),c=n(5),p=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.group=c.ParamConfig.STRING(""),t.material=c.ParamConfig.OPERATOR_PATH("/MAT/mesh_standard1",{node_selection:{context:_.NodeContext.MAT},dependent_on_found_node:!1}),t.apply_to_children=c.ParamConfig.BOOLEAN(0),t}return r.__extends(t,e),t}(c.NodeParamsConfig)),l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=p,t._globals_handler=new a.GlobalsGeometryHandler,t}return r.__extends(t,e),t.type=function(){return"material"},t.displayed_input_names=function(){return["objects to assign material to"]},t.prototype.initialize_node=function(){this.io.inputs.set_count(1),this.io.inputs.init_inputs_clonable_state([s.InputCloneMode.FROM_NODE])},t.prototype.cook=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,n,o,i,a,s,c,p=this;return r.__generator(this,(function(r){switch(r.label){case 0:return t=e[0],(n=this.p.material.found_node())?n.node_context()==_.NodeContext.MAT?[3,1]:(this.states.error.set("node is not a material"),[3,3]):[3,4];case 1:return(i=(o=n).material)instanceof u.ShaderMaterial&&n.assembler_controller.set_assembler_globals_handler(this._globals_handler),[4,o.request_container()];case 2:if(r.sent(),i){for(a=0,s=t.objects_from_group(this.pv.group);a<s.length;a++)c=s[a],this.pv.apply_to_children?c.traverse((function(e){p.apply_material(e,i)})):this.apply_material(c,i);this.set_core_group(t)}else this.states.error.set("material invalid. (error: '"+o.states.error.message+"')");r.label=3;case 3:return[3,5];case 4:this.states.error.set("node '"+this.pv.material+"' not found"),r.label=5;case 5:return[2]}}))}))},t.prototype.apply_material=function(e,t){e.material=t,i.CoreMaterial.apply_custom_materials(e,t)},t}(o.TypedSopNode);t.MaterialSopNode=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(13),i=n(53),a=n(35),s="geometry to merge",_=n(5),u=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.compact=_.ParamConfig.BOOLEAN(1),t}return r.__extends(t,e),t}(_.NodeParamsConfig)),c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=u,t}return r.__extends(t,e),t.type=function(){return"merge"},t.displayed_input_names=function(){return[s,s,s,s]},t.prototype.initialize_node=function(){this.io.inputs.set_count(1,4),this.ui_data.set_width(100)},t.prototype.cook=function(e){for(var t=[],n=0,r=e;n<r.length;n++){var o=r[n];if(o)for(var i=0,a=o.objects();i<a.length;i++){a[i].traverse((function(e){t.push(e)}))}}this.pv.compact&&(t=this._make_compact(t)),this.set_objects(t)},t.prototype._make_compact=function(e){for(var t,n=((t={})[a.ObjectType.MESH]=[],t[a.ObjectType.POINTS]=[],t[a.ObjectType.LINE_SEGMENTS]=[],t),r=[],o=0,s=e;o<s.length;o++){(m=s[o]).traverse((function(e){var t=e;t.geometry&&(t.isMesh?n[a.ObjectType.MESH].push(t):t.isLineSegments?n[a.ObjectType.LINE_SEGMENTS].push(t):t.isPoints&&n[a.ObjectType.POINTS].push(t))}))}for(var _=0,u=Object.keys(n);_<u.length;_++){for(var c=u[_],p=[],l=0,d=n[c];l<d.length;l++){var f=(m=d[l]).geometry;f.applyMatrix4(m.matrix),p.push(f)}var h=i.CoreGeometry.merge_geometries(p);if(h){var m=this.create_object(h,c);r.push(m)}}return r},t}(o.TypedSopNode);t.MergeSopNode=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,o=n(2),i=n(1),a=n(3),s=n(13),_=n(104),u=n(17),c=n(192),p=n(877);!function(e){e.ADD="add",e.SET="set",e.MULT="mult",e.SUBSTRACT="substract",e.DIVIDE="divide"}(r||(r={}));var l=[r.ADD,r.SET,r.MULT,r.SUBSTRACT,r.DIVIDE],d=n(5),f=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.amount=d.ParamConfig.FLOAT(1),t.freq=d.ParamConfig.VECTOR3([1,1,1]),t.offset=d.ParamConfig.VECTOR3([0,0,0]),t.octaves=d.ParamConfig.INTEGER(3,{range:[1,8],range_locked:[!0,!1]}),t.amp_attenuation=d.ParamConfig.FLOAT(.5,{range:[0,1]}),t.freq_increase=d.ParamConfig.FLOAT(2,{range:[0,10]}),t.seed=d.ParamConfig.INTEGER(0,{range:[0,100]}),t.separator=d.ParamConfig.SEPARATOR(),t.use_normals=d.ParamConfig.BOOLEAN(0),t.attrib_name=d.ParamConfig.STRING("position"),t.operation=d.ParamConfig.INTEGER(l.indexOf(r.ADD),{menu:{entries:l.map((function(e){return{name:e,value:l.indexOf(e)}}))}}),t.compute_normals=d.ParamConfig.BOOLEAN(1),t}return o.__extends(t,e),t}(d.NodeParamsConfig)),h=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=f,t._simplex_by_seed=new Map,t._rest_points=[],t}return o.__extends(t,e),t.type=function(){return"noise"},t.displayed_input_names=function(){return["geometry to add noise to","rest geometry"]},t.prototype.initialize_node=function(){this.io.inputs.set_count(1,2),this.io.inputs.init_inputs_clonable_state([u.InputCloneMode.FROM_NODE,u.InputCloneMode.NEVER])},t.prototype.cook=function(e){return o.__awaiter(this,void 0,void 0,(function(){var t,n,s,_,u,p,d,f,h,m,y,v=this;return o.__generator(this,(function(o){for(t=e[0],n=e[1],s=t.points(),n&&(null!=this._rest_core_group_timestamp&&this._rest_core_group_timestamp==n.timestamp()||(this._rest_points=n.points(),this._rest_core_group_timestamp=n.timestamp())),_=this._get_simplex(),u=this.pv.use_normals&&t.has_attrib("normal"),p=t.attrib_size(this.pv.attrib_name),d=function(e){var t=s[e],o=n?f._rest_points[e]:t,d=o.attrib_value(f.pv.attrib_name),h=o.position().add(f.pv.offset).multiply(f.pv.freq),m=function(){if(u){var e=o.attrib_value("normal"),t=v.pv.amount*v._fbm(_,h.x,h.y,h.z);return e.clone().multiplyScalar(t)}return new i.Vector3(v.pv.amount*v._fbm(_,h.x+545,h.y+125454,h.z+2142),v.pv.amount*v._fbm(_,h.x-425,h.y-25746,h.z+95242),v.pv.amount*v._fbm(_,h.x+765132,h.y+21,h.z-9245))}();m=function(){switch(p){case 1:return m.x;case 2:return new a.Vector2(m.x,m.y);case 3:return m}}();var y=function(){var e=l[v.pv.operation];switch(p){case 1:switch(e){case r.ADD:return d+m;case r.SET:return m;case r.MULT:return d*m;case r.DIVIDE:return d/m;case r.SUBSTRACT:return d-m}c.TypeAssert.unreachable(e);break;default:switch(e){case r.ADD:return d.add(m);case r.SET:return m;case r.MULT:return d.multiply(m);case r.DIVIDE:return d.divide(m);case r.SUBSTRACT:return d.sub(m)}c.TypeAssert.unreachable(e)}}();t.set_attrib_value(f.pv.attrib_name,y)},f=this,h=0;h<s.length;h++)d(h);if(!this.io.inputs.input_cloned(0))for(m=0,y=t.geometries();m<y.length;m++)y[m].getAttribute(this.pv.attrib_name).needsUpdate=!0;return this.pv.compute_normals&&t.compute_vertex_normals(),this.set_core_group(t),[2]}))}))},t.prototype._fbm=function(e,t,n,r){for(var o=0,i=1,a=0;a<this.pv.octaves;a++)o+=i*e.noise3d(t,n,r),t*=this.pv.freq_increase,n*=this.pv.freq_increase,r*=this.pv.freq_increase,i*=this.pv.amp_attenuation;return o},t.prototype._get_simplex=function(){var e=this._simplex_by_seed.get(this.pv.seed);if(e)return e;var t=this._create_simplex();return this._simplex_by_seed.set(this.pv.seed,t),t},t.prototype._create_simplex=function(){var e=this.pv.seed,t={random:function(){return _.CoreMath.rand_float(e)}},n=new p.SimplexNoise(t);return this._simplex_by_seed.delete(e),n},t}(s.TypedSopNode);t.NoiseSopNode=h},function(e,t,n){"use strict";n.r(t),n.d(t,"SimplexNoise",(function(){return r}));var r=function(e){null==e&&(e=Math),this.grad3=[[1,1,0],[-1,1,0],[1,-1,0],[-1,-1,0],[1,0,1],[-1,0,1],[1,0,-1],[-1,0,-1],[0,1,1],[0,-1,1],[0,1,-1],[0,-1,-1]],this.grad4=[[0,1,1,1],[0,1,1,-1],[0,1,-1,1],[0,1,-1,-1],[0,-1,1,1],[0,-1,1,-1],[0,-1,-1,1],[0,-1,-1,-1],[1,0,1,1],[1,0,1,-1],[1,0,-1,1],[1,0,-1,-1],[-1,0,1,1],[-1,0,1,-1],[-1,0,-1,1],[-1,0,-1,-1],[1,1,0,1],[1,1,0,-1],[1,-1,0,1],[1,-1,0,-1],[-1,1,0,1],[-1,1,0,-1],[-1,-1,0,1],[-1,-1,0,-1],[1,1,1,0],[1,1,-1,0],[1,-1,1,0],[1,-1,-1,0],[-1,1,1,0],[-1,1,-1,0],[-1,-1,1,0],[-1,-1,-1,0]],this.p=[];for(var t=0;t<256;t++)this.p[t]=Math.floor(256*e.random());this.perm=[];for(t=0;t<512;t++)this.perm[t]=this.p[255&t];this.simplex=[[0,1,2,3],[0,1,3,2],[0,0,0,0],[0,2,3,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,3,0],[0,2,1,3],[0,0,0,0],[0,3,1,2],[0,3,2,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,3,2,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,0,3],[0,0,0,0],[1,3,0,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,3,0,1],[2,3,1,0],[1,0,2,3],[1,0,3,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,3,1],[0,0,0,0],[2,1,3,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,1,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,0,1,2],[3,0,2,1],[0,0,0,0],[3,1,2,0],[2,1,0,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,1,0,2],[0,0,0,0],[3,2,0,1],[3,2,1,0]]};r.prototype.dot=function(e,t,n){return e[0]*t+e[1]*n},r.prototype.dot3=function(e,t,n,r){return e[0]*t+e[1]*n+e[2]*r},r.prototype.dot4=function(e,t,n,r,o){return e[0]*t+e[1]*n+e[2]*r+e[3]*o},r.prototype.noise=function(e,t){var n,r,o=(e+t)*(.5*(Math.sqrt(3)-1)),i=Math.floor(e+o),a=Math.floor(t+o),s=(3-Math.sqrt(3))/6,_=(i+a)*s,u=e-(i-_),c=t-(a-_);u>c?(n=1,r=0):(n=0,r=1);var p=u-n+s,l=c-r+s,d=u-1+2*s,f=c-1+2*s,h=255&i,m=255&a,y=this.perm[h+this.perm[m]]%12,v=this.perm[h+n+this.perm[m+r]]%12,g=this.perm[h+1+this.perm[m+1]]%12,b=.5-u*u-c*c,x=.5-p*p-l*l,P=.5-d*d-f*f;return 70*((b<0?0:(b*=b)*b*this.dot(this.grad3[y],u,c))+(x<0?0:(x*=x)*x*this.dot(this.grad3[v],p,l))+(P<0?0:(P*=P)*P*this.dot(this.grad3[g],d,f)))},r.prototype.noise3d=function(e,t,n){var r,o,i,a,s,_,u=(e+t+n)*(1/3),c=Math.floor(e+u),p=Math.floor(t+u),l=Math.floor(n+u),d=1/6,f=(c+p+l)*d,h=e-(c-f),m=t-(p-f),y=n-(l-f);h>=m?m>=y?(r=1,o=0,i=0,a=1,s=1,_=0):h>=y?(r=1,o=0,i=0,a=1,s=0,_=1):(r=0,o=0,i=1,a=1,s=0,_=1):m<y?(r=0,o=0,i=1,a=0,s=1,_=1):h<y?(r=0,o=1,i=0,a=0,s=1,_=1):(r=0,o=1,i=0,a=1,s=1,_=0);var v=h-r+d,g=m-o+d,b=y-i+d,x=h-a+2*d,P=m-s+2*d,T=y-_+2*d,w=h-1+.5,C=m-1+.5,O=y-1+.5,E=255&c,A=255&p,N=255&l,M=this.perm[E+this.perm[A+this.perm[N]]]%12,j=this.perm[E+r+this.perm[A+o+this.perm[N+i]]]%12,S=this.perm[E+a+this.perm[A+s+this.perm[N+_]]]%12,R=this.perm[E+1+this.perm[A+1+this.perm[N+1]]]%12,L=.6-h*h-m*m-y*y,k=.6-v*v-g*g-b*b,z=.6-x*x-P*P-T*T,G=.6-w*w-C*C-O*O;return 32*((L<0?0:(L*=L)*L*this.dot3(this.grad3[M],h,m,y))+(k<0?0:(k*=k)*k*this.dot3(this.grad3[j],v,g,b))+(z<0?0:(z*=z)*z*this.dot3(this.grad3[S],x,P,T))+(G<0?0:(G*=G)*G*this.dot3(this.grad3[R],w,C,O)))},r.prototype.noise4d=function(e,t,n,r){var o,i,a,s,_,u,c,p,l,d,f,h,m=this.grad4,y=this.simplex,v=this.perm,g=(Math.sqrt(5)-1)/4,b=(5-Math.sqrt(5))/20,x=(e+t+n+r)*g,P=Math.floor(e+x),T=Math.floor(t+x),w=Math.floor(n+x),C=Math.floor(r+x),O=(P+T+w+C)*b,E=e-(P-O),A=t-(T-O),N=n-(w-O),M=r-(C-O),j=(E>A?32:0)+(E>N?16:0)+(A>N?8:0)+(E>M?4:0)+(A>M?2:0)+(N>M?1:0),S=E-(o=y[j][0]>=3?1:0)+b,R=A-(i=y[j][1]>=3?1:0)+b,L=N-(a=y[j][2]>=3?1:0)+b,k=M-(s=y[j][3]>=3?1:0)+b,z=E-(_=y[j][0]>=2?1:0)+2*b,G=A-(u=y[j][1]>=2?1:0)+2*b,I=N-(c=y[j][2]>=2?1:0)+2*b,D=M-(p=y[j][3]>=2?1:0)+2*b,F=E-(l=y[j][0]>=1?1:0)+3*b,B=A-(d=y[j][1]>=1?1:0)+3*b,V=N-(f=y[j][2]>=1?1:0)+3*b,U=M-(h=y[j][3]>=1?1:0)+3*b,q=E-1+4*b,Y=A-1+4*b,H=N-1+4*b,X=M-1+4*b,J=255&P,W=255&T,K=255&w,Z=255&C,Q=v[J+v[W+v[K+v[Z]]]]%32,$=v[J+o+v[W+i+v[K+a+v[Z+s]]]]%32,ee=v[J+_+v[W+u+v[K+c+v[Z+p]]]]%32,te=v[J+l+v[W+d+v[K+f+v[Z+h]]]]%32,ne=v[J+1+v[W+1+v[K+1+v[Z+1]]]]%32,re=.6-E*E-A*A-N*N-M*M,oe=.6-S*S-R*R-L*L-k*k,ie=.6-z*z-G*G-I*I-D*D,ae=.6-F*F-B*B-V*V-U*U,se=.6-q*q-Y*Y-H*H-X*X;return 27*((re<0?0:(re*=re)*re*this.dot4(m[Q],E,A,N,M))+(oe<0?0:(oe*=oe)*oe*this.dot4(m[$],S,R,L,k))+(ie<0?0:(ie*=ie)*ie*this.dot4(m[ee],z,G,I,D))+(ae<0?0:(ae*=ae)*ae*this.dot4(m[te],F,B,V,U))+(se<0?0:(se*=se)*se*this.dot4(m[ne],q,Y,H,X)))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(13),i=n(17),a=n(5),s=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.edit=a.ParamConfig.BOOLEAN(0),t.update_x=a.ParamConfig.BOOLEAN(0,{visible_if:{edit:1}}),t.x=a.ParamConfig.FLOAT("@N.x",{visible_if:{update_x:1,edit:1},expression:{for_entities:!0}}),t.update_y=a.ParamConfig.BOOLEAN(0,{visible_if:{edit:1}}),t.y=a.ParamConfig.FLOAT("@N.y",{visible_if:{update_y:1,edit:1},expression:{for_entities:!0}}),t.update_z=a.ParamConfig.BOOLEAN(0,{visible_if:{edit:1}}),t.z=a.ParamConfig.FLOAT("@N.z",{visible_if:{update_z:1,edit:1},expression:{for_entities:!0}}),t.recompute=a.ParamConfig.BOOLEAN(0,{visible_if:{edit:0}}),t.invert=a.ParamConfig.BOOLEAN(0),t}return r.__extends(t,e),t}(a.NodeParamsConfig)),_=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=s,t}return r.__extends(t,e),t.type=function(){return"normals"},t.displayed_input_names=function(){return["geometry to update normals of"]},t.prototype.initialize_node=function(){this.io.inputs.set_count(1),this.io.inputs.init_inputs_clonable_state([i.InputCloneMode.FROM_NODE])},t.prototype.cook=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t;return r.__generator(this,(function(n){switch(n.label){case 0:return t=e[0],this.pv.edit?[4,this._eval_expressions_for_core_group(t)]:[3,2];case 1:return n.sent(),[3,3];case 2:t.compute_vertex_normals(),n.label=3;case 3:return this.pv.invert&&this._invert_normals(t),this.set_core_group(t),[2]}}))}))},t.prototype._eval_expressions_for_core_group=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,n;return r.__generator(this,(function(r){switch(r.label){case 0:t=e.core_objects(),n=0,r.label=1;case 1:return n<t.length?[4,this._eval_expressions_for_core_object(t[n])]:[3,4];case 2:r.sent(),r.label=3;case 3:return n++,[3,1];case 4:return[2]}}))}))},t.prototype._eval_expressions_for_core_object=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,n,o,i,a,s;return r.__generator(this,(function(r){switch(r.label){case 0:return t=e.object(),n=t.geometry,o=e.points(),i=n.getAttribute("normal").array,this.pv.update_x?this.p.x.has_expression()&&this.p.x.expression_controller?[4,this.p.x.expression_controller.compute_expression_for_points(o,(function(e,t){i[3*e.index+0]=t}))]:[3,2]:[3,3];case 1:return r.sent(),[3,3];case 2:for(a=void 0,s=0;s<o.length;s++)a=o[s],i[3*a.index+0]=this.pv.x;r.label=3;case 3:return this.pv.update_y?this.p.y.has_expression()&&this.p.y.expression_controller?[4,this.p.y.expression_controller.compute_expression_for_points(o,(function(e,t){i[3*e.index+1]=t}))]:[3,5]:[3,6];case 4:return r.sent(),[3,6];case 5:for(a=void 0,s=0;s<o.length;s++)a=o[s],i[3*a.index+1]=this.pv.y;r.label=6;case 6:return this.pv.update_z?this.p.z.has_expression()&&this.p.z.expression_controller?[4,this.p.z.expression_controller.compute_expression_for_points(o,(function(e,t){i[3*e.index+2]=t}))]:[3,8]:[3,9];case 7:return r.sent(),[3,9];case 8:for(a=void 0,s=0;s<o.length;s++)a=o[s],i[3*a.index+2]=this.pv.z;r.label=9;case 9:return[2]}}))}))},t.prototype._invert_normals=function(e){for(var t=0,n=e.core_objects();t<n.length;t++){var r=n[t].core_geometry().geometry().attributes.normal;if(r)for(var o=r.array,i=0;i<o.length;i++)o[i]*=-1}},t}(o.TypedSopNode);t.NormalsSopNode=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(13),i=n(5),a=n(17),s=new(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t}(i.NodeParamsConfig)),_=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=s,t}return r.__extends(t,e),t.type=function(){return"null"},t.prototype.initialize_node=function(){this.io.inputs.set_count(0,1),this.io.inputs.init_inputs_clonable_state([a.InputCloneMode.FROM_NODE]),this.ui_data.set_border_radius(1e3)},t.prototype.cook=function(e){var t=e[0];t?this.set_core_group(t):this.set_objects([])},t}(o.TypedSopNode);t.NullSopNode=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(13),i=n(27),a=n(5),s=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.geometry=a.ParamConfig.OPERATOR_PATH("",{node_selection:{context:i.NodeContext.SOP}}),t}return r.__extends(t,e),t}(a.NodeParamsConfig)),_=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=s,t}return r.__extends(t,e),t.type=function(){return"object_merge"},t.prototype.initialize_node=function(){},t.prototype.cook=function(e){return r.__awaiter(this,void 0,void 0,(function(){var e,t;return r.__generator(this,(function(n){switch(n.label){case 0:return(e=this.p.geometry.found_node())?e.node_context()!=i.NodeContext.SOP?[3,2]:[4,e.request_container()]:[3,4];case 1:return t=n.sent(),this.import_input(e,t),[3,3];case 2:this.states.error.set("found node is not a geometry"),n.label=3;case 3:return[3,5];case 4:this.states.error.set("node not found at path '"+this.pv.geometry+"'"),n.label=5;case 5:return[2]}}))}))},t.prototype.import_input=function(e,t){var n;null!=(n=t.core_content_cloned())?this.set_core_group(n):this.states.error.set("invalid target")},t}(o.TypedSopNode);t.ObjectMergeSopNode=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o={Float32BufferAttribute:n(4).Float32BufferAttribute},i=n(13),a=r.__importDefault(n(882)),s=n(17),_=n(5),u=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.attrib_name=_.ParamConfig.STRING("occlusion"),t.samples=_.ParamConfig.INTEGER(256,{range:[1,256],range_locked:[!0,!1]}),t.sep=_.ParamConfig.SEPARATOR(),t.buffer_resolution=_.ParamConfig.INTEGER(512),t.bias=_.ParamConfig.FLOAT(.01),t}return r.__extends(t,e),t}(_.NodeParamsConfig)),c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=u,t}return r.__extends(t,e),t.type=function(){return"occlusion"},t.prototype.initialize_node=function(){this.io.inputs.set_count(1),this.io.inputs.init_inputs_clonable_state([s.InputCloneMode.FROM_NODE])},t.prototype.cook=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,n,o,i,a;return r.__generator(this,(function(r){switch(r.label){case 0:t=e[0],n=t.core_objects(),o=0,i=n,r.label=1;case 1:return o<i.length?(a=i[o],[4,this._process_occlusion_on_object(a)]):[3,4];case 2:r.sent(),r.label=3;case 3:return o++,[3,1];case 4:return this.set_core_group(t),[2]}}))}))},t.prototype._process_occlusion_on_object=function(e){var t;return r.__awaiter(this,void 0,void 0,(function(){var n,i,s,_,u,c,p;return r.__generator(this,(function(r){for(n=e.core_geometry().geometry(),i=n.attributes.position.array,s=n.attributes.normal.array,_=null===(t=n.getIndex())||void 0===t?void 0:t.array,u=a.default(i,{cells:_,normals:s,resolution:this.pv.buffer_resolution,bias:this.pv.bias}),c=0;c<this.pv.samples;c++)u.sample();return p=u.report(),n.setAttribute(this.pv.attrib_name,new o.Float32BufferAttribute(p,1)),u.dispose(),[2]}))}))},t}(i.TypedSopNode);t.OcclusionSopNode=c},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(13),i=n(975),a=n(282),s=n(17),_=n(27),u=n(132),c=n(980),p=n(981),l=n(5),d=n(270),f=n(376),h=n(370),m=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.start_frame=l.ParamConfig.FLOAT(1,{range:[1,100]}),t.auto_textures_size=l.ParamConfig.BOOLEAN(1),t.max_textures_size=l.ParamConfig.VECTOR2([1024,1024],{visible_if:{auto_textures_size:1}}),t.textures_size=l.ParamConfig.VECTOR2([64,64],{visible_if:{auto_textures_size:0}}),t.reset=l.ParamConfig.BUTTON(null,{callback:function(e,t){y.PARAM_CALLBACK_reset(e)}}),t.material=l.ParamConfig.OPERATOR_PATH("",{node_selection:{context:_.NodeContext.MAT},dependent_on_found_node:!1}),t}return r.__extends(t,e),t}(l.NodeParamsConfig)),y=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=m,t._assembler_controller=new u.GlAssemblerController(t,i.ShaderAssemblerParticles),t.gpu_controller=new p.ParticlesSystemGpuComputeController(t),t.render_controller=new c.ParticlesSystemGpuRenderController(t),t._reset_material_if_dirty_bound=t._reset_material_if_dirty.bind(t),t._children_controller_context=_.NodeContext.GL,t._on_create_prepare_material_bound=t._on_create_prepare_material.bind(t),t}return r.__extends(t,e),t.type=function(){return"particles_system_gpu"},Object.defineProperty(t.prototype,"assembler_controller",{get:function(){return this._assembler_controller},enumerable:!0,configurable:!0}),t.require_webgl2=function(){return!0},t.PARAM_CALLBACK_reset=function(e){e.PARAM_CALLBACK_reset()},t.prototype.PARAM_CALLBACK_reset=function(){this.gpu_controller.reset_gpu_compute_and_set_dirty()},t.displayed_input_names=function(){return["points to emit particles from"]},t.prototype.initialize_node=function(){var e;this.io.inputs.set_count(1),this.io.inputs.init_inputs_clonable_state([s.InputCloneMode.NEVER]),this.add_post_dirty_hook("_reset_material_if_dirty",this._reset_material_if_dirty_bound),this.lifecycle.add_on_create_hook(this.assembler_controller.on_create.bind(this.assembler_controller)),this.lifecycle.add_on_create_hook(this._on_create_prepare_material_bound),null===(e=this.children_controller)||void 0===e||e.init()},t.prototype.create_node=function(t){return e.prototype.create_node.call(this,t)},t.prototype.children=function(){return e.prototype.children.call(this)},t.prototype.nodes_by_type=function(t){return e.prototype.nodes_by_type.call(this,t)},t.prototype._reset_material_if_dirty=function(){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(e){switch(e.label){case 0:return this.p.material.is_dirty?(this.render_controller.reset_render_material(),this.is_on_frame_start()?[3,2]:[4,this.render_controller.init_render_material()]):[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))}))},t.prototype.is_on_frame_start=function(){return this.scene.frame==this.pv.start_frame},t.prototype.cook=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t;return r.__generator(this,(function(n){switch(n.label){case 0:return this.gpu_controller.set_restart_not_required(),t=e[0],console.log("particles cook"),[4,this.compile_if_required()];case 1:return n.sent(),this.is_on_frame_start()&&this.gpu_controller.reset_particle_groups(),this.gpu_controller.initialized?[3,3]:[4,this.gpu_controller.init(t)];case 2:n.sent(),n.label=3;case 3:return this.render_controller.initialized?[3,5]:(this.render_controller.init_core_group(t),[4,this.render_controller.init_render_material()]);case 4:n.sent(),n.label=5;case 5:return this.gpu_controller.restart_simulation_if_required(),this.gpu_controller.compute_similation_if_required(),this.is_on_frame_start()?this.set_core_group(t):this.cook_controller.end_cook(),[2]}}))}))},t.prototype.compile_if_required=function(){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(e){switch(e.label){case 0:return this.assembler_controller.compile_required()?[4,this.run_assembler()]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))}))},t.prototype.run_assembler=function(){return r.__awaiter(this,void 0,void 0,(function(){var e,t,n;return r.__generator(this,(function(r){switch(r.label){case 0:return e=this._find_root_nodes(),console.log("root_nodes",e),e.length>0?(t=new a.GlobalsTextureHandler(a.GlobalsTextureHandler.PARTICLE_SIM_UV),this.assembler_controller.set_assembler_globals_handler(t),this.assembler_controller.assembler.set_root_nodes(e),[4,this.assembler_controller.assembler.compile()]):[3,3];case 1:return r.sent(),[4,this.assembler_controller.post_compile()];case 2:r.sent(),r.label=3;case 3:return n=this.assembler_controller.assembler.shaders_by_name(),this.gpu_controller.set_shaders_by_name(n),this.render_controller.set_shaders_by_name(n),this.gpu_controller.reset_gpu_compute(),this.gpu_controller.reset_particle_groups(),[4,this.assembler_controller.assign_uniform_values()];case 4:return r.sent(),[2]}}))}))},t.prototype._find_root_nodes=function(){var e=d.GlNodeFinder.find_attribute_export_nodes(this),t=d.GlNodeFinder.find_output_nodes(this);if(t.length>1)return this.states.error.set("only one output node is allowed"),[];var n=t[0];return n&&e.push(n),e},t.prototype._on_create_prepare_material=function(){var e=this.scene.root.nodes_by_type("materials")[0]||this.scene.root.create_node("materials");e.set_name("MAT");var t=e.node("points_particles")||function(e,t){var n=e.node("points_builder1");n&&n.type==f.PointsBuilderMatNode.type()||(n=e.create_node("points_builder")),n.set_name(t);var r=n.node("constant");r&&r.type==h.ConstantGlNode.type()||(r=n.create_node("constant")).set_name("constant_point_size"),r.p.float.set(4);var o=n.node("output1");return o&&o.set_input("gl_PointSize",r,h.ConstantGlNode.OUTPUT_NAME),n}(e,"points_particles");if(t){var n=t.full_path();this.p.material.raw_input!=n&&this.p.material.set(n)}},t}(o.TypedSopNode);t.ParticlesSystemGpuSopNode=y},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(158),i=r.__importDefault(n(976)),a=n(977),s=n(28),_=n(364),u=n(24),c=n(33),p=n(16),l=n(29),d=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),Object.defineProperty(t.prototype,"_template_shader",{get:function(){},enumerable:!0,configurable:!0}),t.prototype._template_shader_for_shader_name=function(e){return i.default},t.prototype.compile=function(){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(e){switch(e.label){case 0:return[4,this.setup_shader_names_and_variables()];case 1:return e.sent(),[4,this.update_shaders()];case 2:return e.sent(),[2]}}))}))},t.prototype.root_nodes_by_shader_name=function(e){for(var t,n=[],r=0,o=this._root_nodes;r<o.length;r++){var i=o[r];switch(i.type){case"output":n.push(i);break;case"attribute":var a=i.attribute_name,s=null===(t=this._texture_allocations_controller)||void 0===t?void 0:t.variable(a);if(s&&s.allocation)s.allocation.shader_name==e&&n.push(i)}}return n},t.prototype.leaf_nodes_by_shader_name=function(e){for(var t,n=[],r=0,o=this._leaf_nodes;r<o.length;r++){var i=o[r];switch(i.type){case"globals":n.push(i);break;case"attribute":var a=i.attribute_name,s=null===(t=this._texture_allocations_controller)||void 0===t?void 0:t.variable(a);if(s&&s.allocation)s.allocation.shader_name==e&&n.push(i)}}return n},t.prototype.setup_shader_names_and_variables=function(){var e;return r.__awaiter(this,void 0,void 0,(function(){var t,n,o,i,s;return r.__generator(this,(function(r){switch(r.label){case 0:t=new _.TypedNodeTraverser(this,this._gl_parent_node),this._leaf_nodes=t.leaves_from_nodes(this._root_nodes),n=0,o=this._root_nodes,r.label=1;case 1:return n<o.length?[4,o[n].params.eval_all()]:[3,4];case 2:r.sent(),r.label=3;case 3:return n++,[3,1];case 4:i=0,s=this._leaf_nodes,r.label=5;case 5:return i<s.length?[4,s[i].params.eval_all()]:[3,8];case 6:r.sent(),r.label=7;case 7:return i++,[3,5];case 8:return console.log("root and leaf:",this._root_nodes,this._leaf_nodes),this._texture_allocations_controller=new a.TextureAllocationsController,this._texture_allocations_controller.allocate_connections_from_root_nodes(this._root_nodes,this._leaf_nodes),this.globals_handler&&(null===(e=this.globals_handler)||void 0===e||e.set_texture_allocations_controller(this._texture_allocations_controller)),this._reset_shader_configs(),[2]}}))}))},t.prototype.update_shaders=function(){return r.__awaiter(this,void 0,void 0,(function(){var e,t,n,o,i,a,s;return r.__generator(this,(function(r){switch(r.label){case 0:for(this._shaders_by_name=new Map,this._lines=new Map,console.log("this.shader_names",this.shader_names),e=0,t=this.shader_names;e<t.length;e++)a=t[e],n=this._template_shader_for_shader_name(a),this._lines.set(a,n.split("\n"));return this._root_nodes.length>0?[4,this.build_code_from_nodes(this._root_nodes)]:[3,2];case 1:r.sent(),this._build_lines(),r.label=2;case 2:for(o=0,i=this.shader_names;o<i.length;o++)a=i[o],(s=this._lines.get(a))&&(console.log(a,s.join("\n")),this._shaders_by_name.set(a,s.join("\n")));return[2]}}))}))},t.prototype.add_output_params=function(e){e.add_param(u.ParamType.VECTOR3,"position",[0,0,0]),e.add_param(u.ParamType.VECTOR3,"velocity",[0,0,0])},t.prototype.add_globals_params=function(e){e.io.outputs.set_named_output_connection_points([new c.TypedNamedConnectionPoint("position",p.ConnectionPointType.VEC3),new c.TypedNamedConnectionPoint("velocity",p.ConnectionPointType.VEC3),new c.TypedNamedConnectionPoint("time",p.ConnectionPointType.FLOAT)])},t.prototype.allow_attribute_exports=function(){return!0},Object.defineProperty(t.prototype,"texture_allocations_controller",{get:function(){return this._texture_allocations_controller=this._texture_allocations_controller||new a.TextureAllocationsController},enumerable:!0,configurable:!0}),t.prototype.create_shader_configs=function(){var e;return(null===(e=this._texture_allocations_controller)||void 0===e?void 0:e.create_shader_configs())||[]},t.prototype.create_variable_configs=function(){return[]},Object.defineProperty(t.prototype,"shader_names",{get:function(){return this.texture_allocations_controller.shader_names()||[]},enumerable:!0,configurable:!0}),t.prototype.input_names_for_shader_name=function(e,t){return this.texture_allocations_controller.input_names_for_shader_name(e,t)||[]},t.prototype.insert_define_after=function(e){return"// INSERT DEFINE"},t.prototype.insert_body_after=function(e){return"// INSERT BODY"},t.prototype.lines_to_remove=function(e){return["// INSERT DEFINE","// INSERT BODY"]},t.prototype.add_export_body_line=function(e,t,n,r,o){var i;if(n){var a=e.variable_for_input(t),_=s.ThreeToGl.vector3(a);if(_){var u=this.texture_allocations_controller.variable(r),c=o.current_shader_name;if(u&&(null===(i=u.allocation)||void 0===i?void 0:i.shader_name)==c){var p="gl_FragColor."+u.component+" = "+_;o.add_body_lines(e,[p],c)}}}},t.prototype.set_node_lines_output=function(e,t){var n=t.current_shader_name,r=this.texture_allocations_controller.input_names_for_shader_name(e,n);if(r)for(var o=0,i=r;o<i.length;o++){var a=i[o],s=e.io.inputs.named_input(a);if(s){var _=a;this.add_export_body_line(e,a,s,_,t)}}},t.prototype.set_node_lines_attribute=function(e,t){var n,r;if(e.is_importing){var o=e.gl_type(),i=e.attribute_name,a=null===(n=this.globals_handler)||void 0===n?void 0:n.read_attribute(e,o,i,t),s=e.gl_var_name(e.output_name),_=o+" "+s+" = "+a;t.add_body_lines(e,[_]);var u=this.texture_allocations_controller.variable(i),c=t.current_shader_name;if(u&&(null===(r=u.allocation)||void 0===r?void 0:r.shader_name)==c){var p=this.texture_allocations_controller.variable(i);if(p){var l="gl_FragColor."+p.component+" = "+s;t.add_body_lines(e,[l])}}}if(e.is_exporting){var d=e.connected_input_node();if(d){var f=e.attribute_name;this.add_export_body_line(e,e.input_name,d,f,t)}}},t.prototype.set_node_lines_globals=function(e,t){for(var n=0,r=e.io.outputs.used_output_names();n<r.length;n++){var o=r[n];switch(o){case"time":this._handle_globals_time(e,o,t);break;default:this._handle_globals_default(e,o,t)}}},t.prototype._handle_globals_time=function(e,t,n){var r=new l.UniformGLDefinition(e,p.ConnectionPointType.FLOAT,t);n.add_definitions(e,[r]);var o="float "+e.gl_var_name(t)+" = "+t;n.add_body_lines(e,[o]),this.set_uniforms_time_dependent()},t.prototype._handle_globals_default=function(e,t,n){var r,o=e.io.outputs.named_output_connection_points_by_name(t);if(o){var i=o.type,a=null===(r=this.globals_handler)||void 0===r?void 0:r.read_attribute(e,i,t,n),s=i+" "+e.gl_var_name(t)+" = "+a;n.add_body_lines(e,[s])}},t}(o.BaseGlShaderAssembler);t.ShaderAssemblerParticles=d},function(e,t,n){"use strict";n.r(t),t.default="#include <common>\n\n// INSERT DEFINE\n\nvoid main() {\n\n\tvec2 particleUV = (gl_FragCoord.xy / resolution.xy);\n\n\t// INSERT BODY\n\n}"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=r.__importDefault(n(82)),i=r.__importDefault(n(91)),a=r.__importDefault(n(102)),s=r.__importDefault(n(345)),_=n(978),u=n(979),c=n(50),p=n(16),l=function(){function e(){this._allocations=[],this._next_allocation_index=0}return e.prototype.allocate_connections_from_root_nodes=function(e,t){for(var n=[],r=0,o=e;r<o.length;r++){var i=(h=o[r]).graph_node_id;switch(h.type){case"output":for(var a=0,s=h.io.inputs.named_input_connection_points;a<s.length;a++){var _=s[a];if(h.io.inputs.named_input(_.name))(P=new u.TextureVariable(_.name,p.ConnectionPointComponentsCountMap[_.type])).add_graph_node_id(i),n.push(P)}break;case"attribute":var c=h,l=c.connected_input_node();_=c.connected_input_connection_point();if(l&&_)(P=new u.TextureVariable(c.attribute_name,p.ConnectionPointComponentsCountMap[_.type])).add_graph_node_id(i),n.push(P)}}for(var d=0,f=t;d<f.length;d++){var h;i=(h=f[d]).graph_node_id;switch(h.type){case"globals":for(var m=h,y=["position","normal","color","uv"],v=0,g=m.io.outputs.used_output_names();v<g.length;v++){var b=g[v];if(y.includes(b))if(_=m.io.outputs.named_output_connection_points_by_name(b)){var x=_.type;(P=new u.TextureVariable(b,p.ConnectionPointComponentsCountMap[x])).add_graph_node_id(i),n.push(P)}}break;case"attribute":var P,T=h;if(_=T.output_connection_point())(P=new u.TextureVariable(T.attribute_name,p.ConnectionPointComponentsCountMap[_.type])).add_graph_node_id(i),n.push(P)}}this.allocate_variables(n)},e.prototype.allocate_variables=function(e){for(var t=0,n=a.default(e,(function(e){return-e.size}));t<n.length;t++){var r=n[t];this.allocate_variable(r)}},e.prototype.allocate_variable=function(e){var t,n=this.has_variable(e.name);if(n){var r=this.variables().filter((function(t){return t.name==e.name}))[0];null===(t=e.graph_node_ids)||void 0===t||t.forEach((function(e,t){r.add_graph_node_id(t)}))}else{if(!n)for(var o=0,i=this._allocations;o<i.length;o++){var a=i[o];!n&&a.has_space_for_variable(e)&&(a.add_variable(e),n=!0)}if(!n){var s=new _.TextureAllocation(this.next_allocation_name());this._allocations.push(s),s.add_variable(e)}}},e.prototype.next_allocation_name=function(){var e=c.ParticleShaderNames[this._next_allocation_index];return this._next_allocation_index+=1,e},e.prototype.shader_names=function(){var e=this._allocations.map((function(e){return e.shader_name}));return i.default(e)},e.prototype.create_shader_configs=function(){return[]},e.prototype.allocation_for_shader_name=function(e){return this._allocations.filter((function(t){return t.shader_name==e}))[0]},e.prototype.input_names_for_shader_name=function(e,t){var n=this.allocation_for_shader_name(t);if(n)return n.input_names_for_node(e)},e.prototype.variable=function(e){for(var t=0,n=this._allocations;t<n.length;t++){var r=n[t].variable(e);if(r)return r}},e.prototype.variables=function(){return o.default(this._allocations.map((function(e){return e.variables||[]})))},e.prototype.has_variable=function(e){var t=this.variables().map((function(e){return e.name}));return s.default(t,e)},e.prototype.to_json=function(e){return this._allocations.map((function(t){var n;return(n={})[t.texture_name]=t.to_json(e),n}))},e.prototype.print=function(e){console.log(JSON.stringify(this.to_json(e),[""],2))},e}();t.TextureAllocationsController=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this._shader_name=e,this._size=0}return e.prototype.add_variable=function(e){this._variables=this._variables||[],this._variables.push(e),e.set_position(this._size),e.set_allocation(this),this._size+=e.size},e.prototype.has_space_for_variable=function(e){return this._size+e.size<=4},Object.defineProperty(e.prototype,"shader_name",{get:function(){return this._shader_name},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"texture_name",{get:function(){return"texture_"+this._shader_name},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"variables",{get:function(){return this._variables},enumerable:!0,configurable:!0}),e.prototype.variables_for_input_node=function(e){var t;return null===(t=this._variables)||void 0===t?void 0:t.filter((function(t){var n;return(null===(n=t.graph_node_ids)||void 0===n?void 0:n.has(e.graph_node_id))||!1}))},e.prototype.input_names_for_node=function(e){var t;return null===(t=this.variables_for_input_node(e))||void 0===t?void 0:t.map((function(e){return e.name}))},e.prototype.variable=function(e){if(this._variables)for(var t=0,n=this._variables;t<n.length;t++){var r=n[t];if(r.name==e)return r}},e.prototype.to_json=function(e){var t;return null===(t=this._variables)||void 0===t?void 0:t.map((function(t){return t.to_json(e)}))},e}();t.TextureAllocation=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){if(this._name=e,this._size=t,this._position=-1,!e)throw"TextureVariable requires a name"}return e.prototype.set_allocation=function(e){this._allocation=e},Object.defineProperty(e.prototype,"allocation",{get:function(){return this._allocation},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"graph_node_ids",{get:function(){return this._graph_node_ids},enumerable:!0,configurable:!0}),e.prototype.add_graph_node_id=function(e){this._graph_node_ids=this._graph_node_ids||new Map,this._graph_node_ids.set(e,!0)},Object.defineProperty(e.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),e.prototype.set_position=function(e){this._position=e},Object.defineProperty(e.prototype,"position",{get:function(){return this._position},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"component",{get:function(){return"xyzw".split("").splice(this._position,this._size).join("")},enumerable:!0,configurable:!0}),e.prototype.to_json=function(e){var t=[];return this._graph_node_ids&&this._graph_node_ids.forEach((function(n,r){var o=e.graph.node_from_id(r).name;t.push(o)})),{name:this.name,nodes:t.sort()}},e}();t.TextureVariable=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=r.__importDefault(n(190)),i=n(282),a=n(162),s=function(){function e(e){this.node=e,this._particles_group_objects=[]}return e.prototype.set_shaders_by_name=function(e){this._shaders_by_name=e,this.reset_render_material()},e.prototype.assign_render_material=function(){if(this._render_material){for(var e=0,t=this._particles_group_objects;e<t.length;e++){var n=t[e];n.geometry&&(n.material=this._render_material,a.CoreMaterial.apply_custom_materials(n,this._render_material),n.matrixAutoUpdate=!1,n.updateMatrix())}this._render_material.needsUpdate=!0,this.update_render_material_uniforms()}},e.prototype.update_render_material_uniforms=function(){var e,t=this;this._render_material&&(null===(e=this._shaders_by_name)||void 0===e||e.forEach((function(e,n){var r,o=null===(r=t.node.gpu_controller.getCurrentRenderTarget(n))||void 0===r?void 0:r.texture;if(o){var i="texture_"+n;t._render_material&&(t._render_material.uniforms[i].value=o,a.CoreMaterial.assign_custom_uniforms(t._render_material,i,o))}})))},e.prototype.reset_render_material=function(){this._render_material=void 0,this._particles_group_objects=[]},Object.defineProperty(e.prototype,"initialized",{get:function(){return null!=this._render_material},enumerable:!0,configurable:!0}),e.prototype.init_core_group=function(e){for(var t=0,n=e.objects();t<n.length;t++){var r=n[t];this._particles_group_objects.push(r)}},e.prototype.init_render_material=function(){var e;return r.__awaiter(this,void 0,void 0,(function(){var t,n,s,_,u,c=this;return r.__generator(this,(function(r){switch(r.label){case 0:return this._render_material?[2]:this.node.p.material.is_dirty?[4,this.node.p.material.compute()]:[3,2];case 1:r.sent(),r.label=2;case 2:return(t=this.node.p.material.found_node())?(n=this.node.assembler_controller.assembler.texture_allocations_controller.to_json(this.node.scene),(s=new i.GlobalsTextureHandler(i.GlobalsTextureHandler.UV_VARYING)).set_texture_allocations_controller(this.node.assembler_controller.assembler.texture_allocations_controller),t.assembler_controller.set_assembler_globals_handler(s),this._texture_allocations_json&&JSON.stringify(this._texture_allocations_json)==JSON.stringify(n)||(this._texture_allocations_json=o.default(n),t.set_dirty()),[4,t.request_container()]):[3,4];case 3:return _=r.sent(),this._render_material=_.material(),[3,5];case 4:this.node.states.error.set("render material not valid"),r.label=5;case 5:return this._render_material&&(u=this._render_material.uniforms,null===(e=this._shaders_by_name)||void 0===e||e.forEach((function(e,t){var n="texture_"+t,r={value:null};u[n]=r,c._render_material&&a.CoreMaterial.init_custom_material_uniforms(c._render_material,n,r)}))),this.assign_render_material(),[2]}}))}))},e}();t.ParticlesSystemGpuRenderController=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(3),i=n(14),a=n(228),s=n(4),_=n(104),u=n(282),c=n(982),p=n(66),l=function(){function e(e){this.node=e,this._simulation_restart_required=!1,this._points=[],this.variables_by_name=new Map,this._created_textures_by_name=new Map,this._used_textures_size=new o.Vector2}return e.prototype.set_shaders_by_name=function(e){this._shaders_by_name=e,this.reset_gpu_compute()},e.prototype.init=function(e){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(t){switch(t.label){case 0:return this.init_particle_group_points(e),[4,this.create_gpu_compute()];case 1:return t.sent(),[2]}}))}))},e.prototype.getCurrentRenderTarget=function(e){var t,n=this.variables_by_name.get(e);if(n)return null===(t=this._gpu_compute)||void 0===t?void 0:t.getCurrentRenderTarget(n)},e.prototype.init_particle_group_points=function(e){this.reset_gpu_compute(),e&&(this._particles_core_group=e,this._points=this._get_points()||[])},e.prototype.compute_similation_if_required=function(){var e=this.node.scene.frame,t=this.node.pv.start_frame;e>=t&&(null==this._last_simulated_frame&&(this._last_simulated_frame=t-1),e>this._last_simulated_frame&&this._compute_simulation(e-this._last_simulated_frame))},e.prototype._compute_simulation=function(e){if(void 0===e&&(e=1),this._gpu_compute){this.update_simulation_material_uniforms();for(var t=0;t<e;t++)this._gpu_compute.compute();this.node.render_controller.update_render_material_uniforms(),this._last_simulated_frame=this.node.scene.frame}},e.prototype.create_gpu_compute=function(){var e,t;return r.__awaiter(this,void 0,void 0,(function(){var n,o,a,s,u,l,d=this;return r.__generator(this,(function(r){switch(r.label){case 0:if(this.node.pv.auto_textures_size)n=_.CoreMath.nearestPower2(Math.sqrt(this._points.length)),this._used_textures_size.x=Math.min(n,this.node.pv.max_textures_size.x),this._used_textures_size.y=Math.min(n,this.node.pv.max_textures_size.y);else{if(!i.MathUtils.isPowerOfTwo(this.node.pv.textures_size.x)||!i.MathUtils.isPowerOfTwo(this.node.pv.textures_size.y))return this.node.states.error.set("texture size must be a power of 2"),[2];if(o=this.node.pv.textures_size.x*this.node.pv.textures_size.y,this._points.length>o)return this.node.states.error.set("max particles is set to ("+this.node.pv.textures_size.x+"x"+this.node.pv.textures_size.y+"=) "+o),[2];this._used_textures_size.copy(this.node.pv.textures_size)}return this.node.states.time_dependent.force_time_dependent(),this._init_particles_uvs(),this.node.render_controller.reset_render_material(),[4,p.POLY.renderers_controller.wait_for_renderer()];case 1:return(a=r.sent())?this._renderer=a:this.node.states.error.set("no renderer found"),s=new c.GPUComputationRenderer(this._used_textures_size.x,this._used_textures_size.y,this._renderer),this._gpu_compute=s,this._gpu_compute?(this._last_simulated_frame=void 0,this.variables_by_name.forEach((function(e,t){e.renderTargets[0].dispose(),e.renderTargets[1].dispose(),d.variables_by_name.delete(t)})),u=[],null===(e=this._shaders_by_name)||void 0===e||e.forEach((function(e,t){if(d._gpu_compute){var n=d._gpu_compute.addVariable("texture_"+t,e,d._created_textures_by_name.get(t));d.variables_by_name.set(t,n),u.push(n)}})),null===(t=this.variables_by_name)||void 0===t||t.forEach((function(e,t){d._gpu_compute&&d._gpu_compute.setVariableDependencies(e,u)})),this._create_texture_render_targets(),this._fill_textures(),this.create_simulation_material_uniforms(),null!==(l=this._gpu_compute.init())&&(console.error(l),this.node.states.error.set(l)),[2]):(this.node.states.error.set("failed to create the GPUComputationRenderer"),[2])}}))}))},e.prototype.create_simulation_material_uniforms=function(){var e=this;this.variables_by_name.forEach((function(t,n){var r=t.material.uniforms;r.frame={value:e.node.scene.frame};for(var o=0,i=e.node.assembler_controller.assembler.param_configs();o<i.length;o++){var a=i[o];r[a.uniform_name]=a.uniform}}))},e.prototype.update_simulation_material_uniforms=function(){var e=this;this.variables_by_name.forEach((function(t,n){t.material.uniforms.frame.value=e.node.scene.frame}))},e.prototype._init_particles_uvs=function(){for(var e=new Float32Array(2*this._points.length),t=0,n=0,r=0;r<this._used_textures_size.x;r++)for(var o=0;o<this._used_textures_size.y&&(e[t++]=o/(this._used_textures_size.x-1),e[t++]=r/(this._used_textures_size.y-1),!((n+=2)>=e.length));o++);var i=u.GlobalsTextureHandler.UV_ATTRIB;if(this._particles_core_group)for(var _=0,c=this._particles_core_group.core_geometries();_<c.length;_++){var p=c[_],l=p.geometry(),d=p.marked_as_instance()?a.InstancedBufferAttribute:s.BufferAttribute;l.setAttribute(i,new d(e,2))}},e.prototype.created_textures_by_name=function(){return this._created_textures_by_name},e.prototype._fill_textures=function(){var e=this;this._created_textures_by_name.forEach((function(t,n){var r=e.node.assembler_controller.assembler.texture_allocations_controller.allocation_for_shader_name(n);if(r){var o=r.variables;if(o)for(var i=t.image.data,a=0,s=o;a<s.length;a++){var _=s[a],u=_.position,c=_.name,p=e._points[0];if(p)if(p.has_attrib(c))for(var l=p.attrib_size(c),d=u,f=0,h=e._points;f<h.length;f++){var m=h[f];if(1==l){var y=m.attrib_value(c);i[d]=y}else m.attrib_value(c).toArray(i,d);d+=4}}}}))},e.prototype.reset_gpu_compute=function(){this._gpu_compute=void 0,this._simulation_restart_required=!0},e.prototype.set_restart_not_required=function(){this._simulation_restart_required=!1},e.prototype.reset_gpu_compute_and_set_dirty=function(){this.reset_gpu_compute(),this.node.set_dirty()},e.prototype.reset_particle_groups=function(){this._particles_core_group=void 0},Object.defineProperty(e.prototype,"initialized",{get:function(){return null!=this._particles_core_group&&null!=this._gpu_compute},enumerable:!0,configurable:!0}),e.prototype._create_texture_render_targets=function(){var e=this;this._created_textures_by_name.forEach((function(e,t){e.dispose()})),this._created_textures_by_name.clear(),this.variables_by_name.forEach((function(t,n){e._gpu_compute&&e._created_textures_by_name.set(n,e._gpu_compute.createTexture())}))},e.prototype.restart_simulation_if_required=function(){this._simulation_restart_required&&this._restart_simulation()},e.prototype._restart_simulation=function(){var e=this;this._last_simulated_frame=void 0,this._create_texture_render_targets(),this._get_points()&&(this._fill_textures(),this.variables_by_name.forEach((function(t,n){var r=e._created_textures_by_name.get(n);e._gpu_compute&&r&&(e._gpu_compute.renderTexture(r,t.renderTargets[0]),e._gpu_compute.renderTexture(r,t.renderTargets[1]))})))},e.prototype._get_points=function(){if(this._particles_core_group){var e=this._particles_core_group.core_geometries(),t=e[0];if(t){for(var n=t.marked_as_instance(),r=[],o=0,i=e;o<i.length;o++){(u=i[o]).marked_as_instance()==n&&r.push(u)}for(var a=[],s=0,_=r;s<_.length;s++)for(var u,c=0,p=(u=_[s]).points();c<p.length;c++){var l=p[c];a.push(l)}return a}return[]}},e}();t.ParticlesSystemGpuComputeController=l},function(e,t,n){"use strict";n.r(t),n.d(t,"GPUComputationRenderer",(function(){return p}));var r=n(77),o=n(0),i=n(70),a=n(22),s=n(54),_=n(55),u=n(26),c=n(75),p=function(e,t,n){this.variables=[],this.currentTextureIndex=0;var p=new _.Scene,l=new r.Camera;l.position.z=1;var d={passThruTexture:{value:null}},f=y("uniform sampler2D passThruTexture;\n\nvoid main() {\n\n\tvec2 uv = gl_FragCoord.xy / resolution.xy;\n\n\tgl_FragColor = texture2D( passThruTexture, uv );\n\n}\n",d),h=new a.Mesh(new s.PlaneBufferGeometry(2,2),f);function m(n){n.defines.resolution="vec2( "+e.toFixed(1)+", "+t.toFixed(1)+" )"}function y(e,t){t=t||{};var n=new u.ShaderMaterial({uniforms:t,vertexShader:"void main()\t{\n\n\tgl_Position = vec4( position, 1.0 );\n\n}\n",fragmentShader:e});return m(n),n}p.add(h),this.addVariable=function(e,t,n){var r={name:e,initialValueTexture:n,material:this.createShaderMaterial(t),dependencies:null,renderTargets:[],wrapS:null,wrapT:null,minFilter:o.NearestFilter,magFilter:o.NearestFilter};return this.variables.push(r),r},this.setVariableDependencies=function(e,t){e.dependencies=t},this.init=function(){if(!n.capabilities.isWebGL2&&!n.extensions.get("OES_texture_float"))return"No OES_texture_float support for float textures.";if(0===n.capabilities.maxVertexTextures)return"No support for vertex shader textures.";for(var r=0;r<this.variables.length;r++){var o=this.variables[r];o.renderTargets[0]=this.createRenderTarget(e,t,o.wrapS,o.wrapT,o.minFilter,o.magFilter),o.renderTargets[1]=this.createRenderTarget(e,t,o.wrapS,o.wrapT,o.minFilter,o.magFilter),this.renderTexture(o.initialValueTexture,o.renderTargets[0]),this.renderTexture(o.initialValueTexture,o.renderTargets[1]);var i=o.material.uniforms;if(null!==o.dependencies)for(var a=0;a<o.dependencies.length;a++){var s=o.dependencies[a];if(s.name!==o.name){for(var _=!1,u=0;u<this.variables.length;u++)if(s.name===this.variables[u].name){_=!0;break}if(!_)return"Variable dependency not found. Variable="+o.name+", dependency="+s.name}i[s.name]={value:null}}}return this.currentTextureIndex=0,null},this.compute=function(){for(var e=this.currentTextureIndex,t=0===this.currentTextureIndex?1:0,n=0,r=this.variables.length;n<r;n++){var o=this.variables[n];if(null!==o.dependencies)for(var i=o.material.uniforms,a=0,s=o.dependencies.length;a<s;a++){var _=o.dependencies[a];i[_.name].value=_.renderTargets[e].texture}this.doRenderTarget(o.material,o.renderTargets[t])}this.currentTextureIndex=t},this.getCurrentRenderTarget=function(e){return e.renderTargets[this.currentTextureIndex]},this.getAlternateRenderTarget=function(e){return e.renderTargets[0===this.currentTextureIndex?1:0]},this.addResolutionDefine=m,this.createShaderMaterial=y,this.createRenderTarget=function(n,r,i,a,s,_){return n=n||e,r=r||t,i=i||o.ClampToEdgeWrapping,a=a||o.ClampToEdgeWrapping,s=s||o.NearestFilter,_=_||o.NearestFilter,new c.WebGLRenderTarget(n,r,{wrapS:i,wrapT:a,minFilter:s,magFilter:_,format:o.RGBAFormat,type:/(iPad|iPhone|iPod)/g.test(navigator.userAgent)?o.HalfFloatType:o.FloatType,stencilBuffer:!1,depthBuffer:!1})},this.createTexture=function(){var n=new Float32Array(e*t*4);return new i.DataTexture(n,e,t,o.RGBAFormat,o.FloatType)},this.renderTexture=function(e,t){d.passThruTexture.value=e,this.doRenderTarget(f,t),d.passThruTexture.value=null},this.doRenderTarget=function(e,t){var r=n.getRenderTarget();h.material=e,n.setRenderTarget(t),n.render(p,l),h.material=f,n.setRenderTarget(r)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(53),i=n(13),a=n(17),s=n(5),_=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.amount=s.ParamConfig.FLOAT(1,{range:[-1,1]}),t}return r.__extends(t,e),t}(s.NodeParamsConfig)),u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=_,t}return r.__extends(t,e),t.type=function(){return"peak"},t.prototype.initialize_node=function(){this.io.inputs.set_count(1),this.io.inputs.init_inputs_clonable_state([a.InputCloneMode.FROM_NODE])},t.prototype.cook=function(e){for(var t,n,r=this,i=e[0],a=0,s=i.objects();a<s.length;a++){s[a].traverse((function(e){var i;if(null!=(i=e.geometry)){for(var a=0,s=(t=new o.CoreGeometry(i)).points();a<s.length;a++){var _=(n=s[a]).normal(),u=n.position().clone().add(_.multiplyScalar(r.pv.amount));n.set_position(u)}if(!r.io.inputs.input_cloned(0))t.geometry().getAttribute("position").needsUpdate=!0}}))}this.set_core_group(i)},t}(i.TypedSopNode);t.PeakSopNode=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(1),i=n(3),a=n(54),s=n(13),_=n(84),u=n(17),c=new o.Vector3(0,0,1),p=new o.Vector3(0,0,1),l=new o.Vector3(0,1,0),d=n(5),f=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.size=d.ParamConfig.VECTOR2([1,1]),t.use_segments_count=d.ParamConfig.BOOLEAN(0),t.step_size=d.ParamConfig.FLOAT(1,{visible_if:{use_segments_count:0}}),t.segments=d.ParamConfig.VECTOR2([1,1],{visible_if:{use_segments_count:1}}),t.direction=d.ParamConfig.VECTOR3([0,1,0]),t.center=d.ParamConfig.VECTOR3([0,0,0]),t}return r.__extends(t,e),t}(d.NodeParamsConfig)),h=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=f,t._core_transform=new _.CoreTransform,t}return r.__extends(t,e),t.type=function(){return"plane"},t.displayed_input_names=function(){return["geometry to create plane from (optional)"]},t.prototype.initialize_node=function(){this.io.inputs.set_count(0,1),this.io.inputs.init_inputs_clonable_state([u.InputCloneMode.NEVER])},t.prototype.cook=function(e){var t=e[0];t?this._cook_with_input(t):this._cook_without_input()},t.prototype._cook_without_input=function(){var e=this._create_plane(this.pv.size);this._core_transform.rotate_geometry(e,c,this.pv.direction);var t=this._core_transform.translation_matrix(this.pv.center);e.applyMatrix4(t),this.set_geometry(e)},t.prototype._cook_with_input=function(e){var t=e.bounding_box(),n=new o.Vector3;t.getSize(n);var r=new o.Vector3;t.getCenter(r);var a=new i.Vector2(n.x,n.z),s=this._create_plane(a);this._core_transform.rotate_geometry(s,p,l);var _=this._core_transform.translation_matrix(r);s.applyMatrix4(_),this.set_geometry(s)},t.prototype._create_plane=function(e){var t;return e=e.clone(),this.pv.use_segments_count?t={x:Math.floor(this.pv.segments.x),y:Math.floor(this.pv.segments.y)}:(t={x:Math.floor(e.x/this.pv.step_size),y:Math.floor(e.y/this.pv.step_size)},e.x=t.x*this.pv.step_size,e.y=t.y*this.pv.step_size),new a.PlaneBufferGeometry(e.x,e.y,t.x,t.y)},t}(s.TypedSopNode);t.PlaneSopNode=h},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(13),i=n(17),a=n(5),s=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.update_x=a.ParamConfig.BOOLEAN(0),t.x=a.ParamConfig.FLOAT("@P.x",{visible_if:{update_x:1},expression:{for_entities:!0}}),t.update_y=a.ParamConfig.BOOLEAN(0),t.y=a.ParamConfig.FLOAT("@P.y",{visible_if:{update_y:1},expression:{for_entities:!0}}),t.update_z=a.ParamConfig.BOOLEAN(0),t.z=a.ParamConfig.FLOAT("@P.z",{visible_if:{update_z:1},expression:{for_entities:!0}}),t.update_normals=a.ParamConfig.BOOLEAN(1),t}return r.__extends(t,e),t}(a.NodeParamsConfig)),_=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=s,t._x_arrays_by_geometry_uuid=new Map,t._y_arrays_by_geometry_uuid=new Map,t._z_arrays_by_geometry_uuid=new Map,t}return r.__extends(t,e),t.type=function(){return"point"},t.displayed_input_names=function(){return["points to move"]},t.prototype.initialize_node=function(){this.io.inputs.set_count(1),this.io.inputs.init_inputs_clonable_state([i.InputCloneMode.FROM_NODE])},t.prototype.cook=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t;return r.__generator(this,(function(n){switch(n.label){case 0:return t=e[0],[4,this._eval_expressions_for_core_group(t)];case 1:return n.sent(),[2]}}))}))},t.prototype._eval_expressions_for_core_group=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,n,o,i,a,s,_,u,c;return r.__generator(this,(function(r){switch(r.label){case 0:t=e.core_objects(),n=0,r.label=1;case 1:return n<t.length?[4,this._eval_expressions_for_core_object(t[n])]:[3,4];case 2:r.sent(),r.label=3;case 3:return n++,[3,1];case 4:for(this.pv.update_normals&&e.compute_vertex_normals(),o=e.geometries(),i=0,a=o;i<a.length;i++)(c=a[i]).computeBoundingBox();if(!this.io.inputs.input_cloned(0))for(s=e.geometries(),_=0,u=s;_<u.length;_++)c=u[_],c.getAttribute("position").needsUpdate=!0;return this.set_core_group(e),[2]}}))}))},t.prototype._eval_expressions_for_core_object=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,n,o,i,a,s,_;return r.__generator(this,(function(r){switch(r.label){case 0:return t=e.object(),n=t.geometry,o=e.points(),i=n.getAttribute("position").array,[4,this._update_from_param(n,i,o,this.p.update_x,this.p.x,this.pv.x,this._x_arrays_by_geometry_uuid,0)];case 1:return a=r.sent(),[4,this._update_from_param(n,i,o,this.p.update_y,this.p.y,this.pv.y,this._y_arrays_by_geometry_uuid,1)];case 2:return s=r.sent(),[4,this._update_from_param(n,i,o,this.p.update_z,this.p.z,this.pv.z,this._z_arrays_by_geometry_uuid,2)];case 3:return _=r.sent(),a&&this._commit_tmp_values(a,i,0),s&&this._commit_tmp_values(s,i,1),_&&this._commit_tmp_values(_,i,2),[2]}}))}))},t.prototype._update_from_param=function(e,t,n,o,i,a,s,_){return r.__awaiter(this,void 0,void 0,(function(){var t,u,c,p,l;return r.__generator(this,(function(r){switch(r.label){case 0:return t=o,u=i,c=this._init_array_if_required(e,s,n.length,_),t.value?u.has_expression()&&u.expression_controller?[4,u.expression_controller.compute_expression_for_points(n,(function(e,t){c[e.index]=t}))]:[3,2]:[3,3];case 1:return r.sent(),[3,3];case 2:for(p=void 0,l=0;l<n.length;l++)p=n[l],c[p.index]=a;r.label=3;case 3:return[2,c]}}))}))},t.prototype._init_array_if_required=function(e,t,n,r){var o=e.uuid,i=t.get(o);if(i){if(i.length<n){var a=this._array_for_component(e,n,r);return t.set(o,a),a}return i}a=this._array_for_component(e,n,r);return t.set(o,a),a},t.prototype._array_for_component=function(e,t,n){for(var r=new Array(t),o=e.getAttribute("position").array,i=0;i<r.length;i++)r[i]=o[3*i+n];return r},t.prototype._commit_tmp_values=function(e,t,n){for(var r=0;r<e.length;r++)t[3*r+n]=e[r]},t}(o.TypedSopNode);t.PointSopNode=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(13),i=n(53),a=n(84),s=n(384),_=n(283),u=n(408),c=n(1),p=n(57),l=n(6),d=n(17),f=new c.Vector3(0,0,0),h=new c.Vector3(1,1,1),m=n(5),y=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.radius=m.ParamConfig.FLOAT(1),t.segments_radial=m.ParamConfig.INTEGER(8,{range:[3,20],range_locked:[!0,!1]}),t.closed=m.ParamConfig.BOOLEAN(0),t}return r.__extends(t,e),t}(m.NodeParamsConfig)),v=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=y,t._core_transform=new a.CoreTransform,t._geometries=[],t}return r.__extends(t,e),t.type=function(){return"polywire"},t.displayed_input_names=function(){return["lines to create tubes from"]},t.prototype.initialize_node=function(){this.io.inputs.set_count(1),this.io.inputs.init_inputs_clonable_state([d.InputCloneMode.NEVER])},t.prototype.cook=function(e){var t=e[0];this._geometries=[];for(var n=0,r=t.objects();n<r.length;n++){(_=r[n])instanceof p.LineSegments&&this._create_tube(_)}for(var o=i.CoreGeometry.merge_geometries(this._geometries),a=0,s=this._geometries;a<s.length;a++){s[a].dispose()}if(o){var _=this.create_object(o);this.set_object(_)}else this.set_objects([])},t.prototype._create_tube=function(e){for(var t,n=e.geometry,r=new i.CoreGeometry(n).points(),o=null===(t=n.getIndex())||void 0===t?void 0:t.array,a=0,s=_.CoreGeometryUtilCurve.accumulated_curve_point_indices(o);a<s.length;a++){var u=s[a].map((function(e){return r[e]}));this._create_tube_from_points(u)}},t.prototype._create_tube_from_points=function(e){if(!(e.length<=1)){for(var t=e.map((function(e){return e.attrib_value("position")})),n=s.CoreGeometryUtilCircle.create(this.pv.radius,this.pv.segments_radial),r=[],o=0,i=t;o<i.length;o++){var a=i[o],_=this._core_transform.matrix(a,f,h,1),u=n.clone();u.applyMatrix4(_),r.push(u)}for(var c=0;c<r.length;c++)if(c>0){var p=r[c],l=r[c-1],d=this._skin(l,p);this._geometries.push(d)}}},t.prototype._skin=function(e,t){var n=new l.BufferGeometry;return new u.CoreGeometryOperationSkin(n,e,t).process(),n},t}(o.TypedSopNode);t.PolywireSopNode=v},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(272),i=n(56),a=n(0),s=n(13),_=n(17),u=new i.MeshBasicMaterial({side:a.DoubleSide}),c=n(5),p=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.use_normals=c.ParamConfig.BOOLEAN(1),t.direction=c.ParamConfig.VECTOR3([0,-1,0],{visible_if:{use_normals:0}}),t.transfer_face_normals=c.ParamConfig.BOOLEAN(1),t}return r.__extends(t,e),t}(c.NodeParamsConfig)),l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=p,t._bound_assign_mat=t._assign_double_sided_material_to_object.bind(t),t._raycaster=new o.Raycaster,t}return r.__extends(t,e),t.type=function(){return"ray"},t.double_sided_material=function(){return u},t.displayed_input_names=function(){return["geometry to move","geometry to ray onto"]},t.prototype.initialize_node=function(){this.io.inputs.set_count(2),this.io.inputs.init_inputs_clonable_state([_.InputCloneMode.FROM_NODE,_.InputCloneMode.ALWAYS])},t.prototype.create_params=function(){},t.prototype.cook=function(e){var t=e[0],n=e[1];this.ray(t,n)},t.prototype.ray=function(e,t){var n,r;this._assign_double_sided_material_to_core_group(t);for(var o=0,i=e.points();o<i.length;o++){var a=i[o];n=this.pv.use_normals?a.normal():this.pv.direction,this._raycaster.set(a.position(),n),(r=this._raycaster.intersectObjects(t.objects(),!0)[0])&&(a.set_position(r.point),this.pv.transfer_face_normals&&r.face&&a.set_normal(r.face.normal))}this.set_core_group(e)},t.prototype._assign_double_sided_material_to_core_group=function(e){for(var t=0,n=e.objects();t<n.length;t++){n[t].traverse(this._bound_assign_mat)}},t.prototype._assign_double_sided_material_to_object=function(e){e.material=t.double_sided_material()},t}(s.TypedSopNode);t.RaySopNode=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,o,i=n(2),a=n(57),s=n(4),_=n(6),u=n(279),c=n(277),p=i.__importDefault(n(82)),l=i.__importDefault(n(328)),d=n(13),f=n(35),h=n(283),m=n(53);!function(e){e.POINTS_COUNT="points_count",e.SEGMENT_LENGTH="segment_length"}(r=t.METHOD||(t.METHOD={})),t.METHODS=[r.POINTS_COUNT,r.SEGMENT_LENGTH],function(e){e.CENTRIPETAL="centripetal",e.CHORDAL="chordal",e.CATMULLROM="catmullrom"}(o=t.CURVE_TYPE||(t.CURVE_TYPE={})),t.CURVE_TYPES=[o.CENTRIPETAL,o.CHORDAL,o.CATMULLROM];var y=n(5),v=n(192),g=new(function(e){function n(){var n=null!==e&&e.apply(this,arguments)||this;return n.method=y.ParamConfig.INTEGER(t.METHODS.indexOf(r.POINTS_COUNT),{menu:{entries:t.METHODS.map((function(e,t){return{name:e,value:t}}))}}),n.curve_type=y.ParamConfig.INTEGER(t.CURVE_TYPES.indexOf(o.CATMULLROM),{range:[0,2],range_locked:[!0,!0],menu:{entries:t.CURVE_TYPES.map((function(e,t){return{name:e,value:t}}))}}),n.tension=y.ParamConfig.FLOAT(.01,{range:[0,1],range_locked:[!0,!0]}),n.points_count=y.ParamConfig.INTEGER(100,{visible_if:{method:t.METHODS.indexOf(r.POINTS_COUNT)}}),n.segment_length=y.ParamConfig.FLOAT(1,{visible_if:{method:t.METHODS.indexOf(r.SEGMENT_LENGTH)}}),n}return i.__extends(n,e),n}(y.NodeParamsConfig)),b=function(e){function n(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=g,t}return i.__extends(n,e),n.type=function(){return"resample"},n.prototype.initialize_node=function(){this.io.inputs.set_count(1)},n.prototype.cook=function(e){var t=e[0],n=[];if(this.pv.points_count>=2)for(var r=t.core_objects(),o=0;o<r.length;o++){var i=r[o].object();if(i instanceof a.LineSegments){var s=this._resample(i);n.push(s)}}this.set_objects(n)},n.prototype._resample=function(e){for(var t,n=e.geometry,r=new m.CoreGeometry(n).points(),o=null===(t=n.getIndex())||void 0===t?void 0:t.array,i=h.CoreGeometryUtilCurve.accumulated_curve_point_indices(o),a=[],s=0;s<i.length;s++){var _=i[s].map((function(e){return r[e]})),u=this._create_curve_from_points(_);u&&a.push(u)}var p=c.BufferGeometryUtils.mergeBufferGeometries(a);return this.create_object(p,f.CoreConstant.OBJECT_TYPE.LINE_SEGMENTS)},n.prototype._create_curve_from_points=function(e){if(!(e.length<=1)){for(var n=l.default(e,(function(e){return e.attrib_value("position")})),r=t.CURVE_TYPES[this.pv.curve_type],o=this.pv.tension,i=new u.CatmullRomCurve3(n,!1,r,o),a=this._get_points_from_curve(i),c=[],d=[],f=0;f<a.length;f++){var h=a[f].toArray();c.push(h),f>0&&(d.push(f-1),d.push(f))}c=p.default(c);var m=new _.BufferGeometry;return m.setAttribute("position",new s.Float32BufferAttribute(c,3)),m.setIndex(d),m}},n.prototype._get_points_from_curve=function(e){var n=t.METHODS[this.pv.method];switch(n){case r.POINTS_COUNT:return e.getSpacedPoints(Math.max(2,this.pv.points_count));case r.SEGMENT_LENGTH:var o=e.getLength(),i=0!==this.pv.segment_length?1+o/this.pv.segment_length:2;return i=Math.max(2,i),e.getSpacedPoints(i)}v.TypeAssert.unreachable(n)},n}(d.TypedSopNode);t.ResampleSopNode=b},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(6),i={BufferAttribute:n(4).BufferAttribute,BufferGeometry:o.BufferGeometry},a=r.__importDefault(n(81)),s=r.__importDefault(n(44)),_=r.__importDefault(n(102)),u=n(13),c=n(35),p=n(104),l=n(383),d=n(5),f=n(17),h=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.points_count=d.ParamConfig.INTEGER(100,{range:[0,100],range_locked:[!0,!1]}),t.seed=d.ParamConfig.INTEGER(0,{range:[0,100],range_locked:[!1,!1]}),t.transfer_attributes=d.ParamConfig.BOOLEAN(0),t.attributes_to_transfer=d.ParamConfig.STRING("normal",{visible_if:{transfer_attributes:1}}),t.add_id_attribute=d.ParamConfig.BOOLEAN(1),t}return r.__extends(t,e),t}(d.NodeParamsConfig)),m=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=h,t}return r.__extends(t,e),t.type=function(){return"scatter"},t.displayed_input_names=function(){return["geometry to scatter points onto"]},t.prototype.initialize_node=function(){this.io.inputs.set_count(1),this.io.inputs.init_inputs_clonable_state([f.InputCloneMode.NEVER])},t.prototype.cook=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,n,o,u,d,f,h,m,y,v,g,b,x,P,T,w,C,O,E,A,N,M,j,S,R=this;return r.__generator(this,(function(r){switch(r.label){case 0:for(t=e[0],n=t.faces(),o=[],u=0,d=new Map,f=0,h=n;f<h.length;f++)x=h[f],m=x.area,d.set(x.index,m);for(y=_.default(n,(function(e){return d.get(e.index)})),v=0,g=0,b=y;g<b.length;g++)x=b[g],u+=d.get(x.index),o[v]=u,v++;for(P=[],T=[],this.pv.transfer_attributes&&(T=t.attrib_names_matching_mask(this.pv.attributes_to_transfer)),w=new Map,C=new Map,O=0,E=T;O<E.length;O++)j=E[O],w.set(j,[]),C.set(j,t.attrib_size(j));return[4,(new l.CoreIterator).start_with_count(this.pv.points_count,(function(e){for(var t=p.CoreMath.rand_float(R.pv.seed+e)*u,n=0;n<o.length;n++){if(t<=o[n]){var r=y[n],i=r.random_position(t);i.toArray(P,P.length);for(var a=0,_=T;a<_.length;a++){var c=_[a],l=r.attrib_value_at_position(c,i);s.default(l)?w.get(c).push(l):l.toArray(w.get(c),w.get(c).length)}break}}}))];case 1:for(r.sent(),(A=new i.BufferGeometry).setAttribute("position",new i.BufferAttribute(new Float32Array(P),3)),N=0,M=T;N<M.length;N++)j=M[N],A.setAttribute(j,new i.BufferAttribute(new Float32Array(w.get(j)),C.get(j)));return this.pv.add_id_attribute&&(S=a.default(this.pv.points_count),A.setAttribute("id",new i.BufferAttribute(new Float32Array(S),1))),this.set_geometry(A,c.CoreConstant.OBJECT_TYPE.POINTS),[2]}}))}))},t}(u.TypedSopNode);t.ScatterSopNode=m},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(13),i=n(17),a=n(5),s=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.cast_shadow=a.ParamConfig.BOOLEAN(1),t.receive_shadow=a.ParamConfig.BOOLEAN(1),t.apply_to_children=a.ParamConfig.BOOLEAN(0),t}return r.__extends(t,e),t}(a.NodeParamsConfig)),_=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=s,t}return r.__extends(t,e),t.type=function(){return"shadows"},t.displayed_input_names=function(){return["objects to change shadows properties of"]},t.prototype.initialize_node=function(){this.io.inputs.set_count(1),this.io.inputs.init_inputs_clonable_state([i.InputCloneMode.FROM_NODE])},t.prototype.cook=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,n,o,i,a=this;return r.__generator(this,(function(r){for(t=e[0],n=0,o=t.objects();n<o.length;n++)i=o[n],this.pv.apply_to_children?i.traverse((function(e){e.castShadow=a.pv.cast_shadow,e.receiveShadow=a.pv.receive_shadow})):(i.castShadow=this.pv.cast_shadow,i.receiveShadow=this.pv.receive_shadow);return console.log(t.objects()),this.set_core_group(t),[2]}))}))},t}(o.TypedSopNode);t.ShadowsSopNode=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(6),i=r.__importDefault(n(102)),a=r.__importDefault(n(992)),s=r.__importDefault(n(92)),_=n(13),u=n(283),c=n(408),p=new(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t}(n(5).NodeParamsConfig)),l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=p,t}return r.__extends(t,e),t.type=function(){return"skin"},t.displayed_input_names=function(){return["lines to create polygons from","if used, lines from both inputs will be used"]},t.prototype.initialize_node=function(){this.io.inputs.set_count(1,2)},t.prototype.cook=function(e){switch(s.default(this.io.inputs.inputs()).length){case 1:return this.process_one_input(e);case 2:return this.process_two_inputs(e);default:return this.states.error.set("inputs count not valid")}},t.prototype.process_one_input=function(e){var t=this,n=e[0],r=this._get_line_segments(n),o=[];if(r){var i=r[0];if(i){var a=u.CoreGeometryUtilCurve.line_segment_to_geometries(i.geometry);a.forEach((function(e,n){if(n>0){var r=a[n-1],i=t._skin(r,e);o.push(i)}}))}}this.set_geometries(o)},t.prototype.process_two_inputs=function(e){var t=this,n=e[0],r=e[1],o=this._get_line_segments(n),s=this._get_line_segments(r),_=a.default(i.default([o,s],(function(e){return e.length}))),u=_[0],c=_[1],p=[];u.forEach((function(e,n){var r=c[n];if(null!=e&&null!=r){var o=e.geometry,i=r.geometry,a=t._skin(o,i);p.push(a)}})),this.set_geometries(p)},t.prototype._get_line_segments=function(e){return e.objects().filter((function(e){return e.isLineSegments}))},t.prototype._skin=function(e,t){var n=new o.BufferGeometry;return new c.CoreGeometryOperationSkin(n,e,t).process(),n},t}(_.TypedSopNode);t.SkinSopNode=l},,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,o=n(2),i=n(161),a=n(210),s=n(13);!function(e){e.DEFAULT="default",e.ISOCAHEDRON="isocahedron"}(r||(r={}));var _={default:0,isocahedron:1},u=[r.DEFAULT,r.ISOCAHEDRON],c=n(5),p=n(17),l=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.type=c.ParamConfig.INTEGER(_.default,{menu:{entries:u.map((function(e){return{name:e,value:_[e]}}))}}),t.radius=c.ParamConfig.FLOAT(1,{visible_if:{type:_.default}}),t.resolution=c.ParamConfig.VECTOR2([8,6],{visible_if:{type:_.default}}),t.open=c.ParamConfig.BOOLEAN(0,{visible_if:{type:_.default}}),t.angle_range_x=c.ParamConfig.VECTOR2([0,"$PI*2"],{visible_if:{type:_.default,open:!0}}),t.angle_range_y=c.ParamConfig.VECTOR2([0,"$PI*2"],{visible_if:{type:_.default,open:!0}}),t.detail=c.ParamConfig.INTEGER(1,{range:[0,5],range_locked:[!0,!1],visible_if:{type:_.isocahedron}}),t.center=c.ParamConfig.VECTOR3([0,0,0]),t}return o.__extends(t,e),t}(c.NodeParamsConfig)),d=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=l,t}return o.__extends(t,e),t.type=function(){return"sphere"},t.prototype.initialize_node=function(){this.io.inputs.set_count(0,1),this.io.inputs.init_inputs_clonable_state([p.InputCloneMode.NEVER])},t.prototype.cook=function(e){var t=e[0];t?this._cook_with_input(t):this._cook_without_input()},t.prototype._cook_without_input=function(){var e=this._create_required_geometry();e.translate(this.pv.center.x,this.pv.center.y,this.pv.center.z),this.set_geometry(e)},t.prototype._cook_with_input=function(e){var t=e.bounding_box(),n=t.max.clone().sub(t.min),r=t.max.clone().add(t.min).multiplyScalar(.5),o=this._create_required_geometry();o.translate(this.pv.center.x,this.pv.center.y,this.pv.center.z),o.translate(r.x,r.y,r.z),o.scale(n.x,n.y,n.z),this.set_geometry(o)},t.prototype._create_required_geometry=function(){return this.pv.type==_.default?this._create_default_sphere():this._create_default_isocahedron()},t.prototype._create_default_sphere=function(){return this.pv.open?new i.SphereBufferGeometry(this.pv.radius,this.pv.resolution.x,this.pv.resolution.y,this.pv.angle_range_x.x,this.pv.angle_range_x.y,this.pv.angle_range_y.x,this.pv.angle_range_y.y):new i.SphereBufferGeometry(this.pv.radius,this.pv.resolution.x,this.pv.resolution.y)},t.prototype._create_default_isocahedron=function(){return new a.IcosahedronBufferGeometry(this.pv.radius,this.pv.detail)},t}(s.TypedSopNode);t.SphereSopNode=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(13),i="geometry to switch to",a=n(5),s=n(17),_=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.input=a.ParamConfig.INTEGER(0,{range:[0,3],range_locked:[!0,!0]}),t}return r.__extends(t,e),t}(a.NodeParamsConfig)),u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=_,t}return r.__extends(t,e),t.type=function(){return"switch"},t.displayed_input_names=function(){return[i,i,i,i]},t.prototype.initialize_node=function(){this.io.inputs.set_count(0,4),this.io.inputs.init_inputs_clonable_state([s.InputCloneMode.NEVER,s.InputCloneMode.NEVER,s.InputCloneMode.NEVER,s.InputCloneMode.NEVER]),this.ui_data.set_width(100),this.cook_controller.disallow_inputs_evaluation()},t.prototype.cook=function(){return r.__awaiter(this,void 0,void 0,(function(){var e,t;return r.__generator(this,(function(n){switch(n.label){case 0:return e=this.pv.input,this.io.inputs.has_input(e)?[4,this.container_controller.request_input_container(e)]:[3,2];case 1:return t=n.sent(),this.set_core_group(t.core_content()),[3,3];case 2:this.states.error.set("no input "+e),n.label=3;case 3:return[2]}}))}))},t}(o.TypedSopNode);t.SwitchSopNode=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,o=n(2),i=o.__importDefault(n(81)),a=n(13),s=n(35),_=n(213),u=n(6),c=n(214),p=n(1015),l=n(4),d=n(277),f=n(1011);!function(e){e.MESH="mesh",e.FLAT="flat",e.LINE="line",e.STROKE="stroke"}(r=t.TEXT_TYPE||(t.TEXT_TYPE={})),t.TEXT_TYPES=[r.MESH,r.FLAT,r.LINE,r.STROKE];var h=n(5),m=new(function(e){function n(){var n=null!==e&&e.apply(this,arguments)||this;return n.font=h.ParamConfig.STRING(""),n.text=h.ParamConfig.STRING("polygonjs",{multiline:!0}),n.type=h.ParamConfig.INTEGER(0,{menu:{entries:t.TEXT_TYPES.map((function(e,t){return{name:e,value:t}}))}}),n.size=h.ParamConfig.FLOAT(1,{range:[0,1],range_locked:[!0,!1]}),n.extrude=h.ParamConfig.FLOAT(.1,{visible_if:{type:t.TEXT_TYPES.indexOf(r.MESH)}}),n.segments=h.ParamConfig.INTEGER(1,{range:[1,20],range_locked:[!0,!1],visible_if:{type:t.TEXT_TYPES.indexOf(r.MESH)}}),n.stroke_width=h.ParamConfig.FLOAT(.02,{visible_if:{type:t.TEXT_TYPES.indexOf(r.STROKE)}}),n}return o.__extends(n,e),n}(h.NodeParamsConfig)),y=function(e){function a(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=m,t._font_loader=new p.FontLoader,t._loaded_fonts={},t}return o.__extends(a,e),a.type=function(){return"text"},a.prototype.initialize_node=function(){},a.prototype.cook=function(){return o.__awaiter(this,void 0,void 0,(function(){var e,n,i,a;return o.__generator(this,(function(o){switch(o.label){case 0:return o.trys.push([0,3,,4]),e=this._loaded_fonts,n=this.pv.font,(i=this._loaded_fonts[this.pv.font])?[3,2]:[4,this._load_url(this.pv.font)];case 1:i=o.sent(),o.label=2;case 2:return e[n]=i,[3,4];case 3:return o.sent(),this.states.error.set("count not load font ("+this.pv.font+")"),[2];case 4:if(a=this._loaded_fonts[this.pv.font])switch(t.TEXT_TYPES[this.pv.type]){case r.MESH:return[2,this._create_geometry_from_type_mesh(a)];case r.FLAT:return[2,this._create_geometry_from_type_flat(a)];case r.LINE:return[2,this._create_geometry_from_type_line(a)];case r.STROKE:return[2,this._create_geometry_from_type_stroke(a)];default:console.warn("type is not valid")}return[2]}}))}))},a.prototype._create_geometry_from_type_mesh=function(e){var t=this.displayed_text(),n={font:e,size:this.pv.size,height:this.pv.extrude,curveSegments:this.pv.segments};try{var r=new _.TextBufferGeometry(t,n);if(!r.index){var o=r.getAttribute("position").array;r.setIndex(i.default(o.length/3))}this.set_geometry(r)}catch(e){this.states.error.set("failed to generate geometry. Try to remove some characters")}},a.prototype._create_geometry_from_type_flat=function(e){var t=this._get_shapes(e);if(t){var n=new c.ShapeBufferGeometry(t);this.set_geometry(n)}},a.prototype._create_geometry_from_type_line=function(e){var t=this.shapes_from_font(e);if(t){for(var n=[],r=[],o=0,i=0;i<t.length;i++)for(var a=t[i].getPoints(),_=0;_<a.length;_++){var c=a[_];n.push(c.x),n.push(c.y),n.push(0),r.push(o),_>0&&_<a.length-1&&r.push(o),o+=1}var p=new u.BufferGeometry;p.setAttribute("position",new l.Float32BufferAttribute(n,3)),p.setIndex(r),this.set_geometry(p,s.CoreConstant.OBJECT_TYPE.LINE_SEGMENTS)}},a.prototype._create_geometry_from_type_stroke=function(e){return o.__awaiter(this,void 0,void 0,(function(){var t,n,r,i,a,s,_,u,c,p;return o.__generator(this,(function(o){switch(o.label){case 0:return(t=this.shapes_from_font(e))?(n=this,(r=this._svg_loader)?[3,2]:[4,this._load_svg_loader()]):[3,3];case 1:r=o.sent(),o.label=2;case 2:for(n._svg_loader=r,i=this._svg_loader.getStrokeStyle(this.pv.stroke_width,"white","miter","butt",4),a=[],s=0;s<t.length;s++)_=t[s],u=_.getPoints(),12,.001,c=this._svg_loader.pointsToStroke(u,i,12,.001),a.push(c);p=d.BufferGeometryUtils.mergeBufferGeometries(a),this.set_geometry(p),o.label=3;case 3:return[2]}}))}))},a.prototype.shapes_from_font=function(e){var t=this._get_shapes(e);if(t){for(var n=[],r=0;r<t.length;r++){var o=t[r];if(o.holes&&o.holes.length>0)for(var i=0;i<o.holes.length;i++){var a=o.holes[i];n.push(a)}}return t.push.apply(t,n),t}},a.prototype._get_shapes=function(e){var t=this.displayed_text();try{return e.generateShapes(t,this.pv.size)}catch(e){this.states.error.set("failed to generate geometry. Try to remove some characters")}},a.prototype.displayed_text=function(){return this.pv.text||""},a.prototype._load_url=function(e){""===e&&(e="/fonts/droid_sans_regular.typeface.json");var t=e.split("?")[0].split("."),n=t[t.length-1];switch(e=e+"?"+Date.now(),n){case"ttf":return this._load_ttf(e);case"json":return this._load_json(e);default:return null}},a.prototype._load_ttf=function(e){var t=this;return new Promise((function(n,r){return o.__awaiter(t,void 0,void 0,(function(){var t,i,a=this;return o.__generator(this,(function(o){switch(o.label){case 0:return t=this,(i=this._ttf_loader)?[3,2]:[4,this._load_ttf_loader()];case 1:i=o.sent(),o.label=2;case 2:return t._ttf_loader=i,window.opentype=f,this._ttf_loader.load(e,(function(e){var t=a._font_loader.parse(e);n(t)}),void 0,(function(){r()})),[2]}}))}))}))},a.prototype._load_json=function(e){var t=this;return new Promise((function(n,r){t._font_loader.load(e,(function(e){n(e)}),void 0,(function(){r()}))}))},a.prototype._load_ttf_loader=function(){return o.__awaiter(this,void 0,void 0,(function(){var e;return o.__generator(this,(function(t){switch(t.label){case 0:return[4,Promise.resolve().then((function(){return o.__importStar(n(997))}))];case 1:return e=t.sent().TTFLoader,[2,new e]}}))}))},a.prototype._load_svg_loader=function(){return o.__awaiter(this,void 0,void 0,(function(){return o.__generator(this,(function(e){switch(e.label){case 0:return[4,Promise.resolve().then((function(){return o.__importStar(n(998))}))];case 1:return[2,e.sent().SVGLoader]}}))}))},a}(a.TypedSopNode);t.TextSopNode=y},,function(e,t,n){"use strict";n.r(t),n.d(t,"TTFLoader",(function(){return i}));var r=n(30),o=n(18),i=function(e){o.a.call(this,e),this.reversed=!1};i.prototype=Object.assign(Object.create(o.a.prototype),{constructor:i,load:function(e,t,n,o){var i=this,a=new r.a(this.manager);a.setPath(this.path),a.setResponseType("arraybuffer"),a.load(e,(function(e){t(i.parse(e))}),n,o)},parse:function(e){function t(e){var t,n=[];e.forEach((function(e){"m"===e.type.toLowerCase()?(t=[e],n.push(t)):"z"!==e.type.toLowerCase()&&t.push(e)}));var r=[];return n.forEach((function(e){var t={type:"m",x:e[e.length-1].x,y:e[e.length-1].y};r.push(t);for(var n=e.length-1;n>0;n--){var o=e[n];t={type:o.type};void 0!==o.x2&&void 0!==o.y2?(t.x1=o.x2,t.y1=o.y2,t.x2=o.x1,t.y2=o.y1):void 0!==o.x1&&void 0!==o.y1&&(t.x1=o.x1,t.y1=o.y1),t.x=e[n-1].x,t.y=e[n-1].y,r.push(t)}})),r}return"undefined"==typeof opentype?(console.warn("THREE.TTFLoader: The loader requires opentype.js. Make sure it's included before using the loader."),null):function(e,n){for(var r=Math.round,o={},i=1e5/(72*(e.unitsPerEm||2048)),a=e.encoding.cmap.glyphIndexMap,s=Object.keys(a),_=0;_<s.length;_++){var u=s[_],c=e.glyphs.glyphs[a[u]];if(void 0!==u){var p={ha:r(c.advanceWidth*i),x_min:r(c.xMin*i),x_max:r(c.xMax*i),o:""};n&&(c.path.commands=t(c.path.commands)),c.path.commands.forEach((function(e){"c"===e.type.toLowerCase()&&(e.type="b"),p.o+=e.type.toLowerCase()+" ",void 0!==e.x&&void 0!==e.y&&(p.o+=r(e.x*i)+" "+r(e.y*i)+" "),void 0!==e.x1&&void 0!==e.y1&&(p.o+=r(e.x1*i)+" "+r(e.y1*i)+" "),void 0!==e.x2&&void 0!==e.y2&&(p.o+=r(e.x2*i)+" "+r(e.y2*i)+" ")})),o[String.fromCodePoint(c.unicode)]=p}}return{glyphs:o,familyName:e.getEnglishName("fullName"),ascender:r(e.ascender*i),descender:r(e.descender*i),underlinePosition:e.tables.post.underlinePosition,underlineThickness:e.tables.post.underlineThickness,boundingBox:{xMin:e.tables.head.xMin,xMax:e.tables.head.xMax,yMin:e.tables.head.yMin,yMax:e.tables.head.yMax},resolution:1e3,original_font_information:e.tables.name}}(opentype.parse(e),this.reversed)}})},,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(212),i=n(13),a=n(5),s=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.radius=a.ParamConfig.FLOAT(1,{range:[0,1]}),t.radius_tube=a.ParamConfig.FLOAT(1,{range:[0,1]}),t.segments_radial=a.ParamConfig.INTEGER(20,{range:[1,50],range_locked:[!0,!1]}),t.segments_tube=a.ParamConfig.INTEGER(12,{range:[1,50],range_locked:[!0,!1]}),t}return r.__extends(t,e),t}(a.NodeParamsConfig)),_=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=s,t}return r.__extends(t,e),t.type=function(){return"torus"},t.prototype.initialize_node=function(){},t.prototype.cook=function(){var e=this.pv.radius,t=this.pv.radius_tube,n=this.pv.segments_radial,r=this.pv.segments_tube,i=new o.TorusBufferGeometry(e,t,n,r);this.set_geometry(i)},t}(i.TypedSopNode);t.TorusSopNode=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o={TorusKnotBufferGeometry:n(211).TorusKnotBufferGeometry},i=n(13),a=n(5),s=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.radius=a.ParamConfig.FLOAT(1),t.radius_tube=a.ParamConfig.FLOAT(1),t.segments_radial=a.ParamConfig.INTEGER(64,{range:[1,128]}),t.segments_tube=a.ParamConfig.INTEGER(8,{range:[1,32]}),t.p=a.ParamConfig.INTEGER(2,{range:[1,10]}),t.q=a.ParamConfig.INTEGER(3,{range:[1,10]}),t}return r.__extends(t,e),t}(a.NodeParamsConfig)),_=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=s,t}return r.__extends(t,e),t.type=function(){return"torus_knot"},t.prototype.initialize_node=function(){},t.prototype.cook=function(){var e=this.pv.radius,t=this.pv.radius_tube,n=this.pv.segments_radial,r=this.pv.segments_tube,i=this.pv.p,a=this.pv.q,s=new o.TorusKnotBufferGeometry(e,t,n,r,i,a);this.set_geometry(s)},t}(i.TypedSopNode);t.TorusKnotSopNode=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(13),i=n(378),a=n(84),s=n(17),_=n(5),u=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.group=_.ParamConfig.STRING(""),t.t=_.ParamConfig.VECTOR3([0,0,0]),t.r=_.ParamConfig.VECTOR3([0,0,0]),t.s=_.ParamConfig.VECTOR3([1,1,1]),t.scale=_.ParamConfig.FLOAT(1),t.look_at=_.ParamConfig.OPERATOR_PATH(""),t.up=_.ParamConfig.VECTOR3([0,1,0]),t.pivot=_.ParamConfig.VECTOR3([0,0,0]),t}return r.__extends(t,e),t}(_.NodeParamsConfig)),c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=u,t._core_transform=new a.CoreTransform,t}return r.__extends(t,e),t.type=function(){return"transform"},t.displayed_input_names=function(){return["geometry to transform"]},t.prototype.initialize_node=function(){this.io.inputs.set_count(1),this.io.inputs.init_inputs_clonable_state([s.InputCloneMode.FROM_NODE])},t.prototype.cook=function(e){var t=e[0].objects(),n=this._core_transform.matrix(this.pv.t,this.pv.r,this.pv.s,this.pv.scale);if(""===this.pv.group)for(var r=0,o=t;r<o.length;r++){var a=o[r],s=void 0;null!=(s=a.geometry)?(s.translate(-this.pv.pivot.x,-this.pv.pivot.y,-this.pv.pivot.z),s.applyMatrix4(n),s.translate(this.pv.pivot.x,this.pv.pivot.y,this.pv.pivot.z)):a.applyMatrix4(n)}else for(var _=0,u=i.CoreGroup.from_objects(t).points_from_group(this.pv.group);_<u.length;_++){var c=u[_],p=c.position().sub(this.pv.pivot);p.applyMatrix4(n),c.set_position(p.add(this.pv.pivot))}this.set_objects(t)},t}(o.TypedSopNode);t.TransformSopNode=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(13),i=n(1),a=n(85),s=n(84),_=new i.Vector3(0,1,0),u=n(5),c=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.radius=u.ParamConfig.FLOAT(1,{range:[0,1]}),t.height=u.ParamConfig.FLOAT(1,{range:[0,1]}),t.segments_radial=u.ParamConfig.INTEGER(12,{range:[3,20],range_locked:[!0,!1]}),t.segments_height=u.ParamConfig.INTEGER(1,{range:[1,20],range_locked:[!0,!1]}),t.cap=u.ParamConfig.BOOLEAN(1),t.center=u.ParamConfig.VECTOR3([0,0,0]),t.direction=u.ParamConfig.VECTOR3([0,0,1]),t}return r.__extends(t,e),t}(u.NodeParamsConfig)),p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=c,t._core_transform=new s.CoreTransform,t}return r.__extends(t,e),t.type=function(){return"tube"},t.prototype.cook=function(){var e=new a.CylinderBufferGeometry(this.pv.radius,this.pv.radius,this.pv.height,this.pv.segments_radial,this.pv.segments_height,!this.pv.cap);this._core_transform.rotate_geometry(e,_,this.pv.direction),e.translate(this.pv.center.x,this.pv.center.y,this.pv.center.z),this.set_geometry(e)},t}(o.TypedSopNode);t.TubeSopNode=p},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(13),i=n(1004),a=n(5),s=n(17),_=n(27),u=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.camera=a.ParamConfig.OPERATOR_PATH("/perspective_camera1",{node_selection:{context:_.NodeContext.OBJ}}),t}return r.__extends(t,e),t}(a.NodeParamsConfig)),c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=u,t._camera_controller=new i.CameraController(t._update_uvs_from_camera.bind(t)),t}return r.__extends(t,e),t.type=function(){return"uv_project"},t.prototype.initialize_node=function(){this.io.inputs.set_count(1),this.io.inputs.init_inputs_clonable_state([s.InputCloneMode.FROM_NODE])},t.prototype.cook=function(e){this._processed_core_group=e[0];var t=this.p.camera.found_node();null!=t?(this._camera_object=t.object,this._camera_controller.set_target(this._camera_object)):(this._camera_object=void 0,this._camera_controller.remove_target()),this.set_core_group(this._processed_core_group)},t.prototype._update_uvs_from_camera=function(e){var t=this;if(this._processed_core_group&&this.parent){var n=this._processed_core_group.points(),r=this.parent.object.matrixWorld;n.forEach((function(e){var n=e.position(),o=t._vector_in_camera_space(n,r);if(o){var i={x:1-(.5*o[0]+.5),y:.5*o[1]+.5};e.set_attrib_value("uv",i)}}))}},t.prototype._vector_in_camera_space=function(e,t){if(this._camera_object)return e.applyMatrix4(t),e.project(this._camera_object).toArray()},t}(o.TypedSopNode);t.UvProjectSopNode=c},function(e,t,n){"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.CHANGE="change",e.MOVEEND="moveend"}(r||(r={}));var o=function(){function e(e){this._callback=e,this._update_always=!0,this._listener_added=!1,this._listener=this._execute_callback.bind(this)}return e.prototype.remove_target=function(){this.set_target(void 0)},e.prototype.set_target=function(e){e||this._remove_camera_event();var t=this._target;this._target=e,null!=this._target&&this._execute_callback(),(null!=this._target?this._target.uuid:void 0)!==(null!=t?t.uuid:void 0)&&this._add_camera_event()},e.prototype.set_update_always=function(e){this._remove_camera_event(),this._update_always=e,this._add_camera_event()},e.prototype._current_event_name=function(){return this._update_always?r.CHANGE:r.MOVEEND},e.prototype._add_camera_event=function(){this._listener_added||null!=this._target&&(this._target.addEventListener(this._current_event_name(),this._listener),this._listener_added=!0)},e.prototype._remove_camera_event=function(){!0===this._listener_added&&null!=this._target&&(this._target.removeEventListener(this._current_event_name(),this._listener),this._listener_added=!1)},e.prototype._execute_callback=function(){null!=this._target&&this._callback(this._target)},e}();t.CameraController=o},function(e){e.exports=JSON.parse('{"properties":{"frame":600,"frame_range":[1,600],"frame_range_locked":[true,true],"fps":60,"master_camera_node_path":"/perspective_camera1"},"root":{"type":"obj","nodes":{"MAT":{"type":"materials","nodes":{"mesh_standard1":{"type":"mesh_standard","params":{"map":"/COP/OUT_diffuse","env_map":"/COP/OUT_env","metalness":0.01},"inputs":[]},"mesh_basic1":{"type":"mesh_basic","params":{},"inputs":[]},"mesh_lambert1":{"type":"mesh_lambert","params":{},"inputs":[]},"mesh_lambert_builder2":{"type":"mesh_lambert_builder","nodes":{"globals1":{"type":"globals","params":{},"inputs":[]},"output1":{"type":"output","params":{},"inputs":[{"name":"color","node":"globals1","output":"position"}]}},"children_context":"gl","params":{},"inputs":[],"selection":[]}},"children_context":"mat","params":{},"inputs":[],"selection":[]},"events1":{"type":"events","nodes":{"camera_orbit_controls1":{"type":"camera_orbit_controls","params":{},"inputs":[]},"camera_orbit_controls2":{"type":"camera_orbit_controls","params":{"allow_pan":false,"allow_zoom":false},"inputs":[]}},"children_context":"event","params":{},"inputs":[],"selection":[]},"perspective_camera1":{"type":"perspective_camera","params":{"controls":"/events1/camera_orbit_controls1","target":[-0.18931128979003603,0.42336979919346196,0.07064319279199466],"fov":55.29,"t":[1.0055595496895167,1.7681091581794246,4.652567805802128],"r":[-16.356324737681106,14.048388261536084,4.074959369006643]},"inputs":[],"flags":{"display":true}},"COP":{"type":"cop","nodes":{"file2":{"type":"file","params":{"url":"/examples/textures/piz_compressed.exr"},"inputs":[],"flags":{}},"file_uv":{"type":"file","params":{},"inputs":[],"flags":{}},"env_map":{"type":"env_map","params":{},"inputs":["switch2"],"flags":{}},"file_uv1":{"type":"file","params":{"url":"/examples/textures/hardwood2_diffuse.jpg"},"inputs":[],"flags":{}},"file3":{"type":"file","params":{"url":"/examples/textures/equirectangular.png"},"inputs":[],"flags":{}},"OUT_diffuse":{"type":"null","params":{},"inputs":["switch1"],"flags":{}},"OUT_env":{"type":"null","params":{},"inputs":["env_map"],"flags":{}},"file4":{"type":"file","params":{"url":"/examples/textures/equirectangular/quarry_01_1k.hdr"},"inputs":[],"flags":{}},"switch1":{"type":"switch","params":{"input":"$F%2"},"inputs":["file_uv","file_uv1"],"flags":{}},"switch2":{"type":"switch","params":{"input":"($F-1)%2"},"inputs":["file2","file4"],"flags":{}}},"children_context":"cop","params":{},"inputs":[],"selection":[]},"null1":{"type":"null","params":{"t":[0,1.1,0],"r":[0,"-$F*5",0]},"inputs":[],"flags":{"display":true}},"geo1":{"type":"geo","nodes":{"box1":{"type":"box","params":{},"inputs":[],"flags":{"display":false}},"plane1":{"type":"plane","params":{"step_size":"0.02"},"inputs":[],"flags":{"display":false}},"sphere1":{"type":"sphere","params":{"resolution":["30","30"]},"inputs":[],"flags":{"display":false}},"merge1":{"type":"merge","params":{},"inputs":["transform1","transform2","transform3"],"flags":{"display":false}},"transform1":{"type":"transform","params":{"scale":7.8},"inputs":["plane1"],"flags":{"display":false}},"transform2":{"type":"transform","params":{},"inputs":["sphere1"],"flags":{"display":false}},"transform3":{"type":"transform","params":{"t":[2.1,0,0]},"inputs":["box1"],"flags":{"display":false}},"material1":{"type":"material","params":{"material":"/MAT/mesh_lambert1"},"inputs":["merge1"],"flags":{"display":false}},"material2":{"type":"material","params":{},"inputs":["sphere1"],"flags":{"display":false}},"transform4":{"type":"transform","params":{"t":[0,0.5,0]},"inputs":["material2"],"flags":{"display":false}},"switch1":{"type":"switch","params":{"input":"round($F*0.5)%2"},"inputs":["material2","transform4"],"flags":{"display":false}},"material3":{"type":"material","params":{"material":"/MAT/mesh_basic_builder1"},"inputs":["noise1"],"flags":{"display":true}},"noise1":{"type":"noise","params":{"amount":0.13,"use_normals":true},"inputs":["attrib_create1"],"flags":{"display":false}},"attrib_create1":{"type":"attrib_create","params":{"name":"above","value1":"@P.y > 0"},"inputs":["sphere1"],"flags":{"display":false}}},"children_context":"sop","params":{"t":[0,-0.9000000000000001,0]},"inputs":[],"flags":{"display":true},"selection":[]},"point_light1":{"type":"point_light","params":{"t":[2.2,0,0],"color":[1,0,0]},"inputs":["null1"],"flags":{"display":false}},"hemisphere_light1":{"type":"hemisphere_light","params":{"sky_color":[0.2,0.6980392156862745,1],"ground_color":[0.09803921568627451,0.09803921568627451,0.24705882352941178],"position":[0.1,1,-0.2]},"inputs":[],"flags":{"display":false}},"null2":{"type":"null","params":{},"inputs":["point_light1"],"flags":{"display":true}},"null3":{"type":"null","params":{"t":[0,1.2000000000000002,1.3]},"inputs":[],"flags":{"display":true}},"spot_light1":{"type":"spot_light","params":{"t":[1.2000000000000002,2,0],"r":[-15,0,0],"angle":46.87},"inputs":["null4"],"flags":{"display":false}},"null4":{"type":"null","params":{"t":[0,0,2.6]},"inputs":["null1"],"flags":{"display":true}},"directional_light1":{"type":"directional_light","params":{"t":[0.40000000000000013,2.3,1.5999999999999999],"r":[-31,0,0],"color":["1+0.5*sin($F*0.1)","1+0.5*cos($F*0.2)",1]},"inputs":["null4"],"flags":{"display":true}},"ambient_light1":{"type":"ambient_light","params":{},"inputs":[],"flags":{"display":true}},"orthographic_camera1":{"type":"orthographic_camera","params":{"background_color":[1,1,1]},"inputs":[],"flags":{"display":true}},"perspective_camera2":{"type":"perspective_camera","params":{"background_color":[1,1,1]},"inputs":["null4"],"flags":{"display":true}},"geo2":{"type":"geo","nodes":{"hexagons1":{"type":"hexagons","params":{"size":[5,5],"hexagon_radius":0.81},"inputs":[],"flags":{"display":false}},"box1":{"type":"box","params":{"size":0.22},"inputs":[],"flags":{"display":false}},"copy1":{"type":"copy","params":{},"inputs":["box1","hexagons1"],"flags":{"display":true}},"material1":{"type":"material","params":{"material":"/MAT/mesh_lambert1"},"inputs":["copy1"],"flags":{"display":false}},"material2":{"type":"material","params":{"material":"/MAT/mesh_lambert_builder2"},"inputs":["copy1"],"flags":{"display":false}},"material3":{"type":"material","params":{"material":"/MAT/mesh_basic_builder1"},"inputs":["copy1"],"flags":{"display":false}}},"children_context":"sop","params":{},"inputs":[],"flags":{"display":true},"selection":[]}},"children_context":"objects","selection":[]},"ui":{"nodes":{"MAT":{"pos":[-250,100],"nodes":{"mesh_standard1":{"pos":[0,200]},"mesh_basic1":{"pos":[0,-50]},"mesh_lambert1":{"pos":[300,-50]},"mesh_lambert_builder2":{"pos":[300,50],"nodes":{"globals1":{"pos":[-200,0]},"output1":{"pos":[200,0]}}}}},"events1":{"pos":[-250,0],"nodes":{"camera_orbit_controls1":{"pos":[-50,150]},"camera_orbit_controls2":{"pos":[-50,300]}}},"perspective_camera1":{"pos":[-250,-150]},"COP":{"pos":[-250,200],"nodes":{"file2":{"pos":[50,50]},"file_uv":{"pos":[-300,50]},"env_map":{"pos":[150,300]},"file_uv1":{"pos":[-150,50]},"file3":{"pos":[200,50]},"OUT_diffuse":{"pos":[-250,350]},"OUT_env":{"pos":[150,400]},"file4":{"pos":[350,50]},"switch1":{"pos":[-250,200]},"switch2":{"pos":[150,200]}}},"null1":{"pos":[250,-450]},"geo1":{"pos":[0,-600],"nodes":{"box1":{"pos":[-500,50]},"plane1":{"pos":[-900,-50]},"sphere1":{"pos":[50,-200]},"merge1":{"pos":[-800,250]},"transform1":{"pos":[-900,100]},"transform2":{"pos":[-700,50]},"transform3":{"pos":[-500,150]},"material1":{"pos":[-850,450]},"material2":{"pos":[0,300]},"transform4":{"pos":[200,350]},"switch1":{"pos":[0,500]},"material3":{"pos":[450,200]},"noise1":{"pos":[450,50]},"attrib_create1":{"pos":[450,-50]}}},"point_light1":{"pos":[400,-300]},"hemisphere_light1":{"pos":[450,0]},"null2":{"pos":[350,-150]},"null3":{"pos":[450,-550]},"spot_light1":{"pos":[150,-50]},"null4":{"pos":[50,-300]},"directional_light1":{"pos":[-50,-150]},"ambient_light1":{"pos":[300,50]},"orthographic_camera1":{"pos":[-250,-250]},"perspective_camera2":{"pos":[-450,-50]},"geo2":{"pos":[0,-500],"nodes":{"hexagons1":{"pos":[-100,-150]},"box1":{"pos":[-350,-150]},"copy1":{"pos":[-350,100]},"material1":{"pos":[-550,250]},"material2":{"pos":[-300,300]},"material3":{"pos":[-500,400]}}}}}}')},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(296),i=n(409),a=function(){function e(e){this._data=e}return e.load_data=function(t){return new e(t).scene()},e.prototype.scene=function(){return r.__awaiter(this,void 0,void 0,(function(){var e,t,n,a,s;return r.__generator(this,(function(r){switch(r.label){case 0:return(e=new o.PolyScene).loading_controller.mark_as_loading(),(t=this._data.properties)&&(e.set_frame(t.frame||1),n=t.frame_range||[],e.time_controller.set_frame_range(n[0]||1,n[1]||100),(a=t.frame_range_locked)&&e.time_controller.set_frame_range_locked(a[0],a[1]),t.master_camera_node_path&&e.cameras_controller.set_master_camera_node_path(t.master_camera_node_path)),e.cooker.block(),s=i.JsonImportDispatcher.dispatch_node(e.root),this._data.root&&s.process_data(this._data.root),this._data.ui&&s.process_ui_data(this._data.ui),[4,e.loading_controller.mark_as_loaded()];case 1:return r.sent(),e.cooker.unblock(),[2,e]}}))}))},e}();t.SceneJsonImporter=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=r.__importDefault(n(45)),i=r.__importDefault(n(262)),a=r.__importDefault(n(60)),s=r.__importDefault(n(44)),_=r.__importDefault(n(21)),u=n(3),c=n(409),p=function(){function e(e){this._node=e}return e.prototype.process_data=function(e){if(this.create_nodes(e.nodes),this.set_selection(e.selection),this._node.io.inputs.override_clonable_state_allowed()){var t=e.override_clonable_state;t&&this._node.io.inputs.set_override_clonable_state(t)}this.set_flags(e),this.set_params(e.params),this.from_data_custom(e),this._node.lifecycle.set_creation_completed()},e.prototype.process_inputs_data=function(e){this.set_inputs(e.inputs)},e.prototype.process_ui_data=function(e){if(e){var t=this._node.ui_data,n=e.pos;if(n){var r=(new u.Vector2).fromArray(n);t.set_position(r)}var o=e.comment;o&&t.set_comment(o),this.process_nodes_ui_data(e.nodes)}},e.prototype.create_nodes=function(e){if(e){for(var t=[],n=0,r=Object.keys(e);n<r.length;n++){var o=r[n],i=e[o].type;if(this._node.children_allowed()&&this._node.children_controller)(p=this._node.create_node(i))&&(p.set_name(o),t.push(p))}for(var a=[],s=0,_=0,u=t;_<u.length;_++){var p=u[_],l=c.JsonImportDispatcher.dispatch_node(p);a.push(l),l.process_data(e[p.name]),s++}s=0;for(var d=0,f=t;d<f.length;d++){p=f[d];(l=a[s]).process_inputs_data(e[p.name]),s++}}},e.prototype.set_selection=function(e){var t=this;if(this._node.children_allowed()&&this._node.children_controller&&e&&e.length>0){var n=[];e.forEach((function(e){var r=t._node.node(e);r&&n.push(r)})),this._node.children_controller.selection.set(n)}},e.prototype.set_flags=function(e){var t,n,r,o,i=e.flags;if(i){var a=i.bypass;null!=a&&(null===(n=null===(t=this._node.flags)||void 0===t?void 0:t.bypass)||void 0===n||n.set(a));var s=i.display;null!=s&&(null===(o=null===(r=this._node.flags)||void 0===r?void 0:r.display)||void 0===o||o.set(s))}},e.prototype.set_inputs=function(e){var t=this;e&&e.forEach((function(e,n){if(e&&t._node.parent)if(o.default(e)){var r=e,i=t._node.parent.node(r);t._node.set_input(n,i)}else{i=t._node.parent.node(e.node);var a=e.name;t._node.io.inputs.has_named_input(a)?t._node.set_input(e.name,i,e.output):console.warn(t._node.full_path()+" has no input named "+a)}}))},e.prototype.process_nodes_ui_data=function(e){var t=this;e&&Object.keys(e).forEach((function(n){var r=t._node.node(n);if(r){var o=e[n];c.JsonImportDispatcher.dispatch_node(r).process_ui_data(o)}}))},e.prototype.set_params=function(e){if(e){for(var t={},n=0,r=Object.keys(e);n<r.length;n++){var o=r[n],i=(f=e[o]).options,a=f.type,s=!1,_=void 0;this._node.params.has_param(o)&&((_=this._node.params.get(o))&&_.type==a||null==a)&&(s=!0),s?this._is_param_data_complex(f)?this._process_param_data_complex(o,f):this._process_param_data_simple(o,f):(t.names_to_delete=t.names_to_delete||[],t.names_to_delete.push(o),t.to_add=t.to_add||[],t.to_add.push({name:o,type:a,init_value:f.default_value,options:i}))}var u=t.names_to_delete&&t.names_to_delete.length>0,c=t.to_add&&t.to_add.length>0;if(u||c){this._node.params.update_params(t);for(var p=0,l=this._node.params.spare;p<l.length;p++){var d=l[p],f=e[d.name];!d.parent_param&&f&&(this._is_param_data_complex(f)?this._process_param_data_complex(d.name,f):this._process_param_data_simple(d.name,f))}}this._node.params.run_on_scene_load_hooks()}},e.prototype._process_param_data_simple=function(e,t){var n;null===(n=this._node.params.get(e))||void 0===n||n.set(t)},e.prototype._process_param_data_complex=function(e,t){var n=this._node.params.get(e);n&&c.JsonImportDispatcher.dispatch_param(n).process_data(t)},e.prototype._is_param_data_complex=function(e){return!(o.default(e)||s.default(e)||_.default(e)||i.default(e))&&!(!a.default(e)||!Object.keys(e).includes("type"))},e.prototype.from_data_custom=function(e){},e}();t.NodeJsonImporter=p},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.add_main=function(e){},t}(n(218).ParamJsonImporter);t.ParamMultipleJsonImporter=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(218),i=/\\n+/g,a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.add_main=function(e){var t=e.raw_input;void 0!==t&&(t=t.replace(i,"\n"),this._param.set(t))},t}(o.ParamJsonImporter);t.ParamStringJsonImporter=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.add_main=function(e){var t=e.raw_input;t&&this._param.set(t)},t}(n(218).ParamJsonImporter);t.ParamRampJsonImporter=o},,,function(e,t,n){"use strict";n.r(t),n.d(t,"EffectComposer",(function(){return y})),n.d(t,"Pass",(function(){return x}));var r=n(412),o=n(0),i=n(22),a=n(63),s=n(54),_=n(3),u=n(75),c={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float opacity;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","\tvec4 texel = texture2D( tDiffuse, vUv );","\tgl_FragColor = opacity * texel;","}"].join("\n")},p=n(26),l=n(23),d=n(72),f=function(e,t){d.a.call(this),this.textureID=void 0!==t?t:"tDiffuse",e instanceof p.ShaderMaterial?(this.uniforms=e.uniforms,this.material=e):e&&(this.uniforms=l.UniformsUtils.clone(e.uniforms),this.material=new p.ShaderMaterial({defines:Object.assign({},e.defines),uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),this.fsQuad=new d.a.FullScreenQuad(this.material)};f.prototype=Object.assign(Object.create(d.a.prototype),{constructor:f,render:function(e,t,n){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=n.texture),this.fsQuad.material=this.material,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),this.fsQuad.render(e))}});var h=function(e,t){d.a.call(this),this.scene=e,this.camera=t,this.clear=!0,this.needsSwap=!1,this.inverse=!1};h.prototype=Object.assign(Object.create(d.a.prototype),{constructor:h,render:function(e,t,n){var r,o,i=e.getContext(),a=e.state;a.buffers.color.setMask(!1),a.buffers.depth.setMask(!1),a.buffers.color.setLocked(!0),a.buffers.depth.setLocked(!0),this.inverse?(r=0,o=1):(r=1,o=0),a.buffers.stencil.setTest(!0),a.buffers.stencil.setOp(i.REPLACE,i.REPLACE,i.REPLACE),a.buffers.stencil.setFunc(i.ALWAYS,r,4294967295),a.buffers.stencil.setClear(o),a.buffers.stencil.setLocked(!0),e.setRenderTarget(n),this.clear&&e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(t),this.clear&&e.clear(),e.render(this.scene,this.camera),a.buffers.color.setLocked(!1),a.buffers.depth.setLocked(!1),a.buffers.stencil.setLocked(!1),a.buffers.stencil.setFunc(i.EQUAL,1,4294967295),a.buffers.stencil.setOp(i.KEEP,i.KEEP,i.KEEP),a.buffers.stencil.setLocked(!0)}});var m=function(){d.a.call(this),this.needsSwap=!1};m.prototype=Object.create(d.a.prototype),Object.assign(m.prototype,{render:function(e){e.state.buffers.stencil.setLocked(!1),e.state.buffers.stencil.setTest(!1)}});var y=function(e,t){if(this.renderer=e,void 0===t){var n={minFilter:o.LinearFilter,magFilter:o.LinearFilter,format:o.RGBAFormat,stencilBuffer:!1},i=e.getSize(new _.Vector2);this._pixelRatio=e.getPixelRatio(),this._width=i.width,this._height=i.height,(t=new u.WebGLRenderTarget(this._width*this._pixelRatio,this._height*this._pixelRatio,n)).texture.name="EffectComposer.rt1"}else this._pixelRatio=1,this._width=t.width,this._height=t.height;this.renderTarget1=t,this.renderTarget2=t.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],void 0===c&&console.error("THREE.EffectComposer relies on CopyShader"),void 0===f&&console.error("THREE.EffectComposer relies on ShaderPass"),this.copyPass=new f(c),this.clock=new r.a};Object.assign(y.prototype,{swapBuffers:function(){var e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e},addPass:function(e){this.passes.push(e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)},insertPass:function(e,t){this.passes.splice(t,0,e)},isLastEnabledPass:function(e){for(var t=e+1;t<this.passes.length;t++)if(this.passes[t].enabled)return!1;return!0},render:function(e){void 0===e&&(e=this.clock.getDelta());var t,n,r=this.renderer.getRenderTarget(),o=!1,i=this.passes.length;for(n=0;n<i;n++)if(!1!==(t=this.passes[n]).enabled){if(t.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(n),t.render(this.renderer,this.writeBuffer,this.readBuffer,e,o),t.needsSwap){if(o){var a=this.renderer.getContext(),s=this.renderer.state.buffers.stencil;s.setFunc(a.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,e),s.setFunc(a.EQUAL,1,4294967295)}this.swapBuffers()}void 0!==h&&(t instanceof h?o=!0:t instanceof m&&(o=!1))}this.renderer.setRenderTarget(r)},reset:function(e){if(void 0===e){var t=this.renderer.getSize(new _.Vector2);this._pixelRatio=this.renderer.getPixelRatio(),this._width=t.width,this._height=t.height,(e=this.renderTarget1.clone()).setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2},setSize:function(e,t){this._width=e,this._height=t;var n=this._width*this._pixelRatio,r=this._height*this._pixelRatio;this.renderTarget1.setSize(n,r),this.renderTarget2.setSize(n,r);for(var o=0;o<this.passes.length;o++)this.passes[o].setSize(n,r)},setPixelRatio:function(e){this._pixelRatio=e,this.setSize(this._width,this._height)}});var v,g,b,x=function(){this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1};Object.assign(x.prototype,{setSize:function(){},render:function(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}}),x.FullScreenQuad=(v=new a.OrthographicCamera(-1,1,1,-1,0,1),g=new s.PlaneBufferGeometry(2,2),b=function(e){this._mesh=new i.Mesh(g,e)},Object.defineProperty(b.prototype,"material",{get:function(){return this._mesh.material},set:function(e){this._mesh.material=e}}),Object.assign(b.prototype,{dispose:function(){this._mesh.geometry.dispose()},render:function(e){e.render(this._mesh,v)}}),b)}]);
//# sourceMappingURL=polygonjs-engine.js.map