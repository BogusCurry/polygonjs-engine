!function(e){function t(t){for(var r,a,s=t[0],_=t[1],u=t[2],p=0,l=[];p<s.length;p++)a=s[p],Object.prototype.hasOwnProperty.call(o,a)&&o[a]&&l.push(o[a][0]),o[a]=0;for(r in _)Object.prototype.hasOwnProperty.call(_,r)&&(e[r]=_[r]);for(c&&c(t);l.length;)l.shift()();return i.push.apply(i,u||[]),n()}function n(){for(var e,t=0;t<i.length;t++){for(var n=i[t],r=!0,s=1;s<n.length;s++){var _=n[s];0!==o[_]&&(r=!1)}r&&(i.splice(t--,1),e=a(a.s=n[0]))}return e}var r={},o={5:0},i=[];function a(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,a),n.l=!0,n.exports}a.m=e,a.c=r,a.d=function(e,t,n){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)a.d(n,r,function(t){return e[t]}.bind(null,r));return n},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="";var s=window.webpackJsonp=window.webpackJsonp||[],_=s.push.bind(s);s.push=t,s=s.slice();for(var u=0;u<s.length;u++)t(s[u]);var c=_;i.push([378,7,0,4,6,3,1,2,8]),n()}([,,,,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(21),o=n(111),i=function(e,t,n){this.type=e,this.init_value=t,this.options=n};t.ParamTemplate=i;var a=function(){function e(){}return e.BUTTON=function(e,t){return new i(r.ParamType.BUTTON,e,t)},e.BOOLEAN=function(e,t){return new i(r.ParamType.BOOLEAN,e,t)},e.COLOR=function(e,t){return new i(r.ParamType.COLOR,e,t)},e.FLOAT=function(e,t){return new i(r.ParamType.FLOAT,e,t)},e.INTEGER=function(e,t){return new i(r.ParamType.INTEGER,e,t)},e.OPERATOR_PATH=function(e,t){return new i(r.ParamType.OPERATOR_PATH,e,t)},e.RAMP=function(e,t){return void 0===e&&(e=o.RampParam.DEFAULT_VALUE),new i(r.ParamType.RAMP,e,t)},e.SEPARATOR=function(e,t){return void 0===e&&(e=null),new i(r.ParamType.SEPARATOR,e,t)},e.STRING=function(e,t){return void 0===e&&(e=""),new i(r.ParamType.STRING,e,t)},e.VECTOR2=function(e,t){return new i(r.ParamType.VECTOR2,e,t)},e.VECTOR3=function(e,t){return new i(r.ParamType.VECTOR3,e,t)},e.VECTOR4=function(e,t){return new i(r.ParamType.VECTOR4,e,t)},e}();t.ParamConfig=a;var s=function(){};t.NodeParamsConfig=s},,,,,,,,,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.ALWAYS="always",e.NEVER="never",e.FROM_NODE="from_node"}(t.InputCloneMode||(t.InputCloneMode={}))},,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.BOOLEAN="boolean",e.BUTTON="button",e.COLOR="color",e.FLOAT="float",e.INTEGER="integer",e.OPERATOR_PATH="operator_path",e.RAMP="ramp",e.SEPARATOR="separator",e.STRING="string",e.VECTOR2="vector2",e.VECTOR3="vector3",e.VECTOR4="vector4"}(t.ParamType||(t.ParamType={}))},,,,,,function(e,t,n){"use strict";var r,o,i;Object.defineProperty(t,"__esModule",{value:!0});var a,s=n(141),_=n(78),u=n(79),c=n(10),p=n(0),l=n(23),d=n(69),h=n(40),f=n(0),m=n(6),y=n(251),v=n(63),g=n(71),b=n(139),P=n(42);!function(e){e.MESH="MESH",e.POINTS="POINTS",e.LINE_SEGMENTS="LINE_SEGMENTS"}(a=t.ObjectType||(t.ObjectType={})),t.ObjectTypes=[a.MESH,a.POINTS,a.LINE_SEGMENTS],t.ObjectTypeMenuEntries=[{name:"Mesh",value:t.ObjectTypes.indexOf(a.MESH)},{name:"Points",value:t.ObjectTypes.indexOf(a.POINTS)},{name:"LineSegments",value:t.ObjectTypes.indexOf(a.LINE_SEGMENTS)}];var O,C,E=((r={MeshStandard:new g.MeshStandardMaterial({color:16777215,side:f.FrontSide,metalness:.5,roughness:.9})})[a.MESH]=new b.MeshLambertMaterial({color:new m.Color(.5,.5,1),side:f.FrontSide,vertexColors:p.NoColors,transparent:!0,depthTest:!0}),r[a.POINTS]=new v.PointsMaterial({color:16777215,size:.1,depthTest:!0}),r[a.LINE_SEGMENTS]=new P.LineBasicMaterial({color:16777215,linewidth:1}),r);!function(e){e[e.VERTEX=0]="VERTEX",e[e.OBJECT=1]="OBJECT"}(O=t.AttribClass||(t.AttribClass={})),t.AttribClassMenuEntries=[{name:"vertex",value:O.VERTEX},{name:"object",value:O.OBJECT}],function(e){e[e.NUMERIC=0]="NUMERIC",e[e.STRING=1]="STRING"}(C=t.AttribType||(t.AttribType={})),t.AttribTypeMenuEntries=[{name:"numeric",value:C.NUMERIC},{name:"string",value:C.STRING}],t.CoreConstant={ATTRIB_CLASS:{VERTEX:O.VERTEX,OBJECT:O.OBJECT},ATTRIB_TYPE:{NUMERIC:0,STRING:1},OBJECT_TYPE:{MESH:a.MESH,POINTS:a.POINTS,LINE_SEGMENTS:a.LINE_SEGMENTS},OBJECT_TYPES:t.ObjectTypes,CONSTRUCTOR_NAMES_BY_CONSTRUCTOR_NAME:(o={},o[_.Scene.name]="Scene",o[h.Group.name]="Group",o[c.Object3D.name]="Object3D",o[l.Mesh.name]="Mesh",o[u.Points.name]="Points",o[d.LineSegments.name]="LineSegments",o[y.Bone.name]="Bone",o[s.SkinnedMesh.name]="SkinnedMesh",o),CONSTRUCTORS_BY_NAME:(i={},i[a.MESH]=l.Mesh,i[a.POINTS]=u.Points,i[a.LINE_SEGMENTS]=d.LineSegments,i),MATERIALS:E}},,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.MANAGER="managers",e.OBJ="objects",e.SOP="sop",e.MAT="mat",e.COP="cop",e.POST="post",e.GL="gl",e.EVENT="event"}(t.NodeContext||(t.NodeContext={}))},,,,,,,,,,,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=r.__importDefault(n(87)),i=r.__importDefault(n(88)),a=r.__importDefault(n(163)),s=r.__importDefault(n(85)),_=r.__importDefault(n(77)),u=r.__importDefault(n(518)),c=r.__importDefault(n(301)),p=r.__importDefault(n(522)),l=r.__importDefault(n(302)),d=r.__importDefault(n(530)),h=/[, ]/,f=/\d+$/,m=/,| /,y=/^\d+\.?\d*$/,v=function(){function e(){}return e.is_number=function(e){return y.test(e)},e.tail_digits=function(e){var t=e.match(f);return t?parseInt(t[0]):0},e.increment=function(e){var t;if(t=e.match(f)){var n=parseInt(t[0]);return""+e.substring(0,e.length-t[0].length)+(n+1)}return e+"1"},e.pluralize=function(e){return"s"!==e[e.length-1]?e+"s":e},e.camel_case=function(e){return d.default(e)},e.upper_first=function(e){return l.default(e)},e.snake_case=function(e){return p.default(e)},e.titleize=function(e){return c.default(e.replace(/_/g," "))},e.type_to_class_name=function(e){return this.upper_first(d.default(e))},e.timestamp_to_seconds=function(e){return Date.parse(e)/1e3},e.seconds_to_timestamp=function(e){var t=new Date;return t.setTime(1e3*e),t.toISOString().substr(11,8)},e.precision=function(e,t){void 0===t&&(t=2),t=Math.max(t,0);var n=(""+e).split(".");if(t<=0)return n[0];var r=n[1];if(void 0!==r)return r.length>t&&(r=r.substring(0,t)),r=u.default(r,t,"0"),n[0]+"."+r;var o=e+".",i=o.length+t;return u.default(o,i,"0")},e.ensure_float=function(e){var t=""+e;return t.indexOf(".")>=0?t:t+".0"},e.match_mask=function(e,t){return"*"===t||(t="^"+(t=t.split("*").join(".*"))+"$",new RegExp(t).test(e))},e.matches_one_mask=function(t,n){for(var r=!1,o=0,i=n;o<i.length;o++){var a=i[o];e.match_mask(t,a)&&(r=!0)}return r},e.attrib_names=function(e){var t=e.split(h),n=s.default(t.map((function(e){return a.default(e)})));return i.default(n)},e.to_id=function(e){if(null==e)return 0;var t=e.split("").reverse(),n=0,r=0;return t.forEach((function(e,t){var o=e.charCodeAt(0);o>=0&&(r=t%10,n+=o*Math.pow(10,r),n%=Number.MAX_SAFE_INTEGER)})),n},e.indices=function(e){var t=this,n=e.split(m);if(n.length>1)return i.default(_.default(n.map((function(e){return t.indices(e)})))).sort((function(e,t){return e-t}));var r=n[0];if(r){if(r.indexOf("-")>0){var a=r.split("-");return o.default(parseInt(a[0]),parseInt(a[1])+1)}return[parseInt(r)]}return[]},e.escape_line_breaks=function(e){return e.replace(/(\r\n|\n|\r)/gm,"\\n")},e}();t.CoreString=v},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(1),i=n(4),a=n(4),s=n(5),_=n(80),u=r.__importDefault(n(87)),c=r.__importDefault(n(88)),p=r.__importDefault(n(154)),l=r.__importDefault(n(334)),d=r.__importDefault(n(226)),h=r.__importDefault(n(203)),f=r.__importDefault(n(20)),m=r.__importDefault(n(39)),y=n(335),v=n(678),g=n(27),b=n(98),P=n(679),O=n(239),C=function(){function e(e){this._geometry=e}return e.prototype.geometry=function(){return this._geometry},e.prototype.uuid=function(){return this._geometry.uuid},e.prototype.bounding_box=function(){return this._bounding_box=this._bounding_box||this._create_bounding_box()},e.prototype._create_bounding_box=function(){return this._geometry.computeBoundingBox(),this._geometry.boundingBox},e.prototype.mark_as_instance=function(){this._geometry.userData.is_instance=!0},e.marked_as_instance=function(e){return!0===e.userData.is_instance},e.prototype.marked_as_instance=function(){return e.marked_as_instance(this._geometry)},e.prototype.position_attrib_name=function(){var e="position";return this.marked_as_instance()&&(e="instancePosition"),e},e.prototype.compute_vertex_normals=function(){this._geometry.computeVertexNormals()},e.prototype.user_data_attribs=function(){var e="indexed_attrib_values";return this._geometry.userData[e]=this._geometry.userData[e]||{}},e.prototype.indexed_attribute_names=function(){return Object.keys(this.user_data_attribs()||{})},e.prototype.user_data_attrib=function(e){return e=b.CoreAttribute.remap_name(e),this.user_data_attribs()[e]},e.prototype.is_attrib_indexed=function(e){return e=b.CoreAttribute.remap_name(e),null!=this.user_data_attrib(e)},e.prototype.has_attrib=function(e){return"ptnum"===e||(e=b.CoreAttribute.remap_name(e),null!=this._geometry.attributes[e])},e.prototype.attrib_type=function(e){return this.is_attrib_indexed(e)?g.CoreConstant.ATTRIB_TYPE.STRING:g.CoreConstant.ATTRIB_TYPE.NUMERIC},e.prototype.attrib_names=function(){return Object.keys(this._geometry.attributes)},e.prototype.attrib_sizes=function(){for(var e={},t=0,n=this.attrib_names();t<n.length;t++){var r=n[t];e[r]=this._geometry.attributes[r].itemSize}return e},e.prototype.attrib_size=function(e){var t;return e=b.CoreAttribute.remap_name(e),null!=(t=this._geometry.attributes[e])?t.itemSize:"ptnum"===e?1:0},e.prototype.set_indexed_attribute_values=function(e,t){this.user_data_attribs()[e]=t},e.prototype.set_indexed_attribute=function(e,t,n){this.set_indexed_attribute_values(e,t),this._geometry.setAttribute(e,new i.Int32BufferAttribute(n,1))},e.prototype.add_numeric_attrib=function(e,t,n){void 0===t&&(t=1),void 0===n&&(n=0);var r=[],o=!1;if(m.default(n)){for(var i=0;i<this.points_count();i++)for(var s=0;s<t;s++)r.push(n);o=!0}else if(t>1)if(f.default(n)){for(i=0;i<this.points_count();i++)for(s=0;s<t;s++)r.push(n[s]);o=!0}else{var _=n;if(2==t&&null!=_.x&&null!=_.y){for(i=0;i<this.points_count();i++)r.push(_.x),r.push(_.y);o=!0}var u=n;if(3==t&&null!=u.x&&null!=u.y&&null!=u.z){for(i=0;i<this.points_count();i++)r.push(u.x),r.push(u.y),r.push(u.z);o=!0}var c=n;if(3==t&&null!=c.r&&null!=c.g&&null!=c.b){for(i=0;i<this.points_count();i++)r.push(c.r),r.push(c.g),r.push(c.b);o=!0}var p=n;if(4==t&&null!=p.x&&null!=p.y&&null!=p.z&&null!=p.w){for(i=0;i<this.points_count();i++)r.push(p.x),r.push(p.y),r.push(p.z),r.push(p.w);o=!0}}if(!o)throw"no other default value allowed for now in add_numeric_attrib";this._geometry.setAttribute(e,new a.Float32BufferAttribute(r,t))},e.prototype.init_position_attribute=function(e,t){var n=[];null==t&&(t=new o.Vector3);for(var r=0;r<e;r++)n.push(t.x),n.push(t.y),n.push(t.z);return this._geometry.setAttribute("position",new a.Float32BufferAttribute(n,3))},e.prototype.add_attribute=function(e,t){switch(t.type()){case g.CoreConstant.ATTRIB_TYPE.STRING:return console.log("TODO: to implement");case g.CoreConstant.ATTRIB_TYPE.NUMERIC:return this.add_numeric_attrib(e,t.size())}},e.prototype.rename_attribute=function(e,t){this.is_attrib_indexed(e)&&(this.user_data_attribs()[t]=h.default(this.user_data_attribs()[e]),delete this.user_data_attribs()[e]);var n=this._geometry.getAttribute(e);return this._geometry.setAttribute(t,new a.Float32BufferAttribute(n.array,n.itemSize)),this._geometry.deleteAttribute(e)},e.prototype.delete_attribute=function(e){return this.is_attrib_indexed(e)&&delete this.user_data_attribs()[e],this._geometry.deleteAttribute(e)},e.prototype.clone=function(){return e.clone(this._geometry)},e.clone=function(e){for(var t,n=0,r=Object.keys(e.attributes);n<r.length;n++){var o=r[n],i=e.getAttribute(o);i.constructor.name==_.InterleavedBufferAttribute.name&&P.MonkeyPatcher.patch(i)}var a=e.clone();return null!=(t=e.userData)&&(a.userData=d.default(t)),a},e.prototype.points_count=function(){return e.points_count(this._geometry)},e.points_count=function(e){var t,n=0,r="position";if(new this(e).marked_as_instance()&&(r="instancePosition"),null!=(t=e.getAttribute(r))){var o;null!=(o=t.array)&&(n=o.length/3)}return n},e.prototype.points=function(){return this._points=this._points||this.points_from_geometry()},e.prototype.reset_points=function(){this._points=void 0},e.prototype.points_from_geometry=function(){var e=[],t=this._geometry.getAttribute(this.position_attrib_name());if(null!=t)for(var n=t.array.length/3,r=0;r<n;r++){var o=new y.CorePoint(this,r);e.push(o)}return e},e.geometry_from_points=function(e,t){var n=new s.BufferGeometry,r=new this(n),o=e[0];if(null!=o){var i=o.geometry(),_=o.geometry_wrapper(),u={};p.default(e,(function(e,t){return u[e.index]=t}));var l=this._indices_from_points(u,i,t);null!=l&&0!==l.length&&n.setIndex(l);for(var d=i.attributes,h=function(t){if(null!=_.user_data_attribs()[t]){var o=c.default(e.map((function(e){return e.attrib_value(t)}))),i={};p.default(o,(function(e,t){return i[e]=t})),r.user_data_attribs()[t]=o;for(var s=[],u=0,l=e;u<l.length;u++){var h=l[u],f=i[h.attrib_value(t)];s.push(f)}n.setAttribute(t,new a.Float32BufferAttribute(s,1))}else{for(var m=[],y=d[t].itemSize,v=0,g=e;v<g.length;v++){var b=(h=g[v]).attrib_value(t);switch(y){case 1:m.push(b);case 3:m.push(b.x),m.push(b.y),m.push(b.z)}}n.setAttribute(t,new a.Float32BufferAttribute(m,y))}},f=0,m=Object.keys(d);f<m.length;f++){h(m[f])}}return n},e._indices_from_points=function(e,t,n){var r=t.index;if(null!=r){var o=r.array,i=[];switch(n){case g.CoreConstant.OBJECT_TYPE.POINTS:p.default(o,(function(t,n){var r=e[t];null!=r&&i.push(r)}));break;case g.CoreConstant.OBJECT_TYPE.MESH:p.default(o,(function(t,n){if(n%3==0){var r=o[n],a=o[n+1],s=o[n+2],_=e[r],u=e[a],c=e[s];null!=_&&null!=u&&null!=c&&(i.push(_),i.push(u),i.push(c))}}));break;case g.CoreConstant.OBJECT_TYPE.LINE_SEGMENTS:p.default(o,(function(t,n){if(n%2==0){var r=o[n],a=o[n+1],s=e[r],_=e[a];null!=s&&null!=_&&(i.push(s),i.push(_))}}))}return i}},e.merge_geometries=function(t){if(0!==t.length){for(var n=t.map((function(t){return new e(t)})),r=n[0].indexed_attribute_names(),o={},i=0,a=r;i<a.length;i++){for(var s=a[i],_={},u=[],c=0,p=n;c<p.length;c++)for(var l=0,d=p[c].points();l<d.length;l++){var h=d[l];u.push(h),null!=_[v=h.attrib_value(s)]?_[v]:_[v]=Object.keys(_).length}for(var f=Object.keys(_),m=0,y=u;m<y.length;m++){var v,g=_[v=(h=y[m]).attrib_value(s)];h.set_attrib_index(s,g)}o[s]=f}var b=O.BufferGeometryUtils.mergeBufferGeometries(t),P=new this(b);return Object.keys(o).forEach((function(e){var t=o[e];P.set_indexed_attribute_values(e,t)})),b&&delete b.userData.mergedUserData,b}},e.prototype.segments=function(){var e,t=(null===(e=this.geometry().index)||void 0===e?void 0:e.array)||[];return l.default(t,2)},e.prototype.faces=function(){return this.faces_from_geometry()},e.prototype.faces_from_geometry=function(){var e,t=this,n=((null===(e=this.geometry().index)||void 0===e?void 0:e.array)||[]).length/3;return u.default(n).map((function(e){return new v.CoreFace(t,e)}))},e}();t.CoreGeometry=C},,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.CREATED="node_created",e.DELETED="node_deleted",e.NAME_UPDATED="node_name_update",e.OVERRIDE_CLONABLE_STATE_UPDATE="node_override_clonable_state_update",e.NAMED_OUTPUTS_UPDATED="node_named_outputs_updated",e.NAMED_INPUTS_UPDATED="node_named_inputs_updated",e.INPUTS_UPDATED="node_inputs_updated",e.PARAMS_UPDATED="node_params_updated",e.UI_DATA_UPDATED="node_ui_data_updated",e.ERROR_UPDATED="node_error_updated",e.FLAG_BYPASS_UPDATED="bypass_flag_updated",e.FLAG_DISPLAY_UPDATED="display_flag_updated",e.SELECTION_UPDATED="selection_updated"}(t.NodeEvent||(t.NodeEvent={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(86),i=n(228),a=n(165),s=n(55),_=n(557),u=r.__importDefault(n(38)),c=r.__importDefault(n(39)),p=n(161),l=function(){function e(e){this.param=e,this.node=this.param.node}return e.required_arguments=function(){return console.warn("Expression.Method._Base.required_arguments virtual method call. Please override"),[]},e.optional_arguments=function(){return[]},e.min_allowed_arguments_count=function(){return this.required_arguments().length},e.max_allowed_arguments_count=function(){return this.min_allowed_arguments_count()+this.optional_arguments().length},e.allowed_arguments_count=function(e){return e>=this.min_allowed_arguments_count()&&e<=this.max_allowed_arguments_count()},e.prototype.process_arguments=function(e){throw"Expression.Method._Base.process_arguments virtual method call. Please override"},e.prototype.get_referenced_node_container=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,n;return r.__generator(this,(function(r){switch(r.label){case 0:return(t=this.get_referenced_node(e))?[4,t.request_container()]:[3,2];case 1:if((n=r.sent())&&n.core_content())return[2,n];throw"referenced node invalid: "+t.full_path();case 2:throw"invalid input ("+e+")"}}))}))},e.prototype.get_referenced_param=function(e,t){return o.CoreWalker.find_param(this.node,e,t)||null},e.prototype.find_referenced_graph_node=function(e,t){if(c.default(e)){var n=e;return this.node.io.inputs.input_graph_node(n)}var r=e;return this.get_referenced_node(r,t)},e.prototype.get_referenced_node=function(e,t){if(u.default(e)){var n=e;return o.CoreWalker.find_node(this.node,n,t)}var r=e;return this.node.io.inputs.input(r)},e.prototype.find_dependency=function(e){return null},e.prototype.create_dependency_from_index_or_path=function(e){var t=new i.DecomposedPath,n=this.find_referenced_graph_node(e,t);return n?this.create_dependency(n,e,t):null},e.prototype.create_dependency=function(e,t,n){if(p.CoreObject.is_a(e,s.TypedNode)||p.CoreObject.is_a(e,a.TypedParam)){var r=e;return _.MethodDependency.create(this.param,t,r,null==n?void 0:n.named_nodes)}return _.MethodDependency.create(this.param,t,e,null==n?void 0:n.named_nodes)},e}();t.BaseMethod=l},,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(495),o=n(496),i=function(){function e(){this.renderers_controller=new r.RenderersController,this.nodes_register=new o.NodesRegister,this.scenes_by_uuid={}}return e.instance=function(){return this._instance=this._instance||new e},e.prototype.register_node=function(e,t,n){this.nodes_register.register_node(e,t,n)},e.prototype.registered_nodes=function(e,t){return this.nodes_register.registered_nodes(e,t)},e.prototype.in_worker_thread=function(){return!1},e.prototype.desktop_controller=function(){},e.prototype.player_mode=function(){return!1},e.prototype.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];console.log.apply(console,e)},e.prototype.set_env=function(e){this._env=e},Object.defineProperty(e.prototype,"env",{get:function(){return this._env},enumerable:!0,configurable:!0}),e}();t.Poly=i,t.POLY=i.instance()},,,,function(e,t,n){"use strict";n.d(t,"a",(function(){return u}));var r,o,i,a=n(23),s=n(62),_=n(56);function u(){this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}Object.assign(u.prototype,{setSize:function(){},render:function(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}}),u.FullScreenQuad=(r=new s.OrthographicCamera(-1,1,1,-1,0,1),o=new _.PlaneBufferGeometry(2,2),i=function(e){this._mesh=new a.Mesh(o,e)},Object.defineProperty(i.prototype,"material",{get:function(){return this._mesh.material},set:function(e){this._mesh.material=e}}),Object.assign(i.prototype,{dispose:function(){this._mesh.geometry.dispose()},render:function(e){e.render(this._mesh,r)}}),i)},,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(504),o=function(){function e(e,t){this._scene=e,this._name=t,this._dirty_controller=new r.DirtyController(this),this._graph_node_id=e.graph.next_id(),e.graph.setNode(this),this._graph=e.graph}return Object.defineProperty(e.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0}),e.prototype.set_name=function(e){this._name=e},Object.defineProperty(e.prototype,"scene",{get:function(){return this._scene},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"graph",{get:function(){return this._graph},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"graph_node_id",{get:function(){return this._graph_node_id},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dirty_controller",{get:function(){return this._dirty_controller},enumerable:!0,configurable:!0}),e.prototype.set_dirty=function(e){e=e||this,this._dirty_controller.set_dirty(e)},e.prototype.set_successors_dirty=function(e){this._dirty_controller.set_successors_dirty(e)},e.prototype.remove_dirty_state=function(){this._dirty_controller.remove_dirty_state()},Object.defineProperty(e.prototype,"is_dirty",{get:function(){return this._dirty_controller.is_dirty},enumerable:!0,configurable:!0}),e.prototype.add_post_dirty_hook=function(e){this._dirty_controller.add_post_dirty_hook(e)},e.prototype.graph_remove=function(){this.graph.removeNode(this)},e.prototype.add_graph_input=function(e){return this.graph.connect(e,this)},e.prototype.remove_graph_input=function(e){this.graph.disconnect(e,this)},e.prototype.graph_disconnect_predecessors=function(){this.graph.disconnect_predecessors(this)},e.prototype.graph_disconnect_successors=function(){this.graph.disconnect_successors(this)},e.prototype.graph_predecessor_ids=function(){return this.graph.predecessor_ids(this._graph_node_id)||[]},e.prototype.graph_predecessors=function(){return this.graph.predecessors(this)},e.prototype.graph_successors=function(){return this.graph.successors(this)},e.prototype.graph_all_predecessors=function(){return this.graph.all_predecessors(this)},e.prototype.graph_all_successors=function(){return this.graph.all_successors(this)},e}();t.CoreGraphNode=o},,,,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(1),o=n(33),i=n(15),a=n(183),s=function(){function e(){this._translation_matrix=new i.Matrix4,this._translation_matrix_q=new o.Quaternion,this._translation_matrix_s=new r.Vector3(1,1,1),this._matrix=(new i.Matrix4).identity(),this._matrix_q=new o.Quaternion,this._matrix_e=new a.Euler,this._matrix_s=new r.Vector3,this._rotate_geometry_m=new i.Matrix4,this._rotate_geometry_q=new o.Quaternion,this._rotate_geometry_vec_dest=new r.Vector3}return e.set_params_from_matrix=function(e,t,n){void 0===n&&(n={});var i=n.scale;null==i&&(i=!0);var s=new r.Vector3,_=new o.Quaternion,u=new r.Vector3;e.decompose(s,_,u);var c=(new a.Euler).setFromQuaternion(_).toVector3();c.divideScalar(Math.PI/180),t.scene.batch_update((function(){t.params.set_vector3("r",c.toArray()),t.params.set_vector3("t",s.toArray()),t.params.set_vector3("s",u.toArray()),i&&t.params.set_float("scale",1)}))},e.set_params_from_object=function(e,t){var n=e.position.toArray(),r=e.rotation.toArray().map((function(e){return e*(180/Math.PI)}));t.scene.batch_update((function(){t.params.set_vector3("t",n),t.params.set_vector3("r",r)}))},e.prototype.translation_matrix=function(e){return this._translation_matrix.compose(e,this._translation_matrix_q,this._translation_matrix_s),this._translation_matrix},e.matrix_quaternion=function(e){var t=new r.Vector3,n=new o.Quaternion,i=new r.Vector3;return e.decompose(t,n,i),n},e.prototype.matrix=function(e,t,n,r){return this._matrix_e.set(t.x,t.y,t.z,"XYZ"),this._matrix_q.setFromEuler(this._matrix_e),this._matrix_s.copy(n).multiplyScalar(r),this._matrix.compose(e,this._matrix_q,this._matrix_s),this._matrix},e.prototype.rotate_geometry=function(e,t,n){this._rotate_geometry_vec_dest.copy(n),this._rotate_geometry_vec_dest.normalize(),this._rotate_geometry_q.setFromUnitVectors(t,this._rotate_geometry_vec_dest),this._rotate_geometry_m.makeRotationFromQuaternion(this._rotate_geometry_q),e.applyMatrix(this._rotate_geometry_m)},e}();t.CoreTransform=s},,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.find_param=function(e,n,r){if(!e)return null;var o=n.split(t.SEPARATOR);if(1===o.length)return e.params.get(o[0]);var i=o.slice(0,+(o.length-2)+1||void 0).join(t.SEPARATOR),a=this.find_node(e,i,r);if(null!=a){var s=o[o.length-1],_=a.params.get(s);return r&&_&&r.add_node(s,_),_}return null},t.relative_path=function(e,n){var r=this.closest_common_parent(e,n);if(r){var o=this.distance_to_parent(e,r),i="";if(o-1>0){for(var a=0,s=[];a++<o-1;)s.push(t.PARENT);i=s.join(t.SEPARATOR)+t.SEPARATOR}for(var _=r.full_path().split(t.SEPARATOR).filter((function(e){return e.length>0})),u=[],c=0,p=0,l=n.full_path().split(t.SEPARATOR).filter((function(e){return e.length>0}));p<l.length;p++){var d=l[p];_[c]||u.push(d),c++}return""+i+u.join(t.SEPARATOR)}return n.full_path()},t.closest_common_parent=function(e,t){for(var n=this.parents(e).reverse(),r=this.parents(t).reverse(),o=Math.min(n.length,r.length),i=null,a=0;a<o;a++)n[a].graph_node_id==r[a].graph_node_id&&(i=n[a]);return i},t.parents=function(e){for(var t=[],n=e.parent;n;)t.push(n),n=n.parent;return t},t.distance_to_parent=function(e,t){for(var n=0,r=e,o=t.graph_node_id;r&&r.graph_node_id!=o;)n+=1,r=r.parent;return r&&r.graph_node_id==o?n:-1},t.SEPARATOR="/",t.CURRENT=".",t.PARENT="..",t.CURRENT_WITH_SLASH=t.CURRENT+"/",t.PARENT_WITH_SLASH=t.PARENT+"/",t}(n(510).CoreWalkerEmbed);t.CoreWalker=o},,,function(e,t,n){"use strict";var r,o,i,a;Object.defineProperty(t,"__esModule",{value:!0});var s,_=n(21),u=n(111);!function(e){e.BOOL="bool",e.INT="int",e.FLOAT="float",e.VEC2="vec2",e.VEC3="vec3",e.VEC4="vec4",e.SAMPLER_2D="sampler2D"}(s=t.ConnectionPointType||(t.ConnectionPointType={})),t.ConnectionPointTypes=[s.BOOL,s.INT,s.FLOAT,s.VEC2,s.VEC3,s.VEC4],t.ConnectionPointTypeToParamTypeMap=((r={})[s.BOOL]=_.ParamType.BOOLEAN,r[s.INT]=_.ParamType.INTEGER,r[s.FLOAT]=_.ParamType.FLOAT,r[s.VEC2]=_.ParamType.VECTOR2,r[s.VEC3]=_.ParamType.VECTOR3,r[s.VEC4]=_.ParamType.VECTOR4,r[s.SAMPLER_2D]=_.ParamType.RAMP,r),t.ParamTypeToConnectionPointTypeMap=((o={})[_.ParamType.BOOLEAN]=s.BOOL,o[_.ParamType.COLOR]=s.VEC3,o[_.ParamType.INTEGER]=s.INT,o[_.ParamType.FLOAT]=s.FLOAT,o[_.ParamType.VECTOR2]=s.VEC2,o[_.ParamType.VECTOR3]=s.VEC3,o[_.ParamType.VECTOR4]=s.VEC4,o[_.ParamType.BUTTON]=void 0,o[_.ParamType.OPERATOR_PATH]=void 0,o[_.ParamType.RAMP]=void 0,o[_.ParamType.SEPARATOR]=void 0,o[_.ParamType.STRING]=void 0,o),t.ConnectionPointInitValueMap=((i={})[s.BOOL]=!1,i[s.INT]=0,i[s.FLOAT]=0,i[s.VEC2]=[0,0],i[s.VEC3]=[0,0,0],i[s.VEC4]=[0,0,0,0],i[s.SAMPLER_2D]=u.RampParam.DEFAULT_VALUE_JSON,i),t.ConnectionPointComponentsCountMap=((a={})[s.BOOL]=1,a[s.INT]=1,a[s.FLOAT]=1,a[s.VEC2]=2,a[s.VEC3]=3,a[s.VEC4]=4,a[s.SAMPLER_2D]=1,a)},,,,,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=function(){function e(e,t){this.node=e,this._callbacks=[],this._container=new t(this.node)}return Object.defineProperty(e.prototype,"container",{get:function(){return this._container},enumerable:!0,configurable:!0}),e.prototype.request_container=function(){var e=this;return new Promise((function(t,n){e._callbacks.push(t),e.node.scene.cook_controller.add_node(e.node),setTimeout(e.process_container_request.bind(e),0)}))},e.prototype.process_container_request=function(){var e,t,n=this;if(null===(t=null===(e=this.node.flags)||void 0===e?void 0:e.bypass)||void 0===t?void 0:t.active){this.request_input_container(0).then((function(e){n.node.remove_dirty_state(),e?n.notify_requesters(e):n.node.states.error.set("input invalid")}))}else this.node.is_dirty?(this.node.container_controller.container.reset_caches(),this.node.cook_controller.cook_main()):this.notify_requesters()},e.prototype.request_input_container=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t;return r.__generator(this,(function(n){switch(n.label){case 0:return(t=this.node.io.inputs.input(e))?(t.processing_context.copy(this.node.processing_context),[4,t.container_controller.request_container()]):[3,2];case 1:return[2,n.sent()];case 2:return this.node.states.error.set("input "+e+" required"),this.notify_requesters(),[2,null]}}))}))},e.prototype.notify_requesters=function(e){for(var t,n=[];t=this._callbacks.pop();)n.push(t);for(e||(e=this.node.container_controller.container.clone());t=n.pop();)t(e);this.node.scene.cook_controller.remove_node(this.node)},e}();t.TypedContainerController=o;var i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t}(o);t.BaseContainerController=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(1),o={Vector2:n(3).Vector2,Vector3:r.Vector3},i={P:"position",N:"normal",Cd:"color"},a=function(){function e(){}return e.remap_name=function(e){return i[e]||e},e.array_to_indexed_arrays=function(e){for(var t={},n=0,r=[],o=[],i=0;i<e.length;){var a=e[i],s=t[a];null!=s?r.push(s):(o.push(a),r.push(n),t[a]=n,n+=1),i++}return{indices:r,values:o}},e.default_value=function(e){switch(e){case 1:return 0;case 2:return new o.Vector2(0,0);case 3:return new o.Vector3(0,0,0);default:throw"size "+e+" not yet implemented"}},e}();t.CoreAttribute=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=function(e){function t(t){var n=e.call(this)||this;return n._node=t,n}return r.__extends(t,e),t.prototype.set_node=function(e){this._node=e},t.prototype.node=function(){return this._node},t.prototype.clone=function(){var e,t=new this.constructor;return t.set_node(this.node()),null!=(e=this.content())&&t.set_content(e),t},t.prototype.reset_caches=function(){},t.prototype.set_content=function(e){this.reset_caches(),this._content=e,this._post_set_content()},t.prototype.has_content=function(){return null!=this._content},t.prototype.content=function(){return this._content},t.prototype._post_set_content=function(){},t.prototype.core_content=function(){return this._content},t.prototype.core_content_cloned=function(){return this._content},t.prototype.infos=function(){return[]},t}(n(161).CoreObject);t.TypedContainer=o;var i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t}(o);t.BaseContainer=i},,,,,,,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.post_eval_raw=function(e){var t=this._value;this._value=e,null!=this._value&&this.states.error.clear();var n=this.is_dirty;if(this.remove_dirty_state(),n&&this.emit_controller.emit_param_updated(),this.options.has_callback()&&t!==this._value)return this.options.execute_callback()},t}(n(165).TypedParam);t.Single=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=r.__importDefault(n(20)),i=n(165),a=n(311),s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._components_contructor=a.FloatParam,t}return r.__extends(t,e),Object.defineProperty(t.prototype,"components",{get:function(){return this._components},enumerable:!0,configurable:!0}),t.prototype.init_components=function(){var e=0;this._components=new Array(this.component_names.length);for(var t=0,n=this.component_names;t<n.length;t++){var r=n[t],i=new this._components_contructor(this.scene),a=void 0;a=o.default(this._default_value)?this._default_value[e]:this._default_value[r],i.options.copy(this.options),i.set_init_value(a),i.set_name(""+this.name+r),i.set_parent_param(this),this.add_graph_input(i),this._components[e]=i,e++}this.compute()},t.prototype.process_computation=function(){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(e){switch(e.label){case 0:return[4,this.compute_components()];case 1:return e.sent(),this.set_value_from_components(),[2]}}))}))},t.prototype.set_value_from_components=function(){},Object.defineProperty(t.prototype,"is_numeric",{get:function(){return!0},enumerable:!0,configurable:!0}),t.prototype.has_expression=function(){for(var e,t=0,n=this.components;t<n.length;t++){if(null===(e=n[t].expression_controller)||void 0===e?void 0:e.active)return!0}return!1},Object.defineProperty(t.prototype,"is_default",{get:function(){for(var e=0,t=this.components;e<t.length;e++){if(!t[e].is_default)return!1}return!0},enumerable:!0,configurable:!0}),t.prototype.compute_components=function(){return r.__awaiter(this,void 0,void 0,(function(){var e,t,n,o,i;return r.__generator(this,(function(r){switch(r.label){case 0:for(e=this.components,t=[],n=0,o=e;n<o.length;n++)i=o[n],t.push(i.compute());return[4,Promise.all(t)];case 1:return r.sent(),this.remove_dirty_state(),[2]}}))}))},t.prototype.set=function(e){var t=this.scene.cooker;t.block();for(var n=this.components,r=0,o=n;r<o.length;r++){o[r].emit_controller.block_parent_emit()}for(var i=0;i<n.length;i++)n[i].set(e[i]);t.unblock();for(i=0;i<n.length;i++)n[i].emit_controller.unblock_parent_emit();this.emit_controller.emit_param_updated()},t}(i.TypedParam);t.TypedMultipleParam=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=r.__importDefault(n(96)),i=n(0),a=n(184),s=n(246),_=n(109),u=n(575),c=n(21),p=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.type=function(){return c.ParamType.RAMP},Object.defineProperty(t.prototype,"default_value_serialized",{get:function(){return this.default_value instanceof u.RampValue?this.default_value.to_json():this.default_value},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"value_serialized",{get:function(){return this.value.to_json()},enumerable:!0,configurable:!0}),t.are_values_equal=function(e,t){return e.is_equal(t)},t.prototype.initialize_param=function(){this.add_post_dirty_hook(this._reset_ramp_interpolant_and_texture.bind(this))},Object.defineProperty(t.prototype,"is_default",{get:function(){return this.default_value instanceof u.RampValue?this.value.is_equal(this.default_value):this.value.is_equal_json(this.default_value)},enumerable:!0,configurable:!0}),t.prototype.set=function(e){e instanceof u.RampValue?this._value?this._value.copy(e):this._value=e.clone():this._value?this._value.from_json(e):this._value=u.RampValue.from_json(e)},t.prototype.has_expression=function(){return!1},t.prototype._reset_ramp_interpolant_and_texture=function(){this._ramp_interpolant=void 0,this._ramp_texture=void 0},t.prototype.ramp_texture=function(){return this._ramp_texture=this._ramp_texture||this._create_ramp_texture()},t.prototype._create_ramp_texture=function(){for(var e=new Uint8Array(3072),t=0,n=0,r=0,o=0;o<1024;o++)t=3*o,n=o/1024,r=this.value_at_position(n),e[t]=255*r;var s=new a.DataTexture(e,1024,1,i.RGBFormat);return s.needsUpdate=!0,s},t.create_interpolant=function(e,t){var n=new Float32Array(1);return new s.CubicInterpolant(e,t,1,n)},t.prototype.interpolant=function(){return this._ramp_interpolant=this._ramp_interpolant||this._create_interpolant()},t.prototype._create_interpolant=function(){for(var e=this.value.points,n=o.default(e,(function(e){return e.position})),r=new Float32Array(n.length),i=new Float32Array(n.length),a=0,s=0,_=n;s<_.length;s++){var u=_[s];r[a]=u.position,i[a]=u.value,a++}return t.create_interpolant(r,i)},t.prototype.value_at_position=function(e){return this.interpolant().evaluate(e)[0]},t.DEFAULT_VALUE=new u.RampValue(u.RampInterpolation.LINEAR,[new u.RampPoint(0,0),new u.RampPoint(1,1)]),t.DEFAULT_VALUE_JSON=t.DEFAULT_VALUE.to_json(),t}(_.Single);t.RampParam=p},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this._param=e,this._data={}}return Object.defineProperty(e.prototype,"required",{get:function(){var e=this._param.options.is_spare&&!this._param.parent_param,t=!this._param.is_default||this._param.has_expression();return e||t},enumerable:!0,configurable:!0}),e.prototype.data=function(){if(this._data={},this._param.options.is_spare&&!this._param.parent_param&&(this._data.type=this._param.type,this._data.default_value=this._param.default_value_serialized,this._data.options=this._param.options.current),this._param.is_default||this.add_main(),this._param.options.has_options_overridden){for(var e={},t=this._param.options.overridden_options,n=0,r=Object.keys(t);n<r.length;n++){var o=r[n],i=t[o];e[o]=JSON.stringify(i)}this._data.overriden_options=e}return this._data},e.prototype.add_main=function(){},e}();t.ParamJsonExporter=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(89),o=function(){function e(e,t,n){this._name=e,this._type=t,this._init_value=n,void 0===this._init_value&&(this._init_value=r.ConnectionPointInitValueMap[this._type])}return Object.defineProperty(e.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"type",{get:function(){return this._type},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"param_type",{get:function(){return r.ConnectionPointTypeToParamTypeMap[this._type]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"init_value",{get:function(){return this._init_value},enumerable:!0,configurable:!0}),e.prototype.to_json=function(){return this._json=this._json||this._create_json},e.prototype._create_json=function(){return{name:this._name}},e}();t.TypedNamedConnectionPoint=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(1),i={Triangle:n(81).Triangle,Vector3:o.Vector3},a=r.__importDefault(n(39)),s=n(310),_=Math.PI/180,u=function(){function e(){}return e.clamp=function(e,t,n){return e<t?t:e>n?n:e},e.fit01=function(e,t,n){return this.fit(e,0,1,t,n)},e.fit=function(e,t,n,r,o){return(e-t)/(n-t)*(o-r)+r},e.degrees_to_radians=function(e){return e*_},e.radians_to_degrees=function(e){return e/_},e.deg2rad=function(e){return this.degrees_to_radians(e)},e.rad2deg=function(e){return this.radians_to_degrees(e)},e.rand=function(e){return a.default(e)?this.rand_float(e):this.rand_vec2(e)},e.round=function(e,t){var n=e/t,r=e<0?Math.ceil(n):Math.floor(n);return console.log("round",t,e,n,r,r*t),r*t},e.highest_even=function(e){return 2*Math.ceil(.5*e)},e.rand_float=function(e){var t={x:e,y:136574};return this.rand_vec2(t)},e.rand_vec2=function(e){var t=(12.9898*e.x+78.233*e.y)%Math.PI;return this.fract(43758.5453*Math.sin(t))},e.geodesic_distance=function(e,t){var n=this.deg2rad(e.lat),r=this.deg2rad(t.lat),o=this.deg2rad(t.lat-e.lat),i=this.deg2rad(t.lng-e.lng),a=Math.sin(o/2)*Math.sin(o/2)+Math.cos(n)*Math.cos(r)*Math.sin(i/2)*Math.sin(i/2);return 6371e3*(2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a)))},e.expand_triangle=function(e,t){var n,r=new i.Vector3;e.getMidpoint(r),function(e){e.a="a",e.b="b",e.c="c"}(n||(n={}));for(var o=0,a=["a","b","c"];o<a.length;o++){var s=a[o],_=e[s].clone().sub(r),u=_.clone().normalize(),c=_.length()+t;e[s]=r.clone().add(u.multiplyScalar(c))}return e},e.nearestPower2=function(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.log(2)))},e.Easing=s.Easing,e.fract=function(e){return e-Math.floor(e)},e}();t.CoreMath=u},,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CATEGORY_OBJ={LIGHT:"lights",MANAGER:"managers",GEOMETRY:"geometries",CAMERA:"cameras",MISC:"misc"},t.CATEGORY_COP={INPUT:"inputs",ADVANCED:"advanced"},t.CATEGORY_EVENT={CAMERA:"cameras",MISC:"misc"},t.CATEGORY_GL={COLOR:"color",CONVERSION:"conversion",DYNAMICS:"dynamics",GEOMETRY:"geometry",GLOBALS:"globals",MATH:"math",QUAT:"quat",TRIGO:"trigo",UTIL:"util",INSTANCE:"instance"},t.CATEGORY_MAT={ADVANCED:"advanced",MESH:"meshes",POINT:"points",LINE:"lines",VOLUME:"volumes",INSTANCE:"instances"},t.CATEGORY_POST={PASS:"passes"},t.CATEGORY_SOP={ANIMATION:"animation",ATTRIBUTE:"attributes",DYNAMICS:"dynamics",INPUT:"inputs",MISC:"misc",MODIFIER:"modifiers",RENDER:"render"}},,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){}return e.push_on_array_at_entry=function(e,t,n){e.has(t)?e.get(t).push(n):e.set(t,[n])},e.unshift_on_array_at_entry=function(e,t,n){e.has(t)?e.get(t).unshift(n):e.set(t,[n])},e.concat_on_array_at_entry=function(e,t,n){if(e.has(t))for(var r=e.get(t),o=0,i=n;o<i.length;o++){var a=i[o];r.push(a)}else e.set(t,n)},e}();t.MapUtils=r},function(e,t,n){"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.VERTEX="vertex",e.FRAGMENT="fragment",e.LEAVES_FROM_NODES_SHADER="leaves_from_nodes_shader",e.PARTICLES_0="particles_0",e.PARTICLES_1="particles_1",e.PARTICLES_2="particles_2",e.PARTICLES_3="particles_3",e.PARTICLES_4="particles_4",e.PARTICLES_5="particles_5",e.PARTICLES_6="particles_6",e.PARTICLES_7="particles_7",e.PARTICLES_8="particles_8",e.PARTICLES_9="particles_9"}(r=t.ShaderName||(t.ShaderName={})),t.ParticleShaderNames=[r.PARTICLES_0,r.PARTICLES_1,r.PARTICLES_2,r.PARTICLES_3,r.PARTICLES_4,r.PARTICLES_5,r.PARTICLES_6,r.PARTICLES_7,r.PARTICLES_8,r.PARTICLES_9]},,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this.node=e}return e.prototype.add_params=function(){},e.prototype.update=function(){},Object.defineProperty(e.prototype,"material",{get:function(){return this.node.material},enumerable:!0,configurable:!0}),e}();t.BaseController=r},,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(646),i=n(647),a=function(){function e(e){this.node=e}return e.prototype.has_display=function(){return!1},e.prototype.has_bypass=function(){return!1},e}();function s(e){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.display=new i.DisplayFlag(t.node),t}return r.__extends(t,e),t.prototype.has_display=function(){return!0},t}(e)}function _(e){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.bypass=new o.BypassFlag(t.node),t}return r.__extends(t,e),t.prototype.has_bypass=function(){return!0},t}(e)}t.FlagsController=a;var u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t}(s(a));t.FlagsControllerD=u;var c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t}(_(a));t.FlagsControllerB=c;var p=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t}(_(s(a)));t.FlagsControllerDB=p},,,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=["extended","included"];var o=function(){function e(){}return e.include=function(e){var t,n;t=e,n=this,Object.keys(n).forEach((function(e){r.includes(e)||(t.prototype[e]=n[e])})),n.included&&n.included.apply(t)},e.is_a=function(e,t){for(var n=e;n;){if(n.constructor==t)return!0;n=n.__proto__}return!1},e.prototype.is_a=function(t){return e.is_a(this,t)},e}();t.CoreObject=o},,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(86),i=n(61),a=n(542),s=n(543),_=n(544),u=n(545),c=n(548),p=n(21),l=function(e){function t(t){var n=e.call(this,t,"BaseParam")||this;return n._options=new a.OptionsController(n),n._emit_controller=new s.EmitController(n),n._is_computing=!1,n.initialize_param(),n}return r.__extends(t,e),Object.defineProperty(t.prototype,"options",{get:function(){return this._options=this._options||new a.OptionsController(this)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"emit_controller",{get:function(){return this._emit_controller=this._emit_controller||new s.EmitController(this)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"expression_controller",{get:function(){return this._expression_controller},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"serializer",{get:function(){return this._serializer=this._serializer||new _.ParamSerializer(this)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"states",{get:function(){return this._states=this._states||new u.StatesController(this)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ui_data",{get:function(){return this._ui_data=this._ui_data||new c.UIData(this.scene,this)},enumerable:!0,configurable:!0}),t.prototype.initialize_value=function(){},t.prototype.initialize_param=function(){},t.type=function(){return p.ParamType.FLOAT},Object.defineProperty(t.prototype,"type",{get:function(){return this.constructor.type()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"is_numeric",{get:function(){return!1},enumerable:!0,configurable:!0}),t.prototype.set_name=function(t){e.prototype.set_name.call(this,t)},Object.defineProperty(t.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0}),t.prototype.convert=function(e){return null},t.prototype.set=function(e){},Object.defineProperty(t.prototype,"default_value",{get:function(){return this._default_value},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"is_default",{get:function(){return!0},enumerable:!0,configurable:!0}),t.prototype.compute=function(){return r.__awaiter(this,void 0,void 0,(function(){var e,t=this;return r.__generator(this,(function(n){switch(n.label){case 0:return this.is_dirty?this._is_computing?[3,2]:(this._is_computing=!0,[4,this.process_computation()]):[3,3];case 1:if(n.sent(),this._is_computing=!1,this._compute_resolves)for(e=void 0;e=this._compute_resolves.pop();)e();return[3,3];case 2:return[2,new Promise((function(e,n){t._compute_resolves=t._compute_resolves||[],t._compute_resolves.push(e)}))];case 3:return[2]}}))}))},t.prototype.process_computation=function(){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(e){return[2]}))}))},t.prototype.set_init_value=function(e){this._default_value=e,this.is_multiple||this.set(e)},t.prototype.set_node=function(e){var t,n;if(e?(this._node=e,this.options.makes_node_dirty_when_dirty()&&!this.parent_param&&(null===(n=e.params.params_node)||void 0===n||n.add_graph_input(this))):this._node&&(null===(t=this._node.params.params_node)||void 0===t||t.remove_graph_input(this)),this.is_multiple&&(this.init_components(),this.components))for(var r=0,o=this.components;r<o.length;r++){o[r].set_node(e)}},Object.defineProperty(t.prototype,"node",{get:function(){return this._node},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return this.node},enumerable:!0,configurable:!0}),t.prototype.set_parent_param=function(e){e.add_graph_input(this),this._parent_param=e},Object.defineProperty(t.prototype,"parent_param",{get:function(){return this._parent_param},enumerable:!0,configurable:!0}),t.prototype.has_parent_param=function(){return null!=this._parent_param},t.prototype.full_path=function(){var e;return(null===(e=this.node)||void 0===e?void 0:e.full_path())+"/"+this.name},t.prototype.path_relative_to=function(e){return o.CoreWalker.relative_path(e,this)},t.prototype.emit=function(e){this.emit_controller.emit_allowed&&(this.emit_controller.increment_count(e),this.scene.events_controller.dispatch(this,e))},Object.defineProperty(t.prototype,"components",{get:function(){return this._components},enumerable:!0,configurable:!0}),Object.defineProperty(t,"component_names",{get:function(){return[]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"component_names",{get:function(){return this.constructor.component_names},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"is_multiple",{get:function(){return this.component_names.length>0},enumerable:!0,configurable:!0}),t.prototype.init_components=function(){},t.prototype.has_expression=function(){return null!=this.expression_controller&&this.expression_controller.active},t.prototype.to_json=function(){return this.serializer.to_json()},t}(i.CoreGraphNode);t.TypedParam=l;var d=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),Object.defineProperty(t.prototype,"default_value_serialized",{get:function(){return"BaseParamClass.value_serialized overriden"},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"value_serialized",{get:function(){return"BaseParamClass.value_serialized overriden"},enumerable:!0,configurable:!0}),t}(l);t.BaseParamClass=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=r.__importDefault(n(38)),i=n(109),a=n(308),s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),Object.defineProperty(t.prototype,"is_numeric",{get:function(){return!0},enumerable:!0,configurable:!0}),t.prototype.set=function(e){var t;this.states.error.clear();var n=this.convert(e);null!=n?(null===(t=this._expression_controller)||void 0===t||t.set_expression(void 0,!1),n!=this._value&&(this._value=n,this.emit_controller.emit_param_updated(),this.remove_dirty_state(),this.set_successors_dirty())):o.default(e)?(this._expression_controller=this._expression_controller||new a.ExpressionController(this),e!=this._expression_controller.expression&&(this._expression_controller.set_expression(e),this.emit_controller.emit_param_updated())):(this.states.error.set("param input is invalid ("+this.full_path()+")"),this.emit_controller.emit_param_updated()),this.parent_param&&this.parent_param.set_value_from_components()},t.prototype.process_computation=function(){var e;return r.__awaiter(this,void 0,void 0,(function(){var t,n;return r.__generator(this,(function(r){switch(r.label){case 0:return null===(e=this.expression_controller)||void 0===e||!e.active||this.expression_controller.requires_entities?[3,2]:[4,this.expression_controller.compute_expression()];case 1:t=r.sent(),this.expression_controller.is_errored?this.states.error.set('expression error: "'+this.expression_controller.expression+'" ('+this.expression_controller.error_message+")"):(null!=(n=this.convert(t))?this._value=n:this.states.error.set("expression returns an invalid type ("+t+") ("+this.expression_controller.expression+")"),this.remove_dirty_state()),r.label=2;case 2:return[2]}}))}))},t}(i.Single);t.TypedNumericParam=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){}return e.unreachable=function(e){throw new Error("Didn't expect to get here")},e}();t.TypeAssert=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this._param=e}return e.prototype.process_data=function(e){var t=e.value,n=e.expression;void 0!==n&&this._param.set(n),void 0!==t&&this._param.set(t),this.add_main(e)},e.prototype.add_main=function(e){},e}();t.ParamJsonImporter=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(616),o=n(112),i=n(617),a=n(618),s=n(619),_=n(620),u=n(621),c=n(110),p=n(166),l=n(312),d=n(230),h=n(111),f=function(){function e(){}return e.dispatch_node=function(e){return new r.NodeJsonExporter(e)},e.dispatch_param=function(e){return e instanceof c.TypedMultipleParam?new i.ParamMultipleJsonExporter(e):e instanceof p.TypedNumericParam?new a.ParamNumericJsonExporter(e):e instanceof l.OperatorPathParam?new s.ParamOperatorPathJsonExporter(e):e instanceof d.StringParam?new _.ParamStringJsonExporter(e):e instanceof h.RampParam?new u.ParamRampJsonExporter(e):new o.ParamJsonExporter(e)},e}();t.JsonExportDispatcher=f},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,o=n(2),i=n(317);!function(e){e.ATTRIBUTE="attribute",e.FUNCTION="function",e.UNIFORM="uniform",e.VARYING="varying"}(r=t.GLDefinitionType||(t.GLDefinitionType={}));var a=function(){function e(e,t,n,r){this._definition_type=e,this._data_type=t,this._node=n,this._name=r}return Object.defineProperty(e.prototype,"definition_type",{get:function(){return this._definition_type},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"data_type",{get:function(){return this._data_type},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"node",{get:function(){return this._node},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0}),e.prototype.collection_instance=function(){return new i.TypedGLDefinitionCollection},e}();t.TypedGLDefinition=a;var s=function(e){function t(t,n,o){var i=e.call(this,r.ATTRIBUTE,n,t,o)||this;return i._node=t,i._data_type=n,i._name=o,i}return o.__extends(t,e),Object.defineProperty(t.prototype,"line",{get:function(){return"attribute "+this.data_type+" "+this.name},enumerable:!0,configurable:!0}),t}(a);t.AttributeGLDefinition=s;var _=function(e){function t(t,n,o){var i=e.call(this,r.FUNCTION,n,t,o)||this;return i._node=t,i._data_type=n,i._name=o,i}return o.__extends(t,e),Object.defineProperty(t.prototype,"line",{get:function(){return this.name},enumerable:!0,configurable:!0}),t}(a);t.FunctionGLDefinition=_;var u=function(e){function t(t,n,o){var i=e.call(this,r.UNIFORM,n,t,o)||this;return i._node=t,i._data_type=n,i._name=o,i}return o.__extends(t,e),Object.defineProperty(t.prototype,"line",{get:function(){return"uniform "+this.data_type+" "+this.name},enumerable:!0,configurable:!0}),t}(a);t.UniformGLDefinition=u;var c=function(e){function t(t,n,o){var i=e.call(this,r.VARYING,n,t,o)||this;return i._node=t,i._data_type=n,i._name=o,i}return o.__extends(t,e),Object.defineProperty(t.prototype,"line",{get:function(){return"varying "+this.data_type+" "+this.name},enumerable:!0,configurable:!0}),t}(a);t.VaryingGLDefinition=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(45),i=r.__importDefault(n(39)),a=r.__importDefault(n(307)),s=r.__importDefault(n(38)),_=function(){function e(){}return e.any=function(e){if(s.default(e))return e;if(a.default(e))return""+e;if(i.default(e))return""+o.CoreString.ensure_float(e);var t=e.toArray().map((function(e){return""+o.CoreString.ensure_float(e)}));return"vec"+t.length+"("+t.join(", ")+")"},e.vector3=function(e){return s.default(e)?e:"vec3("+e.toArray().map((function(e){return""+o.CoreString.ensure_float(e)})).join(", ")+")"},e.vector2=function(e){return s.default(e)?e:"vec2("+e.toArray().map((function(e){return""+o.CoreString.ensure_float(e)})).join(", ")+")"},e.vector3_float=function(e,t){return s.default(t)||(t=o.CoreString.ensure_float(t)),"vec4("+this.vector3(e)+", "+t+")"},e.float3=function(e,t,n){return s.default(e)||(e=o.CoreString.ensure_float(e)),s.default(t)||(t=o.CoreString.ensure_float(t)),s.default(n)||(n=o.CoreString.ensure_float(n)),"vec3("+e+", "+t+", "+n+")"},e.float2=function(e,t){return s.default(e)||(e=o.CoreString.ensure_float(e)),s.default(t)||(t=o.CoreString.ensure_float(t)),"vec2("+e+", "+t+")"},e.float=function(e){return s.default(e)||(e=o.CoreString.ensure_float(e)),""+e},e.int=function(e){return""+e},e.bool=function(e){return""+e},e}();t.ThreeToGl=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(90),i=n(40),a=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}r.__extends(t,e)}(n(7).NodeParamsConfig),function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.add_to_hierarchy=!1,t}return r.__extends(t,e),t.prototype.create_object=function(){return new i.Group},t.prototype.cook=function(){this.cook_controller.end_cook()},t}(o.TypedObjNode));t.BaseManagerObjNode=a},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2).__importDefault(n(132)),o=n(61),i=n(48),a=function(){function e(e){this.node=e,this._graph_node=new o.CoreGraphNode(e.scene,"node_name_controller")}return Object.defineProperty(e.prototype,"graph_node",{get:function(){return this._graph_node},enumerable:!0,configurable:!0}),e.base_name=function(e){var t=e.type,n=t[t.length-1];return r.default(parseInt(n))||(t+="_"),t+"1"},e.prototype.request_name_to_parent=function(e){var t=this.node.parent;null!=t?t.children_controller.set_child_name(this.node,e):console.warn("request_name_to_parent failed, no parent found")},e.prototype.set_name=function(e){e!=this.node.name&&this.request_name_to_parent(e)},e.prototype.update_name_from_parent=function(e){this.node.set_name(e),this.post_set_name(),this.post_set_full_path(),this.node.children_controller.children().forEach((function(e){e.name_controller.post_set_full_path()})),this._graph_node.set_successors_dirty(),this.node.emit(i.NodeEvent.NAME_UPDATED)},e.prototype.add_post_set_name_hook=function(e){this._on_set_name_hooks=this._on_set_name_hooks||[],this._on_set_name_hooks.push(e)},e.prototype.add_post_set_full_path_hook=function(e){this._on_set_full_path_hooks=this._on_set_full_path_hooks||[],this._on_set_full_path_hooks.push(e)},e.prototype.post_set_name=function(){if(this._on_set_name_hooks)for(var e=0,t=this._on_set_name_hooks;e<t.length;e++){(0,t[e])()}},e.prototype.post_set_full_path=function(){if(this._on_set_full_path_hooks)for(var e=0,t=this._on_set_full_path_hooks;e<t.length;e++){(0,t[e])()}},e}();t.NameController=a},,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.VISIBLE_UPDATED="param_visible_updated",e.UPDATED="param_updated",e.DELETED="param_deleted"}(t.ParamEvent||(t.ParamEvent={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(86).CoreWalker.SEPARATOR,o=function(){function e(){this.named_nodes=[],this.graph_node_ids=[],this.node_element_by_graph_node_id={}}return e.prototype.add_node=function(e,t){e==t.name&&this.named_nodes.push(t),this.graph_node_ids.push(t.graph_node_id),this.node_element_by_graph_node_id[t.graph_node_id]=e},e.prototype.update_from_name_change=function(e){this.named_nodes.map((function(e){return e.graph_node_id})).includes(e.graph_node_id)&&(this.node_element_by_graph_node_id[e.graph_node_id]=e.name)},e.prototype.to_path=function(){var e=this;return this.graph_node_ids.map((function(t){return e.node_element_by_graph_node_id[t]})).join(r)},e}();t.DecomposedPath=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VARIABLE_PREFIX="$";var r=function(){function e(e){this.param=e}return e.prototype.set_error=function(e){this.error_message=this.error_message||e},e.prototype.traverse_node=function(e){var t="traverse_"+e.type;if(this[t])return this[t](e);this.set_error("expression unknown node type: "+e.type)},e.prototype.traverse_BinaryExpression=function(e){return this.traverse_node(e.left)+" "+e.operator+" "+this.traverse_node(e.right)},e.prototype.traverse_LogicalExpression=function(e){return this.traverse_node(e.left)+" "+e.operator+" "+this.traverse_node(e.right)},e.prototype.traverse_MemberExpression=function(e){return this.traverse_node(e.object)+"."+this.traverse_node(e.property)},e.prototype.traverse_ConditionalExpression=function(e){return"("+this.traverse_node(e.test)+") ? ("+this.traverse_node(e.consequent)+") : ("+this.traverse_node(e.alternate)+")"},e.prototype.traverse_Compound=function(e){var n=e.body;console.log(n);for(var r=[],o=0;o<n.length;o++){var i=n[o];"Identifier"==i.type?i.name[0]==t.VARIABLE_PREFIX?r.push("`${"+this.traverse_node(i)+"}`"):r.push("'"+i.name+"'"):r.push("`${"+this.traverse_node(i)+"}`")}return r.join(" + ")},e.prototype.traverse_Literal=function(e){return""+e.raw},e}();t.BaseTraverser=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=r.__importDefault(n(38)),i=n(109),a=n(309),s=n(21),_=n(308),u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.type=function(){return s.ParamType.STRING},Object.defineProperty(t.prototype,"default_value_serialized",{get:function(){return this.default_value},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"value_serialized",{get:function(){return this.value},enumerable:!0,configurable:!0}),t.are_values_equal=function(e,t){return e==t},t.prototype.convert=function(e){return o.default(e)?e:""+e},Object.defineProperty(t.prototype,"raw_input",{get:function(){return this._raw_input},enumerable:!0,configurable:!0}),t.prototype.set=function(e){this._raw_input=e,this.states.error.clear(),this._value_elements(e).length>=3?(this._expression_controller=this._expression_controller||new _.ExpressionController(this),e!=this._expression_controller.expression&&(this._expression_controller.set_expression(e),this.set_dirty())):e!=this._value&&(this._value=e,this.remove_dirty_state(),this.set_successors_dirty())},t.prototype.process_computation=function(){var e;return r.__awaiter(this,void 0,void 0,(function(){var t,n;return r.__generator(this,(function(r){switch(r.label){case 0:return null===(e=this.expression_controller)||void 0===e||!e.active||this.expression_controller.requires_entities?[3,2]:[4,this.expression_controller.compute_expression()];case 1:t=r.sent(),this.expression_controller.is_errored?this.states.error.set("expression error: "+this.expression_controller.error_message):((n=this.convert(t))?this._value=n:this.states.error.set("expression returns an invalid type ("+t+")"),this.remove_dirty_state()),r.label=2;case 2:return[2]}}))}))},t.prototype._value_elements=function(e){return a.ParsedTree.string_value_elements(e)},t}(i.Single);t.StringParam=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(232),i=n(0),a=n(233),s=n(601),_=n(21),u=n(48),c=[{UVMapping:i.UVMapping},{CubeReflectionMapping:i.CubeReflectionMapping},{CubeRefractionMapping:i.CubeRefractionMapping},{EquirectangularReflectionMapping:i.EquirectangularReflectionMapping},{EquirectangularRefractionMapping:i.EquirectangularRefractionMapping},{SphericalReflectionMapping:i.SphericalReflectionMapping},{CubeUVReflectionMapping:i.CubeUVReflectionMapping},{CubeUVRefractionMapping:i.CubeUVRefractionMapping}],p=[{ClampToEdgeWrapping:i.ClampToEdgeWrapping},{RepeatWrapping:i.RepeatWrapping},{MirroredRepeatWrapping:i.MirroredRepeatWrapping}],l=[{LinearFilter:i.LinearFilter},{NearestFilter:i.NearestFilter}],d=[{NearestFilter:i.NearestFilter},{NearestMipMapNearestFilter:i.NearestMipMapNearestFilter},{NearestMipMapLinearFilter:i.NearestMipMapLinearFilter},{LinearFilter:i.LinearFilter},{LinearMipMapNearestFilter:i.LinearMipMapNearestFilter},{LinearMipMapLinearFilter:i.LinearMipMapLinearFilter}],h=["mapping","wrapS","wrapT","minFilter","magFilter"],f={mapping:"mapping",wrapS:"wrap_s",wrapT:"wrap_T",minFilter:"min_filter",magFilter:"mag_filter"},m=n(7),y=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.video_time=m.ParamConfig.FLOAT(1),t.url=m.ParamConfig.STRING(s.CoreTextureLoader.PARAM_DEFAULT,{desktop_browse:{file_type:"texture"}}),t.reload=m.ParamConfig.BUTTON(null,{callback:function(e,t){v.PARAM_CALLBACK_reload(e,t)}}),t.mapping=m.ParamConfig.INTEGER(i.UVMapping,{menu:{entries:c.map((function(e){return{name:Object.keys(e)[0],value:Object.values(e)[0]}}))}}),t.wrap_s=m.ParamConfig.INTEGER(Object.values(p[0])[0],{menu:{entries:p.map((function(e){return{name:Object.keys(e)[0],value:Object.values(e)[0]}}))}}),t.wrap_t=m.ParamConfig.INTEGER(Object.values(p[0])[0],{menu:{entries:p.map((function(e){return{name:Object.keys(e)[0],value:Object.values(e)[0]}}))}}),t.mag_filter=m.ParamConfig.INTEGER(Object.values(l[0])[0],{menu:{entries:l.map((function(e){return{name:Object.keys(e)[0],value:Object.values(e)[0]}}))}}),t.min_filter=m.ParamConfig.INTEGER(Object.values(d[0])[0],{menu:{entries:d.map((function(e){return{name:Object.keys(e)[0],value:Object.values(e)[0]}}))}}),t}return r.__extends(t,e),t}(m.NodeParamsConfig)),v=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=y,t}return r.__extends(t,e),t.type=function(){return"file"},t.prototype.initialize_node=function(){},t.prototype.create_params=function(){},t.prototype.cook=function(){var e;return r.__awaiter(this,void 0,void 0,(function(){var t;return r.__generator(this,(function(n){switch(n.label){case 0:return this._param_url_changed()?[4,this._load_texture(this.pv.url)]:[3,2];case 1:return(t=n.sent())&&(this._texture=t),this._texture&&this._add_video_spare_params_if_required(this._texture),this._previous_param_url=this.pv.url,this._set_video_current_time(),this._update_texture_params(),this._texture?this.set_texture(this._texture):this.cook_controller.end_cook(),[3,3];case 2:this._set_video_current_time(),this._update_texture_params(),(null===(e=this._texture)||void 0===e?void 0:e.needsUpdate)?this.set_texture(this._texture):this.cook_controller.end_cook(),n.label=3;case 3:return[2]}}))}))},t.prototype.resolved_url=function(){return this.pv.url},t.prototype._update_texture_params=function(){for(var e=0,t=h;e<t.length;e++){var n=t[e],r=f[n],o=this.params.float(r);null!=o&&this._texture&&this._texture[n]!=o&&(this._texture[n]=o,this._texture.needsUpdate=!0)}},t.PARAM_CALLBACK_reload=function(e,t){e.param_callback_reload()},t.prototype.param_callback_reload=function(){this._previous_param_url=void 0,this.p.url.set_successors_dirty()},t.prototype._set_video_current_time=function(){this._video&&this.pv.video_time&&(this._video.currentTime=this.pv.video_time)},t.prototype._add_video_spare_params_if_required=function(e){if(e)if(e.constructor==o.VideoTexture){if(this._video=e.image,this._video&&!this.params.has_param(t.VIDEO_TIME_PARAM_NAME)){var n=this._video.duration;this.add_param(_.ParamType.FLOAT,t.VIDEO_TIME_PARAM_NAME,"$T",{spare:!0,cook:!0,range:[0,n],range_locked:[!0,!0]}),this.emit(u.NodeEvent.PARAMS_UPDATED)}}else this._remove_spare_params();else this._remove_spare_params()},t.prototype._remove_spare_params=function(){this.params.has_param(t.VIDEO_TIME_PARAM_NAME)&&(this.params.delete_param(t.VIDEO_TIME_PARAM_NAME),this.emit(u.NodeEvent.PARAMS_UPDATED))},t.prototype._param_url_changed=function(){return this._previous_param_url!=this.pv.url},t.prototype._load_texture=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,n;return r.__generator(this,(function(r){switch(r.label){case 0:return n=this.params.get("url"),e&&n?(this._texture_loader=this._texture_loader||new s.CoreTextureLoader(this,n),[4,this._texture_loader.load_texture_from_url_or_op(e)]):[3,2];case 1:return(t=r.sent())||this.states.error.set("could not load texture "+e),[3,3];case 2:this.states.error.set("not url given to Mat/Base._load_texture"),r.label=3;case 3:return[2,t]}}))}))},t.VIDEO_TIME_PARAM_NAME="video_time",t.DEFAULT_NODE_PATH={UV:"/COP/file_uv",ENV_MAP:"/COP/env_map"},t}(a.TypedCopNode);t.FileCopNode=v},,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(612),o=n(168),i=n(613),a=n(614),s=n(615),_=n(110),u=n(230),c=n(111),p=function(){function e(){}return e.dispatch_node=function(e){return new r.NodeJsonImporter(e)},e.dispatch_param=function(e){return e instanceof _.TypedMultipleParam?new i.ParamMultipleJsonImporter(e):e instanceof u.StringParam?new a.ParamStringJsonImporter(e):e instanceof c.RampParam?new s.ParamRampJsonImporter(e):new o.ParamJsonImporter(e)},e}();t.JsonImportDispatcher=p},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(45),o=n(169),i=function(){function e(e){this._scene=e,this._data={}}return e.prototype.data=function(){this._scene.nodes_controller.reset_node_context_signatures();var e=o.JsonExportDispatcher.dispatch_node(this._scene.root),t=e.data(),n=e.ui_data();return this._data={properties:{frame:this._scene.frame||1,frame_range:this._scene.frame_range,frame_range_locked:this._scene.time_controller.frame_range_locked,fps:this._scene.time_controller.fps,master_camera_node_path:this._scene.cameras_controller.master_camera_node_path},root:t,ui:n},this._data},e.sanitize_string=function(e){return e=e.replace(/'/g,"'"),e=r.CoreString.escape_line_breaks(e)},e}();t.SceneJsonExporter=i},function(e,t,n){"use strict";var r,o,i;Object.defineProperty(t,"__esModule",{value:!0});var a,s,_=n(2),u=n(57),c=_.__importDefault(n(88)),p=n(625),l=n(135),d=n(170),h=n(317);!function(e){e.BASIC="basic",e.LAMBERT="lambert",e.STANDARD="standard",e.POINTS="points",e.LINE="line"}(a=t.ShaderType||(t.ShaderType={})),function(e){e.FUNCTION_DECLARATION="function_declaration",e.DEFINE="define",e.BODY="body"}(s=t.LineType||(t.LineType={})),t.SHADER_TYPES=[a.BASIC,a.LAMBERT,a.STANDARD,a.POINTS],t.MESH_SHADER_TYPES=[a.BASIC,a.LAMBERT,a.STANDARD],t.LINE_TYPES=[s.FUNCTION_DECLARATION,s.DEFINE,s.BODY],t.TEMPLATE_SHADERS_BY_SHADER_TYPE=((r={})[a.BASIC]=u.ShaderLib.basic,r[a.LAMBERT]=u.ShaderLib.lambert,r[a.STANDARD]=u.ShaderLib.standard,r[a.POINTS]=u.ShaderLib.points,r[a.LINE]=u.ShaderLib.dashed,r);var f=((o={})[s.FUNCTION_DECLARATION]="",o[s.DEFINE]=";",o[s.BODY]=";",o),m=((i={})[s.FUNCTION_DECLARATION]="",i[s.DEFINE]="",i[s.BODY]="\t",i),y=function(){function e(e,t){this._assembler=e,this._gl_parent_node=t,this._param_configs=[],this._lines=new Map,this._function_declared=new Map,this._param_configs_set_allowed=!0}return e.prototype.build_from_nodes=function(e){return _.__awaiter(this,void 0,void 0,(function(){var t,n,r,o,i,a,s,u,c,d,h,f,m,y,v,g,b,P,O,C,E,T,x,w,A,j;return _.__generator(this,(function(_){switch(_.label){case 0:for(this.reset(),(t=new p.TypedNodeTraverser(this._assembler,this._gl_parent_node)).traverse(e),n=new Map,r=0,o=this.shader_names();r<o.length;r++)T=o[r],n.set(T,t.nodes_for_shader_name(T));for(i=t.sorted_nodes(),a=function(e){var t=s._assembler.root_nodes_by_shader_name(e),r=s._assembler.leaf_nodes_by_shader_name(e),o=new Map;n.forEach((function(e,t){for(var n=0,r=e;n<r.length;n++){var i=r[n];o.set(i.graph_node_id,!0)}}));for(var i=0,a=t;i<a.length;i++){var _=a[i];o.get(_.graph_node_id)||(l.MapUtils.push_on_array_at_entry(n,e,_),o.set(_.graph_node_id,!0))}for(var u=0,c=r;u<c.length;u++){var p=c[u];o.get(p.graph_node_id)||l.MapUtils.unshift_on_array_at_entry(n,e,p)}},s=this,u=0,c=this.shader_names();u<c.length;u++)T=c[u],a(T);for(d=new Map,h=0,f=i;h<f.length;h++)j=f[h],d.set(j.graph_node_id,!0);for(m=0,y=e;m<y.length;m++)v=y[m],d.get(v.graph_node_id)||(i.push(v),d.set(v.graph_node_id,!0));for(g=0,b=i;g<b.length;g++)(j=b[g]).set_assembler(this._assembler),j.reset_code();P=0,O=i,_.label=1;case 1:return P<O.length?[4,(j=O[P]).params.eval_all()]:[3,4];case 2:_.sent(),_.label=3;case 3:return P++,[3,1];case 4:for(C=0,E=this.shader_names();C<E.length;C++)if(T=E[C],x=n.get(T))for(w=0,A=x;w<A.length;w++)(j=A[w]).set_shader_name(T),this._param_configs_set_allowed&&j.set_param_configs(),j.set_lines();return this._param_configs_set_allowed&&this.set_param_configs(i),this.set_code_lines(i),[2]}}))}))},e.prototype.disallow_new_param_configs=function(){this._param_configs_set_allowed=!1},e.prototype.allow_new_param_configs=function(){this._param_configs_set_allowed=!0},e.prototype.shader_names=function(){return this._assembler.shader_names},e.prototype.reset=function(){for(var e=0,n=this.shader_names();e<n.length;e++){for(var r=n[e],o=new Map,i=0,a=t.LINE_TYPES;i<a.length;i++){var s=a[i];o.set(s,[])}this._lines.set(r,o),this._function_declared.set(r,new Map)}},e.prototype.param_configs=function(){return this._param_configs},e.prototype.lines=function(e,t){return this._lines.get(e).get(t)},e.prototype.all_lines=function(){return this._lines},e.prototype.set_param_configs=function(e){this._param_configs=[];for(var t=0,n=e;t<n.length;t++)for(var r=0,o=n[t].param_configs();r<o.length;r++){var i=o[r];this._param_configs.push(i)}},e.prototype.set_code_lines=function(e){for(var t=0,n=this.shader_names();t<n.length;t++){var r=n[t];this.add_code_lines(e,r)}},e.prototype.add_code_lines=function(e,t){this.add_definitions(e,t,d.GLDefinitionType.FUNCTION,s.FUNCTION_DECLARATION),this.add_definitions(e,t,d.GLDefinitionType.UNIFORM,s.DEFINE),this.add_definitions(e,t,d.GLDefinitionType.VARYING,s.DEFINE),this.add_definitions(e,t,d.GLDefinitionType.ATTRIBUTE,s.DEFINE),this.add_code_line_for_nodes_and_line_type(e,t,s.BODY)},e.prototype.add_definitions=function(e,t,n,r){for(var o=this,i=[],a=0,s=e;a<s.length;a++){var _=s[a].definitions(t);if(_)for(var u=0,c=_=_.filter((function(e){return e.definition_type==n}));u<c.length;u++){var p=c[u];i.push(p)}}if(i.length>0){var d=new h.TypedGLDefinitionCollection(i),f=d.uniq();if(d.errored)throw"code builder error: "+d.error_message;for(var m=new Map,y=new Map,v=0,g=f;v<g.length;v++){var b=(p=g[v]).node.graph_node_id;y.has(b)||y.set(b,!0),l.MapUtils.push_on_array_at_entry(m,b,p)}var P=this._lines.get(t);y.forEach((function(e,t){var n=m.get(t);if(n){var i=n[0];if(i){var a=o.node_comment(i.node,r);l.MapUtils.push_on_array_at_entry(P,r,a);for(var s=0,_=n;s<_.length;s++){var u=_[s],c=o.line_wrap(u.line,r);l.MapUtils.push_on_array_at_entry(P,r,c)}var p=o.post_line_separator(r);l.MapUtils.push_on_array_at_entry(P,r,p)}}})),f.length}},e.prototype.add_code_line_for_nodes_and_line_type=function(e,t,n){for(var r=(e=e.filter((function(e){var r=e.lines(t,n);return r&&r.length>0}))).length,o=0;o<r;o++){var i=o==e.length-1;this.add_code_line_for_node_and_line_type(e[o],t,n,i)}},e.prototype.add_code_line_for_node_and_line_type=function(e,t,n,r){var o=this,i=e.lines(t,n),a=this._lines.get(t);if(i&&i.length>0){var _=this.node_comment(e,n);if(l.MapUtils.push_on_array_at_entry(a,n,_),c.default(i).forEach((function(e){e=o.line_wrap(e,n),l.MapUtils.push_on_array_at_entry(a,n,e)})),n!=s.BODY||!r){var u=this.post_line_separator(n);l.MapUtils.push_on_array_at_entry(a,n,u)}return!0}return!1},e.prototype.node_comment=function(e,t){var n="// "+e.full_path();return t==s.BODY&&(n="\t"+n),n},e.prototype.line_wrap=function(e,t){var n=!0;return 0!=e.indexOf("#if")&&0!=e.indexOf("#endif")||(n=!1),n?""+m[t]+e+f[t]:""+m[t]+e},e.prototype.post_line_separator=function(e){return e==s.BODY?"\t":""},e}();t.CodeBuilder=y},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(332),i=n(56),a=n(23),s=n(32),_=function(){function e(e){this.node=e,this._bg_raycaster=new o.Raycaster}return Object.defineProperty(e.prototype,"screen_quad",{get:function(){return this._screen_quad=this._screen_quad||this._create_screen_quad()},enumerable:!0,configurable:!0}),e.prototype._create_screen_quad=function(){var e=new i.PlaneBufferGeometry(2,2,1,1),t=new a.Mesh(e);return this.node.object.add(t),t},e.prototype.screen_quad_flat_material=function(){return this._screen_quad_flat_material=this._screen_quad_flat_material||new s.MeshBasicMaterial},e.prototype.add_params=function(){},Object.defineProperty(e.prototype,"use_background",{get:function(){return this.node.params.boolean("use_background")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"use_background_material",{get:function(){return this.use_background&&this.node.params.boolean("use_material")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"use_background_color",{get:function(){return this.use_background&&!this.node.params.boolean("use_material")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"background_color",{get:function(){return this.use_background_color?this.node.params.color("background_color"):null},enumerable:!0,configurable:!0}),e.prototype.update_screen_quad=function(){},e.prototype.update=function(){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(e){switch(e.label){case 0:return this.use_background?(this.update_screen_quad(),[4,this.update_background_color()]):[3,4];case 1:return e.sent(),this.use_background_material?[4,this.update_background_material()]:[3,3];case 2:e.sent(),e.label=3;case 3:return[3,5];case 4:this._screen_quad&&this.node.object.remove(this._screen_quad),e.label=5;case 5:return[2]}}))}))},e.prototype.update_background_color=function(){return r.__awaiter(this,void 0,void 0,(function(){var e;return r.__generator(this,(function(t){return(e=this.screen_quad_flat_material()).color=this.node.pv.background_color,this.screen_quad.material=e,[2]}))}))},e.prototype.update_background_material=function(){return r.__awaiter(this,void 0,void 0,(function(){var e,t;return r.__generator(this,(function(n){switch(n.label){case 0:return(e=this.node.p.background_material.found_node())?[4,e.request_container()]:[3,2];case 1:return n.sent(),t=e.material,this.screen_quad.material=t,[3,3];case 2:this.node.states.error.set("bg node not found"),n.label=3;case 3:return[2]}}))}))},e}();t.BaseBackgroundController=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(1),i=n(3),a=n(6),s=n(46),_=n(98),u=n(27),c=n(337),p=n(45),l=r.__importDefault(n(226)),d=r.__importDefault(n(38)),h=r.__importDefault(n(20)),f=r.__importDefault(n(39)),m=n(336),y=function(e){function t(t,n){var r=e.call(this,n)||this;return r._object=t,null==r._object.userData.attributes&&(r._object.userData.attributes={}),r}return r.__extends(t,e),t.prototype.object=function(){return this._object},t.prototype.geometry=function(){return this._object.geometry},t.prototype.core_geometry=function(){var e=this.geometry();return new s.CoreGeometry(e)},t.prototype.points=function(){return this.core_geometry().points()},t.prototype.points_from_group=function(e){if(e){var t=p.CoreString.indices(e);if(t){var n=this.points();return t.map((function(e){return n[e]}))}return[]}return this.points()},t.prototype.compute_vertex_normals=function(){this.core_geometry().compute_vertex_normals()},t.prototype.add_attribute=function(e,t){var n;n=f.default(t)||h.default(t)||d.default(t)?t:t.toArray(),this._object.userData.attributes[e]=n},t.prototype.add_numeric_attrib=function(e,t){this.add_attribute(e,t)},t.prototype.set_attrib_value=function(e,t){this.add_attribute(e,t)},t.prototype.add_numeric_vertex_attrib=function(e,t,n){null==n&&(n=_.CoreAttribute.default_value(t)),this.core_geometry().add_numeric_attrib(e,t,n)},t.prototype.attribute_names=function(){return Object.keys(this._object.userData.attributes)},t.prototype.attrib_names=function(){return this.attribute_names()},t.prototype.has_attrib=function(e){return this.attribute_names().includes(e)},t.prototype.rename_attribute=function(e,t){this.add_attribute(t,this.attrib_value(e)),this.delete_attribute(e)},t.prototype.delete_attribute=function(e){delete this._object.userData.attributes[e]},t.prototype.attrib_value=function(e){if("ptnum"===e)return this.index;var t=this._object.userData.attributes[e];return null==t&&"name"==e&&(t=this._object.name),t},t.prototype.name=function(){return this.attrib_value("name")},t.prototype.human_type=function(){return u.CoreConstant.CONSTRUCTOR_NAMES_BY_CONSTRUCTOR_NAME[this._object.constructor.name]},t.prototype.attrib_type=function(e){var t=this.attrib_value(e);return d.default(t)?u.CoreConstant.ATTRIB_TYPE.STRING:u.CoreConstant.ATTRIB_TYPE.NUMERIC},t.prototype.attrib_size=function(e){var t=this.attrib_value(e);if(null==t)return 0;if(d.default(t)||f.default(t))return 1;switch(t.constructor){case i.Vector2:return 2;case o.Vector3:return 3;default:return 0}},t.prototype.clone=function(){return t.clone(this._object)},t.clone=function(e){var n=e.clone(),r=new Map,o=new Map;return t.parallelTraverse(e,n,(function(e,t){r.set(t,e),o.set(e,t)})),n.traverse((function(t){var n=r.get(t),i=t;if(i.geometry){var _=n.geometry;i.geometry=s.CoreGeometry.clone(_);var u=i.geometry;u.userData&&(u.userData=l.default(_.userData))}if(i.material){i.material=n.material,c.CoreMaterial.apply_custom_materials(t,i.material);var p=i.material;null==p.color&&(p.color=new a.Color(1,1,1))}e.userData&&(t.userData=l.default(n.userData));var d=n;d.animations&&(t.animations=d.animations.map((function(e){return e.clone()})));var h=t;if(h.isSkinnedMesh){var f=h,m=n,y=m.skeleton.bones;f.skeleton=m.skeleton.clone(),f.bindMatrix.copy(m.bindMatrix);var v=y.map((function(e){return o.get(e)}));f.skeleton.bones=v,f.bind(f.skeleton,f.bindMatrix)}})),n},t.parallelTraverse=function(e,t,n){n(e,t);for(var r=0;r<e.children.length;r++)this.parallelTraverse(e.children[r],t.children[r],n)},t}(m.CoreEntity);t.CoreObject=y},function(e,t,n){"use strict";n.r(t),n.d(t,"BufferGeometryUtils",(function(){return c}));var r=n(4),o=n(5),i=n(118),a=n(80),s=n(0),_=n(3),u=n(1),c={computeTangents:function(e){var t=e.index,n=e.attributes;if(null!==t&&void 0!==n.position&&void 0!==n.normal&&void 0!==n.uv){var o=t.array,i=n.position.array,a=n.normal.array,s=n.uv.array,c=i.length/3;void 0===n.tangent&&e.setAttribute("tangent",new r.BufferAttribute(new Float32Array(4*c),4));for(var p=n.tangent.array,l=[],d=[],h=0;h<c;h++)l[h]=new u.Vector3,d[h]=new u.Vector3;var f=new u.Vector3,m=new u.Vector3,y=new u.Vector3,v=new _.Vector2,g=new _.Vector2,b=new _.Vector2,P=new u.Vector3,O=new u.Vector3,C=e.groups;0===C.length&&(C=[{start:0,count:o.length}]);h=0;for(var E=C.length;h<E;++h)for(var T=L=(k=C[h]).start,x=L+k.count;T<x;T+=3)D(o[T+0],o[T+1],o[T+2]);var w,A,j,M=new u.Vector3,N=new u.Vector3,S=new u.Vector3,R=new u.Vector3;for(h=0,E=C.length;h<E;++h){var k,L;for(T=L=(k=C[h]).start,x=L+k.count;T<x;T+=3)I(o[T+0]),I(o[T+1]),I(o[T+2])}}else console.warn("THREE.BufferGeometry: Missing required attributes (index, position, normal or uv) in BufferGeometry.computeTangents()");function D(e,t,n){f.fromArray(i,3*e),m.fromArray(i,3*t),y.fromArray(i,3*n),v.fromArray(s,2*e),g.fromArray(s,2*t),b.fromArray(s,2*n),m.sub(f),y.sub(f),g.sub(v),b.sub(v);var r=1/(g.x*b.y-b.x*g.y);isFinite(r)&&(P.copy(m).multiplyScalar(b.y).addScaledVector(y,-g.y).multiplyScalar(r),O.copy(y).multiplyScalar(g.x).addScaledVector(m,-b.x).multiplyScalar(r),l[e].add(P),l[t].add(P),l[n].add(P),d[e].add(O),d[t].add(O),d[n].add(O))}function I(e){S.fromArray(a,3*e),R.copy(S),A=l[e],M.copy(A),M.sub(S.multiplyScalar(S.dot(A))).normalize(),N.crossVectors(R,A),j=N.dot(d[e]),w=j<0?-1:1,p[4*e]=M.x,p[4*e+1]=M.y,p[4*e+2]=M.z,p[4*e+3]=w}},mergeBufferGeometries:function(e,t){for(var n=null!==e[0].index,r=new Set(Object.keys(e[0].attributes)),i=new Set(Object.keys(e[0].morphAttributes)),a={},s={},_=e[0].morphTargetsRelative,u=new o.BufferGeometry,c=0,p=0;p<e.length;++p){var l=e[p];if(n!==(null!==l.index))return null;for(var d in l.attributes){if(!r.has(d))return null;void 0===a[d]&&(a[d]=[]),a[d].push(l.attributes[d])}if(_!==l.morphTargetsRelative)return null;for(var d in l.morphAttributes){if(!i.has(d))return null;void 0===s[d]&&(s[d]=[]),s[d].push(l.morphAttributes[d])}if(u.userData.mergedUserData=u.userData.mergedUserData||[],u.userData.mergedUserData.push(l.userData),t){var h;if(n)h=l.index.count;else{if(void 0===l.attributes.position)return null;h=l.attributes.position.count}u.addGroup(c,h,p),c+=h}}if(n){var f=0,m=[];for(p=0;p<e.length;++p){for(var y=e[p].index,v=0;v<y.count;++v)m.push(y.getX(v)+f);f+=e[p].attributes.position.count}u.setIndex(m)}for(var d in a){var g=this.mergeBufferAttributes(a[d]);if(!g)return null;u.setAttribute(d,g)}for(var d in s){var b=s[d][0].length;if(0===b)break;u.morphAttributes=u.morphAttributes||{},u.morphAttributes[d]=[];for(p=0;p<b;++p){var P=[];for(v=0;v<s[d].length;++v)P.push(s[d][v][p]);var O=this.mergeBufferAttributes(P);if(!O)return null;u.morphAttributes[d].push(O)}}return u},mergeBufferAttributes:function(e){for(var t,n,o,i=0,a=0;a<e.length;++a){var s=e[a];if(s.isInterleavedBufferAttribute)return null;if(void 0===t&&(t=s.array.constructor),t!==s.array.constructor)return null;if(void 0===n&&(n=s.itemSize),n!==s.itemSize)return null;if(void 0===o&&(o=s.normalized),o!==s.normalized)return null;i+=s.array.length}var _=new t(i),u=0;for(a=0;a<e.length;++a)_.set(e[a].array,u),u+=e[a].array.length;return new r.BufferAttribute(_,n,o)},interleaveAttributes:function(e){for(var t,n=0,r=0,o=0,s=e.length;o<s;++o){var _=e[o];if(void 0===t&&(t=_.array.constructor),t!==_.array.constructor)return console.warn("AttributeBuffers of different types cannot be interleaved"),null;n+=_.array.length,r+=_.itemSize}var u=new i.a(new t(n),r),c=0,p=[],l=["getX","getY","getZ","getW"],d=["setX","setY","setZ","setW"],h=0;for(s=e.length;h<s;h++){var f=(_=e[h]).itemSize,m=_.count,y=new a.InterleavedBufferAttribute(u,f,c,_.normalized);p.push(y),c+=f;for(var v=0;v<m;v++)for(var g=0;g<f;g++)y[d[g]](v,_[l[g]](v))}return p},estimateBytesUsed:function(e){var t=0;for(var n in e.attributes){var r=e.getAttribute(n);t+=r.count*r.itemSize*r.array.BYTES_PER_ELEMENT}var o=e.getIndex();return t+=o?o.count*o.itemSize*o.array.BYTES_PER_ELEMENT:0},mergeVertices:function(e,t=1e-4){t=Math.max(t,Number.EPSILON);for(var n={},o=e.getIndex(),i=e.getAttribute("position"),a=o?o.count:i.count,s=0,_=Object.keys(e.attributes),u={},c={},p=[],l=["getX","getY","getZ","getW"],d=0,h=_.length;d<h;d++){u[b=_[d]]=[],(E=e.morphAttributes[b])&&(c[b]=new Array(E.length).fill().map(()=>[]))}var f=Math.log10(1/t),m=Math.pow(10,f);for(d=0;d<a;d++){var y=o?o.getX(d):d,v="",g=0;for(h=_.length;g<h;g++)for(var b=_[g],P=(C=e.getAttribute(b)).itemSize,O=0;O<P;O++)v+=`${~~(C[l[O]](y)*m)},`;if(v in n)p.push(n[v]);else{for(g=0,h=_.length;g<h;g++){b=_[g];var C=e.getAttribute(b),E=e.morphAttributes[b],T=(P=C.itemSize,u[b]),x=c[b];for(O=0;O<P;O++){var w=l[O];if(T.push(C[w](y)),E)for(var A=0,j=E.length;A<j;A++)x[A].push(E[A][w](y))}}n[v]=s,p.push(s),s++}}const M=e.clone();for(d=0,h=_.length;d<h;d++){b=_[d];var N=e.getAttribute(b),S=new N.array.constructor(u[b]);C=new r.BufferAttribute(S,N.itemSize,N.normalized);if(M.setAttribute(b,C),b in c)for(g=0;g<c[b].length;g++){var R=e.morphAttributes[b][g],k=(S=new R.array.constructor(c[b][g]),new r.BufferAttribute(S,R.itemSize,R.normalized));M.morphAttributes[b][g]=k}}return M.setIndex(p),M},toTrianglesDrawMode:function(e,t){if(t===s.TrianglesDrawMode)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),e;if(t===s.TriangleFanDrawMode||t===s.TriangleStripDrawMode){var n=e.getIndex();if(null===n){var r=[],o=e.getAttribute("position");if(void 0===o)return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),e;for(var i=0;i<o.count;i++)r.push(i);e.setIndex(r),n=e.getIndex()}var a=n.count-2,_=[];if(t===s.TriangleFanDrawMode)for(i=1;i<=a;i++)_.push(n.getX(0)),_.push(n.getX(i)),_.push(n.getX(i+1));else for(i=0;i<a;i++)i%2==0?(_.push(n.getX(i)),_.push(n.getX(i+1)),_.push(n.getX(i+2))):(_.push(n.getX(i+2)),_.push(n.getX(i+1)),_.push(n.getX(i)));_.length/3!==a&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");var u=e.clone();return u.setIndex(_),u.clearGroups(),u}return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",t),e}}},,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(46),o=n(4),i=n(5),a=function(){function e(){}return e.accumulated_curve_point_indices=function(e){for(var t,n=[],r=[],o=null,i=0;i<e.length;i++)if(i%2==1){t=e[i];var a=e[i-1];null==o||a===o?(0===n.length&&n.push(a),n.push(t),o=t):(r.push(n),n=[a,t],o=t)}return r.push(n),r},e.create_line_segment_geometry=function(e,t,n,r){var a=[],s={};n.forEach((function(e){s[e]=[]})),t.forEach((function(t,o){var i=e[t];n.forEach((function(e){var t=i.attrib_value(e);(t=r[e]>1?t.toArray():[t]).forEach((function(t){s[e].push(t)}))})),o>0&&(a.push(o-1),a.push(o))}));var _=new i.BufferGeometry;return n.forEach((function(e){var t=r[e],n=s[e];_.setAttribute(e,new o.Float32BufferAttribute(n,t))})),_.setIndex(a),_},e.line_segment_to_geometries=function(e){var t,n=this,o=[],i=new r.CoreGeometry(e),a=i.attrib_names(),s=i.points(),_=(null===(t=e.getIndex())||void 0===t?void 0:t.array)||[],u=this.accumulated_curve_point_indices(_);if(console.log(_,u),u.length>0){var c=i.attrib_sizes();u.forEach((function(t,r){e=n.create_line_segment_geometry(s,t,a,c),o.push(e)}))}return o},e}();t.CoreGeometryUtilCurve=a},function(e,t){},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=function(e){function t(){return e.call(this)||this}return r.__extends(t,e),t}(n(161).CoreObject);t.default=o},,,,,,,,,function(e,t,n){"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0});var o=n(2),i=n(61),a=n(550),s=n(572),_=n(573),u=n(311),c=n(574),p=n(312),l=n(111),d=n(576),h=n(230),f=n(577),m=n(578),y=n(579),v=n(21),g=n(227);t.ParamConstructorByType=((r={})[v.ParamType.BOOLEAN]=a.BooleanParam,r[v.ParamType.BUTTON]=s.ButtonParam,r[v.ParamType.COLOR]=_.ColorParam,r[v.ParamType.FLOAT]=u.FloatParam,r[v.ParamType.INTEGER]=c.IntegerParam,r[v.ParamType.OPERATOR_PATH]=p.OperatorPathParam,r[v.ParamType.RAMP]=l.RampParam,r[v.ParamType.SEPARATOR]=d.SeparatorParam,r[v.ParamType.STRING]=h.StringParam,r[v.ParamType.VECTOR2]=f.Vector2Param,r[v.ParamType.VECTOR3]=m.Vector3Param,r[v.ParamType.VECTOR4]=y.Vector4Param,r);var b=function(){function e(e){this.node=e,this._param_create_mode=!1,this._params_by_name={},this._params_list=[],this._param_names=[],this._non_spare_params=[],this._spare_params=[],this._non_spare_param_names=[],this._spare_param_names=[],this._params_added_since_last_params_eval=!1}return e.prototype.init_dependency_node=function(){this._params_node||(this._params_node=new i.CoreGraphNode(this.node.scene,"params"),this.node.add_graph_input(this._params_node))},e.prototype.init=function(){this.init_dependency_node(),this._param_create_mode=!0,this.init_from_params_config(),this.node.create_params(),this._update_caches(),this._create_params_ui_data_dependencies(),this.init_param_accessors(),this._param_create_mode=!1},e.prototype.init_from_params_config=function(){var e=this.node.params_config;if(e)for(var t=0,n=Object.keys(e);t<n.length;t++){var r=n[t],o=e[r];this.add_param(o.type,r,o.init_value,o.options)}},e.prototype.init_param_accessors=function(){for(var e=function(e){Object.defineProperty(t.node.pv,e.name,{get:function(){return e.value}}),Object.defineProperty(t.node.p,e.name,{get:function(){return e}})},t=this,n=0,r=this.all;n<r.length;n++){e(r[n])}},Object.defineProperty(e.prototype,"params_node",{get:function(){return this._params_node},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"all",{get:function(){return this._params_list},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"non_spare",{get:function(){return this._non_spare_params},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"spare",{get:function(){return this._spare_params},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"names",{get:function(){return this._param_names},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"non_spare_names",{get:function(){return this._non_spare_param_names},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"spare_names",{get:function(){return this._spare_param_names},enumerable:!0,configurable:!0}),e.prototype.set_with_type=function(e,t,n){var r=this.param_with_type(e,n);r?r.set(t):console.warn("param "+e+" not found with type "+n)},e.prototype.set_float=function(e,t){this.set_with_type(e,t,v.ParamType.FLOAT)},e.prototype.set_vector3=function(e,t){this.set_with_type(e,t,v.ParamType.VECTOR3)},e.prototype.has_param=function(e){return null!=this._params_by_name[e]},e.prototype.has=function(e){return this.has_param(e)},e.prototype.get=function(e){return this.param(e)},e.prototype.param_with_type=function(e,t){var n=this.param(e);if(n&&n.type==t)return n},e.prototype.get_float=function(e){return this.param_with_type(e,v.ParamType.FLOAT)},e.prototype.get_operator_path=function(e){return this.param_with_type(e,v.ParamType.OPERATOR_PATH)},e.prototype.value=function(e){var t;return null===(t=this.param(e))||void 0===t?void 0:t.value},e.prototype.value_with_type=function(e,t){var n;return null===(n=this.param_with_type(e,t))||void 0===n?void 0:n.value},e.prototype.boolean=function(e){return this.value_with_type(e,v.ParamType.BOOLEAN)},e.prototype.float=function(e){return this.value_with_type(e,v.ParamType.FLOAT)},e.prototype.integer=function(e){return this.value_with_type(e,v.ParamType.INTEGER)},e.prototype.string=function(e){return this.value_with_type(e,v.ParamType.STRING)},e.prototype.vector2=function(e){return this.value_with_type(e,v.ParamType.VECTOR2)},e.prototype.vector3=function(e){return this.value_with_type(e,v.ParamType.VECTOR3)},e.prototype.color=function(e){return this.value_with_type(e,v.ParamType.COLOR)},e.prototype.param=function(e){var t=this._params_by_name[e];return null!=t?t:(console.warn("tried to access param '"+e+"' in node "+this.node.full_path()+", but existing params are: "+this.names),null)},e.prototype.delete_params=function(e){for(var t=0,n=e;t<n.length;t++){var r=n[t];this.delete_param(r)}this._update_caches()},e.prototype.delete_param=function(e){var t=this._params_by_name[e];if(!t)throw new Error("param '"+e+"' does not exist on node "+this.node.full_path());if(this._params_node&&this._params_node.remove_graph_input(this._params_by_name[e]),t.set_node(null),delete this._params_by_name[e],t.is_multiple&&t.components)for(var n=0,r=t.components;n<r.length;n++){var o=r[n].name;delete this._params_by_name[o]}t.emit(g.ParamEvent.DELETED)},e.prototype.add_param=function(e,n,r,o){void 0===o&&(o={});var i=o.spare||!1;!1!==this._param_create_mode||i||console.warn("node "+this.node.full_path()+" ("+this.node.type+") param '"+n+"' cannot be created outside of create_params"),null==this.node.scene&&console.warn("node "+this.node.full_path()+" ("+this.node.type+") has no scene assigned");var a=t.ParamConstructorByType[e];if(null!=a){var s=this._params_by_name[n];s&&(i?s.type!=e&&this.delete_param(s.name):console.warn("a param named "+n+" already exists",this.node));var _=new a(this.node.scene);return _.options.set(o),_.set_name(n),_.set_init_value(r),_.ui_data.set_folder_name(this.current_param_folder_name()),this._params_by_name[_.name]=_,_.set_node(this.node),this._params_added_since_last_params_eval=!0,_}},e.prototype._update_caches=function(){this._params_list=Object.values(this._params_by_name),this._param_names=Object.keys(this._params_by_name),this._non_spare_params=Object.values(this._params_by_name).filter((function(e){return!e.options.is_spare})),this._spare_params=Object.values(this._params_by_name).filter((function(e){return e.options.is_spare})),this._non_spare_param_names=Object.values(this._params_by_name).filter((function(e){return!e.options.is_spare})).map((function(e){return e.name})),this._spare_param_names=Object.values(this._params_by_name).filter((function(e){return e.options.is_spare})).map((function(e){return e.name}))},e.prototype._eval_param=function(e){return o.__awaiter(this,void 0,void 0,(function(){return o.__generator(this,(function(t){switch(t.label){case 0:return e.is_dirty?[4,e.compute()]:[3,2];case 1:return t.sent(),e.states.error.active&&this.node.states.error.set("param '"+e.name+"' error: "+e.states.error.message),[3,2];case 2:return[2]}}))}))},e.prototype.eval_params=function(e){return o.__awaiter(this,void 0,void 0,(function(){var t,n;return o.__generator(this,(function(r){switch(r.label){case 0:for(t=[],n=0;n<e.length;n++)t.push(this._eval_param(e[n]));return[4,Promise.all(t)];case 1:return r.sent(),this.node.states.error.active&&this.node.set_container(null),[2]}}))}))},e.prototype.eval_all=function(){return o.__awaiter(this,void 0,void 0,(function(){return o.__generator(this,(function(e){switch(e.label){case 0:return this._params_node&&(this._params_node.is_dirty||this._params_added_since_last_params_eval)?[4,this.eval_params(this._params_list)]:[3,2];case 1:e.sent(),this._params_node.remove_dirty_state(),this._params_added_since_last_params_eval=!1,e.label=2;case 2:return[2]}}))}))},e.prototype._create_params_ui_data_dependencies=function(){this._params_list.filter((function(e){return e.options.ui_data_depends_on_other_params()})).forEach((function(e){e.options.set_ui_data_dependency()}))},e.prototype.within_param_folder=function(e,t){var n=this._current_param_folder_name;this._current_param_folder_name=e,t(),this._current_param_folder_name=n},e.prototype.current_param_folder_name=function(){return this._current_param_folder_name},e}();t.ParamsController=b},,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(551),i=function(){function e(e){this.param=e}return Object.defineProperty(e.prototype,"active",{get:function(){return null!=this._expression},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"expression",{get:function(){return this._expression},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"is_errored",{get:function(){return!!this._manager&&this._manager.is_errored},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"error_message",{get:function(){return this._manager?this._manager.error_message:null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"requires_entities",{get:function(){return this.param.options.is_expression_for_entities},enumerable:!0,configurable:!0}),e.prototype.set_expression=function(e,t){void 0===t&&(t=!0),this._expression!=e&&(this._expression=e,this._expression?(this._manager=this._manager||new o.ExpressionManager(this.param),this._manager.parse_expression(this._expression)):this._manager&&this._manager.reset(),t&&this.param.set_dirty())},e.prototype.update_from_method_dependency_name_change=function(){},e.prototype.compute_expression=function(){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(e){return this._manager&&this.active?[2,this._manager.compute_function()]:[2]}))}))},e.prototype.compute_expression_for_entities=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(n){switch(n.label){case 0:return this.set_entities(e,t),[4,this.compute_expression()];case 1:return n.sent(),this.reset_entities(),[2]}}))}))},e.prototype.compute_expression_for_points=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(n){return this.compute_expression_for_entities(e,t),[2]}))}))},e.prototype.compute_expression_for_objects=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(n){return this.compute_expression_for_entities(e,t),[2]}))}))},Object.defineProperty(e.prototype,"entities",{get:function(){return this._entities},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"entity_callback",{get:function(){return this._entity_callback},enumerable:!0,configurable:!0}),e.prototype.set_entities=function(e,t){this._entities=e,this._entity_callback=t},e.prototype.reset_entities=function(){this._entities=void 0,this._entity_callback=void 0},e}();t.ExpressionController=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=r.__importDefault(n(38)),i=r.__importDefault(n(552));i.default.addUnaryOp("@");i.default.addBinaryOp("**",10);var a=function(){function e(){}return e.prototype.parse_expression=function(e){try{this.reset(),this.node=i.default(e)}catch(n){var t="could not parse the expression '"+e+"' (error: "+n+")";this.error_message=t}},e.prototype.parse_expression_for_string_param=function(t){try{this.reset();for(var n=e.string_value_elements(t),r=[],o=0;o<n.length;o++){var a=n[o],s=void 0;s=o%2==1?i.default(a):{type:"Literal",value:"'"+a+"'",raw:"'"+a+"'"},r.push(s)}this.node={type:"CallExpression",arguments:r,callee:{type:"Identifier",name:"str_concat"}}}catch(e){var _="could not parse the expression '"+t+"' (error: "+e+")";this.error_message=_}},e.string_value_elements=function(e){return null!=e&&o.default(e)?e.split("`"):[]},e.prototype.reset=function(){this.node=void 0,this.error_message=void 0},e}();t.ParsedTree=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(e){return function(t){return Math.pow(t,e)}},o=function(e){return function(t){return 1-Math.abs(Math.pow(t-1,e))}},i=function(e){return function(t){return t<.5?r(e)(2*t)/2:o(e)(2*t-1)/2+.5}};t.Easing={linear:i(1),ease_i:function(e,t){return r(t)(e)},ease_o:function(e,t){return o(t)(e)},ease_io:function(e,t){return i(t)(e)},ease_i2:r(2),ease_o2:o(2),ease_io2:i(2),ease_i3:i(3),ease_o3:i(3),ease_io3:i(3),ease_i4:i(4),ease_o4:i(4),ease_io4:i(4),ease_i_sin:function(e){return 1+Math.sin(Math.PI/2*e-Math.PI/2)},ease_o_sin:function(e){return Math.sin(Math.PI/2*e)},ease_io_sin:function(e){return(1+Math.sin(Math.PI*e-Math.PI/2))/2},ease_i_elastic:function(e){return(.04-.04/e)*Math.sin(25*e)+1},ease_o_elastic:function(e){return.04*e/--e*Math.sin(25*e)},ease_io_elastic:function(e){return(e-=.5)<0?(.02+.01/e)*Math.sin(50*e):(.02-.01/e)*Math.sin(50*e)+1}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=r.__importDefault(n(39)),i=n(166),a=n(21),s=n(45),_=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.type=function(){return a.ParamType.FLOAT},Object.defineProperty(t.prototype,"default_value_serialized",{get:function(){return this.default_value},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"value_serialized",{get:function(){return this.value},enumerable:!0,configurable:!0}),t.are_values_equal=function(e,t){return e==t},t.convert=function(e){if(o.default(e))return e;if(s.CoreString.is_number(e)){var t=parseFloat(e);if(o.default(t))return t}return null},t.prototype.convert=function(e){return t.convert(e)},t}(i.TypedNumericParam);t.FloatParam=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(109),i=n(86),a=n(21),s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._found_node=null,t}return r.__extends(t,e),t.type=function(){return a.ParamType.OPERATOR_PATH},Object.defineProperty(t.prototype,"default_value_serialized",{get:function(){return this.default_value},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"value_serialized",{get:function(){return this.value},enumerable:!0,configurable:!0}),t.are_values_equal=function(e,t){return e==t},t.prototype.set=function(e){this._value=e},t.prototype.process_computation=function(){var e;return r.__awaiter(this,void 0,void 0,(function(){var t,n,o,a,s;return r.__generator(this,(function(r){return t=this._value,n=null,null!=t&&""!==t&&(n=i.CoreWalker.find_node(this.node,t)),this._found_node!==n&&(o=this.options.dependent_on_found_node(),this._found_node&&o&&this.remove_graph_input(this._found_node),this._found_node=n,n&&(a=this.options.node_selection_context,s=null===(e=n.parent)||void 0===e?void 0:e.children_controller.context,a==s||null==a?o&&this.add_graph_input(n):this.states.error.set("node context is "+a+" but the params expects a "+s))),[2]}))}))},t.prototype.found_node=function(){return this._found_node},t}(o.Single);t.OperatorPathParam=s},,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){void 0===e&&(e=[]),this._definitions=e,this._errored=!1}return Object.defineProperty(e.prototype,"errored",{get:function(){return this._errored},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"error_message",{get:function(){return this._error_message},enumerable:!0,configurable:!0}),e.prototype.uniq=function(){for(var e=new Map,t=[],n=0,r=this._definitions;n<r.length;n++){var o=r[n];if(!this._errored){var i=o.name,a=e.get(i);a?a.data_type!=o.data_type&&(this._errored=!0,this._error_message="attempt to create "+o.name+" with types "+o.data_type,console.warn("emitting error message",this._error_message)):(e.set(i,o),t.push(i))}}for(var s=[],_=0,u=t;_<u.length;_++){var c=u[_];(o=e.get(c))&&s.push(o)}return s},e}();t.TypedGLDefinitionCollection=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t,n){this._name=e,this._input_names=t,this._dependencies=n}return e.prototype.name=function(){return this._name},e.prototype.input_names=function(){return this._input_names},e.prototype.dependencies=function(){return this._dependencies},e}();t.ShaderConfig=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){void 0===t&&(t={}),this._name=e,this._options=t}return e.prototype.name=function(){return this._name},e.prototype.default_from_attribute=function(){return this._options.default_from_attribute||!1},e.prototype.default=function(){return this._options.default},e.prototype.if_condition=function(){return this._options.if},e.prototype.prefix=function(){return this._options.prefix||""},e.prototype.suffix=function(){return this._options.suffix||""},e}();t.VariableConfig=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(626),i=n(321),a=n(170),s=n(135),_=n(136),u={position:"vec3( position )"},c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.handle_globals_node=function(e,t,n,r,o,i,s){var _=e.io.outputs.named_output_connection_points_by_name(t);if(_){var u=e.gl_var_name(t),c=_.type,p=new a.VaryingGLDefinition(e,c,u);n.get(s).push(p);for(var l=u+" = "+c+"("+t+")",d=0,h=i;d<h.length;d++){var f=h[d];n.get(f).push(p),r.get(f).push(l)}0==i.length&&o.push(l)}},t.variable_config_default=function(e){return u[e]},t.prototype.variable_config_default=function(e){return t.variable_config_default(e)},t.read_attribute=function(e,n,r,o){switch(t.PRE_DEFINED_ATTRIBUTES.indexOf(r)<0&&e.add_definitions([new a.AttributeGLDefinition(e,n,r)],_.ShaderName.VERTEX),o){case _.ShaderName.VERTEX:return r;case _.ShaderName.FRAGMENT:if(!(e instanceof i.AttributeGlNode))return;var u="varying_"+e.gl_var_name(e.output_name),c=new a.VaryingGLDefinition(e,n,u),p=new Map;p.set(_.ShaderName.FRAGMENT,[]);var l=new Map;l.set(_.ShaderName.FRAGMENT,[]),p.get(o).push(c);var d=u+" = "+n+"("+r+")",h=e.shader_config(o);if(h){for(var f=0,m=h.dependencies();f<m.length;f++){var y=m[f];s.MapUtils.push_on_array_at_entry(p,y,c),s.MapUtils.push_on_array_at_entry(l,y,d)}p.forEach((function(t,n){e.add_definitions(t,n)})),l.forEach((function(t,n){e.add_body_lines(t,n)}))}return u}},t.prototype.handle_attribute_node=function(e,n,r,o){return t.read_attribute(e,n,r,o)},t.PRE_DEFINED_ATTRIBUTES=["position","color","normal","uv","uv2","morphTarget0","morphTarget1","morphTarget2","morphTarget3","skinIndex","skinWeight"],t.IF_RULE={uv:"defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )"},t}(o.GlobalsBaseController);t.GlobalsGeometryHandler=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=r.__importDefault(n(163)),i=n(137),a=n(89),s=n(21),_=n(7),u=n(113),c=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name=_.ParamConfig.STRING(""),t.type=_.ParamConfig.INTEGER(0,{menu:{entries:a.ConnectionPointTypes.map((function(e,t){return{name:e,value:t}}))}}),t}return r.__extends(t,e),t}(_.NodeParamsConfig)),p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=c,t}return r.__extends(t,e),t.type=function(){return"attribute"},t.prototype.initialize_node=function(){this.update_input_and_output_types(),this.add_post_dirty_hook(this._update_signature_if_required.bind(this))},t.prototype.create_params=function(){var e;(null===(e=this.material_node)||void 0===e?void 0:e.assembler_controller.allow_attribute_exports())&&this.add_param(s.ParamType.BOOLEAN,"export_when_connected",0)},t.prototype._update_signature_if_required=function(e){var t;e==this.p.type&&(this.update_input_and_output_types(),this.remove_dirty_state(),this.make_output_nodes_dirty()),null===(t=this.material_node)||void 0===t||t.assembler_controller.set_compilation_required_and_dirty()},Object.defineProperty(t.prototype,"input_name",{get:function(){return"input_val"},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"output_name",{get:function(){return"output_val"},enumerable:!0,configurable:!0}),t.prototype.update_input_and_output_types=function(){var e;this.io.inputs.set_named_input_connection_points([new u.TypedNamedConnectionPoint(this.input_name,a.ConnectionPointTypes[this.pv.type])]),(null===(e=this.material_node)||void 0===e?void 0:e.assembler_controller.allow_attribute_exports())&&this.io.outputs.set_named_output_connection_points([new u.TypedNamedConnectionPoint(this.output_name,a.ConnectionPointTypes[this.pv.type])])},t.prototype.set_lines=function(){var e;this._shader_name&&(null===(e=this.material_node)||void 0===e||e.assembler_controller.set_node_lines_attribute(this,this._shader_name))},Object.defineProperty(t.prototype,"attribute_name",{get:function(){return o.default(this.pv.name)},enumerable:!0,configurable:!0}),t.prototype.gl_type=function(){return this.io.outputs.named_output_connection_points[0].type},t.prototype.connected_input_node=function(){return this.io.inputs.named_input("input_val")},t.prototype.connected_input_connection_point=function(){return this.io.inputs.named_input_connection_point("input_val")},t.prototype.output_connection_point=function(){return this.io.outputs.named_output_connection_points_by_name(this.input_name)},Object.defineProperty(t.prototype,"is_importing",{get:function(){return this.io.outputs.used_output_names().length>0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"is_exporting",{get:function(){return!!this.pv.export_when_connected&&null!=this.io.inputs.named_input("input_val")},enumerable:!0,configurable:!0}),t}(i.TypedGlNode);t.AttributeGlNode=p},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(138),i=n(100),a=n(0),s=n(0),_=n(32),u=n(7);function c(e){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.color=u.ParamConfig.COLOR([1,1,1]),t.use_vertex_colors=u.ParamConfig.BOOLEAN(0),t.transparent=u.ParamConfig.BOOLEAN(0),t.opacity=u.ParamConfig.FLOAT(1),t.alpha_test=u.ParamConfig.FLOAT(0),t.use_fog=u.ParamConfig.BOOLEAN(0),t}return r.__extends(t,e),t}(e)}t.ColorParamConfig=c;(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}r.__extends(t,e)})(c(u.NodeParamsConfig)),function(e){function t(){return null!==e&&e.apply(this,arguments)||this}r.__extends(t,e),t.prototype.create_material=function(){return new _.MeshBasicMaterial({})}}(i.TypedMatNode);var p=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.update=function(e){var t=e.material,n=e.pv;t.color.copy(n.color),t.vertexColors=n.use_vertex_colors?a.VertexColors:s.NoColors,t.transparent=n.transparent||n.opacity<1,t.transparent&&(t.depthTest=!0),t.alphaTest=n.alpha_test,t.fog=n.use_fog},t}(o.BaseController);t.ColorsController=p},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(138),i=n(0),a=n(0),s=n(0),_=n(32),u=n(100),c=n(7);function p(e){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.double_sided=c.ParamConfig.BOOLEAN(0),t.front=c.ParamConfig.BOOLEAN(1,{visible_if:{double_sided:!1}}),t}return r.__extends(t,e),t}(e)}t.SideParamConfig=p;(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}r.__extends(t,e)})(p(c.NodeParamsConfig)),function(e){function t(){return null!==e&&e.apply(this,arguments)||this}r.__extends(t,e),t.prototype.create_material=function(){return new _.MeshBasicMaterial({})}}(u.TypedMatNode);var l=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.update=function(e){e.material.side=e.pv.double_sided?a.DoubleSide:e.pv.param_front?i.FrontSide:s.BackSide},t}(o.BaseController);t.SideController=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(138),i=n(32),a=n(7),s=n(100);function _(e){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.skinning=a.ParamConfig.BOOLEAN(0),t}return r.__extends(t,e),t}(e)}t.SkinningParamConfig=_;(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}r.__extends(t,e)})(_(a.NodeParamsConfig)),function(e){function t(){return null!==e&&e.apply(this,arguments)||this}r.__extends(t,e),t.prototype.create_material=function(){return new i.MeshBasicMaterial({})}}(s.TypedMatNode);var u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.update=function(e){e.material.skinning=e.pv.skinning},t}(o.BaseController);t.SkinningController=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(138),i=n(32),a=n(231),s=n(100),_=n(7);function u(e){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.use_map=_.ParamConfig.BOOLEAN(0),t.map=_.ParamConfig.OPERATOR_PATH(a.FileCopNode.DEFAULT_NODE_PATH.UV,{visible_if:{use_map:1}}),t}return r.__extends(t,e),t}(e)}t.TextureMapParamConfig=u;(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}r.__extends(t,e)})(u(_.NodeParamsConfig)),function(e){function t(){return null!==e&&e.apply(this,arguments)||this}r.__extends(t,e),t.prototype.create_material=function(){return new i.MeshBasicMaterial({})}}(s.TypedMatNode);var c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.update=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,n,o;return r.__generator(this,(function(r){switch(r.label){case 0:return t=e.material,e.pv.use_map?(n=e.p.map.found_node())?[4,null==n?void 0:n.request_container()]:[3,2]:[3,4];case 1:return o=r.sent(),t.map=o.texture,[3,3];case 2:t.map=null,e.states.error.set("could not find map"),r.label=3;case 3:return[3,5];case 4:t.map=null,r.label=5;case 5:return[2]}}))}))},t}(o.BaseController);t.TextureMapController=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(138),i=n(32),a=n(231),s=n(100),_=n(7);function u(e){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.use_alpha_map=_.ParamConfig.BOOLEAN(0),t.alpha_map=_.ParamConfig.OPERATOR_PATH(a.FileCopNode.DEFAULT_NODE_PATH.UV,{visible_if:{use_alpha_map:1}}),t}return r.__extends(t,e),t}(e)}t.TextureAlphaMapParamConfig=u;(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}r.__extends(t,e)})(u(_.NodeParamsConfig)),function(e){function t(){return null!==e&&e.apply(this,arguments)||this}r.__extends(t,e),t.prototype.create_material=function(){return new i.MeshBasicMaterial({})}}(s.TypedMatNode);var c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.update=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,n,o;return r.__generator(this,(function(r){switch(r.label){case 0:return t=e.material,e.pv.use_alpha_map?(n=e.p.alpha_map.found_node())?[4,null==n?void 0:n.request_container()]:[3,2]:[3,4];case 1:return o=r.sent(),t.map=o.texture,[3,3];case 2:t.map=null,e.states.error.set("could not find map"),r.label=3;case 3:return[3,5];case 4:t.map=null,r.label=5;case 5:return[2]}}))}))},t}(o.BaseController);t.TextureAlphaMapController=c},function(e,t,n){"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.CHANGE="change",e.MOVEEND="moveend"}(r||(r={}));var o=function(){function e(e){this._callback=e,this._update_always=!0,this._listener_added=!1,this._listener=this._execute_callback.bind(this)}return e.prototype.remove_target=function(){this.set_target(void 0)},e.prototype.set_target=function(e){e||this._remove_camera_event();var t=this._target;this._target=e,null!=this._target&&this._execute_callback(),(null!=this._target?this._target.uuid:void 0)!==(null!=t?t.uuid:void 0)&&this._add_camera_event()},e.prototype.set_update_always=function(e){this._remove_camera_event(),this._update_always=e,this._add_camera_event()},e.prototype._current_event_name=function(){return this._update_always?r.CHANGE:r.MOVEEND},e.prototype._add_camera_event=function(){this._listener_added||null!=this._target&&(this._target.addEventListener(this._current_event_name(),this._listener),this._listener_added=!0)},e.prototype._remove_camera_event=function(){!0===this._listener_added&&null!=this._target&&(this._target.removeEventListener(this._current_event_name(),this._listener),this._listener_added=!1)},e.prototype._execute_callback=function(){null!=this._target&&this._callback(this._target)},e}();t.CameraController=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this.node=e,this._state=!0,this._hooks=null}return e.prototype.add_hook=function(e){this._hooks=this._hooks||[],this._hooks.push(e)},e.prototype.on_update=function(){},e.prototype.set=function(e){this._state!=e&&(this._state=e,this.on_update(),this.run_hooks())},Object.defineProperty(e.prototype,"active",{get:function(){return this._state},enumerable:!0,configurable:!0}),e.prototype.toggle=function(){this.set(!this._state)},e.prototype.run_hooks=function(){if(this._hooks)for(var e=0,t=this._hooks;e<t.length;e++){(0,t[e])()}},e}();t.BaseFlag=r},,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=r.__importDefault(n(132)),i=n(68),a=n(90),s=n(657),_=n(664),u=n(665),c=n(331),p=n(237),l=n(21),d=n(31),h={type:"change"};t.BASE_CAMERA_DEFAULT={near:1,far:100};var f=n(7),m=n(140),y=function(e){function n(){var n=null!==e&&e.apply(this,arguments)||this;return n.controls=f.ParamConfig.OPERATOR_PATH("",{node_selection:{context:d.NodeContext.EVENT}}),n.t=f.ParamConfig.VECTOR3([0,0,0]),n.r=f.ParamConfig.VECTOR3([0,0,0]),n.s=f.ParamConfig.VECTOR3([1,1,1]),n.scale=f.ParamConfig.FLOAT(1),n.target=f.ParamConfig.VECTOR3([0,0,0],{cook:!1}),n.near=f.ParamConfig.FLOAT(t.BASE_CAMERA_DEFAULT.near,{range:[0,100]}),n.far=f.ParamConfig.FLOAT(t.BASE_CAMERA_DEFAULT.far,{range:[0,100]}),n.aspect=f.ParamConfig.FLOAT(1),n.lock_width=f.ParamConfig.BOOLEAN(1),n.look_at=f.ParamConfig.OPERATOR_PATH(""),n.use_background=f.ParamConfig.BOOLEAN(0),n.use_material=f.ParamConfig.BOOLEAN(0,{visible_if:{use_background:!0}}),n.background_color=f.ParamConfig.COLOR([0,0,0],{visible_if:{use_background:!0,use_material:!1}}),n.background_material=f.ParamConfig.OPERATOR_PATH("",{visible_if:{use_background:!0,use_material:!0},node_selection:{context:d.NodeContext.MAT},dependent_on_found_node:!1}),n.background_ratio=f.ParamConfig.FLOAT(1,{visible_if:{use_background:!0,use_material:!0}}),n}return r.__extends(n,e),n}(f.NodeParamsConfig);t.BaseCameraObjParamsConfig=y;var v=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.flags=new m.FlagsControllerD(t),t.render_order=a.ObjNodeRenderOrder.CAMERA,t._aspect=-1,t._used_in_scene=!0,t}return r.__extends(t,e),Object.defineProperty(t.prototype,"object",{get:function(){return this._object},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"background_controller",{get:function(){return this._background_controller=this._background_controller||new this.background_controller_constructor(this)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"background_controller_constructor",{get:function(){return p.BaseBackgroundController},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"controls_controller",{get:function(){return this._controls_controller=this._controls_controller||new s.ControlsController(this)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"layers_controller",{get:function(){return this._layers_controller=this._layers_controller||new _.LayersController(this)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"post_process_controller",{get:function(){return this._post_process_controller=this._post_process_controller||new u.PostProcessController(this)},enumerable:!0,configurable:!0}),t.prototype.initialize_node=function(){var e=this;this.io.inputs.set_count(0,1),this.flags.display.add_hook((function(){e.set_used_in_scene(e.flags.display.active||!1)}))},t.prototype.create_common_params=function(){this.layers_controller.add_params(),this.post_process_controller.add_params()},t.prototype.create_player_camera_params=function(){this.add_param(l.ParamType.BUTTON,"set_master_camera",null,{callback:this.set_as_master_camera.bind(this)})},t.prototype.cook=function(){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(e){switch(e.label){case 0:return this.transform_controller.update(),this.layers_controller.update(),[4,this.background_controller.update()];case 1:return e.sent(),this._object.near==this.pv.near&&this._object.far==this.pv.far||(this._object.near=this.pv.near,this._object.far=this.pv.far,this._object.updateProjectionMatrix()),[4,this.post_process_controller.update_composer_passes()];case 2:return e.sent(),this.update_camera(),this.controls_controller.update_controls(),this._object.dispatchEvent(h),this.cook_controller.end_cook(),[2]}}))}))},t.prototype.on_create=function(){},t.prototype.on_delete=function(){},t.prototype.camera=function(){return this._object},t.prototype.update_camera=function(){},t.prototype.set_as_master_camera=function(){this.scene.cameras_controller.set_master_camera_node_path(this.full_path())},t.prototype.setup_for_aspect_ratio=function(e){o.default(e)||e&&this._aspect!=e&&(this._aspect=e,this._update_for_aspect_ratio())},t.prototype._update_for_aspect_ratio=function(){},t.prototype.update_transform_params_from_object=function(){i.CoreTransform.set_params_from_object(this._object,this)},t.prototype.viewer=function(e){return new c.ThreejsViewer(e,this.scene,this)},t}(a.TypedObjNode);t.TypedCameraObjNode=v;var g=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t}(v);t.BaseCameraObjNodeClass=g},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(667);n(54);var i=n(54),a=function(e){function t(t,n,r){var o=e.call(this,t,n,r)||this;return o._scene=n,o.do_render=!0,o._animate_method=o.animate.bind(o),o._canvas=document.createElement("canvas"),o._canvas.id=("canvas_id_"+Math.random()).replace(".","_"),o._container.appendChild(o._canvas),o._container.classList.add("CoreThreejsViewer"),o._set_events(),o}return r.__extends(t,e),t.prototype._build=function(){this._init_display(),this.activate()},t.prototype.dispose=function(){this._cancel_animate(),this.controls_controller.dispose_controls()},t.prototype._set_events=function(){this.events_controller.init(),this.webgl_controller.init(),i.POLY.player_mode()&&(window.onresize=this.cameras_controller.on_resize.bind(this))},t.prototype._init_display=function(){var e;this.cameras_controller.compute_size_and_aspect();var t=this.cameras_controller.size;null===(e=this.cameras_controller.camera_node)||void 0===e||e.post_process_controller.create_renderer(this._canvas,t),this.cameras_controller.prepare_current_camera(),this.animate()},t.prototype.animate=function(){this.do_render&&(this.render(),this._request_animation_frame_id=requestAnimationFrame(this._animate_method))},t.prototype._cancel_animate=function(){var e;this.do_render=!1,this._request_animation_frame_id&&cancelAnimationFrame(this._request_animation_frame_id),null===(e=this.cameras_controller.camera_node)||void 0===e||e.post_process_controller.delete_renderer(this._canvas)},t.prototype.render=function(){if(this.cameras_controller.camera_node){var e=this.cameras_controller.size,t=this.cameras_controller.aspect;this.cameras_controller.camera_node.post_process_controller.render(this._canvas,e,t)}else console.warn("no camera to render with")},t}(o.BaseViewer);t.ThreejsViewer=a},,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=r.__importDefault(n(88)),i=r.__importDefault(n(85)),a=r.__importDefault(n(132)),s=r.__importDefault(n(163)),_=r.__importDefault(n(77)),u=r.__importDefault(n(173)),c=n(1),p=n(40),l=n(47),d=n(238),h=n(46),f=n(98),m=n(45),y=n(27),v=function(){function e(){this.touch()}return e.prototype.timestamp=function(){return this._timestamp},e.prototype.touch=function(){this._timestamp=performance.now(),this.reset()},e.prototype.reset=function(){this._bounding_box=void 0,this._core_geometries=void 0,this._core_objects=void 0},e.prototype.clone=function(){var t=new e;if(this._objects){for(var n=[],r=0,o=this._objects;r<o.length;r++){var i=o[r];n.push(d.CoreObject.clone(i))}t.set_objects(n)}return t},e.prototype.set_objects=function(e){this._objects=e,this.touch()},e.prototype.objects=function(){return this._objects},e.prototype.core_objects=function(){return this._core_objects=this._core_objects||this._create_core_objects()},e.prototype._create_core_objects=function(){var e=[];if(this._objects)for(var t=function(t){n._objects[t].traverse((function(n){var r=new d.CoreObject(n,t);e.push(r)}))},n=this,r=0;r<this._objects.length;r++)t(r);return e},e.prototype.geometries=function(){for(var e=[],t=0,n=this.core_objects();t<n.length;t++){var r=n[t].object().geometry;r&&e.push(r)}return e},e.prototype.core_geometries=function(){return this._core_geometries=this._core_geometries||this.create_core_geometries()},e.prototype.create_core_geometries=function(){for(var e=[],t=0,n=this.geometries();t<n.length;t++){var r=n[t];e.push(new h.CoreGeometry(r))}return e},e.prototype.__geometry_from_object=function(e,t){if(t.geometry)return e.push(t.geometry)},e.geometry_from_object=function(e){return e.isMesh||e.isLine||e.isPoints?e.geometry:null},e.prototype.faces=function(){return _.default(this.core_geometries().map((function(e){return e.faces()})))},e.prototype.points=function(){return _.default(this.core_geometries().map((function(e){return e.points()})))},e.prototype.points_count=function(){return u.default(this.core_geometries().map((function(e){return e.points_count()})))},e.prototype.points_from_group=function(e){if(e){var t=m.CoreString.indices(e),n=this.points();return t.map((function(e){return n[e]}))}return this.points()},e.from_objects=function(t){var n=new e;return n.set_objects(t),n},e.prototype.objects_from_group=function(e){return this.core_objects_from_group(e).map((function(e){return e.object()}))},e.prototype.core_objects_from_group=function(e){if(""!==(e=s.default(e))){var t=parseInt(e);return a.default(t)?this.core_objects().filter((function(t){return m.CoreString.match_mask(e,t.name())})):i.default([this.core_objects()[t]])}return this.core_objects()},e.prototype.bounding_box=function(){return this._bounding_box=this._bounding_box||this._compute_bounding_box()},e.prototype.center=function(){var e=new c.Vector3;return this.bounding_box().getCenter(e),e},e.prototype.size=function(){var e=new c.Vector3;return this.bounding_box().getSize(e),e},e.prototype._compute_bounding_box=function(){var e=new l.Box3;if(this._objects)for(var t=0,n=this._objects;t<n.length;t++){var r=n[t];e.expandByObject(r)}return e},e.prototype.compute_vertex_normals=function(){for(var e=0,t=this.core_objects();e<t.length;e++){t[e].compute_vertex_normals()}},e.prototype.has_attrib=function(e){var t;return null!=(t=this.core_geometries()[0])&&t.has_attrib(e)},e.prototype.attrib_type=function(e){var t=this.core_geometries()[0];return null!=t?t.attrib_type(e):null},e.prototype.rename_attrib=function(t,n,r){switch(r){case y.CoreConstant.ATTRIB_CLASS.VERTEX:if(this.has_attrib(t)&&this._objects)for(var o=0,i=this._objects;o<i.length;o++){i[o].traverse((function(r){var o=e.geometry_from_object(r);o&&new h.CoreGeometry(o).rename_attribute(t,n)}))}break;case y.CoreConstant.ATTRIB_CLASS.OBJECT:if(this.has_attrib(t)&&this._objects)for(var a=0,s=this._objects;a<s.length;a++){s[a].traverse((function(e){new d.CoreObject(e,0).rename_attribute(t,n)}))}}},e.prototype.attrib_names=function(){var e;return null!=(e=this.core_geometries()[0])?e.attrib_names():[]},e.prototype.object_attrib_names=function(){var e;return null!=(e=this.core_objects()[0])?e.attrib_names():[]},e.prototype.attrib_names_matching_mask=function(e){for(var t=m.CoreString.attrib_names(e),n=[],r=0,i=this.attrib_names();r<i.length;r++)for(var a=i[r],s=0,_=t;s<_.length;s++){var u=_[s];m.CoreString.match_mask(a,u)&&n.push(a)}return o.default(n)},e.prototype.attrib_sizes=function(){var e;return null!=(e=this.core_geometries()[0])?e.attrib_sizes():{}},e.prototype.attrib_size=function(e){var t;return null!=(t=this.core_geometries()[0])?t.attrib_size(e):0},e.prototype.add_numeric_vertex_attrib=function(e,t,n){null==n&&(n=f.CoreAttribute.default_value(t));for(var r=0,o=this.core_geometries();r<o.length;r++){o[r].add_numeric_attrib(e,t,n)}},e.prototype.add_numeric_object_attrib=function(e,t,n){null==n&&(n=f.CoreAttribute.default_value(t));for(var r=0,o=this.core_objects();r<o.length;r++){o[r].add_numeric_attrib(e,n)}},e.clone=function(e){var t=new p.Group;return e.children.forEach((function(e){var n=d.CoreObject.clone(e);t.add(n)})),t},e}();t.CoreGroup=v},,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,o=n(2),i=n(17),a=n(1),s=n(3),_=n(98),u=n(336),c="position",p="normal";!function(e){e.x="x",e.y="y",e.z="z",e.w="w",e.r="r",e.g="g",e.b="b"}(r||(r={}));var l={x:0,y:1,z:2,w:3,r:0,g:1,b:2},d=function(e){function t(t,n){var r=e.call(this,n)||this;return r._core_geometry=t,r._geometry=r._core_geometry.geometry(),r}return o.__extends(t,e),t.prototype.geometry_wrapper=function(){return this._core_geometry},t.prototype.geometry=function(){return this._geometry=this._geometry||this._core_geometry.geometry()},t.prototype.attrib_size=function(e){return e=_.CoreAttribute.remap_name(e),this._geometry.getAttribute(e).itemSize},t.prototype.has_attrib=function(e){var t=_.CoreAttribute.remap_name(e);return this._core_geometry.has_attrib(t)},t.prototype.attrib_value=function(e){if("ptnum"===e)return this.index;var t=null,n=null;"."===e[e.length-2]&&(t=e[e.length-1],n=l[t],e=e.substring(0,e.length-2));var r=_.CoreAttribute.remap_name(e),o=this._geometry.getAttribute(r);if(!o){var u="attrib "+e+" not found. availables are: "+Object.keys(this._geometry.attributes||{}).join(",");throw console.warn(u),u}var c=o.array;if(this._core_geometry.is_attrib_indexed(r)){var p=this.attrib_value_index(r);return this._core_geometry.user_data_attrib(r)[p]}var d=o.itemSize,h=this._index*d;if(null==n)switch(d){case 1:return c[h];case 2:return new s.Vector2(c[h+0],c[h+1]);case 3:return new a.Vector3(c[h+0],c[h+1],c[h+2]);case 4:return new i.Vector4(c[h+0],c[h+1],c[h+2],c[h+3]);default:throw"size not valid ("+d+")"}else switch(d){case 1:return c[h];default:return c[h+n]}},t.prototype.attrib_value_index=function(e){return this._core_geometry.is_attrib_indexed(e)?this._geometry.getAttribute(e).array[this._index]:-1},t.prototype.position=function(){var e=this._geometry.getAttribute(c).array;return this._position=this._position||new a.Vector3,this._position.fromArray(e,3*this._index)},t.prototype.set_position=function(e){this.set_attrib_value_vector3(c,e)},t.prototype.normal=function(){var e=this._geometry.getAttribute(p).array;return this._normal=this._normal||new a.Vector3,this._normal.fromArray(e,3*this._index)},t.prototype.set_normal=function(e){return this.set_attrib_value_vector3(p,e)},t.prototype.set_attrib_value=function(e,t){if(null!=t){if(null==e)throw"Point.set_attrib_value requires a name";var n=this._geometry.getAttribute(e),r=n.array,o=n.itemSize;switch(o){case 1:r[this._index]=t;break;case 2:var i=t;r[2*this._index+0]=i.x,r[2*this._index+1]=i.y;break;case 3:if(null!=t.r){var a=t;r[3*this._index+0]=a.r,r[3*this._index+1]=a.g,r[3*this._index+2]=a.b}else{var s=t;r[3*this._index+0]=s.x,r[3*this._index+1]=s.y,r[3*this._index+2]=s.z}break;default:throw console.warn("Point.set_attrib_value does not yet allow attrib size "+o),"attrib size "+o+" not implemented"}}},t.prototype.set_attrib_value_vector3=function(e,t){if(null!=t){if(null==e)throw"Point.set_attrib_value requires a name";var n=this._geometry.getAttribute(e).array,r=3*this._index;n[r]=t.x,n[r+1]=t.y,n[r+2]=t.z}},t.prototype.set_attrib_index=function(e,t){return this._geometry.getAttribute(e).array[this._index]=t},t}(u.CoreEntity);t.CorePoint=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this._index=e}return Object.defineProperty(e.prototype,"index",{get:function(){return this._index},enumerable:!0,configurable:!0}),e}();t.CoreEntity=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,o=n(2).__importDefault(n(20));!function(e){e.customDistanceMaterial="customDistanceMaterial",e.customDepthMaterial="customDepthMaterial",e.customDepthDOFMaterial="customDepthDOFMaterial"}(r||(r={}));var i=function(){function e(){}return e.node=function(e,t){return e.node(t.name)},e.clone=function(e){var t=this;return o.default(e)?e.map((function(e){return t.clone_single(e)})):this.clone_single(e)},e.clone_single=function(e){var t=e.clone();return t.linewidth=e.linewidth,t},e.apply_custom_materials=function(e,t){if(t.custom_materials)for(var n=0,r=Object.keys(t.custom_materials);n<r.length;n++){var o=r[n],i=t.custom_materials[o];e[o]=i,i.needsUpdate=!0}},e.assign_custom_uniforms=function(e,t,n){var r=e;if(r.custom_materials)for(var o=0,i=Object.keys(r.custom_materials);o<i.length;o++){var a=i[o];r.custom_materials[a].uniforms[t].value=n}},e.init_custom_material_uniforms=function(e,t,n){var r=e;if(r.custom_materials)for(var o=0,i=Object.keys(r.custom_materials);o<i.length;o++){var a=i[o],s=r.custom_materials[a];s.uniforms[t]=s.uniforms[t]||n}},e}();t.CoreMaterial=i},,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=function(){function e(e){void 0===e&&(e={}),this._array_index=0,this._count=0,this._current_count_index=0,this._resolve=null,this._max_time_per_chunk=e.max_time_per_chunk||10,this._check_every_interations=e.check_every_interations||100}return e.prototype.start_with_count=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var n=this;return r.__generator(this,(function(r){if(this._count=e,this._current_count_index=0,this._iteratee_method_count=t,this._bound_next_with_count=this.next_with_count.bind(this),this._resolve)throw"an iterator cannot be started twice";return[2,new Promise((function(e,t){n._resolve=e,n.next_with_count()}))]}))}))},e.prototype.next_with_count=function(){var e=performance.now();if(this._iteratee_method_count&&this._bound_next_with_count)for(;this._current_count_index<this._count;)if(this._iteratee_method_count(this._current_count_index),this._current_count_index++,this._current_count_index%this._check_every_interations==0&&performance.now()-e>this._max_time_per_chunk){setTimeout(this._bound_next_with_count,1);break}this._current_count_index>=this._count&&this._resolve&&this._resolve()},e.prototype.start_with_array=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var n=this;return r.__generator(this,(function(r){if(this._array=e,this._array_index=0,this._iteratee_method_array=t,this._bound_next_with_array=this.next_with_array.bind(this),this._resolve)throw"an iterator cannot be started twice";return[2,new Promise((function(e,t){n._resolve=e,n.next_with_array()}))]}))}))},e.prototype.next_with_array=function(){var e=performance.now();if(this._iteratee_method_array&&this._bound_next_with_array&&this._array)for(;this._current_array_element=this._array[this._array_index];)if(this._iteratee_method_array(this._current_array_element,this._array_index),this._array_index++,this._array_index%this._check_every_interations==0&&performance.now()-e>this._max_time_per_chunk){setTimeout(this._bound_next_with_array,1);break}void 0===this._current_array_element&&this._resolve&&this._resolve()},e}();t.CoreIterator=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(114),o=n(3),i=n(4),a=n(5),s=function(){function e(){}return e.positions=function(e,t,n){void 0===n&&(n=360);for(var i=r.CoreMath.degrees_to_radians(n)/t,a=[],s=0;s<t;s++){var _=i*s,u=e*Math.cos(_),c=e*Math.sin(_);a.push(new o.Vector2(u,c))}return a},e.create=function(e,t,n){void 0===n&&(n=360);for(var r,o=this.positions(e,t,n),s=[],_=[],u=0;u<o.length;u++)r=o[u],s.push(r.x),s.push(r.y),s.push(0),u>0&&(_.push(u-1),_.push(u));_.push(t-1),_.push(0);var c=new a.BufferGeometry;return c.setAttribute("position",new i.Float32BufferAttribute(s,3)),c.setIndex(_),c},e}();t.CoreGeometryUtilCircle=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=r.__importDefault(n(20)),i=r.__importDefault(n(52)),a=r.__importDefault(n(38)),s=r.__importDefault(n(77)),_=n(79),u=n(4),c={BufferGeometry:n(5).BufferGeometry,Float32BufferAttribute:u.Float32BufferAttribute,Points:_.Points},p=r.__importDefault(n(342)),l=n(45),d=n(46),h=n(27),f=n(725),m=n(98),y=function(){function e(e){void 0===e&&(e={}),this._attribute_datas_by_name={},this._options={},this._options.data_keys_prefix=e.data_keys_prefix,this._options.skip_entries=e.skip_entries,this._options.do_convert=e.do_convert||!1,this._options.convert_to_numeric=e.convert_to_numeric}return e.prototype.load=function(e,t,n,r){var o=this;p.default.get(e).then((function(e){o._json=e.data,null!=o._options.data_keys_prefix&&""!=o._options.data_keys_prefix&&(o._json=o.get_prefixed_json(o._json,o._options.data_keys_prefix.split(".")));var n=o.create_object();t(n)})).catch((function(e){console.log("error",e),r(e)}))},e.prototype.get_prefixed_json=function(e,t){if(0==t.length)return e;var n=t.shift();return n?this.get_prefixed_json(e[n],t):[]},e.prototype.set_json=function(e){return this._json=e},e.prototype.create_object=function(){var e=new c.BufferGeometry,t=new d.CoreGeometry(e);if(null!=this._json){var n=this._json.length;t.init_position_attribute(n),this._find_attributes();for(var r=l.CoreString.attrib_names(this._options.convert_to_numeric||""),o=0,i=Object.keys(this._attribute_datas_by_name);o<i.length;o++){var _=i[o],u=s.default(this._attribute_values_for_name(_)),p=this._attribute_datas_by_name[_],f=p.size();if(p.type()===h.CoreConstant.ATTRIB_TYPE.STRING)if(this._options.do_convert&&l.CoreString.matches_one_mask(_,r)){var y=u.map((function(e){return a.default(e)?parseFloat(e)||0:e}));e.setAttribute(_,new c.Float32BufferAttribute(y,f))}else{var v=m.CoreAttribute.array_to_indexed_arrays(u);t.set_indexed_attribute(_,v.values,v.indices)}else{y=u;e.setAttribute(_,new c.Float32BufferAttribute(y,f))}}}return new c.Points(e,h.CoreConstant.MATERIALS[c.Points.name])},e.prototype._find_attributes=function(){var e,t=l.CoreString.attrib_names(this._options.skip_entries||"");if(this._json&&null!=(e=this._json[0]))for(var n=0,r=Object.keys(e);n<r.length;n++){var o=r[n],i=e[o];if(this._value_has_subentries(i))for(var a=0,s=Object.keys(i);a<s.length;a++){var _=[o,s[a]].join(":"),u=i[o];l.CoreString.matches_one_mask(_,t)||(this._attribute_datas_by_name[_]=f.CoreAttributeData.from_value(u))}else l.CoreString.matches_one_mask(o,t)||(this._attribute_datas_by_name[o]=f.CoreAttributeData.from_value(i))}},e.prototype._attribute_values_for_name=function(e){var t=this;return this._json?this._json.map((function(n){var r=e.split(":")[0],o=n[r];return t._value_has_subentries(o)?o[e.substring(r.length+1)]||0:o||0})):[]},e.prototype._value_has_subentries=function(e){return i.default(e)&&!o.default(e)},e}();t.JsonDataLoader=y},,,,,,,,,,,function(e,t,n){"use strict";n.r(t),n.d(t,"DRACOLoader",(function(){return s}));var r=n(4),o=n(5),i=n(28),a=n(18),s=function(e){a.a.call(this,e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}};s.prototype=Object.assign(Object.create(a.a.prototype),{constructor:s,setDecoderPath:function(e){return this.decoderPath=e,this},setDecoderConfig:function(e){return this.decoderConfig=e,this},setWorkerLimit:function(e){return this.workerLimit=e,this},setVerbosity:function(){console.warn("THREE.DRACOLoader: The .setVerbosity() method has been removed.")},setDrawMode:function(){console.warn("THREE.DRACOLoader: The .setDrawMode() method has been removed.")},setSkipDequantization:function(){console.warn("THREE.DRACOLoader: The .setSkipDequantization() method has been removed.")},load:function(e,t,n,r){var o=new i.a(this.manager);o.setPath(this.path),o.setResponseType("arraybuffer"),"use-credentials"===this.crossOrigin&&o.setWithCredentials(!0),o.load(e,e=>{var n={attributeIDs:this.defaultAttributeIDs,attributeTypes:this.defaultAttributeTypes,useUniqueIDs:!1};this.decodeGeometry(e,n).then(t).catch(r)},n,r)},decodeDracoFile:function(e,t,n,r){var o={attributeIDs:n||this.defaultAttributeIDs,attributeTypes:r||this.defaultAttributeTypes,useUniqueIDs:!!n};this.decodeGeometry(e,o).then(t)},decodeGeometry:function(e,t){for(var n in t.attributeTypes){var r=t.attributeTypes[n];void 0!==r.BYTES_PER_ELEMENT&&(t.attributeTypes[n]=r.name)}var o,i=JSON.stringify(t);if(s.taskCache.has(e)){var a=s.taskCache.get(e);if(a.key===i)return a.promise;if(0===e.byteLength)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}var _=this.workerNextTaskID++,u=e.byteLength,c=this._getWorker(_,u).then(n=>(o=n,new Promise((n,r)=>{o._callbacks[_]={resolve:n,reject:r},o.postMessage({type:"decode",id:_,taskConfig:t,buffer:e},[e])}))).then(e=>this._createGeometry(e.geometry));return c.finally(()=>{o&&_&&this._releaseTask(o,_)}),s.taskCache.set(e,{key:i,promise:c}),c},_createGeometry:function(e){var t=new o.BufferGeometry;e.index&&t.setIndex(new r.BufferAttribute(e.index.array,1));for(var n=0;n<e.attributes.length;n++){var i=e.attributes[n],a=i.name,s=i.array,_=i.itemSize;t.setAttribute(a,new r.BufferAttribute(s,_))}return t},_loadLibrary:function(e,t){var n=new i.a(this.manager);return n.setPath(this.decoderPath),n.setResponseType(t),new Promise((t,r)=>{n.load(e,t,void 0,r)})},preload:function(){return this._initDecoder(),this},_initDecoder:function(){if(this.decoderPending)return this.decoderPending;var e="object"!=typeof WebAssembly||"js"===this.decoderConfig.type,t=[];return e?t.push(this._loadLibrary("draco_decoder.js","text")):(t.push(this._loadLibrary("draco_wasm_wrapper.js","text")),t.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(t).then(t=>{var n=t[0];e||(this.decoderConfig.wasmBinary=t[1]);var r=s.DRACOWorker.toString(),o=["/* draco decoder */",n,"","/* worker */",r.substring(r.indexOf("{")+1,r.lastIndexOf("}"))].join("\n");this.workerSourceURL=URL.createObjectURL(new Blob([o]))}),this.decoderPending},_getWorker:function(e,t){return this._initDecoder().then(()=>{var n;this.workerPool.length<this.workerLimit?((n=new Worker(this.workerSourceURL))._callbacks={},n._taskCosts={},n._taskLoad=0,n.postMessage({type:"init",decoderConfig:this.decoderConfig}),n.onmessage=function(e){var t=e.data;switch(t.type){case"decode":n._callbacks[t.id].resolve(t);break;case"error":n._callbacks[t.id].reject(t);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+t.type+'"')}},this.workerPool.push(n)):this.workerPool.sort((function(e,t){return e._taskLoad>t._taskLoad?-1:1}));return(n=this.workerPool[this.workerPool.length-1])._taskCosts[e]=t,n._taskLoad+=t,n})},_releaseTask:function(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]},debug:function(){console.log("Task load: ",this.workerPool.map(e=>e._taskLoad))},dispose:function(){for(var e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this}}),s.DRACOWorker=function(){var e,t;function n(e,t,n,r,o,i){var a,s,_=i.num_components(),u=n.num_points()*_;switch(o){case Float32Array:a=new e.DracoFloat32Array,t.GetAttributeFloatForAllPoints(n,i,a),s=new Float32Array(u);break;case Int8Array:a=new e.DracoInt8Array,t.GetAttributeInt8ForAllPoints(n,i,a),s=new Int8Array(u);break;case Int16Array:a=new e.DracoInt16Array,t.GetAttributeInt16ForAllPoints(n,i,a),s=new Int16Array(u);break;case Int32Array:a=new e.DracoInt32Array,t.GetAttributeInt32ForAllPoints(n,i,a),s=new Int32Array(u);break;case Uint8Array:a=new e.DracoUInt8Array,t.GetAttributeUInt8ForAllPoints(n,i,a),s=new Uint8Array(u);break;case Uint16Array:a=new e.DracoUInt16Array,t.GetAttributeUInt16ForAllPoints(n,i,a),s=new Uint16Array(u);break;case Uint32Array:a=new e.DracoUInt32Array,t.GetAttributeUInt32ForAllPoints(n,i,a),s=new Uint32Array(u);break;default:throw new Error("THREE.DRACOLoader: Unexpected attribute type.")}for(var c=0;c<u;c++)s[c]=a.GetValue(c);return e.destroy(a),{name:r,array:s,itemSize:_}}onmessage=function(r){var o=r.data;switch(o.type){case"init":e=o.decoderConfig,t=new Promise((function(t){e.onModuleLoaded=function(e){t({draco:e})},DracoDecoderModule(e)}));break;case"decode":var i=o.buffer,a=o.taskConfig;t.then(e=>{var t=e.draco,r=new t.Decoder,s=new t.DecoderBuffer;s.Init(new Int8Array(i),i.byteLength);try{var _=function(e,t,r,o){var i,a,s=o.attributeIDs,_=o.attributeTypes,u=t.GetEncodedGeometryType(r);if(u===e.TRIANGULAR_MESH)i=new e.Mesh,a=t.DecodeBufferToMesh(r,i);else{if(u!==e.POINT_CLOUD)throw new Error("THREE.DRACOLoader: Unexpected geometry type.");i=new e.PointCloud,a=t.DecodeBufferToPointCloud(r,i)}if(!a.ok()||0===i.ptr)throw new Error("THREE.DRACOLoader: Decoding failed: "+a.error_msg());var c={index:null,attributes:[]};for(var p in s){var l,d,h=self[_[p]];if(o.useUniqueIDs)d=s[p],l=t.GetAttributeByUniqueId(i,d);else{if(-1===(d=t.GetAttributeId(i,e[s[p]])))continue;l=t.GetAttribute(i,d)}c.attributes.push(n(e,t,i,p,h,l))}if(u===e.TRIANGULAR_MESH){for(var f=i.num_faces(),m=new Uint32Array(3*f),y=new e.DracoInt32Array,v=0;v<f;++v){t.GetFaceFromMesh(i,v,y);for(var g=0;g<3;++g)m[3*v+g]=y.GetValue(g)}c.index={array:m,itemSize:1},e.destroy(y)}return e.destroy(i),c}(t,r,s,a),u=_.attributes.map(e=>e.array.buffer);_.index&&u.push(_.index.array.buffer),self.postMessage({type:"decode",id:o.id,geometry:_},u)}catch(e){console.error(e),self.postMessage({type:"error",id:o.id,error:e.message})}finally{t.destroy(s),t.destroy(r)}})}}},s.taskCache=new WeakMap,s.setDecoderPath=function(){console.warn("THREE.DRACOLoader: The .setDecoderPath() method has been removed. Use instance methods.")},s.setDecoderConfig=function(){console.warn("THREE.DRACOLoader: The .setDecoderConfig() method has been removed. Use instance methods.")},s.releaseDecoderModule=function(){console.warn("THREE.DRACOLoader: The .releaseDecoderModule() method has been removed. Use instance methods.")},s.getDecoderModule=function(){console.warn("THREE.DRACOLoader: The .getDecoderModule() method has been removed. Use instance methods.")}},,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(4),i=n(46),a=r.__importDefault(n(77)),s=r.__importDefault(n(316)),_=r.__importDefault(n(296)),u=function(){function e(e,t,n){this.geometry=e,this.geometry1=t,this.geometry0=n}return e.prototype.process=function(){var e=this,t=new i.CoreGeometry(this.geometry0),n=new i.CoreGeometry(this.geometry1),r=t.segments(),u=n.segments();if(0!==r.length&&0!==u.length){var c=r.length<u.length?[t,n]:[n,t],p=c[0],l=c[1],d=p.segments(),h=l.segments(),f=p.points(),m=l.points(),y=f.length,v=_.default(f,m),g=[];d.forEach((function(e,t){var n=h[t];g.push(e[0]),g.push(e[1]),g.push(n[0]+y),g.push(e[1]),g.push(n[1]+y),g.push(n[0]+y)})),s.default(p.attrib_names(),l.attrib_names()).forEach((function(t){var n=p.attrib_size(t),r=v.map((function(e){return e.attrib_value(t)}));n>1&&(r=a.default(r.map((function(e){return e.toArray()})))),e.geometry.setAttribute(t,new o.Float32BufferAttribute(r,n))})),this.geometry.setIndex(g),this.geometry.computeVertexNormals()}},e}();t.CoreGeometryOperationSkin=u},,,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(379);n(598);var o=n(331),i=new r.PolyScene;i.root.create_node("ambient_light"),i.loading_controller.mark_as_loaded();var a=i.root.create_node("perspective_camera");a.p.t.z.set(5);var s=i.root.create_node("geo");s.flags.display.set(!0),s.create_node("box").flags.display.set(!0),s.p.r.y.set("$F+20");var _=document.createElement("style");_.innerText="html, body, canvas, .canvas_container {height: 100%; margin: 0px;} canvas {display: block;}",document.body.appendChild(_);var u=document.createElement("div");u.classList.add("canvas_container"),document.body.appendChild(u),new o.ThreejsViewer(u,i,a),i.play()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(380),i=n(381),a=n(382),s=n(493),_=n(494),u=n(497),c=n(498),p=n(499),l=n(501),d=n(591),h=n(593),f=n(595),m=n(596),y=n(597),v=n(78),g=function(){function e(){this._display_scene=new v.Scene,this._cameras_controller=new o.CamerasController(this),this._cooker=new i.Cooker,this.cook_controller=new s.CookController,this._graph=new a.CoreGraph,this._missing_expression_references_controller=new p.MissingReferencesController,this._nodes_controller=new l.NodesController(this),this._time_controller=new h.TimeController(this),this._graph.set_scene(this),this.nodes_controller.init()}return Object.defineProperty(e.prototype,"display_scene",{get:function(){return this._display_scene},enumerable:!0,configurable:!0}),e.prototype.set_uuid=function(e){return this._uuid=e},Object.defineProperty(e.prototype,"uuid",{get:function(){return this._uuid},enumerable:!0,configurable:!0}),e.prototype.set_name=function(e){return this._name=e},Object.defineProperty(e.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cameras_controller",{get:function(){return this._cameras_controller},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cooker",{get:function(){return this._cooker},enumerable:!0,configurable:!0}),e.prototype.wait_for_cooks_completed=function(){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(e){return[2,this.cook_controller.wait_for_cooks_completed()]}))}))},Object.defineProperty(e.prototype,"events_controller",{get:function(){return this._events_controller=this._events_controller||new _.EventsController(this)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"graph",{get:function(){return this._graph},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"lifecycle_controller",{get:function(){return this._lifecycle_controller=this._lifecycle_controller||new u.LifeCycleController(this)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"loading_controller",{get:function(){return this._loading_controller=this._loading_controller||new c.LoadingController(this)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"missing_expression_references_controller",{get:function(){return this._missing_expression_references_controller},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"nodes_controller",{get:function(){return this._nodes_controller},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"performance",{get:function(){return this._performance=this._performance||new d.CorePerformance},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"time_controller",{get:function(){return this._time_controller},enumerable:!0,configurable:!0}),e.prototype.set_frame=function(e){this.time_controller.set_frame(e)},Object.defineProperty(e.prototype,"frame",{get:function(){return this.time_controller.frame},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"frame_range",{get:function(){return this.time_controller.frame_range},enumerable:!0,configurable:!0}),e.prototype.play=function(){this.time_controller.play()},e.prototype.pause=function(){this.time_controller.pause()},Object.defineProperty(e.prototype,"serializer",{get:function(){return this._serializer=this._serializer||new f.Serializer(this)},enumerable:!0,configurable:!0}),e.prototype.to_json=function(){return this.serializer.to_json()},Object.defineProperty(e.prototype,"uniforms_controller",{get:function(){return this._uniforms_controller=this._uniforms_controller||new m.UniformsController(this)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"webgl_controller",{get:function(){return this._webgl_controller=this._webgl_controller||new y.WebGLController},enumerable:!0,configurable:!0}),e.prototype.batch_update=function(e){this._cooker.block(),e(),this._cooker.unblock()},e.prototype.node=function(e){return this.nodes_controller.node(e)},Object.defineProperty(e.prototype,"root",{get:function(){return this.nodes_controller.root},enumerable:!0,configurable:!0}),e}();t.PolyScene=g},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this.scene=e,this._master_camera_node_path=null}return e.prototype.set_master_camera_node_path=function(e){this._master_camera_node_path=e},Object.defineProperty(e.prototype,"master_camera_node_path",{get:function(){return this._master_camera_node_path},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"master_camera_node",{get:function(){return this.master_camera_node_path?this.scene.node(this.master_camera_node_path):(console.warn("master camera node not found"),this._find_any_camera())},enumerable:!0,configurable:!0}),e.prototype._find_any_camera=function(){var e=this.scene.root;return e.nodes_by_type("perspective_camera")[0]||e.nodes_by_type("orthographic_camera")[0]},e}();t.CamerasController=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){this._queue={},this._block_level=0,this._queue={},this._block_level=0}return e.prototype.block=function(){this._block_level+=1},e.prototype.unblock=function(){this._block_level-=1,this.process_queue()},Object.defineProperty(e.prototype,"blocked",{get:function(){return this._block_level>0},enumerable:!0,configurable:!0}),e.prototype.enqueue=function(e){this._queue[e.graph_node_id]=e},e.prototype.process_queue=function(){if(!this.blocked)for(var e,t=0,n=Object.keys(this._queue);t<n.length;t++){var r=n[t];(e=this._queue[r])&&(delete this._queue[r],e.dirty_controller.run_post_dirty_hooks())}},e}();t.Cooker=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(383),o=function(){function e(){this._next_id=0,this._graph=new r.Graph({directed:!0,compound:!1,multigraph:!0})}return e.prototype.graph=function(){return this._graph},e.prototype.set_scene=function(e){this._scene=e},e.prototype.scene=function(){return this._scene},e.prototype.next_id=function(){return""+(this._next_id+=1)},e.prototype.setNode=function(e){this._graph.setNode(e.graph_node_id,e)},e.prototype.removeNode=function(e){this._graph.removeNode(e.graph_node_id)},e.prototype.nodes_from_ids=function(e){for(var t=[],n=0,r=e;n<r.length;n++){var o=r[n],i=this.node_from_id(o);i&&t.push(i)}return t},e.prototype.node_from_id=function(e){return this._graph.node(e)},e.prototype.connect=function(e,t){var n=e.graph_node_id,o=t.graph_node_id;if(this._graph.hasNode(n)&&this._graph.hasNode(o)){this._graph.setEdge(n,o);var i=!1;return!(!this._scene||this._scene.loading_controller.is_loading)&&(i=!r.alg.isAcyclic(this._graph)),i?(this._graph.removeEdge(n,o),!1):(e.dirty_controller.clear_successors_cache_with_predecessors(),!0)}return console.warn("attempt to connect non existing node "+n+" or "+o),!1},e.prototype.disconnect=function(e,t){if(e&&t){var n=e.graph_node_id,r=t.graph_node_id;this._graph.removeEdge(n,r),e.dirty_controller.clear_successors_cache_with_predecessors()}},e.prototype.disconnect_predecessors=function(e){for(var t=0,n=this.predecessors(e);t<n.length;t++){var r=n[t];this.disconnect(r,e)}},e.prototype.disconnect_successors=function(e){for(var t=0,n=this.successors(e);t<n.length;t++){var r=n[t];this.disconnect(e,r)}},e.prototype.predecessor_ids=function(e){return this._graph.predecessors(e)||[]},e.prototype.predecessors=function(e){var t=this.predecessor_ids(e.graph_node_id);return this.nodes_from_ids(t)},e.prototype.successor_ids=function(e){return this._graph.successors(e)||[]},e.prototype.successors=function(e){var t=this.successor_ids(e.graph_node_id)||[];return this.nodes_from_ids(t)},e.prototype.all_next_ids=function(e,t){for(var n=[],r=this[t](e.graph_node_id);r.length>0;){for(var o=[],i=0,a=r;i<a.length;i++)for(var s=a[i],_=0,u=this[t](s);_<u.length;_++){var c=u[_];o.push(c)}for(var p=0,l=r;p<l.length;p++){var d=l[p];n.push(d)}for(var h=0,f=o;h<f.length;h++){d=f[h];r.push(d)}r=o}return n},e.prototype.all_predecessor_ids=function(e){return this.all_next_ids(e,"predecessor_ids")},e.prototype.all_successor_ids=function(e){return this.all_next_ids(e,"successor_ids")},e.prototype.all_predecessors=function(e){var t=this.all_predecessor_ids(e);return this.nodes_from_ids(t)},e.prototype.all_successors=function(e){var t=this.all_successor_ids(e);return this.nodes_from_ids(t)},e}();t.CoreGraph=o},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=function(){function e(){this._cooking_nodes_by_id=new Map,this._resolves=[]}return e.prototype.add_node=function(e){this._cooking_nodes_by_id.set(e.graph_node_id,e)},e.prototype.remove_node=function(e){this._cooking_nodes_by_id.delete(e.graph_node_id),0==this._cooking_nodes_by_id.size&&this.flush()},e.prototype.flush=function(){for(var e;e=this._resolves.pop();)e()},e.prototype.wait_for_cooks_completed=function(){return r.__awaiter(this,void 0,void 0,(function(){var e=this;return r.__generator(this,(function(t){return 0==this._cooking_nodes_by_id.size?[2]:[2,new Promise((function(t,n){e._resolves.push(t)}))]}))}))},e}();t.CookController=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n(54);var r=n(54),o=function(){function e(e){this.scene=e}return e.prototype.set_listener=function(e){this._events_listener=e},Object.defineProperty(e.prototype,"events_listener",{get:function(){return this._events_listener},enumerable:!0,configurable:!0}),e.prototype.dispatch=function(e,t,n){var r;void 0===n&&(n={}),null===(r=this._events_listener)||void 0===r||r.process_events(e,t,n)},Object.defineProperty(e.prototype,"emit_allowed",{get:function(){return this.scene.loading_controller.loaded&&null!=this._events_listener&&this.scene.loading_controller.auto_updating&&!r.POLY.player_mode()},enumerable:!0,configurable:!0}),e}();t.EventsController=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r={antialias:!0},o=function(){function e(){this._next_renderer_id=0,this._next_env_map_id=0,this._renderers={},this._env_maps={},this._require_webgl2=!1}return e.prototype.set_require_webgl2=function(){this._require_webgl2||(this._require_webgl2=!0)},e.prototype.rendering_context=function(e){var t=null;return this._require_webgl2&&(t=this._rendering_context_webgl(e,!0)),t||(t=this._rendering_context_webgl(e,!1)),t},e.prototype._rendering_context_webgl=function(e,t){var n=t?"webgl2":"webgl",o=e.getContext(n,r);return o||(n=t?"experimental-webgl2":"experimental-webgl",o=e.getContext(n,r)),o},e.prototype.register_renderer=function(e){if(e._polygon_id)throw new Error("render already registered");e._polygon_id=this._next_renderer_id+=1,this._renderers[e._polygon_id]=e},e.prototype.deregister_renderer=function(e){delete this._renderers[e._polygon_id],e.dispose()},e.prototype.first_renderer=function(){var e=Object.keys(this._renderers)[0];return e?this._renderers[e]:null},e.prototype.renderers=function(){return Object.values(this._renderers)},e}();t.RenderersController=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){this._node_register={},this._node_register_categories={},this._node_register_options={}}return e.prototype.register_node=function(e,t,n){var r=e.node_context(),o=e.type();if(this._node_register[r]=this._node_register[r]||{},this._node_register[r][o])throw new Error("node "+r+"/"+o+" already registered");this._node_register[r][o]=e,t&&(this._node_register_categories[r]=this._node_register_categories[r]||{},this._node_register_categories[r][o]=t),this._node_register_options[r]=this._node_register_options[r]||{},n&&(this._node_register_options[r][o]=n)},e.prototype.deregister_node=function(e,t){delete this._node_register[e][t],delete this._node_register_categories[e][t],delete this._node_register_options[e][t]},e.prototype.registered_nodes_for_context_and_parent_type=function(e,t){var n=this;return this._node_register[e]?Object.values(this._node_register[e]).filter((function(r){var o,i=n._node_register_options[e][r.type()];return!i||(null===(o=i.only)||void 0===o?void 0:o.includes(t))})):[]},e.prototype.registered_nodes=function(e,t){for(var n={},r=0,o=this.registered_nodes_for_context_and_parent_type(e,t);r<o.length;r++){var i=o[r];n[i.type()]=i}return n},e}();t.NodesRegister=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this.scene=e,this._lifecycle_on_create_allowed=!0}return e.prototype.on_create_hook_allowed=function(){return this.scene.loading_controller.loaded&&this._lifecycle_on_create_allowed},e.prototype.on_create_prevent=function(e){this._lifecycle_on_create_allowed=!1,e(),this._lifecycle_on_create_allowed=!0},e}();t.LifeCycleController=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=function(){function e(e){this.scene=e,this._loading_state=!0,this._auto_updating=!0,this._first_object_loaded=!1}return e.prototype.mark_as_loading=function(){this._set_loading_state(!0)},e.prototype.mark_as_loaded=function(){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(e){switch(e.label){case 0:return[4,this._set_loading_state(!1)];case 1:return e.sent(),[2]}}))}))},e.prototype._set_loading_state=function(e){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(t){switch(t.label){case 0:return this._loading_state=e,[4,this.set_auto_update(!this._loading_state)];case 1:return t.sent(),[2]}}))}))},Object.defineProperty(e.prototype,"is_loading",{get:function(){return this._loading_state},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"loaded",{get:function(){return!this._loading_state},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"auto_updating",{get:function(){return this._auto_updating},enumerable:!0,configurable:!0}),e.prototype.set_auto_update=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t;return r.__generator(this,(function(n){switch(n.label){case 0:return this._auto_updating===e?[3,4]:(this._auto_updating=e,this._auto_updating?(t=this.scene.root)?[4,t.process_queue()]:[3,2]:[3,3]);case 1:n.sent(),n.label=2;case 2:return[3,3];case 3:return[3,4];case 4:return[2]}}))}))},e.prototype.on_first_object_loaded=function(){var e;if(!this._first_object_loaded){this._first_object_loaded=!0;var t=document.getElementById("scene_loading_container");t&&(null===(e=t.parentElement)||void 0===e||e.removeChild(t))}},e}();t.LoadingController=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(500),o=function(){function e(){this.references={},this.next_id=0,this.next_id_s="0"}return e.prototype.register=function(e,t,n){var o=this.next_id_s,i=new r.MissingExpressionReference(e,t,n,o);return this.references[n]=this.references[n]||{},this.references[n][o]=i,this.next_id+=1,this.next_id_s=""+this.next_id,i},e.prototype.unregister=function(e){this.references[e.full_path]&&delete this.references[e.full_path][e.id]},e.prototype.check_for_references=function(e){var t=e.full_path(),n=this.references[t];n&&(Object.keys(n).forEach((function(t){n[t].resolve_with_node(e)})),delete this.references[t])},e}();t.MissingReferencesController=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t,n,r){this.param=e,this.jsep_node=t,this.full_path=n,this.id=r,console.log(this.jsep_node,this.param)}return e.prototype.resolve_with_node=function(e){console.warn("this should not work! REFACTOR asap")},e}();t.MissingExpressionReference=r;var o=function(){function e(){this.found_graph_nodes=[],this.missing_paths=[]}return e.prototype.set_found_graph_nodes=function(e){this.found_graph_nodes=e},e.prototype.set_missing_paths=function(e){this.missing_paths=e},e}();t.ReferenceSearchResult=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=r.__importDefault(n(296)),i=r.__importDefault(n(77)),a=r.__importDefault(n(85)),s=n(502),_=n(45),u=function(){function e(e){this.scene=e,this._node_context_signatures={},this._instanciated_nodes_by_context_and_type={}}return e.prototype.init=function(){this._root=new s.ObjectsManagerNode(this.scene),this._root.initialize_base_and_node(),this._root.init_display_scene()},Object.defineProperty(e.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),e.prototype.objects_from_mask=function(e){var t=e.split(" "),n=this.root.children(),r=(n=n.filter((function(e){return _.CoreString.matches_one_mask(e.name,t)}))).map((function(e){return e.object}));return a.default(r)},e.prototype.clear=function(){for(var e=0,t=this.root.children();e<t.length;e++){var n=t[e];this.root.children_controller.remove_node(n)}},e.prototype.node=function(e){return"/"===e?this.root:this.root.node(e)},e.prototype.all_nodes=function(){for(var e=[this.root],t=[this.root],n=0;t.length>0&&n<10;){var r=i.default(t.map((function(e){return e.children_controller.children_allowed()?e.children():[]})));e=o.default(e,r),t=r,n+=1}return i.default(e)},e.prototype.reset_node_context_signatures=function(){this._node_context_signatures={}},e.prototype.register_node_context_signature=function(e){this._node_context_signatures[e.children_controller.node_context_signature()]=!0},e.prototype.node_context_signatures=function(){return Object.keys(this._node_context_signatures).sort().map((function(e){return e.toLowerCase()}))},e.prototype.add_to_instanciated_node=function(e){var t=e.node_context(),n=e.type;this._instanciated_nodes_by_context_and_type[t]=this._instanciated_nodes_by_context_and_type[t]||{},this._instanciated_nodes_by_context_and_type[t][n]=this._instanciated_nodes_by_context_and_type[t][n]||{},this._instanciated_nodes_by_context_and_type[t][n][e.graph_node_id]=e},e.prototype.remove_from_instanciated_node=function(e){var t=e.node_context(),n=e.type;delete this._instanciated_nodes_by_context_and_type[t][n][e.graph_node_id]},e.prototype.instanciated_nodes=function(e,t){var n=[];if(this._instanciated_nodes_by_context_and_type[e]){var r=this._instanciated_nodes_by_context_and_type[e][t];if(r)for(var o=0,i=Object.keys(r);o<i.length;o++){var a=i[o];n.push(r[a])}}return n},e}();t.NodesController=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(40),i=n(503);n(54);var a=n(31),s=n(7),_=n(54),u=new(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t}(s.NodeParamsConfig)),c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=u,t._object=new o.Group,t._queued_nodes_by_id={},t._queued_nodes_by_path={},t._expected_geo_nodes={},t._process_queue_start=-1,t}return r.__extends(t,e),t.type=function(){return"obj"},t.prototype.initialize_node=function(){this.children_controller.init(a.NodeContext.OBJ),this.lifecycle.add_on_child_add_hook(this._on_child_add.bind(this)),this.lifecycle.add_on_child_remove_hook(this._on_child_remove.bind(this))},t.prototype.init_display_scene=function(){this._object.name="_WORLD_",this._scene.display_scene.add(this._object)},t.prototype.object=function(){return this._object},t.prototype.create_node=function(t){return e.prototype.create_node.call(this,t)},t.prototype.children=function(){return e.prototype.children.call(this)},t.prototype.nodes_by_type=function(t){return e.prototype.nodes_by_type.call(this,t)},t.prototype.multiple_display_flags_allowed=function(){return!0},t.prototype.add_to_queue=function(e){var t=e.graph_node_id;if(null==this._queued_nodes_by_id[t])return this._queued_nodes_by_id[t]=e},t.prototype.process_queue=function(){return r.__awaiter(this,void 0,void 0,(function(){var e,t,n,o,i,a,s,u,c,p=this;return r.__generator(this,(function(r){switch(r.label){case 0:for(this._queued_nodes_by_path={},e=Object.keys(this._queued_nodes_by_id),t=0,n=e;t<n.length;t++)o=n[t],i=this._queued_nodes_by_id[o],delete this._queued_nodes_by_id[o],a="_____"+i.render_order+"__"+i.full_path(),this._queued_nodes_by_path[a]=i;return s=Object.keys(this._queued_nodes_by_path).sort().map((function(e){var t=p._queued_nodes_by_path[e];return p.update_object(t)})),u=this,(c=this._expected_geo_nodes)?[3,2]:[4,this.expected_loading_geo_nodes_by_id()];case 1:c=r.sent(),r.label=2;case 2:return u._expected_geo_nodes=c,this._process_queue_start=performance.now(),Promise.all(s).then((function(){_.POLY.log("SCENE LOADED '"+p.scene.name+"' in "+(performance.now()-p._process_queue_start))})),[2]}}))}))},t.prototype.update_object=function(e){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(t){return this.scene.loading_controller.auto_updating?this.add_to_scene(e):this.add_to_queue(e),[2]}))}))},t.prototype.get_parent_for_node=function(e){if(e.add_to_hierarchy){var t=e.io.inputs.input(0);return t?t.object:this._object}return null},t.prototype.add_to_scene=function(e){if(e.add_to_hierarchy){var t=this.get_parent_for_node(e);t&&(e.used_in_scene?(t.add(e.object),e.cook_controller.cook_main_without_inputs()):t.remove(e.object))}},t.prototype.remove_from_scene=function(e){if(e.add_to_hierarchy){var t=e.object;if(null!=t){var n=t.parent;null!=n&&n.remove(t)}}},t.prototype.are_children_cooking=function(){for(var e=0,t=this.children();e<t.length;e++){if(t[e].is_display_node_cooking())return!0}return!1},t.prototype.expected_loading_geo_nodes_by_id=function(){return r.__awaiter(this,void 0,void 0,(function(){var e,t,n,o,i;return r.__generator(this,(function(r){switch(r.label){case 0:e=this.nodes_by_type("geo"),t={},n=0,o=e,r.label=1;case 1:return n<o.length?[4,(i=o[n]).is_displayed()]:[3,4];case 2:r.sent()&&(t[i.graph_node_id]=i),r.label=3;case 3:return n++,[3,1];case 4:return[2,t]}}))}))},t.prototype.add_to_parent_transform=function(e){this.update_object(e)},t.prototype.remove_from_parent_transform=function(e){this.update_object(e)},t.prototype._on_child_add=function(e){e&&this.update_object(e)},t.prototype._on_child_remove=function(e){e&&this.remove_from_scene(e)},t}(i.TypedBaseManagerNode);t.ObjectsManagerNode=c},,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this.node=e,this._dirty_count=0,this._dirty=!0,this._post_dirty_hooks=[]}return Object.defineProperty(e.prototype,"is_dirty",{get:function(){return!0===this._dirty},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dirty_timestamp",{get:function(){return this._dirty_timestamp},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dirty_count",{get:function(){return this._dirty_count},enumerable:!0,configurable:!0}),e.prototype.add_post_dirty_hook=function(e){this._post_dirty_hooks=this._post_dirty_hooks||[],this._post_dirty_hooks.push(e)},e.prototype.remove_dirty_state=function(){this._dirty=!1},e.prototype.set_forbidden_trigger_nodes=function(e){this._forbidden_trigger_nodes=e.map((function(e){return e.graph_node_id}))},e.prototype.set_dirty=function(e,t){null==t&&(t=!0),e&&this._forbidden_trigger_nodes&&this._forbidden_trigger_nodes.includes(e.graph_node_id)||(null==e&&(e=this.node),this._dirty=!0,this._dirty_timestamp=performance.now(),this._dirty_count+=1,this.run_post_dirty_hooks(e),!0===t&&this.set_successors_dirty(e))},e.prototype.run_post_dirty_hooks=function(e){var t=this.node.scene.cooker;if(t.blocked)t.enqueue(this.node);else if(this._post_dirty_hooks)for(var n=0,r=this._post_dirty_hooks;n<r.length;n++){(0,r[n])(e)}},e.prototype.set_successors_dirty=function(e){this._cached_successors=this._cached_successors||this.node.graph_all_successors();for(var t=0,n=this._cached_successors;t<n.length;t++){n[t].dirty_controller.set_dirty(e,!1)}},e.prototype.clear_successors_cache=function(){this._cached_successors=void 0},e.prototype.clear_successors_cache_with_predecessors=function(){this.clear_successors_cache();for(var e=0,t=this.node.graph_all_predecessors();e<t.length;e++){t[e].dirty_controller.clear_successors_cache()}},e}();t.DirtyController=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=r.__importDefault(n(297)),i=n(3),a=n(6),s=n(48),_=function(e){function t(t,n,r){void 0===n&&(n=0),void 0===r&&(r=0);var o=e.call(this)||this;return o.node=t,o._width=50,o._border_radius=3,o._color=new a.Color(.75,.75,.75),o._icon=null,o._layout_vertical=!0,o._position=new i.Vector2(n||0,r||0),o}return r.__extends(t,e),t.prototype.set_border_radius=function(e){this._border_radius=e},t.prototype.border_radius=function(){return this._border_radius},t.prototype.set_width=function(e){this._width=e},t.prototype.width=function(){return this._width},t.prototype.set_comment=function(e){this._comment=e,this.node.emit(s.NodeEvent.UI_DATA_UPDATED,this.to_json())},t.prototype.comment=function(){return this._comment},t.prototype.set_color=function(e){this._color=e},t.prototype.color=function(){return this._color},t.prototype.set_icon=function(e){this._icon=e},t.prototype.icon=function(){return this._icon},t.prototype.set_layout_horizontal=function(){this._layout_vertical=!1},t.prototype.is_layout_vertical=function(){return this._layout_vertical},t.prototype.copy=function(e){this._position.copy(e.position()),this._color.copy(e.color())},t.prototype.position=function(){return this._position},t.prototype.set_position=function(e){this._position.copy(e),this.node.emit(s.NodeEvent.UI_DATA_UPDATED,this.to_json())},t.prototype.translate=function(e,t){void 0===t&&(t=!1),this._position.add(e),t&&(this._position.x=Math.round(this._position.x),this._position.y=Math.round(this._position.y)),this.node.emit(s.NodeEvent.UI_DATA_UPDATED,this.to_json())},t.prototype.to_json=function(){return{x:this._position.x,y:this._position.y,comment:this._comment}},t}(o.default);t.UIData=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(507),o=n(508),i=function(e){this.node=e,this.time_dependent=new r.TimeDependentState(this.node),this.error=new o.ErrorState(this.node)};t.StatesController=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this.node=e}return Object.defineProperty(e.prototype,"active",{get:function(){return this.are_params_time_dependent()||this.are_inputs_time_dependent()},enumerable:!0,configurable:!0}),e.prototype.are_params_time_dependent=function(){for(var e=0,t=this.node.params.names;e<t.length;e++){var n=t[e],r=this.node.params.get(n);if(r&&r.states.time_dependent.active)return!0}return!1},e.prototype.are_inputs_time_dependent=function(){for(var e=0,t=this.node.io.inputs.inputs();e<t.length;e++){var n=t[e];if(n&&n.states.time_dependent.active)return!0}return!1},e.prototype.force_time_dependent=function(){var e=this.node.graph_predecessors().map((function(e){return e.graph_node_id})),t=this.node.scene.time_controller.graph_node;e.includes(t.graph_node_id)||this.node.add_graph_input(t)},e.prototype.unforce_time_dependent=function(){var e=this.node.scene.time_controller.graph_node;this.node.remove_graph_input(e)},e}();t.TimeDependentState=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(48),o=function(){function e(e){this.node=e}return e.prototype.set=function(e){this._message!=e&&(this._message=e,this.on_update())},Object.defineProperty(e.prototype,"message",{get:function(){return this._message},enumerable:!0,configurable:!0}),e.prototype.clear=function(){this.set(void 0)},Object.defineProperty(e.prototype,"active",{get:function(){return null!=this._message},enumerable:!0,configurable:!0}),e.prototype.on_update=function(){null!=this._message&&this.node.set_container(null,"from error '"+this._message+"'"),this.node.emit(r.NodeEvent.ERROR_UPDATED)},e}();t.ErrorState=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(223),o=n(86),i=function(){function e(e){this.node=e,this._parent=null}return Object.defineProperty(e.prototype,"parent",{get:function(){return this._parent},enumerable:!0,configurable:!0}),e.prototype.set_parent=function(e){e!=this.node.parent_controller.parent&&(this._parent=e,this._parent&&this.node.name_controller.request_name_to_parent(r.NameController.base_name(this.node)))},e.prototype.is_selected=function(){var e,t;return null===(t=null===(e=this.parent)||void 0===e?void 0:e.selection)||void 0===t?void 0:t.contains(this.node)},e.prototype.full_path=function(){var e=o.CoreWalker.SEPARATOR;if(null!=this._parent){var t=this._parent.full_path();return t===e?t+this.node.name:t+e+this.node.name}return e},e.prototype.on_set_parent=function(){if(this._on_set_parent_hooks)for(var e=0,t=this._on_set_parent_hooks;e<t.length;e++){(0,t[e])()}},e}();t.HierarchyParentController=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){}return e.separator=function(){return"/"},e.find_node=function(e,t,n){if(!e)return null;var r=t.split("/").filter((function(e){return e.length>0})),o=r[0],i=null;if("/"!==t[0]){switch(o){case"..":i=e.parent;break;case".":i=e;break;default:i=e.node(o)}if(i&&n&&n.add_node(o,i),null!=i&&r.length>1){var a=r.slice(1).join("/");i=this.find_node(i,a,n)}return i}var s=t.substr(1);return i=this.find_node(e.root,s,n)},e}();t.CoreWalkerEmbed=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(45),i=n(86),a=n(61),s=r.__importDefault(n(304)),_=r.__importDefault(n(83)),u=r.__importDefault(n(96)),c=r.__importDefault(n(222)),p=n(48),l=n(223),d=n(54),h=function(){function e(e){this.node=e,this._children_allowed=!1,this._children={},this._children_by_type={},this._children_and_grandchildren_by_context={},this._is_dependent_on_children=!1}return e.prototype.init=function(e,t){void 0===t&&(t=!1),this._context=e,this._children_allowed=!0,this._children={},t&&(this._is_dependent_on_children=t,this._is_dependent_on_children&&(this._children_node=new a.CoreGraphNode(this.node.scene,"children"),this.node.add_graph_input(this._children_node)))},Object.defineProperty(e.prototype,"context",{get:function(){return this._context},enumerable:!0,configurable:!0}),e.prototype.set_child_name=function(e,t){var n;if(t=(t=t.replace(/[^A-Za-z0-9]/g,"_")).replace(/^[0-9]/,"_"),null!=(n=this._children[t])){if(e.name===t&&n.graph_node_id===e.graph_node_id)return;return t=o.CoreString.increment(t),this.set_child_name(e,t)}var r=e.name;this._children[r]&&delete this._children[r],this._children[t]=e,e.name_controller.update_name_from_parent(t),this._add_to_nodes_by_type(e),this.node.scene.nodes_controller.add_to_instanciated_node(e)},e.prototype.node_context_signature=function(){return this.node.node_context()+"/"+this.node.type},e.prototype.available_children_classes=function(){return this._context?d.POLY.registered_nodes(this._context,this.node.type):(console.warn("children controller not initialized for node",this.node.type,this.node),{})},e.prototype.children_allowed=function(){var e=this.available_children_classes();return e&&Object.keys(e).length>0},e.prototype.create_node=function(e){if(null==this.available_children_classes())throw"no children available for "+this.node.full_path()+".";var t=this.available_children_classes()[e];if(null==t){var n="node type "+e+" not found for "+this.node.full_path()+" ("+Object.keys(this.available_children_classes()).join(", ")+", "+this._context+", "+this.node.type+")";throw console.error(n),n}var r=new t(this.node.scene,"child_node_"+e);return r.initialize_base_and_node(),this.add_node(r),r},e.prototype.add_node=function(e){if(!this._children_allowed)throw"node "+this.node.full_path()+" cannot have children";e.set_parent(this.node),e.params.init(),e.parent_controller.on_set_parent(),e.name_controller.post_set_full_path();for(var t=0,n=e.children_controller.children();t<n.length;t++){n[t].name_controller.post_set_full_path()}return this.node.emit(p.NodeEvent.CREATED,{child_node:e}),this.node.scene.lifecycle_controller.on_create_hook_allowed()&&e.lifecycle.on_create(),this.set_child_name(e,l.NameController.base_name(e)),this.node.lifecycle.on_child_add(e),this._is_dependent_on_children&&this._children_node&&this._children_node.add_graph_input(e),e.require_webgl2()&&this.node.scene.webgl_controller.set_require_webgl2(),e},e.prototype.remove_node=function(e){var t,n;if(e.parent!=this.node)return console.warn("node "+e.name+" not under parent "+this.node.full_path());e.set_successors_dirty(this.node),this._is_dependent_on_children&&this._children_node&&this._children_node.remove_graph_input(e),this.node.selection.contains(e)&&this.node.selection.remove([e]);var r=e.io.connections.first_input_connection();null===(t=e.io.connections.input_connections())||void 0===t||t.forEach((function(e){e&&e.disconnect({set_input:!0})})),null===(n=e.io.connections.output_connections())||void 0===n||n.forEach((function(e){if(e&&(e.disconnect({set_input:!0}),r)){var t=r.node_src,n=e.output_index,o=e.node_dest,i=e.input_index;o.io.inputs.set_input(i,t,n)}})),e.graph_disconnect_successors(),e.set_parent(null),delete this._children[e.name],this._remove_from_nodes_by_type(e),this.node.scene.nodes_controller.remove_from_instanciated_node(e),this.node.lifecycle.on_child_remove(e),e.lifecycle.on_delete(),e.emit(p.NodeEvent.DELETED,{parent:this.node})},e.prototype.find_node=function(e){if(!this._children_allowed)return null;if(null==e)return null;if(e===i.CoreWalker.CURRENT||e===i.CoreWalker.CURRENT_WITH_SLASH)return this.node;if(e===i.CoreWalker.PARENT||e===i.CoreWalker.PARENT_WITH_SLASH)return this.node.parent;var t=i.CoreWalker.separator();e[0]===t&&(e=e.substring(1,e.length));var n=e.split(t);if(1===n.length){var r=n[0];return this._children[r]}return i.CoreWalker.find_node(this.node,e)},e.prototype._add_to_nodes_by_type=function(e){var t=e.graph_node_id,n=e.type;this._children_by_type[n]=this._children_by_type[n]||[],s.default(this._children_by_type[n],t)||this._children_by_type[n].push(t),this.add_to_children_and_grandchildren_by_context(e)},e.prototype._remove_from_nodes_by_type=function(e){var t=e.graph_node_id,n=e.type;if(this._children_by_type[n]){var r=this._children_by_type[n].indexOf(t);r>=0&&(this._children_by_type[n].splice(r,1),0==this._children_by_type[n].length&&delete this._children_by_type[n])}this.remove_from_children_and_grandchildren_by_context(e)},e.prototype.add_to_children_and_grandchildren_by_context=function(e){var t=e.graph_node_id,n=e.node_context();this._children_and_grandchildren_by_context[n]=this._children_and_grandchildren_by_context[n]||[],s.default(this._children_and_grandchildren_by_context[n],t)||this._children_and_grandchildren_by_context[n].push(t),this.node.parent&&this.node.parent.children_controller.add_to_children_and_grandchildren_by_context(e)},e.prototype.remove_from_children_and_grandchildren_by_context=function(e){var t=e.graph_node_id,n=e.node_context();if(this._children_and_grandchildren_by_context[n]){var r=this._children_and_grandchildren_by_context[n].indexOf(t);r>=0&&(this._children_and_grandchildren_by_context[n].splice(r,1),0==this._children_and_grandchildren_by_context[n].length&&delete this._children_and_grandchildren_by_context[n])}this.node.parent&&this.node.parent.children_controller.remove_from_children_and_grandchildren_by_context(e)},e.prototype.nodes_by_type=function(e){var t=this._children_by_type[e]||[],n=this.node.scene.graph,r=[];return t.forEach((function(e){var t=n.node_from_id(e);t&&r.push(t)})),r},e.prototype.has_children_and_grandchildren_with_context=function(e){return null!=this._children_and_grandchildren_by_context[e]},e.prototype.children=function(){return c.default(this._children)},e.prototype.children_names=function(){return u.default(_.default(this._children))},e.prototype.traverse_children=function(e){for(var t,n=0,r=this.children();n<r.length;n++){var o=r[n];e(o),null===(t=o.children_controller)||void 0===t||t.traverse_children(e)}},e}();t.HierarchyChildrenController=h},,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this.node=e,this._on_child_add_hooks=[],this._on_child_remove_hooks=[],this._on_create_hooks=[],this._on_delete_hooks=[]}return e.prototype.add_on_child_add_hook=function(e){this._on_child_add_hooks.push(e)},e.prototype.on_child_add=function(e){this.execute_hooks_with_child_node(this._on_child_add_hooks,e)},e.prototype.add_on_child_remove_hook=function(e){this._on_child_remove_hooks.push(e)},e.prototype.on_child_remove=function(e){this.execute_hooks_with_child_node(this._on_child_remove_hooks,e)},e.prototype.add_create_hook=function(e){this._on_create_hooks.push(e)},e.prototype.on_create=function(){this.execute_hooks(this._on_create_hooks)},e.prototype.add_delete_hook=function(e){this._on_delete_hooks.push(e)},e.prototype.on_delete=function(){this.execute_hooks(this._on_delete_hooks)},e.prototype.execute_hooks=function(e){for(var t=0,n=e;t<n.length;t++){(0,n[t])()}},e.prototype.execute_hooks_with_child_node=function(e,t){for(var n=0,r=e;n<r.length;n++){(0,r[n])(t)}},e}();t.LifeCycleController=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(54),i=function(){function e(e){this.node=e,this._cooking=!1,this._cooks_count=0,this._max_cook_time=-1,this._cook_time_with_inputs=0,this._cook_time=0,this._cook_time_params=0,this._inputs_evaluation_required=!0}return e.prototype.disallow_inputs_evaluation=function(){this._inputs_evaluation_required=!1},Object.defineProperty(e.prototype,"is_cooking",{get:function(){return!0===this._cooking},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cooks_count",{get:function(){return this._cooks_count},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cook_time",{get:function(){return this._cook_time},enumerable:!0,configurable:!0}),e.prototype._init_cooking_state=function(){this._cooking=!0,this._cooking_dirty_timestamp=this.node.dirty_controller.dirty_timestamp},e.prototype._init_cooking_start_time=function(e){null==e&&(e=this.node.scene.performance.started),e&&(this._cook_time_start=performance.now())},e.prototype._start_cook_if_no_errors=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t;return r.__generator(this,(function(n){switch(n.label){case 0:return this.node.states.error.active?(this.end_cook(),[3,4]):[3,1];case 1:return n.trys.push([1,3,,4]),[4,this.node.cook(e)];case 2:return n.sent(),[3,4];case 3:return t=n.sent(),this.node.states.error.set("node internal error: '"+t+"'."),console.error(this.node.full_path(),t),this.end_cook(),[3,4];case 4:return[2]}}))}))},e.prototype.cook_main=function(){return r.__awaiter(this,void 0,void 0,(function(){var e,t,n,o,i;return r.__generator(this,(function(r){switch(r.label){case 0:return this.is_cooking?[2]:(this._init_cooking_state(),(e=this.node.scene.performance.started)&&(this._cook_time_with_inputs_start=performance.now()),this.node.states.error.clear(),[4,this.evaluate_inputs_and_params()]);case 1:if(t=r.sent(),this._init_cooking_start_time(e),n=[],t)for(o=void 0,i=0;i<t.length;i++)(o=t[i])&&(this.node.io.inputs.input_clonable_state_with_override(i)?n.push(o.core_content_cloned()):n.push(o.core_content()));return[4,this._start_cook_if_no_errors(n)];case 2:return r.sent(),[2]}}))}))},e.prototype.cook_main_without_inputs=function(){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(e){switch(e.label){case 0:return this.node.scene.cook_controller.add_node(this.node),this.is_cooking?(console.warn("cook_main_without_inputs already cooking",this.node.full_path()),[2]):(this._init_cooking_state(),this._init_cooking_start_time(),this.node.states.error.clear(),[4,this.node.params.eval_all()]);case 1:return e.sent(),[4,this._start_cook_if_no_errors([])];case 2:return e.sent(),[2]}}))}))},e.prototype.end_cook=function(e){this._increment_cooks_count();var t=this.node.dirty_controller.dirty_timestamp;null==t||t===this._cooking_dirty_timestamp?(this.node.remove_dirty_state(),this._terminate_cook_process()):(o.POLY.log("COOK AGAIN",t,this._cooking_dirty_timestamp,this.node.full_path()),this._cooking=!1,this.cook_main())},e.prototype._terminate_cook_process=function(){this.is_cooking&&(this._cooking=!1,this._record_cook_time(),setTimeout(this.node.container_controller.notify_requesters.bind(this.node.container_controller),0))},e.prototype._increment_cooks_count=function(){this.is_cooking&&null!=this._cook_time_start&&(this._cooks_count+=1)},e.prototype._record_cook_time=function(){if(this.node.scene.performance.started){var e=performance.now();null!=this._cook_time_with_inputs_start&&(this._cook_time_with_inputs=e-this._cook_time_with_inputs_start,this._cook_time_with_inputs_start=void 0),null!=this._cook_time_params_start&&null!=this._cook_time_start&&(this._cook_time_params=this._cook_time_start-this._cook_time_params_start),null!=this._cook_time_start&&(this._cook_time=e-this._cook_time_start,this._cook_time_start=void 0),this._max_cook_time=Math.max(this._max_cook_time,this._cook_time)}this.node.scene.performance.started&&this.node.scene.performance.record_node_cook_data(this.node)},e.prototype.evaluate_inputs_and_params=function(){return r.__awaiter(this,void 0,void 0,(function(){var e;return r.__generator(this,(function(t){switch(t.label){case 0:return e=[],this._inputs_evaluation_required?[4,this.node.io.inputs.eval_required_inputs_p()]:[3,2];case 1:e=t.sent(),t.label=2;case 2:return this.node.scene.performance.started&&(this._cook_time_params_start=performance.now()),[4,this.node.params.eval_all()];case 3:return t.sent(),[2,e]}}))}))},Object.defineProperty(e.prototype,"cook_time_with_inputs",{get:function(){return this._cook_time_with_inputs},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cook_time_params",{get:function(){return this._cook_time_params},enumerable:!0,configurable:!0}),e.prototype._time_with_precision=function(e){return Math.round(1e3*e)/1e3},e}();t.CookController=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,o=n(2).__importDefault(n(538)),i=n(55),a=n(165);!function(e){e.SUCCESSORS="graph_successors",e.PREDECESSORS="graph_predecessors"}(r||(r={}));var s=function(){function e(e){this.node=e}return e.prototype.scene_successors=function(){return this._find_scene_node_scene_nodes(r.SUCCESSORS)},e.prototype.scene_predecessors=function(){return this._find_scene_node_scene_nodes(r.PREDECESSORS)},e.prototype._find_scene_node_scene_nodes=function(e){var t=this,n=this.node.params.all;n.push(this.node);for(var i=[],a=0,s=n;a<s.length;a++){var _=s[a];this._find_base_nodes_from_node(_,e,i)}if(e==r.SUCCESSORS)for(var u=0,c=this.param_nodes_referree();u<c.length;u++){var p=c[u];i.push(p)}i=i.filter((function(e){return e.graph_node_id!=t.node.graph_node_id}));var l=o.default(i,(function(e){return e.graph_node_id})),d=[];return Object.keys(l).forEach((function(e){d.push(l[e][0])})),d},e.prototype._find_base_nodes_from_node=function(e,t,n){for(var r,o,s=0,_=e[t]();s<_.length;s++){var u=_[s];u instanceof a.BaseParamClass?n.push(u.node):(r=u,("string"==typeof(o=i.BaseNodeClass)?typeof r===o:r instanceof o)?n.push(u):this._find_base_nodes_from_node(u,t,n))}return n},e.prototype.add_param_referree=function(e){this._params_referrees_by_graph_node_id=this._params_referrees_by_graph_node_id||{},this._params_referrees_by_graph_node_id[e.graph_node_id]=e},e.prototype.remove_param_referree=function(e){this._params_referrees_by_graph_node_id&&delete this._params_referrees_by_graph_node_id[e.graph_node_id]},e.prototype.params_referree=function(){var e=[];if(this._params_referrees_by_graph_node_id)for(var t=0,n=Object.keys(this._params_referrees_by_graph_node_id);t<n.length;t++){var r=n[t];e.push(this._params_referrees_by_graph_node_id[r])}return e},e.prototype.param_nodes_referree=function(){for(var e,t={},n=0,r=this.params_referree();n<r.length;n++){t[(e=r[n].node).graph_node_id]=e}for(var o=[],i=0,a=Object.keys(t);i<a.length;i++){var s=a[i];o.push(t[s])}return o},e}();t.DependenciesController=s},,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=r.__importDefault(n(85)),i=r.__importDefault(n(226)),a=r.__importDefault(n(305)),s=n(21),_=n(227),u=function(){function e(e){this._param=e,this._programatic_visible_state=!0}return e.prototype.set=function(e){this._default_options=e,this._options=i.default(this._default_options)},e.prototype.copy=function(e){this._default_options=i.default(e.default),this._options=i.default(e.current)},e.prototype.set_option=function(e,t){return Object.assign(this._options,e,t)},Object.defineProperty(e.prototype,"param",{get:function(){return this._param},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"node",{get:function(){return this._param.node},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"default",{get:function(){return this._default_options},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"current",{get:function(){return this._options},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"has_options_overridden",{get:function(){return!a.default(this._options,this._default_options)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"overridden_options",{get:function(){for(var e={},t=0,n=Object.keys(this._options);t<n.length;t++){var r=n[t];a.default(this._options[r],this._default_options[r])||Object.assign(e,r,i.default(this._options[r]))}return e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"overridden_option_names",{get:function(){return Object.keys(this.overridden_options)},enumerable:!0,configurable:!0}),e.prototype.always_reference_asset=function(){return this._options.always_reference_asset||!1},e.prototype.has_callback=function(){return null!=this._options.callback||null!=this._options.callback_string},e.prototype.execute_callback=function(){var e=this.get_callback();null!=e&&this.node&&!this.node.cook_controller.is_cooking&&e(this.node,this.param)},e.prototype.get_callback=function(){if(this.has_callback())return this._options.callback=this._options.callback||this.create_callback_from_string()},e.prototype.create_callback_from_string=function(){var e=this,t=this._options.callback_string;if(t){var n=new Function("node","scene","window","location",t);return function(){n(e.node,e.node.scene,null,null)}}},e.prototype.color=function(){return this._options.color},e.prototype.makes_node_dirty_when_dirty=function(){var e;if(null!=this.param.parent_param)return!1;var t=!0;return null!=(e=this._options.cook)&&(t=e),t},Object.defineProperty(e.prototype,"desktop_browse_option",{get:function(){return this._options.desktop_browse},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"desktop_browse_allowed",{get:function(){return null!=this.desktop_browse_option},enumerable:!0,configurable:!0}),e.prototype.desktop_browse_file_type=function(){return this.desktop_browse_option?this.desktop_browse_option.file_type:null},Object.defineProperty(e.prototype,"displays_expression_only",{get:function(){return!0===this._options.expression_only},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"is_expression_for_entities",{get:function(){var e=this._options.expression;return e&&e.for_entities||!1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"has_menu",{get:function(){return null!=this.menu_options},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"menu_options",{get:function(){return this._options.menu},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"menu_entries",{get:function(){return this.menu_options?this.menu_options.entries:[]},enumerable:!0,configurable:!0}),e.prototype.has_menu_radio=function(){return this.has_menu},e.prototype.is_multiline=function(){return!0===this._options.multiline},Object.defineProperty(e.prototype,"node_selection_options",{get:function(){return this._options.node_selection},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"node_selection_context",{get:function(){if(this.node_selection_options)return this.node_selection_options.context},enumerable:!0,configurable:!0}),e.prototype.dependent_on_found_node=function(){return!("dependent_on_found_node"in this._options)||this._options.dependent_on_found_node},e.prototype.range=function(){return this._options.range||[0,1]},e.prototype.step=function(){return this._options.step||.01},e.prototype.range_locked=function(){return this._options.range_locked||[!1,!1]},e.prototype._ensure_in_range=function(e){var t=this.range();return e>=t[0]&&e<=t[1]?e:e<t[0]?!0===this.range_locked()[0]?t[0]:e:!0===this.range_locked()[1]?t[1]:e},Object.defineProperty(e.prototype,"is_spare",{get:function(){return this._options.spare||!1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"texture_options",{get:function(){return this._options.texture},enumerable:!0,configurable:!0}),e.prototype.texture_as_env=function(){var e=this.texture_options;return null!=e&&!0===e.env},e.prototype.is_hidden=function(){return!0===this._options.hidden||!1===this._programatic_visible_state},e.prototype.is_visible=function(){return!this.is_hidden()},e.prototype.set_visible_state=function(e){this._options.hidden=!e,this.param.emit(_.ParamEvent.VISIBLE_UPDATED)},e.prototype.is_label_hidden=function(){var e=this.param.type;return!1===this._options.label||e===s.ParamType.BUTTON||e===s.ParamType.SEPARATOR||e===s.ParamType.BOOLEAN&&this.is_field_hidden()},e.prototype.is_field_hidden=function(){return!1===this._options.field},e.prototype.ui_data_depends_on_other_params=function(){return"visible_if"in this._options},e.prototype.visibility_predecessors=function(){var e=this,t=Object.keys(this._options.visible_if||{}),n=this.param.node;return o.default(t.map((function(t){var r=n.params.get(t);if(r)return r;console.error("param "+t+" not found as visibility condition for "+e.param.name+" in node "+e.param.node.type)})))},e.prototype.set_ui_data_dependency=function(){var e=this;this.visibility_predecessors().forEach((function(t){e.param.ui_data.add_graph_input(t)}))},e.prototype.update_visibility=function(){return r.__awaiter(this,void 0,void 0,(function(){var e,t,n,o,i,a,s,u;return r.__generator(this,(function(r){switch(r.label){case 0:return(e=this._options.visible_if)?(t=this.visibility_predecessors(),n=t.map((function(e){return e.compute()})),this._programatic_visible_state=!0,[4,Promise.all(n)]):[3,2];case 1:for(r.sent(),o=0,i=t;o<i.length;o++)a=i[o],s=e[a.name],u=a.value,s!=u&&(this._programatic_visible_state=!1);this.param.emit(_.ParamEvent.VISIBLE_UPDATED),r.label=2;case 2:return[2]}}))}))},e}();t.OptionsController=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(227),o=function(){function e(e){this.param=e,this._blocked_emit=!0,this._blocked_parent_emit=!0,this._count_by_event_name={}}return Object.defineProperty(e.prototype,"emit_allowed",{get:function(){return!0!==this._blocked_emit&&(!this.param.scene.loading_controller.is_loading&&this.param.scene.events_controller.emit_allowed)},enumerable:!0,configurable:!0}),e.prototype.block_emit=function(){return this._blocked_emit=!0,this.param.is_multiple&&this.param.components&&this.param.components.forEach((function(e){return e.emit_controller.block_emit()})),!0},e.prototype.unblock_emit=function(){return this._blocked_emit=!1,this.param.is_multiple&&this.param.components&&this.param.components.forEach((function(e){return e.emit_controller.unblock_emit()})),!0},e.prototype.block_parent_emit=function(){return this._blocked_parent_emit=!0,!0},e.prototype.unblock_parent_emit=function(){return this._blocked_parent_emit=!1,!0},e.prototype.increment_count=function(e){this._count_by_event_name[e]=this._count_by_event_name[e]||0,this._count_by_event_name[e]+=1},e.prototype.events_count=function(e){return this._count_by_event_name[e]||0},e.prototype.emit_param_updated=function(){this.emit_allowed&&(this.param.emit(r.ParamEvent.UPDATED),null!=this.param.parent_param&&!0!==this._blocked_parent_emit&&this.param.parent_param.emit(r.ParamEvent.UPDATED))},e}();t.EmitController=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this.param=e}return e.prototype.to_json=function(){var e,t={name:this.param.name,type:this.param.type,value:this.param.value,expression:this.param.has_expression()?null===(e=this.param.expression_controller)||void 0===e?void 0:e.expression:null,graph_node_id:this.param.graph_node_id,is_dirty:this.param.is_dirty,error_message:this.param.states.error.message,is_visible:this.param.options.is_visible(),folder_name:this.param.ui_data.folder_name,components:null};return this.param.is_multiple&&this.param.components&&(t.components=this.param.components.map((function(e){return e.graph_node_id}))),t},e}();t.ParamSerializer=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(546),o=n(547),i=function(e){this.param=e,this.time_dependent=new r.TimeDependentState(this.param),this.error=new o.ErrorState(this.param)};t.StatesController=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this.param=e}return Object.defineProperty(e.prototype,"active",{get:function(){var e=this.param.scene.time_controller.graph_node.graph_node_id;return this.param.graph_predecessor_ids().includes(e)},enumerable:!0,configurable:!0}),e}();t.TimeDependentState=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this.node=e}return e.prototype.set=function(e){this._message!=e&&(this._message=e)},Object.defineProperty(e.prototype,"message",{get:function(){return this._message},enumerable:!0,configurable:!0}),e.prototype.clear=function(){this.set(void 0)},Object.defineProperty(e.prototype,"active",{get:function(){return null!=this._message},enumerable:!0,configurable:!0}),e}();t.ErrorState=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=function(e){function t(t,n){var r=e.call(this,t,"param ui data")||this;return r.param=n,r.add_post_dirty_hook(r.update_visibility_and_remove_dirty.bind(r)),r}return r.__extends(t,e),t.prototype.update_visibility_and_remove_dirty=function(){this.update_visibility(),this.remove_dirty_state()},t.prototype.update_visibility=function(){this.param.options.update_visibility()},t.prototype.set_folder_name=function(e){this._folder_name=e},Object.defineProperty(t.prototype,"folder_name",{get:function(){return this._folder_name},enumerable:!0,configurable:!0}),t}(n(61).CoreGraphNode);t.UIData=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this.node=e}return e.prototype.serialize=function(){return this.to_json()},e.prototype.to_json=function(e){var t,n,r,o,i;void 0===e&&(e=!1);var a=this.node.children().map((function(e){return e.graph_node_id})),s=this.node.io.inputs.inputs().map((function(e){return null!=e?e.graph_node_id:void 0})),_=null===(t=this.node.io.connections.input_connections())||void 0===t?void 0:t.map((function(e){return null!=e?e.output_index:void 0})),u=this.node.io.inputs.named_input_connection_points.map((function(e){return e.to_json()})),c=this.node.io.outputs.named_output_connection_points.map((function(e){return e.to_json()})),p={name:this.node.name,type:this.node.type,graph_node_id:this.node.graph_node_id,is_dirty:this.node.is_dirty,ui_data:this.node.ui_data.to_json(),error_message:this.node.states.error.message,children:a,inputs:s,input_connection_output_indices:_,named_inputs:u,named_outputs:c,params:this.to_json_params(e),spare_params:this.to_json_spare_params(e),override_clonable_state:this.node.io.inputs.override_clonable_state(),inputs_clonable_state_with_override:this.node.io.inputs.inputs_clonable_state_with_override(),flags:{display:null===(r=null===(n=this.node.flags)||void 0===n?void 0:n.display)||void 0===r?void 0:r.active,bypass:null===(i=null===(o=this.node.flags)||void 0===o?void 0:o.bypass)||void 0===i?void 0:i.active},selection:null};return this.node.children_controller.children_allowed()&&(p.selection=this.node.selection.to_json()),p},e.prototype.to_json_params_from_names=function(e,t){void 0===t&&(t=!1);for(var n={},r=0,o=e;r<o.length;r++){var i=o[r],a=this.node.params.get(i);if(a&&(n[i]=a.graph_node_id,t&&a.is_multiple&&a.components))for(var s=0,_=a.components;s<_.length;s++){var u=_[s];n[u.name]=u.graph_node_id}}return n},e.prototype.to_json_params=function(e){return void 0===e&&(e=!1),this.to_json_params_from_names(this.node.params.non_spare_names,e)},e.prototype.to_json_spare_params=function(e){return void 0===e&&(e=!1),this.to_json_params_from_names(this.node.params.spare_names,e)},e}();t.NodeSerializer=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=r.__importDefault(n(39)),i=r.__importDefault(n(307)),a=r.__importDefault(n(38)),s=n(166),_=n(21),u=n(45),c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.type=function(){return _.ParamType.BOOLEAN},Object.defineProperty(t.prototype,"default_value_serialized",{get:function(){return this.convert(this.default_value)||!1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"value_serialized",{get:function(){return this.value},enumerable:!0,configurable:!0}),t.are_values_equal=function(e,t){return e==t},t.prototype.convert=function(e){return i.default(e)?e:o.default(e)?e>=1:a.default(e)&&u.CoreString.is_number(e)?parseFloat(e)>=1:null},t}(s.TypedNumericParam);t.BooleanParam=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(309),o=n(553),i=n(570),a=n(571),s=n(21),_=function(){function e(e){this.param=e,this.parse_completed=!1,this.parse_started=!1,this.parsed_tree=new r.ParsedTree,this.function_generator=new o.FunctionGenerator(this.param),this.dependencies_controller=new a.DependenciesController(this.param)}return e.prototype.parse_expression=function(e){if(this.parse_started)throw new Error("parse in progress for param "+this.param.full_path());this.parse_started=!0,this.parse_completed=!1,this.parsed_tree=this.parsed_tree||new r.ParsedTree,this.reset(),this.param.type==s.ParamType.STRING?this.parsed_tree.parse_expression_for_string_param(e):this.parsed_tree.parse_expression(e),this.function_generator.parse_tree(this.parsed_tree),null==this.function_generator.error_message?(this.dependencies_controller.update(this.function_generator),this.dependencies_controller.error_message?this.param.states.error.set(this.dependencies_controller.error_message):(this.parse_completed=!0,this.parse_started=!1)):this.set_error(this.function_generator.error_message)},e.prototype.compute_function=function(){return this.compute_allowed()?this.function_generator.eval_function():new Promise((function(e,t){e(null)}))},e.prototype.reset=function(){this.parse_completed=!1,this.parse_started=!1,this._error_message=void 0,this.dependencies_controller.reset(),this.function_generator.reset()},e.prototype.set_error=function(e){this._error_message=this._error_message||e},Object.defineProperty(e.prototype,"is_errored",{get:function(){return null!=this._error_message},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"error_message",{get:function(){return this._error_message},enumerable:!0,configurable:!0}),e.prototype.compute_allowed=function(){return null==this._error_message&&this.function_generator.eval_allowed()},e.prototype.update_from_method_dependency_name_change=function(){var e;this.expression_string_generator=this.expression_string_generator||new i.ExpressionStringGenerator(this.param);var t=this.expression_string_generator.parse_tree(this.parsed_tree);null===(e=this.param.expression_controller)||void 0===e||e.set_expression(t),t&&this.parse_expression(t)},e}();t.ExpressionManager=_},,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(554),i=n(555),a=n(98),s={math_random:"random"},_=n(310),u=Object.keys(_.Easing),c={};["abs","acos","asin","atan","ceil","cos","exp","floor","max","min","pow","round","sign","sin","sqrt","tan"].forEach((function(e){c[e]="Math."+e})),Object.keys(s).forEach((function(e){var t=s[e];c[e]="Math."+t})),["fit","fit01","fract","deg2rad","rad2deg","rand","clamp"].forEach((function(e){c[e]="POLY.Core.Math."+e})),u.forEach((function(e){c[e]="POLY.Core.Math.Easing."+e})),["precision"].forEach((function(e){c[e]="POLY.Core.String."+e}));var p={if:o.LiteralConstructsController.if},l={};["PI","E"].forEach((function(e){l[e]="Math."+e}));var d=i.MethodModule,h=n(229),f={x:0,y:1,z:2,w:3,r:0,g:1,b:2},m=n(229),y=Object.getPrototypeOf((function(){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(e){return[2]}))}))})).constructor,v=function(e){function t(t){var n=e.call(this,t)||this;return n.param=t,n.function_pre_entities_loop_lines=[],n.methods=[],n.method_index=0,n.method_dependencies=[],n.immutable_dependencies=[],n}return r.__extends(t,e),t.prototype.parse_tree=function(e){if(this.reset(),null==e.error_message){try{if(this.function_pre_entities_loop_lines=[],e.node){var t=this.traverse_node(e.node);t&&null==this.error_message&&(this.function_main_string=t)}else console.warn("no parsed_tree.node")}catch(e){console.warn("error in expression for param "+this.param.full_path()),console.warn(e)}if(this.function_main_string)try{this.function=new y("param","methods","\n\t\t\t\t\ttry {\n\t\t\t\t\t\t"+this.function_body()+"\n\t\t\t\t\t} catch(e) {\n\t\t\t\t\t\tparam.states.error.set(e.message || e);\n\t\t\t\t\t\treturn null;\n\t\t\t\t\t}")}catch(e){console.warn(e),this.set_error("cannot generate function")}else this.set_error("cannot generate function body")}else this.set_error("cannot parse expression")},t.prototype.reset=function(){this.error_message=void 0,this.function_main_string=void 0,this.methods=[],this.method_index=0,this.function=void 0,this.method_dependencies=[],this.immutable_dependencies=[]},t.prototype.function_body=function(){return this.param.options.is_expression_for_entities?"\n\t\t\tconst entities = param.expression_controller.entities;\n\t\t\tif(entities){\n\t\t\t\treturn new Promise( async (resolve, reject)=>{\n\t\t\t\t\tlet entity;\n\t\t\t\t\tconst entity_callback = param.expression_controller.entity_callback;\n\t\t\t\t\t"+this.function_pre_entities_loop_lines.join(";\n")+"\n\t\t\t\t\tfor(let index=0; index < entities.length; index++){\n\t\t\t\t\t\tentity = entities[index];\n\t\t\t\t\t\tresult = "+this.function_main_string+";\n\t\t\t\t\t\tentity_callback(entity, result);\n\t\t\t\t\t}\n\t\t\t\t\tresolve()\n\t\t\t\t})\n\t\t\t}\n\t\t\treturn []":"\n\t\t\treturn new Promise( async (resolve, reject)=>{\n\t\t\t\tresolve("+this.function_main_string+")\n\t\t\t})\n\t\t\t"},t.prototype.eval_allowed=function(){return null!=this.function},t.prototype.eval_function=function(){if(this.function)return this.function(this.param,this.methods)},t.prototype.traverse_CallExpression=function(e){var t=this,n=e.arguments.map((function(e){return t.traverse_node(e)})),r=e.callee.name;if(r){var o=p[r];if(o)return o(n);var i=""+n.join(", "),a=c[r];if(a)return a+"("+i+")";if(d[r]){var s=e.arguments[0],_="return "+n[0],u=[];try{u=new Function(_)()}catch(e){}return this._create_method_and_dependencies(r,u,s),"(await methods["+this.method_index+"].process_arguments(["+i+"]))"}}this.set_error("unknown method: "+r)},t.prototype.traverse_BinaryExpression=function(e){return"("+this.traverse_node(e.left)+" "+e.operator+" "+this.traverse_node(e.right)+")"},t.prototype.traverse_LogicalExpression=function(e){return"("+this.traverse_node(e.left)+" "+e.operator+" "+this.traverse_node(e.right)+")"},t.prototype.traverse_MemberExpression=function(e){return this.traverse_node(e.object)+"."+this.traverse_node(e.property)},t.prototype.traverse_UnaryExpression=function(e){if("@"===e.operator){var t=e.argument,n=void 0,r=void 0;switch(t.type){case"Identifier":n=t.name;break;case"MemberExpression":var o=t,i=o.object,s=o.property;n=i.name,r=s.name}if(n){if("ptnum"==(n=a.CoreAttribute.remap_name(n)))return"((entity != null) ? entity.index : 0)";var _="attrib_"+n,u="attrib_size_"+n,c="array_"+n;return this.function_pre_entities_loop_lines.push("const "+_+" = entities[0].geometry().attributes['"+n+"']"),this.function_pre_entities_loop_lines.push("const "+u+" = "+_+".itemSize"),this.function_pre_entities_loop_lines.push("const "+c+" = "+_+".array"),r?c+"[entity.index*"+u+"+"+f[r]+"]":c+"[entity.index*"+u+"]"}return console.warn("attribute not found"),""}return""+e.operator+this.traverse_node(e.argument)},t.prototype.traverse_Literal=function(e){return""+e.raw},t.prototype.traverse_Identifier=function(e){if(e.name[0]!=h.VARIABLE_PREFIX)return e.name;var t=e.name.substr(1),n=l[t];if(n)return n;var r="traverse_Identifier_"+t;if(this[r])return this[r]();this.set_error("identifier unknown: "+e.name)},t.prototype.traverse_Identifier_F=function(){return this.immutable_dependencies.push(this.param.scene.time_controller.graph_node),"param.scene.time_controller.frame"},t.prototype.traverse_Identifier_FPS=function(){return this.immutable_dependencies.push(this.param.scene.time_controller.graph_node),"param.scene.time_controller.fps"},t.prototype.traverse_Identifier_T=function(){return this.immutable_dependencies.push(this.param.scene.time_controller.graph_node),"param.scene.time_controller.time"},t.prototype.traverse_Identifier_CH=function(){return"'"+this.param.name+"'"},t.prototype.traverse_Identifier_CEX=function(){return this._method_centroid("x")},t.prototype.traverse_Identifier_CEY=function(){return this._method_centroid("y")},t.prototype.traverse_Identifier_CEZ=function(){return this._method_centroid("z")},t.prototype._method_centroid=function(e){var t=[0,"'"+e+"'"].join(", ");return this._create_method_and_dependencies("centroid",0),"(await methods["+this.method_index+"].process_arguments(["+t+"]))"},t.prototype._create_method_and_dependencies=function(e,t,n){var r=new(0,d[e])(this.param);this.method_index+=1,this.methods[this.method_index]=r;var o=r.find_dependency(t);o&&(n&&o.set_jsep_node(n),this.method_dependencies.push(o))},t}(m.BaseTraverser);t.FunctionGenerator=v},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){}return e.if=function(e){return"("+e[0]+") ? ("+e[1]+") : ("+e[2]+")"},e}();t.LiteralConstructsController=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(556),o=n(558),i=n(559),a=n(560),s=n(561),_=n(562),u=n(563),c=n(564),p=n(565),l=n(566),d=n(567),h=n(568),f=n(569);t.MethodModule={bbox:r.Bbox,ch:i.Ch,centroid:o.Centroid,cop_res:s.CopRes,local:_.Local,opdigits:u.Opdigits,point:c.Point,points_count:p.PointsCount,copy:a.Copy,str_chars_count:l.StrCharsCount,str_concat:d.StrConcat,str_index:h.StrIndex,str_sub:f.StrSub}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(49),i=n(1),a=["min","max","size","center"],s=["x","y","z"],_=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.required_arguments=function(){return[["string","path to node"],["string","vector name, min, max, size or center"],["string","component_name, x,y or z"]]},t.prototype.find_dependency=function(e){return this.create_dependency_from_index_or_path(e)},t.prototype.process_arguments=function(e){var t=this,n=0;return new Promise((function(o,i){return r.__awaiter(t,void 0,void 0,(function(){var t,a,s,_,u;return r.__generator(this,(function(r){switch(r.label){case 0:if(3!=e.length)return[3,5];t=e[0],a=e[1],s=e[2],_=null,r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this.get_referenced_node_container(t)];case 2:return _=r.sent(),[3,4];case 3:return u=r.sent(),i(u),[3,4];case 4:return _&&(n=this._get_value_from_container(_,a,s),o(n)),[3,6];case 5:o(0),r.label=6;case 6:return[2]}}))}))}))},t.prototype._get_value_from_container=function(e,t,n){if(a.indexOf(t)>=0){var r=e.bounding_box(),o=new i.Vector3;switch(t){case"size":r.getSize(o);break;case"center":r.getCenter(o);break;default:o=r[t]}return s.indexOf(n)>=0?o[n]:-1}return-1},t}(o.BaseMethod);t.Bbox=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=r.__importDefault(n(39)),i=n(228),a=n(61),s=n(161),_=n(55),u=function(e){function t(t,n,r){var o=e.call(this,t.scene,"MethodDependency")||this;return o.param=t,o.path_argument=n,o.decomposed_path=r,o.add_post_dirty_hook(o._update_from_name_change.bind(o)),o}return r.__extends(t,e),t.prototype._update_from_name_change=function(e){if(s.CoreObject.is_a(e,_.TypedNode)&&this.decomposed_path){var t=e;this.decomposed_path.update_from_name_change(t);var n=this.decomposed_path.to_path(),r=this.jsep_node;r&&(r.value=(""+r.value).replace(""+this.path_argument,n),r.raw=r.raw.replace(""+this.path_argument,n)),this.param.expression_controller&&this.param.expression_controller.update_from_method_dependency_name_change()}},t.prototype.reset=function(){this.graph_disconnect_predecessors()},t.prototype.listen_for_name_changes=function(){var e=this;this.jsep_node&&this.decomposed_path&&this.decomposed_path.named_nodes.forEach((function(t){t&&t instanceof _.BaseNodeClass&&e.add_graph_input(t.name_controller.graph_node)}))},t.prototype.set_jsep_node=function(e){this.jsep_node=e},t.prototype.set_resolved_graph_node=function(e){this.resolved_graph_node=e},t.prototype.set_unresolved_path=function(e){this.unresolved_path=e},t.create=function(e,n,r,a){var s=o.default(n),_=void 0;if(a){_=new i.DecomposedPath;for(var u=0,c=a;u<c.length;u++){var p=c[u];_.add_node(p.name,p)}}var l=new t(e,n,_);if(r)l.set_resolved_graph_node(r);else if(!s){var d=n;l.set_unresolved_path(d)}return l},t}(a.CoreGraphNode);t.MethodDependency=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.required_arguments=function(){return[["string","path to node"],["string","component_name, x,y or z"]]},t.prototype.find_dependency=function(e){return this.create_dependency_from_index_or_path(e)},t.prototype.process_arguments=function(e){var t=this;return new Promise((function(n,o){return r.__awaiter(t,void 0,void 0,(function(){var t,i,a,s,_,u,c;return r.__generator(this,(function(r){switch(r.label){case 0:if(2!=e.length)return[3,5];t=e[0],i=e[1],a=null,r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this.get_referenced_node_container(t)];case 2:return a=r.sent(),[3,4];case 3:return s=r.sent(),o(s),[3,4];case 4:return a&&(_=a.bounding_box(),u=_.min.clone().add(_.max).multiplyScalar(.5),c=u[i],n(null!=c?c:0)),[3,6];case 5:n(0),r.label=6;case 6:return[2]}}))}))}))},t}(n(49).BaseMethod);t.Centroid=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(49),i=n(228),a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.required_arguments=function(){return[["string","path to param"]]},t.prototype.find_dependency=function(e){var t=new i.DecomposedPath,n=this.get_referenced_param(e,t);return n?this.create_dependency(n,e,t):null},t.prototype.process_arguments=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,n,o,i;return r.__generator(this,(function(r){switch(r.label){case 0:return t=0,1!=e.length?[3,2]:(n=e[0],(o=this.get_referenced_param(n))?[4,o.compute()]:[3,2]);case 1:r.sent(),null!=(i=o.value)&&(t=i),r.label=2;case 2:return[2,t]}}))}))},t}(o.BaseMethod);t.Ch=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(49),i=n(86),a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.required_arguments=function(){return[["string","path to copy"],["integer","default value"]]},t.optional_arguments=function(){return[["string","attribute name (optional)"]]},t.prototype.find_dependency=function(e){var t=this.find_referenced_graph_node(e);if(t&&"copy"==t.type){var n=t.stamp_node;return this.create_dependency(n,e)}return null},t.prototype.process_arguments=function(e){var t=this;return new Promise((function(n,r){if(2==e.length||3==e.length){var o=e[0],a=e[1],s=e[2],_=i.CoreWalker.find_node(t.node,o),u=void 0;_&&"copy"==_.type&&(u=_.stamp_value(s)),null==u&&(u=a),n(u)}else n(0)}))},t}(o.BaseMethod);t.Copy=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.required_arguments=function(){return[["string","path to node"],["string","component_name: x or y"]]},t.prototype.find_dependency=function(e){return this.create_dependency_from_index_or_path(e)},t.prototype.process_arguments=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,n,o,i,a;return r.__generator(this,(function(r){switch(r.label){case 0:return t=0,2!=e.length?[3,2]:(n=e[0],o=e[1],[4,this.get_referenced_node_container(n)]);case 1:(i=r.sent())&&(a=i.resolution(),[0,"0","x"].includes(o)?t=a[0]:[1,"1","y"].includes(o)&&(t=a[1])),r.label=2;case 2:return[2,t]}}))}))},t}(n(49).BaseMethod);t.CopRes=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(49),i=n(54),a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.required_arguments=function(){return[["string","path"]]},t.prototype.process_arguments=function(e){var t=this;return new Promise((function(n,r){t.request_asset_url(e[0]).then((function(e){n(e)}))}))},t.prototype.request_asset_url=function(e){var t=this;return new Promise((function(n,r){if(!i.POLY.desktop_controller().active())return n("");i.POLY.desktop_controller().add_local_path(e,t.param),n(i.POLY.desktop_controller().local_path_server_url(e))}))},t}(o.BaseMethod);t.Local=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(49),i=n(55),a=n(45),s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.required_arguments=function(){return[["string","path to node"]]},t.prototype.find_dependency=function(e){var t=this.find_referenced_graph_node(e);if(t&&t instanceof i.BaseNodeClass){var n=t.name_controller.graph_node;return this.create_dependency(n,e)}return null},t.prototype.process_arguments=function(e){var t=this;return new Promise((function(n,r){if(1==e.length){var o=e[0],i=t.get_referenced_node(o);if(i){var s=i.name;n(a.CoreString.tail_digits(s))}else n(0)}else n(0)}))},t}(o.BaseMethod);t.Opdigits=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.required_arguments=function(){return[["string","path to node"],["index","point index"],["string","attribute name"]]},t.prototype.find_dependency=function(e){return this.create_dependency_from_index_or_path(e)},t.prototype.process_arguments=function(e){var t=this;return new Promise((function(n,o){return r.__awaiter(t,void 0,void 0,(function(){var t,i,a,s,_,u;return r.__generator(this,(function(r){switch(r.label){case 0:if(3!=e.length)return[3,5];t=e[0],i=e[1],a=e[2],s=null,r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this.get_referenced_node_container(t)];case 2:return s=r.sent(),[3,4];case 3:return _=r.sent(),o(_),[3,4];case 4:return s&&(u=this._get_value_from_container(s,i,a),n(u)),[3,6];case 5:n(0),r.label=6;case 6:return[2]}}))}))}))},t.prototype._get_value_from_container=function(e,t,n){var r=e.core_content();if(r){var o=r.points()[n];return o?o.attrib_value(t):0}return null},t}(n(49).BaseMethod);t.Point=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.required_arguments=function(){return[["string","path to node"]]},t.prototype.find_dependency=function(e){return this.create_dependency_from_index_or_path(e)},t.prototype.process_arguments=function(e){var t=this;return new Promise((function(n,o){return r.__awaiter(t,void 0,void 0,(function(){var t,i,a,s;return r.__generator(this,(function(r){switch(r.label){case 0:if(1!=e.length)return[3,5];t=e[0],i=void 0,r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this.get_referenced_node_container(t)];case 2:return i=r.sent(),[3,4];case 3:return a=r.sent(),o(a),[2];case 4:return i&&(s=i.points_count(),n(s)),[3,6];case 5:n(0),r.label=6;case 6:return[2]}}))}))}))},t}(n(49).BaseMethod);t.PointsCount=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.required_arguments=function(){return[["string","string to count characters of"]]},t.prototype.process_arguments=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,n;return r.__generator(this,(function(r){return t=0,1==e.length&&(n=e[0],t=n.length),[2,t]}))}))},t}(n(49).BaseMethod);t.StrCharsCount=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.required_arguments=function(){return[]},t.prototype.process_arguments=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,n,o,i;return r.__generator(this,(function(r){for(t="",n=0,o=e;n<o.length;n++)null==(i=o[n])&&(i=""),t+=""+i;return[2,t]}))}))},t}(n(49).BaseMethod);t.StrConcat=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.required_arguments=function(){return[["string","string to get index from"],["string","char to find index of"]]},t.prototype.process_arguments=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,n,o;return r.__generator(this,(function(r){return t=-1,2==e.length&&(n=e[0],o=e[1],t=n.indexOf(o)),[2,t]}))}))},t}(n(49).BaseMethod);t.StrIndex=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.required_arguments=function(){return[["string","string to get range from"],["integer","range start"],["integer","range size"]]},t.prototype.process_arguments=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,n,o,i;return r.__generator(this,(function(r){return t="",n=e[0],o=e[1]||0,i=e[2]||1,n&&(t=n.substr(o,i)),[2,t]}))}))},t}(n(49).BaseMethod);t.StrSub=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=function(e){function t(t){var n=e.call(this,t)||this;return n.param=t,n}return r.__extends(t,e),t.prototype.parse_tree=function(e){if(null==e.error_message&&e.node)try{return this.traverse_node(e.node)}catch(e){this.set_error("could not traverse tree")}else this.set_error("cannot parse tree")},t.prototype.traverse_CallExpression=function(e){var t=this,n=""+e.arguments.map((function(e){return t.traverse_node(e)})).join(", ");return e.callee.name+"("+n+")"},t.prototype.traverse_UnaryExpression=function(e){return""+e.operator+this.traverse_node(e.argument)},t.prototype.traverse_Identifier=function(e){return""+e.name},t}(n(229).BaseTraverser);t.ExpressionStringGenerator=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this.param=e,this.cyclic_graph_detected=!1,this.method_dependencies=[]}return e.prototype.set_error=function(e){this.error_message=this.error_message||e},e.prototype.reset=function(){this.param.graph_disconnect_predecessors(),this.method_dependencies.forEach((function(e){e.reset()})),this.method_dependencies=[]},e.prototype.update=function(e){this.cyclic_graph_detected=!1,this.connect_immutable_dependencies(e),this.method_dependencies=e.method_dependencies,this.handle_method_dependencies(),this.listen_for_name_changes()},e.prototype.connect_immutable_dependencies=function(e){var t=this;e.immutable_dependencies.forEach((function(e){if(0==t.cyclic_graph_detected&&0==t.param.add_graph_input(e))return t.cyclic_graph_detected=!0,t.set_error("cannot create expression, infinite graph detected"),void t.reset()}))},e.prototype.handle_method_dependencies=function(){var e=this;this.method_dependencies.forEach((function(t){0==e.cyclic_graph_detected&&e.handle_method_dependency(t)}))},e.prototype.handle_method_dependency=function(e){var t=e.resolved_graph_node;if(t&&!this.param.add_graph_input(t))return this.cyclic_graph_detected=!0,this.set_error("cannot create expression, infinite graph detected"),void this.reset()},e.prototype.listen_for_name_changes=function(){this.method_dependencies.forEach((function(e){e.listen_for_name_changes()}))},e}();t.DependenciesController=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(109),i=n(21),a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.type=function(){return i.ParamType.BUTTON},Object.defineProperty(t.prototype,"default_value_serialized",{get:function(){return this.default_value},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"value_serialized",{get:function(){return this.value},enumerable:!0,configurable:!0}),t.are_values_equal=function(e,t){return!0},t.prototype.press_button=function(){this.options.execute_callback()},t}(o.Single);t.ButtonParam=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(110),i=r.__importDefault(n(20)),a=n(6),s=n(21),_=["r","g","b"],u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._value=new a.Color,t}return r.__extends(t,e),t.type=function(){return s.ParamType.COLOR},Object.defineProperty(t,"component_names",{get:function(){return _},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"default_value_serialized",{get:function(){return i.default(this.default_value)?this.default_value:this.default_value.toArray()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"value_serialized",{get:function(){return this.value.toArray()},enumerable:!0,configurable:!0}),t.are_values_equal=function(e,t){return e.equals(t)},t.prototype.init_components=function(){e.prototype.init_components.call(this),this.r=this.components[0],this.g=this.components[1],this.b=this.components[2]},t.prototype.set_value_from_components=function(){this._value.r=this.r.value,this._value.g=this.g.value,this._value.b=this.b.value},t}(o.TypedMultipleParam);t.ColorParam=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=r.__importDefault(n(39)),i=n(166),a=n(21),s=n(45),_=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.type=function(){return a.ParamType.INTEGER},Object.defineProperty(t.prototype,"default_value_serialized",{get:function(){return this.default_value},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"value_serialized",{get:function(){return this.value},enumerable:!0,configurable:!0}),t.are_values_equal=function(e,t){return e==t},t.convert=function(e){if(o.default(e))return Math.round(e);if(s.CoreString.is_number(e)){var t=parseInt(e);if(o.default(t))return t}return null},t.prototype.convert=function(e){return t.convert(e)},t}(i.TypedNumericParam);t.IntegerParam=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,o=n(13),i=function(){function e(e,t){void 0===e&&(e=0),void 0===t&&(t=0),this._position=e,this._value=t}return e.prototype.to_json=function(){return{position:this._position,value:this._value}},Object.defineProperty(e.prototype,"position",{get:function(){return this._position},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0}),e.prototype.copy=function(e){this._position=e.position,this._value=e.value},e.prototype.clone=function(){var t=new e;return t.copy(this),t},e.prototype.is_equal=function(e){return this._position==e.position&&this._value==e.value},e.prototype.is_equal_json=function(e){return this._position==e.position&&this._value==e.value},e.prototype.from_json=function(e){this._position=e.position,this._value=e.value},e.are_equal_json=function(e,t){return e.position==t.position&&e.value==t.value},e.from_json=function(t){return new e(t.position,t.value)},e}();t.RampPoint=i,function(e){e.LINEAR="linear"}(r=t.RampInterpolation||(t.RampInterpolation={}));var a=function(){function e(e,t){void 0===e&&(e=r.LINEAR),void 0===t&&(t=[]),this._interpolation=e,this._points=t,this._uuid=o._Math.generateUUID()}return Object.defineProperty(e.prototype,"uuid",{get:function(){return this._uuid},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"interpolation",{get:function(){return this._interpolation},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"points",{get:function(){return this._points},enumerable:!0,configurable:!0}),e.from_json=function(t){for(var n=[],r=0,o=t.points;r<o.length;r++){var a=o[r];n.push(i.from_json(a))}return new e(t.interpolation,n)},e.prototype.to_json=function(){return{interpolation:this._interpolation,points:this._points.map((function(e){return e.to_json()}))}},e.prototype.clone=function(){var t=new e;return t.copy(this),t},e.prototype.copy=function(e){this._interpolation=e.interpolation;for(var t=0,n=0,r=e.points;n<r.length;n++){var o=r[n],i=this._points[t];i?i.copy(o):this._points.push(o.clone()),t+=1}},e.prototype.is_equal=function(e){if(this._interpolation!=e.interpolation)return!1;var t=e.points;if(this._points.length!=t.length)return!1;for(var n=0,r=0,o=this._points;r<o.length;r++){var i=o[r],a=t[n];if(!i.is_equal(a))return!1;n+=1}return!0},e.prototype.is_equal_json=function(e){if(this._interpolation!=e.interpolation)return!1;if(this._points.length!=e.points.length)return!1;for(var t=0,n=0,r=this._points;n<r.length;n++){var o=r[n],i=e.points[t];if(!o.is_equal_json(i))return!1;t+=1}return!0},e.are_json_equal=function(e,t){if(e.interpolation!=t.interpolation)return!1;if(e.points.length!=t.points.length)return!1;for(var n=0,r=0,o=e.points;r<o.length;r++){var a=o[r],s=t.points[n];if(!i.are_equal_json(a,s))return!1;n+=1}return!0},e.prototype.from_json=function(e){this._interpolation=e.interpolation;for(var t=0,n=0,r=e.points;n<r.length;n++){var o=r[n],a=this._points[t];a?a.from_json(o):this._points.push(i.from_json(o)),t+=1}},e}();t.RampValue=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(109),i=n(21),a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.type=function(){return i.ParamType.SEPARATOR},Object.defineProperty(t.prototype,"default_value_serialized",{get:function(){return this.default_value},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"value_serialized",{get:function(){return this.value},enumerable:!0,configurable:!0}),t.are_values_equal=function(e,t){return!0},t}(o.Single);t.SeparatorParam=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(110),i=r.__importDefault(n(20)),a=n(3),s=n(21),_=["x","y"],u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._value=new a.Vector2,t}return r.__extends(t,e),t.type=function(){return s.ParamType.VECTOR2},Object.defineProperty(t,"component_names",{get:function(){return _},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"default_value_serialized",{get:function(){return i.default(this.default_value)?this.default_value:this.default_value.toArray()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"value_serialized",{get:function(){return this.value.toArray()},enumerable:!0,configurable:!0}),t.are_values_equal=function(e,t){return e.equals(t)},t.prototype.init_components=function(){e.prototype.init_components.call(this),this.x=this.components[0],this.y=this.components[1]},t.prototype.set_value_from_components=function(){this._value.x=this.x.value,this._value.y=this.y.value},t}(o.TypedMultipleParam);t.Vector2Param=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(110),i=r.__importDefault(n(20)),a=n(1),s=n(21),_=["x","y","z"],u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._value=new a.Vector3,t}return r.__extends(t,e),t.type=function(){return s.ParamType.VECTOR3},Object.defineProperty(t,"component_names",{get:function(){return _},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"default_value_serialized",{get:function(){return i.default(this.default_value)?this.default_value:this.default_value.toArray()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"value_serialized",{get:function(){return this.value.toArray()},enumerable:!0,configurable:!0}),t.are_values_equal=function(e,t){return e.equals(t)},t.prototype.init_components=function(){e.prototype.init_components.call(this),this.x=this.components[0],this.y=this.components[1],this.z=this.components[2]},t.prototype.set_value_from_components=function(){this._value.x=this.x.value,this._value.y=this.y.value,this._value.z=this.z.value},t}(o.TypedMultipleParam);t.Vector3Param=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(110),i=r.__importDefault(n(20)),a=n(17),s=n(21),_=["x","y","z","w"],u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._value=new a.Vector4,t}return r.__extends(t,e),t.type=function(){return s.ParamType.VECTOR4},Object.defineProperty(t,"component_names",{get:function(){return _},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"default_value_serialized",{get:function(){return i.default(this.default_value)?this.default_value:this.default_value.toArray()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"value_serialized",{get:function(){return this.value.toArray()},enumerable:!0,configurable:!0}),t.are_values_equal=function(e,t){return e.equals(t)},t.prototype.init_components=function(){e.prototype.init_components.call(this),this.x=this.components[0],this.y=this.components[1],this.z=this.components[2],this.w=this.components[3]},t.prototype.set_value_from_components=function(){this._value.x=this.x.value,this._value.y=this.y.value,this._value.z=this.z.value,this._value.w=this.w.value},t}(o.TypedMultipleParam);t.Vector4Param=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(e){this.node=e};t.ParamsValueAccessor=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this._frame=0}return e.prototype.copy=function(e){this._frame=e.frame},Object.defineProperty(e.prototype,"frame",{get:function(){return this._frame},enumerable:!0,configurable:!0}),e}();t.ProcessingContext=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(583),o=n(584),i=n(586),a=function(){function e(e){this.node=e,this._connections=new r.ConnectionsController(this.node)}return Object.defineProperty(e.prototype,"connections",{get:function(){return this._connections},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"inputs",{get:function(){return this._inputs=this._inputs||new o.InputsController(this.node)},enumerable:!0,configurable:!0}),e.prototype.has_inputs=function(){return null!=this._inputs},Object.defineProperty(e.prototype,"outputs",{get:function(){return this._outputs=this._outputs||new i.OutputsController(this.node)},enumerable:!0,configurable:!0}),e.prototype.has_outputs=function(){return null!=this._outputs},e}();t.IOController=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2).__importDefault(n(85)),o=function(){function e(e){this._node=e,this._output_connections=new Map}return e.prototype.init_inputs=function(){var e=this._node.io.inputs.max_inputs_count;this._input_connections=new Array(e)},e.prototype.add_input_connection=function(e){this._input_connections?e.input_index<this._input_connections.length?this._input_connections[e.input_index]=e:console.warn("attempt to add an input connection at index "+e.input_index):console.warn("input connections array not initialized")},e.prototype.remove_input_connection=function(e){this._input_connections?e.input_index<this._input_connections.length?this._input_connections[e.input_index]=void 0:console.warn("attempt to remove an input connection at index "+e.input_index):console.warn("input connections array not initialized")},e.prototype.input_connection=function(e){if(this._input_connections)return this._input_connections[e]},e.prototype.first_input_connection=function(){return r.default(this._input_connections)[0]},e.prototype.last_input_connection=function(){var e=r.default(this._input_connections);return e[e.length-1]},e.prototype.input_connections=function(){return this._input_connections},e.prototype.add_output_connection=function(e){var t=e.output_index,n=e.id,r=this._output_connections.get(t);r||(r=new Map,this._output_connections.set(t,r)),r.set(n,e)},e.prototype.remove_output_connection=function(e){var t=e.output_index,n=e.id,r=this._output_connections.get(t);r&&r.delete(n)},e.prototype.output_connections=function(){var e=[];return this._output_connections.forEach((function(t,n){t.forEach((function(t,n){t&&e.push(t)}))})),e},e}();t.ConnectionsController=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=r.__importDefault(n(154)),i=r.__importDefault(n(38)),a=n(585),s=n(61),_=n(48),u=n(19),c=n(167),p=function(){function e(e){this.node=e,this._graph_node_inputs=[],this._inputs=[],this._has_named_inputs=!1,this._min_inputs_count=0,this._max_inputs_count=0,this._depends_on_inputs=!0,this._override_clonable_state=!1}return e.displayed_input_names=function(){return[]},e.prototype.set_depends_on_inputs=function(e){this._depends_on_inputs=e},e.prototype.set_min_inputs_count=function(e){this._min_inputs_count=e},e.prototype.set_max_inputs_count=function(e){this._max_inputs_count=e,this.init_graph_node_inputs()},e.prototype.set_named_input_connection_points=function(e){this._has_named_inputs=!0,this._named_input_connection_points=e,this.set_min_inputs_count(0),this.set_max_inputs_count(e.length),this.init_graph_node_inputs(),this.node.emit(_.NodeEvent.NAMED_INPUTS_UPDATED)},Object.defineProperty(e.prototype,"has_named_inputs",{get:function(){return this._has_named_inputs},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"named_input_connection_points",{get:function(){return this._named_input_connection_points||[]},enumerable:!0,configurable:!0}),e.prototype.init_graph_node_inputs=function(){for(var e=0;e<this._max_inputs_count;e++)this._graph_node_inputs[e]=this._graph_node_inputs[e]||this._create_graph_node_input(e)},e.prototype._create_graph_node_input=function(e){var t=new s.CoreGraphNode(this.node.scene,"input_"+e);return this.node.add_graph_input(t),t},Object.defineProperty(e.prototype,"max_inputs_count",{get:function(){return this._max_inputs_count||0},enumerable:!0,configurable:!0}),e.prototype.input_graph_node=function(e){return this._graph_node_inputs[e]},e.prototype.set_count=function(e,t){null==t&&(t=e),this.set_min_inputs_count(e),this.set_max_inputs_count(t),this.init_inputs_clonable_state(),this.init_connections_controller_inputs()},e.prototype.init_connections_controller_inputs=function(){this.node.io.connections.init_inputs()},e.prototype.eval_required_inputs_p=function(){return r.__awaiter(this,void 0,void 0,(function(){var e,t,n,o=this;return r.__generator(this,(function(r){switch(r.label){case 0:return e=[],this._max_inputs_count>0?(t=[],this.inputs().forEach((function(e,n){e&&t.push(n)})),t.length<this._min_inputs_count?(this.node.states.error.set("inputs are missing"),[3,3]):[3,1]):[3,3];case 1:return t.length>0?(n=t.map((function(e){return o.node.io.inputs.eval_required_input(e)})),[4,Promise.all(n)]):[3,3];case 2:e=r.sent(),r.label=3;case 3:return[2,e]}}))}))},e.prototype.eval_required_input=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,n,o;return r.__generator(this,(function(r){switch(r.label){case 0:return[4,this.node.container_controller.request_input_container(e)];case 1:return(t=r.sent())&&t.core_content()||(n=this.input(e))&&(o=n.states.error.message,this.node.states.error.set("input "+e+" is invalid (error: "+o+")")),[2,t]}}))}))},e.prototype.get_named_input_index=function(e){if(this._named_input_connection_points)for(var t=0;t<this._named_input_connection_points.length;t++)if(this._named_input_connection_points[t].name==e)return t;return-1},e.prototype.get_input_index=function(e){if(i.default(e)){if(this.has_named_inputs)return this.get_named_input_index(e);throw new Error("node "+this.node.full_path()+" has no named inputs")}return e},e.prototype.set_input=function(e,t,n){void 0===n&&(n=0);var r=this.get_input_index(e)||0,o=0;t&&t.io.outputs.has_named_outputs&&(o=t.io.outputs.get_output_index(n)||0);var i=this._graph_node_inputs[r];if(null==i)throw"graph_input_node not found at index "+r;if(!t||this.node.parent==t.parent){var s=this._inputs[r],u=null,c=void 0;this.node.io.connections&&(c=this.node.io.connections.input_connection(r)),c&&(u=c.output_index),t===s&&o==u||(null!=s&&this._depends_on_inputs&&i.remove_graph_input(s),null!=t?i.add_graph_input(t)?(this._depends_on_inputs||i.remove_graph_input(t),c&&c.disconnect({set_input:!1}),this._inputs[r]=t,new a.NodeConnection(t,this.node,o,r)):console.warn("cannot connect "+t.full_path()+" to "+this.node.full_path()):(this._inputs[r]=null,c&&c.disconnect({set_input:!1})),this.post_set_input(),this.node.set_dirty(t),this.node.emit(_.NodeEvent.INPUTS_UPDATED))}},e.prototype.post_set_input=function(){},e.prototype.remove_input=function(e){var t=this;o.default(this.inputs(),(function(n,r){null!=n&&null!=e&&n.graph_node_id===e.graph_node_id&&t.set_input(r,null)}))},e.prototype.input=function(e){return this._inputs[e]},e.prototype.named_input=function(e){if(this.has_named_inputs){var t=this.get_input_index(e);return this._inputs[t]}return null},e.prototype.named_input_connection_point=function(e){if(this.has_named_inputs&&this._named_input_connection_points){var t=this.get_input_index(e);return this._named_input_connection_points[t]}},e.prototype.has_named_input=function(e){return this.get_named_input_index(e)>=0},e.prototype.has_input=function(e){return null!=this._inputs[e]},e.prototype.inputs=function(){return this._inputs},e.prototype.override_clonable_state_allowed=function(){for(var e=!1,t=0,n=this.inputs_clonable_state();t<n.length;t++){n[t]==u.InputCloneMode.FROM_NODE&&(e=!0)}return e},e.prototype.inputs_clonable_state=function(){return this._inputs_clonable_states=this._inputs_clonable_states||this.init_inputs_clonable_state()},e.prototype.input_cloned=function(e){return this.input_clonable_state_with_override(e)},e.prototype.inputs_clonable_state_with_override=function(){for(var e=[],t=this.inputs_clonable_state(),n=0;n<t.length;n++)e.push(this.input_clonable_state_with_override(n));return e},e.prototype.input_clonable_state_with_override=function(e){var t=this.inputs_clonable_state()[e];switch(t){case u.InputCloneMode.ALWAYS:return!0;case u.InputCloneMode.NEVER:return!1;case u.InputCloneMode.FROM_NODE:return!this._override_clonable_state}return c.TypeAssert.unreachable(t)},e.prototype.init_inputs_clonable_state=function(e){return void 0===e&&(e=null),e&&(this._user_inputs_clonable_states=e),this._inputs_clonable_states=this._user_inputs_clonable_states||this._default_inputs_clonale_state_values(),this._inputs_clonable_states},e.prototype._default_inputs_clonale_state_values=function(){for(var e=[],t=0;t<this._max_inputs_count;t++)e.push(u.InputCloneMode.ALWAYS);return e},e.prototype.set_override_clonable_state=function(e){this._override_clonable_state=e,this.node.emit(_.NodeEvent.OVERRIDE_CLONABLE_STATE_UPDATE)},e.prototype.override_clonable_state=function(){return this._override_clonable_state},e}();t.InputsController=p},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(t,n,r,o){void 0===r&&(r=0),void 0===o&&(o=0),this._node_src=t,this._node_dest=n,this._output_index=r,this._input_index=o,this._id=e._next_id++,this._node_src.io.connections&&this._node_dest.io.connections&&(this._node_src.io.connections.add_output_connection(this),this._node_dest.io.connections.add_input_connection(this))}return Object.defineProperty(e.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"node_src",{get:function(){return this._node_src},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"node_dest",{get:function(){return this._node_dest},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"output_index",{get:function(){return this._output_index},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"input_index",{get:function(){return this._input_index},enumerable:!0,configurable:!0}),e.prototype.disconnect=function(e){void 0===e&&(e={}),this._node_src.io.connections&&this._node_dest.io.connections&&(this._node_src.io.connections.remove_output_connection(this),this._node_dest.io.connections.remove_input_connection(this)),!0===e.set_input&&this._node_dest.io.inputs.set_input(this._input_index,null)},e._next_id=0,e}();t.NodeConnection=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=r.__importDefault(n(39)),i=r.__importDefault(n(88)),a=r.__importDefault(n(38)),s=n(48),_=function(){function e(e){this.node=e,this._has_outputs=!1,this._has_named_outputs=!1}return Object.defineProperty(e.prototype,"has_outputs",{get:function(){return this._has_outputs},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"has_named_outputs",{get:function(){return this._has_named_outputs},enumerable:!0,configurable:!0}),e.prototype.has_named_output=function(e){return this.get_named_output_index(e)>=0},Object.defineProperty(e.prototype,"named_output_connection_points",{get:function(){return this._named_output_connection_points||[]},enumerable:!0,configurable:!0}),e.prototype.named_output_connection=function(e){if(this._named_output_connection_points)return this._named_output_connection_points[e]},e.prototype.get_named_output_index=function(e){if(this._named_output_connection_points)for(var t=0;t<this._named_output_connection_points.length;t++)if(this._named_output_connection_points[t].name==e)return t;return-1},e.prototype.get_output_index=function(e){return e?a.default(e)?this.has_named_outputs?this.get_named_output_index(e):(console.warn("node "+this.node.full_path()+" has no named outputs"),-1):e:-1},e.prototype.named_output_connection_points_by_name=function(e){if(this._named_output_connection_points)return this._named_output_connection_points.filter((function(t){return t.name==e}))[0]},e.prototype.set_named_output_connection_points=function(e){this._has_named_outputs=!0,this._named_output_connection_points=e,this.node.scene&&this.node.set_dirty(this.node),this.node.emit(s.NodeEvent.NAMED_OUTPUTS_UPDATED)},e.prototype.used_output_names=function(){var e=this;if(this.node.io.connections){var t=i.default(this.node.io.connections.output_connections().map((function(e){return e?e.output_index:null}))),n=[];return t.forEach((function(e){o.default(e)&&n.push(e)})),n.map((function(t){return e.named_output_connection_points[t].name}))}return[]},e}();t.OutputsController=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=r.__importDefault(n(297)),i=r.__importDefault(n(313)),a=r.__importDefault(n(289)),s=r.__importDefault(n(305)),_=n(48),u=function(e){function t(t){var n=e.call(this)||this;return n._node=t,n._node_ids=[],n}return r.__extends(t,e),t.prototype.node=function(){return this._node},t.prototype.clear=function(){this._node_ids=[]},t.prototype.nodes=function(){return this._node.scene.graph.nodes_from_ids(this._node_ids)},t.prototype.contains=function(e){return this._node_ids.includes(e.graph_node_id)},t.prototype.equals=function(e){var t=e.map((function(e){return e.graph_node_id})).sort();return s.default(t,this._node_ids)},t.prototype.set=function(e){return this.remove(this.nodes()),this.add(e)},t.prototype.add=function(e){var t=e.map((function(e){return e.graph_node_id}));return this._node_ids=a.default(this._node_ids,t),this.update_nodes_ui_data(e)},t.prototype.remove=function(e){var t=e.map((function(e){return e.graph_node_id}));this._node_ids=i.default(this._node_ids,t),this.update_nodes_ui_data(e)},t.prototype.update_nodes_ui_data=function(e){this.node().emit(_.NodeEvent.SELECTION_UPDATED)},t.prototype.to_json=function(){return this._node_ids},t}(o.default);t.default=u},,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(e){this.node=e};t.ParamsAccessor=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.set_content=function(t){e.prototype.set_content.call(this,t)},t}(n(99).TypedContainer);t.ManagerContainer=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=r.__importDefault(n(88)),i=r.__importDefault(n(203)),a=r.__importDefault(n(96)),s=n(592),_=function(){function e(){this._started=!1,this._start_time=0,this._previous_timestamp=0,this._nodes_cook_data={},this._durations_by_name={},this._durations_count_by_name={}}return e.prototype.profile=function(e,t){var n=performance.now();t();var r=performance.now()-n;console.log(e+": "+r)},e.prototype.start=function(){this._started||(this.reset(),this._started=!0,this._start_time=performance.now(),this._nodes_cook_data={},this._previous_timestamp=this._start_time)},e.prototype.stop=function(){this.reset()},e.prototype.reset=function(){this._started=!1,this._start_time=null,this._durations_by_name={},this._durations_count_by_name={},this._nodes_cook_data={}},Object.defineProperty(e.prototype,"started",{get:function(){return this._started},enumerable:!0,configurable:!0}),e.prototype.record_node_cook_data=function(e){var t=e.graph_node_id;null==this._nodes_cook_data[t]&&(this._nodes_cook_data[t]=new s.PerformanceNode(e)),this._nodes_cook_data[t].update_cook_data()},e.prototype.record=function(e){this.started||this.start();var t=performance.now();return null==this._durations_by_name[e]&&(this._durations_by_name[e]=0),this._durations_by_name[e]+=t-this._previous_timestamp,null==this._durations_count_by_name[e]&&(this._durations_count_by_name[e]=0),this._durations_count_by_name[e]+=1,this._previous_timestamp=t},e.prototype.print=function(){this.print_node_cook_data(),this.print_recordings()},e.prototype.print_node_cook_data=function(){var e=Object.values(this._nodes_cook_data),t=(e=a.default(e,(function(e){return-e.cook_time_total}))).map((function(e){return e.print_object()}));console.log("--------------- NODES COOK TIME -----------");for(var n=[],r=0,o=a.default(t,(function(e){return-e.cook_time_total}));r<o.length;r++){var i=o[r];n.push(i)}return console.table(n),t},e.prototype.print_recordings=function(){for(var e=i.default(this._durations_by_name),t=i.default(this._durations_count_by_name),n=[],r={},a=0,s=Object.keys(e);a<s.length;a++){var _=s[a],u=e[_];n.push(u),null==r[u]&&(r[u]=[]),r[u].push(_)}n.sort((function(e,t){return e-t}));var c=o.default(n);console.log("--------------- PERF RECORDINGS -----------");for(var p=[],l=0,d=c;l<d.length;l++)for(var h=0,f=r[u=d[l]];h<f.length;h++){var m=f[h],y=t[m],v={duration:u,name:m,count:y,duration_per_iteration:u/y};p.push(v)}return console.table(p),p},e}();t.CorePerformance=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this._node=e,this._cooks_count=0,this._cook_time_total=0,this._cook_time_total_with_inputs=0,this._cook_time_total_params=0}return e.prototype.update_cook_data=function(){this._cooks_count+=1,this._cook_time_total+=this._node.cook_controller.cook_time,this._cook_time_total_with_inputs+=this._node.cook_controller.cook_time_with_inputs,this._cook_time_total_params+=this._node.cook_controller.cook_time_params},Object.defineProperty(e.prototype,"cook_time_total",{get:function(){return this._cook_time_total},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cook_time_per_iteration",{get:function(){return this._cooks_count>0?this._cook_time_total/this._cooks_count:0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cook_time_total_with_inputs",{get:function(){return this._cook_time_total_with_inputs},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cook_time_total_with_inputs_per_iteration",{get:function(){return this._cooks_count>0?this._cook_time_total_with_inputs/this._cooks_count:0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cook_time_total_params",{get:function(){return this._cook_time_total_params},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cook_time_total_params_per_iteration",{get:function(){return this._cooks_count>0?this._cook_time_total_params/this._cooks_count:0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cooks_count",{get:function(){return this._cooks_count},enumerable:!0,configurable:!0}),e.prototype.print_object=function(){return{full_path:this._node.full_path(),cooks_count:this.cooks_count,cook_time_total:this.cook_time_total,cook_time_per_iteration:this.cook_time_per_iteration,cook_time_total_with_inputs:this.cook_time_total_with_inputs,cook_time_total_with_inputs_per_iteration:this.cook_time_total_with_inputs_per_iteration,cook_time_total_params:this.cook_time_total_params,cook_time_total_params_per_iteration:this.cook_time_total_params_per_iteration}},e}();t.PerformanceNode=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(61),o=n(594),i=function(){function e(e){this.scene=e,this.self=this,this._frame=1,this._frame_range=[1,600],this._frame_range_locked=[!0,!0],this._playing=!1,this._fps=60,this._frame_interval=1e3/60,this._graph_node=new r.CoreGraphNode(e,"time controller")}return Object.defineProperty(e.prototype,"graph_node",{get:function(){return this._graph_node},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fps",{get:function(){return this._fps},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"frame",{get:function(){return this._frame},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"time",{get:function(){return this._frame/this._fps},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"frame_range",{get:function(){return this._frame_range},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"frame_range_locked",{get:function(){return this._frame_range_locked},enumerable:!0,configurable:!0}),e.prototype.set_frame_range=function(e,t){this._frame_range=[Math.floor(e),Math.floor(t)],this.scene.events_controller.dispatch(this._graph_node,o.SceneEvent.FRAME_RANGE_UPDATED)},e.prototype.set_frame_range_locked=function(e,t){this._frame_range_locked=[e,t],this.scene.events_controller.dispatch(this._graph_node,o.SceneEvent.FRAME_RANGE_UPDATED)},e.prototype.set_fps=function(e){this._fps=Math.floor(e),this._frame_interval=1e3/this._fps,this.scene.events_controller.dispatch(this._graph_node,o.SceneEvent.FRAME_RANGE_UPDATED)},e.prototype.set_frame=function(e){(e=this._ensure_frame_within_bounds(e))!=this.frame&&(this._frame=e,this.scene.events_controller.dispatch(this._graph_node,o.SceneEvent.FRAME_UPDATED),this.scene.uniforms_controller.update_frame_dependent_uniform_owners(),this.graph_node.set_successors_dirty())},e.prototype.increment_frame=function(){this.set_frame(this.frame+1)},e.prototype.decrement_frame=function(){this.set_frame(this.frame-1)},e.prototype.set_first_frame=function(){this.set_frame(this.frame_range[0])},e.prototype._ensure_frame_within_bounds=function(e){return this._frame_range_locked[0]&&e<this._frame_range[0]&&(e=this._frame_range[1]),this._frame_range_locked[1]&&e>this._frame_range[1]&&(e=this._frame_range[0]),e},Object.defineProperty(e.prototype,"playing",{get:function(){return!0===this._playing},enumerable:!0,configurable:!0}),e.prototype.pause=function(){this._playing=!1,this.scene.events_controller.dispatch(this._graph_node,o.SceneEvent.PLAY_STATE_UPDATED)},e.prototype.play=function(){!0!==this._playing&&setTimeout(this.play_next_frame.bind(this),this._frame_interval),this._playing=!0,this.scene.events_controller.dispatch(this._graph_node,o.SceneEvent.PLAY_STATE_UPDATED)},e.prototype.toggle_play_pause=function(){this.playing?this.pause():this.play()},e.prototype.play_next_frame=function(){this.playing&&(this.scene.root.are_children_cooking()||this.increment_frame(),setTimeout(this.play_next_frame.bind(this),this._frame_interval))},e}();t.TimeController=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.FRAME_RANGE_UPDATED="scene_frame_range_updated",e.FRAME_UPDATED="scene_frame_updated",e.PLAY_STATE_UPDATED="scene_play_state_updated"}(t.SceneEvent||(t.SceneEvent={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this.scene=e}return e.prototype.to_json=function(e){void 0===e&&(e=!1);for(var t={},n={},r=0,o=this.scene.nodes_controller.all_nodes();r<o.length;r++){var i=o[r];t[i.graph_node_id]=i.to_json(e);for(var a=0,s=i.params.all;a<s.length;a++){var _=s[a];n[_.graph_node_id]=_.to_json()}}return{nodes_by_graph_node_id:t,params_by_graph_node_id:n}},e}();t.Serializer=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=function(){function e(e){this.scene=e,this._frame_dependent_uniform_owners={},this._frame_dependent_uniform_owners_ids=null,this._resolution=new r.Vector2(1,1),this._resolution_dependent_uniform_owners={},this._resolution_dependent_uniform_owners_ids=[]}return e.prototype.add_frame_dependent_uniform_owner=function(e,t){this._frame_dependent_uniform_owners[e]=t,this._update_frame_dependent_uniform_owners_ids()},e.prototype.remove_frame_dependent_uniform_owner=function(e){delete this._frame_dependent_uniform_owners[e],this._update_frame_dependent_uniform_owners_ids()},e.prototype._update_frame_dependent_uniform_owners_ids=function(){this._frame_dependent_uniform_owners_ids=Object.keys(this._frame_dependent_uniform_owners)},e.prototype.update_frame_dependent_uniform_owners=function(){var e=this.scene.frame;if(this._frame_dependent_uniform_owners_ids)for(var t=0,n=this._frame_dependent_uniform_owners_ids;t<n.length;t++){var r=n[t];this._frame_dependent_uniform_owners[r].frame.value=e}},e.prototype.add_resolution_dependent_uniform_owner=function(e,t){this._resolution_dependent_uniform_owners[e]=t,this._update_resolution_dependent_uniform_owners_ids(),this._resolution&&this.update_resolution_dependent_uniforms(t)},e.prototype.remove_resolution_dependent_uniform_owner=function(e){delete this._resolution_dependent_uniform_owners[e],this._update_resolution_dependent_uniform_owners_ids()},e.prototype._update_resolution_dependent_uniform_owners_ids=function(){this._resolution_dependent_uniform_owners_ids=Object.keys(this._resolution_dependent_uniform_owners)},e.prototype.update_resolution_dependent_uniform_owners=function(e){this._resolution.copy(e);for(var t=0,n=this._resolution_dependent_uniform_owners_ids;t<n.length;t++){var r=n[t],o=this._resolution_dependent_uniform_owners[r];this.update_resolution_dependent_uniforms(o)}},e.prototype.update_resolution_dependent_uniforms=function(e){e.resolution.value.x=this._resolution.x*window.devicePixelRatio,e.resolution.value.y=this._resolution.y*window.devicePixelRatio},e}();t.UniformsController=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(54),o=function(){function e(){this._require_webgl2=!1}return e.prototype.require_webgl2=function(){return this._require_webgl2},e.prototype.set_require_webgl2=function(){this._require_webgl2||(this._require_webgl2=!0,r.POLY.renderers_controller.set_require_webgl2())},e}();t.WebGLController=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(599),o=n(631),i=n(636),a=n(640),s=n(676),_=n(54);r.CopRegister.run(_.POLY),o.GlRegister.run(_.POLY),i.MatRegister.run(_.POLY),a.ObjRegister.run(_.POLY),s.SopRegister.run(_.POLY)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(133),o=n(231),i=n(602),a=function(){function e(){}return e.run=function(e){e.register_node(o.FileCopNode,r.CATEGORY_COP.INPUT),e.register_node(i.BuilderCopNode,r.CATEGORY_COP.ADVANCED)},e}();t.CopRegister=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.set_content=function(t){e.prototype.set_content.call(this,t)},t.prototype.texture=function(){return this._content},t.prototype.core_content=function(){return this._content},t.prototype.core_content_cloned=function(){var e;return null===(e=this._content)||void 0===e?void 0:e.clone()},t.prototype.object=function(){return this.texture()},t.prototype.infos=function(){if(null!=this._content)return[this._content]},t.prototype.resolution=function(){return this._content&&this._content.image?[this._content.image.width,this._content.image.height]:[-1,-1]},t}(n(99).TypedContainer);t.TextureContainer=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(232),i=n(247),a=n(86),s=n(233),_=function(){function e(e,t){this._node=e,this._param=t}return e.prototype.load_texture_from_url_or_op=function(t){return r.__awaiter(this,void 0,void 0,(function(){var n,o,i,_;return r.__generator(this,(function(r){switch(r.label){case 0:return n=null,"op:"!=t.substring(0,3)?[3,6]:(i=t.substring(3),(o=a.CoreWalker.find_node(this._node,i))?o instanceof s.BaseCopNodeClass?[4,o.request_container()]:[3,2]:[3,4]);case 1:return _=r.sent(),n=_.texture(),[3,3];case 2:this._node.states.error.set("found node is not a texture node"),r.label=3;case 3:return[3,5];case 4:this._node.states.error.set("no node found in path '"+i+"'"),r.label=5;case 5:return[3,8];case 6:return[4,this.load_url(t)];case 7:(n=r.sent())?this._param.options.texture_as_env()||(n=e.set_texture_for_mapping(n)):this._node.states.error.set("could not load texture "+t),r.label=8;case 8:return o&&this._param.graph_predecessors()[0]!=o&&(this._param.graph_disconnect_predecessors(),this._param.add_graph_input(o)),[2,n]}}))}))},e.prototype.load_url=function(t){return r.__awaiter(this,void 0,void 0,(function(){var n=this;return r.__generator(this,(function(o){return[2,new Promise((function(o,i){return r.__awaiter(n,void 0,void 0,(function(){var n;return r.__generator(this,(function(r){switch(r.label){case 0:return n=e._ext(t),e.VIDEO_EXTENSIONS.includes(n)?[4,this._load_as_video(t)]:[3,2];case 1:return[2,r.sent()];case 2:this.loader_for_ext(n).then((function(e){e.load(t,o,void 0,(function(e){console.warn("error",e),i()}))})),r.label=3;case 3:return[2]}}))}))}))]}))}))},e.prototype.loader_for_ext=function(t){return r.__awaiter(this,void 0,void 0,(function(){var n;return r.__generator(this,(function(r){return n=t.toLowerCase(),e.SCRIPT_URL_BY_EXT[n],[2,new i.TextureLoader]}))}))},e.prototype._load_as_video=function(t){return new Promise((function(n,r){var i=document.createElement("video");i.setAttribute("crossOrigin","anonymous"),i.setAttribute("autoplay",""+!0),i.setAttribute("loop",""+!0),i.onloadedmetadata=function(){i.pause();var e=new o.VideoTexture(i);n(e)};var a=document.createElement("source"),s=e._ext(t),_=e.VIDEO_SOURCE_TYPE_BY_EXT[s];_=_||e._default_video_source_type(t),a.setAttribute("type",_),a.setAttribute("src",t),i.appendChild(a)}))},e._default_video_source_type=function(e){return"video/"+this._ext(e)},e.pixel_data=function(e){var t=e.image,n=document.createElement("canvas");n.width=t.width,n.height=t.height;var r=n.getContext("2d");if(r)return r.drawImage(t,0,0,t.width,t.height),r.getImageData(0,0,t.width,t.height)},e._ext=function(e){var t=e.split(".");return t[t.length-1].toLowerCase()},e.set_texture_for_mapping=function(e){return e},e.PARAM_DEFAULT="/examples/textures/uv.jpg",e.PARAM_ENV_DEFAULT="/examples/textures/piz_compressed.exr",e.VIDEO_EXTENSIONS=["mp4","webm","ogv"],e.VIDEO_SOURCE_TYPE_BY_EXT={ogg:'video/ogg; codecs="theora, vorbis"',ogv:'video/ogg; codecs="theora, vorbis"',mp4:'video/mp4; codecs="avc1.42E01E, mp4a.40.2"'},e.SCRIPT_URL_BY_EXT={exr:"EXRLoader",basis:"BasisTextureLoader"},e.THREE_LOADER_BY_EXT={exr:"EXRLoader",basis:"BasisTextureLoader"},e}();t.CoreTextureLoader=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(373),i=n(64),a=n(34),s=n(78),_=n(0),u=n(56),c=n(0),p=n(23),l=n(0),d=n(0),h=n(184),f=n(0),m=n(82),y=n(233),v=n(603),g=n(622),b="\nvoid main()\t{\n\tgl_Position = vec4( position, 1.0 );\n}\n",P=n(7),O=n(320),C=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.resolution=P.ParamConfig.VECTOR2([256,256]),t}return r.__extends(t,e),t}(P.NodeParamsConfig)),E=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=C,t._assembler_controller=new v.GlAssemblerController(t,g.ShaderAssemblerTexture),t._texture_mesh=new p.Mesh(new u.PlaneBufferGeometry(2,2)),t._fragment_shader="",t._uniforms={},t._texture_material=new a.ShaderMaterial({uniforms:{},vertexShader:b,fragmentShader:""}),t._texture_scene=new s.Scene,t._texture_camera=new m.Camera,t._render_target=t._create_render_target(),t._renderer=t._create_renderer(t._render_target),t._pixelBuffer=new Float32Array,t}return r.__extends(t,e),t.type=function(){return"builder"},Object.defineProperty(t.prototype,"assembler_controller",{get:function(){return this._assembler_controller},enumerable:!0,configurable:!0}),t.prototype.initialize_node=function(){this._texture_mesh.material=this._texture_material,this._texture_scene.add(this._texture_mesh),this._texture_camera.position.z=1,this.dirty_controller.add_post_dirty_hook(this._reset_if_resolution_changed.bind(this))},t.prototype.create_node=function(t){return e.prototype.create_node.call(this,t)},t.prototype.children=function(){return e.prototype.children.call(this)},t.prototype.nodes_by_type=function(t){return e.prototype.nodes_by_type.call(this,t)},t.prototype._reset_if_resolution_changed=function(e){e&&e.graph_node_id==this.p.resolution.graph_node_id&&this._reset()},t.prototype._reset=function(){this._render_target=this._create_render_target(),this._renderer=this._create_renderer(this._render_target);var e=this.pv.resolution.x,t=this.pv.resolution.y;this._pixelBuffer=new Float32Array(e*t*4)},t.prototype.cook=function(){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(e){return this.compile_if_required(),this.render_on_target(),[2]}))}))},t.prototype.shaders_by_name=function(){return{fragment:this._fragment_shader}},t.prototype.compile_if_required=function(){return r.__awaiter(this,void 0,void 0,(function(){var e,t;return r.__generator(this,(function(n){switch(n.label){case 0:return this.assembler_controller.compile_required()?[4,this.run_assembler()]:[3,2];case 1:n.sent(),e=this.assembler_controller.assembler.fragment_shader(),t=this.assembler_controller.assembler.uniforms(),e&&t?(this._fragment_shader=e,this._uniforms=t):console.warn("no fragment_shader from assembler"),n.label=2;case 2:return[2]}}))}))},t.prototype.run_assembler=function(){return r.__awaiter(this,void 0,void 0,(function(){var e,t;return r.__generator(this,(function(n){switch(n.label){case 0:return(e=this.assembler_controller.find_output_node())?(t=new O.GlobalsGeometryHandler,this.assembler_controller.set_assembler_globals_handler(t),this.assembler_controller.set_root_nodes([e]),[4,this.assembler_controller.compile()]):[3,2];case 1:n.sent(),this.assembler_controller.assembler.frame_dependent()?this.states.time_dependent.force_time_dependent():this.states.time_dependent.unforce_time_dependent(),n.label=2;case 2:return this._texture_material.fragmentShader=this._fragment_shader,this._texture_material.uniforms=this._uniforms,this._texture_material.needsUpdate=!0,this._texture_material.uniforms.resolution={value:this.pv.resolution},[2]}}))}))},t.prototype._create_renderer=function(e){var t=new o.WebGLRenderer({antialias:!0});return t.setPixelRatio(window.devicePixelRatio),t.autoClear=!1,t.setRenderTarget(e),t},t.prototype.render_on_target=function(){var e=this.pv.resolution.x,t=this.pv.resolution.y;this._renderer.clear(),this._renderer.render(this._texture_scene,this._texture_camera),this._renderer.readRenderTargetPixels(this._render_target,0,0,e,t,this._pixelBuffer),this._texture=this._texture||new h.DataTexture(this._pixelBuffer,e,t,_.RGBAFormat,d.FloatType),this._texture.needsUpdate=!0,this.cook_controller.end_cook()},t.prototype._create_render_target=function(){var e=f.ClampToEdgeWrapping,t=f.ClampToEdgeWrapping,n=c.NearestFilter,r=c.NearestFilter;return new i.WebGLRenderTarget(this.pv.resolution.x,this.pv.resolution.y,{wrapS:e,wrapT:t,minFilter:n,magFilter:r,format:_.RGBAFormat,type:/(iPad|iPhone|iPod)/g.test(navigator.userAgent)?l.HalfFloatType:d.FloatType,stencilBuffer:!1,depthBuffer:!1})},t}(y.TypedCopNode);t.BuilderCopNode=E},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=r.__importDefault(n(604)),i=r.__importDefault(n(316)),a=r.__importDefault(n(313)),s=n(3),_=n(55),u=n(234),c=n(169),p=n(48),l=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.create_node=function(t){return e.prototype.create_node.call(this,t)},t.prototype.children=function(){return e.prototype.children.call(this)},t.prototype.nodes_by_type=function(t){return e.prototype.nodes_by_type.call(this,t)},t}(_.TypedNode);t.AssemblerControllerNode=l;var d=function(){function e(e,t){this.node=e,this._compile_required=!0,this._shaders_by_name=new Map,this._deleted_params_data=new Map,this._new_params=[],this.node.lifecycle.add_create_hook(this.on_create),this._assembler=new t(this.node)}return e.prototype.set_assembler_globals_handler=function(e){(this._globals_handler?this._globals_handler.id():null)!=(e?e.id():null)&&(this._globals_handler=e,this.set_compilation_required_and_dirty(),this._assembler.reset_configs())},Object.defineProperty(e.prototype,"assembler",{get:function(){return this._assembler},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"shaders_by_name",{get:function(){return this._shaders_by_name},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"globals_handler",{get:function(){return this._globals_handler},enumerable:!0,configurable:!0}),e.prototype.add_output_params=function(e){this._assembler.add_output_params(e)},e.prototype.add_globals_params=function(e){this._assembler.add_globals_params(e)},e.prototype.allow_attribute_exports=function(){return this._assembler.allow_attribute_exports()},e.prototype.on_create=function(){var e=this.node.create_node("globals"),t=this.node.create_node("output");e.ui_data.set_position(new s.Vector2(-200,0)),t.ui_data.set_position(new s.Vector2(200,0))},e.prototype.set_compilation_required=function(){this._compile_required=!0},e.prototype.set_compilation_required_and_dirty=function(){this.set_compilation_required(),this.node.set_dirty()},e.prototype.compile_required=function(){return this._compile_required},e.prototype.set_root_nodes=function(e){this.assembler.set_root_nodes(e)},e.prototype.set_node_lines_globals=function(e,t){this.assembler.set_node_lines_globals(e,t)},e.prototype.set_node_lines_output=function(e,t){this.assembler.set_node_lines_output(e,t)},e.prototype.set_node_lines_attribute=function(e,t){this.assembler.set_node_lines_attribute(e,t)},e.prototype.compile=function(){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(e){return this._compile_required?(this.assembler.compile(),this.create_spare_parameters(),this._compile_required=!1,[2]):[2]}))}))},e.prototype.find_output_node=function(){var e=this.node.nodes_by_type("output");return e.length>1&&this.node.states.error.set("only one output node allowed"),e[0]},e.prototype.find_attribute_export_nodes=function(){return this.node.nodes_by_type("attribute").filter((function(e){return e.is_exporting}))},e.prototype.assign_uniform_values=function(){return r.__awaiter(this,void 0,void 0,(function(){var e,t;return r.__generator(this,(function(n){switch(n.label){case 0:if(!this._assembler)return[3,4];e=0,t=this._assembler.param_configs(),n.label=1;case 1:return e<t.length?[4,t[e].set_uniform_value(this.node)]:[3,4];case 2:n.sent(),n.label=3;case 3:return e++,[3,1];case 4:return[2]}}))}))},e.prototype.create_spare_parameters=function(){var e=this,t=this.node.params.spare_names,n=this._assembler.param_configs(),r=n.map((function(e){return e.name})),s=a.default(r,t),_=a.default(t,r);this._new_params=[];var l=this.node.params.names,d=i.default(s,l);if(d.length>0){var h=this.node.full_path()+" attempts to create spare params called '"+d.join(", ")+"' with same name as params";console.warn(h),this.node.states.error.set(h)}_.forEach((function(t){var n=e.node.params.get(t);if(n){var r=c.JsonExportDispatcher.dispatch_param(n);if(r.required){var o=r.data();e._deleted_params_data.set(n.name,o)}}e.node.params.delete_param(t)}));for(var f=0,m=n;f<m.length;f++){var y=m[f];if(s.indexOf(y.name)>=0){var v=o.default(y.param_options,{spare:!0,cook:!0}),g=this.node.add_param(y.type,y.name,y.default_value,v);if(g){var b=this._deleted_params_data.get(g.name);b&&u.JsonImportDispatcher.dispatch_param(g).process_data(b),this._new_params.push(g)}}}(s.length>0||_.length>0)&&this.node.emit(p.NodeEvent.PARAMS_UPDATED)},e}();t.GlAssemblerController=d},,,,,,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2).__importDefault(n(38)),o=n(3),i=n(234),a=function(){function e(e){this._node=e}return e.prototype.process_data=function(e){if(this.create_nodes(e.nodes),this.set_selection(e.selection),this._node.io.inputs.override_clonable_state_allowed()){var t=e.override_clonable_state;t&&this._node.io.inputs.set_override_clonable_state(t)}this.set_flags(e),this.set_params(e.params),this.from_data_custom(e)},e.prototype.process_inputs_data=function(e){this.set_inputs(e.inputs)},e.prototype.process_ui_data=function(e){if(e){var t=this._node.ui_data,n=e.pos;if(n){var r=(new o.Vector2).fromArray(n);t.set_position(r)}var i=e.comment;i&&t.set_comment(i),this.process_nodes_ui_data(e.nodes)}},e.prototype.create_nodes=function(e){if(e){for(var t=[],n=0,r=Object.keys(e);n<r.length;n++){var o=r[n],a=e[o].type;(p=this._node.create_node(a)).set_name(o),t.push(p)}for(var s=[],_=0,u=0,c=t;u<c.length;u++){var p=c[u],l=i.JsonImportDispatcher.dispatch_node(p);s.push(l),l.process_data(e[p.name]),_++}_=0;for(var d=0,h=t;d<h.length;d++){p=h[d];(l=s[_]).process_inputs_data(e[p.name]),_++}}},e.prototype.set_selection=function(e){var t=this;if(e&&e.length>0){var n=[];e.forEach((function(e){var r=t._node.node(e);r&&n.push(r)})),this._node.selection.set(n)}},e.prototype.set_flags=function(e){var t,n,r,o,i=e.flags;if(i){var a=i.bypass;null!=a&&(null===(n=null===(t=this._node.flags)||void 0===t?void 0:t.bypass)||void 0===n||n.set(a));var s=i.display;null!=s&&(null===(o=null===(r=this._node.flags)||void 0===r?void 0:r.display)||void 0===o||o.set(s))}},e.prototype.set_inputs=function(e){var t=this;e&&e.forEach((function(e,n){if(e&&t._node.parent)if(r.default(e)){var o=e,i=t._node.parent.node(o);t._node.set_input(n,i)}else{i=t._node.parent.node(e.node);var a=e.name;t._node.io.inputs.has_named_input(a)?t._node.set_input(e.name,i,e.output):console.warn(t._node.full_path()+" has no input named "+a)}}))},e.prototype.process_nodes_ui_data=function(e){var t=this;e&&Object.keys(e).forEach((function(n){var r=t._node.node(n);if(r){var o=e[n];i.JsonImportDispatcher.dispatch_node(r).process_ui_data(o)}}))},e.prototype.set_params=function(e){var t=this;e&&Object.keys(e).forEach((function(n){var r=e[n],o=t._node.params.has_param(n),a=r.type;if(a){var s,_=!1;if(o&&((s=t._node.params.get(n))&&s.type==a||null==a)&&(_=!0),_)(s=t._node.params.get(n))&&i.JsonImportDispatcher.dispatch_param(s).process_data(r);else{var u=r.options;if(u)!0===u.spare&&r.default_value&&(o&&t._node.params.delete_param(n),(s=t._node.add_param(a,n,r.default_value,u))&&i.JsonImportDispatcher.dispatch_param(s).process_data(r))}}}))},e.prototype.from_data_custom=function(e){},e}();t.NodeJsonImporter=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(168),i=n(234),a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.add_main=function(e){var t=this,n=e.components;n&&Object.keys(n).forEach((function(e){var r=""+t._param.name+e,o=t._param.node.params.get(r);if(o){var a=n[e];i.JsonImportDispatcher.dispatch_param(o).process_data(a)}}))},t}(o.ParamJsonImporter);t.ParamMultipleJsonImporter=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=r.__importDefault(n(38)),i=n(168),a=/\\n+/g,s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.add_main=function(e){var t=e.value;void 0!==t&&o.default(t)&&(t=t.replace(a,"\n"),this._param.set(t))},t}(i.ParamJsonImporter);t.ParamStringJsonImporter=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.add_main=function(e){var t=e.value;t&&this._param.set(t)},t}(n(168).ParamJsonImporter);t.ParamRampJsonImporter=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(235),o=n(169),i=function(){function e(e){this._node=e}return e.prototype.data=function(){var e,t;this.is_root()||this._node.scene.nodes_controller.register_node_context_signature(this._node),this._data={type:this._node.type};var n=this.nodes_data();if(Object.keys(n).length>0){this._data.nodes=n;var r=this._node.children_controller.context;r&&(this._data.children_context=r)}this.is_root()||(this._data.params=this.params_data(),this._data.inputs=this.inputs_data()),this._node.flags&&(this._data.flags={},this._node.flags.has_bypass()&&(null===(e=this._node.flags.bypass)||void 0===e?void 0:e.active)&&(this._data.flags.bypass=this._node.flags.bypass.active),this._node.flags.has_display()&&(this._data.flags.display=null===(t=this._node.flags.display)||void 0===t?void 0:t.active));var o=this._node.selection;if(o&&this._node.children().length>0){for(var i=[],a={},s=0,_=o.nodes();s<_.length;s++){a[_[s].graph_node_id]=!0}for(var u=0,c=this._node.children();u<c.length;u++){var p=c[u];p.graph_node_id in a&&i.push(p)}this._data.selection=i.map((function(e){return e.name}))}if(this._node.io.inputs.override_clonable_state_allowed()){var l=this._node.io.inputs.override_clonable_state();l&&(this._data.override_clonable_state=l)}return this.add_custom(),this._data},e.prototype.ui_data=function(){var e={};if(!this.is_root()){var t=this._node.ui_data;e.pos=t.position().toArray();var n=t.comment();n&&(e.comment=r.SceneJsonExporter.sanitize_string(n))}var i=this._node.children();return i.length>0&&(e.nodes={},i.forEach((function(t){var n=o.JsonExportDispatcher.dispatch_node(t);e.nodes[t.name]=n.ui_data()}))),e},e.prototype.is_root=function(){return null===this._node.parent&&this._node.graph_node_id==this._node.root.graph_node_id},e.prototype.inputs_data=function(){var e=this,t=[];return this._node.io.inputs.inputs().forEach((function(n,r){if(n){var o=e._node.io.connections.input_connection(r);if(e._node.io.inputs.has_named_inputs){var i=e._node.io.inputs.named_input_connection_points[r].name,a=o.output_index,s=n.io.inputs.named_input_connection_points[a].name;t.push({name:i,node:n.name,output:s})}else t.push(n?n.name:null)}})),t},e.prototype.params_data=function(){for(var e={},t=0,n=this._node.params.names;t<n.length;t++){var r=n[t],i=this._node.params.get(r);if(i){var a=o.JsonExportDispatcher.dispatch_param(i);if(a.required){var s=a.data();e[i.name]=s}}}return e},e.prototype.nodes_data=function(){for(var e={},t=0,n=this._node.children();t<n.length;t++){var r=n[t],i=o.JsonExportDispatcher.dispatch_node(r);e[r.name]=i.data()}return e},e.prototype.add_custom=function(){},e}();t.NodeJsonExporter=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(112),i=n(169),a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.add_main=function(){var e,t={},n=this._param.component_names;null===(e=this._param.components)||void 0===e||e.forEach((function(e,r){var o=i.JsonExportDispatcher.dispatch_param(e);t[n[r]]=o.data()})),this._data.components=t},t}(o.ParamJsonExporter);t.ParamMultipleJsonExporter=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.add_main=function(){var e,t;this._param.has_expression()&&(null===(e=this._param.expression_controller)||void 0===e?void 0:e.expression)?this._data.expression=null===(t=this._param.expression_controller)||void 0===t?void 0:t.expression:this._data.value=this._param.value_serialized},t}(n(112).ParamJsonExporter);t.ParamNumericJsonExporter=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(112),i=n(235),a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.add_main=function(){var e=this._param.value;e=i.SceneJsonExporter.sanitize_string(e),this._data.value=e},t}(o.ParamJsonExporter);t.ParamOperatorPathJsonExporter=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(112),i=n(235),a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.add_main=function(){var e=this._param.raw_input;e=i.SceneJsonExporter.sanitize_string(e),this._data.value=e},t}(o.ParamJsonExporter);t.ParamStringJsonExporter=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.add_main=function(){this._data.value=this._param.value.to_json()},t}(n(112).ParamJsonExporter);t.ParamRampJsonExporter=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(623),i=r.__importDefault(n(630)),a=n(318),s=n(319),_=n(136),u=n(21),c=n(113),p=n(89),l=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),Object.defineProperty(t.prototype,"_template_shader",{get:function(){return{fragmentShader:i.default,vertexShader:void 0,uniforms:void 0}},enumerable:!0,configurable:!0}),t.prototype.compile=function(){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(e){switch(e.label){case 0:return[4,this.update_fragment_shader()];case 1:return e.sent(),[2]}}))}))},t.prototype.fragment_shader=function(){return this._shaders_by_name.get(_.ShaderName.FRAGMENT)},t.prototype.uniforms=function(){return this._uniforms},t.prototype._create_material=function(){},t.prototype.update_fragment_shader=function(){return r.__awaiter(this,void 0,void 0,(function(){var e,t,n,o,i,a,s,u,c;return r.__generator(this,(function(r){switch(r.label){case 0:for(this._lines=new Map,this._shaders_by_name=new Map,e=0,t=this.shader_names;e<t.length;e++)(a=t[e])==_.ShaderName.FRAGMENT&&(n=this._template_shader.fragmentShader,this._lines.set(a,n.split("\n")));return this._root_nodes.length>0?[4,this.build_code_from_nodes(this._root_nodes)]:[3,2];case 1:r.sent(),this._build_lines(),r.label=2;case 2:for(this._uniforms=this.build_uniforms(),o=0,i=this.shader_names;o<i.length;o++)a=i[o],(s=this._lines.get(a))&&this._shaders_by_name.set(a,s.join("\n"));return u=this._gl_parent_node.scene,c=this._gl_parent_node.graph_node_id,this.frame_dependent()?this._uniforms&&u.uniforms_controller.add_frame_dependent_uniform_owner(c,this._uniforms):u.uniforms_controller.remove_frame_dependent_uniform_owner(c),[2]}}))}))},t.prototype.add_output_params=function(e){e.add_param(u.ParamType.COLOR,"color",[1,1,1],{hidden:!0}),e.add_param(u.ParamType.FLOAT,"alpha",1,{hidden:!0})},t.prototype.add_globals_params=function(e){e.io.outputs.set_named_output_connection_points([new c.TypedNamedConnectionPoint("gl_FragCoord",p.ConnectionPointType.VEC2),new c.TypedNamedConnectionPoint("frame",p.ConnectionPointType.FLOAT)])},t.prototype.create_shader_configs=function(){return[new a.ShaderConfig(_.ShaderName.FRAGMENT,["color","alpha"],[])]},t.prototype.create_variable_configs=function(){return[new s.VariableConfig("color",{prefix:"diffuseColor.xyz = "}),new s.VariableConfig("alpha",{prefix:"diffuseColor.a = ",default:"1.0"})]},t.prototype.insert_define_after=function(e){return"// INSERT DEFINE"},t.prototype.insert_body_after=function(e){return"// INSERT BODY"},t.prototype.lines_to_remove=function(e){return["// INSERT DEFINE","// INSERT BODY"]},t.prototype.handle_gl_FragCoord=function(e,t,n){"fragment"==t&&e.push("vec2 "+n+" = vec2(gl_FragCoord.x / resolution.x, gl_FragCoord.y / resolution.y)")},t}(o.ShaderAssemblerRender);t.ShaderAssemblerTexture=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(624),i=n(171),a=n(136),s=n(170),_=n(89),u=n(135);!function(e){e.DISTANCE="customDistanceMaterial",e.DEPTH="customDepthMaterial",e.DEPTH_DOF="customDepthDOFMaterial"}(t.CustomMaterialName||(t.CustomMaterialName={}));var c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._assemblers_by_custom_name=new Map,t}return r.__extends(t,e),t.prototype.custom_assembler_class_by_custom_name=function(){},t.prototype.get_custom_materials=function(){return r.__awaiter(this,void 0,void 0,(function(){var e,t,n=this;return r.__generator(this,(function(o){return e=new Map,this._assemblers_by_custom_name.clear(),(t=this.custom_assembler_class_by_custom_name())&&t.forEach((function(t,o){return r.__awaiter(n,void 0,void 0,(function(){var n,i;return r.__generator(this,(function(r){switch(r.label){case 0:return this._code_builder?((n=this._assemblers_by_custom_name.get(o))||(n=new t(this._gl_parent_node),this._assemblers_by_custom_name.set(o,n)),n.set_root_nodes(this._root_nodes),n.set_param_configs_owner(this._code_builder),n.set_shader_configs(this.shader_configs),n.set_variable_configs(this.variable_configs()),[4,n.get_material()]):[3,2];case 1:(i=r.sent())&&(i.needsUpdate=!0,e.set(o,i)),r.label=2;case 2:return[2]}}))}))})),[2,e]}))}))},t.prototype.shadow_assembler_class_by_custom_name=function(){return{}},t.prototype.add_output_body_line=function(e,t,n){var r,o,a=e.io.inputs.named_input(n),s=e.variable_for_input(n),_=this.variable_config(n);if(a)o=i.ThreeToGl.vector3(s);else if(_.default_from_attribute()){var u=e.io.outputs.named_output_connection_points_by_name(n);if(u){var c=u.type;o=null===(r=this.globals_handler)||void 0===r?void 0:r.read_attribute(e,c,n,t)}}else o=_.default();if(o){var p=_.prefix(),l=_.suffix(),d=_.if_condition();d&&e.add_body_lines(["#if "+d],t),e.add_body_lines([""+p+o+l],t),d&&e.add_body_lines(["#endif"],t)}},t.prototype.set_node_lines_output=function(e,t){var n,r=null===(n=this.shader_config(t))||void 0===n?void 0:n.input_names();if(r){e.set_body_lines([],t);for(var o=0,i=r;o<i.length;o++){var a=i[o];this.add_output_body_line(e,t,a)}}},t.prototype.set_node_lines_attribute=function(e,t){var n,r=e.gl_type(),o=null===(n=this.globals_handler)||void 0===n?void 0:n.read_attribute(e,r,e.attribute_name,t),i=e.gl_var_name(e.output_name);e.add_body_lines([r+" "+i+" = "+o],t)},t.prototype.handle_gl_FragCoord=function(e,t,n){t==a.ShaderName.FRAGMENT&&e.push("vec4 "+n+" = gl_FragCoord")},t.prototype.handle_resolution=function(e,t,n){t==a.ShaderName.FRAGMENT&&e.push("vec2 "+n+" = resolution")},t.prototype.set_node_lines_globals=function(e,t){var n,r=[],o=this.shader_config(t);if(o){for(var i,c,p=o.dependencies(),l=new Map,d=new Map,h=0,f=e.io.outputs.used_output_names();h<f.length;h++){var m=f[h],y=e.gl_var_name(m),v=e.shader_name;switch(m){case"frame":i=new s.UniformGLDefinition(e,_.ConnectionPointType.FLOAT,m),v&&u.MapUtils.push_on_array_at_entry(l,v,i),c="float "+y+" = "+m;for(var g=0,b=p;g<b.length;g++){var P=b[g];u.MapUtils.push_on_array_at_entry(l,P,i),u.MapUtils.push_on_array_at_entry(d,P,c)}r.push(c),this.set_frame_dependent();break;case"gl_FragCoord":this.handle_gl_FragCoord(r,t,y);break;case"resolution":this.handle_resolution(r,t,y),i=new s.UniformGLDefinition(e,_.ConnectionPointType.VEC2,m),v&&u.MapUtils.push_on_array_at_entry(l,v,i);for(var O=0,C=p;O<C.length;O++){P=C[O];u.MapUtils.push_on_array_at_entry(l,P,i)}this.set_resolution_dependent();break;case"gl_PointCoord":t==a.ShaderName.FRAGMENT&&r.push("vec2 "+y+" = gl_PointCoord");break;default:null===(n=this.globals_handler)||void 0===n||n.handle_globals_node(e,m,l,d,r,p,t)}}l.forEach((function(t,n){e.add_definitions(t,n)})),d.forEach((function(t,n){e.add_body_lines(t,n)})),e.add_body_lines(r)}},t}(o.BaseGlShaderAssembler);t.ShaderAssemblerRender=c},,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=r.__importDefault(n(85)),i=r.__importDefault(n(88)),a=n(135),s=n(136),_=function(){function e(e,t){this._assembler=e,this._gl_parent_node=t,this._leaves_graph_id=new Map,this._graph_ids_by_shader_name=new Map,this._outputs_by_graph_id=new Map,this._depth_by_graph_id=new Map,this._graph_id_by_depth=new Map,this._graph=this._gl_parent_node.scene.graph}return e.prototype.reset=function(){var e=this;this._leaves_graph_id.clear(),this._outputs_by_graph_id.clear(),this._depth_by_graph_id.clear(),this._graph_id_by_depth.clear(),this.shader_names().forEach((function(t){e._graph_ids_by_shader_name.set(t,new Map)}))},e.prototype.shader_names=function(){return this._assembler.shader_names},e.prototype.input_names_for_shader_name=function(e,t){return this._assembler.input_names_for_shader_name(e,t)},e.prototype.traverse=function(e){var t=this;this.reset();for(var n=0,r=this.shader_names();n<r.length;n++){var o=r[n];this._leaves_graph_id.set(o,new Map)}for(var i=0,a=this.shader_names();i<a.length;i++){o=a[i];this._shader_name=o;for(var s=0,_=e;s<_.length;s++){var u=_[s];this.find_leaves_from_root_node(u),this.set_nodes_depth()}}Object.keys(this._depth_by_graph_id).forEach((function(e){var n,r=t._depth_by_graph_id.get(e);r&&(t._graph_id_by_depth.set(r,t._graph_id_by_depth.get(r)||[]),null===(n=t._graph_id_by_depth.get(r))||void 0===n||n.push(e))}))},e.prototype.leaves_from_nodes=function(e){var t;this._shader_name=s.ShaderName.LEAVES_FROM_NODES_SHADER,this._graph_ids_by_shader_name.set(this._shader_name,new Map),this._leaves_graph_id.set(this._shader_name,new Map);for(var n=0,r=e;n<r.length;n++){var o=r[n];this.find_leaves(o)}var i=[];return null===(t=this._leaves_graph_id.get(this._shader_name))||void 0===t||t.forEach((function(e,t){i.push(t)})),this._graph.nodes_from_ids(i)},e.prototype.nodes_for_shader_name=function(e){var t=this,n=[];this._graph_id_by_depth.forEach((function(e,t){n.push(t)})),n.sort((function(e,t){return e-t})),console.log("sorted depth:",n);var r=[];return n.forEach((function(n){var o=t._graph_id_by_depth.get(n);o&&o.forEach((function(n){var o;if(null===(o=t._graph_ids_by_shader_name.get(e))||void 0===o?void 0:o.get(n)){var i=t._graph.node_from_id(n);r.push(i)}}))})),r},e.prototype.sorted_nodes=function(){var e=this,t=[];this._graph_id_by_depth.forEach((function(e,n){t.push(n)})),t.sort((function(e,t){return e-t}));var n=[];return t.forEach((function(t){var r=e._graph_id_by_depth.get(t);r&&r.forEach((function(t){e._graph.node_from_id(t)&&n.push()}))})),n},e.prototype.find_leaves_from_root_node=function(e){var t=this,n=this.input_names_for_shader_name(e,this._shader_name);if(n)for(var r=0,o=n;r<o.length;r++){var a=o[r],s=e.io.inputs.named_input(a);s&&this.find_leaves(s)}this._outputs_by_graph_id.forEach((function(e,n){t._outputs_by_graph_id.set(n,i.default(e))}))},e.prototype.find_leaves=function(e){var t,n=this;null===(t=this._graph_ids_by_shader_name.get(this._shader_name))||void 0===t||t.set(e.graph_node_id,!0);var r=o.default(e.io.inputs.inputs()),s=i.default(r.map((function(e){return e.graph_node_id()}))).map((function(e){return n._graph.node_from_id(e)})),_=e.graph_node_id;if(s.length>0)for(var u=0,c=s;u<c.length;u++){var p=c[u],l=p.graph_node_id;a.MapUtils.push_on_array_at_entry(this._outputs_by_graph_id,l,_),this.find_leaves(p)}else this._leaves_graph_id.get(this._shader_name).set(e.graph_node_id,!0)},e.prototype.set_nodes_depth=function(){var e=this;this._leaves_graph_id.forEach((function(t,n){t.forEach((function(t,n){e.set_node_depth(n)}))}))},e.prototype.set_node_depth=function(e,t){var n=this;void 0===t&&(t=0);var r=this._depth_by_graph_id.get(e);null!=r?this._depth_by_graph_id.set(e,Math.max(r,t)):this._depth_by_graph_id.set(e,t);var o=this._outputs_by_graph_id.get(e);o&&o.forEach((function(e){n.set_node_depth(e,t+1)}))},e}();t.TypedNodeTraverser=_},,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(232),i=n(17),a=n(1),s=n(3),_=n(21),u=n(306),c=n(31),p=n(167),l=function(){function e(e,t,n,r){this._type=e,this._name=t,this._default_value=n,this._uniform_name=r}return e.from_param=function(t,n){return new e(t.type,t.name,t.default_value,n)},Object.defineProperty(e.prototype,"type",{get:function(){return this._type},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"default_value",{get:function(){return this._default_value},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"uniform_name",{get:function(){return this._uniform_name},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"uniform",{get:function(){return this._uniform=this._uniform||this._create_uniform()},enumerable:!0,configurable:!0}),e.prototype._create_uniform=function(){return e.uniform_by_type(this._type)},Object.defineProperty(e.prototype,"param_options",{get:function(){switch(this._type){case _.ParamType.OPERATOR_PATH:return{node_selection:{context:c.NodeContext.COP}};default:return{}}},enumerable:!0,configurable:!0}),e.uniform_by_type=function(e){switch(e){case _.ParamType.BOOLEAN:case _.ParamType.BUTTON:return{value:0};case _.ParamType.COLOR:return{value:new a.Vector3(0,0,0)};case _.ParamType.FLOAT:case _.ParamType.INTEGER:case _.ParamType.OPERATOR_PATH:return{value:0};case _.ParamType.RAMP:return{value:null};case _.ParamType.SEPARATOR:return{value:0};case _.ParamType.STRING:return{value:null};case _.ParamType.VECTOR2:return{value:new s.Vector2(0,0)};case _.ParamType.VECTOR3:return{value:new a.Vector3(0,0,0)};case _.ParamType.VECTOR4:return{value:new i.Vector4(0,0,0,0)}}p.TypeAssert.unreachable(e)},e.prototype.set_uniform_value=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,n,o;return r.__generator(this,(function(r){switch(r.label){case 0:return t=this.uniform,(n=e.params.get(this._name))?[4,n.compute()]:[3,6];case 1:if(r.sent(),!(null!=(o=n.value)&&this.has_value_changed(o)||this.is_video_texture()))return[3,6];switch(this._type){case _.ParamType.OPERATOR_PATH:return[3,2];case _.ParamType.RAMP:return[3,4]}return[3,5];case 2:return[4,this.set_uniform_value_from_texture(n,t)];case 3:return r.sent(),[3,6];case 4:return this.set_uniform_value_from_ramp(n,t),[3,6];case 5:return t.value=n.value,[3,6];case 6:return[2]}}))}))},e.prototype.set_uniform_value_from_texture=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var n,o,i;return r.__generator(this,(function(r){switch(r.label){case 0:return(n=e.found_node())?[4,n.request_container()]:[3,2];case 1:return o=r.sent(),i=o.texture(),t.value=i,[3,3];case 2:t.value=null,r.label=3;case 3:return[2]}}))}))},e.prototype.set_uniform_value_from_ramp=function(e,t){t.value=e.ramp_texture()},e.prototype.has_value_changed=function(e){var t=u.ParamConstructorByType[this._type];if(this._cached_param_value){var n=!t.are_values_equal(e,this._cached_param_value);return n&&(this._cached_param_value=t.clone_value(e)),n}return this._cached_param_value=t.clone_value(e),!1},e.prototype.is_video_texture=function(){var e=!1,t=this.uniform;if(t){var n=t.value;n&&(e=n.constructor==o.VideoTexture)}return e},e}();t.ParamConfig=l},function(e,t,n){"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0});var o=n(2),i=n(21),a=o.__importDefault(n(39)),s=n(3),_=n(1),u=n(17),c=n(6),p=n(111);var l=((r={})[i.ParamType.BOOLEAN]=function(e){return e?1:0},r[i.ParamType.BUTTON]=function(e){return null},r[i.ParamType.COLOR]=function(e){if(a.default(e))return[e,e,e];if(e instanceof s.Vector2){var t=e.toArray();return[t[0],t[1],t[0]]}if(e instanceof _.Vector3)return e.toArray();if(e instanceof c.Color)return e.toArray();if(e instanceof u.Vector4){var n=e.toArray();return[n[0],n[1],n[2]]}return[0,0,0]},r[i.ParamType.FLOAT]=function(e){return a.default(e)?e:e instanceof s.Vector2||e instanceof _.Vector3||e instanceof u.Vector4?e.toArray()[0]:0},r[i.ParamType.INTEGER]=function(e){return a.default(e)?Math.floor(e):e instanceof s.Vector2||e instanceof _.Vector3||e instanceof u.Vector4?Math.floor(e.toArray()[0]):0},r[i.ParamType.OPERATOR_PATH]=function(e){return""+e},r[i.ParamType.RAMP]=function(e){return p.RampParam.DEFAULT_VALUE},r[i.ParamType.SEPARATOR]=function(e){return null},r[i.ParamType.STRING]=function(e){return""+e},r[i.ParamType.VECTOR2]=function(e){if(a.default(e))return[e,e];if(e instanceof s.Vector2)return e.toArray();var t;if(e instanceof _.Vector3)return[(t=e.toArray())[0],t[1]];if(e instanceof c.Color)return[(t=e.toArray())[0],t[1]];if(e instanceof u.Vector4){var n=e.toArray();return[n[0],n[1]]}return[0,0]},r[i.ParamType.VECTOR3]=function(e){if(a.default(e))return[e,e,e];if(e instanceof s.Vector2){var t=e.toArray();return[t[0],t[1],t[0]]}if(e instanceof _.Vector3)return e.toArray();if(e instanceof c.Color)return e.toArray();if(e instanceof u.Vector4){var n=e.toArray();return[n[0],n[1],n[2]]}return[0,0,0]},r[i.ParamType.VECTOR4]=function(e){if(a.default(e))return[e,e,e,e];if(e instanceof s.Vector2){var t=e.toArray();return[t[0],t[1],t[0],t[0]]}var n;return e instanceof _.Vector3?[(n=e.toArray())[0],n[1],n[2],n[0]]:e instanceof c.Color?[(n=e.toArray())[0],n[1],n[2],n[0]]:e instanceof u.Vector4?e.toArray():[0,0,0,0]},r),d=function(){function e(){}return e.from_value=function(e,t){return(0,l[e])(t)},e}();t.ParamValueToDefaultConverter=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){};t.TypedAssembler=r},function(e,t,n){"use strict";n.r(t),t.default="#include <common>\n\nuniform vec2 resolution;\n\n// INSERT DEFINE\n\nvoid main() {\n\n\tvec4 diffuseColor;\n\n\n\t// INSERT BODY\n\n\tgl_FragColor = vec4( diffuseColor );\n}"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(133),o=n(321),i=n(632),a=n(633),s=n(634),_=n(635),u=function(){function e(){}return e.run=function(e){e.register_node(o.AttributeGlNode,r.CATEGORY_GL.GLOBALS),e.register_node(i.ConstantGlNode,r.CATEGORY_GL.GLOBALS),e.register_node(a.GlobalsGlNode,r.CATEGORY_GL.GLOBALS),e.register_node(s.OutputGlNode,r.CATEGORY_GL.GLOBALS),e.register_node(_.ParamGlNode,r.CATEGORY_GL.GLOBALS)},e}();t.GlRegister=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(137),i=n(171),a=n(113),s=n(89);function _(e){return{visible_if:{type:s.ConnectionPointTypes.indexOf(e)}}}var u=n(7),c=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.type=u.ParamConfig.INTEGER(0,{menu:{entries:s.ConnectionPointTypes.map((function(e,t){return{name:e,value:t}}))}}),t.value_float=u.ParamConfig.FLOAT(0,_(s.ConnectionPointType.FLOAT)),t.value_vec2=u.ParamConfig.VECTOR2([0,0],_(s.ConnectionPointType.VEC2)),t.value_vec3=u.ParamConfig.VECTOR3([0,0,0],_(s.ConnectionPointType.VEC3)),t.value_vec4=u.ParamConfig.VECTOR4([0,0,0,0],_(s.ConnectionPointType.VEC4)),t}return r.__extends(t,e),t}(u.NodeParamsConfig)),p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=c,t}return r.__extends(t,e),t.type=function(){return"constant"},t.prototype.initialize_node=function(){this.io.inputs.set_named_input_connection_points([new a.TypedNamedConnectionPoint("value",s.ConnectionPointType.FLOAT)]),this.add_post_dirty_hook(this._update_signature_if_required.bind(this))},t.prototype._update_signature_if_required=function(e){e==this.p.type&&(this.update_output_type(),this.remove_dirty_state(),this.make_output_nodes_dirty())},t.prototype.set_lines=function(){var e=[],t=s.ConnectionPointTypes[this.pv.type],n="value_"+t,r=this.params.get(n);if(r){var o=i.ThreeToGl.any(r.value),a=this.gl_var_name("value");e.push(t+" "+a+" = "+o),this.set_body_lines(e)}},t.prototype.create_inputs_from_params=function(){},t.prototype.update_output_type=function(){this.io.outputs.set_named_output_connection_points([new a.TypedNamedConnectionPoint("value",s.ConnectionPointTypes[this.pv.type])])},t}(o.TypedGlNode);t.ConstantGlNode=p},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(137),i=new(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t}(n(7).NodeParamsConfig)),a=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=i,t}return r.__extends(t,e),t.type=function(){return"globals"},t.prototype.initialize_node=function(){},t.prototype.create_params=function(){var e;null===(e=this.material_node)||void 0===e||e.assembler_controller.add_globals_params(this)},t.prototype.set_lines=function(){var e;this._shader_name&&(null===(e=this.assembler)||void 0===e||e.set_node_lines_globals(this,this._shader_name))},t}(o.TypedGlNode);t.GlobalsGlNode=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(137),i=new(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t}(n(7).NodeParamsConfig)),a=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=i,t}return r.__extends(t,e),t.type=function(){return"output"},t.prototype.create_params=function(){var e;null===(e=this.material_node)||void 0===e||e.assembler_controller.add_output_params(this)},t.prototype.set_lines=function(){var e;this._shader_name&&(null===(e=this.material_node)||void 0===e||e.assembler_controller.set_node_lines_output(this,this._shader_name))},t}(o.TypedGlNode);t.OutputGlNode=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(137),i=n(113),a=n(89),s=r.__importDefault(n(20)),_=n(7),u=n(21),c=n(170),p=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name=_.ParamConfig.STRING(""),t.type=_.ParamConfig.INTEGER(0,{menu:{entries:a.ConnectionPointTypes.map((function(e,t){return{name:e,value:t}}))}}),t.as_color=_.ParamConfig.BOOLEAN(0,{visible_if:{type:a.ConnectionPointTypes.indexOf(a.ConnectionPointType.VEC3)}}),t}return r.__extends(t,e),t}(_.NodeParamsConfig)),l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=p,t}return r.__extends(t,e),t.type=function(){return"param"},t.prototype.initialize_node=function(){this.update_output_type(),this.add_post_dirty_hook(this._update_if_type_changed.bind(this))},t.prototype._update_if_type_changed=function(e){e==this.p.type&&(this.update_output_type(),this.remove_dirty_state(),this.make_output_nodes_dirty())},t.prototype.set_lines=function(){var e=[],t=a.ConnectionPointTypes[this.pv.type],n=this.uniform_name();e.push(new c.UniformGLDefinition(this,t,n)),this.set_definitions(e)},t.prototype.set_param_configs=function(){var e=a.ConnectionPointTypes[this.pv.type],t=a.ConnectionPointInitValueMap[e],n=a.ConnectionPointTypeToParamTypeMap[e];n==u.ParamType.VECTOR3&&this.p.as_color.value&&s.default(t)&&3==t.length?this.add_param_config(u.ParamType.COLOR,this.pv.name,t,this.uniform_name()):this.add_param_config(n,this.pv.name,t,this.uniform_name())},t.prototype.uniform_name=function(){var e=this.io.outputs.named_output_connection_points[0];return this.gl_var_name(e.name)},t.prototype.update_output_type=function(){this.io.outputs.set_named_output_connection_points([new i.TypedNamedConnectionPoint("param_val",a.ConnectionPointTypes[this.pv.type])])},t}(o.TypedGlNode);t.ParamGlNode=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(133),o=n(637),i=n(639),a=function(){function e(){}return e.run=function(e){e.register_node(o.MeshBasicMatNode,r.CATEGORY_MAT.MESH),e.register_node(i.MeshLambertMatNode,r.CATEGORY_MAT.MESH)},e}();t.MatRegister=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(0),i=n(32),a=n(0),s=n(100),_=n(7),u=n(322),c=n(323),p=n(324),l=n(325),d=n(326),h=new(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t}(d.TextureAlphaMapParamConfig(l.TextureMapParamConfig(p.SkinningParamConfig(c.SideParamConfig(u.ColorParamConfig(_.NodeParamsConfig))))))),f=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=h,t}return r.__extends(t,e),t.type=function(){return"mesh_basic"},t.prototype.create_material=function(){return new i.MeshBasicMaterial({vertexColors:o.NoColors,side:a.FrontSide,color:16777215,opacity:.5})},t.prototype.cook=function(){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(e){switch(e.label){case 0:return u.ColorsController.update(this),c.SideController.update(this),p.SkinningController.update(this),[4,l.TextureMapController.update(this)];case 1:return e.sent(),[4,d.TextureAlphaMapController.update(this)];case 2:return e.sent(),this.set_material(this._material),[2]}}))}))},t}(s.TypedMatNode);t.MeshBasicMatNode=f},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.set_content=function(t){e.prototype.set_content.call(this,t)},t.prototype.set_material=function(e){null!=this._content&&this._content.dispose(),this.set_content(e)},t.prototype.has_material=function(){return this.has_content()},t.prototype.material=function(){return this.content()},t}(n(99).TypedContainer);t.MaterialContainer=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(0),i=n(139),a=n(0),s=n(100),_=n(7),u=n(322),c=n(323),p=n(324),l=n(325),d=n(326),h=new(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t}(d.TextureAlphaMapParamConfig(l.TextureMapParamConfig(p.SkinningParamConfig(c.SideParamConfig(u.ColorParamConfig(_.NodeParamsConfig))))))),f=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=h,t}return r.__extends(t,e),t.type=function(){return"mesh_lambert"},t.prototype.create_material=function(){return new i.MeshLambertMaterial({vertexColors:o.NoColors,side:a.FrontSide,color:16777215,opacity:.5})},t.prototype.cook=function(){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(e){switch(e.label){case 0:return u.ColorsController.update(this),c.SideController.update(this),p.SkinningController.update(this),[4,l.TextureMapController.update(this)];case 1:return e.sent(),[4,d.TextureAlphaMapController.update(this)];case 2:return e.sent(),this.set_material(this._material),[2]}}))}))},t}(s.TypedMatNode);t.MeshLambertMatNode=f},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(133),o=n(641),i=n(648),a=n(649),s=n(650),_=n(651),u=n(652),c=n(654),p=n(655),l=n(673),d=function(){function e(){}return e.run=function(e){e.register_node(o.AmbientLightObjNode,r.CATEGORY_OBJ.LIGHT),e.register_node(i.EventsObjNode,r.CATEGORY_OBJ.MANAGER),e.register_node(a.MaterialsObjNode,r.CATEGORY_OBJ.MANAGER),e.register_node(s.CopObjNode,r.CATEGORY_OBJ.MANAGER),e.register_node(_.PostProcessObjNode,r.CATEGORY_OBJ.MANAGER),e.register_node(u.GeoObjNode,r.CATEGORY_OBJ.GEOMETRY),e.register_node(p.OrthographicCameraObjNode,r.CATEGORY_OBJ.CAMERA),e.register_node(l.PerspectiveCameraObjNode,r.CATEGORY_OBJ.CAMERA),e.register_node(c.FogObjNode,r.CATEGORY_OBJ.MISC)},e}();t.ObjRegister=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(248),i=n(642),a=n(7),s=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.color=a.ParamConfig.COLOR([1,1,1]),t.intensity=a.ParamConfig.FLOAT(1),t}return r.__extends(t,e),t}(a.NodeParamsConfig)),_=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=s,t}return r.__extends(t,e),t.type=function(){return"ambient_light"},t.prototype.create_object=function(){return new o.AmbientLight},t.prototype.update_light_params=function(){this.object.color=this.pv.color,this.object.intensity=this.pv.intensity},t}(i.TypedLightObjNode);t.AmbientLightObjNode=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(90),i=n(6),a=n(140),s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.flags=new a.FlagsControllerD(t),t.render_order=o.ObjNodeRenderOrder.LIGHT,t._color_with_intensity=new i.Color(0),t._used_in_scene=!0,t}return r.__extends(t,e),Object.defineProperty(t.prototype,"object",{get:function(){return this._object},enumerable:!0,configurable:!0}),t.prototype.initialize_base_node=function(){var t=this;e.prototype.initialize_base_node.call(this),this.flags.display.add_hook((function(){t.set_used_in_scene(t.flags.display.active||!1)})),this.dirty_controller.add_post_dirty_hook((function(){return r.__awaiter(t,void 0,void 0,(function(){return r.__generator(this,(function(e){switch(e.label){case 0:return this.used_in_scene?[4,this.cook_controller.cook_main_without_inputs()]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))}))}))},t.prototype.create_params=function(){},t.prototype.create_shadow_params_main=function(){if(null!=this.object.shadow)return this.create_shadow_params()},t.prototype.create_light_params=function(){},t.prototype.update_light_params=function(){},t.prototype.create_shadow_params=function(){},t.prototype.cook=function(){this.update_light_params(),this.update_shadow_params(),this.cook_controller.end_cook()},t.prototype.update_shadow_params=function(){},Object.defineProperty(t.prototype,"color_with_intensity",{get:function(){var e=this.params.color("color"),t=this.params.float("intensity");return this._color_with_intensity.copy(e).multiplyScalar(t),this._color_with_intensity},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"active",{get:function(){return this.flags.display.active},enumerable:!0,configurable:!0}),t}(o.TypedObjNode);t.TypedLightObjNode=s;var _=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t}(s);t.BaseLightObjNodeClass=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.set_content=function(t){e.prototype.set_content.call(this,t)},t.prototype.set_object=function(e){return this.set_content(e)},t.prototype.has_object=function(){return this.has_content()},t.prototype.object=function(){return this.content()},t}(n(99).TypedContainer);t.ObjectContainer=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(327),o=n(90),i=n(21),a=function(){function e(e){this.node=e,this._camera_controller=new r.CameraController(this._update_from_look_at_target.bind(this))}return Object.defineProperty(e.prototype,"active",{get:function(){return""!=this.param.value},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"param",{get:function(){return this.node.params.get_operator_path("look_at")},enumerable:!0,configurable:!0}),e.prototype.compute=function(){var e=this.param.found_node();e?e instanceof o.BaseObjNodeclass?this._camera_controller.set_target(e.object):this.node.states.error.set("look_at node is not an obj"):(this._camera_controller.remove_target(),this.node.transform_controller.update_transform_with_matrix())},e.prototype._update_from_look_at_target=function(e){var t=this.node.object;null!=t?(t.matrixAutoUpdate=!0,t.up.copy(this.node.params.value_with_type("up",i.ParamType.VECTOR3)),t.lookAt(e.position)):console.log("no object yet",this.node.full_path())},e}();t.LookAtController=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(183),o=n(114),i=n(68),a=function(){function e(e){this.node=e}return e.prototype.post_set_input=function(){null!=this.node.io.inputs.input(0)?this.node.root.add_to_parent_transform(this.node):this.node.root.remove_from_parent_transform(this.node)},e.prototype.update=function(e){return this.node.object?1==this.node.look_at_controller.active?this.node.look_at_controller.compute():this.update_transform_with_matrix(e):(console.warn("no object to update for "+this.node.full_path()),!1)},e.prototype.update_transform_with_matrix=function(e){var t=this.node.object;return null==e||e.equals(t.matrix)?this.update_transform_from_params():(t.matrixAutoUpdate=!1,t.matrix=e,t.dispatchEvent({type:"change"}))},e.prototype.update_transform_from_params=function(){var e=this.node.object;if(e){var t=this.node.params.vector3("t"),n=this.node.params.vector3("r"),i=this.node.params.vector3("s").clone().multiplyScalar(this.node.params.float("scale"));e.matrixAutoUpdate=!1,e.position.copy(t);var a=[o.CoreMath.degrees_to_radians(n.x),o.CoreMath.degrees_to_radians(n.y),o.CoreMath.degrees_to_radians(n.z)],s=new r.Euler(a[0],a[1],a[2]);e.rotation.copy(s),e.scale.copy(i),e.matrixAutoUpdate=!0,e.updateMatrix(),e.dispatchEvent({type:"change"})}},e.prototype.set_params_from_matrix=function(e,t){void 0===t&&(t={}),i.CoreTransform.set_params_from_matrix(e,this.node,t)},e}();t.TransformController=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(328),i=n(48),a=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._state=!1,t}return r.__extends(t,e),t.prototype.on_update=function(){this.node.emit(i.NodeEvent.FLAG_BYPASS_UPDATED),this.node.set_dirty()},t}(o.BaseFlag);t.BypassFlag=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(328),i=n(48),a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.on_update=function(){this.node.emit(i.NodeEvent.FLAG_DISPLAY_UPDATED)},t}(o.BaseFlag);t.DisplayFlag=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(172),i=n(31),a=n(90),s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.render_order=a.ObjNodeRenderOrder.EVENT,t}return r.__extends(t,e),t.type=function(){return"events"},t.prototype.initialize_node=function(){this.children_controller.init(i.NodeContext.EVENT)},t}(o.BaseManagerObjNode);t.EventsObjNode=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(172),i=n(31),a=n(90),s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.render_order=a.ObjNodeRenderOrder.MAT,t}return r.__extends(t,e),t.type=function(){return"materials"},t.prototype.initialize_node=function(){this.children_controller.init(i.NodeContext.MAT)},t}(o.BaseManagerObjNode);t.MaterialsObjNode=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(172),i=n(31),a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.type=function(){return"cop"},t.prototype.initialize_node=function(){this.children_controller.init(i.NodeContext.COP)},t}(o.BaseManagerObjNode);t.CopObjNode=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(172),i=n(31),a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.type=function(){return"post_process"},t.prototype.initialize_node=function(){this.children_controller.init(i.NodeContext.POST)},t}(o.BaseManagerObjNode);t.PostProcessObjNode=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(90),i=n(40),a=n(68),s=n(653),_=n(31),u=n(7),c=n(140),p=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.t=u.ParamConfig.VECTOR3([0,0,0]),t.r=u.ParamConfig.VECTOR3([0,0,0]),t.s=u.ParamConfig.VECTOR3([1,1,1]),t.scale=u.ParamConfig.FLOAT(1),t.look_at=u.ParamConfig.OPERATOR_PATH(""),t.up=u.ParamConfig.VECTOR3([0,1,0]),t.pivot=u.ParamConfig.VECTOR3([0,0,0]),t.display=u.ParamConfig.BOOLEAN(1),t}return r.__extends(t,e),t}(u.NodeParamsConfig)),l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=p,t._display_node_controller=new s.DisplayNodeController(t),t.flags=new c.FlagsControllerD(t),t._used_in_scene=!0,t._core_transform=new a.CoreTransform,t}return r.__extends(t,e),Object.defineProperty(t.prototype,"display_node_controller",{get:function(){return this._display_node_controller},enumerable:!0,configurable:!0}),t.type=function(){return"geo"},t.prototype.initialize_node=function(){var e=this;this.children_controller.init(_.NodeContext.SOP),this.flags.display.add_hook((function(){e.set_used_in_scene(e.flags.display.active)})),this.dirty_controller.add_post_dirty_hook((function(){return r.__awaiter(e,void 0,void 0,(function(){return r.__generator(this,(function(e){switch(e.label){case 0:return this.used_in_scene?[4,this.cook_controller.cook_main_without_inputs()]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))}))})),this.io.inputs.set_count(0,1)},t.prototype.create_object=function(){return new i.Group},t.prototype.request_display_node=function(){this.scene.loading_controller.auto_updating},t.prototype.is_display_node_cooking=function(){if(this.flags.display.active){var e=this._display_node_controller.display_node;return!!e&&e.is_dirty}return!1},t.prototype.post_display_flag_node_set_dirty=function(){this.request_display_node()},t.prototype.post_add_node=function(e){var t,n;this.scene.loading_controller.loaded&&1==this.children().length&&(null===(n=null===(t=e.flags)||void 0===t?void 0:t.display)||void 0===n||n.set(!0))},t.prototype.create_node=function(t){return e.prototype.create_node.call(this,t)},t.prototype.children=function(){return e.prototype.children.call(this)},t.prototype.nodes_by_type=function(t){return e.prototype.nodes_by_type.call(this,t)},t.prototype.on_create=function(){},t.prototype.cook=function(){var e=this._core_transform.matrix(this.pv.t,this.pv.r,this.pv.s,this.pv.scale);this.group.visible=this.flags.display.active,this.transform_controller.update(e),this.cook_controller.end_cook()},t}(o.TypedObjNode);t.GeoObjNode=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(61),i=function(){function e(e){var t=this;this.node=e,this._children_uuids_dict={},this._children_length=0,this._graph_node=new o.CoreGraphNode(e.scene,"DisplayNodeController"),this._graph_node.dirty_controller.add_post_dirty_hook((function(){t.request_display_node_container()}))}return Object.defineProperty(e.prototype,"display_node",{get:function(){return this._display_node},enumerable:!0,configurable:!0}),e.prototype.set_display_node=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t;return r.__generator(this,(function(n){return this._display_node!=e&&((t=this._display_node)&&(t.flags.display.set(!1),this._graph_node.remove_graph_input(t),this.remove_children()),this._display_node=e,this._display_node&&this._graph_node.add_graph_input(this._display_node),this.request_display_node_container()),[2]}))}))},e.prototype.remove_children=function(){for(var e;e=this.node.object.children.pop();)this.node.object.remove(e)},e.prototype.request_display_node_container=function(){return r.__awaiter(this,void 0,void 0,(function(){var e,t,n,o,i,a,s,_,u;return r.__generator(this,(function(r){switch(r.label){case 0:return this.node.used_in_scene&&this._display_node?[4,this._display_node.request_container()]:[3,2];case 1:if(e=r.sent(),t=e.core_content()){if(n=t.objects(),!(o=n.length!=this._children_length))for(i=0,a=n;i<a.length;i++)(u=a[i]).uuid in this._children_uuids_dict||(o=!0);if(o){for(this.remove_children(),this._children_uuids_dict={},s=0,_=n;s<_.length;s++)u=_[s],this.node.object.add(u),this._children_uuids_dict[u.uuid]=!0;this._children_length=n.length}}else this.remove_children(),this._children_uuids_dict={},this._children_length=0;r.label=2;case 2:return[2]}}))}))},e}();t.DisplayNodeController=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(90),i=n(249),a=n(250),s={color:new(n(6).Color)(1,1,1),near:0,far:100,density:25e-5},_=n(7),u=n(140),c=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.color=_.ParamConfig.COLOR(s.color.toArray()),t.exponential=_.ParamConfig.BOOLEAN(0),t.density=_.ParamConfig.FLOAT(1),t.near=_.ParamConfig.FLOAT(0,{range:[0,100]}),t.far=_.ParamConfig.FLOAT(100,{range:[0,100]}),t}return r.__extends(t,e),t}(_.NodeParamsConfig)),p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=c,t.flags=new u.FlagsControllerD(t),t.render_order=o.ObjNodeRenderOrder.MANAGER,t.add_to_hierarchy=!1,t}return r.__extends(t,e),t.prototype.initialize_node=function(){this._linear_fog=new a.Fog(s.color.getHex(),s.near,s.far),this._linear_fogexp2=new i.FogExp2(s.color.getHex(),s.density)},t.type=function(){return"fog"},t.prototype.cook=function(){var e;this.pv.exponential?(this._linear_fogexp2.density=this.pv.density,e=this._linear_fogexp2):(this._linear_fog.near=this.pv.near,this._linear_fog.far=this.pv.far,e=this._linear_fog),e.color.copy(this.pv.color),this.scene.display_scene.fog=e,this.cook_controller.end_cook()},t}(o.TypedObjNode);t.FogObjNode=p},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(62),i=r.__importDefault(n(329)),a=n(330),s=n(672),_=n(21),u=n(7),c=-.5,p=.5,l=.5,d=-.5,h=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.size=u.ParamConfig.FLOAT(1),t.vertical_size_range=u.ParamConfig.VECTOR2([-1,-1]),t.horizontal_size_range=u.ParamConfig.VECTOR2([-1,-1]),t}return r.__extends(t,e),t}(a.BaseCameraObjParamsConfig)),f=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=h,t}return r.__extends(t,e),Object.defineProperty(t.prototype,"background_controller_constructor",{get:function(){return s.OrthographicCameraBackgroundController},enumerable:!0,configurable:!0}),t.type=function(){return"orthographic_camera"},t.prototype.create_object=function(){return new o.OrthographicCamera(2*c,2*p,2*l,2*d,a.BASE_CAMERA_DEFAULT.near,a.BASE_CAMERA_DEFAULT.far)},t.prototype.create_params=function(){this.create_common_params(),this.add_param(_.ParamType.FLOAT,"size",2,{range:[0,10]}),this.add_param(_.ParamType.VECTOR2,"vertical_size_range",[0,10],{visible_if:{lock_width:1}}),this.add_param(_.ParamType.VECTOR2,"horizontal_size_range",[0,10],{visible_if:{lock_width:0}}),this.create_player_camera_params()},t.prototype.update_camera=function(){this._update_for_aspect_ratio()},t.prototype._update_for_aspect_ratio=function(){if(this._aspect){var e=this.pv.size||1,t=this.pv.lock_width;if(null==t&&(t=!0),t){var n=e/this._aspect,r=this.get_zoom(n,this.pv.vertical_size_range);this._object.left=c*e*r,this._object.right=p*e*r,this._object.top=l*n*r,this._object.bottom=d*n*r}else{var o=e*this._aspect;r=this.get_zoom(o,this.pv.horizontal_size_range);this._object.left=c*o*r,this._object.right=p*o*r,this._object.top=l*e*r,this._object.bottom=d*e*r}this._object.updateProjectionMatrix()}},t.prototype.get_zoom=function(e,t){var n=1;t&&((e<t.x||e>t.y)&&(n=i.default(e,t.x,t.y)/e));return n},t}(a.TypedCameraObjNode);t.OrthographicCameraObjNode=f},,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(658),i=n(659),a=function(){function e(e){this.node=e,this._applied_controls_by_element_id={},this._controls_node=null}return e.prototype.controls_param=function(){return this.node.params.has("controls")?this.node.params.get("controls"):null},e.prototype.controls_node=function(){var e=this.node.p.controls.found_node();if(e){if(e instanceof i.CameraOrbitControlsEventNode)return e;this.node.states.error.set("found node is not of a camera control type")}else this.node.states.error.set("no node has been found");return null},e.prototype.update_controls=function(){var e=this.controls_node();e&&this._controls_node!=e&&this.dispose_control_refs(),this._controls_node=e},e.prototype.apply_controls=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,n,i,a,s;return r.__generator(this,(function(r){switch(r.label){case 0:return(t=this.controls_node())?(n=t.graph_node_id,i=!1,this._applied_controls_by_element_id[e.id]&&this._applied_controls_by_element_id[e.id][n]&&(i=!0),i?[3,2]:(this._applied_controls_by_element_id[e.id]=this._applied_controls_by_element_id[e.id]||{},this._applied_controls_by_element_id[e.id][n]=!0,[4,t.apply_controls(this.node.object,e)])):[3,2];case 1:return a=r.sent(),s=new o.CameraControlsConfig(this.node.graph_node_id,t,a),t.set_from_camera_node(a,this.node),this.set_controls_events(a),[2,s];case 2:return[2]}}))}))},e.prototype.dispose_control_refs=function(){this._applied_controls_by_element_id={}},e.prototype.dispose_controls=function(e){if(this._applied_controls_by_element_id[e.id]){var t=this.controls_node();if(t){var n=t.graph_node_id;delete this._applied_controls_by_element_id[e.id][n]}}},e.prototype.set_controls_events=function(e){var t=this;this.controls_start_listener=function(){t.on_controls_start(e)},this.controls_end_listener=function(){t.on_controls_end(e)},e.addEventListener("start",this.controls_start_listener),e.addEventListener("end",this.controls_end_listener)},e.prototype.on_controls_start=function(e){},e.prototype.on_controls_end=function(e){if(e.target){var t=e.target.toArray();this.node.params.set_vector3("target",t)}this.node.update_transform_params_from_object()},e}();t.ControlsController=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t,n){this._camera_node_id=e,this._controls_node=t,this._controls=n}return Object.defineProperty(e.prototype,"camera_node_id",{get:function(){return this._camera_node_id},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"controls",{get:function(){return this._controls},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"controls_node",{get:function(){return this._controls_node},enumerable:!0,configurable:!0}),e.prototype.is_equal=function(e){return e.camera_node_id==this._camera_node_id&&e.controls_node.graph_node_id==this._controls_node.graph_node_id},e}();t.CameraControlsConfig=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(660),i=n(663),a=n(7),s=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.allow_pan=a.ParamConfig.BOOLEAN(1),t.allow_rotate=a.ParamConfig.BOOLEAN(1),t.allow_zoom=a.ParamConfig.BOOLEAN(1),t.tdamping=a.ParamConfig.BOOLEAN(0),t.damping=a.ParamConfig.FLOAT(.1,{visible_if:{tdamping:!0}}),t.screen_space_panning=a.ParamConfig.BOOLEAN(1),t.rotate_speed=a.ParamConfig.FLOAT(.5),t.min_distance=a.ParamConfig.FLOAT(1,{range:[0,100],range_locked:[!0,!1]}),t.max_distance=a.ParamConfig.FLOAT(50,{range:[0,100],range_locked:[!0,!1]}),t.polar_angle_range=a.ParamConfig.VECTOR2([0,"$PI"]),t}return r.__extends(t,e),t}(a.NodeParamsConfig)),_=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=s,t}return r.__extends(t,e),t.type=function(){return"camera_orbit_controls"},t.prototype.create_controls_instance=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(n){return[2,new i.OrbitControls(e,t)]}))}))},t.prototype.setup_controls=function(e){e.enablePan=this.pv.allow_pan,e.enableRotate=this.pv.allow_rotate,e.enableZoom=this.pv.allow_zoom,e.enableDamping=this.pv.tdamping,e.dampingFactor=this.pv.damping,e.rotateSpeed=this.pv.rotate_speed,e.screenSpacePanning=this.pv.screen_space_panning,e.minDistance=this.pv.min_distance,e.maxDistance=this.pv.max_distance,e.minPolarAngle=this.pv.polar_angle_range.x,e.maxPolarAngle=this.pv.polar_angle_range.y,e.enableKeys=!1},t.prototype.set_from_camera_node=function(e,t){var n=t.params.vector3("target");e.target.copy(n)},t}(o.TypedCameraControlsEventNode);t.CameraOrbitControlsEventNode=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.apply_controls=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var n;return r.__generator(this,(function(r){switch(r.label){case 0:return[4,this.create_controls_instance(e,t)];case 1:return(n=r.sent()).name=this.full_path()+":"+e.name,[4,this.params.eval_all()];case 2:return r.sent(),this.setup_controls(n),[2,n]}}))}))},t}(n(661).TypedEventNode);t.TypedCameraControlsEventNode=o},,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.set_content=function(t){e.prototype.set_content.call(this,t)},t}(n(99).TypedContainer);t.EventContainer=o},function(e,t,n){"use strict";n.r(t),n.d(t,"OrbitControls",(function(){return u})),n.d(t,"MapControls",(function(){return c}));var r=n(30),o=n(0),i=n(33),a=n(254),s=n(3),_=n(1),u=function(e,t){var n,r,u,c,p;void 0===t&&console.warn('THREE.OrbitControls: The second parameter "domElement" is now mandatory.'),t===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),this.object=e,this.domElement=t,this.enabled=!0,this.target=new _.Vector3,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!1,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.enableKeys=!0,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={LEFT:o.MOUSE.ROTATE,MIDDLE:o.MOUSE.DOLLY,RIGHT:o.MOUSE.PAN},this.touches={ONE:o.TOUCH.ROTATE,TWO:o.TOUCH.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=function(){return g.phi},this.getAzimuthalAngle=function(){return g.theta},this.saveState=function(){l.target0.copy(l.target),l.position0.copy(l.object.position),l.zoom0=l.object.zoom},this.reset=function(){l.target.copy(l.target0),l.object.position.copy(l.position0),l.object.zoom=l.zoom0,l.object.updateProjectionMatrix(),l.dispatchEvent(d),l.update(),y=m.NONE},this.update=(n=new _.Vector3,r=(new i.Quaternion).setFromUnitVectors(e.up,new _.Vector3(0,1,0)),u=r.clone().inverse(),c=new _.Vector3,p=new i.Quaternion,function(){var e=l.object.position;return n.copy(e).sub(l.target),n.applyQuaternion(r),g.setFromVector3(n),l.autoRotate&&y===m.NONE&&k(2*Math.PI/60/60*l.autoRotateSpeed),l.enableDamping?(g.theta+=b.theta*l.dampingFactor,g.phi+=b.phi*l.dampingFactor):(g.theta+=b.theta,g.phi+=b.phi),g.theta=Math.max(l.minAzimuthAngle,Math.min(l.maxAzimuthAngle,g.theta)),g.phi=Math.max(l.minPolarAngle,Math.min(l.maxPolarAngle,g.phi)),g.makeSafe(),g.radius*=P,g.radius=Math.max(l.minDistance,Math.min(l.maxDistance,g.radius)),!0===l.enableDamping?l.target.addScaledVector(O,l.dampingFactor):l.target.add(O),n.setFromSpherical(g),n.applyQuaternion(u),e.copy(l.target).add(n),l.object.lookAt(l.target),!0===l.enableDamping?(b.theta*=1-l.dampingFactor,b.phi*=1-l.dampingFactor,O.multiplyScalar(1-l.dampingFactor)):(b.set(0,0,0),O.set(0,0,0)),P=1,!!(C||c.distanceToSquared(l.object.position)>v||8*(1-p.dot(l.object.quaternion))>v)&&(l.dispatchEvent(d),c.copy(l.object.position),p.copy(l.object.quaternion),C=!1,!0)}),this.dispose=function(){l.domElement.removeEventListener("contextmenu",oe,!1),l.domElement.removeEventListener("mousedown",K,!1),l.domElement.removeEventListener("wheel",$,!1),l.domElement.removeEventListener("touchstart",te,!1),l.domElement.removeEventListener("touchend",re,!1),l.domElement.removeEventListener("touchmove",ne,!1),document.removeEventListener("mousemove",Z,!1),document.removeEventListener("mouseup",Q,!1),l.domElement.removeEventListener("keydown",ee,!1)};var l=this,d={type:"change"},h={type:"start"},f={type:"end"},m={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},y=m.NONE,v=1e-6,g=new a.a,b=new a.a,P=1,O=new _.Vector3,C=!1,E=new s.Vector2,T=new s.Vector2,x=new s.Vector2,w=new s.Vector2,A=new s.Vector2,j=new s.Vector2,M=new s.Vector2,N=new s.Vector2,S=new s.Vector2;function R(){return Math.pow(.95,l.zoomSpeed)}function k(e){b.theta-=e}function L(e){b.phi-=e}var D,I=(D=new _.Vector3,function(e,t){D.setFromMatrixColumn(t,0),D.multiplyScalar(-e),O.add(D)}),B=function(){var e=new _.Vector3;return function(t,n){!0===l.screenSpacePanning?e.setFromMatrixColumn(n,1):(e.setFromMatrixColumn(n,0),e.crossVectors(l.object.up,e)),e.multiplyScalar(t),O.add(e)}}(),G=function(){var e=new _.Vector3;return function(t,n){var r=l.domElement;if(l.object.isPerspectiveCamera){var o=l.object.position;e.copy(o).sub(l.target);var i=e.length();i*=Math.tan(l.object.fov/2*Math.PI/180),I(2*t*i/r.clientHeight,l.object.matrix),B(2*n*i/r.clientHeight,l.object.matrix)}else l.object.isOrthographicCamera?(I(t*(l.object.right-l.object.left)/l.object.zoom/r.clientWidth,l.object.matrix),B(n*(l.object.top-l.object.bottom)/l.object.zoom/r.clientHeight,l.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),l.enablePan=!1)}}();function z(e){l.object.isPerspectiveCamera?P/=e:l.object.isOrthographicCamera?(l.object.zoom=Math.max(l.minZoom,Math.min(l.maxZoom,l.object.zoom*e)),l.object.updateProjectionMatrix(),C=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),l.enableZoom=!1)}function F(e){l.object.isPerspectiveCamera?P*=e:l.object.isOrthographicCamera?(l.object.zoom=Math.max(l.minZoom,Math.min(l.maxZoom,l.object.zoom/e)),l.object.updateProjectionMatrix(),C=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),l.enableZoom=!1)}function V(e){E.set(e.clientX,e.clientY)}function U(e){w.set(e.clientX,e.clientY)}function q(e){if(1==e.touches.length)E.set(e.touches[0].pageX,e.touches[0].pageY);else{var t=.5*(e.touches[0].pageX+e.touches[1].pageX),n=.5*(e.touches[0].pageY+e.touches[1].pageY);E.set(t,n)}}function Y(e){if(1==e.touches.length)w.set(e.touches[0].pageX,e.touches[0].pageY);else{var t=.5*(e.touches[0].pageX+e.touches[1].pageX),n=.5*(e.touches[0].pageY+e.touches[1].pageY);w.set(t,n)}}function H(e){var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY,r=Math.sqrt(t*t+n*n);M.set(0,r)}function J(e){if(1==e.touches.length)T.set(e.touches[0].pageX,e.touches[0].pageY);else{var t=.5*(e.touches[0].pageX+e.touches[1].pageX),n=.5*(e.touches[0].pageY+e.touches[1].pageY);T.set(t,n)}x.subVectors(T,E).multiplyScalar(l.rotateSpeed);var r=l.domElement;k(2*Math.PI*x.x/r.clientHeight),L(2*Math.PI*x.y/r.clientHeight),E.copy(T)}function X(e){if(1==e.touches.length)A.set(e.touches[0].pageX,e.touches[0].pageY);else{var t=.5*(e.touches[0].pageX+e.touches[1].pageX),n=.5*(e.touches[0].pageY+e.touches[1].pageY);A.set(t,n)}j.subVectors(A,w).multiplyScalar(l.panSpeed),G(j.x,j.y),w.copy(A)}function W(e){var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY,r=Math.sqrt(t*t+n*n);N.set(0,r),S.set(0,Math.pow(N.y/M.y,l.zoomSpeed)),z(S.y),M.copy(N)}function K(e){if(!1!==l.enabled){switch(e.preventDefault(),l.domElement.focus?l.domElement.focus():window.focus(),e.button){case 0:switch(l.mouseButtons.LEFT){case o.MOUSE.ROTATE:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===l.enablePan)return;U(e),y=m.PAN}else{if(!1===l.enableRotate)return;V(e),y=m.ROTATE}break;case o.MOUSE.PAN:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===l.enableRotate)return;V(e),y=m.ROTATE}else{if(!1===l.enablePan)return;U(e),y=m.PAN}break;default:y=m.NONE}break;case 1:switch(l.mouseButtons.MIDDLE){case o.MOUSE.DOLLY:if(!1===l.enableZoom)return;!function(e){M.set(e.clientX,e.clientY)}(e),y=m.DOLLY;break;default:y=m.NONE}break;case 2:switch(l.mouseButtons.RIGHT){case o.MOUSE.ROTATE:if(!1===l.enableRotate)return;V(e),y=m.ROTATE;break;case o.MOUSE.PAN:if(!1===l.enablePan)return;U(e),y=m.PAN;break;default:y=m.NONE}}y!==m.NONE&&(document.addEventListener("mousemove",Z,!1),document.addEventListener("mouseup",Q,!1),l.dispatchEvent(h))}}function Z(e){if(!1!==l.enabled)switch(e.preventDefault(),y){case m.ROTATE:if(!1===l.enableRotate)return;!function(e){T.set(e.clientX,e.clientY),x.subVectors(T,E).multiplyScalar(l.rotateSpeed);var t=l.domElement;k(2*Math.PI*x.x/t.clientHeight),L(2*Math.PI*x.y/t.clientHeight),E.copy(T),l.update()}(e);break;case m.DOLLY:if(!1===l.enableZoom)return;!function(e){N.set(e.clientX,e.clientY),S.subVectors(N,M),S.y>0?z(R()):S.y<0&&F(R()),M.copy(N),l.update()}(e);break;case m.PAN:if(!1===l.enablePan)return;!function(e){A.set(e.clientX,e.clientY),j.subVectors(A,w).multiplyScalar(l.panSpeed),G(j.x,j.y),w.copy(A),l.update()}(e)}}function Q(e){!1!==l.enabled&&(document.removeEventListener("mousemove",Z,!1),document.removeEventListener("mouseup",Q,!1),l.dispatchEvent(f),y=m.NONE)}function $(e){!1===l.enabled||!1===l.enableZoom||y!==m.NONE&&y!==m.ROTATE||(e.preventDefault(),e.stopPropagation(),l.dispatchEvent(h),function(e){e.deltaY<0?F(R()):e.deltaY>0&&z(R()),l.update()}(e),l.dispatchEvent(f))}function ee(e){!1!==l.enabled&&!1!==l.enableKeys&&!1!==l.enablePan&&function(e){var t=!1;switch(e.keyCode){case l.keys.UP:G(0,l.keyPanSpeed),t=!0;break;case l.keys.BOTTOM:G(0,-l.keyPanSpeed),t=!0;break;case l.keys.LEFT:G(l.keyPanSpeed,0),t=!0;break;case l.keys.RIGHT:G(-l.keyPanSpeed,0),t=!0}t&&(e.preventDefault(),l.update())}(e)}function te(e){if(!1!==l.enabled){switch(e.preventDefault(),e.touches.length){case 1:switch(l.touches.ONE){case o.TOUCH.ROTATE:if(!1===l.enableRotate)return;q(e),y=m.TOUCH_ROTATE;break;case o.TOUCH.PAN:if(!1===l.enablePan)return;Y(e),y=m.TOUCH_PAN;break;default:y=m.NONE}break;case 2:switch(l.touches.TWO){case o.TOUCH.DOLLY_PAN:if(!1===l.enableZoom&&!1===l.enablePan)return;!function(e){l.enableZoom&&H(e),l.enablePan&&Y(e)}(e),y=m.TOUCH_DOLLY_PAN;break;case o.TOUCH.DOLLY_ROTATE:if(!1===l.enableZoom&&!1===l.enableRotate)return;!function(e){l.enableZoom&&H(e),l.enableRotate&&q(e)}(e),y=m.TOUCH_DOLLY_ROTATE;break;default:y=m.NONE}break;default:y=m.NONE}y!==m.NONE&&l.dispatchEvent(h)}}function ne(e){if(!1!==l.enabled)switch(e.preventDefault(),e.stopPropagation(),y){case m.TOUCH_ROTATE:if(!1===l.enableRotate)return;J(e),l.update();break;case m.TOUCH_PAN:if(!1===l.enablePan)return;X(e),l.update();break;case m.TOUCH_DOLLY_PAN:if(!1===l.enableZoom&&!1===l.enablePan)return;!function(e){l.enableZoom&&W(e),l.enablePan&&X(e)}(e),l.update();break;case m.TOUCH_DOLLY_ROTATE:if(!1===l.enableZoom&&!1===l.enableRotate)return;!function(e){l.enableZoom&&W(e),l.enableRotate&&J(e)}(e),l.update();break;default:y=m.NONE}}function re(e){!1!==l.enabled&&(l.dispatchEvent(f),y=m.NONE)}function oe(e){!1!==l.enabled&&e.preventDefault()}l.domElement.addEventListener("contextmenu",oe,!1),l.domElement.addEventListener("mousedown",K,!1),l.domElement.addEventListener("wheel",$,!1),l.domElement.addEventListener("touchstart",te,!1),l.domElement.addEventListener("touchend",re,!1),l.domElement.addEventListener("touchmove",ne,!1),l.domElement.addEventListener("keydown",ee,!1),-1===l.domElement.tabIndex&&(l.domElement.tabIndex=0),this.update()};u.prototype=Object.create(r.a.prototype),u.prototype.constructor=u;var c=function(e,t){u.call(this,e,t),this.mouseButtons.LEFT=o.MOUSE.PAN,this.mouseButtons.RIGHT=o.MOUSE.ROTATE,this.touches.ONE=o.TOUCH.PAN,this.touches.TWO=o.TOUCH.DOLLY_ROTATE};c.prototype=Object.create(r.a.prototype),c.prototype.constructor=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(21),o=function(){function e(e){this.node=e}return e.prototype.add_params=function(){this.node.add_param(r.ParamType.INTEGER,"layer",0,{range:[0,31],range_locked:[!0,!0]})},e.prototype.update=function(){var e=this.node.object;e.layers.set(0),e.layers.enable(this.node.params.integer("layer"))},e}();t.LayersController=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(373),i=n(0),a=n(3),s=r.__importDefault(n(87)),_=n(862),u=n(666),c=n(31),p=n(21),l=n(54),d=function(){function e(e){this.node=e,this._renderers_by_canvas_id={},this._composers_by_canvas_id={},this._resolution_by_canvas_id={},this._composers_set_in_progress_by_canvas_id={},this._fetch_post_process_nodes_in_progress=!1,this._post_process_nodes=[],this._post_process_use_node_path_params=[],this._post_process_node_path_params=[]}return e.prototype.render=function(e,t,n){var r=this.renderer(e);if(r)if(this.node.params.boolean("do_post_process")){var o=this.composer(e);o&&(o.setSize(t.x,t.y),o.render())}else this.node.setup_for_aspect_ratio(n),r.render(this.node.scene.display_scene,this.node.object)},e.prototype.renderer=function(e){return this._renderers_by_canvas_id[e.id]},e.prototype.create_renderer=function(e,t){var n=l.POLY.renderers_controller.rendering_context(e),r=new o.WebGLRenderer({canvas:e,antialias:!0,alpha:!0,context:n});return r.shadowMap.enabled=!0,r.physicallyCorrectLights=!0,r.toneMapping=i.ACESFilmicToneMapping,r.toneMappingExposure=1,r.outputEncoding=i.sRGBEncoding,l.POLY.renderers_controller.register_renderer(r),this._renderers_by_canvas_id[e.id]=r,this.set_renderer_size(e,t),r.setPixelRatio(window.devicePixelRatio),r},e.prototype.delete_renderer=function(e){var t=this.renderer(e);t&&l.POLY.renderers_controller.deregister_renderer(t)},e.prototype.set_renderer_size=function(e,t){this._resolution_by_canvas_id[e.id]=this._resolution_by_canvas_id[e.id]||new a.Vector2,this._resolution_by_canvas_id[e.id].copy(t);var n=this.renderer(e);n&&n.setSize(t.x,t.y);var r=this.composer(e);r&&r.setSize(t.x,t.y)},e.prototype.composer=function(e){return this._composers_by_canvas_id[e.id]=this._composers_by_canvas_id[e.id]||this._create_composer(e)},e.prototype._create_composer=function(e){var t=this.renderer(e);if(t){var n=new _.EffectComposer(t);return n.setPixelRatio(2*window.devicePixelRatio),this.set_composer_passes(e.id,n,t),n}},e.prototype.update_composer_passes=function(){return r.__awaiter(this,void 0,void 0,(function(){var e,t,n,o,i,a;return r.__generator(this,(function(r){switch(r.label){case 0:if(!this.node.params.boolean("do_post_process"))return[3,6];if(this._post_process_nodes=[],this._fetch_post_process_nodes_in_progress)return[2];if(this._fetch_post_process_nodes_in_progress=!0,!this.composer_passes_nodes_changed())return[3,5];this._post_process_nodes=[],e=0,t=s.default(4),r.label=1;case 1:return e<t.length?(n=t[e],o=this._post_process_use_node_path_params[n],o.value?(i=this._post_process_node_path_params[n],(a=i.found_node())?[4,a.request_container()]:[3,3]):[3,3]):[3,4];case 2:r.sent(),this._post_process_nodes.push(a),r.label=3;case 3:return e++,[3,1];case 4:this.set_composers_passes(),r.label=5;case 5:return this._fetch_post_process_nodes_in_progress=!1,[3,7];case 6:this._post_process_nodes=[],r.label=7;case 7:return[2]}}))}))},e.prototype.set_composers_passes=function(){for(var e=0,t=Object.keys(this._composers_by_canvas_id);e<t.length;e++){var n=t[e],r=this._composers_by_canvas_id[n],o=this._renderers_by_canvas_id[n];r&&this.set_composer_passes(n,r,o)}},e.prototype.set_composer_passes=function(e,t,n){if(!this._composers_set_in_progress_by_canvas_id[e]){this._composers_set_in_progress_by_canvas_id[e]=!0,this.clear_render_passes(t);var r=new u.RenderPass(this.node.scene.display_scene,this.node.object);r.clearAlpha=0,t.addPass(r);for(var o=0,i=this._post_process_nodes;o<i.length;o++){i[o].apply_to_composer(t,this.node.object,this._resolution_by_canvas_id[e],this.node)}delete this._composers_set_in_progress_by_canvas_id[e]}},e.prototype.clear_render_passes=function(e){for(var t;t=e.passes.pop();)if(t){var n=t;if("function"==typeof n.dispose)try{n.dispose()}catch(e){console.warn(e)}}e.passes=[]},e.prototype.composer_passes_nodes_changed=function(){return!0},e.prototype.add_params=function(){var e=this;this.node.add_param(p.ParamType.BOOLEAN,"do_post_process",0),s.default(4).forEach((function(t){var n,r=e.node.add_param(p.ParamType.BOOLEAN,"use_post_process_node"+(t+1),0,{visible_if:{do_post_process:1}});if(r){var o=((n={do_post_process:1})[r.name]=1,n),i={node_selection:{context:c.NodeContext.POST},visible_if:o},a=e.node.add_param(p.ParamType.OPERATOR_PATH,"post_process_node"+(t+1),"",i);a&&(e._post_process_use_node_path_params.push(r),e._post_process_node_path_params.push(a))}}))},e}();t.PostProcessController=d},function(e,t,n){"use strict";n.r(t),n.d(t,"RenderPass",(function(){return o}));var r=n(58),o=function(e,t,n,o,i){r.a.call(this),this.scene=e,this.camera=t,this.overrideMaterial=n,this.clearColor=o,this.clearAlpha=void 0!==i?i:0,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1};o.prototype=Object.assign(Object.create(r.a.prototype),{constructor:o,render:function(e,t,n){var r,o,i=e.autoClear;e.autoClear=!1,this.scene.overrideMaterial=this.overrideMaterial,this.clearColor&&(r=e.getClearColor().getHex(),o=e.getClearAlpha(),e.setClearColor(this.clearColor,this.clearAlpha)),this.clearDepth&&e.clearDepth(),e.setRenderTarget(this.renderToScreen?null:n),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),e.render(this.scene,this.camera),this.clearColor&&e.setClearColor(r,o),this.scene.overrideMaterial=null,e.autoClear=i}})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(668),i=n(669),a=n(670),s=n(671),_=function(){function e(e,t,n){var r=this;this._container=e,this._scene=t,this._active=!1,this._display_scene=this._scene.display_scene,this._init_from_scene(n).then((function(){r._build()}))}return Object.defineProperty(e.prototype,"active",{get:function(){return this._active},enumerable:!0,configurable:!0}),e.prototype.activate=function(){this._active=!0},e.prototype.deactivate=function(){this._active=!1},Object.defineProperty(e.prototype,"cameras_controller",{get:function(){return this._cameras_controller=this._cameras_controller||new o.CamerasController(this)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"controls_controller",{get:function(){return this._controls_controller=this._controls_controller||new i.ControlsController(this)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"events_controller",{get:function(){return this._events_controller=this._events_controller||new a.EventsController(this)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"webgl_controller",{get:function(){return this._webgl_controller=this._webgl_controller||new s.WebGLController(this)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"container",{get:function(){return this._container},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scene",{get:function(){return this._scene},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"canvas",{get:function(){return this._canvas},enumerable:!0,configurable:!0}),e.prototype._init_from_scene=function(e){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(t){return this.cameras_controller.set_camera_node(e||this._scene.cameras_controller.master_camera_node),[2]}))}))},e.prototype.reset_container_class=function(){this.container.classList.remove("hovered")},e.prototype.set_container_class_hovered=function(){this.container.classList.add("hovered")},e}();t.BaseViewer=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(3),i=function(){function e(e){this.viewer=e,this._camera_node=null,this._size=new o.Vector2(100,100),this._aspect=1}return e.prototype.set_camera_node=function(e){this._camera_node&&e.graph_node_id==this._camera_node.graph_node_id||(this._camera_node=e)},Object.defineProperty(e.prototype,"camera_node",{get:function(){return this._camera_node},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"aspect",{get:function(){return this._aspect},enumerable:!0,configurable:!0}),e.prototype.on_resize=function(){var e;this.compute_size_and_aspect(),null===(e=this._camera_node)||void 0===e||e.post_process_controller.set_renderer_size(this.viewer.canvas,this._size),this.update_camera_aspect()},e.prototype.compute_size_and_aspect=function(){var e;this._update_size(),null===(e=this._camera_node)||void 0===e||e.scene.uniforms_controller.update_resolution_dependent_uniform_owners(this._size),this._aspect=this._get_aspect()},e.prototype._update_size=function(){this._size.x=this.viewer.container.offsetWidth,this._size.y=this.viewer.container.offsetHeight},e.prototype._get_aspect=function(){return this._size.x/this._size.y},e.prototype.update_camera_aspect=function(){var e;null===(e=this._camera_node)||void 0===e||e.setup_for_aspect_ratio(this._aspect)},e.prototype.prepare_current_camera=function(){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(e){switch(e.label){case 0:return this._camera_node?[4,this._camera_node.request_container()]:[3,3];case 1:return e.sent(),[4,this._update_from_camera_container()];case 2:e.sent(),e.label=3;case 3:return[2]}}))}))},e.prototype._update_from_camera_container=function(){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(e){switch(e.label){case 0:return this.update_camera_aspect(),[4,this.viewer.controls_controller.create_controls()];case 1:return e.sent(),[2]}}))}))},e}();t.CamerasController=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=function(){function e(e){this.viewer=e,this._active=!1,this._controls=null,this._bound_on_controls_start=this._on_controls_start.bind(this),this._bound_on_controls_end=this._on_controls_end.bind(this)}return Object.defineProperty(e.prototype,"active",{get:function(){return this._active},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"camera_node",{get:function(){return this.viewer.cameras_controller.camera_node},enumerable:!0,configurable:!0}),e.prototype.create_controls=function(){var e;return r.__awaiter(this,void 0,void 0,(function(){var t;return r.__generator(this,(function(n){switch(n.label){case 0:return this.dispose_controls(),[4,null===(e=this.camera_node)||void 0===e?void 0:e.controls_controller.apply_controls(this.viewer.canvas)];case 1:return(t=n.sent())&&(this._controls=t.controls,this._controls&&(this.viewer.active?(this._controls.addEventListener("start",this._bound_on_controls_start),this._controls.addEventListener("end",this._bound_on_controls_end)):this.dispose_controls())),[2]}}))}))},e.prototype.dispose_controls=function(){var e;this._controls&&(null===(e=this.camera_node)||void 0===e||e.controls_controller.dispose_controls(this.viewer.canvas),this._bound_on_controls_start&&this._controls.removeEventListener("start",this._bound_on_controls_start),this._bound_on_controls_end&&this._controls.removeEventListener("end",this._bound_on_controls_end),this._controls.dispose(),this._controls=null)},e.prototype._on_controls_start=function(){this._active=!0},e.prototype._on_controls_end=function(){this._active=!1},e}();t.ControlsController=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=function(){function e(e){this.viewer=e,this._mousedown_pos=new r.Vector2,this._mouse_distance_travelled=-1,this._bound_on_mousedown=this._on_mousedown.bind(this),this._bound_on_mousemove=this._on_mousemove.bind(this),this._bound_on_mouseup=this._on_mouseup.bind(this)}return Object.defineProperty(e.prototype,"camera_node",{get:function(){return this.viewer.cameras_controller.camera_node},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"canvas",{get:function(){return this.viewer.canvas},enumerable:!0,configurable:!0}),e.prototype.init=function(){this._bound_on_mousedown&&this.canvas.removeEventListener("mousedown",this._bound_on_mousedown),this._bound_on_mousemove&&this.canvas.removeEventListener("mousemove",this._bound_on_mousemove),this._bound_on_mouseup&&this.canvas.removeEventListener("mouseup",this._bound_on_mouseup),this._bound_on_mousedown=this._bound_on_mousedown||this._on_mousedown.bind(this),this._bound_on_mousemove=this._bound_on_mousemove||this._on_mousemove.bind(this),this._bound_on_mouseup=this._bound_on_mouseup||this._on_mouseup.bind(this),this.canvas.addEventListener("mousedown",this._bound_on_mousedown),this.canvas.addEventListener("mousemove",this._bound_on_mousemove),this.canvas.addEventListener("mouseup",this._bound_on_mouseup),this.canvas.addEventListener("touchstart",this._bound_on_mousedown,!1),this.canvas.addEventListener("touchmove",this._bound_on_mousemove,!1),this.canvas.addEventListener("touchend",this._bound_on_mouseup,!1),this.canvas.addEventListener("touchcancel",this._bound_on_mouseup,!1)},e.prototype._on_mousedown=function(e){if(this._mouse_distance_travelled=0,e instanceof MouseEvent)this._mousedown_pos.x=e.pageX,this._mousedown_pos.y=e.pageY;else{var t=e.touches[0];this._mousedown_pos.x=t.pageX,this._mousedown_pos.y=t.pageY}},e.prototype._on_mousemove=function(e){if(-1!==this._mouse_distance_travelled){var t=0;if(e instanceof MouseEvent)t=e.pageX-this._mousedown_pos.x+(e.pageY-this._mousedown_pos.y);else{var n=e.touches[0];t=n.pageX-this._mousedown_pos.x+(n.pageY-this._mousedown_pos.y)}this._mouse_distance_travelled+=Math.abs(t)}this.viewer.controls_controller.active},e.prototype._on_mouseup=function(e){this._mouse_distance_travelled,this._mouse_distance_travelled=-1},e}();t.EventsController=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this.viewer=e}return e.prototype.init=function(){var e=this.viewer.canvas;e.onwebglcontextlost=this._on_webglcontextlost.bind(this),e.onwebglcontextrestored=this._on_webglcontextrestored.bind(this)},e.prototype._on_webglcontextlost=function(){console.warn("context lost at frame",this.viewer.scene.frame),this.request_animation_frame_id?cancelAnimationFrame(this.request_animation_frame_id):console.warn("request_animation_frame_id not initialized"),console.warn("not canceled",this.request_animation_frame_id)},e.prototype._on_webglcontextrestored=function(){console.log("context restored")},e}();t.WebGLController=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(237),i=r.__importDefault(n(132)),a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.update_screen_quad=function(){var e=this.screen_quad,t=this.node.params.float("size"),n=t,r=this.node.params.float("far");!r||i.default(t)||i.default(n)||(e.scale.x=t,e.scale.y=n,e.position.z=-.9999*r)},t}(o.BaseBackgroundController);t.OrthographicCameraBackgroundController=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=r.__importDefault(n(329)),i=n(41),a=n(330),s=n(674),_=50,u=n(7),c=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.fov=u.ParamConfig.FLOAT(_),t.vertical_fov_range=u.ParamConfig.VECTOR2([0,100],{visible_if:{lock_width:1}}),t.horizontal_fov_range=u.ParamConfig.VECTOR2([0,100],{visible_if:{lock_width:0}}),t}return r.__extends(t,e),t}(a.BaseCameraObjParamsConfig)),p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=c,t}return r.__extends(t,e),t.type=function(){return"perspective_camera"},Object.defineProperty(t.prototype,"background_controller_constructor",{get:function(){return s.PerspectiveCameraBackgroundController},enumerable:!0,configurable:!0}),t.prototype.create_object=function(){return new i.PerspectiveCamera(_,1,a.BASE_CAMERA_DEFAULT.near,a.BASE_CAMERA_DEFAULT.far)},t.prototype.create_params=function(){this.create_common_params(),this.create_player_camera_params()},t.prototype.update_camera=function(){this._object.fov!=this.pv.fov&&(this._object.fov=this.pv.fov,this._object.updateProjectionMatrix()),this._update_for_aspect_ratio()},t.prototype._update_for_aspect_ratio=function(){if(this._aspect){var e=this.pv.lock_width;if(null==e&&(e=!0),this._object.aspect=this._aspect,e){var t=this.pv.fov/this._aspect;this._object.zoom=this.get_zoom(this._aspect,t,this.pv.vertical_fov_range)}else this._object.zoom=1;this._object.updateProjectionMatrix()}},t.prototype.get_zoom=function(e,t,n){var r=e;n&&((t<n.x||t>n.y)&&(r=e*(t/o.default(t,n.x,n.y))));return r},t}(a.TypedCameraObjNode);t.PerspectiveCameraObjNode=p},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(237),i=n(1),a=r.__importDefault(n(132)),s=r.__importDefault(n(173)),_={bl:{x:-1,y:-1},br:{x:1,y:-1},tl:{x:-1,y:1},tr:{x:1,y:1}},u=["bl","br","tl","tr"],c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._bg_corner={bl:new i.Vector3,br:new i.Vector3,tl:new i.Vector3,tr:new i.Vector3},t._bg_center=new i.Vector3,t}return r.__extends(t,e),t.prototype.update_screen_quad=function(){for(var e=this,t=this.screen_quad,n=0,r=u;n<r.length;n++){var o=r[n];this._update_corner_vector(this._bg_corner[o],_[o])}var i=this._bg_corner.bl.distanceTo(this._bg_corner.br),c=this._bg_corner.bl.distanceTo(this._bg_corner.tl);this._bg_center.x=s.default(u.map((function(t){return e._bg_corner[t].x})))/4,this._bg_center.y=s.default(u.map((function(t){return e._bg_corner[t].y})))/4,this._bg_center.z=s.default(u.map((function(t){return e._bg_corner[t].z})))/4;var p=this.node.params.float("far"),l=this.node.params.float("background_ratio");if(p&&!a.default(i)&&!a.default(c)){var d=p/this._bg_center.distanceTo(this.node.object.position),h=l||1;c=i>c?i/h:i*h,t.scale.x=i*d,t.scale.y=c*d,t.position.z=-.9999*p}},t.prototype._update_corner_vector=function(e,t){this._bg_raycaster.setFromCamera(t,this.node.object),e.copy(this._bg_raycaster.ray.direction).multiplyScalar(this.node.params.float("far")).add(this._bg_raycaster.ray.origin)},t}(o.BaseBackgroundController);t.PerspectiveCameraBackgroundController=c},,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(133),o=n(677),i=n(681),a=n(682),s=n(683),_=n(684),u=n(685),c=n(686),p=n(687),l=n(690),d=n(691),h=n(692),f=n(693),m=n(697),y=n(698),v=n(699),g=n(700),b=n(701),P=n(702),O=n(704),C=n(707),E=n(726),T=n(727),x=n(728),w=n(729),A=n(730),j=n(733),M=n(734),N=n(736),S=n(737),R=n(738),k=n(739),L=n(740),D=n(741),I=n(743),B=n(744),G=n(745),z=n(746),F=n(839),V=n(840),U=n(841),q=n(842),Y=n(843),H=n(844),J=n(845),X=n(846),W=n(847),K=n(849),Z=n(850),Q=n(851),$=n(855),ee=n(856),te=n(857),ne=n(858),re=n(859),oe=function(){function e(){}return e.run=function(e){e.register_node(o.AddSopNode,r.CATEGORY_SOP.INPUT),e.register_node(i.AnimationCopySopNode,r.CATEGORY_SOP.ANIMATION),e.register_node(a.AnimationMixerSopNode,r.CATEGORY_SOP.ANIMATION),e.register_node(s.AttribAddMultSopNode,r.CATEGORY_SOP.ATTRIBUTE),e.register_node(_.AttribCopySopNode,r.CATEGORY_SOP.ATTRIBUTE),e.register_node(u.AttribCreateSopNode,r.CATEGORY_SOP.ATTRIBUTE),e.register_node(c.AttribDeleteSopNode,r.CATEGORY_SOP.ATTRIBUTE),e.register_node(p.AttribNormalizeSopNode,r.CATEGORY_SOP.ATTRIBUTE),e.register_node(l.AttribPromoteSopNode,r.CATEGORY_SOP.ATTRIBUTE),e.register_node(d.AttribRemapSopNode,r.CATEGORY_SOP.ATTRIBUTE),e.register_node(h.AttribRenameSopNode,r.CATEGORY_SOP.ATTRIBUTE),e.register_node(f.AttribTransferSopNode,r.CATEGORY_SOP.ATTRIBUTE),e.register_node(m.BboxScatterSopNode,r.CATEGORY_SOP.MODIFIER),e.register_node(y.BlendSopNode,r.CATEGORY_SOP.MODIFIER),e.register_node(v.BoxSopNode,r.CATEGORY_SOP.INPUT),e.register_node(g.CacheSopNode,r.CATEGORY_SOP.MISC),e.register_node(b.CircleSopNode,r.CATEGORY_SOP.INPUT),e.register_node(P.ColorSopNode,r.CATEGORY_SOP.MODIFIER),e.register_node(O.CopySopNode,r.CATEGORY_SOP.MODIFIER),e.register_node(C.DataSopNode,r.CATEGORY_SOP.INPUT),e.register_node(E.DataUrlSopNode,r.CATEGORY_SOP.INPUT),e.register_node(T.DelaySopNode,r.CATEGORY_SOP.MISC),e.register_node(x.DeleteSopNode,r.CATEGORY_SOP.MODIFIER),e.register_node(w.FaceSopNode,r.CATEGORY_SOP.MODIFIER),e.register_node(A.FileSopNode,r.CATEGORY_SOP.INPUT),e.register_node(j.FuseSopNode,r.CATEGORY_SOP.MODIFIER),e.register_node(M.HexagonsSopNode,r.CATEGORY_SOP.INPUT),e.register_node(N.HierarchySopNode,r.CATEGORY_SOP.MISC),e.register_node(S.JitterSopNode,r.CATEGORY_SOP.MODIFIER),e.register_node(R.LayerSopNode,r.CATEGORY_SOP.MODIFIER),e.register_node(k.LineSopNode,r.CATEGORY_SOP.INPUT),e.register_node(L.MergeSopNode,r.CATEGORY_SOP.MISC),e.register_node(D.NoiseSopNode,r.CATEGORY_SOP.MISC),e.register_node(I.NormalsSopNode,r.CATEGORY_SOP.MODIFIER),e.register_node(B.NullSopNode,r.CATEGORY_SOP.MODIFIER),e.register_node(G.ObjectMergeSopNode,r.CATEGORY_SOP.INPUT),e.register_node(z.OcclusionSopNode,r.CATEGORY_SOP.INPUT),e.register_node(F.PeakSopNode,r.CATEGORY_SOP.MODIFIER),e.register_node(V.PlaneSopNode,r.CATEGORY_SOP.INPUT),e.register_node(U.PointSopNode,r.CATEGORY_SOP.MODIFIER),e.register_node(q.PolywireSopNode,r.CATEGORY_SOP.MODIFIER),e.register_node(Y.RaySopNode,r.CATEGORY_SOP.MODIFIER),e.register_node(H.ResampleSopNode,r.CATEGORY_SOP.MODIFIER),e.register_node(J.ScatterSopNode,r.CATEGORY_SOP.MODIFIER),e.register_node(W.SkinSopNode,r.CATEGORY_SOP.MODIFIER),e.register_node(X.ShadowsSopNode,r.CATEGORY_SOP.MODIFIER),e.register_node(K.SphereSopNode,r.CATEGORY_SOP.INPUT),e.register_node(Z.SwitchSopNode,r.CATEGORY_SOP.MISC),e.register_node(Q.TextSopNode,r.CATEGORY_SOP.INPUT),e.register_node($.TorusSopNode,r.CATEGORY_SOP.INPUT),e.register_node(ee.TorusKnotSopNode,r.CATEGORY_SOP.INPUT),e.register_node(te.TransformSopNode,r.CATEGORY_SOP.MODIFIER),e.register_node(ne.TubeSopNode,r.CATEGORY_SOP.INPUT),e.register_node(re.UvProjectSopNode,r.CATEGORY_SOP.MODIFIER)},e}();t.SopRegister=oe},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=r.__importDefault(n(134)),i=n(5),a=n(4),s=n(14),_=n(27),u=n(7),c=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.create_point=u.ParamConfig.BOOLEAN(1),t.points_count=u.ParamConfig.INTEGER(1,{range:[1,100],range_locked:[!0,!1],visible_if:{create_point:!0}}),t.position=u.ParamConfig.VECTOR3([0,0,0],{visible_if:{create_point:!0}}),t.open=u.ParamConfig.BOOLEAN(0),t.connect_to_last_point=u.ParamConfig.BOOLEAN(0),t}return r.__extends(t,e),t}(u.NodeParamsConfig)),p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=c,t}return r.__extends(t,e),t.type=function(){return"add"},t.displayed_input_names=function(){return["geometry to create polygons from (optional)"]},t.prototype.initialize_node=function(){this.io.inputs.set_count(0,1)},t.prototype.cook=function(e){this._objects=[],this._create_point(),this.set_objects(this._objects)},t.prototype._create_point=function(){var e=this;if(this.pv.create_point){var t=new i.BufferGeometry,n=[];o.default(this.pv.points_count,(function(t){e.pv.position.toArray(n,3*t)})),t.setAttribute("position",new a.BufferAttribute(new Float32Array(n),3));var r=this.create_object(t,_.CoreConstant.OBJECT_TYPE.POINTS);this._objects&&this._objects.push(r)}},t}(s.TypedSopNode);t.AddSopNode=p},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2).__importDefault(n(173)),o=n(1),i=n(3),a=n(81),s=n(335),_=n(114),u=function(){function e(e,t){this._core_geometry=e,this._index=t,this._geometry=this._core_geometry.geometry()}return Object.defineProperty(e.prototype,"index",{get:function(){return this._index},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"points",{get:function(){return this._points=this._points||this._get_points()},enumerable:!0,configurable:!0}),e.prototype._get_points=function(){var e,t=(null===(e=this._geometry.index)||void 0===e?void 0:e.array)||[],n=3*this._index;return[new s.CorePoint(this._core_geometry,t[n+0]),new s.CorePoint(this._core_geometry,t[n+1]),new s.CorePoint(this._core_geometry,t[n+2])]},Object.defineProperty(e.prototype,"positions",{get:function(){return this._positions=this._positions||this._get_positions()},enumerable:!0,configurable:!0}),e.prototype._get_positions=function(){var e=this.points;return[e[0].position(),e[1].position(),e[2].position()]},Object.defineProperty(e.prototype,"triangle",{get:function(){return this._triangle=this._triangle||this._get_triangle()},enumerable:!0,configurable:!0}),e.prototype._get_triangle=function(){var e=this.positions;return new a.Triangle(e[0],e[1],e[2])},Object.defineProperty(e.prototype,"deltas",{get:function(){return this._deltas=this._deltas||this._get_deltas()},enumerable:!0,configurable:!0}),e.prototype._get_deltas=function(){return[this.positions[1].clone().sub(this.positions[0]),this.positions[2].clone().sub(this.positions[0])]},Object.defineProperty(e.prototype,"area",{get:function(){return this.triangle.getArea()},enumerable:!0,configurable:!0}),e.prototype.center=function(e){var t=this.positions;return e.x=(t[0].x+t[1].x+t[2].x)/3,e.y=(t[0].y+t[1].y+t[2].y)/3,e.z=(t[0].z+t[1].z+t[2].z)/3,e},e.prototype.random_position=function(e){var t=[_.CoreMath.rand_float(e),_.CoreMath.rand_float(6541*e)];return t[0]+t[1]>1&&(t[0]=1-t[0],t[1]=1-t[1]),this.positions[0].clone().add(this.deltas[0].clone().multiplyScalar(t[0])).add(this.deltas[1].clone().multiplyScalar(t[1]))},e.prototype.attrib_value_at_position=function(e,t){var n=new o.Vector3;this.triangle.getBarycoord(t,n);var r,i,a=n.toArray(),s=this._geometry.attributes[e].itemSize,_=this.points.map((function(t){return t.attrib_value(e)})),u=0;switch(s){case 1:i=0;for(var c=0,p=_;c<p.length;c++){i+=p[c]*a[u],u++}r=i;break;default:for(var l=0,d=_;l<d.length;l++){var h=d[l].multiplyScalar(a[u]);i?i.add(h):i=h,u++}r=i}return r},e.interpolated_value=function(e,t,n,a){var s=[t.a,t.b,t.c],_=e.getAttribute("position").array,u=s.map((function(e){return new o.Vector3(_[3*e+0],_[3*e+1],_[3*e+2])})),c=a.itemSize,p=a.array,l=[];switch(c){case 1:l=s.map((function(e){return p[e]}));break;case 2:l=s.map((function(e){return new i.Vector2(p[2*e+0],p[2*e+1])}));break;case 3:l=s.map((function(e){return new o.Vector3(p[3*e+0],p[3*e+1],p[3*e+2])}))}var d,h=s.map((function(e,t){return n.distanceTo(u[t])})),f=r.default([h[0]*h[1],h[0]*h[2],h[1]*h[2]]),m=[h[1]*h[2]/f,h[0]*h[2]/f,h[0]*h[1]/f];switch(c){case 1:d=r.default(s.map((function(e,t){return m[t]*l[t]})));break;default:d=null;for(var y=0,v=s.map((function(e,t){return l[t].multiplyScalar(m[t])}));y<v.length;y++){var g=v[y];d?d.add(g):d=g}}return d},e}();t.CoreFace=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(80),o=function(){function e(){}return e.patch=function(e){Object.assign(e,{clone:function(){return new r.InterleavedBufferAttribute(e.data.clone(),e.itemSize,e.offset,e.normalized)}})},e}();t.MonkeyPatcher=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(99),i=n(46),a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.set_objects=function(e){},t.prototype.core_content_cloned=function(){if(this._content)return this._content.clone()},t.prototype.set_content=function(t){e.prototype.set_content.call(this,t)},t.prototype.first_object=function(){if(this._content)return this._content.objects()[0]},t.prototype.first_geometry=function(){var e=this.first_object();return e?e.geometry:null},t.prototype.objects_count=function(){return this._content?this._content.objects().length:0},t.prototype.objects_visible_count=function(){var e=0;return this._content&&(e=this._content.objects().filter((function(e){return e.visible})).length),e},t.prototype.objects_count_by_type=function(){var e={},t=this._content;if(this._content&&t)for(var n=0,r=t.core_objects();n<r.length;n++){var o=r[n].human_type();null==e[o]&&(e[o]=0),e[o]+=1}return e},t.prototype.objects_names_by_type=function(){var e={},t=this._content;if(this._content&&t)for(var n=0,r=t.core_objects();n<r.length;n++){var o=r[n],i=o.human_type();e[i]=e[i]||[],e[i].push(o.name())}return e},t.prototype.vertex_attribute_names=function(){var e=[],t=this.first_geometry();return t&&(e=Object.keys(t.attributes)),e},t.prototype.vertex_attribute_sizes_by_name=function(){var e={},t=this.first_geometry();return t&&Object.keys(t.attributes).forEach((function(n){var r=t.attributes[n];e[n]=r.itemSize})),e},t.prototype.vertex_attribute_types_by_name=function(){var e={},t=this.first_geometry();if(t){var n=new i.CoreGeometry(t);Object.keys(t.attributes).forEach((function(t){e[t]=n.attrib_type(t)}))}return e},t.prototype.object_attribute_names=function(){var e=[],t=this.first_object();return t&&(e=Object.keys(t.userData.attributes||{})),e},t.prototype.points_count=function(){return this._content?this._content.points_count():0},t.prototype.bounding_box=function(){return this._content.bounding_box()},t.prototype.center=function(){return this._content.center()},t.prototype.size=function(){return this._content.size()},t}(o.TypedContainer);t.GeometryContainer=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(14),i=n(7),a=n(19),s=new(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t}(i.NodeParamsConfig)),_=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=s,t}return r.__extends(t,e),t.type=function(){return"animation_copy"},t.displayed_input_names=function(){return["geometry to copy animation to","geometry to copy animation from"]},t.prototype.initialize_node=function(){this.io.inputs.set_count(2),this.io.inputs.init_inputs_clonable_state([a.InputCloneMode.FROM_NODE,a.InputCloneMode.NEVER])},t.prototype.cook=function(e){var t=e[0],n=e[1].objects()[0],r=t.objects()[0],o=n.animations;o?(r.animations=o.map((function(e){return e.clone()})),this.set_core_group(t)):this.states.error.set("no animation found")},t}(o.TypedSopNode);t.AnimationCopySopNode=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(14),i=r.__importDefault(n(20)),a=n(863),s=n(19),_=n(21),u=n(48),c=n(7),p=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.time=c.ParamConfig.FLOAT("$T",{range:[0,10]}),t.prepare=c.ParamConfig.BUTTON(null,{callback:function(e,t){l.PARAM_CALLBACK_prepare(e,t)}}),t}return r.__extends(t,e),t}(c.NodeParamsConfig)),l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=p,t._previous_time=null,t._mixer=null,t._actions_by_name={},t._values_by_param_name={},t}return r.__extends(t,e),t.type=function(){return"animation_mixer"},t.displayed_input_names=function(){return["geometry to be animated"]},t.prototype.initialize_node=function(){this.io.inputs.set_count(1),this.io.inputs.init_inputs_clonable_state([s.InputCloneMode.FROM_NODE])},t.prototype.cook=function(e){this._mixer?(this._update_mixer(),this.cook_controller.end_cook()):this.create_mixer(e[0])},t.prototype.create_mixer=function(e){var t=this;this._animation_target=e.objects()[0],this._mixer=new a.AnimationMixer(this._animation_target),this._remove_spare_params(),this._actions_by_name={},this._animation_target.animations&&this._animation_target.animations.forEach((function(e,n){var r=e.name,o=t._values_by_param_name[r];null==o&&(o=0==n?1:0);var i=t.add_param(_.ParamType.FLOAT,r,o,{spare:!0});if(i){var a=t._values_by_param_name[r];a&&i.set(a)}if(t._mixer){var s=t._mixer.clipAction(e);t._actions_by_name[e.name]=s}})),this.emit(u.NodeEvent.PARAMS_UPDATED),Object.keys(this._actions_by_name).forEach((function(e){t._actions_by_name[e].play()}));var n={};this._animation_target.traverse((function(e){var t=e;t.material&&(i.default(t.material)||(n[t.material.uuid]=t.material))})),Object.keys(n).forEach((function(e){var t=n[e];t.skinning=!0,t.morphTargets=!0})),this._previous_time=null,this._update_mixer(),this._update_mixer_weights(),this.set_object(this._animation_target)},t.prototype._remove_spare_params=function(){var e=this;this._values_by_param_name={},this.params.spare_names.forEach((function(t){var n=e.params.get_float(t);n&&(e._values_by_param_name[t]=n.value,e.params.delete_param(t))}))},t.prototype._update_mixer=function(){this.pv.time!=this._previous_time?this._update_mixer_time():this._update_mixer_weights()},t.prototype._update_mixer_time=function(){var e=this.pv.time-(this._previous_time||0);this._mixer&&this._mixer.update(e),this._previous_time=this.pv.time},t.prototype._update_mixer_weights=function(){for(var e=0,t=Object.keys(this._actions_by_name);e<t.length;e++){var n=t[e],r=this._actions_by_name[n],o=this.params.get_float(n).value;null!=o&&r.setEffectiveWeight(o)}},t.PARAM_CALLBACK_prepare=function(e,t){e.prepare_animation_mixer()},t.prototype.prepare_animation_mixer=function(){return r.__awaiter(this,void 0,void 0,(function(){var e;return r.__generator(this,(function(t){switch(t.label){case 0:return this._mixer=null,[4,this.io.inputs.eval_required_input(0)];case 1:return e=t.sent(),this.create_mixer(e.core_content_cloned()),this.set_dirty(),[2]}}))}))},t}(o.TypedSopNode);t.AnimationMixerSopNode=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(14),i=n(7),a=n(19),s=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name=i.ParamConfig.STRING(""),t.pre_add=i.ParamConfig.FLOAT(0,{range:[0,1]}),t.mult=i.ParamConfig.FLOAT(1,{range:[0,1]}),t.post_add=i.ParamConfig.FLOAT(0,{range:[0,1]}),t}return r.__extends(t,e),t}(i.NodeParamsConfig)),_=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=s,t}return r.__extends(t,e),t.type=function(){return"attrib_add_mult"},t.prototype.initialize_node=function(){this.io.inputs.set_count(1),this.io.inputs.init_inputs_clonable_state([a.InputCloneMode.FROM_NODE])},t.prototype.cook=function(e){for(var t=e[0],n=0,r=t.attrib_names_matching_mask(this.pv.name);n<r.length;n++)for(var o=r[n],i=0,a=t.geometries();i<a.length;i++){var s=a[i];this._update_attrib(o,s)}this.set_core_group(t)},t.prototype._update_attrib=function(e,t){var n=t.getAttribute(e);if(n){for(var r=n.array,o=this.pv.pre_add,i=this.pv.mult,a=this.pv.post_add,s=0;s<r.length;s++){var _=r[s];r[s]=(_+o)*i+a}this.io.inputs.input_cloned(0)||(n.needsUpdate=!0)}},t}(o.TypedSopNode);t.AttribAddMultSopNode=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(14),i=n(7),a=n(19),s=n(4),_=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name=i.ParamConfig.STRING(""),t.tnew_name=i.ParamConfig.BOOLEAN(0),t.new_name=i.ParamConfig.STRING("",{visible_if:{tnew_name:1}}),t}return r.__extends(t,e),t}(i.NodeParamsConfig)),u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=_,t}return r.__extends(t,e),t.type=function(){return"attrib_copy"},t.displayed_input_names=function(){return["geometry to copy attributes to","geometry to copy attributes from"]},t.prototype.initialize_node=function(){this.io.inputs.set_count(2),this.io.inputs.init_inputs_clonable_state([a.InputCloneMode.FROM_NODE,a.InputCloneMode.NEVER])},t.prototype.create_params=function(){},t.prototype.cook=function(e){for(var t=e[0],n=e[1],r=0,o=n.attrib_names_matching_mask(this.pv.name);r<o.length;r++){var i=o[r];this.copy_vertex_attribute_between_core_groups(t,n,i)}return this.set_core_group(t)},t.prototype.copy_vertex_attribute_between_core_groups=function(e,t,n){var r=t.objects(),o=e.objects();if(o.length>r.length)this.states.error.set("second input does not have enough objects to copy attributes from");else for(var i=0;i<o.length;i++){var a=o[i].geometry,s=o[i].geometry;this.copy_vertex_attribute_between_geometries(a,s,n)}},t.prototype.copy_vertex_attribute_between_geometries=function(e,t,n){var r=t.getAttribute(n);if(r){var o=r.itemSize,i=t.getAttribute("position").array.length/3,a=e.getAttribute("position").array.length/3;a>i&&this.states.error.set("not enough points in second input");var _=r.array.slice(0,a*o),u=this.pv.tnew_name?this.pv.new_name:n;e.setAttribute(u,new s.Float32BufferAttribute(_,o))}else this.states.error.set("attribute '"+n+"' does not exist on second input")},t}(o.TypedSopNode);t.AttribCopySopNode=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=r.__importDefault(n(163)),i=n(14),a=n(27),s=n(98),_=n(19),u=n(7),c=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.group=u.ParamConfig.STRING(""),t.class=u.ParamConfig.INTEGER(a.AttribClass.VERTEX,{menu:{entries:a.AttribClassMenuEntries}}),t.type=u.ParamConfig.INTEGER(a.AttribType.NUMERIC,{menu:{entries:a.AttribTypeMenuEntries}}),t.name=u.ParamConfig.STRING("new_attrib"),t.size=u.ParamConfig.INTEGER(1,{range:[1,4],range_locked:[!0,!0],visible_if:{type:a.CoreConstant.ATTRIB_TYPE.NUMERIC}}),t.value1=u.ParamConfig.FLOAT(0,{visible_if:{type:a.CoreConstant.ATTRIB_TYPE.NUMERIC,size:1},expression:{for_entities:!0}}),t.value2=u.ParamConfig.VECTOR2([0,0],{visible_if:{type:a.CoreConstant.ATTRIB_TYPE.NUMERIC,size:2},expression:{for_entities:!0}}),t.value3=u.ParamConfig.VECTOR3([0,0,0],{visible_if:{type:a.CoreConstant.ATTRIB_TYPE.NUMERIC,size:3},expression:{for_entities:!0}}),t.value4=u.ParamConfig.VECTOR4([0,0,0,0],{visible_if:{type:a.CoreConstant.ATTRIB_TYPE.NUMERIC,size:4},expression:{for_entities:!0}}),t.string=u.ParamConfig.STRING("",{visible_if:{type:a.CoreConstant.ATTRIB_TYPE.STRING},expression:{for_entities:!0}}),t}return r.__extends(t,e),t}(u.NodeParamsConfig)),p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=c,t._x_arrays_by_geometry_uuid={},t._y_arrays_by_geometry_uuid={},t._z_arrays_by_geometry_uuid={},t._w_arrays_by_geometry_uuid={},t}return r.__extends(t,e),t.type=function(){return"attrib_create"},t.prototype.initialize_node=function(){this.io.inputs.set_count(1),this.io.inputs.init_inputs_clonable_state([_.InputCloneMode.FROM_NODE])},t.prototype.cook=function(e){var t=e[0];if(this.pv.name&&""!=o.default(this.pv.name))switch(this.pv.class){case a.AttribClass.VERTEX:this.add_point_attribute(t);case a.AttribClass.OBJECT:this.add_object_attribute(t)}else this.states.error.set("attribute name is not valid")},t.prototype.add_point_attribute=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,n,o;return r.__generator(this,(function(r){switch(r.label){case 0:t=e.core_objects(),n=0,r.label=1;case 1:if(!(n<t.length))return[3,7];switch(o=t[n],this.pv.type){case a.CoreConstant.ATTRIB_TYPE.NUMERIC:return[3,2];case a.CoreConstant.ATTRIB_TYPE.STRING:return[3,4]}return[3,6];case 2:return[4,this.add_numeric_attribute_to_points(o)];case 3:return r.sent(),[3,6];case 4:return[4,this.add_string_attribute_to_points(o)];case 5:return r.sent(),[3,6];case 6:return n++,[3,1];case 7:return this.set_core_group(e),[2]}}))}))},t.prototype.add_object_attribute=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t;return r.__generator(this,(function(n){switch(n.label){case 0:switch(t=e.core_objects_from_group(this.pv.group),this.pv.type){case a.CoreConstant.ATTRIB_TYPE.NUMERIC:return[3,1];case a.CoreConstant.ATTRIB_TYPE.STRING:return[3,3]}return[3,5];case 1:return[4,this.add_numeric_attribute_to_object(t)];case 2:return n.sent(),[3,5];case 3:return[4,this.add_string_attribute_to_object(t)];case 4:return n.sent(),[3,5];case 5:return this.set_core_group(e),[2]}}))}))},t.prototype.add_numeric_attribute_to_points=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,n,o,i,a,s,_,u,c,p,l,d,h,f,m,y=this;return r.__generator(this,(function(v){switch(v.label){case 0:return t=e.core_geometry(),n=e.points_from_group(this.pv.group),(o=[this.p.value1,this.p.value2,this.p.value3,this.p.value4][this.pv.size-1]).has_expression()?(t.has_attrib(this.pv.name)||t.add_numeric_attrib(this.pv.name,this.pv.size,o.value),i=t.geometry(),a=i.getAttribute(this.pv.name).array,1!=this.pv.size?[3,3]:this.p.value1.expression_controller?[4,this.p.value1.expression_controller.compute_expression_for_points(n,(function(e,t){a[e.index*y.pv.size+0]=t}))]:[3,2]):[3,9];case 1:v.sent(),v.label=2;case 2:return[3,8];case 3:s=[this.p.value2,this.p.value3,this.p.value4][this.pv.size-2],_=s.components,u=new Array(_.length),c=void 0,p=[this._x_arrays_by_geometry_uuid,this._y_arrays_by_geometry_uuid,this._z_arrays_by_geometry_uuid,this._w_arrays_by_geometry_uuid],l=function(e){var t,o,s,l;return r.__generator(this,(function(r){switch(r.label){case 0:return(c=_[e]).has_expression()&&c.expression_controller?(u[e]=d._init_array_if_required(i,p[e],n.length),[4,c.expression_controller.compute_expression_for_points(n,(function(t,n){u[e][t.index]=n}))]):[3,2];case 1:return r.sent(),[3,3];case 2:for(t=c.value,o=0,s=n;o<s.length;o++)l=s[o],a[l.index*d.pv.size+e]=t;r.label=3;case 3:return[2]}}))},d=this,m=0,v.label=4;case 4:return m<_.length?[5,l(m)]:[3,7];case 5:v.sent(),v.label=6;case 6:return m++,[3,4];case 7:for(h=0;h<u.length;h++)if(f=u[h])for(m=0;m<f.length;m++)a[m*this.pv.size+h]=f[m];v.label=8;case 8:return[3,10];case 9:e.add_numeric_vertex_attrib(this.pv.name,this.pv.size,o.value),v.label=10;case 10:return[2]}}))}))},t.prototype.add_numeric_attribute_to_object=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,n,o,i,a,s,_,u,c,p,l,d,h,f=this;return r.__generator(this,(function(m){switch(m.label){case 0:return(t=[this.p.value1,this.p.value2,this.p.value3,this.p.value4][this.pv.size-1]).has_expression()?1!=this.pv.size?[3,3]:this.p.value1.expression_controller?[4,this.p.value1.expression_controller.compute_expression_for_objects(e,(function(e,t){e.set_attrib_value(f.pv.name,t)}))]:[3,2]:[3,9];case 1:m.sent(),m.label=2;case 2:return[3,8];case 3:for(n=[this.p.value2,this.p.value3,this.p.value4][this.pv.size-2],o=n.components,i={},a=0,s=e;a<s.length;a++)h=s[a],i[h.index]=[];_=function(t){var n,a,s,_;return r.__generator(this,(function(r){switch(r.label){case 0:return(n=o[t]).has_expression()&&n.expression_controller?[4,n.expression_controller.compute_expression_for_objects(e,(function(e,n){i[e.index][t]=n}))]:[3,2];case 1:return r.sent(),[3,3];case 2:for(a=0,s=e;a<s.length;a++)_=s[a],i[_.index][t]=n.value;r.label=3;case 3:return[2]}}))},u=0,m.label=4;case 4:return u<o.length?[5,_(u)]:[3,7];case 5:m.sent(),m.label=6;case 6:return u++,[3,4];case 7:for(c=0;c<e.length;c++)h=e[c],p=i[h.index],h.set_attrib_value(this.pv.name,p);m.label=8;case 8:return[3,10];case 9:for(l=0,d=e;l<d.length;l++)(h=d[l]).set_attrib_value(this.pv.name,t.value);m.label=10;case 10:return[2]}}))}))},t.prototype.add_string_attribute_to_points=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,n,o,i;return r.__generator(this,(function(r){switch(r.label){case 0:return t=e.points_from_group(this.pv.group),n=this.p.string,o=[],n.has_expression()&&n.expression_controller?[4,n.expression_controller.compute_expression_for_points(t,(function(e,t){o[e.index]=t}))]:[3,2];case 1:return r.sent(),[3,3];case 2:o.push(n.value),r.label=3;case 3:return i=s.CoreAttribute.array_to_indexed_arrays(o),e.core_geometry().set_indexed_attribute(this.pv.name,i.values,i.indices),[2]}}))}))},t.prototype.add_string_attribute_to_object=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,n,o,i=this;return r.__generator(this,(function(r){switch(r.label){case 0:return(t=this.p.string).has_expression()&&t.expression_controller?[4,t.expression_controller.compute_expression_for_objects(e,(function(e,t){e.set_attrib_value(i.pv.name,t)}))]:[3,2];case 1:return r.sent(),[3,3];case 2:for(n=0,o=e;n<o.length;n++)o[n].set_attrib_value(this.pv.name,t.value);r.label=3;case 3:return[2]}}))}))},t.prototype._init_array_if_required=function(e,t,n){var r=e.uuid,o=t[r];return o?o.length<n&&(t[r]=new Array(n)):t[r]=new Array(n),t[r]},t}(i.TypedSopNode);t.AttribCreateSopNode=p},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(14),i=n(238),a=n(46),s=n(27),_=n(19),u=n(7),c=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.class=u.ParamConfig.INTEGER(s.AttribClass.VERTEX,{menu:{entries:s.AttribClassMenuEntries}}),t.name=u.ParamConfig.STRING(""),t}return r.__extends(t,e),t}(u.NodeParamsConfig)),p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=c,t}return r.__extends(t,e),t.type=function(){return"attrib_delete"},t.displayed_input_names=function(){return["geometry to delete attributes from"]},t.prototype.initialize_node=function(){this.io.inputs.set_count(1),this.io.inputs.init_inputs_clonable_state([_.InputCloneMode.FROM_NODE])},t.prototype.cook=function(e){for(var t=e[0],n=0,r=t.attrib_names_matching_mask(this.pv.name);n<r.length;n++){var o=r[n];switch(this.pv.class){case s.AttribClass.VERTEX:this.delete_vertex_attribute(t,o);case s.AttribClass.OBJECT:this.delete_object_attribute(t,o)}}this.set_core_group(t)},t.prototype.delete_vertex_attribute=function(e,t){for(var n=0,r=e.objects();n<r.length;n++){r[n].traverse((function(e){var n=e;n.geometry&&new a.CoreGeometry(n.geometry).delete_attribute(t)}))}},t.prototype.delete_object_attribute=function(e,t){for(var n=function(e){var n=0;e.traverse((function(e){var r=e;new i.CoreObject(r,n).delete_attribute(t),n++}))},r=0,o=e.objects();r<o.length;r++){n(o[r])}},t}(o.TypedSopNode);t.AttribDeleteSopNode=p},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(14),i=n(1),a=r.__importDefault(n(174)),s=r.__importDefault(n(240)),_=r.__importDefault(n(39)),u=n(19),c=n(7),p=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name=c.ParamConfig.STRING(""),t.change_name=c.ParamConfig.BOOLEAN(!1),t.new_name=c.ParamConfig.STRING("",{visible_if:{change_name:1}}),t}return r.__extends(t,e),t}(c.NodeParamsConfig)),l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=p,t}return r.__extends(t,e),t.type=function(){return"attrib_normalize"},t.prototype.initialize_node=function(){this.io.inputs.set_count(1),this.io.inputs.init_inputs_clonable_state([u.InputCloneMode.FROM_NODE])},t.prototype.cook=function(e){var t=e[0];this._normalize_attribute(t),this.set_core_group(t)},t.prototype._normalize_attribute=function(e){var t=this,n=e.points();if(0!==n.length&&""!==this.pv.name){var r,o,u=n[0].attrib_size(this.pv.name),c=n.map((function(e){return e.attrib_value(t.pv.name)})),p=[];switch(u){case 1:if(r=s.default(c),o=a.default(c),_.default(r)&&_.default(o))for(var l=0,d=c;l<d.length;l++){var h=d[l],f=o>r?(h-r)/(o-r):1;p.push(f)}break;case 3:if(r=new i.Vector3(s.default(c.map((function(e){return e.x}))),s.default(c.map((function(e){return e.y}))),s.default(c.map((function(e){return e.z})))),o=new i.Vector3(a.default(c.map((function(e){return e.x}))),a.default(c.map((function(e){return e.y}))),a.default(c.map((function(e){return e.z})))),r instanceof i.Vector3&&o instanceof i.Vector3)for(var m=0,y=c;m<y.length;m++){h=y[m],f=new i.Vector3((h.x-r.x)/(o.x-r.x),(h.y-r.y)/(o.y-r.y),(h.z-r.z)/(o.z-r.z));p.push(f)}}var v=this.pv.name;this.pv.change_name&&(v=this.pv.new_name,e.has_attrib(v)||e.add_numeric_vertex_attrib(v,u,0)),p.forEach((function(e,t){n[t].set_attrib_value(v,e)}))}},t}(o.TypedSopNode);t.AttribNormalizeSopNode=l},,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,o=n(2),i=o.__importDefault(n(174)),a=o.__importDefault(n(240)),s=n(19),_=n(14),u=n(27),c=n(45);!function(e){e[e.MIN=0]="MIN",e[e.MAX=1]="MAX",e[e.FIRST_FOUND=3]="FIRST_FOUND"}(r=t.AttribPromoteMode||(t.AttribPromoteMode={}));var p=[{name:"min",value:r.MIN},{name:"max",value:r.MAX},{name:"first_found",value:r.FIRST_FOUND}],l=n(7),d=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.class_from=l.ParamConfig.INTEGER(u.AttribClass.VERTEX,{menu:{entries:u.AttribClassMenuEntries}}),t.class_to=l.ParamConfig.INTEGER(u.AttribClass.OBJECT,{menu:{entries:u.AttribClassMenuEntries}}),t.mode=l.ParamConfig.INTEGER(r.MIN,{menu:{entries:p}}),t.name=l.ParamConfig.STRING(""),t}return o.__extends(t,e),t}(l.NodeParamsConfig)),h=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=d,t._values_per_attrib_name={},t._filtered_values_per_attrib_name={},t}return o.__extends(t,e),t.type=function(){return"attrib_promote"},t.prototype.initialize_node=function(){this.io.inputs.set_count(1),this.io.inputs.init_inputs_clonable_state([s.InputCloneMode.FROM_NODE]),this.ui_data.set_icon("sort-amount-up")},t.prototype.create_params=function(){},t.prototype.cook=function(e){this._core_group=e[0],this._values_per_attrib_name={},this._filtered_values_per_attrib_name={};for(var t=0,n=this._core_group.core_objects();t<n.length;t++){var r=n[t];this._core_object=r,this.find_values(),this.filter_values(),this.set_values()}this.set_core_group(this._core_group)},t.prototype.find_values=function(){for(var e=0,t=c.CoreString.attrib_names(this.pv.name);e<t.length;e++){var n=t[e];switch(this.pv.class_from){case u.AttribClass.VERTEX:return this.find_values_from_points(n);case u.AttribClass.OBJECT:return this.find_values_from_object(n)}}},t.prototype.find_values_from_points=function(e){if(this._core_object){var t=this._core_object.points();this._values_per_attrib_name[e]=t.map((function(t){return t.attrib_value(e)}))}},t.prototype.find_values_from_object=function(e){this._values_per_attrib_name[e]=[],this._core_object&&this._values_per_attrib_name[e].push(this._core_object.attrib_value(e))},t.prototype.filter_values=function(){for(var e=0,t=Object.keys(this._values_per_attrib_name);e<t.length;e++){var n=t[e],o=this._values_per_attrib_name[n];switch(this.pv.mode){case r.MIN:this._filtered_values_per_attrib_name[n]=a.default(o);break;case r.MAX:this._filtered_values_per_attrib_name[n]=i.default(o);break;case r.FIRST_FOUND:this._filtered_values_per_attrib_name[n]=o[0]}}},t.prototype.set_values=function(){for(var e=0,t=Object.keys(this._filtered_values_per_attrib_name);e<t.length;e++){var n=t[e],r=this._filtered_values_per_attrib_name[n];if(null!=r)switch(this.pv.class_to){case u.AttribClass.VERTEX:this.set_values_to_points(n,r);break;case u.AttribClass.OBJECT:this.set_values_to_object(n,r)}}},t.prototype.set_values_to_points=function(e,t){if(this._core_group&&this._core_object){if(!this._core_group.has_attrib(e)){this._core_group.add_numeric_vertex_attrib(e,1,t)}this._core_object.points().forEach((function(n){return n.set_attrib_value(e,t)}))}},t.prototype.set_values_to_object=function(e,t){var n;null===(n=this._core_object)||void 0===n||n.set_attrib_value(e,t)},t}(_.TypedSopNode);t.AttribPromoteSopNode=h},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=r.__importDefault(n(174)),i=r.__importDefault(n(240)),a=r.__importDefault(n(96)),s=r.__importDefault(n(88)),_=r.__importDefault(n(39)),u=n(1),c=n(14),p=n(7),l=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name=p.ParamConfig.STRING(),t.ramp=p.ParamConfig.RAMP(),t.change_name=p.ParamConfig.BOOLEAN(0),t.new_name=p.ParamConfig.STRING("",{visible_if:{change_name:1}}),t}return r.__extends(t,e),t}(p.NodeParamsConfig)),d=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=l,t}return r.__extends(t,e),t.type=function(){return"attrib_remap"},t.prototype.initialize_node=function(){this.io.inputs.set_count(1)},t.prototype.cook=function(e){var t=e[0];this._remap_attribute(t),this.set_core_group(t)},t.prototype._remap_attribute=function(e){var t=this,n=e.points();if(0!==n.length&&""!==this.pv.name){var r,c,p=n[0].attrib_size(this.pv.name),l=n.map((function(e){return e.attrib_value(t.pv.name)})),d=new Array(n.length);switch(p){case 1:if(this.pv.only_integer_values){var h=s.default(a.default(l)),f={};h.forEach((function(e,t){return f[e]=t})),d=l.map((function(e){return f[e]}))}else if(r=i.default(l),c=o.default(l),_.default(r)&&_.default(c))for(var m=0,y=l;m<y.length;m++){var v=y[m],g=c>r?(v-r)/(c-r):1;d.push(g)}break;case 3:if(r=new u.Vector3(i.default(l.map((function(e){return e.x}))),i.default(l.map((function(e){return e.y}))),i.default(l.map((function(e){return e.z})))),c=new u.Vector3(o.default(l.map((function(e){return e.x}))),o.default(l.map((function(e){return e.y}))),o.default(l.map((function(e){return e.z})))),r instanceof u.Vector3&&c instanceof u.Vector3)for(var b=0,P=l;b<P.length;b++){v=P[b],g=new u.Vector3((v.x-r.x)/(c.x-r.x),(v.y-r.y)/(c.y-r.y),(v.z-r.z)/(c.z-r.z));d.push(g)}}var O=this.pv.name;this.pv.change_name&&(O=this.pv.new_name,e.has_attrib(O)||e.add_numeric_vertex_attrib(O,p,0)),d.forEach((function(e,t){n[t].set_attrib_value(O,e)}))}},t}(c.TypedSopNode);t.AttribRemapSopNode=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(14),i=n(7),a=n(27),s=n(19),_=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.class=i.ParamConfig.INTEGER(a.AttribClass.VERTEX,{menu:{entries:a.AttribClassMenuEntries}}),t.old_name=i.ParamConfig.STRING(),t.new_name=i.ParamConfig.STRING(),t}return r.__extends(t,e),t}(i.NodeParamsConfig)),u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=_,t}return r.__extends(t,e),t.type=function(){return"attrib_rename"},t.prototype.initialize_node=function(){this.io.inputs.set_count(1),this.io.inputs.init_inputs_clonable_state([s.InputCloneMode.FROM_NODE])},t.prototype.cook=function(e){var t=e[0];t.rename_attrib(this.pv.old_name,this.pv.new_name,this.pv.class),this.set_core_group(t)},t}(o.TypedSopNode);t.AttribRenameSopNode=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(14),i=n(694),a=n(695),s=n(339),_=n(7),u=n(19),c=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.src_group=_.ParamConfig.STRING(),t.dest_group=_.ParamConfig.STRING(),t.name=_.ParamConfig.STRING(),t.max_samples_count=_.ParamConfig.INTEGER(1,{range:[1,10],range_locked:[!0,!1]}),t.distance_threshold=_.ParamConfig.FLOAT(1),t.blend_width=_.ParamConfig.FLOAT(0),t}return r.__extends(t,e),t}(_.NodeParamsConfig)),p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=c,t}return r.__extends(t,e),t.type=function(){return"attrib_transfer"},t.displayed_input_names=function(){return["geometry to transfer attributes to","geometry to transfer attributes from"]},t.prototype.initialize_node=function(){this.io.inputs.set_count(2),this.io.inputs.init_inputs_clonable_state([u.InputCloneMode.FROM_NODE,u.InputCloneMode.NEVER])},t.prototype.cook=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t;return r.__generator(this,(function(n){switch(n.label){case 0:return this._core_group_dest=e[0],t=this._core_group_dest.points_from_group(this.pv.dest_group),this._core_group_src=e[1],this._attrib_names=this._core_group_src.attrib_names_matching_mask(this.pv.name),this._error_if_attribute_not_found_on_second_input(),this._build_octree_if_required(this._core_group_src),this._add_attribute_if_required(),[4,this._transfer_attributes(t)];case 1:return n.sent(),this.set_core_group(this._core_group_dest),[2]}}))}))},t.prototype._error_if_attribute_not_found_on_second_input=function(){for(var e=0,t=this._attrib_names;e<t.length;e++){var n=t[e];this._core_group_src.has_attrib(n)||this.states.error.set("attribute '"+n+"' not found on second input")}},t.prototype._build_octree_if_required=function(e){var t=null==this._octree_timestamp||this._octree_timestamp!==e.timestamp();if(this._prev_param_src_group!==this.pv.src_group||t){this._octree_timestamp=e.timestamp(),this._prev_param_src_group=this.pv.src_group;var n=this._core_group_src.points_from_group(this.pv.src_group);this._octree=new a.CoreOctree(this._core_group_src.bounding_box()),this._octree.set_points(n)}},t.prototype._add_attribute_if_required=function(){var e=this;this._attrib_names.forEach((function(t){if(!e._core_group_dest.has_attrib(t)){var n=e._core_group_src.attrib_size(t);e._core_group_dest.add_numeric_vertex_attrib(t,n,0)}}))},t.prototype._transfer_attributes=function(e){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(t){switch(t.label){case 0:return[4,(new s.CoreIterator).start_with_array(e,this._transfer_attributes_for_point.bind(this))];case 1:return t.sent(),[2]}}))}))},t.prototype._transfer_attributes_for_point=function(e){for(var t,n=this.pv.distance_threshold+this.pv.blend_width,r=(null===(t=this._octree)||void 0===t?void 0:t.find_points(e.position(),n,this.pv.max_samples_count))||[],o=0,i=this._attrib_names;o<i.length;o++){var a=i[o];this._interpolate_points(e,r,a)}},t.prototype._interpolate_points=function(e,t,n){var r;null!=(r=i.CoreInterpolate.perform(e,t,n,this.pv.distance_threshold,this.pv.blend_width))&&e.set_attrib_value(n,r)},t}(o.TypedSopNode);t.AttribTransferSopNode=p},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=r.__importDefault(n(174)),i=r.__importDefault(n(173)),a=function(){function e(){}return e.perform=function(e,t,n,r,o){switch(t.length){case 0:return 0;case 1:return this._interpolate_with_1_point(e,t[0],n,r,o);default:return this._interpolate_with_multiple_points(e,t,n,r,o)}},e._interpolate_with_1_point=function(e,t,n,r,o){var i=e.position(),a=t.position(),s=i.distanceTo(a),_=t.attrib_value(n);return this._weighted_value_from_distance(e,_,n,s,r,o)},e._weight_from_distance=function(e,t,n){return(e-t)/n},e._weighted_value_from_distance=function(e,t,n,r,o,i){if(r<=o)return t;var a=e.attrib_value(n),s=this._weight_from_distance(r,o,i);return s*a+(1-s)*t},e._interpolate_with_multiple_points=function(e,t,n,r,i){var a=this,s=t.map((function(t){return a._interpolate_with_1_point(e,t,n,r,i)}));return o.default(s)||0},e.weights=function(e,t){switch(t.length){case 1:return 1;case 2:return this._weights_from_2(e,t);default:return t=t.slice(0,3),this._weights_from_3(e,t)}},e._weights_from_2=function(e,t){var n=t.map((function(t){return e.distanceTo(t)})),r=i.default(n);return[n[1]/r,n[0]/r]},e._weights_from_3=function(e,t){var n=t.map((function(t){return e.distanceTo(t)})),r=i.default([n[0]*n[1],n[0]*n[2],n[1]*n[2]]);return[n[1]*n[2]/r,n[0]*n[2]/r,n[0]*n[1]/r]},e}();t.CoreInterpolate=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(36),i=r.__importDefault(n(96)),a=n(696),s=function(){function e(e){this._root=new a.OctreeNode(e)}return e.prototype.set_points=function(e){this._root.set_points(e)},e.prototype.traverse=function(e){this._root.traverse(e)},e.prototype.find_points=function(e,t,n){var r=new o.Sphere(e,t),a=[];return this._root.intersects_sphere(r)&&this._root.points_in_sphere(r,a),null==n?a:(a.length>n&&(a=(a=i.default(a,(function(t){return t.position().distanceTo(e)}))).slice(0,n)),a)},e}();t.CoreOctree=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(47),i=r.__importDefault(n(77)),a=function(){function e(e,t){void 0===t&&(t=0),this._bbox=e,this._level=t,this._leaves_by_octant={},this._points_by_octant_id={},this._leaves=[],this._bounding_boxes_by_octant={},this._bounding_boxes_by_octant_prepared=!1,this._center=this._bbox.max.clone().add(this._bbox.min).multiplyScalar(.5)}return e.prototype.level=function(){return this._level},e.prototype.traverse=function(e){e(this),Object.values(this._leaves_by_octant).forEach((function(t){t.traverse(e)}))},e.prototype.intersects_sphere=function(e){return!!this._bbox&&this._bbox.intersectsSphere(e)},e.prototype.points_in_sphere=function(e,t){0==this._leaves.length?i.default(Object.values(this._points_by_octant_id)).filter((function(t){return e.containsPoint(t.position())})).forEach((function(e){t.push(e)})):this._leaves.filter((function(t){return t.intersects_sphere(e)})).forEach((function(n){return n.points_in_sphere(e,t)}))},e.prototype.bounding_box=function(){return this._bbox},e.prototype.set_points=function(e){var t=this;this._points_by_octant_id={};for(var n=0,r=e;n<r.length;n++){var o=r[n];this.add_point(o)}var i=Object.keys(this._points_by_octant_id);i.length>1&&i.forEach((function(e){t.create_leaf(e)}))},e.prototype.create_leaf=function(t){var n=new e(this._leaf_bbox(t),this._level+1);this._leaves_by_octant[t]=n,this._leaves.push(n),n.set_points(this._points_by_octant_id[t])},e.prototype.add_point=function(e){var t=this._octant_id(e.position());null==this._points_by_octant_id[t]&&(this._points_by_octant_id[t]=[]),this._points_by_octant_id[t].push(e)},e.prototype._octant_id=function(e){return""+(e.x>this._center.x?1:0)+(e.y>this._center.y?1:0)+(e.z>this._center.z?1:0)},e.prototype._leaf_bbox=function(e){return this._bounding_boxes_by_octant_prepared||(this._prepare_leaves_bboxes(),this._bounding_boxes_by_octant_prepared=!0),this._bounding_boxes_by_octant[e]},e.prototype._bbox_center=function(e,t,n){var r=this._bbox.min.clone();return e&&(r.x=this._bbox.max.x),t&&(r.y=this._bbox.max.y),n&&(r.z=this._bbox.max.z),r.clone().add(this._center).multiplyScalar(.5)},e.prototype._prepare_leaves_bboxes=function(){var e=[];e.push(this._bbox_center(0,0,0)),e.push(this._bbox_center(0,0,1)),e.push(this._bbox_center(0,1,0)),e.push(this._bbox_center(0,1,1)),e.push(this._bbox_center(1,0,0)),e.push(this._bbox_center(1,0,1)),e.push(this._bbox_center(1,1,0)),e.push(this._bbox_center(1,1,1));for(var t=this._bbox.max.clone().sub(this._bbox.min).multiplyScalar(.25),n=0,r=e;n<r.length;n++){var i=r[n],a=this._octant_id(i),s=new o.Box3(i.clone().sub(t),i.clone().add(t));this._bounding_boxes_by_octant[a]=s}},e}();t.OctreeNode=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(5),i=n(4),a=r.__importDefault(n(87)),s=n(14),_=n(27),u=n(7),c=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.step_size=u.ParamConfig.FLOAT(.1),t}return r.__extends(t,e),t}(u.NodeParamsConfig)),p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=c,t}return r.__extends(t,e),t.type=function(){return"bbox_scatter"},t.displayed_input_names=function(){return["geometry to create points from"]},t.prototype.initialize_node=function(){this.io.inputs.set_count(1)},t.prototype.cook=function(e){var t=e[0],n=this.pv.step_size,r=t.bounding_box(),s={x:a.default(r.min.x,r.max.x,n),y:a.default(r.min.y,r.max.y,n),z:a.default(r.min.z,r.max.z,n)},u=[];s.x.forEach((function(e){s.y.forEach((function(t){s.z.forEach((function(n){u.push(e),u.push(t),u.push(n)}))}))}));var c=new o.BufferGeometry;c.setAttribute("position",new i.BufferAttribute(new Float32Array(u),3)),this.set_geometry(c,_.CoreConstant.OBJECT_TYPE.POINTS)},t}(s.TypedSopNode);t.BboxScatterSopNode=p},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(14),i=n(7),a=n(19),s=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.attrib_name=i.ParamConfig.STRING(),t.blend=i.ParamConfig.FLOAT(.5,{range:[0,1],range_locked:[!0,!0]}),t}return r.__extends(t,e),t}(i.NodeParamsConfig)),_=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=s,t}return r.__extends(t,e),t.type=function(){return"blend"},t.displayed_input_names=function(){return["geometry to blend from","geometry to blend to"]},t.prototype.initialize_node=function(){this.io.inputs.set_count(2),this.io.inputs.init_inputs_clonable_state([a.InputCloneMode.FROM_NODE,a.InputCloneMode.NEVER])},t.prototype.cook=function(e){for(var t,n,r=e[0],o=e[1],i=r.objects(),a=o.objects(),s=0;s<i.length;s++)t=i[s],n=a[s],this.blend(t,n,this.pv.blend);this.set_core_group(r)},t.prototype.blend=function(e,t,n){var r=e.geometry,o=t.geometry;if(null!=r&&null!=o){var i=r.getAttribute(this.pv.attrib_name),a=o.getAttribute(this.pv.attrib_name);if(null!=i&&null!=a){for(var s,_,u=i.array,c=a.array,p=0;p<u.length;p++)s=u[p],null!=(_=c[p])&&(u[p]=(1-n)*s+n*_);r.computeVertexNormals()}}},t}(o.TypedSopNode);t.BlendSopNode=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(14),i=n(68),a=n(115),s=n(19),_=n(7),u=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.size=_.ParamConfig.FLOAT(1),t.divisions=_.ParamConfig.FLOAT(1,{range:[1,10],range_locked:[!0,!1]}),t.center=_.ParamConfig.VECTOR3([0,0,0]),t}return r.__extends(t,e),t}(_.NodeParamsConfig)),c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=u,t._core_transform=new i.CoreTransform,t}return r.__extends(t,e),t.type=function(){return"box"},t.displayed_input_names=function(){return["geometry to create bounding box from (optional)"]},t.prototype.initialize_node=function(){this.io.inputs.set_count(0,1),this.io.inputs.init_inputs_clonable_state([s.InputCloneMode.NEVER])},t.prototype.cook=function(e){var t=e[0];t?this._cook_with_input(t):this._cook_without_input()},t.prototype._cook_without_input=function(){var e=this.pv.divisions,t=this.pv.size,n=new a.BoxBufferGeometry(t,t,t,e,e,e);n.translate(this.pv.center.x,this.pv.center.y,this.pv.center.z),n.computeVertexNormals(),this.set_geometry(n)},t.prototype._cook_with_input=function(e){var t=this.pv.divisions,n=e.bounding_box(),r=n.max.clone().sub(n.min),o=n.max.clone().add(n.min).multiplyScalar(.5),i=new a.BoxBufferGeometry(r.x,r.y,r.z,t,t,t),s=this._core_transform.translation_matrix(o);i.applyMatrix(s),this.set_geometry(i)},t}(o.TypedSopNode);t.BoxSopNode=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(374),i=n(14),a=n(7),s=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.cache=a.ParamConfig.STRING("",{hidden:!0}),t.reset=a.ParamConfig.BUTTON(null,{callback:function(e,t){_.PARAM_CALLBACK_reset(e,t)}}),t}return r.__extends(t,e),t}(a.NodeParamsConfig)),_=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=s,t}return r.__extends(t,e),t.type=function(){return"cache"},t.displayed_input_names=function(){return["geometry to cache"]},t.prototype.initialize_node=function(){this.io.inputs.set_count(0,1)},t.prototype.cook=function(e){var t=""==this.pv.cache||null==this.pv.cache,n=e[0];if(t&&n){for(var r=[],i=0,a=n.objects();i<a.length;i++){var s=a[i];r.push(s.toJSON())}this.set_core_group(n),this.p.cache.set(JSON.stringify(r))}else if(this.pv.cache){for(var _=new o.ObjectLoader,u=[],c=0,p=JSON.parse(this.pv.cache);c<p.length;c++){r=p[c];var l=_.parse(r);u.push(l)}this.set_objects(u)}else this.set_objects([])},t.PARAM_CALLBACK_reset=function(e,t){e.param_callback_PARAM_CALLBACK_reset()},t.prototype.param_callback_PARAM_CALLBACK_reset=function(){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(e){return this.p.cache.set(""),this.request_container(),[2]}))}))},t}(i.TypedSopNode);t.CacheSopNode=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(1),i=n(181),a=n(14),s=n(340),_=n(27),u=n(68),c=new o.Vector3(0,0,1),p=n(7),l=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.radius=p.ParamConfig.FLOAT(1),t.segments=p.ParamConfig.INTEGER(12,{range:[1,50],range_locked:[!0,!1]}),t.open=p.ParamConfig.BOOLEAN(1),t.arc_angle=p.ParamConfig.FLOAT(360,{range:[0,360],range_locked:[!1,!1],visible_if:{open:1}}),t.direction=p.ParamConfig.VECTOR3([0,1,0]),t}return r.__extends(t,e),t}(p.NodeParamsConfig)),d=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=l,t._core_transform=new u.CoreTransform,t}return r.__extends(t,e),t.type=function(){return"circle"},t.prototype.initialize_node=function(){},t.prototype.cook=function(){this.pv.open?this._create_circle():this._create_disk()},t.prototype._create_circle=function(){var e=s.CoreGeometryUtilCircle.create(this.pv.radius,this.pv.segments,this.pv.arc_angle);this._core_transform.rotate_geometry(e,c,this.pv.direction),this.set_geometry(e,_.ObjectType.LINE_SEGMENTS)},t.prototype._create_disk=function(){var e=new i.CircleBufferGeometry(this.pv.radius,this.pv.segments);this._core_transform.rotate_geometry(e,c,this.pv.direction),this.set_geometry(e)},t}(a.TypedSopNode);t.CircleSopNode=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(6),i=n(703),a=n(14),s=n(19),_=new o.Color(1,1,1),u=n(7),c=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.from_attribute=u.ParamConfig.BOOLEAN(0),t.attrib_name=u.ParamConfig.STRING("",{visible_if:{from_attribute:1}}),t.color=u.ParamConfig.COLOR([1,1,1],{visible_if:{from_attribute:0},expression:{for_entities:!0}}),t.as_hsv=u.ParamConfig.BOOLEAN(0,{visible_if:{from_attribute:0}}),t}return r.__extends(t,e),t}(u.NodeParamsConfig)),p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=c,t._r_arrays_by_geometry_uuid={},t._g_arrays_by_geometry_uuid={},t._b_arrays_by_geometry_uuid={},t}return r.__extends(t,e),t.type=function(){return"color"},t.displayed_input_names=function(){return["geometry to update color of"]},t.prototype.initialize_node=function(){this.io.inputs.set_count(1),this.io.inputs.init_inputs_clonable_state([s.InputCloneMode.FROM_NODE]),this.ui_data.set_icon("palette")},t.prototype.cook=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,n,o,i,a,s,_,u;return r.__generator(this,(function(r){switch(r.label){case 0:t=e[0],n=t.core_objects(),o=0,i=n,r.label=1;case 1:return o<i.length?(a=i[o],this.pv.from_attribute?(this._set_from_attribute(a),[3,5]):[3,2]):[3,6];case 2:return this.p.color.has_expression()?[4,this._eval_expressions(a)]:[3,4];case 3:return r.sent(),[3,5];case 4:this._eval_simple_values(a),r.label=5;case 5:return o++,[3,1];case 6:if(!this.io.inputs.input_cloned(0))for(s=t.geometries(),_=0,u=s;_<u.length;_++)u[_].getAttribute("color").needsUpdate=!0;return this.set_core_group(t),[2]}}))}))},t.prototype._set_from_attribute=function(e){var t=e.core_geometry();this._create_init_color(t,_);var n=t.points(),r=t.attrib_size(this.pv.attrib_name),o=t.geometry(),i=o.getAttribute(this.pv.attrib_name).array,a=o.getAttribute("color").array;switch(r){case 1:for(var s=0;s<n.length;s++){a[(c=3*s)+0]=i[s],a[c+1]=1-i[s],a[c+2]=0}break;case 2:for(s=0;s<n.length;s++){var u=2*s;a[(c=3*s)+0]=i[u+0],a[c+1]=i[u+1],a[c+2]=0}break;case 3:for(s=0;s<i.length;s++)a[s]=i[s];break;case 4:for(s=0;s<n.length;s++){var c;u=4*s;a[(c=3*s)+0]=i[u+0],a[c+1]=i[u+1],a[c+2]=i[u+2]}}},t.prototype._create_init_color=function(e,t){e.has_attrib("color")||e.add_numeric_attrib("color",3,_)},t.prototype._eval_simple_values=function(e){var t,n=e.core_geometry();this._create_init_color(n,_),this.pv.as_hsv?(t=new o.Color,i.CoreColor.set_hsv(this.pv.color.r,this.pv.color.g,this.pv.color.b,t)):t=this.pv.color,n.add_numeric_attrib("color",3,t)},t.prototype._eval_expressions=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,n,a,s,u,c,p,l,d,h,f,m,y,v;return r.__generator(this,(function(r){switch(r.label){case 0:return t=e.points(),n=e.object(),a=e.core_geometry(),this._create_init_color(a,_),(s=n.geometry)?(u=s.getAttribute("color").array,[4,this._update_from_param(s,u,t,0)]):[3,4];case 1:return c=r.sent(),[4,this._update_from_param(s,u,t,1)];case 2:return p=r.sent(),[4,this._update_from_param(s,u,t,2)];case 3:if(l=r.sent(),c&&this._commit_tmp_values(c,u,0),p&&this._commit_tmp_values(p,u,1),l&&this._commit_tmp_values(l,u,2),this.pv.as_hsv)for(d=new o.Color,h=new o.Color,f=void 0,m=0,y=t;m<y.length;m++)v=y[m],f=3*v.index,d.fromArray(u,f),i.CoreColor.set_hsv(d.r,d.g,d.b,h),h.toArray(u,f);r.label=4;case 4:return[2]}}))}))},t.prototype._update_from_param=function(e,t,n,o){return r.__awaiter(this,void 0,void 0,(function(){var i,a,s,_,u,c,p;return r.__generator(this,(function(r){switch(r.label){case 0:return i=this.p.color.components[o],a=[this.pv.color.r,this.pv.color.g,this.pv.color.b][o],s=[this._r_arrays_by_geometry_uuid,this._g_arrays_by_geometry_uuid,this._b_arrays_by_geometry_uuid][o],i.has_expression()&&i.expression_controller?(_=this._init_array_if_required(e,s,n.length),[4,i.expression_controller.compute_expression_for_points(n,(function(e,t){_[e.index]=t}))]):[3,2];case 1:return r.sent(),[3,3];case 2:for(u=0,c=n;u<c.length;u++)p=c[u],t[3*p.index+o]=a;r.label=3;case 3:return[2,_]}}))}))},t.prototype._init_array_if_required=function(e,t,n){var r=e.uuid,o=t[r];return o?o.length<n&&(t[r]=new Array(n)):t[r]=new Array(n),t[r]},t.prototype._commit_tmp_values=function(e,t,n){for(var r=0;r<e.length;r++)t[3*r+n]=e[r]},t}(a.TypedSopNode);t.ColorSopNode=p},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(13),o=function(){function e(){}return e.set_hsv=function(e,t,n,o){e=r._Math.euclideanModulo(e,1),t=r._Math.clamp(t,0,1),n=r._Math.clamp(n,0,1),o.setHSL(e,t*n/((e=(2-t)*n)<1?e:2-e),.5*e)},e}();t.CoreColor=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=r.__importDefault(n(85)),i=n(14),a=n(238),s=n(705),_=n(45),u=n(706),c=n(7),p=n(19),l=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.count=c.ParamConfig.INTEGER(1,{range:[1,20],range_locked:[!0,!1]}),t.transform_only=c.ParamConfig.BOOLEAN(0),t.copy_attributes=c.ParamConfig.BOOLEAN(0),t.attributes_to_copy=c.ParamConfig.STRING("",{visible_if:{copy_attributes:!0}}),t.use_copy_expr=c.ParamConfig.BOOLEAN(0),t}return r.__extends(t,e),t}(c.NodeParamsConfig)),d=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=l,t._attribute_names_to_copy=[],t._objects=[],t}return r.__extends(t,e),t.type=function(){return"copy"},t.displayed_input_names=function(){return["geometry to be copied","points to copy to"]},t.prototype.initialize_node=function(){this.io.inputs.set_count(1,2),this.io.inputs.init_inputs_clonable_state([p.InputCloneMode.ALWAYS,p.InputCloneMode.NEVER])},t.prototype.cook=function(){return r.__awaiter(this,void 0,void 0,(function(){var e,t,n,o;return r.__generator(this,(function(r){switch(r.label){case 0:return[4,this.container_controller.request_input_container(0)];case 1:return null==(t=r.sent())||null==(e=t.core_content())?[3,8]:this.io.inputs.has_input(1)?(n=void 0,[4,this.container_controller.request_input_container(1)]):[3,6];case 2:return null==(o=r.sent())||null==(n=o.core_content())?[3,4]:[4,this.cook_with_template(e,n)];case 3:return r.sent(),[3,5];case 4:this.states.error.set("second input required"),r.label=5;case 5:return[3,7];case 6:this.cook_without_template(e),r.label=7;case 7:return[3,9];case 8:this.states.error.set("first input required"),r.label=9;case 9:return[2]}}))}))},t.prototype.cook_with_template=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var n,o,i;return r.__generator(this,(function(r){switch(r.label){case 0:return this._objects=[],n=t.points(),o=new s.CoreInstancer(t),i=o.matrices(),this._attribute_names_to_copy=_.CoreString.attrib_names(this.pv.attributes_to_copy).filter((function(e){return t.has_attrib(e)})),[4,this._copy_moved_objects_on_template_points(e,i,n)];case 1:return r.sent(),this.set_objects(this._objects),[2]}}))}))},t.prototype._copy_moved_objects_on_template_points=function(e,t,n){return r.__awaiter(this,void 0,void 0,(function(){var o;return r.__generator(this,(function(r){switch(r.label){case 0:o=0,r.label=1;case 1:return o<n.length?[4,this._copy_moved_object_on_template_point(e,t,n,o)]:[3,4];case 2:r.sent(),r.label=3;case 3:return o++,[3,1];case 4:return[2]}}))}))},t.prototype._copy_moved_object_on_template_point=function(e,t,n,o){var i=this;return new Promise((function(a,s){return r.__awaiter(i,void 0,void 0,(function(){var i,s,_=this;return r.__generator(this,(function(r){switch(r.label){case 0:return i=t[o],s=n[o],this.stamp_node.set_point(s),[4,this._get_moved_objects_for_template_point(e,o)];case 1:return r.sent().forEach((function(e){return _.pv.copy_attributes&&_._copy_attributes_from_template(e,s),_.pv.transform_only?e.applyMatrix(i):e.geometry.applyMatrix(i),_._objects.push(e)})),[2,a()]}}))}))}))},t.prototype._get_moved_objects_for_template_point=function(e,t){var n=this;return new Promise((function(i,a){return r.__awaiter(n,void 0,void 0,(function(){var n;return r.__generator(this,(function(r){switch(r.label){case 0:return[4,this._stamp_instance_group_if_required(e)];case 1:return r.sent()?(n=this.pv.transform_only?o.default([e.objects()[t]]):e.clone().objects(),i(n)):i([]),[2]}}))}))}))},t.prototype._stamp_instance_group_if_required=function(e){var t=this;return new Promise((function(n,o){return r.__awaiter(t,void 0,void 0,(function(){var t,o;return r.__generator(this,(function(r){switch(r.label){case 0:return this.pv.use_copy_expr?[4,this.container_controller.request_input_container(0)]:[3,2];case 1:return t=r.sent(),o=void 0,t&&null!=(o=t.core_content())?n(o):(this.states.error.set("input failed for index "+this.stamp_value()),n()),[3,3];case 2:n(e),r.label=3;case 3:return[2]}}))}))}))},t.prototype._copy_moved_objects_for_each_instance=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t;return r.__generator(this,(function(n){switch(n.label){case 0:t=0,n.label=1;case 1:return t<this.pv.count?[4,this._copy_moved_objects_for_instance(e,t)]:[3,4];case 2:n.sent(),n.label=3;case 3:return t++,[3,1];case 4:return[2]}}))}))},t.prototype._copy_moved_objects_for_instance=function(e,t){var n=this;return new Promise((function(o,i){return r.__awaiter(n,void 0,void 0,(function(){var n,i=this;return r.__generator(this,(function(r){switch(r.label){case 0:return this.stamp_node.set_global_index(t),[4,this._stamp_instance_group_if_required(e)];case 1:return(n=r.sent())&&n.objects().forEach((function(e){var t=a.CoreObject.clone(e);i._objects.push(t)})),o(),[2]}}))}))}))},t.prototype.cook_without_template=function(e){var t=this;this._objects=[],this._copy_moved_objects_for_each_instance(e).then((function(){t.set_objects(t._objects)}))},t.prototype._copy_attributes_from_template=function(e,t){this._attribute_names_to_copy.forEach((function(n,r){var o=t.attrib_value(n);new a.CoreObject(e,r).add_attribute(n,o)}))},t.prototype.stamp_value=function(e){return this.stamp_node.value(e)},Object.defineProperty(t.prototype,"stamp_node",{get:function(){return this._stamp_node=this._stamp_node||this.create_stamp_node()},enumerable:!0,configurable:!0}),t.prototype.create_stamp_node=function(){var e=new u.CopyStamp(this.scene);return this.dirty_controller.set_forbidden_trigger_nodes([e]),e},t}(i.TypedSopNode);t.CopySopNode=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2).__importDefault(n(39)),o=n(1),i=n(3),a=n(33),s=n(15),_=n(252),u=n(253),c=n(46),p={SCALE:new o.Vector3(1,1,1),PSCALE:1,EYE:new o.Vector3(0,0,0),UP:new o.Vector3(0,1,0)},l=new o.Vector3(1,1,1),d=new i.Vector2(0,0),h=function(){function e(e){this._group_wrapper=e,this._matrices={},this._is_pscale_present=this._group_wrapper.has_attrib("pscale"),this._is_scale_present=this._group_wrapper.has_attrib("scale"),this._is_normal_present=this._group_wrapper.has_attrib("normal"),this._is_up_present=this._group_wrapper.has_attrib("up"),this._do_rotate_matrices=this._is_normal_present}return e.prototype.matrices=function(){var e=this;return this._matrices={},this._matrices.translate=new s.Matrix4,this._matrices.rotate=new s.Matrix4,this._matrices.scale=new s.Matrix4,this._group_wrapper.points().map((function(t){return e._matrix_from_point(t)}))},e.prototype._matrix_from_point=function(e){var t=e.position(),n=this._is_scale_present?e.attrib_value("scale"):p.SCALE,r=this._is_pscale_present?e.attrib_value("pscale"):p.PSCALE;n=n.clone().multiplyScalar(r);var o=new s.Matrix4;o.identity();var i=this._matrices.scale;i.makeScale(n.x,n.y,n.z);var a=this._matrices.translate;if(a.makeTranslation(t.x,t.y,t.z),o.multiply(a),this._do_rotate_matrices){var _=this._matrices.rotate,u=p.EYE,c=e.attrib_value("normal").multiplyScalar(-1),l=this._is_up_present?e.attrib_value("up"):p.UP;l.normalize(),_.lookAt(u,c,l),o.multiply(_)}return o.multiply(i),o},e.create_instance_buffer_geo=function(t,n,i){var s=n.points(),p=new _.InstancedBufferGeometry;p.copy(t);var h=s.length,f=new Float32Array(3*h),m=new Float32Array(3*h),y=new Float32Array(3*h),v=new Float32Array(4*h),g=n.has_attrib("color"),b=new o.Vector3(0,0,0),P=new a.Quaternion,O=new o.Vector3(1,1,1),C=new e(n).matrices();s.forEach((function(e,t){var n=3*t,r=4*t;C[t].decompose(b,P,O),b.toArray(f,n),P.toArray(v,r),O.toArray(y,n),(g?e.attrib_value("color"):l).toArray(m,n)}));var E=n.has_attrib("uv");if(E){var T=new Float32Array(2*h);s.forEach((function(e,t){var n=2*t;(E?e.attrib_value("uv"):d).toArray(T,n)})),p.setAttribute("instanceUv",new u.InstancedBufferAttribute(T,2))}return p.setAttribute("instancePosition",new u.InstancedBufferAttribute(f,3)),p.setAttribute("instanceScale",new u.InstancedBufferAttribute(y,3)),p.setAttribute("instanceOrientation",new u.InstancedBufferAttribute(v,4)),p.setAttribute("instanceColor",new u.InstancedBufferAttribute(m,3)),n.attrib_names_matching_mask(i).forEach((function(e){var t=n.attrib_size(e),o=new Float32Array(h*t);s.forEach((function(n,i){var a=n.attrib_value(e);r.default(a)?o[i]=a:a.toArray(o,i*t)})),p.setAttribute(e,new u.InstancedBufferAttribute(o,t))})),new c.CoreGeometry(p).mark_as_instance(),p},e}();t.CoreInstancer=h},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=function(e){function t(t){var n=e.call(this,t,"CopyStamp")||this;return n._global_index=0,n}return r.__extends(t,e),t.prototype.set_point=function(e){this._point=e,this.set_dirty(),this.remove_dirty_state()},t.prototype.set_global_index=function(e){this._global_index=e,this.set_dirty(),this.remove_dirty_state()},t.prototype.value=function(e){return this._point?e?this._point.attrib_value(e):this._point.index:this._global_index},t}(n(61).CoreGraphNode);t.CopyStamp=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(14),i=n(341),a=JSON.stringify([{value:-40},{value:-30},{value:-20},{value:-10},{value:0},{value:10},{value:20},{value:30},{value:40},{value:50},{value:60},{value:70},{value:80}]),s=n(7),_=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.data=s.ParamConfig.STRING(a),t}return r.__extends(t,e),t}(s.NodeParamsConfig)),u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=_,t}return r.__extends(t,e),t.type=function(){return"data"},t.prototype.cook=function(){var e=null;try{e=JSON.parse(this.pv.data)}catch(e){this.states.error.set("could not parse json")}if(e){var t=new i.JsonDataLoader;t.set_json(e);var n=t.create_object();this.set_object(n)}else this.cook_controller.end_cook()},t}(o.TypedSopNode);t.DataSopNode=u},,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=r.__importDefault(n(20)),i=r.__importDefault(n(38)),a=n(27),s=function(){function e(e,t){this._size=e,this._type=t}return e.prototype.size=function(){return this._size},e.prototype.type=function(){return this._type},e.from_value=function(e){var t=i.default(e)?a.CoreConstant.ATTRIB_TYPE.STRING:a.CoreConstant.ATTRIB_TYPE.NUMERIC;return new this(o.default(e)?e.length:1,t)},e}();t.CoreAttributeData=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(14),i=n(341),a=n(7),s=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.url=a.ParamConfig.STRING("/examples/sop/data_url/basic.json"),t.json_data_keys_prefix=a.ParamConfig.STRING(""),t.skip_entries=a.ParamConfig.STRING(""),t.convert=a.ParamConfig.BOOLEAN(0),t.convert_to_numeric=a.ParamConfig.STRING("",{visible_if:{convert:1}}),t.reload=a.ParamConfig.BUTTON(null,{callback:function(e,t){_.PARAM_CALLBACK_reload(e,t)}}),t}return r.__extends(t,e),t}(a.NodeParamsConfig)),_=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=s,t}return r.__extends(t,e),t.type=function(){return"data_url"},t.prototype.cook=function(){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(e){return new i.JsonDataLoader({data_keys_prefix:this.pv.json_data_keys_prefix,skip_entries:this.pv.skip_entries,do_convert:this.pv.convert,convert_to_numeric:this.pv.convert_to_numeric}).load(this.pv.url,this._on_load.bind(this),void 0,this._on_error.bind(this)),[2]}))}))},t.prototype._on_load=function(e){this.set_objects([e])},t.prototype._on_error=function(e){this.states.error.set("could not load geometry from "+this.pv.url+" ("+e+")"),this.cook_controller.end_cook()},t.PARAM_CALLBACK_reload=function(e,t){e.param_callback_reload()},t.prototype.param_callback_reload=function(){this.p.url.set_dirty()},t}(o.TypedSopNode);t.DataUrlSopNode=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(14),i=n(7),a=n(19),s=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.duration=i.ParamConfig.INTEGER(1e3),t}return r.__extends(t,e),t}(i.NodeParamsConfig)),_=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=s,t}return r.__extends(t,e),t.type=function(){return"delay"},t.prototype.initialize_node=function(){this.io.inputs.set_count(1),this.io.inputs.init_inputs_clonable_state([a.InputCloneMode.ALWAYS])},t.prototype.cook=function(e){var t=this,n=e[0];setTimeout((function(){t.set_core_group(n)}),this.pv.duration)},t}(o.TypedSopNode);t.DelaySopNode=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,o=n(2),i=n(47),a=o.__importDefault(n(38)),s=o.__importDefault(n(154)),_=n(14),u=n(45),c=n(27),p=n(46),l=n(19);!function(e){e[e["=="]=0]="==",e[e["<"]=1]="<",e[e["<="]=2]="<=",e[e[">="]=3]=">=",e[e[">"]=4]=">",e[e["!="]=5]="!="}(r||(r={}));var d=[{name:"==",value:r["=="]},{name:"<",value:r["<"]},{name:"<=",value:r["<="]},{name:">=",value:r[">="]},{name:">",value:r[">"]},{name:"!=",value:r["!="]}],h=n(7),f=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.class=h.ParamConfig.INTEGER(c.AttribClass.VERTEX,{menu:{entries:c.AttribClassMenuEntries}}),t.invert=h.ParamConfig.BOOLEAN(0),t.hide_objects=h.ParamConfig.BOOLEAN(0),t.by_object_type=h.ParamConfig.BOOLEAN(0),t.object_type=h.ParamConfig.INTEGER(c.ObjectTypes.indexOf(c.ObjectType.MESH),{menu:{entries:c.ObjectTypeMenuEntries},visible_if:{by_object_type:!0}}),t.by_expression=h.ParamConfig.BOOLEAN(0),t.expression=h.ParamConfig.BOOLEAN("@ptnum==0",{visible_if:{by_expression:!0},expression:{for_entities:!0}}),t.by_attrib=h.ParamConfig.BOOLEAN(0),t.attrib_name=h.ParamConfig.STRING("",{visible_if:{by_attrib:!0}}),t.attrib_string=h.ParamConfig.STRING("",{visible_if:{by_attrib:!0}}),t.attrib_numeric=h.ParamConfig.VECTOR4([0,0,0,0],{visible_if:{by_attrib:!0}}),t.attrib_comparison_operator=h.ParamConfig.INTEGER(r["=="],{menu:{entries:d},visible_if:{by_attrib:!0}}),t.by_bbox=h.ParamConfig.BOOLEAN(0),t.bbox_size=h.ParamConfig.VECTOR3([1,1,1],{visible_if:{by_bbox:!0}}),t.bbox_center=h.ParamConfig.VECTOR3([0,0,0],{visible_if:{by_bbox:!0}}),t.by_visible=h.ParamConfig.BOOLEAN(0),t.keep_points=h.ParamConfig.BOOLEAN(1,{visible_if:{class:c.AttribClass.OBJECT}}),t}return o.__extends(t,e),t}(h.NodeParamsConfig)),m=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=f,t._marked_for_deletion_per_object_index=new Map,t}return o.__extends(t,e),t.type=function(){return"delete"},t.displayed_input_names=function(){return["geometry to delete from"]},t.prototype.initialize_node=function(){this.io.inputs.set_count(1),this.io.inputs.init_inputs_clonable_state([l.InputCloneMode.FROM_NODE])},t.prototype.cook=function(e){return o.__awaiter(this,void 0,void 0,(function(){var t;return o.__generator(this,(function(n){switch(n.label){case 0:switch(t=e[0],this._bbox_cache=void 0,this.pv.class){case c.AttribClass.VERTEX:return[3,1];case c.AttribClass.OBJECT:return[3,3]}return[3,5];case 1:return[4,this._eval_for_points(t)];case 2:return n.sent(),[3,5];case 3:return[4,this._eval_for_objects(t)];case 4:return n.sent(),[3,5];case 5:return[2]}}))}))},t.prototype._eval_for_objects=function(e){return o.__awaiter(this,void 0,void 0,(function(){var t,n,r,i,a,s,_,u,c,p,l,d=this;return o.__generator(this,(function(o){switch(o.label){case 0:for(t=[],n=e.core_objects(),this._marked_for_deletion_per_object_index=new Map,r=0,i=n;r<i.length;r++)a=i[r],this._marked_for_deletion_per_object_index.set(a.index,!1);return this.pv.by_expression?[4,this._eval_expressions_for_objects(n)]:[3,2];case 1:o.sent(),o.label=2;case 2:for(this.pv.by_object_type&&this._eval_type_for_objects(n),this.pv.by_attrib&&""!==this.pv.attrib_name&&this._eval_attrib_for_objects(n),this.pv.invert&&this._marked_for_deletion_per_object_index.forEach((function(e,t){d._marked_for_deletion_per_object_index.set(t,!e)})),u=[],this._marked_for_deletion_per_object_index.forEach((function(e,r){s=n[r],_=s.object(),d.pv.hide_objects?(t.push(_),e&&(_.visible=!1)):(e||t.push(_),e&&u.push(d._point_object(s)))})),c=0,p=u;c<p.length;c++)l=p[c],t.push(l);return this.set_objects(t),[2]}}))}))},t.prototype._eval_for_points=function(e){return o.__awaiter(this,void 0,void 0,(function(){var t,n,r,i,a,s,_;return o.__generator(this,(function(o){switch(o.label){case 0:t=e.core_objects(),r=0,o.label=1;case 1:return r<t.length?(n=t[r],(i=n.core_geometry())?(a=i.points_from_geometry(),s=a.length,this.pv.by_expression?[4,this._eval_expressions_for_points(a)]:[3,3]):[3,4]):[3,5];case 2:a=o.sent(),o.label=3;case 3:this.pv.by_attrib&&""!==this.pv.attrib_name&&(a=this._eval_attrib_for_points(a)),this.pv.by_bbox&&(a=this._eval_bbox_for_points(a)),a.length!=s&&(_=n.object(),i.geometry().dispose(),a.length>0?_.geometry=p.CoreGeometry.geometry_from_points(a,_.constructor):null!=_.parent&&_.parent.remove(_)),o.label=4;case 4:return r++,[3,1];case 5:return this.set_core_group(e),[2]}}))}))},t.prototype._eval_expressions_for_points=function(e){return o.__awaiter(this,void 0,void 0,(function(){var t,n,r,i,a,s=this;return o.__generator(this,(function(o){switch(o.label){case 0:return t=[],n=this.p.expression,this.p.expression.has_expression()&&n.expression_controller?[4,n.expression_controller.compute_expression_for_points(e,(function(e,n){var r=!n;s.pv.invert&&(r=!r),r&&t.push(e)}))]:[3,2];case 1:return o.sent(),[3,3];case 2:for(r=this.pv.expression,i=!r,this.pv.invert&&(i=!i),a=0;a<e.length;a++)i&&t.push(e[a]);o.label=3;case 3:return console.log(t),[2,t]}}))}))},t.prototype._eval_expressions_for_objects=function(e){return o.__awaiter(this,void 0,void 0,(function(){var t,n,r,i,a=this;return o.__generator(this,(function(o){switch(o.label){case 0:return(t=this.p.expression).has_expression()&&t.expression_controller?[4,t.expression_controller.compute_expression_for_objects(e,(function(e,t){a._marked_for_deletion_per_object_index.get(e.index)||a._marked_for_deletion_per_object_index.set(e.index,t)}))]:[3,2];case 1:return o.sent(),[3,3];case 2:for(n=0,r=e;n<r.length;n++)i=r[n],this._marked_for_deletion_per_object_index.set(i.index,t.value);o.label=3;case 3:return[2]}}))}))},t.prototype._eval_attrib_for_points=function(e){var t=this,n=[];if(e.length>0){var r=e[0].attrib_value(this.pv.attrib_name);(a.default(r)?u.CoreString.attrib_names(this.pv.attrib_string):[this.pv.attrib_numeric.x]).forEach((function(r){return e.forEach((function(e){var o=e.attrib_value(t.pv.attrib_name),i=!t._comparison(o,r);if(t.pv.invert&&(i=!i),i)return n.push(e)}))}))}return n},t.prototype._comparison=function(e,t){switch(this.pv.attrib_ComparisonOperator){case r["=="]:return e===t;case r["<="]:return e<=t;case r["<"]:return e<t;case r[">"]:return e>t;case r[">="]:return e>=t;case r["!="]:return e!==t}},t.prototype._eval_type_for_objects=function(e){for(var t=c.ObjectTypes[this.pv.object_type],n=0,r=e;n<r.length;n++){var o=r[n];if(!this._marked_for_deletion_per_object_index.get(o.index))o.object().constructor.name===t&&this._marked_for_deletion_per_object_index.set(o.index,!0)}},t.prototype._eval_attrib_for_objects=function(e){for(var t=0,n=e;t<n.length;t++){var r=n[t];if(!this._marked_for_deletion_per_object_index.get(r.index)){var o=r.attrib_value(this.pv.attrib_name);o===(a.default(o)?this.pv.attrib_string:this.pv.attrib_float)&&this._marked_for_deletion_per_object_index.set(r.index,!0)}}},t.prototype._eval_bbox_for_points=function(e){var t=this,n=[];return s.default(e,(function(e,r){var o=t._bbox.containsPoint(e.position());if(t.pv.invert?o:!o)return n.push(e)})),n},Object.defineProperty(t.prototype,"_bbox",{get:function(){return null!=this._bbox_cache?this._bbox_cache:this._bbox_cache=new i.Box3(this.pv.bbox_center.clone().sub(this.pv.bbox_size.clone().multiplyScalar(.5)),this.pv.bbox_center.clone().add(this.pv.bbox_size.clone().multiplyScalar(.5)))},enumerable:!0,configurable:!0}),t.prototype._point_object=function(e){var t=e.points(),n=p.CoreGeometry.geometry_from_points(t,e.object().constructor);return this.create_object(n,c.ObjectType.POINTS)},t}(_.TypedSopNode);t.DeleteSopNode=m},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(1),i=n(4),a=r.__importDefault(n(87)),s=r.__importDefault(n(134)),_=r.__importDefault(n(334)),u=n(14),c=n(19),p=n(7),l=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.make_faces_unique=p.ParamConfig.BOOLEAN(0),t.add_face_center_attribute=p.ParamConfig.BOOLEAN(0,{visible_if:{make_faces_unique:1}}),t.add_face_id=p.ParamConfig.BOOLEAN(0,{visible_if:{make_faces_unique:1}}),t.transform=p.ParamConfig.BOOLEAN(0,{visible_if:{make_faces_unique:1}}),t.scale=p.ParamConfig.FLOAT(1,{visible_if:{make_faces_unique:1,transform:1}}),t}return r.__extends(t,e),t}(p.NodeParamsConfig)),d=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=l,t}return r.__extends(t,e),t.type=function(){return"face"},t.prototype.initialize_node=function(){this.io.inputs.set_count(1),this.io.inputs.init_inputs_clonable_state([c.InputCloneMode.FROM_NODE])},t.prototype.cook=function(e){var t=e[0];this.pv.make_faces_unique&&(this._make_faces_unique(t),this.pv.add_face_center_attribute&&this._add_face_center_attribute(t),this.pv.add_face_id&&this._add_face_id(t),this.pv.transform&&this._transform_faces(t)),this.set_core_group(t)},t.prototype._make_faces_unique=function(e){for(var t,n=0,r=e.objects();n<r.length;n++){var o=r[n];if(o.isMesh){for(var u=o.geometry,c=_.default((null===(t=u.index)||void 0===t?void 0:t.array)||[],3),p=3*c.length,l=function(e){var t=u.attributes[e],n=t.itemSize,r=new Float32Array(p*n),o=0;c.forEach((function(e){e.forEach((function(e){s.default(n,(function(i){var a=t.array[e*n+i];r[o]=a,o+=1}))}))})),u.setAttribute(e,new i.BufferAttribute(r,n))},d=0,h=Object.keys(u.attributes);d<h.length;d++){l(h[d])}var f=a.default(p);u.setIndex(f)}}},t.prototype._add_face_center_attribute=function(e){var t,n,r,i=new o.Vector3;e.core_objects().forEach((function(e){var o=e.object(),a=e.core_geometry();if(o.isMesh){t=a.faces(),a.has_attrib("face_center")||a.add_numeric_attrib("face_center",3,-1);for(var s=0;s<t.length;s++){(n=t[s]).center(i),r=n.points;for(var _=0;_<r.length;_++)r[_].set_attrib_value("face_center",i)}}}))},t.prototype._add_face_id=function(e){e.core_objects().forEach((function(e){var t=e.object(),n=e.core_geometry();if(t.isMesh){var r=n.faces();n.has_attrib("face_id")||n.add_numeric_attrib("face_id",1,-1);for(var o=0;o<r.length;o++)for(var i=r[o].points,a=0;a<i.length;a++){i[a].set_attrib_value("face_id",o)}}}))},t.prototype._transform_faces=function(e){var t,n,r,i,a=new o.Vector3,s=new o.Vector3,_=this.pv.scale;e.core_objects().forEach((function(e){var o=e.object(),u=e.core_geometry();if(o.isMesh){t=u.faces(),u.has_attrib("position")||u.add_numeric_attrib("position",3,-1);for(var c=0;c<t.length;c++){(n=t[c]).center(a),r=n.points;for(var p=0;p<r.length;p++){var l=(i=r[p]).position();s.x=l.x*_+a.x*(1-_),s.y=l.y*_+a.y*(1-_),s.z=l.z*_+a.z*(1-_),i.set_attrib_value("position",s)}}}}))},t}(u.TypedSopNode);t.FaceSopNode=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=r.__importDefault(n(77)),i=n(14),a=n(731),s=n(7),_=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.url=s.ParamConfig.STRING("",{desktop_browse:{file_type:"geometry"},always_reference_asset:!0}),t.reload=s.ParamConfig.BUTTON(null,{callback:function(e,t){u.PARAM_CALLBACK_reload(e)}}),t}return r.__extends(t,e),t}(s.NodeParamsConfig)),u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=_,t}return r.__extends(t,e),t.type=function(){return"file"},t.prototype.initialize_node=function(){},t.prototype.cook=function(){new a.CoreLoaderGeometry(this.pv.url).load(this._on_load.bind(this),this._on_error.bind(this))},t.prototype._on_load=function(e){console.log("objects",e),e=o.default(e),this.set_objects(e)},t.prototype._on_error=function(e){this.states.error.set("could not load geometry from "+this.pv.url+" ("+e+")")},t.PARAM_CALLBACK_reload=function(e){e.param_callback_reload()},t.prototype.param_callback_reload=function(){this.p.url.set_dirty()},t}(i.TypedSopNode);t.FileSopNode=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(374),i=n(10),a=r.__importDefault(n(342)),s=n(5),_=n(23),u=n(139),c=function(){function e(e){this.url=e;var t=this.url.split(".");this.ext=t[t.length-1].toLowerCase(),"zip"===this.ext&&(this.ext=t[t.length-2])}return e.prototype.load=function(e,t){this.load_auto().then((function(t){e(t)})).catch((function(e){t(e)}))},e.prototype.load_auto=function(){var e=this;return new Promise((function(t,n){return r.__awaiter(e,void 0,void 0,(function(){var e,i,s,_=this;return r.__generator(this,(function(r){switch(r.label){case 0:return e=this.url,"json"!=this.ext?[3,1]:(a.default.get(e).then((function(e){(new o.ObjectLoader).parse(e.data,(function(e){t(_.on_load_success(e.children[0]))}))})).catch((function(e){n(e)})),[3,3]);case 1:return[4,this.loader_for_ext()];case 2:(i=r.sent())?i.load(e,(function(e){console.log(e),_.on_load_success(e).then((function(e){t(e)}))}),void 0,(function(e){n(e)})):(s="format not supported ("+this.ext+")",n(s)),r.label=3;case 3:return[2]}}))}))}))},e.prototype.on_load_success=function(e){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(t){if(e instanceof i.Object3D)switch(this.ext){case"gltf":case"glb":return[2,this.on_load_succes_gltf(e)];case"obj":case"json":default:return[2,[e]]}if(e instanceof s.BufferGeometry)switch(this.ext){case"drc":return[2,this.on_load_succes_drc(e)];default:return[2,[new _.Mesh(e)]]}switch(this.ext){case"gltf":case"glb":return[2,this.on_load_succes_gltf(e)];default:return[2,[]]}return[2,[]]}))}))},e.prototype.on_load_succes_gltf=function(e){var t=e.scene;return t.animations=e.animations,console.log("[scene]",[t]),[t]},e.prototype.on_load_succes_drc=function(e){var t=new u.MeshLambertMaterial;return[new _.Mesh(e,t)]},e.prototype.loader_for_ext=function(){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(e){switch(this.ext.toLowerCase()){case"gltf":return[2,this.loader_for_gltf()];case"glb":return[2,this.loader_for_glb()];case"drc":return[2,this.loader_for_drc()];case"obj":return[2,this.loader_for_obj()]}return[2]}))}))},e.prototype.loader_for_gltf=function(){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(e){switch(e.label){case 0:return[4,Promise.resolve().then((function(){return r.__importStar(n(351))}))];case 1:return[2,new(0,e.sent().GLTFLoader)]}}))}))},e.prototype.loader_for_glb=function(){return r.__awaiter(this,void 0,void 0,(function(){var e,t,o,i;return r.__generator(this,(function(a){switch(a.label){case 0:return[4,Promise.resolve().then((function(){return r.__importStar(n(351))}))];case 1:return e=a.sent().GLTFLoader,[4,Promise.resolve().then((function(){return r.__importStar(n(352))}))];case 2:return t=a.sent().DRACOLoader,o=new e,i=new t,"/three/js/libs/draco/gltf/",i.setDecoderPath("/three/js/libs/draco/gltf/"),i.setDecoderConfig({type:"js"}),o.setDRACOLoader(i),[2,o]}}))}))},e.prototype.loader_for_drc=function(){return r.__awaiter(this,void 0,void 0,(function(){var e,t;return r.__generator(this,(function(o){switch(o.label){case 0:return[4,Promise.resolve().then((function(){return r.__importStar(n(352))}))];case 1:return e=o.sent().DRACOLoader,t=new e,"/three/js/libs/draco/",t.setDecoderPath("/three/js/libs/draco/"),t.setDecoderConfig({type:"js"}),[2,t]}}))}))},e.prototype.loader_for_obj=function(){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(e){switch(e.label){case 0:return[4,Promise.resolve().then((function(){return r.__importStar(n(732))}))];case 1:return[2,new(0,e.sent().OBJLoader)]}}))}))},e}();t.CoreLoaderGeometry=c},function(e,t,n){"use strict";n.r(t),n.d(t,"OBJLoader",(function(){return m}));var r=n(5),o=n(28),i=n(4),a=n(40),s=n(42),_=n(69),u=n(18),c=n(9),p=n(23),l=n(191),d=n(0),h=n(79),f=n(63),m=function(){var e=/^[og]\s*(.+)?/,t=/^mtllib /,n=/^usemtl /,m=/^usemap /;function y(){var e={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materialLibraries:[],startObject:function(e,t){if(this.object&&!1===this.object.fromDeclaration)return this.object.name=e,void(this.object.fromDeclaration=!1!==t);var n=this.object&&"function"==typeof this.object.currentMaterial?this.object.currentMaterial():void 0;if(this.object&&"function"==typeof this.object._finalize&&this.object._finalize(!0),this.object={name:e||"",fromDeclaration:!1!==t,geometry:{vertices:[],normals:[],colors:[],uvs:[]},materials:[],smooth:!0,startMaterial:function(e,t){var n=this._finalize(!1);n&&(n.inherited||n.groupCount<=0)&&this.materials.splice(n.index,1);var r={index:this.materials.length,name:e||"",mtllib:Array.isArray(t)&&t.length>0?t[t.length-1]:"",smooth:void 0!==n?n.smooth:this.smooth,groupStart:void 0!==n?n.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(e){var t={index:"number"==typeof e?e:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return t.clone=this.clone.bind(t),t}};return this.materials.push(r),r},currentMaterial:function(){if(this.materials.length>0)return this.materials[this.materials.length-1]},_finalize:function(e){var t=this.currentMaterial();if(t&&-1===t.groupEnd&&(t.groupEnd=this.geometry.vertices.length/3,t.groupCount=t.groupEnd-t.groupStart,t.inherited=!1),e&&this.materials.length>1)for(var n=this.materials.length-1;n>=0;n--)this.materials[n].groupCount<=0&&this.materials.splice(n,1);return e&&0===this.materials.length&&this.materials.push({name:"",smooth:this.smooth}),t}},n&&n.name&&"function"==typeof n.clone){var r=n.clone(0);r.inherited=!0,this.object.materials.push(r)}this.objects.push(this.object)},finalize:function(){this.object&&"function"==typeof this.object._finalize&&this.object._finalize(!0)},parseVertexIndex:function(e,t){var n=parseInt(e,10);return 3*(n>=0?n-1:n+t/3)},parseNormalIndex:function(e,t){var n=parseInt(e,10);return 3*(n>=0?n-1:n+t/3)},parseUVIndex:function(e,t){var n=parseInt(e,10);return 2*(n>=0?n-1:n+t/2)},addVertex:function(e,t,n){var r=this.vertices,o=this.object.geometry.vertices;o.push(r[e+0],r[e+1],r[e+2]),o.push(r[t+0],r[t+1],r[t+2]),o.push(r[n+0],r[n+1],r[n+2])},addVertexPoint:function(e){var t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addVertexLine:function(e){var t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addNormal:function(e,t,n){var r=this.normals,o=this.object.geometry.normals;o.push(r[e+0],r[e+1],r[e+2]),o.push(r[t+0],r[t+1],r[t+2]),o.push(r[n+0],r[n+1],r[n+2])},addColor:function(e,t,n){var r=this.colors,o=this.object.geometry.colors;o.push(r[e+0],r[e+1],r[e+2]),o.push(r[t+0],r[t+1],r[t+2]),o.push(r[n+0],r[n+1],r[n+2])},addUV:function(e,t,n){var r=this.uvs,o=this.object.geometry.uvs;o.push(r[e+0],r[e+1]),o.push(r[t+0],r[t+1]),o.push(r[n+0],r[n+1])},addUVLine:function(e){var t=this.uvs;this.object.geometry.uvs.push(t[e+0],t[e+1])},addFace:function(e,t,n,r,o,i,a,s,_){var u=this.vertices.length,c=this.parseVertexIndex(e,u),p=this.parseVertexIndex(t,u),l=this.parseVertexIndex(n,u);if(this.addVertex(c,p,l),this.colors.length>0&&this.addColor(c,p,l),void 0!==r&&""!==r){var d=this.uvs.length;c=this.parseUVIndex(r,d),p=this.parseUVIndex(o,d),l=this.parseUVIndex(i,d),this.addUV(c,p,l)}if(void 0!==a&&""!==a){var h=this.normals.length;c=this.parseNormalIndex(a,h),p=a===s?c:this.parseNormalIndex(s,h),l=a===_?c:this.parseNormalIndex(_,h),this.addNormal(c,p,l)}},addPointGeometry:function(e){this.object.geometry.type="Points";for(var t=this.vertices.length,n=0,r=e.length;n<r;n++)this.addVertexPoint(this.parseVertexIndex(e[n],t))},addLineGeometry:function(e,t){this.object.geometry.type="Line";for(var n=this.vertices.length,r=this.uvs.length,o=0,i=e.length;o<i;o++)this.addVertexLine(this.parseVertexIndex(e[o],n));var a=0;for(i=t.length;a<i;a++)this.addUVLine(this.parseUVIndex(t[a],r))}};return e.startObject("",!1),e}function v(e){u.a.call(this,e),this.materials=null}return v.prototype=Object.assign(Object.create(u.a.prototype),{constructor:v,load:function(e,t,n,r){var i=this,a=new o.a(i.manager);a.setPath(this.path),a.load(e,(function(e){t(i.parse(e))}),n,r)},setMaterials:function(e){return this.materials=e,this},parse:function(o){console.time("OBJLoader");var u=new y;-1!==o.indexOf("\r\n")&&(o=o.replace(/\r\n/g,"\n")),-1!==o.indexOf("\\\n")&&(o=o.replace(/\\\n/g,""));for(var v=o.split("\n"),g="",b="",P=[],O="function"==typeof"".trimLeft,C=0,E=v.length;C<E;C++)if(g=v[C],0!==(g=O?g.trimLeft():g.trim()).length&&"#"!==(b=g.charAt(0)))if("v"===b){var T=g.split(/\s+/);switch(T[0]){case"v":u.vertices.push(parseFloat(T[1]),parseFloat(T[2]),parseFloat(T[3])),T.length>=7&&u.colors.push(parseFloat(T[4]),parseFloat(T[5]),parseFloat(T[6]));break;case"vn":u.normals.push(parseFloat(T[1]),parseFloat(T[2]),parseFloat(T[3]));break;case"vt":u.uvs.push(parseFloat(T[1]),parseFloat(T[2]))}}else if("f"===b){for(var x=g.substr(1).trim().split(/\s+/),w=[],A=0,j=x.length;A<j;A++){var M=x[A];if(M.length>0){var N=M.split("/");w.push(N)}}var S=w[0];for(A=1,j=w.length-1;A<j;A++){var R=w[A],k=w[A+1];u.addFace(S[0],R[0],k[0],S[1],R[1],k[1],S[2],R[2],k[2])}}else if("l"===b){var L=g.substring(1).trim().split(" "),D=[],I=[];if(-1===g.indexOf("/"))D=L;else for(var B=0,G=L.length;B<G;B++){var z=L[B].split("/");""!==z[0]&&D.push(z[0]),""!==z[1]&&I.push(z[1])}u.addLineGeometry(D,I)}else if("p"===b){var F=g.substr(1).trim().split(" ");u.addPointGeometry(F)}else if(null!==(P=e.exec(g))){var V=(" "+P[0].substr(1).trim()).substr(1);u.startObject(V)}else if(n.test(g))u.object.startMaterial(g.substring(7).trim(),u.materialLibraries);else if(t.test(g))u.materialLibraries.push(g.substring(7).trim());else if(m.test(g))console.warn('THREE.OBJLoader: Rendering identifier "usemap" not supported. Textures must be defined in MTL files.');else if("s"===b){if((P=g.split(" ")).length>1){var U=P[1].trim().toLowerCase();u.object.smooth="0"!==U&&"off"!==U}else u.object.smooth=!0;(re=u.object.currentMaterial())&&(re.smooth=u.object.smooth)}else{if("\0"===g)continue;console.warn('THREE.OBJLoader: Unexpected line: "'+g+'"')}u.finalize();var q=new a.Group;q.materialLibraries=[].concat(u.materialLibraries);for(C=0,E=u.objects.length;C<E;C++){var Y=u.objects[C],H=Y.geometry,J=Y.materials,X="Line"===H.type,W="Points"===H.type,K=!1;if(0!==H.vertices.length){var Z=new r.BufferGeometry;Z.setAttribute("position",new i.Float32BufferAttribute(H.vertices,3)),H.normals.length>0?Z.setAttribute("normal",new i.Float32BufferAttribute(H.normals,3)):Z.computeVertexNormals(),H.colors.length>0&&(K=!0,Z.setAttribute("color",new i.Float32BufferAttribute(H.colors,3))),H.uvs.length>0&&Z.setAttribute("uv",new i.Float32BufferAttribute(H.uvs,2));for(var Q,$=[],ee=0,te=J.length;ee<te;ee++){var ne=J[ee],re=void 0;if(null!==this.materials)if(re=this.materials.create(ne.name),!X||!re||re instanceof s.LineBasicMaterial){if(W&&re&&!(re instanceof f.PointsMaterial)){var oe=new f.PointsMaterial({size:10,sizeAttenuation:!1});c.Material.prototype.copy.call(oe,re),oe.color.copy(re.color),oe.map=re.map,re=oe}}else{var ie=new s.LineBasicMaterial;c.Material.prototype.copy.call(ie,re),ie.color.copy(re.color),re=ie}re||((re=X?new s.LineBasicMaterial:W?new f.PointsMaterial({size:1,sizeAttenuation:!1}):new l.a).name=ne.name),re.flatShading=!ne.smooth,re.vertexColors=K?d.VertexColors:d.NoColors,$.push(re)}if($.length>1){for(ee=0,te=J.length;ee<te;ee++){ne=J[ee];Z.addGroup(ne.groupStart,ne.groupCount,ee)}Q=X?new _.LineSegments(Z,$):W?new h.Points(Z,$):new p.Mesh(Z,$)}else Q=X?new _.LineSegments(Z,$[0]):W?new h.Points(Z,$[0]):new p.Mesh(Z,$[0]);Q.name=Y.name,q.add(Q)}}return console.timeEnd("OBJLoader"),q}}),v}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(14),i=n(46),a=n(1),s=n(7),_=n(19),u=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.dist=s.ParamConfig.FLOAT(.1,{range:[0,1],range_locked:[!0,!1]}),t}return r.__extends(t,e),t}(s.NodeParamsConfig)),c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=u,t}return r.__extends(t,e),t.type=function(){return"fuse"},t.displayed_input_names=function(){return["points to fuse together"]},t.prototype.initialize_node=function(){this.io.inputs.set_count(1),this.io.inputs.init_inputs_clonable_state([_.InputCloneMode.FROM_NODE])},t.prototype.cook=function(e){for(var t,n=[],r=0,o=e[0].core_objects();r<o.length;r++){var i=o[r];(t=this._fuse_core_object(i))&&n.push(t)}this.set_objects(n)},t.prototype._fuse_core_object=function(e){var t=e.object();if(t){for(var n=e.points(),r=this.pv.dist,o={},s=0,_=n;s<_.length;s++){var u=_[s],c=u.position(),p=new a.Vector3(Math.round(c.x/r),Math.round(c.y/r),Math.round(c.z/r)).toArray().join("-");o[p]=o[p]||[],o[p].push(u)}var l=[];return Object.keys(o).forEach((function(e){l.push(o[e][0])})),t.geometry.dispose(),l.length>0?(t.geometry=i.CoreGeometry.geometry_from_points(l,t.constructor),t):void 0}},t}(o.TypedSopNode);t.FuseSopNode=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(1),i=n(14),a=n(68),s=n(27),_=n(735),u=new o.Vector3(0,1,0),c=n(7),p=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.size=c.ParamConfig.VECTOR2([1,1]),t.hexagon_radius=c.ParamConfig.FLOAT(.1),t.direction=c.ParamConfig.VECTOR3([0,1,0]),t.points_only=c.ParamConfig.BOOLEAN(0),t}return r.__extends(t,e),t}(c.NodeParamsConfig)),l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=p,t._core_transform=new a.CoreTransform,t}return r.__extends(t,e),t.type=function(){return"hexagons"},t.prototype.initialize_node=function(){},t.prototype.cook=function(){var e=new _.CoreGeometryOperationHexagon(this.pv.size,this.pv.hexagon_radius,this.pv.points_only).process();console.log(e,e.attributes.position),this._core_transform.rotate_geometry(e,u,this.pv.direction),this.pv.points_only?this.set_geometry(e,s.CoreConstant.OBJECT_TYPE.POINTS):this.set_geometry(e)},t}(i.TypedSopNode);t.HexagonsSopNode=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(3),i=n(5),a={BufferAttribute:n(4).BufferAttribute,BufferGeometry:i.BufferGeometry,Vector2:o.Vector2},s=r.__importDefault(n(77)),_=function(){function e(e,t,n){this._param_size=e,this._param_hexagon_radius=t,this._param_points_only=n}return e.prototype.process=function(){for(var e=this._param_hexagon_radius,t=.5*e,n=e,r=Math.cos(Math.PI/6)*this._param_hexagon_radius,o=Math.floor(this._param_size.x/n),i=Math.floor(this._param_size.y/r),_=[],u=[],c=0;c<i;c++)for(var p=0;p<o;p++)_.push([-.5*this._param_size.x+p*n+(c%2==0?t:0),0,-.5*this._param_size.y+c*r]),this._param_points_only||c>=1&&(0==p||p==o-1?0==p?u.push([p+1+(c-1)*o,p+(c-1)*o,p+c*o]):u.push([p+c*o,p+(c-1)*o,p-1+c*o]):(u.push([p+c*o,p+(c-1)*o,p-1+c*o]),u.push([p+c*o,p+1+(c-1)*o,p+(c-1)*o])));_=s.default(_);var l=new a.BufferGeometry;return l.setAttribute("position",new a.BufferAttribute(new Float32Array(_),3)),this._param_points_only||(u=s.default(u),l.setIndex(u),l.computeVertexNormals()),l},e}();t.CoreGeometryOperationHexagon=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,o=n(2),i=n(10),a={Group:n(40).Group,Object3D:i.Object3D},s=n(14);!function(e){e.ADD_PARENT="add_parent",e.REMOVE_PARENT="remove_parent"}(r=t.HierarchyMode||(t.HierarchyMode={})),t.HIERARCHY_MODES=[r.ADD_PARENT,r.REMOVE_PARENT];var _=n(7),u=new(function(e){function n(){var n=null!==e&&e.apply(this,arguments)||this;return n.mode=_.ParamConfig.INTEGER(0,{menu:{entries:t.HIERARCHY_MODES.map((function(e,t){return{name:e,value:t}}))}}),n.levels=_.ParamConfig.INTEGER(1,{range:[0,5]}),n}return o.__extends(n,e),n}(_.NodeParamsConfig)),c=function(e){function n(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=u,t}return o.__extends(n,e),n.type=function(){return"hierarchy"},n.displayed_input_names=function(){return["geometry to add or remove parents to/from"]},n.prototype.initialize_node=function(){this.io.inputs.set_count(1)},n.prototype.cook=function(e){var n=e[0];if(t.HIERARCHY_MODES[this.pv.mode]==r.ADD_PARENT){var o=this._add_parent_to_core_group(n);this.set_objects(o)}else{o=this._remove_parent_from_core_group(n);this.set_objects(o)}},n.prototype._add_parent_to_core_group=function(e){if(0==this.pv.levels)return e.objects();for(var t=[],n=void 0,r=0,o=e.objects();r<o.length;r++){var i=o[r];(n=this._add_parent_to_object(i))&&t.push(n)}return t},n.prototype._add_parent_to_object=function(e){var t=new a.Group;if(t.add(e),this.pv.levels>0)for(var n=0;n<this.pv.levels-1;n++)t=this._add_new_parent(t);return t},n.prototype._add_new_parent=function(e){var t=new a.Group;return t.add(e),t},n.prototype._remove_parent_from_core_group=function(e){if(0==this.pv.levels)return e.objects();for(var t=[],n=0,r=e.objects();n<r.length;n++)for(var o=r[n],i=0,a=this._remove_parent_from_object(o);i<a.length;i++){var s=a[i];t.push(s)}return t},n.prototype._remove_parent_from_object=function(e){for(var t=e.children,n=0;n<this.pv.levels-1;n++)t=this._get_children_from_objects(t);return t},n.prototype._get_children_from_objects=function(e){for(var t,n=[];t=e.pop();)if(t.children)for(var r=0,o=t.children;r<o.length;r++){var i=o[r];n.push(i)}return n},n}(s.TypedSopNode);t.HierarchySopNode=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o={Vector3:n(1).Vector3},i=n(114),a=n(14),s=n(7),_=n(19),u=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.amount=s.ParamConfig.FLOAT(1),t.seed=s.ParamConfig.INTEGER(1,{range:[0,100]}),t}return r.__extends(t,e),t}(s.NodeParamsConfig)),c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=u,t}return r.__extends(t,e),t.type=function(){return"jitter"},t.displayed_input_names=function(){return["geometry to jitter points of"]},t.prototype.initialize_node=function(){this.io.inputs.set_count(1),this.io.inputs.init_inputs_clonable_state([_.InputCloneMode.FROM_NODE])},t.prototype.cook=function(e){var t=this,n=e[0];n.points().forEach((function(e,n){var r=new o.Vector3(2*(i.CoreMath.rand(75*n+764+t.pv.seed)-.5),2*(i.CoreMath.rand(5678*n+3653+t.pv.seed)-.5),2*(i.CoreMath.rand(657*n+48464+t.pv.seed)-.5));r.normalize(),r.multiplyScalar(t.pv.amount);var a=e.position().clone().add(r);e.set_position(a)})),this.set_core_group(n)},t}(a.TypedSopNode);t.JitterSopNode=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(14),i=n(7),a=n(19),s=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.layer=i.ParamConfig.INTEGER(0,{range:[0,31],range_locked:[!0,!0]}),t}return r.__extends(t,e),t}(i.NodeParamsConfig)),_=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=s,t}return r.__extends(t,e),t.type=function(){return"layer"},t.displayed_input_names=function(){return["objects to change layers of"]},t.prototype.initialize_node=function(){this.io.inputs.set_count(1),this.io.inputs.init_inputs_clonable_state([a.InputCloneMode.FROM_NODE])},t.prototype.cook=function(e){for(var t=e[0],n=0,r=t.objects();n<r.length;n++){r[n].layers.set(this.pv.layer)}this.set_core_group(t)},t}(o.TypedSopNode);t.LayerSopNode=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(4),i=n(5),a=r.__importDefault(n(134)),s=n(14),_=n(27),u=n(7),c=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.length=u.ParamConfig.FLOAT(1,{range:[0,10]}),t.points_count=u.ParamConfig.INTEGER(1,{range:[2,100],range_locked:[!0,!1]}),t.origin=u.ParamConfig.VECTOR3([0,0,0]),t.direction=u.ParamConfig.VECTOR3([0,1,0]),t}return r.__extends(t,e),t}(u.NodeParamsConfig)),p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=c,t}return r.__extends(t,e),t.type=function(){return"line"},t.prototype.initialize_node=function(){},t.prototype.cook=function(){var e=this,t=Math.max(2,this.pv.points_count),n=new Array(3*t),r=new Array(t),s=this.pv.direction.clone().normalize().multiplyScalar(this.pv.length);a.default(t,(function(o){var i=o/(t-1),a=s.clone().multiplyScalar(i);a.add(e.pv.origin),a.toArray(n,3*o),o>0&&(r[2*(o-1)]=o-1,r[2*(o-1)+1]=o)}));var u=new i.BufferGeometry;u.setAttribute("position",new o.Float32BufferAttribute(n,3)),u.setIndex(r),this.set_geometry(u,_.CoreConstant.OBJECT_TYPE.LINE_SEGMENTS)},t}(s.TypedSopNode);t.LineSopNode=p},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(14),i=n(46),a=n(27),s="geometry to merge",_=n(7),u=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.compact=_.ParamConfig.BOOLEAN(1),t}return r.__extends(t,e),t}(_.NodeParamsConfig)),c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=u,t}return r.__extends(t,e),t.type=function(){return"merge"},t.displayed_input_names=function(){return[s,s,s,s]},t.prototype.initialize_node=function(){this.io.inputs.set_count(1,4),this.ui_data.set_width(100),this.ui_data.set_icon("compress-arrows-alt")},t.prototype.cook=function(e){for(var t=[],n=0,r=e;n<r.length;n++){var o=r[n];if(o)for(var i=0,a=o.objects();i<a.length;i++){a[i].traverse((function(e){t.push(e)}))}}this.pv.compact&&(t=this._make_compact(t)),this.set_objects(t)},t.prototype._make_compact=function(e){for(var t,n=((t={})[a.ObjectType.MESH]=[],t[a.ObjectType.POINTS]=[],t[a.ObjectType.LINE_SEGMENTS]=[],t),r=[],o=0,s=e;o<s.length;o++){(m=s[o]).traverse((function(e){var t=e;t.geometry&&(t.isMesh?n[a.ObjectType.MESH].push(t):t.isLineSegments?n[a.ObjectType.LINE_SEGMENTS].push(t):t.isPoints&&n[a.ObjectType.POINTS].push(t))}))}for(var _=0,u=Object.keys(n);_<u.length;_++){for(var c=u[_],p=[],l=0,d=n[c];l<d.length;l++){var h=(m=d[l]).geometry;h.applyMatrix(m.matrix),p.push(h)}var f=i.CoreGeometry.merge_geometries(p);if(f){var m=this.create_object(f,c);r.push(m)}}return r},t}(o.TypedSopNode);t.MergeSopNode=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,o=n(2),i=n(1),a=n(3),s=n(14),_=n(114),u=n(19),c=n(167),p=n(742);!function(e){e.ADD="add",e.SET="set",e.MULT="mult",e.SUBSTRACT="substract",e.DIVIDE="divide"}(r||(r={}));var l=[r.ADD,r.SET,r.MULT,r.SUBSTRACT,r.DIVIDE],d=n(7),h=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.amount=d.ParamConfig.FLOAT(1),t.freq=d.ParamConfig.VECTOR3([1,1,1]),t.offset=d.ParamConfig.VECTOR3([0,0,0]),t.octaves=d.ParamConfig.INTEGER(3,{range:[1,8],range_locked:[!0,!1]}),t.amp_attenuation=d.ParamConfig.FLOAT(.5,{range:[0,1]}),t.freq_increase=d.ParamConfig.FLOAT(2,{range:[0,10]}),t.seed=d.ParamConfig.INTEGER(0,{range:[0,100]}),t.separator=d.ParamConfig.SEPARATOR(),t.use_normals=d.ParamConfig.BOOLEAN(0),t.attrib_name=d.ParamConfig.STRING("position"),t.operation=d.ParamConfig.INTEGER(l.indexOf(r.ADD),{menu:{entries:l.map((function(e){return{name:e,value:l.indexOf(e)}}))}}),t.compute_normals=d.ParamConfig.BOOLEAN(1),t}return o.__extends(t,e),t}(d.NodeParamsConfig)),f=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=h,t._simplex_by_seed=new Map,t._rest_points=[],t}return o.__extends(t,e),t.type=function(){return"noise"},t.displayed_input_names=function(){return["geometry to add noise to","rest geometry"]},t.prototype.initialize_node=function(){this.io.inputs.set_count(1,2),this.io.inputs.init_inputs_clonable_state([u.InputCloneMode.FROM_NODE,u.InputCloneMode.NEVER])},t.prototype.cook=function(e){return o.__awaiter(this,void 0,void 0,(function(){var t,n,s,_,u,p,d,h,f,m,y,v=this;return o.__generator(this,(function(o){for(t=e[0],n=e[1],s=t.points(),n&&(null!=this._rest_core_group_timestamp&&this._rest_core_group_timestamp==n.timestamp()||(this._rest_points=n.points(),this._rest_core_group_timestamp=n.timestamp())),_=this._get_simplex(),u=this.pv.use_normals&&t.has_attrib("normal"),p=t.attrib_size(this.pv.attrib_name),d=function(e){var t=s[e],o=n?h._rest_points[e]:t,d=o.attrib_value(h.pv.attrib_name),f=o.position().add(h.pv.offset).multiply(h.pv.freq),m=function(){if(u){var e=o.attrib_value("normal"),t=v.pv.amount*v._fbm(_,f.x,f.y,f.z);return e.clone().multiplyScalar(t)}return new i.Vector3(v.pv.amount*v._fbm(_,f.x+545,f.y+125454,f.z+2142),v.pv.amount*v._fbm(_,f.x-425,f.y-25746,f.z+95242),v.pv.amount*v._fbm(_,f.x+765132,f.y+21,f.z-9245))}();m=function(){switch(p){case 1:return m.x;case 2:return new a.Vector2(m.x,m.y);case 3:return m}}();var y=function(){var e=l[v.pv.operation];switch(p){case 1:switch(e){case r.ADD:return d+m;case r.SET:return m;case r.MULT:return d*m;case r.DIVIDE:return d/m;case r.SUBSTRACT:return d-m}c.TypeAssert.unreachable(e);break;default:switch(e){case r.ADD:return d.add(m);case r.SET:return m;case r.MULT:return d.multiply(m);case r.DIVIDE:return d.divide(m);case r.SUBSTRACT:return d.sub(m)}c.TypeAssert.unreachable(e)}}();t.set_attrib_value(h.pv.attrib_name,y)},h=this,f=0;f<s.length;f++)d(f);if(!this.io.inputs.input_cloned(0))for(m=0,y=t.geometries();m<y.length;m++)y[m].getAttribute(this.pv.attrib_name).needsUpdate=!0;return this.pv.compute_normals&&t.compute_vertex_normals(),this.set_core_group(t),[2]}))}))},t.prototype._fbm=function(e,t,n,r){for(var o=0,i=1,a=0;a<this.pv.octaves;a++)o+=i*e.noise3d(t,n,r),t*=this.pv.freq_increase,n*=this.pv.freq_increase,r*=this.pv.freq_increase,i*=this.pv.amp_attenuation;return o},t.prototype._get_simplex=function(){var e=this._simplex_by_seed.get(this.pv.seed);if(e)return e;var t=this._create_simplex();return this._simplex_by_seed.set(this.pv.seed,t),t},t.prototype._create_simplex=function(){var e=this.pv.seed,t={random:function(){return _.CoreMath.rand_float(e)}},n=new p.SimplexNoise(t);return this._simplex_by_seed.delete(e),n},t}(s.TypedSopNode);t.NoiseSopNode=f},function(e,t,n){"use strict";n.r(t),n.d(t,"SimplexNoise",(function(){return r}));var r=function(e){null==e&&(e=Math),this.grad3=[[1,1,0],[-1,1,0],[1,-1,0],[-1,-1,0],[1,0,1],[-1,0,1],[1,0,-1],[-1,0,-1],[0,1,1],[0,-1,1],[0,1,-1],[0,-1,-1]],this.grad4=[[0,1,1,1],[0,1,1,-1],[0,1,-1,1],[0,1,-1,-1],[0,-1,1,1],[0,-1,1,-1],[0,-1,-1,1],[0,-1,-1,-1],[1,0,1,1],[1,0,1,-1],[1,0,-1,1],[1,0,-1,-1],[-1,0,1,1],[-1,0,1,-1],[-1,0,-1,1],[-1,0,-1,-1],[1,1,0,1],[1,1,0,-1],[1,-1,0,1],[1,-1,0,-1],[-1,1,0,1],[-1,1,0,-1],[-1,-1,0,1],[-1,-1,0,-1],[1,1,1,0],[1,1,-1,0],[1,-1,1,0],[1,-1,-1,0],[-1,1,1,0],[-1,1,-1,0],[-1,-1,1,0],[-1,-1,-1,0]],this.p=[];for(var t=0;t<256;t++)this.p[t]=Math.floor(256*e.random());this.perm=[];for(t=0;t<512;t++)this.perm[t]=this.p[255&t];this.simplex=[[0,1,2,3],[0,1,3,2],[0,0,0,0],[0,2,3,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,3,0],[0,2,1,3],[0,0,0,0],[0,3,1,2],[0,3,2,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,3,2,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,0,3],[0,0,0,0],[1,3,0,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,3,0,1],[2,3,1,0],[1,0,2,3],[1,0,3,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,3,1],[0,0,0,0],[2,1,3,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,1,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,0,1,2],[3,0,2,1],[0,0,0,0],[3,1,2,0],[2,1,0,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,1,0,2],[0,0,0,0],[3,2,0,1],[3,2,1,0]]};r.prototype.dot=function(e,t,n){return e[0]*t+e[1]*n},r.prototype.dot3=function(e,t,n,r){return e[0]*t+e[1]*n+e[2]*r},r.prototype.dot4=function(e,t,n,r,o){return e[0]*t+e[1]*n+e[2]*r+e[3]*o},r.prototype.noise=function(e,t){var n,r,o=(e+t)*(.5*(Math.sqrt(3)-1)),i=Math.floor(e+o),a=Math.floor(t+o),s=(3-Math.sqrt(3))/6,_=(i+a)*s,u=e-(i-_),c=t-(a-_);u>c?(n=1,r=0):(n=0,r=1);var p=u-n+s,l=c-r+s,d=u-1+2*s,h=c-1+2*s,f=255&i,m=255&a,y=this.perm[f+this.perm[m]]%12,v=this.perm[f+n+this.perm[m+r]]%12,g=this.perm[f+1+this.perm[m+1]]%12,b=.5-u*u-c*c,P=.5-p*p-l*l,O=.5-d*d-h*h;return 70*((b<0?0:(b*=b)*b*this.dot(this.grad3[y],u,c))+(P<0?0:(P*=P)*P*this.dot(this.grad3[v],p,l))+(O<0?0:(O*=O)*O*this.dot(this.grad3[g],d,h)))},r.prototype.noise3d=function(e,t,n){var r,o,i,a,s,_,u=(e+t+n)*(1/3),c=Math.floor(e+u),p=Math.floor(t+u),l=Math.floor(n+u),d=1/6,h=(c+p+l)*d,f=e-(c-h),m=t-(p-h),y=n-(l-h);f>=m?m>=y?(r=1,o=0,i=0,a=1,s=1,_=0):f>=y?(r=1,o=0,i=0,a=1,s=0,_=1):(r=0,o=0,i=1,a=1,s=0,_=1):m<y?(r=0,o=0,i=1,a=0,s=1,_=1):f<y?(r=0,o=1,i=0,a=0,s=1,_=1):(r=0,o=1,i=0,a=1,s=1,_=0);var v=f-r+d,g=m-o+d,b=y-i+d,P=f-a+2*d,O=m-s+2*d,C=y-_+2*d,E=f-1+.5,T=m-1+.5,x=y-1+.5,w=255&c,A=255&p,j=255&l,M=this.perm[w+this.perm[A+this.perm[j]]]%12,N=this.perm[w+r+this.perm[A+o+this.perm[j+i]]]%12,S=this.perm[w+a+this.perm[A+s+this.perm[j+_]]]%12,R=this.perm[w+1+this.perm[A+1+this.perm[j+1]]]%12,k=.6-f*f-m*m-y*y,L=.6-v*v-g*g-b*b,D=.6-P*P-O*O-C*C,I=.6-E*E-T*T-x*x;return 32*((k<0?0:(k*=k)*k*this.dot3(this.grad3[M],f,m,y))+(L<0?0:(L*=L)*L*this.dot3(this.grad3[N],v,g,b))+(D<0?0:(D*=D)*D*this.dot3(this.grad3[S],P,O,C))+(I<0?0:(I*=I)*I*this.dot3(this.grad3[R],E,T,x)))},r.prototype.noise4d=function(e,t,n,r){var o,i,a,s,_,u,c,p,l,d,h,f,m=this.grad4,y=this.simplex,v=this.perm,g=(Math.sqrt(5)-1)/4,b=(5-Math.sqrt(5))/20,P=(e+t+n+r)*g,O=Math.floor(e+P),C=Math.floor(t+P),E=Math.floor(n+P),T=Math.floor(r+P),x=(O+C+E+T)*b,w=e-(O-x),A=t-(C-x),j=n-(E-x),M=r-(T-x),N=(w>A?32:0)+(w>j?16:0)+(A>j?8:0)+(w>M?4:0)+(A>M?2:0)+(j>M?1:0),S=w-(o=y[N][0]>=3?1:0)+b,R=A-(i=y[N][1]>=3?1:0)+b,k=j-(a=y[N][2]>=3?1:0)+b,L=M-(s=y[N][3]>=3?1:0)+b,D=w-(_=y[N][0]>=2?1:0)+2*b,I=A-(u=y[N][1]>=2?1:0)+2*b,B=j-(c=y[N][2]>=2?1:0)+2*b,G=M-(p=y[N][3]>=2?1:0)+2*b,z=w-(l=y[N][0]>=1?1:0)+3*b,F=A-(d=y[N][1]>=1?1:0)+3*b,V=j-(h=y[N][2]>=1?1:0)+3*b,U=M-(f=y[N][3]>=1?1:0)+3*b,q=w-1+4*b,Y=A-1+4*b,H=j-1+4*b,J=M-1+4*b,X=255&O,W=255&C,K=255&E,Z=255&T,Q=v[X+v[W+v[K+v[Z]]]]%32,$=v[X+o+v[W+i+v[K+a+v[Z+s]]]]%32,ee=v[X+_+v[W+u+v[K+c+v[Z+p]]]]%32,te=v[X+l+v[W+d+v[K+h+v[Z+f]]]]%32,ne=v[X+1+v[W+1+v[K+1+v[Z+1]]]]%32,re=.6-w*w-A*A-j*j-M*M,oe=.6-S*S-R*R-k*k-L*L,ie=.6-D*D-I*I-B*B-G*G,ae=.6-z*z-F*F-V*V-U*U,se=.6-q*q-Y*Y-H*H-J*J;return 27*((re<0?0:(re*=re)*re*this.dot4(m[Q],w,A,j,M))+(oe<0?0:(oe*=oe)*oe*this.dot4(m[$],S,R,k,L))+(ie<0?0:(ie*=ie)*ie*this.dot4(m[ee],D,I,B,G))+(ae<0?0:(ae*=ae)*ae*this.dot4(m[te],z,F,V,U))+(se<0?0:(se*=se)*se*this.dot4(m[ne],q,Y,H,J)))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(14),i=n(19),a=n(7),s=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.edit=a.ParamConfig.BOOLEAN(0),t.update_x=a.ParamConfig.BOOLEAN(0,{visible_if:{edit:1}}),t.x=a.ParamConfig.FLOAT("@N.x",{visible_if:{update_x:1,edit:1},expression:{for_entities:!0}}),t.update_y=a.ParamConfig.BOOLEAN(0,{visible_if:{edit:1}}),t.y=a.ParamConfig.FLOAT("@N.y",{visible_if:{update_y:1,edit:1},expression:{for_entities:!0}}),t.update_z=a.ParamConfig.BOOLEAN(0,{visible_if:{edit:1}}),t.z=a.ParamConfig.FLOAT("@N.z",{visible_if:{update_z:1,edit:1},expression:{for_entities:!0}}),t.recompute=a.ParamConfig.BOOLEAN(0,{visible_if:{edit:0}}),t.invert=a.ParamConfig.BOOLEAN(0),t}return r.__extends(t,e),t}(a.NodeParamsConfig)),_=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=s,t}return r.__extends(t,e),t.type=function(){return"normals"},t.displayed_input_names=function(){return["geometry to update normals of"]},t.prototype.initialize_node=function(){this.io.inputs.set_count(1),this.io.inputs.init_inputs_clonable_state([i.InputCloneMode.FROM_NODE])},t.prototype.cook=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t;return r.__generator(this,(function(n){switch(n.label){case 0:return t=e[0],this.pv.edit?[4,this._eval_expressions_for_core_group(t)]:[3,2];case 1:return n.sent(),[3,3];case 2:t.compute_vertex_normals(),n.label=3;case 3:return this.pv.invert&&this._invert_normals(t),this.set_core_group(t),[2]}}))}))},t.prototype._eval_expressions_for_core_group=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,n;return r.__generator(this,(function(r){switch(r.label){case 0:t=e.core_objects(),n=0,r.label=1;case 1:return n<t.length?[4,this._eval_expressions_for_core_object(t[n])]:[3,4];case 2:r.sent(),r.label=3;case 3:return n++,[3,1];case 4:return[2]}}))}))},t.prototype._eval_expressions_for_core_object=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,n,o,i,a,s;return r.__generator(this,(function(r){switch(r.label){case 0:return t=e.object(),n=t.geometry,o=e.points(),i=n.getAttribute("normal").array,this.pv.update_x?this.p.x.has_expression()&&this.p.x.expression_controller?[4,this.p.x.expression_controller.compute_expression_for_points(o,(function(e,t){i[3*e.index+0]=t}))]:[3,2]:[3,3];case 1:return r.sent(),[3,3];case 2:for(a=void 0,s=0;s<o.length;s++)a=o[s],i[3*a.index+0]=this.pv.x;r.label=3;case 3:return this.pv.update_y?this.p.y.has_expression()&&this.p.y.expression_controller?[4,this.p.y.expression_controller.compute_expression_for_points(o,(function(e,t){i[3*e.index+1]=t}))]:[3,5]:[3,6];case 4:return r.sent(),[3,6];case 5:for(a=void 0,s=0;s<o.length;s++)a=o[s],i[3*a.index+1]=this.pv.y;r.label=6;case 6:return this.pv.update_z?this.p.z.has_expression()&&this.p.z.expression_controller?[4,this.p.z.expression_controller.compute_expression_for_points(o,(function(e,t){i[3*e.index+2]=t}))]:[3,8]:[3,9];case 7:return r.sent(),[3,9];case 8:for(a=void 0,s=0;s<o.length;s++)a=o[s],i[3*a.index+2]=this.pv.z;r.label=9;case 9:return[2]}}))}))},t.prototype._invert_normals=function(e){for(var t=0,n=e.core_objects();t<n.length;t++){var r=n[t].core_geometry().geometry().attributes.normal;if(r)for(var o=r.array,i=0;i<o.length;i++)o[i]*=-1}},t}(o.TypedSopNode);t.NormalsSopNode=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(14),i=n(7),a=n(19),s=new(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t}(i.NodeParamsConfig)),_=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=s,t}return r.__extends(t,e),t.type=function(){return"null"},t.prototype.initialize_node=function(){this.io.inputs.set_count(0,1),this.io.inputs.init_inputs_clonable_state([a.InputCloneMode.FROM_NODE]),this.ui_data.set_border_radius(1e3)},t.prototype.cook=function(e){var t=e[0];t?this.set_core_group(t):this.set_objects([])},t}(o.TypedSopNode);t.NullSopNode=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(14),i=n(31),a=n(7),s=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.geometry=a.ParamConfig.OPERATOR_PATH("",{node_selection:{context:i.NodeContext.SOP}}),t}return r.__extends(t,e),t}(a.NodeParamsConfig)),_=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=s,t}return r.__extends(t,e),t.type=function(){return"object_merge"},t.prototype.initialize_node=function(){},t.prototype.cook=function(e){return r.__awaiter(this,void 0,void 0,(function(){var e,t;return r.__generator(this,(function(n){switch(n.label){case 0:return(e=this.p.geometry.found_node())?e.node_context()!=i.NodeContext.SOP?[3,2]:[4,e.request_container()]:[3,4];case 1:return t=n.sent(),this.import_input(e,t),[3,3];case 2:this.states.error.set("found node is not a geometry"),n.label=3;case 3:return[3,5];case 4:this.states.error.set("node not found at path '"+this.pv.geometry+"'"),n.label=5;case 5:return[2]}}))}))},t.prototype.import_input=function(e,t){var n;null!=(n=t.core_content_cloned())?this.set_core_group(n):this.states.error.set("invalid target")},t}(o.TypedSopNode);t.ObjectMergeSopNode=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o={Float32BufferAttribute:n(4).Float32BufferAttribute},i=n(14),a=r.__importDefault(n(747)),s=n(19),_=n(7),u=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.attrib_name=_.ParamConfig.STRING("occlusion"),t.samples=_.ParamConfig.INTEGER(256,{range:[1,256],range_locked:[!0,!1]}),t.sep=_.ParamConfig.SEPARATOR(),t.buffer_resolution=_.ParamConfig.INTEGER(512),t.bias=_.ParamConfig.FLOAT(.01),t}return r.__extends(t,e),t}(_.NodeParamsConfig)),c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=u,t}return r.__extends(t,e),t.type=function(){return"occlusion"},t.prototype.initialize_node=function(){this.io.inputs.set_count(1),this.io.inputs.init_inputs_clonable_state([s.InputCloneMode.FROM_NODE]),this.ui_data.set_icon("palette")},t.prototype.cook=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,n,o,i,a;return r.__generator(this,(function(r){switch(r.label){case 0:t=e[0],n=t.core_objects(),o=0,i=n,r.label=1;case 1:return o<i.length?(a=i[o],[4,this._process_occlusion_on_object(a)]):[3,4];case 2:r.sent(),r.label=3;case 3:return o++,[3,1];case 4:return this.set_core_group(t),[2]}}))}))},t.prototype._process_occlusion_on_object=function(e){var t;return r.__awaiter(this,void 0,void 0,(function(){var n,i,s,_,u,c,p;return r.__generator(this,(function(r){for(n=e.core_geometry().geometry(),i=n.attributes.position.array,s=n.attributes.normal.array,_=null===(t=n.getIndex())||void 0===t?void 0:t.array,u=a.default(i,{cells:_,normals:s,resolution:this.pv.buffer_resolution,bias:this.pv.bias}),c=0;c<this.pv.samples;c++)u.sample();return p=u.report(),n.setAttribute(this.pv.attrib_name,new o.Float32BufferAttribute(p,1)),u.dispose(),[2]}))}))},t}(i.TypedSopNode);t.OcclusionSopNode=c},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(46),i=n(14),a=n(19),s=n(7),_=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.amount=s.ParamConfig.FLOAT(1,{range:[-1,1]}),t}return r.__extends(t,e),t}(s.NodeParamsConfig)),u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=_,t}return r.__extends(t,e),t.type=function(){return"peak"},t.prototype.initialize_node=function(){this.io.inputs.set_count(1),this.io.inputs.init_inputs_clonable_state([a.InputCloneMode.FROM_NODE])},t.prototype.cook=function(e){for(var t,n,r=this,i=e[0],a=0,s=i.objects();a<s.length;a++){s[a].traverse((function(e){var i;if(null!=(i=e.geometry)){for(var a=0,s=(t=new o.CoreGeometry(i)).points();a<s.length;a++){var _=(n=s[a]).normal(),u=n.position().clone().add(_.multiplyScalar(r.pv.amount));n.set_position(u)}if(!r.io.inputs.input_cloned(0))t.geometry().getAttribute("position").needsUpdate=!0}}))}this.set_core_group(i)},t}(i.TypedSopNode);t.PeakSopNode=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(1),i=n(3),a=n(56),s=n(14),_=n(68),u=n(19),c=new o.Vector3(0,0,1),p=new o.Vector3(0,0,1),l=new o.Vector3(0,1,0),d=n(7),h=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.size=d.ParamConfig.VECTOR2([1,1]),t.use_segments_count=d.ParamConfig.BOOLEAN(0),t.step_size=d.ParamConfig.FLOAT(1,{visible_if:{use_segments_count:0}}),t.segments=d.ParamConfig.VECTOR2([1,1],{visible_if:{use_segments_count:1}}),t.direction=d.ParamConfig.VECTOR3([0,1,0]),t.center=d.ParamConfig.VECTOR3([0,0,0]),t}return r.__extends(t,e),t}(d.NodeParamsConfig)),f=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=h,t._core_transform=new _.CoreTransform,t}return r.__extends(t,e),t.type=function(){return"plane"},t.displayed_input_names=function(){return["geometry to create plane from (optional)"]},t.prototype.initialize_node=function(){this.io.inputs.set_count(0,1),this.io.inputs.init_inputs_clonable_state([u.InputCloneMode.NEVER])},t.prototype.cook=function(e){var t=e[0];t?this._cook_with_input(t):this._cook_without_input()},t.prototype._cook_without_input=function(){var e=this._create_plane(this.pv.size);this._core_transform.rotate_geometry(e,c,this.pv.direction);var t=this._core_transform.translation_matrix(this.pv.center);e.applyMatrix(t),this.set_geometry(e)},t.prototype._cook_with_input=function(e){var t=e.bounding_box(),n=new o.Vector3;t.getSize(n);var r=new o.Vector3;t.getCenter(r);var a=new i.Vector2(n.x,n.z),s=this._create_plane(a);this._core_transform.rotate_geometry(s,p,l);var _=this._core_transform.translation_matrix(r);s.applyMatrix(_),this.set_geometry(s)},t.prototype._create_plane=function(e){var t;return e=e.clone(),this.pv.use_segments_count?t={x:Math.floor(this.pv.segments.x),y:Math.floor(this.pv.segments.y)}:(t={x:Math.floor(e.x/this.pv.step_size),y:Math.floor(e.y/this.pv.step_size)},e.x=t.x*this.pv.step_size,e.y=t.y*this.pv.step_size),new a.PlaneBufferGeometry(e.x,e.y,t.x,t.y)},t}(s.TypedSopNode);t.PlaneSopNode=f},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(14),i=n(19),a=n(7),s=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.update_x=a.ParamConfig.BOOLEAN(0),t.x=a.ParamConfig.FLOAT("@P.x",{visible_if:{update_x:1},expression:{for_entities:!0}}),t.update_y=a.ParamConfig.BOOLEAN(0),t.y=a.ParamConfig.FLOAT("@P.y",{visible_if:{update_y:1},expression:{for_entities:!0}}),t.update_z=a.ParamConfig.BOOLEAN(0),t.z=a.ParamConfig.FLOAT("@P.z",{visible_if:{update_z:1},expression:{for_entities:!0}}),t.update_normals=a.ParamConfig.BOOLEAN(1),t}return r.__extends(t,e),t}(a.NodeParamsConfig)),_=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=s,t._x_arrays_by_geometry_uuid=new Map,t._y_arrays_by_geometry_uuid=new Map,t._z_arrays_by_geometry_uuid=new Map,t}return r.__extends(t,e),t.type=function(){return"point"},t.displayed_input_names=function(){return["points to move"]},t.prototype.initialize_node=function(){this.io.inputs.set_count(1),this.io.inputs.init_inputs_clonable_state([i.InputCloneMode.FROM_NODE]),this.ui_data.set_icon("dot-circle")},t.prototype.cook=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t;return r.__generator(this,(function(n){switch(n.label){case 0:return t=e[0],[4,this._eval_expressions_for_core_group(t)];case 1:return n.sent(),[2]}}))}))},t.prototype._eval_expressions_for_core_group=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,n,o,i,a,s,_,u,c;return r.__generator(this,(function(r){switch(r.label){case 0:t=e.core_objects(),n=0,r.label=1;case 1:return n<t.length?[4,this._eval_expressions_for_core_object(t[n])]:[3,4];case 2:r.sent(),r.label=3;case 3:return n++,[3,1];case 4:for(this.pv.update_normals&&e.compute_vertex_normals(),o=e.geometries(),i=0,a=o;i<a.length;i++)(c=a[i]).computeBoundingBox();if(!this.io.inputs.input_cloned(0))for(s=e.geometries(),_=0,u=s;_<u.length;_++)c=u[_],c.getAttribute("position").needsUpdate=!0;return this.set_core_group(e),[2]}}))}))},t.prototype._eval_expressions_for_core_object=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,n,o,i,a,s,_;return r.__generator(this,(function(r){switch(r.label){case 0:return t=e.object(),n=t.geometry,o=e.points(),i=n.getAttribute("position").array,[4,this._update_from_param(n,i,o,this.p.update_x,this.p.x,this.pv.x,this._x_arrays_by_geometry_uuid,0)];case 1:return a=r.sent(),[4,this._update_from_param(n,i,o,this.p.update_y,this.p.y,this.pv.y,this._y_arrays_by_geometry_uuid,1)];case 2:return s=r.sent(),[4,this._update_from_param(n,i,o,this.p.update_z,this.p.z,this.pv.z,this._z_arrays_by_geometry_uuid,2)];case 3:return _=r.sent(),a&&this._commit_tmp_values(a,i,0),s&&this._commit_tmp_values(s,i,1),_&&this._commit_tmp_values(_,i,2),[2]}}))}))},t.prototype._update_from_param=function(e,t,n,o,i,a,s,_){return r.__awaiter(this,void 0,void 0,(function(){var t,u,c,p,l;return r.__generator(this,(function(r){switch(r.label){case 0:return t=o,u=i,c=this._init_array_if_required(e,s,n.length,_),t.value?u.has_expression()&&u.expression_controller?[4,u.expression_controller.compute_expression_for_points(n,(function(e,t){c[e.index]=t}))]:[3,2]:[3,3];case 1:return r.sent(),[3,3];case 2:for(p=void 0,l=0;l<n.length;l++)p=n[l],c[p.index]=a;r.label=3;case 3:return[2,c]}}))}))},t.prototype._init_array_if_required=function(e,t,n,r){var o=e.uuid,i=t.get(o);if(i){if(i.length<n){var a=this._array_for_component(e,n,r);return t.set(o,a),a}return i}a=this._array_for_component(e,n,r);return t.set(o,a),a},t.prototype._array_for_component=function(e,t,n){for(var r=new Array(t),o=e.getAttribute("position").array,i=0;i<r.length;i++)r[i]=o[3*i+n];return r},t.prototype._commit_tmp_values=function(e,t,n){for(var r=0;r<e.length;r++)t[3*r+n]=e[r]},t}(o.TypedSopNode);t.PointSopNode=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(14),i=n(46),a=n(68),s=n(340),_=n(244),u=n(372),c=n(1),p=n(69),l=n(5),d=n(19),h=new c.Vector3(0,0,0),f=new c.Vector3(1,1,1),m=n(7),y=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.radius=m.ParamConfig.FLOAT(1),t.segments_radial=m.ParamConfig.INTEGER(8,{range:[3,20],range_locked:[!0,!1]}),t.closed=m.ParamConfig.BOOLEAN(0),t}return r.__extends(t,e),t}(m.NodeParamsConfig)),v=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=y,t._core_transform=new a.CoreTransform,t._geometries=[],t}return r.__extends(t,e),t.type=function(){return"polywire"},t.displayed_input_names=function(){return["lines to create tubes from"]},t.prototype.initialize_node=function(){this.io.inputs.set_count(1),this.io.inputs.init_inputs_clonable_state([d.InputCloneMode.NEVER])},t.prototype.cook=function(e){var t=e[0];this._geometries=[];for(var n=0,r=t.objects();n<r.length;n++){(_=r[n])instanceof p.LineSegments&&this._create_tube(_)}for(var o=i.CoreGeometry.merge_geometries(this._geometries),a=0,s=this._geometries;a<s.length;a++){s[a].dispose()}if(o){var _=this.create_object(o);this.set_object(_)}else this.set_objects([])},t.prototype._create_tube=function(e){for(var t,n=e.geometry,r=new i.CoreGeometry(n).points(),o=null===(t=n.getIndex())||void 0===t?void 0:t.array,a=0,s=_.CoreGeometryUtilCurve.accumulated_curve_point_indices(o);a<s.length;a++){var u=s[a].map((function(e){return r[e]}));this._create_tube_from_points(u)}},t.prototype._create_tube_from_points=function(e){if(!(e.length<=1)){for(var t=e.map((function(e){return e.attrib_value("position")})),n=s.CoreGeometryUtilCircle.create(this.pv.radius,this.pv.segments_radial),r=[],o=0,i=t;o<i.length;o++){var a=i[o],_=this._core_transform.matrix(a,h,f,1),u=n.clone();u.applyMatrix(_),r.push(u)}for(var c=0;c<r.length;c++)if(c>0){var p=r[c],l=r[c-1],d=this._skin(l,p);this._geometries.push(d)}}},t.prototype._skin=function(e,t){var n=new l.BufferGeometry;return new u.CoreGeometryOperationSkin(n,e,t).process(),n},t}(o.TypedSopNode);t.PolywireSopNode=v},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(332),i=n(32),a=n(0),s=n(14),_=n(19),u=new i.MeshBasicMaterial({side:a.DoubleSide}),c=n(7),p=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.use_normals=c.ParamConfig.BOOLEAN(1),t.direction=c.ParamConfig.VECTOR3([0,-1,0],{visible_if:{use_normals:0}}),t.transfer_face_normals=c.ParamConfig.BOOLEAN(1),t}return r.__extends(t,e),t}(c.NodeParamsConfig)),l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=p,t._bound_assign_mat=t._assign_double_sided_material_to_object.bind(t),t._raycaster=new o.Raycaster,t}return r.__extends(t,e),t.type=function(){return"ray"},t.double_sided_material=function(){return u},t.displayed_input_names=function(){return["geometry to move","geometry to ray onto"]},t.prototype.initialize_node=function(){this.io.inputs.set_count(2),this.io.inputs.init_inputs_clonable_state([_.InputCloneMode.FROM_NODE,_.InputCloneMode.ALWAYS])},t.prototype.create_params=function(){},t.prototype.cook=function(e){var t=e[0],n=e[1];this.ray(t,n)},t.prototype.ray=function(e,t){var n,r;this._assign_double_sided_material_to_core_group(t);for(var o=0,i=e.points();o<i.length;o++){var a=i[o];n=this.pv.use_normals?a.normal():this.pv.direction,this._raycaster.set(a.position(),n),(r=this._raycaster.intersectObjects(t.objects(),!0)[0])&&(a.set_position(r.point),this.pv.transfer_face_normals&&r.face&&a.set_normal(r.face.normal))}this.set_core_group(e)},t.prototype._assign_double_sided_material_to_core_group=function(e){for(var t=0,n=e.objects();t<n.length;t++){n[t].traverse(this._bound_assign_mat)}},t.prototype._assign_double_sided_material_to_object=function(e){e.material=t.double_sided_material()},t}(s.TypedSopNode);t.RaySopNode=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,o,i=n(2),a=n(69),s=n(4),_=n(5),u=n(241),c=n(239),p=i.__importDefault(n(77)),l=i.__importDefault(n(286)),d=n(14),h=n(27),f=n(244),m=n(46);!function(e){e.POINTS_COUNT="points_count",e.SEGMENT_LENGTH="segment_length"}(r=t.METHOD||(t.METHOD={})),t.METHODS=[r.POINTS_COUNT,r.SEGMENT_LENGTH],function(e){e.CENTRIPETAL="centripetal",e.CHORDAL="chordal",e.CATMULLROM="catmullrom"}(o=t.CURVE_TYPE||(t.CURVE_TYPE={})),t.CURVE_TYPES=[o.CENTRIPETAL,o.CHORDAL,o.CATMULLROM];var y=n(7),v=n(167),g=new(function(e){function n(){var n=null!==e&&e.apply(this,arguments)||this;return n.method=y.ParamConfig.INTEGER(t.METHODS.indexOf(r.POINTS_COUNT),{menu:{entries:t.METHODS.map((function(e,t){return{name:e,value:t}}))}}),n.curve_type=y.ParamConfig.INTEGER(t.CURVE_TYPES.indexOf(o.CATMULLROM),{range:[0,2],range_locked:[!0,!0],menu:{entries:t.CURVE_TYPES.map((function(e,t){return{name:e,value:t}}))}}),n.tension=y.ParamConfig.FLOAT(.01,{range:[0,1],range_locked:[!0,!0]}),n.points_count=y.ParamConfig.INTEGER(100,{visible_if:{method:t.METHODS.indexOf(r.POINTS_COUNT)}}),n.segment_length=y.ParamConfig.FLOAT(1,{visible_if:{method:t.METHODS.indexOf(r.SEGMENT_LENGTH)}}),n}return i.__extends(n,e),n}(y.NodeParamsConfig)),b=function(e){function n(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=g,t}return i.__extends(n,e),n.type=function(){return"resample"},n.prototype.initialize_node=function(){this.io.inputs.set_count(1)},n.prototype.cook=function(e){var t=e[0],n=[];if(this.pv.points_count>=2)for(var r=t.core_objects(),o=0;o<r.length;o++){var i=r[o].object();if(i instanceof a.LineSegments){var s=this._resample(i);n.push(s)}}this.set_objects(n)},n.prototype._resample=function(e){for(var t,n=e.geometry,r=new m.CoreGeometry(n).points(),o=null===(t=n.getIndex())||void 0===t?void 0:t.array,i=f.CoreGeometryUtilCurve.accumulated_curve_point_indices(o),a=[],s=0;s<i.length;s++){var _=i[s].map((function(e){return r[e]})),u=this._create_curve_from_points(_);u&&a.push(u)}var p=c.BufferGeometryUtils.mergeBufferGeometries(a);return this.create_object(p,h.CoreConstant.OBJECT_TYPE.LINE_SEGMENTS)},n.prototype._create_curve_from_points=function(e){if(!(e.length<=1)){for(var n=l.default(e,(function(e){return e.attrib_value("position")})),r=t.CURVE_TYPES[this.pv.curve_type],o=this.pv.tension,i=new u.CatmullRomCurve3(n,!1,r,o),a=this._get_points_from_curve(i),c=[],d=[],h=0;h<a.length;h++){var f=a[h].toArray();c.push(f),h>0&&(d.push(h-1),d.push(h))}c=p.default(c);var m=new _.BufferGeometry;return m.setAttribute("position",new s.Float32BufferAttribute(c,3)),m.setIndex(d),m}},n.prototype._get_points_from_curve=function(e){var n=t.METHODS[this.pv.method];switch(n){case r.POINTS_COUNT:return e.getSpacedPoints(Math.max(2,this.pv.points_count));case r.SEGMENT_LENGTH:var o=e.getLength(),i=0!==this.pv.segment_length?1+o/this.pv.segment_length:2;return i=Math.max(2,i),e.getSpacedPoints(i)}v.TypeAssert.unreachable(n)},n}(d.TypedSopNode);t.ResampleSopNode=b},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(5),i={BufferAttribute:n(4).BufferAttribute,BufferGeometry:o.BufferGeometry},a=r.__importDefault(n(87)),s=r.__importDefault(n(39)),_=r.__importDefault(n(96)),u=n(14),c=n(27),p=n(114),l=n(339),d=n(7),h=n(19),f=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.points_count=d.ParamConfig.INTEGER(100,{range:[0,100],range_locked:[!0,!1]}),t.seed=d.ParamConfig.INTEGER(0,{range:[0,100],range_locked:[!1,!1]}),t.transfer_attributes=d.ParamConfig.BOOLEAN(0),t.attributes_to_transfer=d.ParamConfig.STRING("normal",{visible_if:{transfer_attributes:1}}),t.add_id_attribute=d.ParamConfig.BOOLEAN(1),t}return r.__extends(t,e),t}(d.NodeParamsConfig)),m=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=f,t}return r.__extends(t,e),t.type=function(){return"scatter"},t.displayed_input_names=function(){return["geometry to scatter points onto"]},t.prototype.initialize_node=function(){this.io.inputs.set_count(1),this.io.inputs.init_inputs_clonable_state([h.InputCloneMode.NEVER])},t.prototype.cook=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,n,o,u,d,h,f,m,y,v,g,b,P,O,C,E,T,x,w,A,j,M,N,S,R=this;return r.__generator(this,(function(r){switch(r.label){case 0:for(t=e[0],n=t.faces(),o=[],u=0,d=new Map,h=0,f=n;h<f.length;h++)P=f[h],m=P.area,d.set(P.index,m);for(y=_.default(n,(function(e){return d.get(e.index)})),v=0,g=0,b=y;g<b.length;g++)P=b[g],u+=d.get(P.index),o[v]=u,v++;for(O=[],C=[],this.pv.transfer_attributes&&(C=t.attrib_names_matching_mask(this.pv.attributes_to_transfer)),E=new Map,T=new Map,x=0,w=C;x<w.length;x++)N=w[x],E.set(N,[]),T.set(N,t.attrib_size(N));return[4,(new l.CoreIterator).start_with_count(this.pv.points_count,(function(e){for(var t=p.CoreMath.rand_float(R.pv.seed+e)*u,n=0;n<o.length;n++){if(t<=o[n]){var r=y[n],i=r.random_position(t);i.toArray(O,O.length);for(var a=0,_=C;a<_.length;a++){var c=_[a],l=r.attrib_value_at_position(c,i);s.default(l)?E.get(c).push(l):l.toArray(E.get(c),E.get(c).length)}break}}}))];case 1:for(r.sent(),(A=new i.BufferGeometry).setAttribute("position",new i.BufferAttribute(new Float32Array(O),3)),j=0,M=C;j<M.length;j++)N=M[j],A.setAttribute(N,new i.BufferAttribute(new Float32Array(E.get(N)),T.get(N)));return this.pv.add_id_attribute&&(S=a.default(this.pv.points_count),A.setAttribute("id",new i.BufferAttribute(new Float32Array(S),1))),this.set_geometry(A,c.CoreConstant.OBJECT_TYPE.POINTS),[2]}}))}))},t}(u.TypedSopNode);t.ScatterSopNode=m},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(14),i=n(19),a=n(7),s=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.cast_shadow=a.ParamConfig.BOOLEAN(1),t.receive_shadow=a.ParamConfig.BOOLEAN(1),t.apply_to_children=a.ParamConfig.BOOLEAN(0),t}return r.__extends(t,e),t}(a.NodeParamsConfig)),_=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=s,t}return r.__extends(t,e),t.type=function(){return"shadows"},t.displayed_input_names=function(){return["objects to change shadows properties of"]},t.prototype.initialize_node=function(){this.io.inputs.set_count(1),this.io.inputs.init_inputs_clonable_state([i.InputCloneMode.FROM_NODE])},t.prototype.cook=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,n,o,i,a=this;return r.__generator(this,(function(r){for(t=e[0],n=0,o=t.objects();n<o.length;n++)i=o[n],this.pv.apply_to_children?i.traverse((function(e){e.castShadow=a.pv.cast_shadow,e.receiveShadow=a.pv.receive_shadow})):(i.castShadow=this.pv.cast_shadow,i.receiveShadow=this.pv.receive_shadow);return console.log(t.objects()),this.set_core_group(t),[2]}))}))},t}(o.TypedSopNode);t.ShadowsSopNode=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(5),i=r.__importDefault(n(96)),a=r.__importDefault(n(848)),s=r.__importDefault(n(85)),_=n(14),u=n(244),c=n(372),p=new(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t}(n(7).NodeParamsConfig)),l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=p,t}return r.__extends(t,e),t.type=function(){return"skin"},t.displayed_input_names=function(){return["lines to create polygons from","if used, lines from both inputs will be used"]},t.prototype.initialize_node=function(){this.io.inputs.set_count(1,2)},t.prototype.cook=function(e){switch(s.default(this.io.inputs.inputs()).length){case 1:return this.process_one_input(e);case 2:return this.process_two_inputs(e);default:return this.states.error.set("inputs count not valid")}},t.prototype.process_one_input=function(e){var t=this,n=e[0],r=this._get_line_segments(n),o=[];if(r){var i=r[0];if(i){var a=u.CoreGeometryUtilCurve.line_segment_to_geometries(i.geometry);a.forEach((function(e,n){if(n>0){var r=a[n-1],i=t._skin(r,e);o.push(i)}}))}}this.set_geometries(o)},t.prototype.process_two_inputs=function(e){var t=this,n=e[0],r=e[1],o=this._get_line_segments(n),s=this._get_line_segments(r),_=a.default(i.default([o,s],(function(e){return e.length}))),u=_[0],c=_[1],p=[];u.forEach((function(e,n){var r=c[n];if(null!=e&&null!=r){var o=e.geometry,i=r.geometry,a=t._skin(o,i);p.push(a)}})),this.set_geometries(p)},t.prototype._get_line_segments=function(e){return e.objects().filter((function(e){return e.isLineSegments}))},t.prototype._skin=function(e,t){var n=new o.BufferGeometry;return new c.CoreGeometryOperationSkin(n,e,t).process(),n},t}(_.TypedSopNode);t.SkinSopNode=l},,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,o=n(2),i=n(179),a=n(175),s=n(14);!function(e){e.DEFAULT="default",e.ISOCAHEDRON="isocahedron"}(r||(r={}));var _={default:0,isocahedron:1},u=[r.DEFAULT,r.ISOCAHEDRON],c=n(7),p=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.type=c.ParamConfig.INTEGER(_.default,{menu:{entries:u.map((function(e){return{name:e,value:_[e]}}))}}),t.radius=c.ParamConfig.FLOAT(1,{visible_if:{type:_.default}}),t.resolution=c.ParamConfig.VECTOR2([8,6],{visible_if:{type:_.default}}),t.open=c.ParamConfig.BOOLEAN(0,{visible_if:{type:_.default}}),t.angle_range_x=c.ParamConfig.VECTOR2([0,"$PI*2"],{visible_if:{type:_.default,open:!0}}),t.angle_range_y=c.ParamConfig.VECTOR2([0,"$PI*2"],{visible_if:{type:_.default,open:!0}}),t.detail=c.ParamConfig.INTEGER(1,{range:[0,5],range_locked:[!0,!1],visible_if:{type:_.isocahedron}}),t.center=c.ParamConfig.VECTOR3([0,0,0]),t}return o.__extends(t,e),t}(c.NodeParamsConfig)),l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=p,t}return o.__extends(t,e),t.type=function(){return"sphere"},t.prototype.cook=function(){var e;(e=this.pv.type==_.default?this._create_default_sphere():this._create_default_isocahedron()).translate(this.pv.center.x,this.pv.center.y,this.pv.center.z),this.set_geometry(e)},t.prototype._create_default_sphere=function(){return this.pv.open?new i.SphereBufferGeometry(this.pv.radius,this.pv.resolution.x,this.pv.resolution.y,this.pv.angle_range_x.x,this.pv.angle_range_x.y,this.pv.angle_range_y.x,this.pv.angle_range_y.y):new i.SphereBufferGeometry(this.pv.radius,this.pv.resolution.x,this.pv.resolution.y)},t.prototype._create_default_isocahedron=function(){return new a.IcosahedronBufferGeometry(this.pv.radius,this.pv.detail)},t}(s.TypedSopNode);t.SphereSopNode=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(14),i="geometry to switch to",a=n(7),s=n(19),_=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.input=a.ParamConfig.INTEGER(0,{range:[0,3],range_locked:[!0,!0]}),t}return r.__extends(t,e),t}(a.NodeParamsConfig)),u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=_,t}return r.__extends(t,e),t.type=function(){return"switch"},t.displayed_input_names=function(){return[i,i,i,i]},t.prototype.initialize_node=function(){this.io.inputs.set_count(0,4),this.io.inputs.init_inputs_clonable_state([s.InputCloneMode.NEVER,s.InputCloneMode.NEVER,s.InputCloneMode.NEVER,s.InputCloneMode.NEVER]),this.ui_data.set_width(100),this.ui_data.set_icon("code-branch"),this.cook_controller.disallow_inputs_evaluation()},t.prototype.cook=function(){return r.__awaiter(this,void 0,void 0,(function(){var e;return r.__generator(this,(function(t){switch(t.label){case 0:return this.io.inputs.has_input(this.pv.input)?[4,this.container_controller.request_input_container(this.pv.input)]:[3,2];case 1:return e=t.sent(),this.set_core_group(e.core_content()),[3,3];case 2:this.states.error.set("no input "+this.pv.input),t.label=3;case 3:return[2]}}))}))},t}(o.TypedSopNode);t.SwitchSopNode=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,o=n(2),i=o.__importDefault(n(87)),a=n(14),s=n(27),_=n(178),u=n(5),c=n(180),p=n(864),l=n(4),d=n(239),h=n(860);!function(e){e.MESH="mesh",e.FLAT="flat",e.LINE="line",e.STROKE="stroke"}(r=t.TEXT_TYPE||(t.TEXT_TYPE={})),t.TEXT_TYPES=[r.MESH,r.FLAT,r.LINE,r.STROKE];var f=n(7),m=new(function(e){function n(){var n=null!==e&&e.apply(this,arguments)||this;return n.font=f.ParamConfig.STRING(""),n.text=f.ParamConfig.STRING("polygonjs",{multiline:!0}),n.type=f.ParamConfig.INTEGER(0,{menu:{entries:t.TEXT_TYPES.map((function(e,t){return{name:e,value:t}}))}}),n.size=f.ParamConfig.FLOAT(1,{range:[0,1],range_locked:[!0,!1]}),n.extrude=f.ParamConfig.FLOAT(.1,{visible_if:{type:t.TEXT_TYPES.indexOf(r.MESH)}}),n.segments=f.ParamConfig.INTEGER(1,{range:[1,20],range_locked:[!0,!1],visible_if:{type:t.TEXT_TYPES.indexOf(r.MESH)}}),n.stroke_width=f.ParamConfig.FLOAT(.02,{visible_if:{type:t.TEXT_TYPES.indexOf(r.STROKE)}}),n}return o.__extends(n,e),n}(f.NodeParamsConfig)),y=function(e){function a(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=m,t._font_loader=new p.FontLoader,t._loaded_fonts={},t}return o.__extends(a,e),a.type=function(){return"text"},a.prototype.initialize_node=function(){},a.prototype.cook=function(){return o.__awaiter(this,void 0,void 0,(function(){var e,n,i,a;return o.__generator(this,(function(o){switch(o.label){case 0:return o.trys.push([0,3,,4]),e=this._loaded_fonts,n=this.pv.font,(i=this._loaded_fonts[this.pv.font])?[3,2]:[4,this._load_url(this.pv.font)];case 1:i=o.sent(),o.label=2;case 2:return e[n]=i,[3,4];case 3:return o.sent(),this.states.error.set("count not load font ("+this.pv.font+")"),[2];case 4:if(a=this._loaded_fonts[this.pv.font])switch(t.TEXT_TYPES[this.pv.type]){case r.MESH:return[2,this._create_geometry_from_type_mesh(a)];case r.FLAT:return[2,this._create_geometry_from_type_flat(a)];case r.LINE:return[2,this._create_geometry_from_type_line(a)];case r.STROKE:return[2,this._create_geometry_from_type_stroke(a)];default:console.warn("type is not valid")}return[2]}}))}))},a.prototype._create_geometry_from_type_mesh=function(e){var t=this.displayed_text(),n={font:e,size:this.pv.size,height:this.pv.extrude,curveSegments:this.pv.segments};try{var r=new _.TextBufferGeometry(t,n);if(!r.index){var o=r.getAttribute("position").array;r.setIndex(i.default(o.length/3))}this.set_geometry(r)}catch(e){this.states.error.set("failed to generate geometry. Try to remove some characters")}},a.prototype._create_geometry_from_type_flat=function(e){var t=this._get_shapes(e);if(t){var n=new c.ShapeBufferGeometry(t);this.set_geometry(n)}},a.prototype._create_geometry_from_type_line=function(e){var t=this.shapes_from_font(e);if(t){for(var n=[],r=[],o=0,i=0;i<t.length;i++)for(var a=t[i].getPoints(),_=0;_<a.length;_++){var c=a[_];n.push(c.x),n.push(c.y),n.push(0),r.push(o),_>0&&_<a.length-1&&r.push(o),o+=1}var p=new u.BufferGeometry;p.setAttribute("position",new l.Float32BufferAttribute(n,3)),p.setIndex(r),this.set_geometry(p,s.CoreConstant.OBJECT_TYPE.LINE_SEGMENTS)}},a.prototype._create_geometry_from_type_stroke=function(e){return o.__awaiter(this,void 0,void 0,(function(){var t,n,r,i,a,s,_,u,c,p;return o.__generator(this,(function(o){switch(o.label){case 0:return(t=this.shapes_from_font(e))?(n=this,(r=this._svg_loader)?[3,2]:[4,this._load_svg_loader()]):[3,3];case 1:r=o.sent(),o.label=2;case 2:for(n._svg_loader=r,i=this._svg_loader.getStrokeStyle(this.pv.stroke_width,"white","miter","butt",4),a=[],s=0;s<t.length;s++)_=t[s],u=_.getPoints(),12,.001,c=this._svg_loader.pointsToStroke(u,i,12,.001),a.push(c);p=d.BufferGeometryUtils.mergeBufferGeometries(a),this.set_geometry(p),o.label=3;case 3:return[2]}}))}))},a.prototype.shapes_from_font=function(e){var t=this._get_shapes(e);if(t){for(var n=[],r=0;r<t.length;r++){var o=t[r];if(o.holes&&o.holes.length>0)for(var i=0;i<o.holes.length;i++){var a=o.holes[i];n.push(a)}}return t.push.apply(t,n),t}},a.prototype._get_shapes=function(e){var t=this.displayed_text();try{return e.generateShapes(t,this.pv.size)}catch(e){this.states.error.set("failed to generate geometry. Try to remove some characters")}},a.prototype.displayed_text=function(){return this.pv.text||""},a.prototype._load_url=function(e){""===e&&(e="/fonts/droid_sans_regular.typeface.json");var t=e.split("?")[0].split("."),n=t[t.length-1];switch(e=e+"?"+Date.now(),n){case"ttf":return this._load_ttf(e);case"json":return this._load_json(e);default:return null}},a.prototype._load_ttf=function(e){var t=this;return new Promise((function(n,r){return o.__awaiter(t,void 0,void 0,(function(){var t,i,a=this;return o.__generator(this,(function(o){switch(o.label){case 0:return t=this,(i=this._ttf_loader)?[3,2]:[4,this._load_ttf_loader()];case 1:i=o.sent(),o.label=2;case 2:return t._ttf_loader=i,window.opentype=h,this._ttf_loader.load(e,(function(e){var t=a._font_loader.parse(e);n(t)}),void 0,(function(){r()})),[2]}}))}))}))},a.prototype._load_json=function(e){var t=this;return new Promise((function(n,r){t._font_loader.load(e,(function(e){n(e)}),void 0,(function(){r()}))}))},a.prototype._load_ttf_loader=function(){return o.__awaiter(this,void 0,void 0,(function(){var e;return o.__generator(this,(function(t){switch(t.label){case 0:return[4,Promise.resolve().then((function(){return o.__importStar(n(853))}))];case 1:return e=t.sent().TTFLoader,[2,new e]}}))}))},a.prototype._load_svg_loader=function(){return o.__awaiter(this,void 0,void 0,(function(){return o.__generator(this,(function(e){switch(e.label){case 0:return[4,Promise.resolve().then((function(){return o.__importStar(n(854))}))];case 1:return[2,e.sent().SVGLoader]}}))}))},a}(a.TypedSopNode);t.TextSopNode=y},,function(e,t,n){"use strict";n.r(t),n.d(t,"TTFLoader",(function(){return i}));var r=n(28),o=n(18),i=function(e){o.a.call(this,e),this.reversed=!1};i.prototype=Object.assign(Object.create(o.a.prototype),{constructor:i,load:function(e,t,n,o){var i=this,a=new r.a(this.manager);a.setPath(this.path),a.setResponseType("arraybuffer"),a.load(e,(function(e){t(i.parse(e))}),n,o)},parse:function(e){function t(e){var t,n=[];e.forEach((function(e){"m"===e.type.toLowerCase()?(t=[e],n.push(t)):"z"!==e.type.toLowerCase()&&t.push(e)}));var r=[];return n.forEach((function(e){var t={type:"m",x:e[e.length-1].x,y:e[e.length-1].y};r.push(t);for(var n=e.length-1;n>0;n--){var o=e[n];t={type:o.type};void 0!==o.x2&&void 0!==o.y2?(t.x1=o.x2,t.y1=o.y2,t.x2=o.x1,t.y2=o.y1):void 0!==o.x1&&void 0!==o.y1&&(t.x1=o.x1,t.y1=o.y1),t.x=e[n-1].x,t.y=e[n-1].y,r.push(t)}})),r}return"undefined"==typeof opentype?(console.warn("THREE.TTFLoader: The loader requires opentype.js. Make sure it's included before using the loader."),null):function(e,n){for(var r=Math.round,o={},i=1e5/(72*(e.unitsPerEm||2048)),a=e.encoding.cmap.glyphIndexMap,s=Object.keys(a),_=0;_<s.length;_++){var u=s[_],c=e.glyphs.glyphs[a[u]];if(void 0!==u){var p={ha:r(c.advanceWidth*i),x_min:r(c.xMin*i),x_max:r(c.xMax*i),o:""};n&&(c.path.commands=t(c.path.commands)),c.path.commands.forEach((function(e){"c"===e.type.toLowerCase()&&(e.type="b"),p.o+=e.type.toLowerCase()+" ",void 0!==e.x&&void 0!==e.y&&(p.o+=r(e.x*i)+" "+r(e.y*i)+" "),void 0!==e.x1&&void 0!==e.y1&&(p.o+=r(e.x1*i)+" "+r(e.y1*i)+" "),void 0!==e.x2&&void 0!==e.y2&&(p.o+=r(e.x2*i)+" "+r(e.y2*i)+" ")})),o[String.fromCodePoint(c.unicode)]=p}}return{glyphs:o,familyName:e.getEnglishName("fullName"),ascender:r(e.ascender*i),descender:r(e.descender*i),underlinePosition:e.tables.post.underlinePosition,underlineThickness:e.tables.post.underlineThickness,boundingBox:{xMin:e.tables.head.xMin,xMax:e.tables.head.xMax,yMin:e.tables.head.yMin,yMax:e.tables.head.yMax},resolution:1e3,original_font_information:e.tables.name}}(opentype.parse(e),this.reversed)}})},,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(177),i=n(14),a=n(7),s=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.radius=a.ParamConfig.FLOAT(1,{range:[0,1]}),t.radius_tube=a.ParamConfig.FLOAT(1,{range:[0,1]}),t.segments_radial=a.ParamConfig.INTEGER(20,{range:[1,50],range_locked:[!0,!1]}),t.segments_tube=a.ParamConfig.INTEGER(12,{range:[1,50],range_locked:[!0,!1]}),t}return r.__extends(t,e),t}(a.NodeParamsConfig)),_=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=s,t}return r.__extends(t,e),t.type=function(){return"torus"},t.prototype.initialize_node=function(){},t.prototype.cook=function(){var e=this.pv.radius,t=this.pv.radius_tube,n=this.pv.segments_radial,r=this.pv.segments_tube,i=new o.TorusBufferGeometry(e,t,n,r);this.set_geometry(i)},t}(i.TypedSopNode);t.TorusSopNode=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o={TorusKnotBufferGeometry:n(176).TorusKnotBufferGeometry},i=n(14),a=n(7),s=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.radius=a.ParamConfig.FLOAT(1),t.radius_tube=a.ParamConfig.FLOAT(1),t.segments_radial=a.ParamConfig.INTEGER(64,{range:[1,128]}),t.segments_tube=a.ParamConfig.INTEGER(8,{range:[1,32]}),t.p=a.ParamConfig.INTEGER(2,{range:[1,10]}),t.q=a.ParamConfig.INTEGER(3,{range:[1,10]}),t}return r.__extends(t,e),t}(a.NodeParamsConfig)),_=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=s,t}return r.__extends(t,e),t.type=function(){return"torus_knot"},t.prototype.initialize_node=function(){},t.prototype.cook=function(){var e=this.pv.radius,t=this.pv.radius_tube,n=this.pv.segments_radial,r=this.pv.segments_tube,i=this.pv.p,a=this.pv.q,s=new o.TorusKnotBufferGeometry(e,t,n,r,i,a);this.set_geometry(s)},t}(i.TypedSopNode);t.TorusKnotSopNode=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(14),i=n(333),a=n(68),s=n(19),_=n(7),u=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.group=_.ParamConfig.STRING(""),t.t=_.ParamConfig.VECTOR3([0,0,0]),t.r=_.ParamConfig.VECTOR3([0,0,0]),t.s=_.ParamConfig.VECTOR3([1,1,1]),t.scale=_.ParamConfig.FLOAT(1),t.look_at=_.ParamConfig.OPERATOR_PATH(""),t.up=_.ParamConfig.VECTOR3([0,1,0]),t.pivot=_.ParamConfig.VECTOR3([0,0,0]),t}return r.__extends(t,e),t}(_.NodeParamsConfig)),c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=u,t._core_transform=new a.CoreTransform,t}return r.__extends(t,e),t.type=function(){return"transform"},t.displayed_input_names=function(){return["geometry to transform"]},t.prototype.initialize_node=function(){this.io.inputs.set_count(1),this.io.inputs.init_inputs_clonable_state([s.InputCloneMode.FROM_NODE])},t.prototype.cook=function(e){var t=e[0].objects(),n=this._core_transform.matrix(this.pv.t,this.pv.r,this.pv.s,this.pv.scale);if(""===this.pv.group)for(var r=0,o=t;r<o.length;r++){var a=o[r],s=void 0;null!=(s=a.geometry)?(s.translate(-this.pv.pivot.x,-this.pv.pivot.y,-this.pv.pivot.z),s.applyMatrix(n),s.translate(this.pv.pivot.x,this.pv.pivot.y,this.pv.pivot.z)):a.applyMatrix(n)}else for(var _=0,u=i.CoreGroup.from_objects(t).points_from_group(this.pv.group);_<u.length;_++){var c=u[_],p=c.position().sub(this.pv.pivot);p.applyMatrix4(n),c.set_position(p.add(this.pv.pivot))}this.set_objects(t)},t}(o.TypedSopNode);t.TransformSopNode=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(14),i=n(1),a=n(70),s=n(68),_=new i.Vector3(0,1,0),u=n(7),c=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.radius=u.ParamConfig.FLOAT(1,{range:[0,1]}),t.height=u.ParamConfig.FLOAT(1,{range:[0,1]}),t.segments_radial=u.ParamConfig.INTEGER(12,{range:[3,20],range_locked:[!0,!1]}),t.segments_height=u.ParamConfig.INTEGER(1,{range:[1,20],range_locked:[!0,!1]}),t.cap=u.ParamConfig.BOOLEAN(1),t.center=u.ParamConfig.VECTOR3([0,0,0]),t.direction=u.ParamConfig.VECTOR3([0,0,1]),t}return r.__extends(t,e),t}(u.NodeParamsConfig)),p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=c,t._core_transform=new s.CoreTransform,t}return r.__extends(t,e),t.type=function(){return"tube"},t.prototype.cook=function(){var e=new a.CylinderBufferGeometry(this.pv.radius,this.pv.radius,this.pv.height,this.pv.segments_radial,this.pv.segments_height,!this.pv.cap);this._core_transform.rotate_geometry(e,_,this.pv.direction),e.translate(this.pv.center.x,this.pv.center.y,this.pv.center.z),this.set_geometry(e)},t}(o.TypedSopNode);t.TubeSopNode=p},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(14),i=n(327),a=n(7),s=n(19),_=n(31),u=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.camera=a.ParamConfig.OPERATOR_PATH("/perspective_camera1",{node_selection:{context:_.NodeContext.OBJ}}),t}return r.__extends(t,e),t}(a.NodeParamsConfig)),c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params_config=u,t._camera_controller=new i.CameraController(t._update_uvs_from_camera.bind(t)),t}return r.__extends(t,e),t.type=function(){return"uv_project"},t.prototype.initialize_node=function(){this.io.inputs.set_count(1),this.io.inputs.init_inputs_clonable_state([s.InputCloneMode.FROM_NODE])},t.prototype.cook=function(e){this._processed_core_group=e[0];var t=this.p.camera.found_node();null!=t?(this._camera_object=t.object,this._camera_controller.set_target(this._camera_object)):(this._camera_object=void 0,this._camera_controller.remove_target()),this.set_core_group(this._processed_core_group)},t.prototype._update_uvs_from_camera=function(e){var t=this;if(this._processed_core_group&&this.parent){var n=this._processed_core_group.points(),r=this.parent.object.matrixWorld;n.forEach((function(e){var n=e.position(),o=t._vector_in_camera_space(n,r);if(o){var i={x:1-(.5*o[0]+.5),y:.5*o[1]+.5};e.set_attrib_value("uv",i)}}))}},t.prototype._vector_in_camera_space=function(e,t){if(this._camera_object)return e.applyMatrix4(t),e.project(this._camera_object).toArray()},t}(o.TypedSopNode);t.UvProjectSopNode=c},,,function(e,t,n){"use strict";n.r(t);var r=n(375),o=n(0),i=n(23),a=n(62),s=n(56),_=n(3),u=n(64),c={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float opacity;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","\tvec4 texel = texture2D( tDiffuse, vUv );","\tgl_FragColor = opacity * texel;","}"].join("\n")},p=n(34),l=n(24),d=n(58),h=function(e,t){d.a.call(this),this.textureID=void 0!==t?t:"tDiffuse",e instanceof p.ShaderMaterial?(this.uniforms=e.uniforms,this.material=e):e&&(this.uniforms=l.UniformsUtils.clone(e.uniforms),this.material=new p.ShaderMaterial({defines:Object.assign({},e.defines),uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),this.fsQuad=new d.a.FullScreenQuad(this.material)};h.prototype=Object.assign(Object.create(d.a.prototype),{constructor:h,render:function(e,t,n){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=n.texture),this.fsQuad.material=this.material,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),this.fsQuad.render(e))}});var f=function(e,t){d.a.call(this),this.scene=e,this.camera=t,this.clear=!0,this.needsSwap=!1,this.inverse=!1};f.prototype=Object.assign(Object.create(d.a.prototype),{constructor:f,render:function(e,t,n){var r,o,i=e.getContext(),a=e.state;a.buffers.color.setMask(!1),a.buffers.depth.setMask(!1),a.buffers.color.setLocked(!0),a.buffers.depth.setLocked(!0),this.inverse?(r=0,o=1):(r=1,o=0),a.buffers.stencil.setTest(!0),a.buffers.stencil.setOp(i.REPLACE,i.REPLACE,i.REPLACE),a.buffers.stencil.setFunc(i.ALWAYS,r,4294967295),a.buffers.stencil.setClear(o),a.buffers.stencil.setLocked(!0),e.setRenderTarget(n),this.clear&&e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(t),this.clear&&e.clear(),e.render(this.scene,this.camera),a.buffers.color.setLocked(!1),a.buffers.depth.setLocked(!1),a.buffers.stencil.setLocked(!1),a.buffers.stencil.setFunc(i.EQUAL,1,4294967295),a.buffers.stencil.setOp(i.KEEP,i.KEEP,i.KEEP),a.buffers.stencil.setLocked(!0)}});var m=function(){d.a.call(this),this.needsSwap=!1};m.prototype=Object.create(d.a.prototype),Object.assign(m.prototype,{render:function(e){e.state.buffers.stencil.setLocked(!1),e.state.buffers.stencil.setTest(!1)}}),n.d(t,"EffectComposer",(function(){return y})),n.d(t,"Pass",(function(){return P}));var y=function(e,t){if(this.renderer=e,void 0===t){var n={minFilter:o.LinearFilter,magFilter:o.LinearFilter,format:o.RGBAFormat,stencilBuffer:!1},i=e.getSize(new _.Vector2);this._pixelRatio=e.getPixelRatio(),this._width=i.width,this._height=i.height,(t=new u.WebGLRenderTarget(this._width*this._pixelRatio,this._height*this._pixelRatio,n)).texture.name="EffectComposer.rt1"}else this._pixelRatio=1,this._width=t.width,this._height=t.height;this.renderTarget1=t,this.renderTarget2=t.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],void 0===c&&console.error("THREE.EffectComposer relies on CopyShader"),void 0===h&&console.error("THREE.EffectComposer relies on ShaderPass"),this.copyPass=new h(c),this.clock=new r.a};Object.assign(y.prototype,{swapBuffers:function(){var e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e},addPass:function(e){this.passes.push(e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)},insertPass:function(e,t){this.passes.splice(t,0,e)},isLastEnabledPass:function(e){for(var t=e+1;t<this.passes.length;t++)if(this.passes[t].enabled)return!1;return!0},render:function(e){void 0===e&&(e=this.clock.getDelta());var t,n,r=this.renderer.getRenderTarget(),o=!1,i=this.passes.length;for(n=0;n<i;n++)if(!1!==(t=this.passes[n]).enabled){if(t.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(n),t.render(this.renderer,this.writeBuffer,this.readBuffer,e,o),t.needsSwap){if(o){var a=this.renderer.getContext(),s=this.renderer.state.buffers.stencil;s.setFunc(a.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,e),s.setFunc(a.EQUAL,1,4294967295)}this.swapBuffers()}void 0!==f&&(t instanceof f?o=!0:t instanceof m&&(o=!1))}this.renderer.setRenderTarget(r)},reset:function(e){if(void 0===e){var t=this.renderer.getSize(new _.Vector2);this._pixelRatio=this.renderer.getPixelRatio(),this._width=t.width,this._height=t.height,(e=this.renderTarget1.clone()).setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2},setSize:function(e,t){this._width=e,this._height=t;var n=this._width*this._pixelRatio,r=this._height*this._pixelRatio;this.renderTarget1.setSize(n,r),this.renderTarget2.setSize(n,r);for(var o=0;o<this.passes.length;o++)this.passes[o].setSize(n,r)},setPixelRatio:function(e){this._pixelRatio=e,this.setSize(this._width,this._height)}});var v,g,b,P=function(){this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1};Object.assign(P.prototype,{setSize:function(){},render:function(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}}),P.FullScreenQuad=(v=new a.OrthographicCamera(-1,1,1,-1,0,1),g=new s.PlaneBufferGeometry(2,2),b=function(e){this._mesh=new i.Mesh(g,e)},Object.defineProperty(b.prototype,"material",{get:function(){return this._mesh.material},set:function(e){this._mesh.material=e}}),Object.assign(b.prototype,{dispose:function(){this._mesh.geometry.dispose()},render:function(e){e.render(this._mesh,v)}}),b)}]);