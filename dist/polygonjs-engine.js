/*! For license information please see polygonjs-engine.js.LICENSE.txt */
window["polygonjs-engine"]=function(e){function t(t){for(var s,i,a=t[0],_=t[1],c=t[2],u=0,d=[];u<a.length;u++)i=a[u],Object.prototype.hasOwnProperty.call(r,i)&&r[i]&&d.push(r[i][0]),r[i]=0;for(s in _)Object.prototype.hasOwnProperty.call(_,s)&&(e[s]=_[s]);for(l&&l(t);d.length;)d.shift()();return o.push.apply(o,c||[]),n()}function n(){for(var e,t=0;t<o.length;t++){for(var n=o[t],s=!0,a=1;a<n.length;a++){var _=n[a];0!==r[_]&&(s=!1)}s&&(o.splice(t--,1),e=i(i.s=n[0]))}return e}var s={},r={6:0},o=[];function i(t){if(s[t])return s[t].exports;var n=s[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=e,i.c=s,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)i.d(n,s,function(t){return e[t]}.bind(null,s));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="";var a=window.webpackJsonppolygonjs_engine=window.webpackJsonppolygonjs_engine||[],_=a.push.bind(a);a.push=t,a=a.slice();for(var c=0;c<a.length;c++)t(a[c]);var l=_;return o.push([413,8,0,5,7,3,1,2,4,9]),n()}([,,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(24),r=n(155);class o{constructor(e,t,n){this.type=e,this.init_value=t,this.options=n}}t.ParamTemplate=o;t.ParamConfig=class{static BUTTON(e,t){return new o(s.ParamType.BUTTON,e,t)}static BOOLEAN(e,t){return new o(s.ParamType.BOOLEAN,e,t)}static COLOR(e,t){return new o(s.ParamType.COLOR,e,t)}static FLOAT(e,t){return new o(s.ParamType.FLOAT,e,t)}static FOLDER(e=null,t){return new o(s.ParamType.FOLDER,e,t)}static INTEGER(e,t){return new o(s.ParamType.INTEGER,e,t)}static OPERATOR_PATH(e,t){return new o(s.ParamType.OPERATOR_PATH,e,t)}static RAMP(e=r.RampParam.DEFAULT_VALUE,t){return new o(s.ParamType.RAMP,e,t)}static SEPARATOR(e=null,t){return new o(s.ParamType.SEPARATOR,e,t)}static STRING(e="",t){return new o(s.ParamType.STRING,e,t)}static VECTOR2(e,t){return new o(s.ParamType.VECTOR2,e,t)}static VECTOR3(e,t){return new o(s.ParamType.VECTOR3,e,t)}static VECTOR4(e,t){return new o(s.ParamType.VECTOR4,e,t)}};t.NodeParamsConfig=class{}},,,,,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),r=s.__importDefault(n(82)),o=s.__importDefault(n(208)),i=n(81),a=n(35),_=n(377),c=n(161),l=n(826),u=n(113),d=n(27),h=n(94);var p;!function(e){e.FROM_SET_CORE_GROUP="from set_core_group",e.FROM_SET_GROUP="from set_group",e.FROM_SET_OBJECTS="from set_objects",e.FROM_SET_OBJECT="from set_object",e.FROM_SET_GEOMETRIES="from set_geometries",e.FROM_SET_GEOMETRY="from set_geometry"}(p||(p={}));const m=["input geometry","input geometry","input geometry","input geometry"];class f extends i.TypedNode{constructor(){super(...arguments),this.container_controller=new u.TypedContainerController(this,l.GeometryContainer),this.flags=new h.FlagsControllerDB(this)}static node_context(){return d.NodeContext.SOP}static displayed_input_names(){return m}initialize_base_node(){this.flags.display&&(this.flags.display.set(!1),this.flags.display.add_hook(()=>{if(this.flags.display.active){const e=this.parent;e&&e.display_node_controller&&e.display_node_controller.set_display_node(this)}})),this.io.outputs.set_has_one_output()}set_core_group(e){const t=e.objects();for(let e of t)this._set_object_attributes(e);this.set_container(e,p.FROM_SET_CORE_GROUP)}set_object(e){this._set_object_attributes(e),this.set_container_objects([e],p.FROM_SET_OBJECT)}set_objects(e){for(let t of e)this._set_object_attributes(t);this.set_container_objects(e,p.FROM_SET_OBJECTS)}set_geometry(e,t){const n=this.create_object(e,t);this.set_container_objects([n],p.FROM_SET_GEOMETRY)}set_geometries(e,t){const n=[];let s;e.forEach(e=>{s=this.create_object(e,t),this._set_object_attributes(s),n.push(s)}),this.set_container_objects(n,p.FROM_SET_GEOMETRIES)}set_container_objects(e,t){const n=this.container_controller.container.core_content()||new _.CoreGroup;n.set_objects(e),n.touch(),this.set_container(n)}create_object(e,t){if(!e.index){const t=e.getAttribute("position").array;e.setIndex(r.default(t.length/3))}null==t&&(t=a.CoreConstant.OBJECT_TYPE.MESH);const n=new(0,a.CoreConstant.CONSTRUCTORS_BY_NAME[t])(e,a.CoreConstant.MATERIALS[t].clone());return n.castShadow=!0,n.receiveShadow=!0,n.frustumCulled=!1,n}_set_object_attributes(e){const t=e.material;if(t){if(!this.scene)throw console.log("no scene"),"no scene";const n=c.CoreMaterial.node(this.scene,t);n&&n.add_render_hook(e)}}_add_index(e){const t=e.getAttribute("position").array.length/3,n=[];o.default(t,e=>n.push(e)),e.setIndex(n)}}t.TypedSopNode=f;t.BaseSopNodeClass=class extends f{}},,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(24),r=n(155);var o;!function(e){e.BOOL="bool",e.INT="int",e.FLOAT="float",e.VEC2="vec2",e.VEC3="vec3",e.VEC4="vec4",e.SAMPLER_2D="sampler2D"}(o=t.ConnectionPointType||(t.ConnectionPointType={})),t.ConnectionPointTypes=[o.BOOL,o.INT,o.FLOAT,o.VEC2,o.VEC3,o.VEC4],t.ConnectionPointTypeToParamTypeMap={[o.BOOL]:s.ParamType.BOOLEAN,[o.INT]:s.ParamType.INTEGER,[o.FLOAT]:s.ParamType.FLOAT,[o.VEC2]:s.ParamType.VECTOR2,[o.VEC3]:s.ParamType.VECTOR3,[o.VEC4]:s.ParamType.VECTOR4,[o.SAMPLER_2D]:s.ParamType.RAMP},t.ParamTypeToConnectionPointTypeMap={[s.ParamType.BOOLEAN]:o.BOOL,[s.ParamType.COLOR]:o.VEC3,[s.ParamType.INTEGER]:o.INT,[s.ParamType.FLOAT]:o.FLOAT,[s.ParamType.FOLDER]:void 0,[s.ParamType.VECTOR2]:o.VEC2,[s.ParamType.VECTOR3]:o.VEC3,[s.ParamType.VECTOR4]:o.VEC4,[s.ParamType.BUTTON]:void 0,[s.ParamType.OPERATOR_PATH]:void 0,[s.ParamType.RAMP]:void 0,[s.ParamType.SEPARATOR]:void 0,[s.ParamType.STRING]:void 0},t.ConnectionPointInitValueMap={[o.BOOL]:!1,[o.INT]:0,[o.FLOAT]:0,[o.VEC2]:[0,0],[o.VEC3]:[0,0,0],[o.VEC4]:[0,0,0,0],[o.SAMPLER_2D]:r.RampParam.DEFAULT_VALUE_JSON},t.ConnectionPointComponentsCountMap={[o.BOOL]:1,[o.INT]:1,[o.FLOAT]:1,[o.VEC2]:2,[o.VEC3]:3,[o.VEC4]:4,[o.SAMPLER_2D]:1}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.ALWAYS="always",e.NEVER="never",e.FROM_NODE="from_node"}(t.InputCloneMode||(t.InputCloneMode={}))},,,,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.BOOLEAN="boolean",e.BUTTON="button",e.COLOR="color",e.FLOAT="float",e.FOLDER="folder",e.INTEGER="integer",e.OPERATOR_PATH="operator_path",e.RAMP="ramp",e.SEPARATOR="separator",e.STRING="string",e.VECTOR2="vector2",e.VECTOR3="vector3",e.VECTOR4="vector4"}(t.ParamType||(t.ParamType={}))},,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.COP="cop",e.EVENT="event",e.GL="gl",e.JS="js",e.MANAGER="managers",e.MAT="mat",e.OBJ="objects",e.SOP="sop",e.POST="post"}(t.NodeContext||(t.NodeContext={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),r=n(49),o=s.__importDefault(n(44)),i=s.__importDefault(n(346)),a=s.__importDefault(n(48));t.ThreeToGl=class{static any(e){if(a.default(e))return e;if(i.default(e))return`${e}`;if(o.default(e))return`${r.CoreString.ensure_float(e)}`;{const t=e.toArray().map(e=>`${r.CoreString.ensure_float(e)}`);return`${`vec${t.length}`}(${t.join(", ")})`}}static vector3(e){if(a.default(e))return e;return`vec3(${e.toArray().map(e=>`${r.CoreString.ensure_float(e)}`).join(", ")})`}static vector2(e){if(a.default(e))return e;return`vec2(${e.toArray().map(e=>`${r.CoreString.ensure_float(e)}`).join(", ")})`}static vector3_float(e,t){return a.default(t)||(t=r.CoreString.ensure_float(t)),`vec4(${this.vector3(e)}, ${t})`}static float4(e,t,n,s){return a.default(e)||(e=r.CoreString.ensure_float(e)),a.default(t)||(t=r.CoreString.ensure_float(t)),a.default(n)||(n=r.CoreString.ensure_float(n)),a.default(s)||(s=r.CoreString.ensure_float(s)),`vec4(${e}, ${t}, ${n}, ${s})`}static float3(e,t,n){return a.default(e)||(e=r.CoreString.ensure_float(e)),a.default(t)||(t=r.CoreString.ensure_float(t)),a.default(n)||(n=r.CoreString.ensure_float(n)),`vec3(${e}, ${t}, ${n})`}static float2(e,t){return a.default(e)||(e=r.CoreString.ensure_float(e)),a.default(t)||(t=r.CoreString.ensure_float(t)),`vec2(${e}, ${t})`}static float(e){return a.default(e)||(e=r.CoreString.ensure_float(e)),`${e}`}static int(e){return`${e}`}static bool(e){return`${e}`}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(363);var r;!function(e){e.ATTRIBUTE="attribute",e.FUNCTION="function",e.UNIFORM="uniform",e.VARYING="varying"}(r=t.GLDefinitionType||(t.GLDefinitionType={}));class o{constructor(e,t,n,s){this._definition_type=e,this._data_type=t,this._node=n,this._name=s}get definition_type(){return this._definition_type}get data_type(){return this._data_type}get node(){return this._node}get name(){return this._name}collection_instance(){return new s.TypedGLDefinitionCollection}}t.TypedGLDefinition=o;t.AttributeGLDefinition=class extends o{constructor(e,t,n){super(r.ATTRIBUTE,t,e,n),this._node=e,this._data_type=t,this._name=n}get line(){return`attribute ${this.data_type} ${this.name}`}};t.FunctionGLDefinition=class extends o{constructor(e,t,n){super(r.FUNCTION,t,e,n),this._node=e,this._data_type=t,this._name=n}get line(){return this.name}};t.UniformGLDefinition=class extends o{constructor(e,t,n){super(r.UNIFORM,t,e,n),this._node=e,this._data_type=t,this._name=n}get line(){return`uniform ${this.data_type} ${this.name}`}};t.VaryingGLDefinition=class extends o{constructor(e,t,n){super(r.VARYING,t,e,n),this._node=e,this._data_type=t,this._name=n}get line(){return`varying ${this.data_type} ${this.name}`}}},,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(16);t.TypedNamedConnectionPoint=class{constructor(e,t,n){this._name=e,this._type=t,this._init_value=n,void 0===this._init_value&&(this._init_value=s.ConnectionPointInitValueMap[this._type])}get name(){return this._name}get type(){return this._type}get param_type(){return s.ConnectionPointTypeToParamTypeMap[this._type]}get init_value(){return this._init_value}to_json(){return this._json=this._json||this._create_json()}_create_json(){return{name:this._name,type:this._type}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(81),r=n(28),o=n(27),i=n(5),a=n(651);class _ extends s.TypedNode{constructor(){super(...arguments),this.spare_params_controller=new a.GlNodeSpareParamsController(this)}static node_context(){return o.NodeContext.GL}initialize_base_node(){this.io.connections.init_inputs(),this.ui_data.set_layout_horizontal(),this.io.outputs.set_named_output_connection_points([]),this.spare_params_controller.initialize_node()}cook(){console.warn("gl nodes should never cook")}_set_mat_to_recompile(){var e;null===(e=this.material_node)||void 0===e||e.assembler_controller.set_compilation_required_and_dirty(this)}get material_node(){var e;if(this.parent)return this.parent.type==this.type?null===(e=this.parent)||void 0===e?void 0:e.material_node:this.parent}gl_var_name(e){return`v_POLY_${this.name}_${e}`}variable_for_input(e){var t;const n=this.io.inputs.get_input_index(e),s=this.io.connections.input_connection(n);if(s){const t=s.node_src,n=t.io.outputs.named_output_connection_points[s.output_index];if(n){const e=n.name;return t.gl_var_name(e)}throw console.warn(`no output called '${e}' for gl node ${t.full_path()}`),"variable_for_input ERROR"}return r.ThreeToGl.any(null===(t=this.params.get(e))||void 0===t?void 0:t.value)}set_lines(e){}reset_code(){var e;null===(e=this._param_configs_controller)||void 0===e||e.reset()}set_param_configs(){}param_configs(){var e;return null===(e=this._param_configs_controller)||void 0===e?void 0:e.list}gl_input_default_value(e){return null}}t.TypedGlNode=_;t.BaseGlNodeClass=class extends _{};class c extends i.NodeParamsConfig{}const l=new c;t.ParamlessTypedGlNode=class extends _{constructor(){super(...arguments),this.params_config=l}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(289),r=n(55),o=n(96),i=n(10),a=n(22),_=n(57),c=n(40),l=n(0),u=n(7),d=n(290),h=n(71),p=n(59),m=n(159),f=n(41);var g;!function(e){e.MESH="MESH",e.POINTS="POINTS",e.LINE_SEGMENTS="LINE_SEGMENTS"}(g=t.ObjectType||(t.ObjectType={})),t.ObjectTypes=[g.MESH,g.POINTS,g.LINE_SEGMENTS],t.ObjectTypeMenuEntries=[{name:"Mesh",value:t.ObjectTypes.indexOf(g.MESH)},{name:"Points",value:t.ObjectTypes.indexOf(g.POINTS)},{name:"LineSegments",value:t.ObjectTypes.indexOf(g.LINE_SEGMENTS)}],t.ObjectTypeByObject=function(e){return e instanceof a.Mesh?g.MESH:e instanceof _.LineSegments?g.LINE_SEGMENTS:e instanceof o.Points?g.POINTS:void console.warn("ObjectTypeByObject received an unknown object type",e)};const v={MeshStandard:new p.MeshStandardMaterial({color:16777215,side:l.FrontSide,metalness:.5,roughness:.9}),[g.MESH]:new m.MeshLambertMaterial({color:new u.Color(.5,.5,1),side:l.FrontSide,vertexColors:!1,transparent:!0,depthTest:!0}),[g.POINTS]:new h.PointsMaterial({color:16777215,size:.1,depthTest:!0}),[g.LINE_SEGMENTS]:new f.LineBasicMaterial({color:16777215,linewidth:1})};var y,b;!function(e){e[e.VERTEX=0]="VERTEX",e[e.OBJECT=1]="OBJECT"}(y=t.AttribClass||(t.AttribClass={})),t.AttribClassMenuEntries=[{name:"vertex",value:y.VERTEX},{name:"object",value:y.OBJECT}],function(e){e[e.NUMERIC=0]="NUMERIC",e[e.STRING=1]="STRING"}(b=t.AttribType||(t.AttribType={})),t.AttribTypeMenuEntries=[{name:"numeric",value:b.NUMERIC},{name:"string",value:b.STRING}],t.CoreConstant={ATTRIB_CLASS:{VERTEX:y.VERTEX,OBJECT:y.OBJECT},ATTRIB_TYPE:{NUMERIC:0,STRING:1},OBJECT_TYPE:{MESH:g.MESH,POINTS:g.POINTS,LINE_SEGMENTS:g.LINE_SEGMENTS},OBJECT_TYPES:t.ObjectTypes,CONSTRUCTOR_NAMES_BY_CONSTRUCTOR_NAME:{[r.Scene.name]:"Scene",[c.Group.name]:"Group",[i.Object3D.name]:"Object3D",[a.Mesh.name]:"Mesh",[o.Points.name]:"Points",[_.LineSegments.name]:"LineSegments",[d.Bone.name]:"Bone",[s.SkinnedMesh.name]:"SkinnedMesh"},CONSTRUCTORS_BY_NAME:{[g.MESH]:a.Mesh,[g.POINTS]:o.Points,[g.LINE_SEGMENTS]:_.LineSegments},MATERIALS:v}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),r=s.__importDefault(n(82)),o=s.__importDefault(n(92)),i=n(367),a=n(28),_=n(16),c=n(5);class l extends c.NodeParamsConfig{}t.BaseGlMathFunctionParamsConfig=l;const u=new l;class d extends i.BaseAdaptiveGlNode{constructor(){super(...arguments),this.params_config=u}gl_method_name(){return""}gl_function_definitions(){return[]}initialize_node(){super.initialize_node(),this.gl_connections_controller.set_expected_input_types_function(this._expected_input_types.bind(this)),this.gl_connections_controller.set_expected_output_types_function(this._expected_output_types.bind(this)),this.gl_connections_controller.set_input_name_function(this._gl_input_name.bind(this))}_expected_input_types(){const e=this.gl_connections_controller.first_input_connection_type()||_.ConnectionPointType.FLOAT;if(this.io.connections.first_input_connection()){let t=Math.max(o.default(this.io.connections.input_connections()).length+1,2);return r.default(t).map(t=>e)}return r.default(2).map(t=>e)}_expected_output_types(){return[this._expected_input_types()[0]]}_gl_input_name(e){return"in"}set_lines(e){const t=this.io.outputs.named_output_connection_points[0].type,n=this.io.inputs.named_input_connection_points.map((e,t)=>{const n=e.name;return a.ThreeToGl.any(this.variable_for_input(n))}).join(", "),s=`${t} ${this.gl_var_name(this.gl_connections_controller.output_name(0))} = ${this.gl_method_name()}(${n})`;e.add_body_lines(this,[s]),e.add_definitions(this,this.gl_function_definitions())}}t.BaseGlMathFunctionGlNode=d;t.BaseNodeGlMathFunctionArg1GlNode=class extends d{_gl_input_name(e){return"in"}_expected_input_types(){return[this.gl_connections_controller.first_input_connection_type()||_.ConnectionPointType.FLOAT]}};t.BaseNodeGlMathFunctionArg2GlNode=class extends d{_expected_input_types(){const e=this.gl_connections_controller.first_input_connection_type()||_.ConnectionPointType.FLOAT;return[e,e]}};t.BaseNodeGlMathFunctionArg3GlNode=class extends d{_expected_input_types(){const e=this.gl_connections_controller.first_input_connection_type()||_.ConnectionPointType.FLOAT;return[e,e,e]}};t.BaseNodeGlMathFunctionArg4GlNode=class extends d{_expected_input_types(){const e=this.gl_connections_controller.first_input_connection_type()||_.ConnectionPointType.FLOAT;return[e,e,e,e]}};t.BaseNodeGlMathFunctionArg5GlNode=class extends d{_expected_input_types(){const e=this.gl_connections_controller.first_input_connection_type()||_.ConnectionPointType.FLOAT;return[e,e,e,e,e]}}},,,,,,,,,,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),r=s.__importDefault(n(82)),o=s.__importDefault(n(91)),i=s.__importDefault(n(188)),a=s.__importDefault(n(92)),_=s.__importDefault(n(83)),c=s.__importDefault(n(547)),l=s.__importDefault(n(338)),u=s.__importDefault(n(551)),d=s.__importDefault(n(339)),h=s.__importDefault(n(559)),p=s.__importDefault(n(44)),m=/[, ]/,f=/\d+$/,g=/,| /,v=/^-?\d+\.?\d*$/;var y;!function(e){e.TRUE="true",e.FALSE="false"}(y||(y={}));class b{static is_boolean(e){return e==y.TRUE||e==y.FALSE}static to_boolean(e){return e==y.TRUE}static is_number(e){return v.test(e)}static tail_digits(e){const t=e.match(f);return t?parseInt(t[0]):0}static increment(e){let t;if(t=e.match(f)){const n=parseInt(t[0]);return`${e.substring(0,e.length-t[0].length)}${n+1}`}return`${e}1`}static pluralize(e){return"s"!==e[e.length-1]?`${e}s`:e}static camel_case(e){return h.default(e)}static upper_first(e){return d.default(e)}static snake_case(e){return u.default(e)}static titleize(e){return l.default(e.replace(/_/g," "))}static type_to_class_name(e){return this.upper_first(h.default(e))}static timestamp_to_seconds(e){return Date.parse(e)/1e3}static seconds_to_timestamp(e){const t=new Date;return t.setTime(1e3*e),t.toISOString().substr(11,8)}static precision(e,t=2){t=Math.max(t,0);const n=`${e}`.split(".");if(t<=0)return n[0];let s=n[1];if(void 0!==s)return s.length>t&&(s=s.substring(0,t)),s=c.default(s,t,"0"),`${n[0]}.${s}`;{const n=`${e}.`,s=n.length+t;return c.default(n,s,"0")}}static ensure_float(e){const t=`${e}`;return t.indexOf(".")>=0?t:`${t}.0`}static match_mask(e,t){if("*"===t)return!0;return t=`^${t=t.split("*").join(".*")}$`,new RegExp(t).test(e)}static matches_one_mask(e,t){let n=!1;for(let s of t)b.match_mask(e,s)&&(n=!0);return n}static attrib_names(e){const t=e.split(m),n=a.default(t.map(e=>i.default(e)));return o.default(n)}static to_id(e){if(null==e)return 0;const t=e.split("").reverse();let n=0,s=0;return t.forEach((e,t)=>{let r=e.charCodeAt(0);r>=0&&(s=t%10,n+=r*Math.pow(10,s),n%=Number.MAX_SAFE_INTEGER)}),n}static indices(e){const t=e.split(g);if(t.length>1)return o.default(_.default(t.map(e=>this.indices(e)))).sort((e,t)=>e-t);{const e=t[0];if(e){const t="-";if(e.indexOf(t)>0){const n=e.split(t);return r.default(parseInt(n[0]),parseInt(n[1])+1)}{const t=parseInt(e);return p.default(t)?[t]:[]}}return[]}}static escape_line_breaks(e){return e.replace(/(\r\n|\n|\r)/gm,"\\n")}}t.CoreString=b},function(e,t,n){"use strict";var s;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.VERTEX="vertex",e.FRAGMENT="fragment",e.LEAVES_FROM_NODES_SHADER="leaves_from_nodes_shader",e.PARTICLES_0="particles_0",e.PARTICLES_1="particles_1",e.PARTICLES_2="particles_2",e.PARTICLES_3="particles_3",e.PARTICLES_4="particles_4",e.PARTICLES_5="particles_5",e.PARTICLES_6="particles_6",e.PARTICLES_7="particles_7",e.PARTICLES_8="particles_8",e.PARTICLES_9="particles_9"}(s=t.ShaderName||(t.ShaderName={})),t.ParticleShaderNames=[s.PARTICLES_0,s.PARTICLES_1,s.PARTICLES_2,s.PARTICLES_3,s.PARTICLES_4,s.PARTICLES_5,s.PARTICLES_6,s.PARTICLES_7,s.PARTICLES_8,s.PARTICLES_9]},,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),r=n(1),o=n(4),i=n(4),a=n(6),_=n(97),c=s.__importDefault(n(82)),l=s.__importDefault(n(91)),u=s.__importDefault(n(179)),d=s.__importDefault(n(378)),h=s.__importDefault(n(190)),p=s.__importDefault(n(168)),m=s.__importDefault(n(21)),f=s.__importDefault(n(44)),g=n(379),v=n(824),y=n(35),b=n(114),x=n(825),T=n(274);class C{constructor(e){this._geometry=e}geometry(){return this._geometry}uuid(){return this._geometry.uuid}bounding_box(){return this._bounding_box=this._bounding_box||this._create_bounding_box()}_create_bounding_box(){if(this._geometry.computeBoundingBox(),this._geometry.boundingBox)return this._geometry.boundingBox}mark_as_instance(){this._geometry.userData.is_instance=!0}static marked_as_instance(e){return!0===e.userData.is_instance}marked_as_instance(){return C.marked_as_instance(this._geometry)}position_attrib_name(){let e="position";return this.marked_as_instance()&&(e="instancePosition"),e}compute_vertex_normals(){this._geometry.computeVertexNormals()}user_data_attribs(){const e="indexed_attrib_values";return this._geometry.userData[e]=this._geometry.userData[e]||{}}indexed_attribute_names(){return Object.keys(this.user_data_attribs()||{})}user_data_attrib(e){return e=b.CoreAttribute.remap_name(e),this.user_data_attribs()[e]}is_attrib_indexed(e){return e=b.CoreAttribute.remap_name(e),null!=this.user_data_attrib(e)}has_attrib(e){return"ptnum"===e||(e=b.CoreAttribute.remap_name(e),null!=this._geometry.attributes[e])}attrib_type(e){return this.is_attrib_indexed(e)?y.CoreConstant.ATTRIB_TYPE.STRING:y.CoreConstant.ATTRIB_TYPE.NUMERIC}attrib_names(){return Object.keys(this._geometry.attributes)}attrib_sizes(){const e={};for(let t of this.attrib_names())e[t]=this._geometry.attributes[t].itemSize;return e}attrib_size(e){let t;return e=b.CoreAttribute.remap_name(e),null!=(t=this._geometry.attributes[e])?t.itemSize:"ptnum"===e?1:0}set_indexed_attribute_values(e,t){this.user_data_attribs()[e]=t}set_indexed_attribute(e,t,n){this.set_indexed_attribute_values(e,t),this._geometry.setAttribute(e,new o.Int32BufferAttribute(n,1))}add_numeric_attrib(e,t=1,n=0){const s=[];let r=!1;if(f.default(n)){for(let e=0;e<this.points_count();e++)for(let e=0;e<t;e++)s.push(n);r=!0}else if(t>1)if(m.default(n)){for(let e=0;e<this.points_count();e++)for(let e=0;e<t;e++)s.push(n[e]);r=!0}else{const e=n;if(2==t&&null!=e.x&&null!=e.y){for(let t=0;t<this.points_count();t++)s.push(e.x),s.push(e.y);r=!0}const o=n;if(3==t&&null!=o.x&&null!=o.y&&null!=o.z){for(let e=0;e<this.points_count();e++)s.push(o.x),s.push(o.y),s.push(o.z);r=!0}const i=n;if(3==t&&null!=i.r&&null!=i.g&&null!=i.b){for(let e=0;e<this.points_count();e++)s.push(i.r),s.push(i.g),s.push(i.b);r=!0}const a=n;if(4==t&&null!=a.x&&null!=a.y&&null!=a.z&&null!=a.w){for(let e=0;e<this.points_count();e++)s.push(a.x),s.push(a.y),s.push(a.z),s.push(a.w);r=!0}}if(!r)throw"no other default value allowed for now in add_numeric_attrib";this._geometry.setAttribute(e,new i.Float32BufferAttribute(s,t))}init_position_attribute(e,t){const n=[];null==t&&(t=new r.Vector3);for(let s=0;s<e;s++)n.push(t.x),n.push(t.y),n.push(t.z);return this._geometry.setAttribute("position",new i.Float32BufferAttribute(n,3))}add_attribute(e,t){switch(t.type()){case y.CoreConstant.ATTRIB_TYPE.STRING:return console.log("TODO: to implement");case y.CoreConstant.ATTRIB_TYPE.NUMERIC:return this.add_numeric_attrib(e,t.size())}}rename_attribute(e,t){this.is_attrib_indexed(e)&&(this.user_data_attribs()[t]=p.default(this.user_data_attribs()[e]),delete this.user_data_attribs()[e]);const n=this._geometry.getAttribute(e);return this._geometry.setAttribute(t,new i.Float32BufferAttribute(n.array,n.itemSize)),this._geometry.deleteAttribute(e)}delete_attribute(e){return this.is_attrib_indexed(e)&&delete this.user_data_attribs()[e],this._geometry.deleteAttribute(e)}clone(){return C.clone(this._geometry)}static clone(e){let t;for(let t of Object.keys(e.attributes)){const n=e.getAttribute(t);n.constructor.name==_.InterleavedBufferAttribute.name&&x.MonkeyPatcher.patch(n)}const n=e.clone();return null!=(t=e.userData)&&(n.userData=h.default(t)),n}points_count(){return C.points_count(this._geometry)}static points_count(e){let t,n=0;let s="position";if(new this(e).marked_as_instance()&&(s="instancePosition"),null!=(t=e.getAttribute(s))){let e;null!=(e=t.array)&&(n=e.length/3)}return n}points(){return this._points=this._points||this.points_from_geometry()}reset_points(){this._points=void 0}points_from_geometry(){const e=[],t=this._geometry.getAttribute(this.position_attrib_name());if(null!=t){const n=t.array.length/3;for(let t=0;t<n;t++){const n=new g.CorePoint(this,t);e.push(n)}}return e}static geometry_from_points(e,t){const n=new a.BufferGeometry,s=new this(n),r=e[0];if(null!=r){const o=r.geometry(),a=r.geometry_wrapper(),_={};u.default(e,(e,t)=>_[e.index]=t);const c=this._indices_from_points(_,o,t);null!=c&&0!==c.length&&n.setIndex(c);const{attributes:d}=o;for(let t of Object.keys(d)){if(null!=a.user_data_attribs()[t]){const r=l.default(e.map(e=>e.attrib_value(t))),o={};u.default(r,(e,t)=>o[e]=t),s.user_data_attribs()[t]=r;const a=[];for(let n of e){const e=o[n.attrib_value(t)];a.push(e)}n.setAttribute(t,new i.Float32BufferAttribute(a,1))}else{const s=[],r=d[t].itemSize;for(let n of e){const e=n.attrib_value(t);switch(r){case 1:s.push(e);case 3:s.push(e.x),s.push(e.y),s.push(e.z)}}n.setAttribute(t,new i.Float32BufferAttribute(s,r))}}}return n}static _indices_from_points(e,t,n){const s=t.index;if(null!=s){const t=s.array,r=[];switch(n){case y.CoreConstant.OBJECT_TYPE.POINTS:u.default(t,(function(t,n){const s=e[t];null!=s&&r.push(s)}));break;case y.CoreConstant.OBJECT_TYPE.MESH:u.default(t,(function(n,s){if(s%3==0){const n=t[s],o=t[s+1],i=t[s+2],a=e[n],_=e[o],c=e[i];null!=a&&null!=_&&null!=c&&(r.push(a),r.push(_),r.push(c))}}));break;case y.CoreConstant.OBJECT_TYPE.LINE_SEGMENTS:u.default(t,(function(n,s){if(s%2==0){const n=t[s],o=t[s+1],i=e[n],a=e[o];null!=i&&null!=a&&(r.push(i),r.push(a))}}))}return r}}static merge_geometries(e){if(0===e.length)return;const t=e.map(e=>new C(e)),n=t[0].indexed_attribute_names(),s={};for(let e of n){const n={},r=[];for(let s of t){const t=s.points();for(let s of t){r.push(s);const t=s.attrib_value(e);null!=n[t]?n[t]:n[t]=Object.keys(n).length}}const o=Object.keys(n);for(let t of r){const s=n[t.attrib_value(e)];t.set_attrib_index(e,s)}s[e]=o}const r=T.BufferGeometryUtils.mergeBufferGeometries(e),o=new this(r);return Object.keys(s).forEach(e=>{const t=s[e];o.set_indexed_attribute_values(e,t)}),r&&delete r.userData.mergedUserData,r}segments(){var e;const t=(null===(e=this.geometry().index)||void 0===e?void 0:e.array)||[];return d.default(t,2)}faces(){return this.faces_from_geometry()}faces_from_geometry(){var e;const t=((null===(e=this.geometry().index)||void 0===e?void 0:e.array)||[]).length/3;return c.default(t).map(e=>new v.CoreFace(this,e))}}t.CoreGeometry=C},,,,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(533);t.CoreGraphNode=class{constructor(e,t){this._scene=e,this._name=t,this._dirty_controller=new s.DirtyController(this),this._graph_node_id=e.graph.next_id(),e.graph.setNode(this),this._graph=e.graph}get name(){return this._name}set_name(e){this._name=e}get scene(){return this._scene}get graph(){return this._graph}get graph_node_id(){return this._graph_node_id}get dirty_controller(){return this._dirty_controller}set_dirty(e){e=e||this,this._dirty_controller.set_dirty(e)}set_successors_dirty(e){this._dirty_controller.set_successors_dirty(e)}remove_dirty_state(){this._dirty_controller.remove_dirty_state()}get is_dirty(){return this._dirty_controller.is_dirty}add_post_dirty_hook(e,t){this._dirty_controller.add_post_dirty_hook(e,t)}graph_remove(){this.graph.removeNode(this)}add_graph_input(e){return this.graph.connect(e,this)}remove_graph_input(e){this.graph.disconnect(e,this)}graph_disconnect_predecessors(){this.graph.disconnect_predecessors(this)}graph_disconnect_successors(){this.graph.disconnect_successors(this)}graph_predecessor_ids(){return this.graph.predecessor_ids(this._graph_node_id)||[]}graph_predecessors(){return this.graph.predecessors(this)}graph_successors(){return this.graph.successors(this)}graph_all_predecessors(){return this.graph.all_predecessors(this)}graph_all_successors(){return this.graph.all_successors(this)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.CREATED="node_created",e.DELETED="node_deleted",e.NAME_UPDATED="node_name_update",e.OVERRIDE_CLONABLE_STATE_UPDATE="node_override_clonable_state_update",e.NAMED_OUTPUTS_UPDATED="node_named_outputs_updated",e.NAMED_INPUTS_UPDATED="node_named_inputs_updated",e.INPUTS_UPDATED="node_inputs_updated",e.PARAMS_UPDATED="node_params_updated",e.UI_DATA_POSITION_UPDATED="node_ui_data_position_updated",e.UI_DATA_COMMENT_UPDATED="node_ui_data_comment_updated",e.ERROR_UPDATED="node_error_updated",e.FLAG_BYPASS_UPDATED="bypass_flag_updated",e.FLAG_DISPLAY_UPDATED="display_flag_updated",e.SELECTION_UPDATED="selection_updated"}(t.NodeEvent||(t.NodeEvent={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),r=n(101),o=n(349),i=n(586),a=s.__importDefault(n(48)),_=s.__importDefault(n(44));t.BaseMethod=class{constructor(e){this.param=e,this.node=this.param.node}static required_arguments(){return console.warn("Expression.Method._Base.required_arguments virtual method call. Please override"),[]}static optional_arguments(){return[]}static min_allowed_arguments_count(){return this.required_arguments().length}static max_allowed_arguments_count(){return this.min_allowed_arguments_count()+this.optional_arguments().length}static allowed_arguments_count(e){return e>=this.min_allowed_arguments_count()&&e<=this.max_allowed_arguments_count()}process_arguments(e){throw"Expression.Method._Base.process_arguments virtual method call. Please override"}get_referenced_node_container(e){return s.__awaiter(this,void 0,void 0,(function*(){const t=this.get_referenced_node(e);if(t){const e=yield t.request_container();if(e){if(e.core_content())return e}throw`referenced node invalid: ${t.full_path()}`}throw`invalid input (${e})`}))}get_referenced_param(e,t){return r.CoreWalker.find_param(this.node,e,t)||null}find_referenced_graph_node(e,t){if(_.default(e)){const t=e;return this.node.io.inputs.input_graph_node(t)}{const n=e;return this.get_referenced_node(n,t)}}get_referenced_node(e,t){if(a.default(e)){const n=e;return r.CoreWalker.find_node(this.node,n,t)}{const t=e;return this.node.io.inputs.input(t),this.node.io.inputs.input(t)}}find_dependency(e){return null}create_dependency_from_index_or_path(e){const t=new o.DecomposedPath,n=this.find_referenced_graph_node(e,t);return n?this.create_dependency(n,e,t):(console.warn("node not found for path",e),null)}create_dependency(e,t,n){return i.MethodDependency.create(this.param,t,e,n)}}},,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(530),r=n(531);class o{constructor(){this.renderers_controller=new s.RenderersController,this.nodes_register=new r.NodesRegister,this.scenes_by_uuid={}}static instance(){return this._instance=this._instance||new o}register_node(e,t,n){this.nodes_register.register_node(e,t,n)}registered_nodes(e,t){return this.nodes_register.registered_nodes(e,t)}in_worker_thread(){return!1}desktop_controller(){}player_mode(){return!1}log(...e){console.log(...e)}set_env(e){this._env=e}get env(){return this._env}}t.Poly=o,t.POLY=o.instance()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),r=n(81),o=n(9),i=n(763),a=n(27),_=n(113);class c extends r.TypedNode{constructor(){super(...arguments),this.container_controller=new _.TypedContainerController(this,i.MaterialContainer),this._cook_main_without_inputs_when_dirty_bound=this._cook_main_without_inputs_when_dirty.bind(this)}static node_context(){return a.NodeContext.MAT}initialize_base_node(){super.initialize_base_node(),this.name_controller.add_post_set_full_path_hook(this.set_material_name.bind(this)),this.add_post_dirty_hook("_cook_main_without_inputs_when_dirty",this._cook_main_without_inputs_when_dirty_bound)}_cook_main_without_inputs_when_dirty(){return s.__awaiter(this,void 0,void 0,(function*(){yield this.cook_controller.cook_main_without_inputs()}))}set_material_name(){this._material&&(this._material.name=this.full_path())}get material(){return this._material=this._material||this.create_material()}set_material(e){this.set_container(e)}add_render_hook(e){}}t.TypedMatNode=c;t.BaseMatNodeClass=class extends c{create_material(){return new o.Material}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(10),r=n(81),o=n(787),i=n(27),a=n(113),_=n(40),c=["parent object","parent object","parent object","parent object"];var l;!function(e){e[e.MANAGER=0]="MANAGER",e[e.FOG=1]="FOG",e[e.CAMERA=2]="CAMERA",e[e.LIGHT=3]="LIGHT",e[e.EVENT=4]="EVENT",e[e.MAT=5]="MAT"}(l=t.ObjNodeRenderOrder||(t.ObjNodeRenderOrder={}));class u extends r.TypedNode{constructor(){super(...arguments),this.container_controller=new a.TypedContainerController(this,o.ObjectContainer),this.render_order=l.MANAGER,this._children_group=new _.Group,this._attachable_to_hierarchy=!0,this._used_in_scene=!0}static node_context(){return i.NodeContext.OBJ}static displayed_input_names(){return c}get attachable_to_hierarchy(){return this._attachable_to_hierarchy}get used_in_scene(){return this._used_in_scene}set_used_in_scene(e){if(this._used_in_scene=e,!this.scene.loading_controller.is_loading){const e=this.parent;e&&e.update_object(this)}}add_object_to_parent(e){this.attachable_to_hierarchy&&e.add(this.object)}remove_object_from_parent(){if(this.attachable_to_hierarchy){const e=this.object.parent;e&&e.remove(this.object)}}initialize_base_node(){this._object=this._create_object_with_attributes(),this.name_controller.add_post_set_full_path_hook(this.set_object_name.bind(this)),this.set_object_name()}get children_group(){return this._children_group}get object(){return this._object}_create_object_with_attributes(){const e=this.create_object();return e.node=this,e.add(this._children_group),e}set_object_name(){this._object&&(this._object.name=this.full_path(),this._children_group.name=`${this.full_path()}:parented_outputs`)}create_object(){return new s.Object3D}is_display_node_cooking(){return!1}is_displayed(){var e,t;return(null===(t=null===(e=this.flags)||void 0===e?void 0:e.display)||void 0===t?void 0:t.active)||!1}}t.TypedObjNode=u;t.BaseObjNodeClass=class extends u{}},,,function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var s,r,o,i=n(22),a=n(63),_=n(54);function c(){this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}Object.assign(c.prototype,{setSize:function(){},render:function(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}}),c.FullScreenQuad=(s=new a.OrthographicCamera(-1,1,1,-1,0,1),r=new _.PlaneBufferGeometry(2,2),o=function(e){this._mesh=new i.Mesh(r,e)},Object.defineProperty(o.prototype,"material",{get:function(){return this._mesh.material},set:function(e){this._mesh.material=e}}),Object.assign(o.prototype,{dispose:function(){this._mesh.geometry.dispose()},render:function(e){e.render(this._mesh,s)}}),o)},,,,,,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),r=n(60),o=n(534),i=n(535),a=n(538),_=n(539),c=n(566),l=n(113),u=n(567),d=n(568),h=n(256),p=n(344),m=n(578),f=n(611),g=n(612),v=n(613),y=(n(61),n(618)),b=n(115);class x extends r.CoreGraphNode{constructor(e,t="BaseNode"){super(e,t),this.container_controller=new l.TypedContainerController(this,b.BaseContainer),this.pv=new f.ParamsValueAccessor,this.p=new y.ParamsAccessor,this._initialized=!1}get display_node_controller(){return this._display_node_controller}get parent_controller(){return this._parent_controller=this._parent_controller||new a.HierarchyParentController(this)}static displayed_input_names(){return[]}get children_controller_context(){return this._children_controller_context}_create_children_controller(){if(this._children_controller_context)return new _.HierarchyChildrenController(this,this._children_controller_context)}get children_controller(){return this._children_controller=this._children_controller||this._create_children_controller()}children_allowed(){return null!=this._children_controller_context}get ui_data(){return this._ui_data=this._ui_data||new o.UIData(this)}get dependencies_controller(){return this._dependencies_controller=this._dependencies_controller||new d.DependenciesController(this)}get states(){return this._states=this._states||new i.StatesController(this)}get lifecycle(){return this._lifecycle=this._lifecycle||new c.LifeCycleController(this)}get serializer(){return this._serializer=this._serializer||new p.NodeSerializer(this)}get cook_controller(){return this._cook_controller=this._cook_controller||new u.CookController(this)}get io(){return this._io=this._io||new v.IOController(this)}get name_controller(){return this._name_controller=this._name_controller||new h.NameController(this)}set_name(e){this.name_controller.set_name(e)}_set_core_name(e){this._name=e}get params(){return this._params_controller=this._params_controller||new m.ParamsController(this)}get processing_context(){return this._processing_context=this._processing_context||new g.ProcessingContext(this)}initialize_base_and_node(){this._initialized?console.warn("node already initialized"):(this.initialize_base_node(),this.initialize_node(),this._initialized=!0)}initialize_base_node(){}initialize_node(){}static type(){throw"type to be overriden"}get type(){return this.constructor.type()}static node_context(){throw"requires override"}node_context(){return this.constructor.node_context()}static required_three_imports(){return[]}static required_imports(){let e=this.required_three_imports();return e?e.map(e=>`three/examples/jsm/${e}`):[]}required_imports(){return this.constructor.required_imports()}static require_webgl2(){return!1}require_webgl2(){return this.constructor.require_webgl2()}set_parent(e){this.parent_controller.set_parent(e)}get parent(){return this.parent_controller.parent}get root(){return this._scene.root}full_path(){return this.parent_controller.full_path()}create_params(){}add_param(e,t,n,s){var r;return null===(r=this._params_controller)||void 0===r?void 0:r.add_param(e,t,n,s)}cook(e){return null}request_container(){return s.__awaiter(this,void 0,void 0,(function*(){return yield this.container_controller.request_container()}))}set_container(e,t=null){this.container_controller.container.set_content(e),null!=e&&(e.name||(e.name=this.full_path()),e.node||(e.node=this)),this.cook_controller.end_cook(t)}create_node(e){var t;return null===(t=this.children_controller)||void 0===t?void 0:t.create_node(e)}remove_node(e){var t;null===(t=this.children_controller)||void 0===t||t.remove_node(e)}children(){var e;return(null===(e=this.children_controller)||void 0===e?void 0:e.children())||[]}node(e){var t;return(null===(t=this.parent_controller)||void 0===t?void 0:t.find_node(e))||null}nodes_by_type(e){var t;return(null===(t=this.children_controller)||void 0===t?void 0:t.nodes_by_type(e))||[]}set_input(e,t,n=0){this.io.inputs.set_input(e,t,n)}emit(e,t=null){this.scene.dispatch_controller.dispatch(this,e,t)}to_json(e=!1){return this.serializer.to_json(e)}}t.TypedNode=x;t.BaseNodeClass=class extends x{}},,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),r=n(218),o=n(1),i=n(104),a=n(85),_=n(5),c=n(69);function l(e){return class extends e{constructor(){super(...arguments),this.transform=_.ParamConfig.FOLDER(),this.t=_.ParamConfig.VECTOR3([0,0,0]),this.r=_.ParamConfig.VECTOR3([0,0,0]),this.s=_.ParamConfig.VECTOR3([1,1,1]),this.scale=_.ParamConfig.FLOAT(1)}}}t.TransformedParamConfig=l;l(_.NodeParamsConfig);class u extends c.TypedObjNode{constructor(){super(...arguments),this.transform_controller=new d(this)}}t.TransformedObjNode=u;class d{constructor(e){this.node=e,this._cook_main_without_inputs_when_dirty_bound=this._cook_main_without_inputs_when_dirty.bind(this),this._update_transform_from_params_scale=new o.Vector3}initialize_node(){this.node.io.inputs.set_count(0,1),this.node.io.inputs.set_depends_on_inputs(!1),this.node.io.outputs.set_has_one_output(),this.node.io.inputs.add_on_set_input_hook("on_input_updated",()=>{this.on_input_updated()});const e="_cook_main_without_inputs_when_dirty";this.node.dirty_controller.has_hook(e)||this.node.dirty_controller.add_post_dirty_hook(e,this._cook_main_without_inputs_when_dirty_bound)}_cook_main_without_inputs_when_dirty(){return s.__awaiter(this,void 0,void 0,(function*(){yield this.node.cook_controller.cook_main_without_inputs()}))}static on_input_updated(e){null!=e.io.inputs.input(0)?e.root.add_to_parent_transform(e):e.root.remove_from_parent_transform(e)}on_input_updated(){d.on_input_updated(this.node)}update(e){this.update_transform_with_matrix(e)}update_transform_with_matrix(e){const t=this.node.object;return null==e||e.equals(t.matrix)?this.update_transform_from_params():(t.matrixAutoUpdate=!1,t.matrix=e,t.dispatchEvent({type:"change"}))}update_transform_from_params(){const e=this.node.object;if(e){const t=this.node.pv.t,n=this.node.pv.r;this._update_transform_from_params_scale.copy(this.node.pv.s).multiplyScalar(this.node.pv.scale),e.matrixAutoUpdate=!1,e.position.copy(t);const s=[i.CoreMath.degrees_to_radians(n.x),i.CoreMath.degrees_to_radians(n.y),i.CoreMath.degrees_to_radians(n.z)],o=new r.Euler(s[0],s[1],s[2]);e.rotation.copy(o),e.scale.copy(this._update_transform_from_params_scale),e.matrixAutoUpdate=!0,e.updateMatrix(),e.dispatchEvent({type:"change"})}}set_params_from_matrix(e,t={}){a.CoreTransform.set_params_from_matrix(e,this.node,t)}}t.TransformController=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(1),r=n(42),o=n(15),i=n(218),a=n(14);t.CoreTransform=class{constructor(){this._translation_matrix=new o.Matrix4,this._translation_matrix_q=new r.Quaternion,this._translation_matrix_s=new s.Vector3(1,1,1),this._matrix=(new o.Matrix4).identity(),this._matrix_q=new r.Quaternion,this._matrix_e=new i.Euler,this._matrix_s=new s.Vector3,this._rotate_geometry_m=new o.Matrix4,this._rotate_geometry_q=new r.Quaternion,this._rotate_geometry_vec_dest=new s.Vector3}static set_params_from_matrix(e,t,n={}){let o=n.scale;null==o&&(o=!0);const a=new s.Vector3,_=new r.Quaternion,c=new s.Vector3;e.decompose(a,_,c);const l=(new i.Euler).setFromQuaternion(_).toVector3();l.divideScalar(Math.PI/180),t.scene.batch_update(()=>{t.params.set_vector3("r",l.toArray()),t.params.set_vector3("t",a.toArray()),t.params.set_vector3("s",c.toArray()),o&&t.params.set_float("scale",1)})}static set_params_from_object(e,t){const n=e.position.toArray(),s=e.rotation.toArray().map(e=>e*(180/Math.PI));t.scene.batch_update(()=>{t.params.set_vector3("t",n),t.params.set_vector3("r",s)})}translation_matrix(e){return this._translation_matrix.compose(e,this._translation_matrix_q,this._translation_matrix_s),this._translation_matrix}static matrix_quaternion(e){const t=new s.Vector3,n=new r.Quaternion,o=new s.Vector3;return e.decompose(t,n,o),n}matrix(e,t,n,s){return this._matrix_e.set(a.MathUtils.degToRad(t.x),a.MathUtils.degToRad(t.y),a.MathUtils.degToRad(t.z),"XYZ"),this._matrix_q.setFromEuler(this._matrix_e),this._matrix_s.copy(n).multiplyScalar(s),this._matrix.compose(e,this._matrix_q,this._matrix_s),this._matrix}rotate_geometry(e,t,n){this._rotate_geometry_vec_dest.copy(n),this._rotate_geometry_vec_dest.normalize(),this._rotate_geometry_q.setFromUnitVectors(t,this._rotate_geometry_vec_dest),this._rotate_geometry_m.makeRotationFromQuaternion(this._rotate_geometry_q),e.applyMatrix4(this._rotate_geometry_m)}}},,,,,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),r=n(101),o=n(60),i=n(259),a=n(573),_=n(574),c=n(575),l=n(24),u=n(103);class d extends o.CoreGraphNode{constructor(e){super(e,"BaseParam"),this._options=new i.OptionsController(this),this._emit_controller=new a.EmitController(this),this._is_computing=!1,this.initialize_param()}get options(){return this._options=this._options||new i.OptionsController(this)}get emit_controller(){return this._emit_controller=this._emit_controller||new a.EmitController(this)}get expression_controller(){return this._expression_controller}get serializer(){return this._serializer=this._serializer||new _.ParamSerializer(this)}get states(){return this._states=this._states||new c.StatesController(this)}initialize_value(){}initialize_param(){}static type(){return l.ParamType.FLOAT}get type(){return this.constructor.type()}get is_numeric(){return!1}set_name(e){super.set_name(e)}get value(){return this._value}convert(e){return null}static are_raw_input_equal(e,t){return!1}is_raw_input_equal(e){return this.constructor.are_raw_input_equal(this._raw_input,e)}static are_values_equal(e,t){return!1}is_value_equal(e){return this.constructor.are_values_equal(this.value,e)}_clone_raw_input(e){return e}set(e){this._raw_input=this._clone_raw_input(this._prefilter_invalid_raw_input(e)),this.emit_controller.emit(u.ParamEvent.RAW_INPUT_UPDATED),this.process_raw_input()}_prefilter_invalid_raw_input(e){return e}get default_value(){return this._default_value}get is_default(){return!0}get raw_input(){return this._raw_input}process_raw_input(){}compute(){return s.__awaiter(this,void 0,void 0,(function*(){if(this.scene.loading_controller.is_loading&&console.warn(`param attempt to compute ${this.full_path()}`),this.is_dirty){if(this._is_computing)return new Promise((e,t)=>{this._compute_resolves=this._compute_resolves||[],this._compute_resolves.push(e)});if(this._is_computing=!0,yield this.process_computation(),this._is_computing=!1,this._compute_resolves){let e;for(;e=this._compute_resolves.pop();)e()}}}))}process_computation(){return s.__awaiter(this,void 0,void 0,(function*(){}))}set_init_value(e){this._default_value=e}set_node(e){var t,n;if(e?(this._node=e,this.options.makes_node_dirty_when_dirty()&&!this.parent_param&&(null===(n=e.params.params_node)||void 0===n||n.add_graph_input(this))):this._node&&(null===(t=this._node.params.params_node)||void 0===t||t.remove_graph_input(this)),this.components)for(let t of this.components)t.set_node(e)}get node(){return this._node}get parent(){return this.node}set_parent_param(e){e.add_graph_input(this),this._parent_param=e}get parent_param(){return this._parent_param}has_parent_param(){return null!=this._parent_param}full_path(){var e;return(null===(e=this.node)||void 0===e?void 0:e.full_path())+"/"+this.name}path_relative_to(e){return r.CoreWalker.relative_path(e,this)}emit(e){this.emit_controller.emit_allowed&&(this.emit_controller.increment_count(e),this.scene.dispatch_controller.dispatch(this,e))}get components(){return this._components}static get component_names(){return[]}get component_names(){return this.constructor.component_names}get is_multiple(){return this.component_names.length>0}init_components(){}has_expression(){return null!=this.expression_controller&&this.expression_controller.active}to_json(){return this.serializer.to_json()}}t.TypedParam=d;t.BaseParamClass=class extends d{get default_value_serialized(){return"BaseParamClass.default_value_serialized overriden"}get raw_input_serialized(){return"BaseParamClass.raw_input_serialized overriden"}get value_serialized(){return"BaseParamClass.value_serialized overriden"}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(641),r=n(642);class o{constructor(e){this.node=e}has_display(){return!1}has_bypass(){return!1}}function i(e){return class extends e{constructor(){super(...arguments),this.display=new r.DisplayFlag(this.node)}has_display(){return!0}}}function a(e){return class extends e{constructor(){super(...arguments),this.bypass=new s.BypassFlag(this.node)}has_bypass(){return!0}}}t.FlagsController=o;class _ extends(i(o)){}t.FlagsControllerD=_;class c extends(a(o)){}t.FlagsControllerB=c;class l extends(a(i(o))){}t.FlagsControllerDB=l},function(e,t,n){"use strict";n.r(t),t.default='\n\n// https://github.com/mattatz/ShibuyaCrowd/blob/master/source/shaders/common/quaternion.glsl\nvec4 quat_mult(vec4 q1, vec4 q2)\n{\n\treturn vec4(\n\tq1.w * q2.x + q1.x * q2.w + q1.z * q2.y - q1.y * q2.z,\n\tq1.w * q2.y + q1.y * q2.w + q1.x * q2.z - q1.z * q2.x,\n\tq1.w * q2.z + q1.z * q2.w + q1.y * q2.x - q1.x * q2.y,\n\tq1.w * q2.w - q1.x * q2.x - q1.y * q2.y - q1.z * q2.z\n\t);\n}\n// http://glmatrix.net/docs/quat.js.html#line97\n//   let ax = a[0], ay = a[1], az = a[2], aw = a[3];\n\n//   let bx = b[0], by = b[1], bz = b[2], bw = b[3];\n\n//   out[0] = ax * bw + aw * bx + ay * bz - az * by;\n\n//   out[1] = ay * bw + aw * by + az * bx - ax * bz;\n\n//   out[2] = az * bw + aw * bz + ax * by - ay * bx;\n\n//   out[3] = aw * bw - ax * bx - ay * by - az * bz;\n\n//   return out\n\n\n\n// http://www.neilmendoza.com/glsl-rotation-about-an-arbitrary-axis/\nmat4 rotationMatrix(vec3 axis, float angle)\n{\n\taxis = normalize(axis);\n\tfloat s = sin(angle);\n\tfloat c = cos(angle);\n\tfloat oc = 1.0 - c;\n\n \treturn mat4(oc * axis.x * axis.x + c, oc * axis.x * axis.y - axis.z * s,  oc * axis.z * axis.x + axis.y * s, 0.0, oc * axis.x * axis.y + axis.z * s,  oc * axis.y * axis.y + c, oc * axis.y * axis.z - axis.x * s,  0.0, oc * axis.z * axis.x - axis.y * s,  oc * axis.y * axis.z + axis.x * s,  oc * axis.z * axis.z + c, 0.0, 0.0, 0.0, 0.0, 1.0);\n}\n\n// https://www.geeks3d.com/20141201/how-to-rotate-a-vertex-by-a-quaternion-in-glsl/\nvec4 quat_from_axis_angle(vec3 axis, float angle)\n{\n\tvec4 qr;\n\tfloat half_angle = (angle * 0.5); // * 3.14159 / 180.0;\n\tfloat sin_half_angle = sin(half_angle);\n\tqr.x = axis.x * sin_half_angle;\n\tqr.y = axis.y * sin_half_angle;\n\tqr.z = axis.z * sin_half_angle;\n\tqr.w = cos(half_angle);\n\treturn qr;\n}\nvec3 rotate_with_axis_angle(vec3 position, vec3 axis, float angle)\n{\n\tvec4 q = quat_from_axis_angle(axis, angle);\n\tvec3 v = position.xyz;\n\treturn v + 2.0 * cross(q.xyz, cross(q.xyz, v) + q.w * v);\n}\n// vec3 applyQuaternionToVector( vec4 q, vec3 v ){\n// \treturn v + 2.0 * cross( q.xyz, cross( q.xyz, v ) + q.w * v );\n// }\nvec3 rotate_with_quat( vec3 v, vec4 q )\n{\n\t// vec4 qv = multQuat( quat, vec4(vec, 0.0) );\n\t// return multQuat( qv, vec4(-quat.x, -quat.y, -quat.z, quat.w) ).xyz;\n\treturn v + 2.0 * cross( q.xyz, cross( q.xyz, v ) + q.w * v );\n}\n// https://github.com/glslify/glsl-look-at/blob/gh-pages/index.glsl\n// mat3 rotation_matrix(vec3 origin, vec3 target, float roll) {\n// \tvec3 rr = vec3(sin(roll), cos(roll), 0.0);\n// \tvec3 ww = normalize(target - origin);\n// \tvec3 uu = normalize(cross(ww, rr));\n// \tvec3 vv = normalize(cross(uu, ww));\n\n// \treturn mat3(uu, vv, ww);\n// }\n// mat3 rotation_matrix(vec3 target, float roll) {\n// \tvec3 rr = vec3(sin(roll), cos(roll), 0.0);\n// \tvec3 ww = normalize(target);\n// \tvec3 uu = normalize(cross(ww, rr));\n// \tvec3 vv = normalize(cross(uu, ww));\n\n// \treturn mat3(uu, vv, ww);\n// }\n\nfloat vector_angle(vec3 start, vec3 dest){\n\tstart = normalize(start);\n\tdest = normalize(dest);\n\n\tfloat cosTheta = dot(start, dest);\n\tvec3 c1 = cross(start, dest);\n\t// We use the dot product of the cross with the Y axis.\n\t// This is a little arbitrary, but can still give a good sense of direction\n\tvec3 y_axis = vec3(0.0, 1.0, 0.0);\n\tfloat d1 = dot(c1, y_axis);\n\tfloat angle = acos(cosTheta) * sign(d1);\n\treturn angle;\n}\n\n// http://www.opengl-tutorial.org/intermediate-tutorials/tutorial-17-quaternions/#i-need-an-equivalent-of-glulookat-how-do-i-orient-an-object-towards-a-point-\nvec4 vector_align(vec3 start, vec3 dest){\n\tstart = normalize(start);\n\tdest = normalize(dest);\n\n\tfloat cosTheta = dot(start, dest);\n\tvec3 axis;\n\n\t// if (cosTheta < -1 + 0.001f){\n\t// \t// special case when vectors in opposite directions:\n\t// \t// there is no "ideal" rotation axis\n\t// \t// So guess one; any will do as long as it\'s perpendicular to start\n\t// \taxis = cross(vec3(0.0f, 0.0f, 1.0f), start);\n\t// \tif (length2(axis) < 0.01 ) // bad luck, they were parallel, try again!\n\t// \t\taxis = cross(vec3(1.0f, 0.0f, 0.0f), start);\n\n\t// \taxis = normalize(axis);\n\t// \treturn gtx::quaternion::angleAxis(glm::radians(180.0f), axis);\n\t// }\n\tif(cosTheta > (1.0 - 0.0001) || cosTheta < (-1.0 + 0.0001) ){\n\t\taxis = normalize(cross(start, vec3(0.0, 1.0, 0.0)));\n\t\tif (length(axis) < 0.001 ){ // bad luck, they were parallel, try again!\n\t\t\taxis = normalize(cross(start, vec3(1.0, 0.0, 0.0)));\n\t\t}\n\t} else {\n\t\taxis = normalize(cross(start, dest));\n\t}\n\n\tfloat angle = acos(cosTheta);\n\n\treturn quat_from_axis_angle(axis, angle);\n}\nvec4 vector_align_with_up(vec3 start, vec3 dest, vec3 up){\n\tvec4 rot1 = vector_align(start, dest);\n\tup = normalize(up);\n\n\t// Recompute desiredUp so that it\'s perpendicular to the direction\n\t// You can skip that part if you really want to force desiredUp\n\t// vec3 right = normalize(cross(dest, up));\n\t// up = normalize(cross(right, dest));\n\n\t// Because of the 1rst rotation, the up is probably completely screwed up.\n\t// Find the rotation between the "up" of the rotated object, and the desired up\n\tvec3 newUp = rotate_with_quat(vec3(0.0, 1.0, 0.0), rot1);//rot1 * vec3(0.0, 1.0, 0.0);\n\tvec4 rot2 = vector_align(up, newUp);\n\n\t// return rot1;\n\treturn rot2;\n\t// return multQuat(rot1, rot2);\n\t// return rot2 * rot1;\n\n}\n\n// https://www.euclideanspace.com/maths/geometry/rotations/conversions/quaternionToAngle/index.htm\nfloat quat_to_angle(vec4 q){\n\treturn 2.0 * acos(q.w);\n}\nvec3 quat_to_axis(vec4 q){\n\treturn vec3(\n\t\tq.x / sqrt(1.0-q.w*q.w),\n\t\tq.y / sqrt(1.0-q.w*q.w),\n\t\tq.z / sqrt(1.0-q.w*q.w)\n\t);\n}\n\nvec4 align(vec3 dir, vec3 up){\n\tvec3 start_dir = vec3(0.0, 0.0, 1.0);\n\tvec3 start_up = vec3(0.0, 1.0, 0.0);\n\tvec4 rot1 = vector_align(start_dir, dir);\n\tup = normalize(up);\n\n\t// Recompute desiredUp so that it\'s perpendicular to the direction\n\t// You can skip that part if you really want to force desiredUp\n\tvec3 right = normalize(cross(dir, up));\n\tif(length(right)<0.001){\n\t\tright = vec3(1.0, 0.0, 0.0);\n\t}\n\tup = normalize(cross(right, dir));\n\n\t// Because of the 1rst rotation, the up is probably completely screwed up.\n\t// Find the rotation between the "up" of the rotated object, and the desired up\n\tvec3 newUp = rotate_with_quat(start_up, rot1);//rot1 * vec3(0.0, 1.0, 0.0);\n\tvec4 rot2 = vector_align(normalize(newUp), up);\n\n\t// return rot1;\n\treturn quat_mult(rot1, rot2);\n\t// return rot2 * rot1;\n\n}'},,,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class s{static find_node(e,t,n){if(!e)return null;const r=t.split(s.SEPARATOR).filter(e=>e.length>0),o=r[0];let i=null;if(t[0]!==s.SEPARATOR){switch(o){case s.PARENT:null==n||n.add_path_element(o),i=e.parent;break;case s.CURRENT:null==n||n.add_path_element(o),i=e;break;default:i=e.node(o),i&&(null==n||n.add_node(o,i))}if(null!=i&&r.length>1){const e=r.slice(1).join(s.SEPARATOR);i=this.find_node(i,e,n)}return i}{const s=t.substr(1);i=this.find_node(e.root,s,n)}return i}static find_param(e,t,n){if(!e)return null;const r=t.split(s.SEPARATOR);if(1===r.length)return e.params.get(r[0]);{const t=r.slice(0,+(r.length-2)+1||void 0).join(s.SEPARATOR),o=this.find_node(e,t,n);if(null!=o){const e=r[r.length-1],t=o.params.get(e);return n&&t&&n.add_node(e,t),t}return null}}static relative_path(e,t){const n=this.closest_common_parent(e,t);if(n){const r=this.distance_to_parent(e,n);let o="";if(r-1>0){let e=0;const t=[];for(;e++<r-1;)t.push(s.PARENT);o=t.join(s.SEPARATOR)+s.SEPARATOR}const i=n.full_path().split(s.SEPARATOR).filter(e=>e.length>0),a=t.full_path().split(s.SEPARATOR).filter(e=>e.length>0),_=[];let c=0;for(let e of a)i[c]||_.push(e),c++;return`${o}${_.join(s.SEPARATOR)}`}return t.full_path()}static closest_common_parent(e,t){const n=this.parents(e).reverse(),s=this.parents(t).reverse(),r=Math.min(n.length,s.length);let o=null;for(let e=0;e<r;e++)n[e].graph_node_id==s[e].graph_node_id&&(o=n[e]);return o}static parents(e){const t=[];let n=e.parent;for(;n;)t.push(n),n=n.parent;return t}static distance_to_parent(e,t){let n=0,s=e;const r=t.graph_node_id;for(;s&&s.graph_node_id!=r;)n+=1,s=s.parent;return s&&s.graph_node_id==r?n:-1}static make_absolute_path(e,t){const n=t.split(s.SEPARATOR),r=n.shift();if(!r)return e.full_path();switch(r){case"..":return e.parent?this.make_absolute_path(e.parent,n.join(s.SEPARATOR)):null;case".":return this.make_absolute_path(e,n.join(s.SEPARATOR));default:return[e.full_path(),t].join(s.SEPARATOR)}}}t.CoreWalker=s,s.SEPARATOR="/",s.DOT=".",s.CURRENT=s.DOT,s.PARENT="..",s.CURRENT_WITH_SLASH=`${s.CURRENT}/`,s.PARENT_WITH_SLASH=`${s.PARENT}/`,s.NON_LETTER_PREFIXES=[s.SEPARATOR,s.DOT]},,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.VISIBLE_UPDATED="param_visible_updated",e.RAW_INPUT_UPDATED="raw_input_updated",e.VALUE_UPDATED="param_value_updated",e.EXPRESSION_UPDATED="param_expression_update",e.ERROR_UPDATED="param_error_updated",e.DELETED="param_deleted"}(t.ParamEvent||(t.ParamEvent={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),r=n(1),o={Triangle:n(98).Triangle,Vector3:r.Vector3},i=s.__importDefault(n(44)),a=n(350),_=Math.PI/180;class c{static clamp(e,t,n){return e<t?t:e>n?n:e}static fit01(e,t,n){return this.fit(e,0,1,t,n)}static fit(e,t,n,s,r){return(e-t)/(n-t)*(r-s)+s}static degrees_to_radians(e){return e*_}static radians_to_degrees(e){return e/_}static deg2rad(e){return this.degrees_to_radians(e)}static rad2deg(e){return this.radians_to_degrees(e)}static rand(e){return i.default(e)?this.rand_float(e):this.rand_vec2(e)}static round(e,t){const n=e/t,s=e<0?Math.ceil(n):Math.floor(n);return console.log("round",t,e,n,s,s*t),s*t}static highest_even(e){return 2*Math.ceil(.5*e)}static rand_float(e){const t={x:e,y:136574};return this.rand_vec2(t)}static rand_vec2(e){const t=(12.9898*e.x+78.233*e.y)%Math.PI;return this.fract(43758.5453*Math.sin(t))}static geodesic_distance(e,t){var n=this.deg2rad(e.lat),s=this.deg2rad(t.lat),r=this.deg2rad(t.lat-e.lat),o=this.deg2rad(t.lng-e.lng),i=Math.sin(r/2)*Math.sin(r/2)+Math.cos(n)*Math.cos(s)*Math.sin(o/2)*Math.sin(o/2);return 6371e3*(2*Math.atan2(Math.sqrt(i),Math.sqrt(1-i)))}static expand_triangle(e,t){const n=new o.Vector3;let s;e.getMidpoint(n),function(e){e.a="a",e.b="b",e.c="c"}(s||(s={}));for(let s of["a","b","c"]){const r=e[s].clone().sub(n),o=r.clone().normalize(),i=r.length()+t;e[s]=n.clone().add(o.multiplyScalar(i))}return e}static nearestPower2(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.log(2)))}}t.CoreMath=c,c.Easing=a.Easing,c.fract=e=>e-Math.floor(e)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(158),r=n(0),o=n(0),i=n(0),a=n(9),_=n(68),c=n(5);function l(e){return class extends e{constructor(){super(...arguments),this.double_sided=c.ParamConfig.BOOLEAN(0),this.front=c.ParamConfig.BOOLEAN(1,{visible_if:{double_sided:!1}})}}}t.SideParamConfig=l;a.Material;l(c.NodeParamsConfig);_.TypedMatNode;class u extends s.BaseController{static update(e){const t=e.pv.front?r.FrontSide:i.BackSide,n=e.pv.double_sided?o.DoubleSide:t;n!=e.material.side&&(e.material.side=n,e.material.needsUpdate=!0)}}t.SideController=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),r=n(157),o=n(28),i=n(50),a=n(29),_=n(16),c=n(128),l=n(26),u=n(268);!function(e){e.DISTANCE="customDistanceMaterial",e.DEPTH="customDepthMaterial",e.DEPTH_DOF="customDepthDOFMaterial"}(t.CustomMaterialName||(t.CustomMaterialName={}));class d extends r.BaseGlShaderAssembler{constructor(){super(...arguments),this._assemblers_by_custom_name=new Map}create_material(){return new l.ShaderMaterial}custom_assembler_class_by_custom_name(){}_add_custom_materials(e){const t=this.custom_assembler_class_by_custom_name();t&&t.forEach((t,n)=>{this._add_custom_material(e,n,t)})}_add_custom_material(e,t,n){let s=this._assemblers_by_custom_name.get(t);s||(s=new n(this._gl_parent_node),this._assemblers_by_custom_name.set(t,s)),e.custom_materials=e.custom_materials||{},e.custom_materials[t]=s.create_material()}compile_custom_materials(e){return s.__awaiter(this,void 0,void 0,(function*(){const t=this.custom_assembler_class_by_custom_name();t&&t.forEach((t,n)=>s.__awaiter(this,void 0,void 0,(function*(){if(this._code_builder){let s=this._assemblers_by_custom_name.get(n);s||(s=new t(this._gl_parent_node),this._assemblers_by_custom_name.set(n,s)),s.set_root_nodes(this._root_nodes),s.set_param_configs_owner(this._code_builder),s.set_shader_configs(this.shader_configs),s.set_variable_configs(this.variable_configs());const r=e.custom_materials[n];r&&(yield s.compile_material(r))}})))}))}compile_material(e){return s.__awaiter(this,void 0,void 0,(function*(){if(!this.compile_allowed())return;const t=u.GlNodeFinder.find_output_nodes(this._gl_parent_node);t.length>1&&this._gl_parent_node.states.error.set("only one output node allowed"),this.set_root_nodes(t),yield this._update_shaders();const n=this._shaders_by_name.get(i.ShaderName.VERTEX),s=this._shaders_by_name.get(i.ShaderName.FRAGMENT);n&&s&&(e.vertexShader=n,e.fragmentShader=s,this.add_uniforms(e.uniforms),e.needsUpdate=!0);const r=this._gl_parent_node.scene;this.uniforms_time_dependent()?r.uniforms_controller.add_time_dependent_uniform_owner(e.uuid,e.uniforms):r.uniforms_controller.remove_time_dependent_uniform_owner(e.uuid),e.custom_materials&&(yield this.compile_custom_materials(e))}))}_update_shaders(){return s.__awaiter(this,void 0,void 0,(function*(){this._shaders_by_name=new Map,this._lines=new Map;for(let e of this.shader_names){const t=this._template_shader_for_shader_name(e);t&&this._lines.set(e,t.split("\n"))}this._root_nodes.length>0&&(yield this.build_code_from_nodes(this._root_nodes),this._build_lines());for(let e of this.shader_names){const t=this._lines.get(e);t&&this._shaders_by_name.set(e,t.join("\n"))}}))}shadow_assembler_class_by_custom_name(){return{}}add_output_body_line(e,t,n){var s;const r=e.io.inputs.named_input(n),i=e.variable_for_input(n),a=this.variable_config(n);let _=null;if(r)_=o.ThreeToGl.vector3(i);else if(a.default_from_attribute()){const r=e.io.inputs.named_input_connection_points_by_name(n);if(r){const o=r.type,i=null===(s=this.globals_handler)||void 0===s?void 0:s.read_attribute(e,o,n,t);i&&(_=i)}}else{const e=a.default();e&&(_=e)}if(_){const n=a.prefix(),s=a.suffix(),r=a.if_condition();r&&t.add_body_lines(e,[`#if ${r}`]),t.add_body_lines(e,[`${n}${_}${s}`]),r&&t.add_body_lines(e,["#endif"])}}set_node_lines_output(e,t){var n;const s=t.current_shader_name,r=null===(n=this.shader_config(s))||void 0===n?void 0:n.input_names();if(r)for(let n of r)this.add_output_body_line(e,t,n)}set_node_lines_attribute(e,t){var n;const s=e.gl_type(),r=null===(n=this.globals_handler)||void 0===n?void 0:n.read_attribute(e,s,e.attribute_name,t),o=e.gl_var_name(e.output_name);t.add_body_lines(e,[`${s} ${o} = ${r}`])}handle_gl_FragCoord(e,t,n){t==i.ShaderName.FRAGMENT&&e.push(`vec4 ${n} = gl_FragCoord`)}handle_resolution(e,t,n){t==i.ShaderName.FRAGMENT&&e.push(`vec2 ${n} = resolution`)}set_node_lines_globals(e,t){var n;const s=[],r=t.current_shader_name,o=this.shader_config(r);if(!o)return;const l=o.dependencies(),u=new Map,d=new Map;let h,p;for(let o of e.io.outputs.used_output_names()){const m=e.gl_var_name(o),f=t.current_shader_name;switch(o){case"time":h=new a.UniformGLDefinition(e,_.ConnectionPointType.FLOAT,o),f&&c.MapUtils.push_on_array_at_entry(u,f,h),p=`float ${m} = ${o}`;for(let e of l)c.MapUtils.push_on_array_at_entry(u,e,h),c.MapUtils.push_on_array_at_entry(d,e,p);s.push(p),this.set_uniforms_time_dependent();break;case"gl_FragCoord":this.handle_gl_FragCoord(s,r,m);break;case"resolution":this.handle_resolution(s,r,m),h=new a.UniformGLDefinition(e,_.ConnectionPointType.VEC2,o),f&&c.MapUtils.push_on_array_at_entry(u,f,h);for(let e of l)c.MapUtils.push_on_array_at_entry(u,e,h);this.set_resolution_dependent();break;case"gl_PointCoord":r==i.ShaderName.FRAGMENT&&s.push(`vec2 ${m} = gl_PointCoord`);break;default:null===(n=this.globals_handler)||void 0===n||n.handle_globals_node(e,o,t)}}u.forEach((n,s)=>{t.add_definitions(e,n,s)}),d.forEach((n,s)=>{t.add_body_lines(e,n,s)}),t.add_body_lines(e,s)}}t.ShaderAssemblerMaterial=d},,,,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3);class r{constructor(e,t){this.node=e,this._callbacks=[],this._container=new t(this.node)}get container(){return this._container}request_container(){return new Promise((e,t)=>{this._callbacks.push(e),this.node.scene.cook_controller.add_node(this.node),setTimeout(this.process_container_request.bind(this),0)})}process_container_request(){var e,t;if(null===(t=null===(e=this.node.flags)||void 0===e?void 0:e.bypass)||void 0===t?void 0:t.active){const e=0;this.request_input_container(e).then(e=>{this.node.remove_dirty_state(),e?this.notify_requesters(e):this.node.states.error.set("input invalid")})}else this.node.is_dirty?(this.node.container_controller.container.reset_caches(),this.node.cook_controller.cook_main()):this.notify_requesters()}request_input_container(e){return s.__awaiter(this,void 0,void 0,(function*(){const t=this.node.io.inputs.input(e);if(t){return t.processing_context.copy(this.node.processing_context),yield t.container_controller.request_container()}return this.node.states.error.set(`input ${e} required`),this.notify_requesters(),null}))}notify_requesters(e){let t;const n=[];for(;t=this._callbacks.pop();)n.push(t);for(e||(e=this.node.container_controller.container.clone());t=n.pop();)t(e);this.node.scene.cook_controller.remove_node(this.node)}}t.TypedContainerController=r;t.BaseContainerController=class extends r{}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(1),r={Vector2:n(2).Vector2,Vector3:s.Vector3},o={P:"position",N:"normal",Cd:"color"};t.CoreAttribute=class{static remap_name(e){return o[e]||e}static array_to_indexed_arrays(e){const t={};let n=0;const s=[],r=[];let o=0;for(;o<e.length;){const i=e[o],a=t[i];null!=a?s.push(a):(r.push(i),s.push(n),t[i]=n,n+=1),o++}return{indices:s,values:r}}static default_value(e){switch(e){case 1:return 0;case 2:return new r.Vector2(0,0);case 3:return new r.Vector3(0,0,0);default:throw`size ${e} not yet implemented`}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class s{constructor(e){this._node=e}set_node(e){this._node=e}node(){return this._node}clone(){let e;const t=new this.constructor;return t.set_node(this.node()),null!=(e=this.content())&&t.set_content(e),t}reset_caches(){}set_content(e){this.reset_caches(),this._content=e,this._post_set_content()}has_content(){return null!=this._content}content(){return this._content}_post_set_content(){}core_content(){return this._content}core_content_cloned(){return this._content}infos(){return[]}}t.TypedContainer=s;t.BaseContainer=class extends s{}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(158),r=n(9),o=n(5),i=n(68);function a(e){return class extends e{constructor(){super(...arguments),this.skinning=o.ParamConfig.BOOLEAN(0)}}}t.SkinningParamConfig=a;r.Material;a(o.NodeParamsConfig);i.TypedMatNode;class _ extends s.BaseController{static update(e){const t=e.pv.skinning;t!=e.material.skinning&&(e.material.skinning=t,e.material.needsUpdate=!0)}}t.SkinningController=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),r=n(9),o=n(134),i=n(68),a=n(270),_=n(5);function c(e){return class extends e{constructor(){super(...arguments),this.use_map=_.ParamConfig.BOOLEAN(0,a.BooleanParamOptions(l)),this.map=_.ParamConfig.OPERATOR_PATH(o.FileCopNode.DEFAULT_NODE_PATH.UV,a.OperatorPathOptions(l,"use_map"))}}}t.TextureMapParamConfig=c;r.Material;c(_.NodeParamsConfig);i.TypedMatNode;class l extends a.BaseTextureMapController{constructor(e,t){super(e,t)}initialize_node(){this.add_hooks(this.node.p.use_map,this.node.p.map)}update(){return s.__awaiter(this,void 0,void 0,(function*(){this._update(this.node.material,"map",this.node.p.use_map,this.node.p.map)}))}static update(e){return s.__awaiter(this,void 0,void 0,(function*(){e.texture_map_controller.update()}))}}t.TextureMapController=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),r=n(9),o=n(134),i=n(68),a=n(270),_=n(5);function c(e){return class extends e{constructor(){super(...arguments),this.use_alpha_map=_.ParamConfig.BOOLEAN(0,a.BooleanParamOptions(l)),this.alpha_map=_.ParamConfig.OPERATOR_PATH(o.FileCopNode.DEFAULT_NODE_PATH.UV,a.OperatorPathOptions(l,"use_alpha_map"))}}}t.TextureAlphaMapParamConfig=c;r.Material;c(_.NodeParamsConfig);i.TypedMatNode;class l extends a.BaseTextureMapController{constructor(e,t){super(e,t)}initialize_node(){this.add_hooks(this.node.p.use_alpha_map,this.node.p.alpha_map)}update(){return s.__awaiter(this,void 0,void 0,(function*(){this._update(this.node.material,"alphaMap",this.node.p.use_alpha_map,this.node.p.alpha_map)}))}static update(e){return s.__awaiter(this,void 0,void 0,(function*(){e.texture_alpha_map_controller.update()}))}}t.TextureAlphaMapController=l},,,,,,,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.MapUtils=class{static push_on_array_at_entry(e,t,n){e.has(t)?e.get(t).push(n):e.set(t,[n])}static unshift_on_array_at_entry(e,t,n){e.has(t)?e.get(t).unshift(n):e.set(t,[n])}static concat_on_array_at_entry(e,t,n){if(e.has(t)){let s=e.get(t);for(let e of n)s.push(e)}else e.set(t,n)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CATEGORY_OBJ={LIGHT:"lights",MANAGER:"managers",GEOMETRY:"geometries",CAMERA:"cameras",MISC:"misc"},t.CATEGORY_COP={INPUT:"inputs",ADVANCED:"advanced",MISC:"misc"},t.CATEGORY_EVENT={CAMERA:"cameras",MISC:"misc"},t.CATEGORY_GL={COLOR:"color",CONVERSION:"conversion",DYNAMICS:"dynamics",GEOMETRY:"geometry",GLOBALS:"globals",LOGIC:"logic",MATH:"math",QUAT:"quat",TRIGO:"trigo",UTIL:"util",INSTANCE:"instance"},t.CATEGORY_MAT={ADVANCED:"advanced",MESH:"meshes",POINTS:"points",LINE:"lines",VOLUME:"volumes",INSTANCE:"instances"},t.CATEGORY_SOP={ADVANCED:"advanced",ANIMATION:"animation",ATTRIBUTE:"attributes",DYNAMICS:"dynamics",INPUT:"inputs",MISC:"misc",MODIFIER:"modifiers",PRIMITIVES:"primitives",RENDER:"render"},t.CATEGORY_POST={PASS:"passes"}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(81),r=n(640),o=n(113),i=n(27),a=n(94),_=n(70),c=n(0),l=["input texture","input texture","input texture","input texture"];for(var u=new Uint16Array(32),d=0;d<32;d++)u[d]=28898;const h=new _.DataTexture(u,32,1,c.LuminanceFormat,c.HalfFloatType);class p extends s.TypedNode{constructor(e){super(e,"BaseCopNode"),this.container_controller=new o.TypedContainerController(this,r.TextureContainer),this.flags=new a.FlagsControllerB(this)}static node_context(){return i.NodeContext.COP}static displayed_input_names(){return l}initialize_base_node(){this.io.outputs.set_has_one_output()}set_texture(e){e.name=this.full_path(),this.set_container(e)}clear_texture(){this.set_container(h)}}t.TypedCopNode=p;t.BaseCopNodeClass=class extends p{}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),r=s.__importDefault(n(643)),o=s.__importDefault(n(361)),i=s.__importDefault(n(342)),a=n(2),_=n(81),c=n(132),l=n(264);class u extends _.TypedNode{create_node(e){return super.create_node(e)}children(){return super.children()}nodes_by_type(e){return super.nodes_by_type(e)}}t.AssemblerControllerNode=u;t.GlAssemblerController=class{constructor(e,t){this.node=e,this._globals_handler=new c.GlobalsGeometryHandler,this._compile_required=!0,this._deleted_params_data=new Map,this._assembler=new t(this.node)}set_assembler_globals_handler(e){(this._globals_handler?this._globals_handler.id():null)!=(e?e.id():null)&&(this._globals_handler=e,this.set_compilation_required_and_dirty(),this._assembler.reset_configs())}get assembler(){return this._assembler}get globals_handler(){return this._globals_handler}add_output_params(e){this._assembler.add_output_params(e)}add_globals_params(e){this._assembler.add_globals_params(e)}allow_attribute_exports(){return this._assembler.allow_attribute_exports()}on_create(){const e=this.node.create_node("globals"),t=this.node.create_node("output");e.ui_data.set_position(new a.Vector2(-200,0)),t.ui_data.set_position(new a.Vector2(200,0))}set_compilation_required(e=!0){this._compile_required=e}set_compilation_required_and_dirty(e){this.set_compilation_required(),this.node.set_dirty(e)}compile_required(){return this._compile_required}post_compile(){return s.__awaiter(this,void 0,void 0,(function*(){this.create_spare_parameters(),this.set_compilation_required(!1)}))}assign_uniform_values(){return s.__awaiter(this,void 0,void 0,(function*(){if(this._assembler)for(let e of this._assembler.param_configs())yield e.set_uniform_value(this.node)}))}create_spare_parameters(){const e=this.node.params.spare_names,t=this._assembler.param_configs(),n=t.map(e=>e.name),s=i.default(n,e),a=i.default(e,n),_={},c=this.node.params.names,u=o.default(s,c);if(u.length>0){const e=`${this.node.full_path()} attempts to create spare params called '${u.join(", ")}' with same name as params`;console.warn(e),this.node.states.error.set(e)}a.forEach(e=>{const t=this.node.params.get(e);if(t){const e=l.JsonExportDispatcher.dispatch_param(t);if(e.required){const n=e.data();this._deleted_params_data.set(t.name,n)}}_.names_to_delete=_.names_to_delete||[],_.names_to_delete.push(e)});for(let e of t)if(s.indexOf(e.name)>=0){const t=r.default(e.param_options,{spare:!0,cook:!0});_.to_add=_.to_add||[],_.to_add.push({name:e.name,type:e.type,init_value:e.default_value,options:t})}this.node.params.update_params(_)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(362),r=n(263),o=n(29),i=n(128),a=n(50),_={position:"vec3( position )"};class c extends s.GlobalsBaseController{handle_globals_node(e,t,n){var s;const r=e.io.outputs.named_output_connection_points_by_name(t);if(!r)return;const i=e.gl_var_name(t),a=r.type,_=new o.VaryingGLDefinition(e,a,i);n.add_definitions(e,[_]);const c=null===(s=e.material_node)||void 0===s?void 0:s.assembler_controller.assembler;if(!c)return;const l=c.shader_config(n.current_shader_name);if(!l)return;const u=l.dependencies(),d=`${i} = ${a}(${t})`;for(let t of u)n.add_definitions(e,[_],t),n.add_body_lines(e,[d],t);0==u.length&&n.add_body_lines(e,[d])}static variable_config_default(e){return _[e]}variable_config_default(e){return c.variable_config_default(e)}read_attribute(e,t,n,s){return c.read_attribute(e,t,n,s)}static read_attribute(e,t,n,s){var _;c.PRE_DEFINED_ATTRIBUTES.indexOf(n)<0&&s.add_definitions(e,[new o.AttributeGLDefinition(e,t,n)],a.ShaderName.VERTEX);const l=s.current_shader_name;switch(l){case a.ShaderName.VERTEX:return n;case a.ShaderName.FRAGMENT:{if(!(e instanceof r.AttributeGlNode))return;const c="varying_"+e.gl_var_name(e.output_name),u=new o.VaryingGLDefinition(e,t,c),d=new Map;d.set(a.ShaderName.FRAGMENT,[]);const h=new Map;h.set(a.ShaderName.FRAGMENT,[]),i.MapUtils.push_on_array_at_entry(d,l,u);const p=`${c} = ${t}(${n})`,m=null===(_=e.material_node)||void 0===_?void 0:_.assembler_controller.assembler.shader_config(l);if(m){const t=m.dependencies();for(let e of t)i.MapUtils.push_on_array_at_entry(d,e,u),i.MapUtils.push_on_array_at_entry(h,e,p);d.forEach((t,n)=>{s.add_definitions(e,t,n)}),h.forEach((t,n)=>{s.add_body_lines(e,t,n)})}return c}}}handle_attribute_node(e,t,n,s){return c.read_attribute(e,t,n,s)}}t.GlobalsGeometryHandler=c,c.PRE_DEFINED_ATTRIBUTES=["position","color","normal","uv","uv2","morphTarget0","morphTarget1","morphTarget2","morphTarget3","skinIndex","skinWeight"],c.IF_RULE={uv:"defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )"}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(16),r=n(33);t.GlConnectionsController=class{constructor(e){this.node=e,this._input_name_function=e=>`in${e}`,this._output_name_function=e=>0==e?"val":`val${e}`,this._expected_input_types_function=()=>{const e=this.first_input_connection_type()||s.ConnectionPointType.FLOAT;return[e,e]},this._expected_output_types_function=()=>[this._expected_input_types_function()[0]],this._update_signature_if_required_bound=this.update_signature_if_required.bind(this),this._initialized=!1}set_input_name_function(e){this._input_name_function=e}set_output_name_function(e){this._output_name_function=e}set_expected_input_types_function(e){this._expected_input_types_function=e}set_expected_output_types_function(e){this._expected_output_types_function=e}output_name(e){return this._output_name_function(e)}initialize_node(){this._initialized?console.warn("already initialized",this.node):(this._initialized=!0,this.node.io.inputs.add_on_set_input_hook("_update_signature_if_required",this._update_signature_if_required_bound),this.node.params.add_on_scene_load_hook("_update_signature_if_required",this._update_signature_if_required_bound),this.node.params.set_post_create_params_hook(this._update_signature_if_required_bound),this.node.add_post_dirty_hook("_update_signature_if_required",this._update_signature_if_required_bound))}update_signature_if_required(e){this.node.lifecycle.creation_completed&&this._connections_match_inputs()||(this.update_connection_types(),this.node.remove_dirty_state(),this.make_successors_update_signatures())}make_successors_update_signatures(){for(let e of this.node.graph_all_successors()){const t=e;t.gl_connections_controller&&t.gl_connections_controller.update_signature_if_required(this.node)}}update_connection_types(){const e=this._expected_input_types_function(),t=this._expected_output_types_function(),n=e.map((e,t)=>new r.TypedNamedConnectionPoint(this._input_name_function(t),e)),s=t.map((e,t)=>new r.TypedNamedConnectionPoint(this._output_name_function(t),e));this.node.io.inputs.set_named_input_connection_points(n),this.node.io.outputs.set_named_output_connection_points(s,!1),this.node.spare_params_controller.create_spare_parameters()}_connections_match_inputs(){const e=this.node.io.inputs.named_input_connection_points.map(e=>e.type),t=this.node.io.outputs.named_output_connection_points.map(e=>e.type),n=this._expected_input_types_function(),s=this._expected_output_types_function();if(n.length!=e.length)return!1;if(s.length!=t.length)return!1;for(let t=0;t<e.length;t++)if(e[t]!=n[t])return!1;for(let e=0;e<t.length;e++)if(t[e]!=s[e])return!1;return!0}first_input_connection_type(){const e=this.node.io.connections.input_connections();if(e){const t=e[0];if(t)return this.connection_type_from_connection(t)}}connection_type_from_connection(e){const t=e.node_src,n=e.output_index;return t.io.outputs.named_output_connection_points[n].type}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),r=n(267),o=n(0),i=n(130),a=n(668),_=n(24),c=n(61),l=[{UVMapping:o.UVMapping},{CubeReflectionMapping:o.CubeReflectionMapping},{CubeRefractionMapping:o.CubeRefractionMapping},{EquirectangularReflectionMapping:o.EquirectangularReflectionMapping},{EquirectangularRefractionMapping:o.EquirectangularRefractionMapping},{SphericalReflectionMapping:o.SphericalReflectionMapping},{CubeUVReflectionMapping:o.CubeUVReflectionMapping},{CubeUVRefractionMapping:o.CubeUVRefractionMapping}],u=[{ClampToEdgeWrapping:o.ClampToEdgeWrapping},{RepeatWrapping:o.RepeatWrapping},{MirroredRepeatWrapping:o.MirroredRepeatWrapping}],d=[{LinearFilter:o.LinearFilter},{NearestFilter:o.NearestFilter}],h=[{NearestFilter:o.NearestFilter},{NearestMipMapNearestFilter:o.NearestMipMapNearestFilter},{NearestMipMapLinearFilter:o.NearestMipMapLinearFilter},{LinearFilter:o.LinearFilter},{LinearMipMapNearestFilter:o.LinearMipMapNearestFilter},{LinearMipMapLinearFilter:o.LinearMipMapLinearFilter}],p=["mapping","wrapS","wrapT","minFilter","magFilter"],m={mapping:"mapping",wrapS:"wrap_s",wrapT:"wrap_t",minFilter:"min_filter",magFilter:"mag_filter"},f=n(5);class g extends f.NodeParamsConfig{constructor(){super(...arguments),this.url=f.ParamConfig.STRING(a.CoreTextureLoader.PARAM_DEFAULT,{desktop_browse:{file_type:"texture"}}),this.reload=f.ParamConfig.BUTTON(null,{callback:(e,t)=>{y.PARAM_CALLBACK_reload(e,t)}}),this.mapping=f.ParamConfig.INTEGER(o.UVMapping,{menu:{entries:l.map(e=>({name:Object.keys(e)[0],value:Object.values(e)[0]}))}}),this.wrap_s=f.ParamConfig.INTEGER(Object.values(u[0])[0],{menu:{entries:u.map(e=>({name:Object.keys(e)[0],value:Object.values(e)[0]}))}}),this.wrap_t=f.ParamConfig.INTEGER(Object.values(u[0])[0],{menu:{entries:u.map(e=>({name:Object.keys(e)[0],value:Object.values(e)[0]}))}}),this.mag_filter=f.ParamConfig.INTEGER(Object.values(d[0])[0],{menu:{entries:d.map(e=>({name:Object.keys(e)[0],value:Object.values(e)[0]}))}}),this.min_filter=f.ParamConfig.INTEGER(Object.values(h[0])[0],{menu:{entries:h.map(e=>({name:Object.keys(e)[0],value:Object.values(e)[0]}))}})}}const v=new g;class y extends i.TypedCopNode{constructor(){super(...arguments),this.params_config=v}static type(){return"file"}cook(){return s.__awaiter(this,void 0,void 0,(function*(){this._is_static_image_url(this.pv.url)?yield this.cook_for_image():yield this.cook_for_video()}))}_is_static_image_url(e){return!0}cook_for_image(){return s.__awaiter(this,void 0,void 0,(function*(){const e=yield this._load_texture(this.pv.url);e?(this._update_texture_params(e),this.set_texture(e)):this.clear_texture()}))}cook_for_video(){return s.__awaiter(this,void 0,void 0,(function*(){if(this._param_url_changed()){const e=yield this._load_texture(this.pv.url);e&&this._add_video_spare_params_if_required(e),this._previous_param_url=this.pv.url,this._set_video_current_time(),e?(this._update_texture_params(e),this.set_texture(e)):this.cook_controller.end_cook()}}))}resolved_url(){return this.pv.url}_update_texture_params(e){for(let t of p){const n=m[t],s=this.params.float(n);null!=s&&e&&e[t]!=s&&(e[t]=s,e.needsUpdate=!0)}}static PARAM_CALLBACK_reload(e,t){e.param_callback_reload()}param_callback_reload(){this._previous_param_url=void 0,this.p.url.set_successors_dirty()}_set_video_current_time(){this._video&&this.params.has("video_time")&&(this._video.currentTime=this.params.float("video_time"))}_add_video_spare_params_if_required(e){if(e){if(e.constructor==r.VideoTexture){if(this._video=e.image,this._video&&!this.params.has_param(y.VIDEO_TIME_PARAM_NAME)){const e=this._video.duration;this.add_param(_.ParamType.FLOAT,y.VIDEO_TIME_PARAM_NAME,"$T",{spare:!0,cook:!0,range:[0,e],range_locked:[!0,!0]}),this.emit(c.NodeEvent.PARAMS_UPDATED)}}else this._remove_spare_params()}else this._remove_spare_params()}_remove_spare_params(){this.params.has_param(y.VIDEO_TIME_PARAM_NAME)&&this.params.update_params({names_to_delete:[y.VIDEO_TIME_PARAM_NAME]})}_param_url_changed(){return this._previous_param_url!=this.pv.url}_load_texture(e){return s.__awaiter(this,void 0,void 0,(function*(){let t=null;const n=this.params.get("url");if(e&&n){this._texture_loader=this._texture_loader||new a.CoreTextureLoader(this,n);try{t=yield this._texture_loader.load_texture_from_url_or_op(e)}catch(e){}t||this.states.error.set(`could not load texture '${e}'`)}else this.states.error.set("not url given to Mat/Base._load_texture");return t}))}}t.FileCopNode=y,y.VIDEO_TIME_PARAM_NAME="video_time",y.DEFAULT_NODE_PATH={UV:"/COP/file_uv",ENV_MAP:"/COP/env_map"}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),r=n(262),o=n(54),i=n(22),a=n(56),_=n(27),c=n(5);t.CameraBackgroundParamConfig=function(e){return class extends e{constructor(){super(...arguments),this.background=c.ParamConfig.FOLDER(),this.use_background=c.ParamConfig.BOOLEAN(0),this.use_material=c.ParamConfig.BOOLEAN(0,{visible_if:{use_background:!0}}),this.background_color=c.ParamConfig.COLOR([0,0,0],{visible_if:{use_background:!0,use_material:!1}}),this.background_material=c.ParamConfig.OPERATOR_PATH("",{visible_if:{use_background:!0,use_material:!0},node_selection:{context:_.NodeContext.MAT},dependent_on_found_node:!1}),this.background_ratio=c.ParamConfig.FLOAT(1,{visible_if:{use_background:!0,use_material:!0}})}}};t.BaseBackgroundController=class{constructor(e){this.node=e,this._bg_raycaster=new r.Raycaster}get screen_quad(){return this._screen_quad=this._screen_quad||this._create_screen_quad()}_create_screen_quad(){const e=new o.PlaneBufferGeometry(2,2,1,1),t=new i.Mesh(e);return this.node.object.add(t),t}screen_quad_flat_material(){return this._screen_quad_flat_material=this._screen_quad_flat_material||new a.MeshBasicMaterial}add_params(){}get use_background(){return this.node.params.boolean("use_background")}get use_background_material(){return this.use_background&&this.node.params.boolean("use_material")}get use_background_color(){return this.use_background&&!this.node.params.boolean("use_material")}get background_color(){return this.use_background_color?this.node.params.color("background_color"):null}update_screen_quad(){}update(){return s.__awaiter(this,void 0,void 0,(function*(){this.use_background?(this.update_screen_quad(),yield this.update_background_color(),this.use_background_material&&(yield this.update_background_material())):this._screen_quad&&this.node.object.remove(this._screen_quad)}))}update_background_color(){return s.__awaiter(this,void 0,void 0,(function*(){const e=this.screen_quad_flat_material();e.color=this.node.pv.background_color,this.screen_quad.material=e}))}update_background_material(){return s.__awaiter(this,void 0,void 0,(function*(){const e=this.node.p.background_material.found_node();if(e){yield e.request_container();const t=e.material;this.screen_quad.material=t}else this.node.states.error.set("bg node not found")}))}}},,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3).__importDefault(n(102)),r=n(0),o=n(70),i=n(282),a=n(93),_=n(606),c=n(24),l=n(103);class u extends a.TypedParam{constructor(){super(...arguments),this._reset_ramp_interpolant_and_texture_bound=this._reset_ramp_interpolant_and_texture.bind(this)}static type(){return c.ParamType.RAMP}get default_value_serialized(){return this.default_value instanceof _.RampValue?this.default_value.to_json():this.default_value}_clone_raw_input(e){return e instanceof _.RampValue?e.clone():_.RampValue.from_json(e).to_json()}get raw_input_serialized(){return this._raw_input instanceof _.RampValue?this._raw_input.to_json():_.RampValue.from_json(this._raw_input).to_json()}get value_serialized(){return this.value.to_json()}static are_raw_input_equal(e,t){return e instanceof _.RampValue?t instanceof _.RampValue?e.is_equal(t):e.is_equal_json(t):t instanceof _.RampValue?t.is_equal_json(e):_.RampValue.are_json_equal(e,t)}static are_values_equal(e,t){return e.is_equal(t)}initialize_param(){this.add_post_dirty_hook("_reset_ramp_interpolant_and_texture",this._reset_ramp_interpolant_and_texture_bound)}get is_default(){return this.default_value instanceof _.RampValue?this.value.is_equal(this.default_value):this.value.is_equal_json(this.default_value)}process_raw_input(){this._raw_input instanceof _.RampValue?this._value?this._value.copy(this._raw_input):this._value=this._raw_input:this._value?this._value.from_json(this._raw_input):this._value=_.RampValue.from_json(this._raw_input),this.emit_controller.emit(l.ParamEvent.VALUE_UPDATED)}has_expression(){return!1}_reset_ramp_interpolant_and_texture(){this._ramp_interpolant=void 0,this._ramp_texture=void 0}ramp_texture(){return this._ramp_texture=this._ramp_texture||this._create_ramp_texture()}_create_ramp_texture(){const e=new Uint8Array(3072);let t=0,n=0,s=0;for(var i=0;i<1024;i++)t=3*i,n=i/1024,s=this.value_at_position(n),e[t]=255*s;const a=new o.DataTexture(e,1024,1,r.RGBFormat);return a.needsUpdate=!0,a}static create_interpolant(e,t){const n=new Float32Array(1);return new i.CubicInterpolant(e,t,1,n)}interpolant(){return this._ramp_interpolant=this._ramp_interpolant||this._create_interpolant()}_create_interpolant(){const e=this.value.points,t=s.default(e,e=>e.position),n=new Float32Array(t.length),r=new Float32Array(t.length);let o=0;for(let e of t)n[o]=e.position,r[o]=e.value,o++;return u.create_interpolant(n,r)}value_at_position(e){return this.interpolant().evaluate(e)[0]}}t.RampParam=u,u.DEFAULT_VALUE=new _.RampValue(_.RampInterpolation.LINEAR,[new _.RampPoint(0,0),new _.RampPoint(1,1)]),u.DEFAULT_VALUE_JSON=u.DEFAULT_VALUE.to_json()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ParamJsonExporter=class{constructor(e){this._param=e,this._complex_data={}}get required(){const e=this._param.options.is_spare&&!this._param.parent_param,t=!this._param.is_default;return e||t}data(){if(this._param.parent_param)throw console.warn("no component should be saved"),"no component should be saved";return this._require_data_complex()?this._data_complex():this._data_simple()}_data_simple(){return this._param.raw_input_serialized}_data_complex(){if(this._complex_data={},this._param.options.is_spare&&!this._param.parent_param&&(this._complex_data.type=this._param.type,this._complex_data.default_value=this._param.default_value_serialized,this._complex_data.raw_input=this._param.raw_input_serialized,this._complex_data.options=this._param.options.current),this._param.is_default||this.add_main(),this._param.options.has_options_overridden){const e={},t=this._param.options.overridden_options;for(let n of Object.keys(t)){const s=t[n];e[n]=JSON.stringify(s)}this._complex_data.overriden_options=e}return this._complex_data}_require_data_complex(){return!!this._param.options.is_spare||!!this._param.options.has_options_overridden}add_main(){}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),r=n(2),o=n(266),i=n(194),a=n(195),_=n(658),c=n(132),l=n(663),u=n(50),d=n(24),h=n(33),p=n(16),m=n(365),f=n(263),g=new Map([[u.ShaderName.VERTEX,"#include <common>"],[u.ShaderName.FRAGMENT,"#include <common>"]]),v=new Map([[u.ShaderName.VERTEX,"#include <color_vertex>"],[u.ShaderName.FRAGMENT,"vec4 diffuseColor = vec4( diffuse, opacity );"]]),y=new Map([[u.ShaderName.VERTEX,["#include <begin_vertex>","#include <beginnormal_vertex>"]],[u.ShaderName.FRAGMENT,[]]]);class b extends l.TypedAssembler{constructor(e){super(),this._gl_parent_node=e,this._shaders_by_name=new Map,this._lines=new Map,this._root_nodes=[],this._leaf_nodes=[],this._uniforms_time_dependent=!1,this._resolution_dependent=!1}compile(){return s.__awaiter(this,void 0,void 0,(function*(){}))}_template_shader_for_shader_name(e){var t,n;switch(e){case u.ShaderName.VERTEX:return null===(t=this._template_shader)||void 0===t?void 0:t.vertexShader;case u.ShaderName.FRAGMENT:return null===(n=this._template_shader)||void 0===n?void 0:n.fragmentShader}}get globals_handler(){return this._gl_parent_node.assembler_controller.globals_handler}compile_allowed(){return null!=this._gl_parent_node.assembler_controller.globals_handler}shaders_by_name(){return this._shaders_by_name}_build_lines(){for(let e of this.shader_names){const t=this._template_shader_for_shader_name(e);t&&this._replace_template(t,e)}}set_root_nodes(e){this._root_nodes=e}get _template_shader(){}add_uniforms(e){for(let t of this.param_configs())e[t.uniform_name]=t.uniform;this.uniforms_time_dependent()&&(e.time={value:this._gl_parent_node.scene.time}),this.resolution_dependent()&&(e.resolution={value:new r.Vector2(1e3,1e3)})}root_nodes_by_shader_name(e){const t=[];for(let e of this._root_nodes)switch(e.type){case"output":t.push(e)}return t}leaf_nodes_by_shader_name(e){const t=[];for(let e of this._leaf_nodes)switch(e.type){case m.GlobalsGlNode.type():t.push(e);break;case f.AttributeGlNode.type():}return t}set_node_lines_globals(e,t){}set_node_lines_output(e,t){}set_node_lines_attribute(e,t){}get code_builder(){return this._code_builder=this._code_builder||new _.CodeBuilder(this,this._gl_parent_node)}build_code_from_nodes(e){return s.__awaiter(this,void 0,void 0,(function*(){yield this.code_builder.build_from_nodes(e)}))}allow_new_param_configs(){this.code_builder.allow_new_param_configs()}disallow_new_param_configs(){this.code_builder.disallow_new_param_configs()}builder_param_configs(){return this.code_builder.param_configs()}builder_lines(e,t){return this.code_builder.lines(e,t)}all_builder_lines(){return this.code_builder.all_lines()}param_configs(){return(this._param_config_owner||this.code_builder).param_configs()}set_param_configs_owner(e){this._param_config_owner=e,this._param_config_owner?this.code_builder.disallow_new_param_configs():this.code_builder.allow_new_param_configs()}static add_output_params(e){e.params.add_param(d.ParamType.VECTOR3,"position",[0,0,0],{hidden:!0}),e.params.add_param(d.ParamType.VECTOR3,"normal",[0,0,0],{hidden:!0}),e.params.add_param(d.ParamType.COLOR,"color",[1,1,1],{hidden:!0}),e.params.add_param(d.ParamType.FLOAT,"alpha",1,{hidden:!0}),e.params.add_param(d.ParamType.VECTOR2,"uv",[0,0],{hidden:!0})}add_output_params(e){b.add_output_params(e)}static create_globals_node_output_connections(){return[new h.TypedNamedConnectionPoint("position",p.ConnectionPointType.VEC3),new h.TypedNamedConnectionPoint("normal",p.ConnectionPointType.VEC3),new h.TypedNamedConnectionPoint("color",p.ConnectionPointType.VEC3),new h.TypedNamedConnectionPoint("uv",p.ConnectionPointType.VEC2),new h.TypedNamedConnectionPoint("gl_FragCoord",p.ConnectionPointType.VEC4),new h.TypedNamedConnectionPoint("resolution",p.ConnectionPointType.VEC2),new h.TypedNamedConnectionPoint("time",p.ConnectionPointType.FLOAT)]}create_globals_node_output_connections(){return b.create_globals_node_output_connections()}add_globals_params(e){e.io.outputs.set_named_output_connection_points(this.create_globals_node_output_connections())}allow_attribute_exports(){return!1}reset_configs(){this._reset_shader_configs(),this._reset_variable_configs(),this._reset_uniforms_time_dependency(),this._reset_resolution_dependency()}get shader_configs(){return this._shader_configs=this._shader_configs||this.create_shader_configs()}set_shader_configs(e){this._shader_configs=e}get shader_names(){var e;return(null===(e=this.shader_configs)||void 0===e?void 0:e.map(e=>e.name()))||[]}_reset_shader_configs(){this._shader_configs=void 0}create_shader_configs(){return[new i.ShaderConfig(u.ShaderName.VERTEX,["position","normal","uv"],[]),new i.ShaderConfig(u.ShaderName.FRAGMENT,["color","alpha"],[u.ShaderName.VERTEX])]}shader_config(e){var t;return null===(t=this.shader_configs)||void 0===t?void 0:t.filter(t=>t.name()==e)[0]}variable_configs(){return this._variable_configs=this._variable_configs||this.create_variable_configs()}set_variable_configs(e){this._variable_configs=e}variable_config(e){return this.variable_configs().filter(t=>t.name()==e)[0]}static create_variable_configs(){return[new a.VariableConfig("position",{default_from_attribute:!0,prefix:"vec3 transformed = "}),new a.VariableConfig("normal",{default_from_attribute:!0,prefix:"vec3 objectNormal = "}),new a.VariableConfig("color",{prefix:"diffuseColor.xyz = "}),new a.VariableConfig("alpha",{prefix:"diffuseColor.a = "}),new a.VariableConfig("uv",{prefix:"vUv = ",if:c.GlobalsGeometryHandler.IF_RULE.uv})]}create_variable_configs(){return b.create_variable_configs()}_reset_variable_configs(){this._variable_configs=void 0,this.variable_configs()}input_names_for_shader_name(e,t){var n;return(null===(n=this.shader_config(t))||void 0===n?void 0:n.input_names())||[]}_reset_uniforms_time_dependency(){this._uniforms_time_dependent=!1}set_uniforms_time_dependent(){this._uniforms_time_dependent=!0}uniforms_time_dependent(){return this._uniforms_time_dependent}_reset_resolution_dependency(){this._resolution_dependent=!1}set_resolution_dependent(){this._resolution_dependent=!0}resolution_dependent(){return this._resolution_dependent}insert_define_after(e){return g.get(e)}insert_body_after(e){return v.get(e)}lines_to_remove(e){return y.get(e)}_replace_template(e,t){const n=this.builder_lines(t,o.LineType.FUNCTION_DECLARATION),s=this.builder_lines(t,o.LineType.DEFINE),r=this.builder_lines(t,o.LineType.BODY);let i=e.split("\n");const a=[],_=this.insert_define_after(t),c=this.insert_body_after(t),l=this.lines_to_remove(t);let u=!1,d=!1;for(let e of i){1==u&&(n&&this._insert_lines(a,n),s&&this._insert_lines(a,s),u=!1),1==d&&(r&&this._insert_lines(a,r),d=!1);let t=!1;if(l)for(let n of l)e.indexOf(n)>=0&&(t=!0);t?(a.push("// removed:"),a.push(`//${e}`)):a.push(e),_&&e.indexOf(_)>=0&&(u=!0),c&&e.indexOf(c)>=0&&(d=!0)}this._lines.set(t,a)}_insert_lines(e,t){if(t.length>0){for(let t=0;t<3;t++)e.push("");for(let n of t)e.push(n);for(let t=0;t<3;t++)e.push("")}}get_custom_materials(){return s.__awaiter(this,void 0,void 0,(function*(){return new Map}))}}t.BaseGlShaderAssembler=b},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.BaseController=class{constructor(e){this.node=e}add_params(){}update(){}get material(){return this.node.material}}},,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3).__importDefault(n(21));var r;!function(e){e.customDistanceMaterial="customDistanceMaterial",e.customDepthMaterial="customDepthMaterial",e.customDepthDOFMaterial="customDepthDOFMaterial"}(r||(r={}));t.CoreMaterial=class{static node(e,t){return e.node(t.name)}static clone(e){return s.default(e)?e.map(e=>this.clone_single(e)):this.clone_single(e)}static clone_single(e){const t=e.clone();return t.linewidth=e.linewidth,t}static apply_custom_materials(e,t){const n=t;if(n.custom_materials)for(let t of Object.keys(n.custom_materials)){const s=t,r=n.custom_materials[s];r&&(e[s]=r,r.needsUpdate=!0)}}static assign_custom_uniforms(e,t,n){const s=e;if(s.custom_materials)for(let e of Object.keys(s.custom_materials)){const r=e,o=s.custom_materials[r];o&&(o.uniforms[t].value=n)}}static init_custom_material_uniforms(e,t,n){const s=e;if(s.custom_materials)for(let e of Object.keys(s.custom_materials)){const r=e,o=s.custom_materials[r];o&&(o.uniforms[t]=o.uniforms[t]||n)}}}},,,,,,function(e,t,n){"use strict";n.d(t,"a",(function(){return F}));var s={},r=void 0,o=s;function i(e,t){var n,s=e.split("."),i=o;!(s[0]in i)&&i.execScript&&i.execScript("var "+s[0]);for(;s.length&&(n=s.shift());)s.length||t===r?i=i[n]?i[n]:i[n]={}:i[n]=t}var a="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array&&"undefined"!=typeof DataView;function _(e){var t,n,s,r,o,i,_,c,l,u,d=e.length,h=0,p=Number.POSITIVE_INFINITY;for(c=0;c<d;++c)e[c]>h&&(h=e[c]),e[c]<p&&(p=e[c]);for(t=1<<h,n=new(a?Uint32Array:Array)(t),s=1,r=0,o=2;s<=h;){for(c=0;c<d;++c)if(e[c]===s){for(i=0,_=r,l=0;l<s;++l)i=i<<1|1&_,_>>=1;for(u=s<<16|c,l=i;l<t;l+=o)n[l]=u;++r}++s,r<<=1,o<<=1}return[n,h,p]}function c(e,t){switch(this.g=[],this.h=32768,this.d=this.f=this.a=this.l=0,this.input=a?new Uint8Array(e):e,this.m=!1,this.i=u,this.r=!1,!t&&(t={})||(t.index&&(this.a=t.index),t.bufferSize&&(this.h=t.bufferSize),t.bufferType&&(this.i=t.bufferType),t.resize&&(this.r=t.resize)),this.i){case l:this.b=32768,this.c=new(a?Uint8Array:Array)(32768+this.h+258);break;case u:this.b=0,this.c=new(a?Uint8Array:Array)(this.h),this.e=this.z,this.n=this.v,this.j=this.w;break;default:throw Error("invalid inflate mode")}}var l=0,u=1,d={t:l,s:u};c.prototype.k=function(){for(;!this.m;){var e=S(this,3);switch(1&e&&(this.m=!0),e>>>=1){case 0:var t=this.input,n=this.a,s=this.c,o=this.b,i=t.length,c=r,d=s.length,h=r;if(this.d=this.f=0,n+1>=i)throw Error("invalid uncompressed block header: LEN");if(c=t[n++]|t[n++]<<8,n+1>=i)throw Error("invalid uncompressed block header: NLEN");if(c===~(t[n++]|t[n++]<<8))throw Error("invalid uncompressed block header: length verify");if(n+c>t.length)throw Error("input buffer is broken");switch(this.i){case l:for(;o+c>s.length;){if(c-=h=d-o,a)s.set(t.subarray(n,n+h),o),o+=h,n+=h;else for(;h--;)s[o++]=t[n++];this.b=o,s=this.e(),o=this.b}break;case u:for(;o+c>s.length;)s=this.e({p:2});break;default:throw Error("invalid inflate mode")}if(a)s.set(t.subarray(n,n+c),o),o+=c,n+=c;else for(;c--;)s[o++]=t[n++];this.a=n,this.b=o,this.c=s;break;case 1:this.j(A,M);break;case 2:var p,m,g,v,y=S(this,5)+257,b=S(this,5)+1,x=S(this,4)+4,T=new(a?Uint8Array:Array)(f.length),C=r,P=r,w=r,E=r,O=r;for(O=0;O<x;++O)T[f[O]]=S(this,3);if(!a)for(O=x,x=T.length;O<x;++O)T[f[O]]=0;for(p=_(T),C=new(a?Uint8Array:Array)(y+b),O=0,v=y+b;O<v;)switch(P=R(this,p),P){case 16:for(E=3+S(this,2);E--;)C[O++]=w;break;case 17:for(E=3+S(this,3);E--;)C[O++]=0;w=0;break;case 18:for(E=11+S(this,7);E--;)C[O++]=0;w=0;break;default:w=C[O++]=P}m=_(a?C.subarray(0,y):C.slice(0,y)),g=_(a?C.subarray(y):C.slice(y)),this.j(m,g);break;default:throw Error("unknown BTYPE: "+e)}}return this.n()};var h,p,m=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],f=a?new Uint16Array(m):m,g=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,258,258],v=a?new Uint16Array(g):g,y=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0],b=a?new Uint8Array(y):y,x=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],T=a?new Uint16Array(x):x,C=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],P=a?new Uint8Array(C):C,w=new(a?Uint8Array:Array)(288);for(h=0,p=w.length;h<p;++h)w[h]=143>=h?8:255>=h?9:279>=h?7:8;var E,O,A=_(w),N=new(a?Uint8Array:Array)(30);for(E=0,O=N.length;E<O;++E)N[E]=5;var M=_(N);function S(e,t){for(var n,s=e.f,r=e.d,o=e.input,i=e.a,a=o.length;r<t;){if(i>=a)throw Error("input buffer is broken");s|=o[i++]<<r,r+=8}return n=s&(1<<t)-1,e.f=s>>>t,e.d=r-t,e.a=i,n}function R(e,t){for(var n,s,r=e.f,o=e.d,i=e.input,a=e.a,_=i.length,c=t[0],l=t[1];o<l&&!(a>=_);)r|=i[a++]<<o,o+=8;if((s=(n=c[r&(1<<l)-1])>>>16)>o)throw Error("invalid code length: "+s);return e.f=r>>s,e.d=o-s,e.a=a,65535&n}function j(e,t){var n,s;switch(this.input=e,this.a=0,!t&&(t={})||(t.index&&(this.a=t.index),t.verify&&(this.A=t.verify)),n=e[this.a++],s=e[this.a++],15&n){case L:this.method=L;break;default:throw Error("unsupported compression method")}if(0!=((n<<8)+s)%31)throw Error("invalid fcheck flag:"+((n<<8)+s)%31);if(32&s)throw Error("fdict flag is not supported");this.q=new c(e,{index:this.a,bufferSize:t.bufferSize,bufferType:t.bufferType,resize:t.resize})}c.prototype.j=function(e,t){var n=this.c,s=this.b;this.o=e;for(var r,o,i,a,_=n.length-258;256!==(r=R(this,e));)if(256>r)s>=_&&(this.b=s,n=this.e(),s=this.b),n[s++]=r;else for(a=v[o=r-257],0<b[o]&&(a+=S(this,b[o])),r=R(this,t),i=T[r],0<P[r]&&(i+=S(this,P[r])),s>=_&&(this.b=s,n=this.e(),s=this.b);a--;)n[s]=n[s++-i];for(;8<=this.d;)this.d-=8,this.a--;this.b=s},c.prototype.w=function(e,t){var n=this.c,s=this.b;this.o=e;for(var r,o,i,a,_=n.length;256!==(r=R(this,e));)if(256>r)s>=_&&(_=(n=this.e()).length),n[s++]=r;else for(a=v[o=r-257],0<b[o]&&(a+=S(this,b[o])),r=R(this,t),i=T[r],0<P[r]&&(i+=S(this,P[r])),s+a>_&&(_=(n=this.e()).length);a--;)n[s]=n[s++-i];for(;8<=this.d;)this.d-=8,this.a--;this.b=s},c.prototype.e=function(){var e,t,n=new(a?Uint8Array:Array)(this.b-32768),s=this.b-32768,r=this.c;if(a)n.set(r.subarray(32768,n.length));else for(e=0,t=n.length;e<t;++e)n[e]=r[e+32768];if(this.g.push(n),this.l+=n.length,a)r.set(r.subarray(s,s+32768));else for(e=0;32768>e;++e)r[e]=r[s+e];return this.b=32768,r},c.prototype.z=function(e){var t,n,s,r=this.input.length/this.a+1|0,o=this.input,i=this.c;return e&&("number"==typeof e.p&&(r=e.p),"number"==typeof e.u&&(r+=e.u)),2>r?n=(s=(o.length-this.a)/this.o[2]/2*258|0)<i.length?i.length+s:i.length<<1:n=i.length*r,a?(t=new Uint8Array(n)).set(i):t=i,this.c=t},c.prototype.n=function(){var e,t,n,s,r,o=0,i=this.c,_=this.g,c=new(a?Uint8Array:Array)(this.l+(this.b-32768));if(0===_.length)return a?this.c.subarray(32768,this.b):this.c.slice(32768,this.b);for(t=0,n=_.length;t<n;++t)for(s=0,r=(e=_[t]).length;s<r;++s)c[o++]=e[s];for(t=32768,n=this.b;t<n;++t)c[o++]=i[t];return this.g=[],this.buffer=c},c.prototype.v=function(){var e,t=this.b;return a?this.r?(e=new Uint8Array(t)).set(this.c.subarray(0,t)):e=this.c.subarray(0,t):(this.c.length>t&&(this.c.length=t),e=this.c),this.buffer=e},j.prototype.k=function(){var e,t,n=this.input;if(e=this.q.k(),this.a=this.q.a,this.A){t=(n[this.a++]<<24|n[this.a++]<<16|n[this.a++]<<8|n[this.a++])>>>0;var s=e;if("string"==typeof s){var r,o,i=s.split("");for(r=0,o=i.length;r<o;r++)i[r]=(255&i[r].charCodeAt(0))>>>0;s=i}for(var a,_=1,c=0,l=s.length,u=0;0<l;){l-=a=1024<l?1024:l;do{c+=_+=s[u++]}while(--a);_%=65521,c%=65521}if(t!==(c<<16|_)>>>0)throw Error("invalid adler-32 checksum")}return e};var L=8;i("Zlib.Inflate",j),i("Zlib.Inflate.prototype.decompress",j.prototype.k);var k,G,z,I,D={ADAPTIVE:d.s,BLOCK:d.t};if(Object.keys)k=Object.keys(D);else for(G in k=[],z=0,D)k[z++]=G;for(z=0,I=k.length;z<I;++z)i("Zlib.Inflate.BufferType."+(G=k[z]),D[G]);var F=s.Zlib},,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(81),r=n(619),o=n(27),i=n(113);class a extends s.TypedNode{constructor(){super(...arguments),this.container_controller=new i.TypedContainerController(this,r.EventContainer),this._eval_all_params_on_dirty_bound=this._eval_all_params_on_dirty.bind(this)}static node_context(){return o.NodeContext.EVENT}initialize_base_node(){this.io.connections.init_inputs(),this.ui_data.set_layout_horizontal(),this.add_post_dirty_hook("_eval_all_params_on_dirty",this._eval_all_params_on_dirty_bound)}_eval_all_params_on_dirty(){this.params.eval_all()}process_event(e,t,n){}}t.TypedEventNode=a;t.BaseEventNodeClass=class extends a{}},,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),r=s.__importDefault(n(48)),o=s.__importDefault(n(21)),i=n(93),a=n(347),_=n(103);class c extends i.TypedParam{get is_numeric(){return!0}get is_default(){return this._raw_input==this.default_value}_prefilter_invalid_raw_input(e){return o.default(e)?e[0]:e}process_raw_input(){this.states.error.clear();const e=this.convert(this._raw_input);null!=e?(this._expression_controller&&(this._expression_controller.set_expression(void 0,!1),this.emit_controller.emit(_.ParamEvent.EXPRESSION_UPDATED)),e!=this._value&&(this._update_value(e),this.set_successors_dirty(this))):r.default(this._raw_input)?(this._expression_controller=this._expression_controller||new a.ExpressionController(this),this._raw_input!=this._expression_controller.expression&&(this._expression_controller.set_expression(this._raw_input),this.emit_controller.emit(_.ParamEvent.EXPRESSION_UPDATED))):this.states.error.set(`param input is invalid (${this.full_path()})`)}process_computation(){var e;return s.__awaiter(this,void 0,void 0,(function*(){if((null===(e=this.expression_controller)||void 0===e?void 0:e.active)&&!this.expression_controller.requires_entities){const e=yield this.expression_controller.compute_expression();if(this.expression_controller.is_errored)this.states.error.set(`expression error: "${this.expression_controller.expression}" (${this.expression_controller.error_message})`);else{const t=this.convert(e);null!=t?(this.states.error.active&&this.states.error.clear(),this._update_value(t)):this.states.error.set(`expression returns an invalid type (${e}) (${this.expression_controller.expression})`)}}}))}_update_value(e){this._value=e,this.parent_param&&this.parent_param.set_value_from_components(),this.options.execute_callback(),this.emit_controller.emit(_.ParamEvent.VALUE_UPDATED),this.remove_dirty_state()}}t.TypedNumericParam=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),r=s.__importDefault(n(21)),o=n(93),i=n(351),a=n(103);class _ extends o.TypedParam{constructor(){super(...arguments),this._components_contructor=i.FloatParam}get components(){return this._components}get is_numeric(){return!0}get is_default(){for(let e of this.components)if(!e.is_default)return!1;return!0}get raw_input(){return this._components.map(e=>e.raw_input)}get raw_input_serialized(){return this.raw_input}init_components(){if(null!=this._components)return;let e=0;this._components=new Array(this.component_names.length);for(let t of this.component_names){const n=new this._components_contructor(this.scene);let s;s=r.default(this._default_value)?this._default_value[e]:this._default_value[t],n.options.copy(this.options),n.set_init_value(s),n.set_name(`${this.name}${t}`),n.set_parent_param(this),this.add_graph_input(n),this._components[e]=n,e++}}process_computation(){return s.__awaiter(this,void 0,void 0,(function*(){yield this.compute_components(),this.set_value_from_components()}))}set_value_from_components(){}has_expression(){var e;for(let t of this.components)if(null===(e=t.expression_controller)||void 0===e?void 0:e.active)return!0;return!1}compute_components(){return s.__awaiter(this,void 0,void 0,(function*(){const e=this.components,t=[];for(let n of e)n.is_dirty&&t.push(n.compute());yield Promise.all(t),this.remove_dirty_state()}))}_prefilter_invalid_raw_input(e){if(r.default(e))return e;{const t=e;return this.components.map(()=>t)}}process_raw_input(){const e=this.scene.cooker;e.block();const t=this.components;for(let e of t)e.emit_controller.block_parent_emit();const n=this._raw_input;if(r.default(n))for(let e=0;e<t.length;e++)t[e].set(n[e]);else for(let e=0;e<t.length;e++){const s=this.component_names[e];t[e].set(n[s])}e.unblock();for(let e=0;e<t.length;e++)t[e].emit_controller.unblock_parent_emit();this.emit_controller.emit(a.ParamEvent.VALUE_UPDATED)}}t.TypedMultipleParam=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.TypeAssert=class{static unreachable(e){throw new Error("Didn't expect to get here")}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ShaderConfig=class{constructor(e,t,n){this._name=e,this._input_names=t,this._dependencies=n}name(){return this._name}input_names(){return this._input_names}dependencies(){return this._dependencies}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.VariableConfig=class{constructor(e,t={}){this._name=e,this._options=t}name(){return this._name}default_from_attribute(){return this._options.default_from_attribute||!1}default(){return this._options.default}if_condition(){return this._options.if}prefix(){return this._options.prefix||""}suffix(){return this._options.suffix||""}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(659);t.ParamConfigsController=class{constructor(){this._param_configs=[]}reset(){this._param_configs=[]}push(e){this._param_configs.push(e)}create_and_push(e,t,n,r){const o=new s.ParamConfig(e,t,n,r);this._param_configs.push(o)}get list(){return this._param_configs}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(158),r=n(68),o=n(9),i=n(5);function a(e){return class extends e{constructor(){super(...arguments),this.color=i.ParamConfig.COLOR([1,1,1]),this.use_vertex_colors=i.ParamConfig.BOOLEAN(0),this.transparent=i.ParamConfig.BOOLEAN(0),this.opacity=i.ParamConfig.FLOAT(1),this.alpha_test=i.ParamConfig.FLOAT(0),this.use_fog=i.ParamConfig.BOOLEAN(0)}}}t.ColorParamConfig=a;o.Material;a(i.NodeParamsConfig);r.TypedMatNode;class _ extends s.BaseController{static update(e){const t=e.material,n=e.pv;t.color.copy(n.color);const s=n.use_vertex_colors;s!=t.vertexColors&&(t.vertexColors=s,t.needsUpdate=!0),t.opacity=n.opacity,t.transparent=n.transparent||n.opacity<1,t.depthTest=!0,t.alphaTest=n.alpha_test,t.fog=n.use_fog}}t.ColorsController=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(158),r=n(68),o=n(9),i=n(5);function a(e){return class extends e{constructor(){super(...arguments),this.transparent=i.ParamConfig.BOOLEAN(0),this.opacity=i.ParamConfig.FLOAT(1),this.alpha_test=i.ParamConfig.FLOAT(0),this.use_fog=i.ParamConfig.BOOLEAN(0)}}}t.ColorParamConfig=a;o.Material;a(i.NodeParamsConfig);r.TypedMatNode;class _ extends s.BaseController{static update(e){const t=e.material,n=e.pv;t.uniforms.opacity&&(t.uniforms.opacity.value=n.opacity),t.transparent=n.transparent||n.opacity<1,t.depthTest=!0,t.alphaTest=n.alpha_test,t.fog=n.use_fog}}t.ColorsController=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),r=n(68),o=n(27);class i extends r.TypedMatNode{constructor(){super(...arguments),this._children_controller_context=o.NodeContext.GL}initialize_base_node(){var e;super.initialize_base_node(),this.lifecycle.add_on_create_hook(this.assembler_controller.on_create.bind(this.assembler_controller)),null===(e=this.children_controller)||void 0===e||e.init()}create_material(){return this.assembler_controller.assembler.create_material()}get assembler_controller(){return this._assembler_controller=this._assembler_controller||this._create_assembler_controller()}create_node(e){return super.create_node(e)}children(){return super.children()}nodes_by_type(e){return super.nodes_by_type(e)}compile_if_required(){return s.__awaiter(this,void 0,void 0,(function*(){this.assembler_controller.compile_required()&&this._compile()}))}_compile(){return s.__awaiter(this,void 0,void 0,(function*(){this.material&&(yield this.assembler_controller.assembler.compile_material(this.material),yield this.assembler_controller.post_compile())}))}}t.TypedBuilderMatNode=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(272),r=n(5),o=n(84),i=n(94);o.TransformedParamConfig(r.NodeParamsConfig);class a extends s.TypedLightObjNode{constructor(){super(...arguments),this.flags=new i.FlagsControllerD(this),this.transform_controller=new o.TransformController(this)}initialize_base_node(){super.initialize_base_node(),this.transform_controller.initialize_node()}cook(){this.transform_controller.update(),this.update_light_params(),this.update_shadow_params(),this.cook_controller.end_cook()}}t.BaseLightTransformedObjNode=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(22),r=n(56),o=n(5),i=n(69),a=n(94);function _(e){return class extends e{constructor(){super(...arguments),this.show_helper=o.ParamConfig.BOOLEAN(1),this.helper_size=o.ParamConfig.FLOAT(1,{visible_if:{show_helper:1}})}}}t.BaseLightHelperParamConfig=_;_(o.NodeParamsConfig);class c extends i.TypedObjNode{constructor(){super(...arguments),this.flags=new a.FlagsControllerD(this)}}t.BaseLightHelperObjNode=c;t.BaseLightHelper=class{constructor(e,t){this.node=e,this._name=t,this._object=new s.Mesh,this._material=new r.MeshBasicMaterial({wireframe:!0,fog:!1})}build(){this._object.name=this._name,this.build_helper()}get object(){return this._object}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.HelperController=class{constructor(e,t,n){this.node=e,this._helper_constructor=t,this._name=n}initialize_node(){this.node.flags.display.add_hook(()=>{this.update_helper_attachment()})}update_helper_attachment(){var e,t,n;if(this.node.flags.display.active){const n=null===(e=this.helper)||void 0===e?void 0:e.object;n&&(this.node.object.add(n),null===(t=this._helper)||void 0===t||t.update())}else{const e=null===(n=this._helper)||void 0===n?void 0:n.object;e&&this.node.object.remove(e)}}get helper(){if(this.node.flags.display.active)return this._helper=this._helper||this._create_helper()}get visible(){return this.node.flags.display.active&&this.node.pv.show_helper}_create_helper(){const e=new this._helper_constructor(this.node,this._name);return e.build(),this.node.light.add(e.object),e}update(){this.visible?(this._helper||(this._helper=this._create_helper()),this._helper&&(this._helper.object.visible=!0,this._helper.update())):this._helper&&(this._helper.object.visible=!1)}}},,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(69),r=n(40),o=n(5);o.NodeParamsConfig;class i extends s.TypedObjNode{constructor(){super(...arguments),this._attachable_to_hierarchy=!1}create_object(){return new r.Group}cook(){this.cook_controller.end_cook()}}t.BaseManagerObjNode=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(5);t.LayerParamConfig=function(e){return class extends e{constructor(){super(...arguments),this.layer=s.ParamConfig.INTEGER(0,{range:[0,31],range_locked:[!0,!0]})}}};t.LayersController=class{constructor(e){this.node=e}update(){const e=this.node.object;e.layers.set(0),e.layers.enable(this.node.params.integer("layer"))}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),r=n(408),o=n(0),i=n(2),a=s.__importDefault(n(82)),_=n(1004),c=n(811),l=n(27),u=n(67);function d(e){return{node_selection:{context:l.NodeContext.POST},visible_if:{do_post_process:1,[`use_post_process_node${e}`]:1}}}const h=n(5);t.CameraPostProcessParamConfig=function(e){return class extends e{constructor(){super(...arguments),this.post_process=h.ParamConfig.FOLDER(),this.do_post_process=h.ParamConfig.BOOLEAN(0),this.use_post_process_node0=h.ParamConfig.BOOLEAN(0,{visible_if:{do_post_process:1}}),this.post_process_node0=h.ParamConfig.OPERATOR_PATH("",d(0)),this.use_post_process_node1=h.ParamConfig.BOOLEAN(0,{visible_if:{do_post_process:1}}),this.post_process_node1=h.ParamConfig.OPERATOR_PATH("",d(1)),this.use_post_process_node2=h.ParamConfig.BOOLEAN(0,{visible_if:{do_post_process:1}}),this.post_process_node2=h.ParamConfig.OPERATOR_PATH("",d(2)),this.use_post_process_node3=h.ParamConfig.BOOLEAN(0,{visible_if:{do_post_process:1}}),this.post_process_node3=h.ParamConfig.OPERATOR_PATH("",d(3))}}};t.PostProcessController=class{constructor(e){this.node=e,this._renderers_by_canvas_id={},this._composers_by_canvas_id={},this._resolution_by_canvas_id={},this._composers_set_in_progress_by_canvas_id={},this._fetch_post_process_nodes_in_progress=!1,this._post_process_nodes=[],this._post_process_use_node_path_params=[],this._post_process_node_path_params=[]}render(e,t,n){const s=this.renderer(e);if(s)if(this.node.pv.do_post_process){const n=this.composer(e);n&&(n.setSize(t.x,t.y),n.render())}else this.node.setup_for_aspect_ratio(n),s.render(this.node.scene.default_scene,this.node.object)}renderer(e){return this._renderers_by_canvas_id[e.id]}create_renderer(e,t){const n=u.POLY.renderers_controller.rendering_context(e),s=new r.WebGLRenderer({canvas:e,antialias:!0,alpha:!0,context:n});return s.shadowMap.enabled=!0,s.physicallyCorrectLights=!0,s.toneMapping=o.ACESFilmicToneMapping,s.toneMappingExposure=1,s.outputEncoding=o.sRGBEncoding,u.POLY.renderers_controller.register_renderer(s),this._renderers_by_canvas_id[e.id]=s,this.set_renderer_size(e,t),s.setPixelRatio(window.devicePixelRatio),s}delete_renderer(e){const t=this.renderer(e);t&&u.POLY.renderers_controller.deregister_renderer(t)}set_renderer_size(e,t){this._resolution_by_canvas_id[e.id]=this._resolution_by_canvas_id[e.id]||new i.Vector2,this._resolution_by_canvas_id[e.id].copy(t);const n=this.renderer(e);n&&n.setSize(t.x,t.y);const s=this.composer(e);s&&s.setSize(t.x,t.y)}composer(e){return this._composers_by_canvas_id[e.id]=this._composers_by_canvas_id[e.id]||this._create_composer(e)}_create_composer(e){const t=this.renderer(e);if(t){const n=new _.EffectComposer(t);return n.setPixelRatio(2*window.devicePixelRatio),this.set_composer_passes(e.id,n,t),n}}update_composer_passes(){return s.__awaiter(this,void 0,void 0,(function*(){if(this.node.pv.do_post_process){if(this._post_process_nodes=[],this._fetch_post_process_nodes_in_progress)return;if(this._fetch_post_process_nodes_in_progress=!0,this.composer_passes_nodes_changed()){this._post_process_nodes=[];for(let e of a.default(4)){if(this._post_process_use_node_path_params[e].value){const t=this._post_process_node_path_params[e].found_node();t&&(yield t.request_container(),this._post_process_nodes.push(t))}}this.set_composers_passes()}this._fetch_post_process_nodes_in_progress=!1}else this._post_process_nodes=[]}))}set_composers_passes(){const e=Object.keys(this._composers_by_canvas_id);for(let t of e){const e=this._composers_by_canvas_id[t],n=this._renderers_by_canvas_id[t];e&&this.set_composer_passes(t,e,n)}}set_composer_passes(e,t,n){if(this._composers_set_in_progress_by_canvas_id[e])return;this._composers_set_in_progress_by_canvas_id[e]=!0,this.clear_render_passes(t);const s=new c.RenderPass(this.node.scene.default_scene,this.node.object);s.clearAlpha=0,t.addPass(s);for(let n of this._post_process_nodes)n.apply_to_composer(t,this.node.object,this._resolution_by_canvas_id[e],this.node);delete this._composers_set_in_progress_by_canvas_id[e]}clear_render_passes(e){let t;for(;t=e.passes.pop();)if(t){const e=t;if("function"==typeof e.dispose)try{e.dispose()}catch(e){console.warn(e)}}e.passes=[]}composer_passes_nodes_changed(){return!0}}},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3).__importDefault(n(154)),r=n(60),o=n(61);t.NameController=class{constructor(e){this.node=e,this._graph_node=new r.CoreGraphNode(e.scene,"node_name_controller")}get graph_node(){return this._graph_node}static base_name(e){let t=e.type;const n=t[t.length-1];return s.default(parseInt(n))||(t+="_"),`${t}1`}request_name_to_parent(e){const t=this.node.parent;t&&t.children_allowed()&&t.children_controller?t.children_controller.set_child_name(this.node,e):console.warn("request_name_to_parent failed, no parent found")}set_name(e){e!=this.node.name&&this.request_name_to_parent(e)}update_name_from_parent(e){var t;this.node._set_core_name(e),this.post_set_name(),this.post_set_full_path(),this.node.children_allowed()&&(null===(t=this.node.children_controller)||void 0===t||t.children().forEach(e=>{e.name_controller.post_set_full_path()})),this.node.lifecycle.creation_completed&&(this.node.scene.missing_expression_references_controller.check_for_missing_references(this.node),this.node.scene.expressions_controller.regenerate_referring_expressions(this.node)),this.node.emit(o.NodeEvent.NAME_UPDATED)}add_post_set_name_hook(e){this._on_set_name_hooks=this._on_set_name_hooks||[],this._on_set_name_hooks.push(e)}add_post_set_full_path_hook(e){this._on_set_full_path_hooks=this._on_set_full_path_hooks||[],this._on_set_full_path_hooks.push(e)}post_set_name(){if(this._on_set_name_hooks)for(let e of this._on_set_name_hooks)e()}post_set_full_path(){if(this._on_set_full_path_hooks)for(let e of this._on_set_full_path_hooks)e()}}},,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),r=s.__importDefault(n(92)),o=s.__importDefault(n(190)),i=s.__importDefault(n(343)),a=n(24),_=n(103),c=n(60);!function(e){e.TYPESCRIPT="typescript"}(t.StringParamLanguage||(t.StringParamLanguage={}));t.OptionsController=class{constructor(e){this._param=e,this._programatic_visible_state=!0,this._update_visibility_and_remove_dirty_bound=this.update_visibility_and_remove_dirty.bind(this),this._ui_data_dependency_set=!1}set(e){this._default_options=e,this._options=o.default(this._default_options)}copy(e){this._default_options=o.default(e.default),this._options=o.default(e.current)}set_option(e,t){return Object.assign(this._options,e,t)}get param(){return this._param}get node(){return this._param.node}get default(){return this._default_options}get current(){return this._options}get has_options_overridden(){return!i.default(this._options,this._default_options)}get overridden_options(){const e={},t=Object.keys(this._options);for(let n of t)i.default(this._options[n],this._default_options[n])||Object.assign(e,n,o.default(this._options[n]));return e}get overridden_option_names(){return Object.keys(this.overridden_options)}get always_reference_asset(){return this._options.always_reference_asset||!1}has_callback(){return null!=this._options.callback||null!=this._options.callback_string}execute_callback(){if(!this.node||!this.node.scene.loading_controller.loaded)return;const e=this.get_callback();null!=e&&this.node&&!this.node.cook_controller.is_cooking&&e(this.node,this.param)}get_callback(){if(this.has_callback())return this._options.callback=this._options.callback||this.create_callback_from_string()}create_callback_from_string(){const e=this._options.callback_string;if(e){const t=new Function("node","scene","window","location",e);return()=>{t(this.node,this.node.scene,null,null)}}}makes_node_dirty_when_dirty(){let e;if(null!=this.param.parent_param)return!1;let t=!0;return null!=(e=this._options.cook)&&(t=e),t}get desktop_browse_option(){return this._options.desktop_browse}get desktop_browse_allowed(){return null!=this.desktop_browse_option}desktop_browse_file_type(){return this.desktop_browse_option?this.desktop_browse_option.file_type:null}get is_expression_for_entities(){const e=this._options.expression;return e&&e.for_entities||!1}get level(){return this._options.level||0}get has_menu(){return null!=this.menu_options}get menu_options(){return this._options.menu}get menu_entries(){return this.menu_options?this.menu_options.entries:[]}get has_menu_radio(){return this.has_menu}get is_multiline(){return!0===this._options.multiline}get language(){return this._options.language}get is_code(){return null!=this.language}get node_selection_options(){return this._options.node_selection}get node_selection_context(){if(this.node_selection_options)return this.node_selection_options.context}dependent_on_found_node(){return!("dependent_on_found_node"in this._options)||this._options.dependent_on_found_node}get range(){return this._options.range||[0,1]}get step(){return this._options.step||.01}range_locked(){return this._options.range_locked||[!1,!1]}ensure_in_range(e){const t=this.range;return e>=t[0]&&e<=t[1]?e:e<t[0]?!0===this.range_locked()[0]?t[0]:e:!0===this.range_locked()[1]?t[1]:e}get is_spare(){return this._options.spare||!1}get texture_options(){return this._options.texture}texture_as_env(){const e=this.texture_options;return null!=e&&!0===e.env}get is_hidden(){return!0===this._options.hidden||!1===this._programatic_visible_state}get is_visible(){return!this.is_hidden}set_visible_state(e){this._options.hidden=!e,this.param.emit(_.ParamEvent.VISIBLE_UPDATED)}get is_label_hidden(){const e=this.param.type;return!1===this._options.label||e===a.ParamType.BUTTON||e===a.ParamType.SEPARATOR||e===a.ParamType.BOOLEAN&&this.is_field_hidden()}is_field_hidden(){return!1===this._options.field}ui_data_depends_on_other_params(){return"visible_if"in this._options}visibility_predecessors(){const e=Object.keys(this._options.visible_if||{}),t=this.param.node;return r.default(e.map(e=>{const n=t.params.get(e);if(n)return n;console.error(`param ${e} not found as visibility condition for ${this.param.name} in node ${this.param.node.type}`)}))}set_ui_data_dependency(){if(this._ui_data_dependency_set)return;this._ui_data_dependency_set=!0;const e=this.visibility_predecessors();if(e.length>0){this._visibility_graph_node=new c.CoreGraphNode(this.param.scene,"param_visibility");for(let t of e)this._visibility_graph_node.add_graph_input(t);this._visibility_graph_node.add_post_dirty_hook("_update_visibility_and_remove_dirty",this._update_visibility_and_remove_dirty_bound)}}update_visibility_and_remove_dirty(){this.update_visibility(),this.param.remove_dirty_state()}update_visibility(){return s.__awaiter(this,void 0,void 0,(function*(){const e=this._options.visible_if;if(e){const t=this.visibility_predecessors(),n=t.map(e=>e.compute());this._programatic_visible_state=!0,yield Promise.all(n);for(let n of t){e[n.name]!=n.value&&(this._programatic_visible_state=!1)}this.param.emit(_.ParamEvent.VISIBLE_UPDATED)}}))}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3).__importDefault(n(48));t.VARIABLE_PREFIX="$";t.BaseTraverser=class{constructor(e){this.param=e,this._set_error_from_error_bound=this._set_error_from_error.bind(this)}clear_error(){this._error_message=void 0}set_error(e){this._error_message=this._error_message||e}_set_error_from_error(e){s.default(e)?this._error_message=e:this._error_message=e.message}get is_errored(){return null!=this._error_message}get error_message(){return this._error_message}reset(){this._error_message=void 0}traverse_node(e){const t=`traverse_${e.type}`;if(this[t])return this[t](e);this.set_error(`expression unknown node type: ${e.type}`)}traverse_BinaryExpression(e){return`${this.traverse_node(e.left)} ${e.operator} ${this.traverse_node(e.right)}`}traverse_LogicalExpression(e){return`${this.traverse_node(e.left)} ${e.operator} ${this.traverse_node(e.right)}`}traverse_MemberExpression(e){return`${this.traverse_node(e.object)}.${this.traverse_node(e.property)}`}traverse_ConditionalExpression(e){return`(${this.traverse_node(e.test)}) ? (${this.traverse_node(e.consequent)}) : (${this.traverse_node(e.alternate)})`}traverse_Compound(e){const n=e.body;let s=[];for(let e=0;e<n.length;e++){const r=n[e];"Identifier"==r.type?r.name[0]==t.VARIABLE_PREFIX?s.push("`${"+this.traverse_node(r)+"}`"):s.push(`'${r.name}'`):s.push("`${"+this.traverse_node(r)+"}`")}return s.join(" + ")}traverse_Literal(e){return`${e.raw}`}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3);t.AsyncFunction=Object.getPrototypeOf((function(){return s.__awaiter(this,void 0,void 0,(function*(){}))})).constructor},,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3).__importDefault(n(188)),r=n(34),o=n(16),i=n(24),a=n(133);t.ConnectionPointTypesAvailableForAttribute=[o.ConnectionPointType.FLOAT,o.ConnectionPointType.VEC2,o.ConnectionPointType.VEC3,o.ConnectionPointType.VEC4];const _=n(5);class c extends _.NodeParamsConfig{constructor(){super(...arguments),this.name=_.ParamConfig.STRING(""),this.type=_.ParamConfig.INTEGER(0,{menu:{entries:t.ConnectionPointTypesAvailableForAttribute.map((e,t)=>({name:e,value:t}))}})}}const l=new c;class u extends r.TypedGlNode{constructor(){super(...arguments),this.params_config=l,this._on_create_set_name_if_none_bound=this._on_create_set_name_if_none.bind(this),this.gl_connections_controller=new a.GlConnectionsController(this)}static type(){return"attribute"}initialize_node(){this.add_post_dirty_hook("_set_mat_to_recompile",this._set_mat_to_recompile_if_is_exporting.bind(this)),this.lifecycle.add_on_create_hook(this._on_create_set_name_if_none_bound),this.gl_connections_controller.initialize_node(),this.gl_connections_controller.set_expected_input_types_function(()=>[]),this.gl_connections_controller.set_expected_output_types_function(()=>[t.ConnectionPointTypesAvailableForAttribute[this.pv.type]])}create_params(){var e;(null===(e=this.material_node)||void 0===e?void 0:e.assembler_controller.allow_attribute_exports())&&this.add_param(i.ParamType.BOOLEAN,"export_when_connected",0)}get input_name(){return u.INPUT_NAME}get output_name(){return u.OUTPUT_NAME}set_lines(e){var t;null===(t=this.material_node)||void 0===t||t.assembler_controller.assembler.set_node_lines_attribute(this,e)}get attribute_name(){return s.default(this.pv.name)}gl_type(){return this.io.outputs.named_output_connection_points[0].type}connected_input_node(){return this.io.inputs.named_input(u.INPUT_NAME)}connected_input_connection_point(){return this.io.inputs.named_input_connection_point(u.INPUT_NAME)}output_connection_point(){return this.io.outputs.named_output_connection_points_by_name(this.input_name)}get is_importing(){return this.io.outputs.used_output_names().length>0}get is_exporting(){if(this.pv.export_when_connected){return null!=this.io.inputs.named_input(u.INPUT_NAME)}return!1}_set_mat_to_recompile_if_is_exporting(){this.is_exporting&&this._set_mat_to_recompile()}_on_create_set_name_if_none(){""==this.pv.name&&this.p.name.set(this.name)}}t.AttributeGlNode=u,u.INPUT_NAME="export",u.OUTPUT_NAME="val"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(652),r=n(156),o=n(653),i=n(654),a=n(655),_=n(656),c=n(191),l=n(352),u=n(353),d=n(155);t.JsonExportDispatcher=class{static dispatch_node(e){return new s.NodeJsonExporter(e)}static dispatch_param(e){return e instanceof c.TypedNumericParam?new o.ParamNumericJsonExporter(e):e instanceof l.OperatorPathParam?new i.ParamOperatorPathJsonExporter(e):e instanceof u.StringParam?new a.ParamStringJsonExporter(e):e instanceof d.RampParam?new _.ParamRampJsonExporter(e):new r.ParamJsonExporter(e)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(49),r=n(264);t.SceneJsonExporter=class{constructor(e){this._scene=e,this._data={}}data(){this._scene.nodes_controller.reset_node_context_signatures();const e=r.JsonExportDispatcher.dispatch_node(this._scene.root),t=e.data(),n=e.ui_data();return this._data={properties:{frame:this._scene.frame||1,frame_range:this._scene.frame_range,frame_range_locked:this._scene.time_controller.frame_range_locked,master_camera_node_path:this._scene.cameras_controller.master_camera_node_path},root:t,ui:n},this._data}static sanitize_string(e){return e=e.replace(/'/g,"'"),e=s.CoreString.escape_line_breaks(e)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.FUNCTION_DECLARATION="function_declaration",e.DEFINE="define",e.BODY="body"}(t.LineType||(t.LineType={}))},,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.GlNodeFinder=class{static find_output_nodes(e){return e.nodes_by_type("output")}static find_attribute_export_nodes(e){return e.nodes_by_type("attribute").filter(e=>e.is_exporting)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),r=n(676),o=n(366),i=n(5);class a extends i.NodeParamsConfig{constructor(){super(...arguments),this.allow_pan=i.ParamConfig.BOOLEAN(1),this.allow_rotate=i.ParamConfig.BOOLEAN(1),this.allow_zoom=i.ParamConfig.BOOLEAN(1),this.tdamping=i.ParamConfig.BOOLEAN(1),this.damping=i.ParamConfig.FLOAT(.1,{visible_if:{tdamping:!0}}),this.screen_space_panning=i.ParamConfig.BOOLEAN(1),this.rotate_speed=i.ParamConfig.FLOAT(.5),this.min_distance=i.ParamConfig.FLOAT(1,{range:[0,100],range_locked:[!0,!1]}),this.max_distance=i.ParamConfig.FLOAT(50,{range:[0,100],range_locked:[!0,!1]}),this.polar_angle_range=i.ParamConfig.VECTOR2([0,"$PI"])}}const _=new a;class c extends r.TypedCameraControlsEventNode{constructor(){super(...arguments),this.params_config=_}static type(){return"camera_orbit_controls"}create_controls_instance(e,t){return s.__awaiter(this,void 0,void 0,(function*(){return new o.OrbitControls(e,t)}))}setup_controls(e){e.enablePan=this.pv.allow_pan,e.enableRotate=this.pv.allow_rotate,e.enableZoom=this.pv.allow_zoom,e.enableDamping=this.pv.tdamping,e.dampingFactor=this.pv.damping,e.rotateSpeed=this.pv.rotate_speed,e.screenSpacePanning=this.pv.screen_space_panning,e.minDistance=this.pv.min_distance,e.maxDistance=this.pv.max_distance,e.minPolarAngle=this.pv.polar_angle_range.x,e.maxPolarAngle=this.pv.polar_angle_range.y,e.enableKeys=!1}set_from_camera_node(e,t){const n=t.params.vector3("target");e.target.copy(n)}}t.CameraOrbitControlsEventNode=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),r=n(158),o=n(134),i=n(5),a=n(27);t.TextureMapParamConfig=function(e){return class extends e{constructor(){super(...arguments),this.use_map=i.ParamConfig.BOOLEAN(0),this.map=i.ParamConfig.OPERATOR_PATH(o.FileCopNode.DEFAULT_NODE_PATH.UV,{visible_if:{use_map:1}})}}},t.BooleanParamOptions=function(e){return{cook:!1,callback:(t,n)=>{e.update(t)}}},t.OperatorPathOptions=function(e,t){return{visible_if:{[t]:1},node_selection:{context:a.NodeContext.COP},cook:!1,callback:(t,n)=>{e.update(t)}}};class _ extends r.BaseController{constructor(e,t){super(e),this.node=e,this._update_options=t,null==this._update_options.define&&(this._update_options.define=!0)}add_hooks(e,t){e.add_post_dirty_hook("TextureController",()=>{this.update()}),t.add_post_dirty_hook("TextureController",()=>{this.update()})}static update(e){}_update(e,t,n,r){return s.__awaiter(this,void 0,void 0,(function*(){if(this._update_options.uniforms){const s=e,o=t;yield this._update_texture_on_uniforms(s,o,n,r)}if(this._update_options.direct_params){const s=e,o=t;yield this._update_texture_on_material(s,o,n,r)}}))}_update_texture_on_uniforms(e,t,n,r){return s.__awaiter(this,void 0,void 0,(function*(){this._update_required_attribute(e,e.uniforms,t,n,r,this._apply_texture_on_uniforms.bind(this),this._remove_texture_from_uniforms.bind(this))}))}_apply_texture_on_uniforms(e,t,n,s){const r=null!=t[n]&&null!=t[n].value;let o=!1;if(r){t[n].value.uuid!=s.uuid&&(o=!0)}if(!r||o){if(t[n].value=s,this._do_update_define()){const t=this._define_name(`${n}`);e.defines[t]=1}e.defines.USE_UV=1,e.needsUpdate=!0}}_remove_texture_from_uniforms(e,t,n){if(t[n].value){if(t[n].value=null,this._do_update_define()){const t=this._define_name(`${n}`);delete e.defines[t]}e.needsUpdate=!0}}_define_name(e){return"USE_"+e.replace("_","").toUpperCase()}_update_texture_on_material(e,t,n,r){return s.__awaiter(this,void 0,void 0,(function*(){this._update_required_attribute(e,e,t,n,r,this._apply_texture_on_material.bind(this),this._remove_texture_from_material.bind(this))}))}_apply_texture_on_material(e,t,n,s){const r=null!=t[n];let o=!1;if(r){t[n].uuid!=s.uuid&&(o=!0)}r&&!o||(t[n]=s,e.needsUpdate=!0)}_remove_texture_from_material(e,t,n){t[n]&&(t[n]=null,e.needsUpdate=!0)}_update_required_attribute(e,t,n,r,o,i,_){return s.__awaiter(this,void 0,void 0,(function*(){if(r.is_dirty&&(yield r.compute()),r.value){o.is_dirty&&(yield o.compute());const s=o.found_node();if(s)if(s.node_context()==a.NodeContext.COP){const r=s,o=(yield r.request_container()).texture();if(o)return void i(e,t,n,o);this.node.states.error.set("found node has no texture")}else this.node.states.error.set("found map node is not a COP node");else this.node.states.error.set(`could not find map node ${o.name} with path ${o.value}`)}_(e,t,n)}))}_do_update_define(){return null==this._update_options.define||this._update_options.define}}t.BaseTextureMapController=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(106),r=n(766),o=n(767),i=n(768),a=new Map([]);a.set(s.CustomMaterialName.DISTANCE,r.ShaderAssemblerCustomMeshDistance),a.set(s.CustomMaterialName.DEPTH,o.ShaderAssemblerCustomMeshDepth),a.set(s.CustomMaterialName.DEPTH_DOF,i.ShaderAssemblerCustomMeshDepthDOF);class _ extends s.ShaderAssemblerMaterial{custom_assembler_class_by_custom_name(){return a}}t.ShaderAssemblerMesh=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),r=n(69),o=n(7),i=n(94);class a extends r.TypedObjNode{constructor(){super(...arguments),this.flags=new i.FlagsControllerD(this),this.render_order=r.ObjNodeRenderOrder.LIGHT,this._color_with_intensity=new o.Color(0),this._used_in_scene=!0,this._cook_main_without_inputs_when_dirty_bound=this._cook_main_without_inputs_when_dirty.bind(this)}get light(){return this._light}initialize_base_node(){super.initialize_base_node(),this._light=this.create_light(),this.object.add(this._light),this.flags.display.add_hook(()=>{this.update_light_attachment()}),this.dirty_controller.add_post_dirty_hook("_cook_main_without_inputs_when_dirty",this._cook_main_without_inputs_when_dirty_bound)}_cook_main_without_inputs_when_dirty(){return s.__awaiter(this,void 0,void 0,(function*(){yield this.cook_controller.cook_main_without_inputs()}))}update_light_attachment(){this.flags.display.active?(this.object.add(this.light),this._cook_main_without_inputs_when_dirty()):this.object.remove(this.light)}create_shadow_params_main(){if(null!=this._light.shadow)return this.create_shadow_params()}create_light_params(){}update_light_params(){}create_shadow_params(){}cook(){this.update_light_params(),this.update_shadow_params(),this.cook_controller.end_cook()}update_shadow_params(){}get color_with_intensity(){const e=this.params.color("color"),t=this.params.float("intensity");return this._color_with_intensity.copy(e).multiplyScalar(t),this._color_with_intensity}get active(){return this.flags.display.active}}t.TypedLightObjNode=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),r=n(1),o=n(2),i=n(7),a=n(53),_=n(114),c=n(35),l=n(161),u=n(49),d=s.__importDefault(n(190)),h=s.__importDefault(n(48)),p=s.__importDefault(n(21)),m=s.__importDefault(n(44)),f=n(380);class g extends f.CoreEntity{constructor(e,t){super(t),this._object=e,null==this._object.userData.attributes&&(this._object.userData.attributes={})}object(){return this._object}geometry(){return this._object.geometry}core_geometry(){const e=this.geometry();return new a.CoreGeometry(e)}points(){return this.core_geometry().points()}points_from_group(e){if(e){const t=u.CoreString.indices(e);if(t){const e=this.points();return t.map(t=>e[t])}return[]}return this.points()}compute_vertex_normals(){this.core_geometry().compute_vertex_normals()}add_attribute(e,t){let n;n=m.default(t)||p.default(t)||h.default(t)?t:t.toArray(),this._object.userData.attributes[e]=n}add_numeric_attrib(e,t){this.add_attribute(e,t)}set_attrib_value(e,t){this.add_attribute(e,t)}add_numeric_vertex_attrib(e,t,n){null==n&&(n=_.CoreAttribute.default_value(t)),this.core_geometry().add_numeric_attrib(e,t,n)}attribute_names(){return Object.keys(this._object.userData.attributes)}attrib_names(){return this.attribute_names()}has_attrib(e){return this.attribute_names().includes(e)}rename_attribute(e,t){this.add_attribute(t,this.attrib_value(e)),this.delete_attribute(e)}delete_attribute(e){delete this._object.userData.attributes[e]}attrib_value(e){if("ptnum"===e)return this.index;{let t=this._object.userData.attributes[e];return null==t&&"name"==e&&(t=this._object.name),t}}name(){return this.attrib_value("name")}human_type(){return c.CoreConstant.CONSTRUCTOR_NAMES_BY_CONSTRUCTOR_NAME[this._object.constructor.name]}attrib_type(e){const t=this.attrib_value(e);return h.default(t)?c.CoreConstant.ATTRIB_TYPE.STRING:c.CoreConstant.ATTRIB_TYPE.NUMERIC}attrib_size(e){const t=this.attrib_value(e);if(null==t)return 0;if(h.default(t)||m.default(t))return 1;switch(t.constructor){case o.Vector2:return 2;case r.Vector3:return 3;default:return 0}}clone(){return g.clone(this._object)}static clone(e){const t=e.clone();var n=new Map,s=new Map;return g.parallelTraverse(e,t,(function(e,t){n.set(t,e),s.set(e,t)})),t.traverse((function(t){const r=n.get(t),o=t;if(o.geometry){const e=r.geometry;o.geometry=a.CoreGeometry.clone(e);const t=o.geometry;t.userData&&(t.userData=d.default(e.userData))}if(o.material){o.material=r.material,l.CoreMaterial.apply_custom_materials(t,o.material);const e=o.material;null==e.color&&(e.color=new i.Color(1,1,1))}e.userData&&(t.userData=d.default(r.userData));const _=r;_.animations&&(t.animations=_.animations.map(e=>e.clone()));const c=t;if(c.isSkinnedMesh){var u=c,h=r,p=h.skeleton.bones;u.skeleton=h.skeleton.clone(),u.bindMatrix.copy(h.bindMatrix);const e=p.map((function(e){return s.get(e)}));u.skeleton.bones=e,u.bind(u.skeleton,u.bindMatrix)}})),t}static parallelTraverse(e,t,n){n(e,t);for(var s=0;s<e.children.length;s++)this.parallelTraverse(e.children[s],t.children[s],n)}}t.CoreObject=g},function(e,t,n){"use strict";n.r(t),n.d(t,"BufferGeometryUtils",(function(){return l}));var s=n(4),r=n(6),o=n(140),i=n(97),a=n(0),_=n(2),c=n(1),l={computeTangents:function(e){var t=e.index,n=e.attributes;if(null!==t&&void 0!==n.position&&void 0!==n.normal&&void 0!==n.uv){var r=t.array,o=n.position.array,i=n.normal.array,a=n.uv.array,l=o.length/3;void 0===n.tangent&&e.setAttribute("tangent",new s.BufferAttribute(new Float32Array(4*l),4));for(var u=n.tangent.array,d=[],h=[],p=0;p<l;p++)d[p]=new c.Vector3,h[p]=new c.Vector3;var m=new c.Vector3,f=new c.Vector3,g=new c.Vector3,v=new _.Vector2,y=new _.Vector2,b=new _.Vector2,x=new c.Vector3,T=new c.Vector3,C=e.groups;0===C.length&&(C=[{start:0,count:r.length}]);p=0;for(var P=C.length;p<P;++p)for(var w=k=(L=C[p]).start,E=k+L.count;w<E;w+=3)G(r[w+0],r[w+1],r[w+2]);var O,A,N,M=new c.Vector3,S=new c.Vector3,R=new c.Vector3,j=new c.Vector3;for(p=0,P=C.length;p<P;++p){var L,k;for(w=k=(L=C[p]).start,E=k+L.count;w<E;w+=3)z(r[w+0]),z(r[w+1]),z(r[w+2])}}else console.warn("THREE.BufferGeometry: Missing required attributes (index, position, normal or uv) in BufferGeometry.computeTangents()");function G(e,t,n){m.fromArray(o,3*e),f.fromArray(o,3*t),g.fromArray(o,3*n),v.fromArray(a,2*e),y.fromArray(a,2*t),b.fromArray(a,2*n),f.sub(m),g.sub(m),y.sub(v),b.sub(v);var s=1/(y.x*b.y-b.x*y.y);isFinite(s)&&(x.copy(f).multiplyScalar(b.y).addScaledVector(g,-y.y).multiplyScalar(s),T.copy(g).multiplyScalar(y.x).addScaledVector(f,-b.x).multiplyScalar(s),d[e].add(x),d[t].add(x),d[n].add(x),h[e].add(T),h[t].add(T),h[n].add(T))}function z(e){R.fromArray(i,3*e),j.copy(R),A=d[e],M.copy(A),M.sub(R.multiplyScalar(R.dot(A))).normalize(),S.crossVectors(j,A),N=S.dot(h[e]),O=N<0?-1:1,u[4*e]=M.x,u[4*e+1]=M.y,u[4*e+2]=M.z,u[4*e+3]=O}},mergeBufferGeometries:function(e,t){for(var n=null!==e[0].index,s=new Set(Object.keys(e[0].attributes)),o=new Set(Object.keys(e[0].morphAttributes)),i={},a={},_=e[0].morphTargetsRelative,c=new r.BufferGeometry,l=0,u=0;u<e.length;++u){var d=e[u];if(n!==(null!==d.index))return null;for(var h in d.attributes){if(!s.has(h))return null;void 0===i[h]&&(i[h]=[]),i[h].push(d.attributes[h])}if(_!==d.morphTargetsRelative)return null;for(var h in d.morphAttributes){if(!o.has(h))return null;void 0===a[h]&&(a[h]=[]),a[h].push(d.morphAttributes[h])}if(c.userData.mergedUserData=c.userData.mergedUserData||[],c.userData.mergedUserData.push(d.userData),t){var p;if(n)p=d.index.count;else{if(void 0===d.attributes.position)return null;p=d.attributes.position.count}c.addGroup(l,p,u),l+=p}}if(n){var m=0,f=[];for(u=0;u<e.length;++u){for(var g=e[u].index,v=0;v<g.count;++v)f.push(g.getX(v)+m);m+=e[u].attributes.position.count}c.setIndex(f)}for(var h in i){var y=this.mergeBufferAttributes(i[h]);if(!y)return null;c.setAttribute(h,y)}for(var h in a){var b=a[h][0].length;if(0===b)break;c.morphAttributes=c.morphAttributes||{},c.morphAttributes[h]=[];for(u=0;u<b;++u){var x=[];for(v=0;v<a[h].length;++v)x.push(a[h][v][u]);var T=this.mergeBufferAttributes(x);if(!T)return null;c.morphAttributes[h].push(T)}}return c},mergeBufferAttributes:function(e){for(var t,n,r,o=0,i=0;i<e.length;++i){var a=e[i];if(a.isInterleavedBufferAttribute)return null;if(void 0===t&&(t=a.array.constructor),t!==a.array.constructor)return null;if(void 0===n&&(n=a.itemSize),n!==a.itemSize)return null;if(void 0===r&&(r=a.normalized),r!==a.normalized)return null;o+=a.array.length}var _=new t(o),c=0;for(i=0;i<e.length;++i)_.set(e[i].array,c),c+=e[i].array.length;return new s.BufferAttribute(_,n,r)},interleaveAttributes:function(e){for(var t,n=0,s=0,r=0,a=e.length;r<a;++r){var _=e[r];if(void 0===t&&(t=_.array.constructor),t!==_.array.constructor)return console.warn("AttributeBuffers of different types cannot be interleaved"),null;n+=_.array.length,s+=_.itemSize}var c=new o.a(new t(n),s),l=0,u=[],d=["getX","getY","getZ","getW"],h=["setX","setY","setZ","setW"],p=0;for(a=e.length;p<a;p++){var m=(_=e[p]).itemSize,f=_.count,g=new i.InterleavedBufferAttribute(c,m,l,_.normalized);u.push(g),l+=m;for(var v=0;v<f;v++)for(var y=0;y<m;y++)g[h[y]](v,_[d[y]](v))}return u},estimateBytesUsed:function(e){var t=0;for(var n in e.attributes){var s=e.getAttribute(n);t+=s.count*s.itemSize*s.array.BYTES_PER_ELEMENT}var r=e.getIndex();return t+=r?r.count*r.itemSize*r.array.BYTES_PER_ELEMENT:0},mergeVertices:function(e,t=1e-4){t=Math.max(t,Number.EPSILON);for(var n={},r=e.getIndex(),o=e.getAttribute("position"),i=r?r.count:o.count,a=0,_=Object.keys(e.attributes),c={},l={},u=[],d=["getX","getY","getZ","getW"],h=0,p=_.length;h<p;h++){c[b=_[h]]=[],(P=e.morphAttributes[b])&&(l[b]=new Array(P.length).fill().map(()=>[]))}var m=Math.log10(1/t),f=Math.pow(10,m);for(h=0;h<i;h++){var g=r?r.getX(h):h,v="",y=0;for(p=_.length;y<p;y++)for(var b=_[y],x=(C=e.getAttribute(b)).itemSize,T=0;T<x;T++)v+=`${~~(C[d[T]](g)*f)},`;if(v in n)u.push(n[v]);else{for(y=0,p=_.length;y<p;y++){b=_[y];var C=e.getAttribute(b),P=e.morphAttributes[b],w=(x=C.itemSize,c[b]),E=l[b];for(T=0;T<x;T++){var O=d[T];if(w.push(C[O](g)),P)for(var A=0,N=P.length;A<N;A++)E[A].push(P[A][O](g))}}n[v]=a,u.push(a),a++}}const M=e.clone();for(h=0,p=_.length;h<p;h++){b=_[h];var S=e.getAttribute(b),R=new S.array.constructor(c[b]);C=new s.BufferAttribute(R,S.itemSize,S.normalized);if(M.setAttribute(b,C),b in l)for(y=0;y<l[b].length;y++){var j=e.morphAttributes[b][y],L=(R=new j.array.constructor(l[b][y]),new s.BufferAttribute(R,j.itemSize,j.normalized));M.morphAttributes[b][y]=L}}return M.setIndex(u),M},toTrianglesDrawMode:function(e,t){if(t===a.TrianglesDrawMode)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),e;if(t===a.TriangleFanDrawMode||t===a.TriangleStripDrawMode){var n=e.getIndex();if(null===n){var s=[],r=e.getAttribute("position");if(void 0===r)return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),e;for(var o=0;o<r.count;o++)s.push(o);e.setIndex(s),n=e.getIndex()}var i=n.count-2,_=[];if(t===a.TriangleFanDrawMode)for(o=1;o<=i;o++)_.push(n.getX(0)),_.push(n.getX(o)),_.push(n.getX(o+1));else for(o=0;o<i;o++)o%2==0?(_.push(n.getX(o)),_.push(n.getX(o+1)),_.push(n.getX(o+2))):(_.push(n.getX(o+2)),_.push(n.getX(o+1)),_.push(n.getX(o)));_.length/3!==i&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");var c=e.clone();return c.setIndex(_),c.clearGroups(),c}return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",t),e}}},,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(362),r=n(132),o=n(50),i=n(29),a=n(16);class _ extends s.GlobalsBaseController{constructor(e){super(),this._uv_name=e}set_texture_allocations_controller(e){this._texture_allocations_controller=e}handle_globals_node(e,t,n){if(!this._texture_allocations_controller)return;const s=e.io.outputs.named_output_connection_points_by_name(t),o=e.gl_var_name(t);if(this._texture_allocations_controller.variable(t)&&s){const r=s.type,i=`${r} ${o} = ${this.read_attribute(e,r,t,n)}`;n.add_body_lines(e,[i])}else this.globals_geometry_handler=this.globals_geometry_handler||new r.GlobalsGeometryHandler,this.globals_geometry_handler.handle_globals_node(e,t,n)}read_attribute(e,t,n,s){if(!this._texture_allocations_controller)return;const o=this._texture_allocations_controller.variable(n);if(!o)return r.GlobalsGeometryHandler.read_attribute(e,t,n,s);{this.add_particles_sim_uv_attribute(e,s);const t=o.component,n=o.allocation;if(n){const r=n.texture_name,o=new i.UniformGLDefinition(e,a.ConnectionPointType.SAMPLER_2D,r);return s.add_definitions(e,[o]),`texture2D( ${r}, ${this._uv_name} ).${t}`}}}add_particles_sim_uv_attribute(e,t){const n=new i.AttributeGLDefinition(e,a.ConnectionPointType.VEC2,_.UV_ATTRIB),s=new i.VaryingGLDefinition(e,a.ConnectionPointType.VEC2,_.UV_VARYING);t.add_definitions(e,[n,s],o.ShaderName.VERTEX),t.add_definitions(e,[s],o.ShaderName.FRAGMENT),t.add_body_lines(e,[`${_.UV_VARYING} = ${_.UV_ATTRIB}`],o.ShaderName.VERTEX)}}t.GlobalsTextureHandler=_,_.UV_ATTRIB="particles_sim_uv_attrib",_.UV_VARYING="particles_sim_uv_varying",_.PARTICLE_SIM_UV="particleUV"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(53),r=n(4),o=n(6);t.CoreGeometryUtilCurve=class{static accumulated_curve_point_indices(e){let t=[];const n=[];let s,r=null;for(let o=0;o<e.length;o++)if(o%2==1){s=e[o];const i=e[o-1];null==r||i===r?(0===t.length&&t.push(i),t.push(s),r=s):(n.push(t),t=[i,s],r=s)}return n.push(t),n}static create_line_segment_geometry(e,t,n,s){const i=[],a={};n.forEach(e=>{a[e]=[]}),t.forEach((t,r)=>{const o=e[t];n.forEach(e=>{let t=o.attrib_value(e);t=s[e]>1?t.toArray():[t],t.forEach(t=>{a[e].push(t)})}),r>0&&(i.push(r-1),i.push(r))});const _=new o.BufferGeometry;return n.forEach(e=>{const t=s[e],n=a[e];_.setAttribute(e,new r.Float32BufferAttribute(n,t))}),_.setIndex(i),_}static line_segment_to_geometries(e){var t;const n=[],r=new s.CoreGeometry(e),o=r.attrib_names(),i=r.points(),a=(null===(t=e.getIndex())||void 0===t?void 0:t.array)||[],_=this.accumulated_curve_point_indices(a);if(console.log(a,_),_.length>0){const t=r.attrib_sizes();_.forEach((s,r)=>{e=this.create_line_segment_geometry(i,s,o,t),n.push(e)})}return n}}},function(e,t){},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(186),r=n(33),o=n(16),i=n(354),a=n(5);class _ extends a.NodeParamsConfig{constructor(){super(...arguments),this.active=a.ParamConfig.BOOLEAN(!0,{callback:(e,t)=>{l.PARAM_CALLBACK_toggle_active(e)}})}}const c=new _;class l extends s.TypedEventNode{constructor(){super(...arguments),this.params_config=c}static type(){return"mouse_event"}initialize_node(){this.io.outputs.set_named_output_connection_points(i.ACCEPTED_MOUSE_EVENT_TYPES.map(e=>new r.TypedNamedConnectionPoint(e,o.ConnectionPointType.BOOL))),this.lifecycle.add_on_add_hook(()=>{this.scene.events_controller.register_event_node(this)}),this.lifecycle.add_delete_hook(()=>{this.scene.events_controller.unregister_event_node(this)})}process_event(e,t,n){if(!this.pv.active)return;const s=this.io.outputs.get_output_index(e.type);if(s>=0){const r=this.io.connections.output_connections().filter(e=>e.output_index==s).map(e=>e.node_dest);for(let s of r)s.process_event(e,t,n)}}_update_register(){this.pv.active?this.scene.events_controller.register_event_node(this):this.scene.events_controller.unregister_event_node(this)}static PARAM_CALLBACK_toggle_active(e){e._update_register()}}t.MouseEventNode=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.BaseState=class{constructor(e){this.node=e}}},,,,,,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.NodeSerializer=class{constructor(e){this.node=e}to_json(e=!1){var t,n,s,r;const o={name:this.node.name,type:this.node.type,graph_node_id:this.node.graph_node_id,is_dirty:this.node.is_dirty,ui_data_json:this.node.ui_data.to_json(),error_message:this.node.states.error.message,children:this.children_ids(),inputs:this.input_ids(),input_connection_output_indices:this.connection_input_indices(),named_input_connections:this.named_input_connections(),named_output_connections:this.named_output_connections(),param_ids:this.to_json_params(e),override_clonable_state:this.node.io.inputs.override_clonable_state(),inputs_clonable_state_with_override:this.node.io.inputs.inputs_clonable_state_with_override(),flags:{display:null===(n=null===(t=this.node.flags)||void 0===t?void 0:t.display)||void 0===n?void 0:n.active,bypass:null===(r=null===(s=this.node.flags)||void 0===s?void 0:s.bypass)||void 0===r?void 0:r.active},selection:void 0};return this.node.children_allowed()&&this.node.children_controller&&(o.selection=this.node.children_controller.selection.to_json()),o}children_ids(){return this.node.children().map(e=>e.graph_node_id)}input_ids(){return this.node.io.inputs.inputs().map(e=>null!=e?e.graph_node_id:void 0)}connection_input_indices(){var e;return null===(e=this.node.io.connections.input_connections())||void 0===e?void 0:e.map(e=>null!=e?e.output_index:void 0)}named_input_connections(){return this.node.io.inputs.named_input_connection_points.map(e=>e.to_json())}named_output_connections(){return this.node.io.outputs.named_output_connection_points.map(e=>e.to_json())}to_json_params_from_names(e,t=!1){return e.map(e=>this.node.params.get(e).graph_node_id)}to_json_params(e=!1){return this.to_json_params_from_names(this.node.params.names,e)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(579),r=n(602),o=n(603),i=n(351),a=n(604),_=n(605),c=n(352),l=n(155),u=n(607),d=n(353),h=n(608),p=n(609),m=n(610),f=n(24);t.ParamConstructorByType={[f.ParamType.BOOLEAN]:s.BooleanParam,[f.ParamType.BUTTON]:r.ButtonParam,[f.ParamType.COLOR]:o.ColorParam,[f.ParamType.FLOAT]:i.FloatParam,[f.ParamType.FOLDER]:a.FolderParam,[f.ParamType.INTEGER]:_.IntegerParam,[f.ParamType.OPERATOR_PATH]:c.OperatorPathParam,[f.ParamType.RAMP]:l.RampParam,[f.ParamType.SEPARATOR]:u.SeparatorParam,[f.ParamType.STRING]:d.StringParam,[f.ParamType.VECTOR2]:h.Vector2Param,[f.ParamType.VECTOR3]:p.Vector3Param,[f.ParamType.VECTOR4]:m.Vector4Param}},,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),r=n(580);t.ExpressionController=class{constructor(e){this.param=e}get active(){return null!=this._expression}get expression(){return this._expression}get is_errored(){return!!this._manager&&this._manager.is_errored}get error_message(){return this._manager?this._manager.error_message:null}get requires_entities(){return this.param.options.is_expression_for_entities}set_expression(e,t=!0){var n;this.param.scene.missing_expression_references_controller.deregister_param(this.param),this.param.scene.expressions_controller.deregister_param(this.param),this._expression!=e&&(this._expression=e,this._expression?(this._manager=this._manager||new r.ExpressionManager(this.param),this._manager.parse_expression(this._expression)):null===(n=this._manager)||void 0===n||n.reset(),t&&this.param.set_dirty())}update_from_method_dependency_name_change(){this._manager&&this.active&&this._manager.update_from_method_dependency_name_change()}compute_expression(){return s.__awaiter(this,void 0,void 0,(function*(){if(this._manager&&this.active){return yield this._manager.compute_function()}}))}compute_expression_for_entities(e,t){var n,r;return s.__awaiter(this,void 0,void 0,(function*(){this.set_entities(e,t),yield this.compute_expression(),(null===(n=this._manager)||void 0===n?void 0:n.error_message)&&this.param.node.states.error.set(`expression evalution error: ${null===(r=this._manager)||void 0===r?void 0:r.error_message}`),this.reset_entities()}))}compute_expression_for_points(e,t){return this.compute_expression_for_entities(e,t)}compute_expression_for_objects(e,t){return this.compute_expression_for_entities(e,t)}get entities(){return this._entities}get entity_callback(){return this._entity_callback}set_entities(e,t){this._entities=e,this._entity_callback=t}reset_entities(){this._entities=void 0,this._entity_callback=void 0}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),r=s.__importDefault(n(48)),o=s.__importDefault(n(581));o.default.addUnaryOp("@");o.default.addBinaryOp("**",10);class i{constructor(){}parse_expression(e){try{this.reset(),this.node=o.default(e)}catch(t){const n=`could not parse the expression '${e}' (error: ${t})`;this.error_message=n}}parse_expression_for_string_param(e){try{this.reset();const t=i.string_value_elements(e),n=[];for(let e=0;e<t.length;e++){const s=t[e];let r;r=e%2==1?o.default(s):{type:"Literal",value:`'${s}'`,raw:`'${s}'`},n.push(r)}this.node={type:"CallExpression",arguments:n,callee:{type:"Identifier",name:"str_concat"}}}catch(t){const n=`could not parse the expression '${e}' (error: ${t})`;this.error_message=n}}static string_value_elements(e){return null!=e&&r.default(e)?e.split("`"):[]}reset(){this.node=void 0,this.error_message=void 0}}t.ParsedTree=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(101);t.DecomposedPath=class{constructor(){this.index=-1,this.path_elements=[],this._named_nodes=[],this.graph_node_ids=[],this.node_element_by_graph_node_id={}}add_node(e,t){this.index+=1,e==t.name&&(this.named_nodes[this.index]=t),this.graph_node_ids[this.index]=t.graph_node_id,this.node_element_by_graph_node_id[t.graph_node_id]=e}add_path_element(e){this.index+=1,this.path_elements[this.index]=e}get named_nodes(){return this._named_nodes}update_from_name_change(e){this.named_nodes.map(e=>null==e?void 0:e.graph_node_id).includes(e.graph_node_id)&&(this.node_element_by_graph_node_id[e.graph_node_id]=e.name)}to_path(){const e=new Array(this.index);for(let t=0;t<=this.index;t++){const n=this.named_nodes[t];if(n)e[t]=this.node_element_by_graph_node_id[n.graph_node_id];else{const n=this.path_elements[t];n&&(e[t]=n)}}let t=e.join(s.CoreWalker.SEPARATOR);const n=t[0];return n&&(s.CoreWalker.NON_LETTER_PREFIXES.includes(n)||(t=`${s.CoreWalker.SEPARATOR}${t}`)),t}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=function(e){return function(t){return Math.pow(t,e)}},r=function(e){return function(t){return 1-Math.abs(Math.pow(t-1,e))}},o=function(e){return function(t){return t<.5?s(e)(2*t)/2:r(e)(2*t-1)/2+.5}};t.Easing={linear:o(1),ease_i:function(e,t){return s(t)(e)},ease_o:function(e,t){return r(t)(e)},ease_io:function(e,t){return o(t)(e)},ease_i2:s(2),ease_o2:r(2),ease_io2:o(2),ease_i3:o(3),ease_o3:o(3),ease_io3:o(3),ease_i4:o(4),ease_o4:o(4),ease_io4:o(4),ease_i_sin:function(e){return 1+Math.sin(Math.PI/2*e-Math.PI/2)},ease_o_sin:function(e){return Math.sin(Math.PI/2*e)},ease_io_sin:function(e){return(1+Math.sin(Math.PI*e-Math.PI/2))/2},ease_i_elastic:function(e){return(.04-.04/e)*Math.sin(25*e)+1},ease_o_elastic:function(e){return.04*e/--e*Math.sin(25*e)},ease_io_elastic:function(e){return(e-=.5)<0?(.02+.01/e)*Math.sin(50*e):(.02-.01/e)*Math.sin(50*e)+1}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3).__importDefault(n(44)),r=n(191),o=n(24),i=n(49);class a extends r.TypedNumericParam{static type(){return o.ParamType.FLOAT}get default_value_serialized(){return this.default_value}get raw_input_serialized(){return this._raw_input}get value_serialized(){return this.value}static are_raw_input_equal(e,t){return e==t}static are_values_equal(e,t){return e==t}static convert(e){if(s.default(e))return e;if(i.CoreString.is_number(e)){const t=parseFloat(e);if(s.default(t))return t}return null}convert(e){const t=a.convert(e);return t?this.options.ensure_in_range(t):t}}t.FloatParam=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),r=n(93),o=n(101),i=n(24),a=n(103);class _ extends r.TypedParam{constructor(){super(...arguments),this._found_node=null}static type(){return i.ParamType.OPERATOR_PATH}get default_value_serialized(){return this.default_value}get raw_input_serialized(){return`${this._raw_input}`}get value_serialized(){return`${this.value}`}static are_raw_input_equal(e,t){return e==t}static are_values_equal(e,t){return e==t}get is_default(){return this._value==this.default_value}process_raw_input(){this._value=this._raw_input,this.set_dirty(),this.emit_controller.emit(a.ParamEvent.VALUE_UPDATED)}process_computation(){var e,t;return s.__awaiter(this,void 0,void 0,(function*(){const n=this._value;let s=null;if(null!=n&&""!==n&&(s=o.CoreWalker.find_node(this.node,n)),this._found_node!==s){const n=this.options.dependent_on_found_node();if(this._found_node&&n&&this.remove_graph_input(this._found_node),this._found_node=s,s){const r=this.options.node_selection_context,o=null===(t=null===(e=s.parent)||void 0===e?void 0:e.children_controller)||void 0===t?void 0:t.context;r==o||null==r?n&&this.add_graph_input(s):this.states.error.set(`node context is ${r} but the params expects a ${o}`)}this.options.execute_callback()}this.remove_dirty_state()}))}found_node(){return this._found_node}}t.OperatorPathParam=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),r=s.__importDefault(n(48)),o=n(93),i=n(348),a=n(24),_=n(347),c=n(103);class l extends o.TypedParam{static type(){return a.ParamType.STRING}get default_value_serialized(){return this.default_value}_clone_raw_input(e){return`${e}`}get raw_input_serialized(){return`${this._raw_input}`}get value_serialized(){return`${this.value}`}static are_raw_input_equal(e,t){return e==t}static are_values_equal(e,t){return e==t}get is_default(){return this._raw_input==this.default_value}convert(e){return r.default(e)?e:`${e}`}get raw_input(){return this._raw_input}process_raw_input(){this.states.error.clear(),this._value_elements(this._raw_input).length>=3?(this._expression_controller=this._expression_controller||new _.ExpressionController(this),this._raw_input!=this._expression_controller.expression&&(this._expression_controller.set_expression(this._raw_input),this.set_dirty(),this.emit_controller.emit(c.ParamEvent.EXPRESSION_UPDATED))):this._raw_input!=this._value&&(this._value=this._raw_input,this.remove_dirty_state(),this.set_successors_dirty(this),this.emit_controller.emit(c.ParamEvent.VALUE_UPDATED),this._expression_controller&&(this._expression_controller.set_expression(void 0,!1),this.emit_controller.emit(c.ParamEvent.EXPRESSION_UPDATED)))}process_computation(){var e;return s.__awaiter(this,void 0,void 0,(function*(){if((null===(e=this.expression_controller)||void 0===e?void 0:e.active)&&!this.expression_controller.requires_entities){const e=yield this.expression_controller.compute_expression();if(this.expression_controller.is_errored)this.states.error.set(`expression error: ${this.expression_controller.error_message}`);else{const t=this.convert(e);null!=t?(this._value=t,this.emit_controller.emit(c.ParamEvent.VALUE_UPDATED)):this.states.error.set(`expression returns an invalid type (${e})`),this.remove_dirty_state()}}}))}_value_elements(e){return i.ParsedTree.string_value_elements(e)}}t.StringParam=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(620);var r;!function(e){e.DOWN="mousedown",e.MOVE="mousemove",e.UP="mouseup",e.ENTER="mouseenter",e.LEAVE="mouseleave"}(r||(r={})),t.ACCEPTED_MOUSE_EVENT_TYPES=[r.DOWN,r.MOVE,r.UP,r.ENTER,r.LEAVE];class o extends s.BaseEventsController{accepts_event(e){return t.ACCEPTED_MOUSE_EVENT_TYPES.includes(e.type)}}t.MouseEventsController=o},,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(186),r=n(33),o=n(16),i=n(261),a=n(259),_=n(5),c=n(357),l=n(2),u=n(262);class d{constructor(){this.raycaster=new u.Raycaster,this.mouse=new l.Vector2}process_event(e,t,n){}set_node(e){this.node=e}_set_mouse_from_event_and_canvas(e,t){this.mouse.x=e.clientX/t.offsetWidth*2-1,this.mouse.y=-e.clientY/t.offsetHeight*2+1}}t.BaseMouseEventProcessor=d;class h extends _.NodeParamsConfig{constructor(){super(...arguments),this.code_typescript=_.ParamConfig.STRING("\nimport {BaseMouseEventProcessor} from 'polygonjs-engine'\nexport class EventProcessor extends BaseMouseEventProcessor {\n\tconstructor(){\n\t\tsuper();\n\t}\n\tprocess_event(event: MouseEvent, canvas: HTMLCanvasElement, camera_node: any){\n\t\tthis._set_mouse_from_event_and_canvas(event, canvas);\n\t\tconsole.log(this.node.scene.time);\n\t\tconsole.log(\"processing event\", this.mouse.x, this.mouse.y);\n\t}\n}\n\n\n\n\n",{label:!1,language:a.StringParamLanguage.TYPESCRIPT}),this.code_javascript=_.ParamConfig.STRING("",{hidden:!0})}}const p=new h;class m extends s.TypedEventNode{constructor(){super(...arguments),this.params_config=p}static type(){return"code"}initialize_node(){this.io.inputs.set_named_input_connection_points([new r.TypedNamedConnectionPoint("trigger",o.ConnectionPointType.BOOL)])}process_event(e,t,n){this._compile_if_required(),this._event_processor&&this._event_processor.process_event(e,t,n)}_compile_if_required(){this._event_processor&&this._last_compiled_code==this.pv.code_javascript||this._compile()}_compile(){try{const e=`try {\n\t\t\t\t${c.TranspiledFilter.filter(this.pv.code_javascript)}\n\t\t\t} catch(e) {\n\t\t\t\tthis.states.error.set(e)\n\t\t\t}`,t=new i.AsyncFunction("BaseMouseEventProcessor",e)(d);this._event_processor=new t,this._event_processor.set_node(this),this._last_compiled_code=this.pv.code_javascript}catch(e){console.warn(e),this.states.error.set(`cannot generate function (${e})`),this._event_processor=void 0}}}t.CodeEventNode=m},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.TranspiledFilter=class{static filter(e){const t=e.split("\n");console.log(t);const n=[];for(let e of t)e.match(/import {.*} from '.*'/)||(e=e.replace("export ","return "),n.push(e));return console.log("filtered_lines",n),n.join("\n")}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.BaseFlag=class{constructor(e){this.node=e,this._state=!0,this._hooks=null}add_hook(e){this._hooks=this._hooks||[],this._hooks.push(e)}on_update(){}set(e){this._state!=e&&(this._state=e,this.on_update(),this.run_hooks())}get active(){return this._state}toggle(){this.set(!this._state)}run_hooks(){if(this._hooks)for(let e of this._hooks)e()}}},,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class s{constructor(){this._id=s.__next_id++}id(){return this._id}handle_globals_node(e,t,n){}}t.GlobalsBaseController=s,s.__next_id=0},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.TypedGLDefinitionCollection=class{constructor(e=[]){this._definitions=e,this._errored=!1}get errored(){return this._errored}get error_message(){return this._error_message}uniq(){const e=new Map,t=[];for(let n of this._definitions)if(!this._errored){const s=n.name,r=e.get(s);r?r.data_type!=n.data_type&&(this._errored=!0,this._error_message=`attempt to create ${n.name} with types ${n.data_type}`,console.warn("emitting error message",this._error_message)):(e.set(s,n),t.push(s))}const n=[];for(let s of t){const t=e.get(s);t&&n.push(t)}return n}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),r=s.__importDefault(n(92)),o=s.__importDefault(n(91)),i=n(128),a=n(50);t.TypedNodeTraverser=class{constructor(e,t){this._assembler=e,this._gl_parent_node=t,this._leaves_graph_id=new Map,this._graph_ids_by_shader_name=new Map,this._outputs_by_graph_id=new Map,this._depth_by_graph_id=new Map,this._graph_id_by_depth=new Map,this._graph=this._gl_parent_node.scene.graph}reset(){this._leaves_graph_id.clear(),this._outputs_by_graph_id.clear(),this._depth_by_graph_id.clear(),this._graph_id_by_depth.clear(),this.shader_names().forEach(e=>{this._graph_ids_by_shader_name.set(e,new Map)})}shader_names(){return this._assembler.shader_names}input_names_for_shader_name(e,t){return this._assembler.input_names_for_shader_name(e,t)}traverse(e){this.reset();for(let e of this.shader_names())this._leaves_graph_id.set(e,new Map);for(let t of this.shader_names()){this._shader_name=t;for(let t of e)this.find_leaves_from_root_node(t),this.set_nodes_depth()}this._depth_by_graph_id.forEach((e,t)=>{null!=e&&i.MapUtils.push_on_array_at_entry(this._graph_id_by_depth,e,t)})}leaves_from_nodes(e){var t;this._shader_name=a.ShaderName.LEAVES_FROM_NODES_SHADER,this._graph_ids_by_shader_name.set(this._shader_name,new Map),this._leaves_graph_id.set(this._shader_name,new Map);for(let t of e)this.find_leaves(t);const n=[];return null===(t=this._leaves_graph_id.get(this._shader_name))||void 0===t||t.forEach((e,t)=>{n.push(t)}),this._graph.nodes_from_ids(n)}nodes_for_shader_name(e){const t=[];this._graph_id_by_depth.forEach((e,n)=>{t.push(n)}),t.sort((e,t)=>e-t);const n=[];return t.forEach(t=>{const s=this._graph_id_by_depth.get(t);s&&s.forEach(t=>{var s;if(null===(s=this._graph_ids_by_shader_name.get(e))||void 0===s?void 0:s.get(t)){const e=this._graph.node_from_id(t);n.push(e)}})}),n}sorted_nodes(){const e=[];this._graph_id_by_depth.forEach((t,n)=>{e.push(n)}),e.sort((e,t)=>e-t);const t=[];return e.forEach(e=>{const n=this._graph_id_by_depth.get(e);if(n)for(let e of n){const n=this._graph.node_from_id(e);n&&t.push(n)}}),t}find_leaves_from_root_node(e){var t;null===(t=this._graph_ids_by_shader_name.get(this._shader_name))||void 0===t||t.set(e.graph_node_id,!0);const n=this.input_names_for_shader_name(e,this._shader_name);if(n)for(let t of n){const n=e.io.inputs.named_input(t);n&&(i.MapUtils.push_on_array_at_entry(this._outputs_by_graph_id,n.graph_node_id,e.graph_node_id),this.find_leaves(n))}this._outputs_by_graph_id.forEach((e,t)=>{this._outputs_by_graph_id.set(t,o.default(e))})}find_leaves(e){var t;null===(t=this._graph_ids_by_shader_name.get(this._shader_name))||void 0===t||t.set(e.graph_node_id,!0);const n=r.default(e.io.inputs.inputs()),s=o.default(n.map(e=>e.graph_node_id)).map(e=>this._graph.node_from_id(e));if(s.length>0)for(let t of s)i.MapUtils.push_on_array_at_entry(this._outputs_by_graph_id,t.graph_node_id,e.graph_node_id),this.find_leaves(t);else this._leaves_graph_id.get(this._shader_name).set(e.graph_node_id,!0)}set_nodes_depth(){this._leaves_graph_id.forEach((e,t)=>{e.forEach((e,t)=>{this.set_node_depth(t)})})}set_node_depth(e,t=0){const n=this._depth_by_graph_id.get(e);null!=n?this._depth_by_graph_id.set(e,Math.max(n,t)):this._depth_by_graph_id.set(e,t);const s=this._outputs_by_graph_id.get(e);s&&s.forEach(e=>{this.set_node_depth(e,t+1)})}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(34),r=n(5);class o extends r.NodeParamsConfig{}const i=new o;class a extends s.TypedGlNode{constructor(){super(...arguments),this.params_config=i}static type(){return"globals"}create_params(){var e;null===(e=this.material_node)||void 0===e||e.assembler_controller.add_globals_params(this)}set_lines(e){var t,n;null===(n=null===(t=this.material_node)||void 0===t?void 0:t.assembler_controller)||void 0===n||n.assembler.set_node_lines_globals(this,e)}}t.GlobalsGlNode=a},function(e,t,n){"use strict";n.r(t),n.d(t,"OrbitControls",(function(){return c})),n.d(t,"MapControls",(function(){return l}));var s=n(43),r=n(0),o=n(42),i=n(292),a=n(2),_=n(1),c=function(e,t){var n,s,c,l,u;void 0===t&&console.warn('THREE.OrbitControls: The second parameter "domElement" is now mandatory.'),t===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),this.object=e,this.domElement=t,this.enabled=!0,this.target=new _.Vector3,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!1,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.enableKeys=!0,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={LEFT:r.MOUSE.ROTATE,MIDDLE:r.MOUSE.DOLLY,RIGHT:r.MOUSE.PAN},this.touches={ONE:r.TOUCH.ROTATE,TWO:r.TOUCH.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=function(){return y.phi},this.getAzimuthalAngle=function(){return y.theta},this.saveState=function(){d.target0.copy(d.target),d.position0.copy(d.object.position),d.zoom0=d.object.zoom},this.reset=function(){d.target.copy(d.target0),d.object.position.copy(d.position0),d.object.zoom=d.zoom0,d.object.updateProjectionMatrix(),d.dispatchEvent(h),d.update(),g=f.NONE},this.update=(n=new _.Vector3,s=(new o.Quaternion).setFromUnitVectors(e.up,new _.Vector3(0,1,0)),c=s.clone().inverse(),l=new _.Vector3,u=new o.Quaternion,function(){var e=d.object.position;return n.copy(e).sub(d.target),n.applyQuaternion(s),y.setFromVector3(n),d.autoRotate&&g===f.NONE&&L(2*Math.PI/60/60*d.autoRotateSpeed),d.enableDamping?(y.theta+=b.theta*d.dampingFactor,y.phi+=b.phi*d.dampingFactor):(y.theta+=b.theta,y.phi+=b.phi),y.theta=Math.max(d.minAzimuthAngle,Math.min(d.maxAzimuthAngle,y.theta)),y.phi=Math.max(d.minPolarAngle,Math.min(d.maxPolarAngle,y.phi)),y.makeSafe(),y.radius*=x,y.radius=Math.max(d.minDistance,Math.min(d.maxDistance,y.radius)),!0===d.enableDamping?d.target.addScaledVector(T,d.dampingFactor):d.target.add(T),n.setFromSpherical(y),n.applyQuaternion(c),e.copy(d.target).add(n),d.object.lookAt(d.target),!0===d.enableDamping?(b.theta*=1-d.dampingFactor,b.phi*=1-d.dampingFactor,T.multiplyScalar(1-d.dampingFactor)):(b.set(0,0,0),T.set(0,0,0)),x=1,!!(C||l.distanceToSquared(d.object.position)>v||8*(1-u.dot(d.object.quaternion))>v)&&(d.dispatchEvent(h),l.copy(d.object.position),u.copy(d.object.quaternion),C=!1,!0)}),this.dispose=function(){d.domElement.removeEventListener("contextmenu",re,!1),d.domElement.removeEventListener("mousedown",J,!1),d.domElement.removeEventListener("wheel",Q,!1),d.domElement.removeEventListener("touchstart",te,!1),d.domElement.removeEventListener("touchend",se,!1),d.domElement.removeEventListener("touchmove",ne,!1),document.removeEventListener("mousemove",K,!1),document.removeEventListener("mouseup",Z,!1),d.domElement.removeEventListener("keydown",ee,!1)};var d=this,h={type:"change"},p={type:"start"},m={type:"end"},f={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},g=f.NONE,v=1e-6,y=new i.a,b=new i.a,x=1,T=new _.Vector3,C=!1,P=new a.Vector2,w=new a.Vector2,E=new a.Vector2,O=new a.Vector2,A=new a.Vector2,N=new a.Vector2,M=new a.Vector2,S=new a.Vector2,R=new a.Vector2;function j(){return Math.pow(.95,d.zoomSpeed)}function L(e){b.theta-=e}function k(e){b.phi-=e}var G,z=(G=new _.Vector3,function(e,t){G.setFromMatrixColumn(t,0),G.multiplyScalar(-e),T.add(G)}),I=function(){var e=new _.Vector3;return function(t,n){!0===d.screenSpacePanning?e.setFromMatrixColumn(n,1):(e.setFromMatrixColumn(n,0),e.crossVectors(d.object.up,e)),e.multiplyScalar(t),T.add(e)}}(),D=function(){var e=new _.Vector3;return function(t,n){var s=d.domElement;if(d.object.isPerspectiveCamera){var r=d.object.position;e.copy(r).sub(d.target);var o=e.length();o*=Math.tan(d.object.fov/2*Math.PI/180),z(2*t*o/s.clientHeight,d.object.matrix),I(2*n*o/s.clientHeight,d.object.matrix)}else d.object.isOrthographicCamera?(z(t*(d.object.right-d.object.left)/d.object.zoom/s.clientWidth,d.object.matrix),I(n*(d.object.top-d.object.bottom)/d.object.zoom/s.clientHeight,d.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),d.enablePan=!1)}}();function F(e){d.object.isPerspectiveCamera?x/=e:d.object.isOrthographicCamera?(d.object.zoom=Math.max(d.minZoom,Math.min(d.maxZoom,d.object.zoom*e)),d.object.updateProjectionMatrix(),C=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),d.enableZoom=!1)}function B(e){d.object.isPerspectiveCamera?x*=e:d.object.isOrthographicCamera?(d.object.zoom=Math.max(d.minZoom,Math.min(d.maxZoom,d.object.zoom/e)),d.object.updateProjectionMatrix(),C=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),d.enableZoom=!1)}function V(e){P.set(e.clientX,e.clientY)}function U(e){O.set(e.clientX,e.clientY)}function q(e){if(1==e.touches.length)P.set(e.touches[0].pageX,e.touches[0].pageY);else{var t=.5*(e.touches[0].pageX+e.touches[1].pageX),n=.5*(e.touches[0].pageY+e.touches[1].pageY);P.set(t,n)}}function $(e){if(1==e.touches.length)O.set(e.touches[0].pageX,e.touches[0].pageY);else{var t=.5*(e.touches[0].pageX+e.touches[1].pageX),n=.5*(e.touches[0].pageY+e.touches[1].pageY);O.set(t,n)}}function Y(e){var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY,s=Math.sqrt(t*t+n*n);M.set(0,s)}function H(e){if(1==e.touches.length)w.set(e.touches[0].pageX,e.touches[0].pageY);else{var t=.5*(e.touches[0].pageX+e.touches[1].pageX),n=.5*(e.touches[0].pageY+e.touches[1].pageY);w.set(t,n)}E.subVectors(w,P).multiplyScalar(d.rotateSpeed);var s=d.domElement;L(2*Math.PI*E.x/s.clientHeight),k(2*Math.PI*E.y/s.clientHeight),P.copy(w)}function X(e){if(1==e.touches.length)A.set(e.touches[0].pageX,e.touches[0].pageY);else{var t=.5*(e.touches[0].pageX+e.touches[1].pageX),n=.5*(e.touches[0].pageY+e.touches[1].pageY);A.set(t,n)}N.subVectors(A,O).multiplyScalar(d.panSpeed),D(N.x,N.y),O.copy(A)}function W(e){var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY,s=Math.sqrt(t*t+n*n);S.set(0,s),R.set(0,Math.pow(S.y/M.y,d.zoomSpeed)),F(R.y),M.copy(S)}function J(e){if(!1!==d.enabled){var t;switch(e.preventDefault(),d.domElement.focus?d.domElement.focus():window.focus(),e.button){case 0:t=d.mouseButtons.LEFT;break;case 1:t=d.mouseButtons.MIDDLE;break;case 2:t=d.mouseButtons.RIGHT;break;default:t=-1}switch(t){case r.MOUSE.DOLLY:if(!1===d.enableZoom)return;!function(e){M.set(e.clientX,e.clientY)}(e),g=f.DOLLY;break;case r.MOUSE.ROTATE:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===d.enablePan)return;U(e),g=f.PAN}else{if(!1===d.enableRotate)return;V(e),g=f.ROTATE}break;case r.MOUSE.PAN:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===d.enableRotate)return;V(e),g=f.ROTATE}else{if(!1===d.enablePan)return;U(e),g=f.PAN}break;default:g=f.NONE}g!==f.NONE&&(document.addEventListener("mousemove",K,!1),document.addEventListener("mouseup",Z,!1),d.dispatchEvent(p))}}function K(e){if(!1!==d.enabled)switch(e.preventDefault(),g){case f.ROTATE:if(!1===d.enableRotate)return;!function(e){w.set(e.clientX,e.clientY),E.subVectors(w,P).multiplyScalar(d.rotateSpeed);var t=d.domElement;L(2*Math.PI*E.x/t.clientHeight),k(2*Math.PI*E.y/t.clientHeight),P.copy(w),d.update()}(e);break;case f.DOLLY:if(!1===d.enableZoom)return;!function(e){S.set(e.clientX,e.clientY),R.subVectors(S,M),R.y>0?F(j()):R.y<0&&B(j()),M.copy(S),d.update()}(e);break;case f.PAN:if(!1===d.enablePan)return;!function(e){A.set(e.clientX,e.clientY),N.subVectors(A,O).multiplyScalar(d.panSpeed),D(N.x,N.y),O.copy(A),d.update()}(e)}}function Z(e){!1!==d.enabled&&(document.removeEventListener("mousemove",K,!1),document.removeEventListener("mouseup",Z,!1),d.dispatchEvent(m),g=f.NONE)}function Q(e){!1===d.enabled||!1===d.enableZoom||g!==f.NONE&&g!==f.ROTATE||(e.preventDefault(),e.stopPropagation(),d.dispatchEvent(p),function(e){e.deltaY<0?B(j()):e.deltaY>0&&F(j()),d.update()}(e),d.dispatchEvent(m))}function ee(e){!1!==d.enabled&&!1!==d.enableKeys&&!1!==d.enablePan&&function(e){var t=!1;switch(e.keyCode){case d.keys.UP:D(0,d.keyPanSpeed),t=!0;break;case d.keys.BOTTOM:D(0,-d.keyPanSpeed),t=!0;break;case d.keys.LEFT:D(d.keyPanSpeed,0),t=!0;break;case d.keys.RIGHT:D(-d.keyPanSpeed,0),t=!0}t&&(e.preventDefault(),d.update())}(e)}function te(e){if(!1!==d.enabled){switch(e.preventDefault(),e.touches.length){case 1:switch(d.touches.ONE){case r.TOUCH.ROTATE:if(!1===d.enableRotate)return;q(e),g=f.TOUCH_ROTATE;break;case r.TOUCH.PAN:if(!1===d.enablePan)return;$(e),g=f.TOUCH_PAN;break;default:g=f.NONE}break;case 2:switch(d.touches.TWO){case r.TOUCH.DOLLY_PAN:if(!1===d.enableZoom&&!1===d.enablePan)return;!function(e){d.enableZoom&&Y(e),d.enablePan&&$(e)}(e),g=f.TOUCH_DOLLY_PAN;break;case r.TOUCH.DOLLY_ROTATE:if(!1===d.enableZoom&&!1===d.enableRotate)return;!function(e){d.enableZoom&&Y(e),d.enableRotate&&q(e)}(e),g=f.TOUCH_DOLLY_ROTATE;break;default:g=f.NONE}break;default:g=f.NONE}g!==f.NONE&&d.dispatchEvent(p)}}function ne(e){if(!1!==d.enabled)switch(e.preventDefault(),e.stopPropagation(),g){case f.TOUCH_ROTATE:if(!1===d.enableRotate)return;H(e),d.update();break;case f.TOUCH_PAN:if(!1===d.enablePan)return;X(e),d.update();break;case f.TOUCH_DOLLY_PAN:if(!1===d.enableZoom&&!1===d.enablePan)return;!function(e){d.enableZoom&&W(e),d.enablePan&&X(e)}(e),d.update();break;case f.TOUCH_DOLLY_ROTATE:if(!1===d.enableZoom&&!1===d.enableRotate)return;!function(e){d.enableZoom&&W(e),d.enableRotate&&H(e)}(e),d.update();break;default:g=f.NONE}}function se(e){!1!==d.enabled&&(d.dispatchEvent(m),g=f.NONE)}function re(e){!1!==d.enabled&&e.preventDefault()}d.domElement.addEventListener("contextmenu",re,!1),d.domElement.addEventListener("mousedown",J,!1),d.domElement.addEventListener("wheel",Q,!1),d.domElement.addEventListener("touchstart",te,!1),d.domElement.addEventListener("touchend",se,!1),d.domElement.addEventListener("touchmove",ne,!1),d.domElement.addEventListener("keydown",ee,!1),-1===d.domElement.tabIndex&&(d.domElement.tabIndex=0),this.update()};c.prototype=Object.create(s.a.prototype),c.prototype.constructor=c;var l=function(e,t){c.call(this,e,t),this.mouseButtons.LEFT=r.MOUSE.PAN,this.mouseButtons.RIGHT=r.MOUSE.ROTATE,this.touches.ONE=r.TOUCH.PAN,this.touches.TWO=r.TOUCH.DOLLY_ROTATE};l.prototype=Object.create(s.a.prototype),l.prototype.constructor=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(34),r=n(5),o=n(133);r.NodeParamsConfig;class i extends s.TypedGlNode{constructor(){super(...arguments),this.gl_connections_controller=new o.GlConnectionsController(this)}initialize_node(){super.initialize_node(),this.gl_connections_controller.initialize_node()}}t.BaseAdaptiveGlNode=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(36),r=n(16),o=n(29);function i(e,t={}){const n=t.method||e,i=t.out||"val",a=t.in||["in0","in1"],_=t.default_in_type,c=t.allowed_in_types,l=t.out_type,u=t.functions||[];return class extends s.BaseNodeGlMathFunctionArg2GlNode{static type(){return e}initialize_node(){super.initialize_node(),this.gl_connections_controller.set_input_name_function(this._gl_input_name.bind(this)),this.gl_connections_controller.set_output_name_function(this._gl_output_name.bind(this)),this.gl_connections_controller.set_expected_input_types_function(this._expected_input_types.bind(this)),l&&this.gl_connections_controller.set_expected_output_types_function(()=>[l])}_gl_input_name(e){return a[e]}_gl_output_name(e){return i}gl_method_name(){return n}gl_function_definitions(){return l?u.map(e=>new o.FunctionGLDefinition(this,l,e)):[]}_expected_input_types(){let e=this.gl_connections_controller.first_input_connection_type();if(e&&c&&!c.includes(e)){const t=this.io.inputs.named_input_connection_points[0];e=t?t.type:_}const t=e||_||r.ConnectionPointType.FLOAT;return[t,t]}}}t.MathFunctionArg2Factory=i;class a extends(i("distance",{in:["p0","p1"],default_in_type:r.ConnectionPointType.VEC3,allowed_in_types:[r.ConnectionPointType.VEC2,r.ConnectionPointType.VEC3,r.ConnectionPointType.VEC4],out_type:r.ConnectionPointType.FLOAT})){}t.DistanceGlNode=a;class _ extends(i("dot",{in:["vec0","vec1"],default_in_type:r.ConnectionPointType.VEC3,allowed_in_types:[r.ConnectionPointType.VEC2,r.ConnectionPointType.VEC3,r.ConnectionPointType.VEC4],out_type:r.ConnectionPointType.FLOAT})){}t.DotGlNode=_;class c extends(i("max")){}t.MaxGlNode=c;class l extends(i("min")){}t.MinGlNode=l;class u extends(i("mod")){}t.ModGlNode=u;class d extends(i("pow",{in:["x","y"]})){}t.PowGlNode=d;class h extends(i("reflect",{in:["I","N"],default_in_type:r.ConnectionPointType.VEC3})){}t.ReflectGlNode=h;class p extends(i("step",{in:["edge","x"]})){}t.StepGlNode=p},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(34),r=n(28),o=n(16);function i(e){return{visible_if:{type:o.ConnectionPointTypes.indexOf(e)}}}const a=n(5),_=n(133);class c extends a.NodeParamsConfig{constructor(){super(...arguments),this.type=a.ParamConfig.INTEGER(o.ConnectionPointTypes.indexOf(o.ConnectionPointType.FLOAT),{menu:{entries:o.ConnectionPointTypes.map((e,t)=>({name:e,value:t}))}}),this.bool=a.ParamConfig.BOOLEAN(0,i(o.ConnectionPointType.BOOL)),this.int=a.ParamConfig.INTEGER(0,i(o.ConnectionPointType.INT)),this.float=a.ParamConfig.FLOAT(0,i(o.ConnectionPointType.FLOAT)),this.vec2=a.ParamConfig.VECTOR2([0,0],i(o.ConnectionPointType.VEC2)),this.vec3=a.ParamConfig.VECTOR3([0,0,0],i(o.ConnectionPointType.VEC3)),this.vec4=a.ParamConfig.VECTOR4([0,0,0,0],i(o.ConnectionPointType.VEC4))}}const l=new c;class u extends s.TypedGlNode{constructor(){super(...arguments),this.params_config=l,this.gl_connections_controller=new _.GlConnectionsController(this),this._allow_inputs_created_from_params=!1}static type(){return"constant"}initialize_node(){this.gl_connections_controller.initialize_node(),this.gl_connections_controller.set_output_name_function(e=>u.OUTPUT_NAME),this.gl_connections_controller.set_expected_input_types_function(()=>[]),this.gl_connections_controller.set_expected_output_types_function(()=>[this._current_connection_type])}set_lines(e){const t=this._current_param;if(t){const n=this._current_connection_type,s=r.ThreeToGl.any(t.value),o=`${n} ${this._current_var_name} = ${s}`;e.add_body_lines(this,[o])}else console.warn(`no param found for constant node for type '${this.pv.type}'`)}get _current_connection_type(){null==this.pv.type&&console.warn("constant gl node type if not valid");const e=o.ConnectionPointTypes[this.pv.type];return null==e&&console.warn("constant gl node type if not valid"),e}get _current_param(){this._params_by_type=this._params_by_type||new Map([[o.ConnectionPointType.BOOL,this.p.bool],[o.ConnectionPointType.INT,this.p.int],[o.ConnectionPointType.FLOAT,this.p.float],[o.ConnectionPointType.VEC2,this.p.vec2],[o.ConnectionPointType.VEC3,this.p.vec3],[o.ConnectionPointType.VEC4,this.p.vec4]]);const e=o.ConnectionPointTypes[this.pv.type];return this._params_by_type.get(e)}get _current_var_name(){return this.gl_var_name(u.OUTPUT_NAME)}}t.ConstantGlNode=u,u.OUTPUT_NAME="val"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(36),r=n(16),o=n(29);function i(e,t={}){const n=t.method||e,i=t.out||"val",a=t.in||["in0","in1","in2"],_=t.default||{},c=t.out_type||r.ConnectionPointType.FLOAT,l=t.functions||[];return class extends s.BaseNodeGlMathFunctionArg3GlNode{static type(){return e}initialize_node(){super.initialize_node(),this.gl_connections_controller.set_input_name_function(this._gl_input_name.bind(this)),this.gl_connections_controller.set_output_name_function(this._gl_output_name.bind(this)),this.gl_connections_controller.set_expected_output_types_function(this._expected_output_types.bind(this))}_gl_input_name(e){return a[e]}_gl_output_name(e){return i}gl_method_name(){return n}_expected_output_types(){return[c]}gl_input_default_value(e){return _[e]}gl_function_definitions(){return l.map(e=>new o.FunctionGLDefinition(this,c,e))}}}t.MathFunctionArg3Factory=i;class a extends(i("clamp",{in:["value","min","max"],default:{max:1}})){}t.ClampGlNode=a;class _ extends(i("face_forward",{in:["N","I","Nref"]})){}t.FaceforwardGlNode=_;class c extends(i("smoothstep",{in:["edge0","edge1","x"]})){}t.SmoothStepGlNode=c},function(e,t,n){"use strict";n.r(t),t.default="\nfloat fit01(float val, float src_min, float src_max){\n\tfloat size = src_max - src_min;\n\treturn (val - src_min) / size;\n}\nvec2 fit01(vec2 val, vec2 src_min, vec2 src_max){\n\treturn vec2(\n\t\tfit01(val.x, src_min.x, src_max.x),\n\t\tfit01(val.y, src_min.y, src_max.y)\n\t);\n}\nvec3 fit01(vec3 val, vec3 src_min, vec3 src_max){\n\treturn vec3(\n\t\tfit01(val.x, src_min.x, src_max.x),\n\t\tfit01(val.y, src_min.y, src_max.y),\n\t\tfit01(val.z, src_min.z, src_max.z)\n\t);\n}\nvec4 fit01(vec4 val, vec4 src_min, vec4 src_max){\n\treturn vec4(\n\t\tfit01(val.x, src_min.x, src_max.x),\n\t\tfit01(val.y, src_min.y, src_max.y),\n\t\tfit01(val.z, src_min.z, src_max.z),\n\t\tfit01(val.w, src_min.w, src_max.w)\n\t);\n}\n\nfloat fit(float val, float src_min, float src_max, float dest_min, float dest_max){\n\tfloat  src_range = src_max - src_min;\n\tfloat dest_range = dest_max - dest_min;\n\n\tfloat r = (val - src_min) / src_range;\n\treturn (r * dest_range) + dest_min;\n}\nvec2 fit(vec2 val, vec2 src_min, vec2 src_max, vec2 dest_min, vec2 dest_max){\n\treturn vec2(\n\t\tfit(val.x, src_min.x, src_max.x, dest_min.x, dest_max.x),\n\t\tfit(val.y, src_min.y, src_max.y, dest_min.y, dest_max.y)\n\t);\n}\nvec3 fit(vec3 val, vec3 src_min, vec3 src_max, vec3 dest_min, vec3 dest_max){\n\treturn vec3(\n\t\tfit(val.x, src_min.x, src_max.x, dest_min.x, dest_max.x),\n\t\tfit(val.y, src_min.y, src_max.y, dest_min.y, dest_max.y),\n\t\tfit(val.z, src_min.z, src_max.z, dest_min.z, dest_max.z)\n\t);\n}\nvec4 fit(vec4 val, vec4 src_min, vec4 src_max, vec4 dest_min, vec4 dest_max){\n\treturn vec4(\n\t\tfit(val.x, src_min.x, src_max.x, dest_min.x, dest_max.x),\n\t\tfit(val.y, src_min.y, src_max.y, dest_min.y, dest_max.y),\n\t\tfit(val.z, src_min.z, src_max.z, dest_min.z, dest_max.z),\n\t\tfit(val.w, src_min.w, src_max.w, dest_min.w, dest_max.w)\n\t);\n}\n"},function(e,t,n){"use strict";n.r(t),t.default="uniform float mNear;\nuniform float mFar;\n\nvarying float vViewZDepth;\n\nvoid main() {\n\n\tfloat color = 1.0 - smoothstep( mNear, mFar, vViewZDepth );\n\tgl_FragColor = vec4( vec3( color ), 1.0 );\n\n}\n"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),r=n(59),o=n(0),i=n(68),a=n(5),_=n(197),c=n(105),l=n(116),u=n(117),d=n(118),h=n(374);t.SHADER_DEFAULTS={metalness:1,roughness:.5};class p extends(h.TextureEnvMapParamConfig(d.TextureAlphaMapParamConfig(u.TextureMapParamConfig(l.SkinningParamConfig(c.SideParamConfig(_.ColorParamConfig(a.NodeParamsConfig))))))){constructor(){super(...arguments),this.metalness=a.ParamConfig.FLOAT(t.SHADER_DEFAULTS.metalness),this.roughness=a.ParamConfig.FLOAT(t.SHADER_DEFAULTS.roughness)}}const m=new p;class f extends i.TypedMatNode{constructor(){super(...arguments),this.params_config=m,this.texture_map_controller=new u.TextureMapController(this,{direct_params:!0}),this.texture_alpha_map_controller=new d.TextureAlphaMapController(this,{direct_params:!0}),this.texture_env_map_controller=new h.TextureEnvMapController(this,{direct_params:!0})}static type(){return"mesh_standard"}create_material(){return new r.MeshStandardMaterial({vertexColors:!1,side:o.FrontSide,color:16777215,opacity:1,metalness:1,roughness:0})}initialize_node(){this.params.set_post_create_params_hook(()=>{this.texture_map_controller.initialize_node(),this.texture_alpha_map_controller.initialize_node(),this.texture_env_map_controller.initialize_node()})}cook(){return s.__awaiter(this,void 0,void 0,(function*(){_.ColorsController.update(this),c.SideController.update(this),l.SkinningController.update(this),this.texture_map_controller.update(),this.texture_alpha_map_controller.update(),this.texture_env_map_controller.update(),this._material&&(this._material.envMapIntensity=this.pv.env_map_intensity,this._material.roughness=this.pv.roughness,this._material.metalness=this.pv.metalness),this.set_material(this.material)}))}}t.MeshStandardMatNode=f},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),r=n(9),o=n(134),i=n(68),a=n(270),_=n(5);function c(e){return class extends e{constructor(){super(...arguments),this.use_env_map=_.ParamConfig.BOOLEAN(0,a.BooleanParamOptions(l)),this.env_map=_.ParamConfig.OPERATOR_PATH(o.FileCopNode.DEFAULT_NODE_PATH.ENV_MAP,a.OperatorPathOptions(l,"use_env_map")),this.env_map_intensity=_.ParamConfig.FLOAT(1,{visible_if:{use_env_map:1}})}}}t.TextureEnvMapParamConfig=c;r.Material;c(_.NodeParamsConfig);i.TypedMatNode;class l extends a.BaseTextureMapController{constructor(e,t){super(e,t)}initialize_node(){this.add_hooks(this.node.p.use_env_map,this.node.p.env_map)}update(){return s.__awaiter(this,void 0,void 0,(function*(){this._update(this.node.material,"envMap",this.node.p.use_env_map,this.node.p.env_map)}))}static update(e){return s.__awaiter(this,void 0,void 0,(function*(){e.texture_env_map_controller.update()}))}}t.TextureEnvMapController=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),r=n(5),o=n(198),i=n(105),a=n(116),_=n(117),c=n(118),l=n(778),u=n(199),d=n(131);class h extends(c.TextureAlphaMapParamConfig(_.TextureMapParamConfig(a.SkinningParamConfig(i.SideParamConfig(o.ColorParamConfig(r.NodeParamsConfig)))))){}const p=new h;class m extends u.TypedBuilderMatNode{constructor(){super(...arguments),this.params_config=p}static type(){return"points_builder"}initialize_node(){}_create_assembler_controller(){return new d.GlAssemblerController(this,l.ShaderAssemblerPoints)}cook(){return s.__awaiter(this,void 0,void 0,(function*(){yield this.compile_if_required(),o.ColorsController.update(this),i.SideController.update(this),a.SkinningController.update(this),this.set_material(this.material)}))}}t.PointsBuilderMatNode=m},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),r=s.__importDefault(n(154)),o=n(85),i=n(69),a=n(809),_=n(205),c=n(206),l=n(812),u=n(135),d=n(27),h={type:"change"};t.BASE_CAMERA_DEFAULT={near:1,far:100};const p=n(94),m=n(206),f=n(135),g=n(205),v=n(5),y=n(84),b=n(69);function x(e){return class extends e{constructor(){super(...arguments),this.camera=v.ParamConfig.FOLDER(),this.controls=v.ParamConfig.OPERATOR_PATH("",{node_selection:{context:d.NodeContext.EVENT}}),this.target=v.ParamConfig.VECTOR3([0,0,0],{cook:!1}),this.near=v.ParamConfig.FLOAT(t.BASE_CAMERA_DEFAULT.near,{range:[0,100]}),this.far=v.ParamConfig.FLOAT(t.BASE_CAMERA_DEFAULT.far,{range:[0,100]}),this.set_master_camera=v.ParamConfig.BUTTON(null,{callback:(e,t)=>{P.PARAM_CALLBACK_set_master_camera(e)}})}}}t.CameraTransformParamConfig=x;class T extends(m.CameraPostProcessParamConfig(f.CameraBackgroundParamConfig(y.TransformedParamConfig(g.LayerParamConfig(x(v.NodeParamsConfig)))))){}t.BaseCameraObjParamsConfig=T;class C extends b.TypedObjNode{constructor(){super(...arguments),this.render_order=i.ObjNodeRenderOrder.CAMERA,this._aspect=-1,this.transform_controller=new y.TransformController(this),this.flags=new p.FlagsControllerD(this)}get object(){return this._object}get background_controller(){return this._background_controller=this._background_controller||new this.background_controller_constructor(this)}get background_controller_constructor(){return u.BaseBackgroundController}get controls_controller(){return this._controls_controller=this._controls_controller||new a.ControlsController(this)}get layers_controller(){return this._layers_controller=this._layers_controller||new _.LayersController(this)}get post_process_controller(){return this._post_process_controller=this._post_process_controller||new c.PostProcessController(this)}initialize_base_node(){super.initialize_base_node(),this.io.outputs.set_has_one_output(),this.transform_controller.initialize_node()}cook(){return s.__awaiter(this,void 0,void 0,(function*(){this.transform_controller.update(),this.layers_controller.update(),yield this.background_controller.update(),this._object.near==this.pv.near&&this._object.far==this.pv.far||(this._object.near=this.pv.near,this._object.far=this.pv.far,this._object.updateProjectionMatrix()),yield this.post_process_controller.update_composer_passes(),this.update_camera(),this.controls_controller.update_controls(),this._object.dispatchEvent(h),this.cook_controller.end_cook()}))}on_create(){}on_delete(){}camera(){return this._object}update_camera(){}static PARAM_CALLBACK_set_master_camera(e){e.set_as_master_camera()}set_as_master_camera(){this.scene.cameras_controller.set_master_camera_node_path(this.full_path())}setup_for_aspect_ratio(e){r.default(e)||e&&this._aspect!=e&&(this._aspect=e,this._update_for_aspect_ratio())}_update_for_aspect_ratio(){}update_transform_params_from_object(){o.CoreTransform.set_params_from_object(this._object,this)}create_viewer(e){return new l.ThreejsViewer(e,this.scene,this)}}t.TypedCameraObjNode=C;class P extends C{}t.BaseCameraObjNodeClass=P},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),r=s.__importDefault(n(91)),o=s.__importDefault(n(92)),i=s.__importDefault(n(154)),a=s.__importDefault(n(188)),_=s.__importDefault(n(83)),c=s.__importDefault(n(207)),l=n(1),u=n(40),d=n(58),h=n(273),p=n(53),m=n(114),f=n(49),g=n(35);class v{constructor(){this.touch()}timestamp(){return this._timestamp}touch(){this._timestamp=performance.now(),this.reset()}reset(){this._bounding_box=void 0,this._core_geometries=void 0,this._core_objects=void 0}clone(){const e=new v;if(this._objects){const t=[];for(let e of this._objects)t.push(h.CoreObject.clone(e));e.set_objects(t)}return e}set_objects(e){this._objects=e,this.touch()}objects(){return this._objects}core_objects(){return this._core_objects=this._core_objects||this._create_core_objects()}_create_core_objects(){const e=[];if(this._objects)for(let t=0;t<this._objects.length;t++)this._objects[t].traverse(n=>{const s=new h.CoreObject(n,t);e.push(s)});return e}geometries(){const e=[];for(let t of this.core_objects()){const n=t.object().geometry;n&&e.push(n)}return e}core_geometries(){return this._core_geometries=this._core_geometries||this.create_core_geometries()}create_core_geometries(){const e=[];for(let t of this.geometries())e.push(new p.CoreGeometry(t));return e}__geometry_from_object(e,t){if(t.geometry)return e.push(t.geometry)}static geometry_from_object(e){return e.isMesh||e.isLine||e.isPoints?e.geometry:null}faces(){return _.default(this.core_geometries().map(e=>e.faces()))}points(){return _.default(this.core_geometries().map(e=>e.points()))}points_count(){return c.default(this.core_geometries().map(e=>e.points_count()))}points_from_group(e){if(e){const t=f.CoreString.indices(e),n=this.points();return o.default(t.map(e=>n[e]))}return this.points()}static from_objects(e){const t=new v;return t.set_objects(e),t}objects_from_group(e){return this.core_objects_from_group(e).map(e=>e.object())}core_objects_from_group(e){if(""!==(e=a.default(e))){const t=parseInt(e);return i.default(t)?this.core_objects().filter(t=>f.CoreString.match_mask(e,t.name())):o.default([this.core_objects()[t]])}return this.core_objects()}bounding_box(){return this._bounding_box=this._bounding_box||this._compute_bounding_box()}center(){const e=new l.Vector3;return this.bounding_box().getCenter(e),e}size(){const e=new l.Vector3;return this.bounding_box().getSize(e),e}_compute_bounding_box(){let e;if(this._objects)for(let t of this._objects){const n=t.geometry;n.computeBoundingBox(),e?e.expandByObject(t):n.boundingBox&&(e=n.boundingBox.clone())}return e=e||new d.Box3(new l.Vector3(-1,-1,-1),new l.Vector3(1,1,1)),e}compute_vertex_normals(){for(let e of this.core_objects())e.compute_vertex_normals()}has_attrib(e){let t;return null!=(t=this.core_geometries()[0])&&t.has_attrib(e)}attrib_type(e){const t=this.core_geometries()[0];return null!=t?t.attrib_type(e):null}rename_attrib(e,t,n){switch(n){case g.CoreConstant.ATTRIB_CLASS.VERTEX:if(this.has_attrib(e)&&this._objects)for(let n of this._objects)n.traverse(n=>{const s=v.geometry_from_object(n);if(s){new p.CoreGeometry(s).rename_attribute(e,t)}});break;case g.CoreConstant.ATTRIB_CLASS.OBJECT:if(this.has_attrib(e)&&this._objects)for(let n of this._objects)n.traverse(n=>{new h.CoreObject(n,0).rename_attribute(e,t)})}}attrib_names(){let e;return null!=(e=this.core_geometries()[0])?e.attrib_names():[]}object_attrib_names(){let e;return null!=(e=this.core_objects()[0])?e.attrib_names():[]}attrib_names_matching_mask(e){const t=f.CoreString.attrib_names(e),n=[];for(let e of this.attrib_names())for(let s of t)f.CoreString.match_mask(e,s)&&n.push(e);return r.default(n)}attrib_sizes(){let e;return null!=(e=this.core_geometries()[0])?e.attrib_sizes():{}}attrib_size(e){let t;return null!=(t=this.core_geometries()[0])?t.attrib_size(e):0}add_numeric_vertex_attrib(e,t,n){null==n&&(n=m.CoreAttribute.default_value(t));for(let s of this.core_geometries())s.add_numeric_attrib(e,t,n)}add_numeric_object_attrib(e,t,n){null==n&&(n=m.CoreAttribute.default_value(t));for(let t of this.core_objects())t.add_numeric_attrib(e,n)}static clone(e){const t=new u.Group;return e.children.forEach(e=>{const n=h.CoreObject.clone(e);t.add(n)}),t}}t.CoreGroup=v},,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(20),r=n(1),o=n(2),i=n(114),a=n(380),_="position",c="normal";var l;!function(e){e.x="x",e.y="y",e.z="z",e.w="w",e.r="r",e.g="g",e.b="b"}(l||(l={}));const u={x:0,y:1,z:2,w:3,r:0,g:1,b:2};class d extends a.CoreEntity{constructor(e,t){super(t),this._core_geometry=e,this._geometry=this._core_geometry.geometry()}geometry_wrapper(){return this._core_geometry}geometry(){return this._geometry=this._geometry||this._core_geometry.geometry()}attrib_size(e){return e=i.CoreAttribute.remap_name(e),this._geometry.getAttribute(e).itemSize}has_attrib(e){const t=i.CoreAttribute.remap_name(e);return this._core_geometry.has_attrib(t)}attrib_value(e){if("ptnum"===e)return this.index;{let t=null,n=null;"."===e[e.length-2]&&(t=e[e.length-1],n=u[t],e=e.substring(0,e.length-2));const a=i.CoreAttribute.remap_name(e),_=this._geometry.getAttribute(a);if(!_){const t=`attrib ${e} not found. availables are: ${Object.keys(this._geometry.attributes||{}).join(",")}`;throw console.warn(t),t}{const{array:e}=_;if(this._core_geometry.is_attrib_indexed(a)){const e=this.attrib_value_index(a);return this._core_geometry.user_data_attrib(a)[e]}{const t=_.itemSize,i=this._index*t;if(null==n)switch(t){case 1:return e[i];case 2:return new o.Vector2(e[i+0],e[i+1]);case 3:return new r.Vector3(e[i+0],e[i+1],e[i+2]);case 4:return new s.Vector4(e[i+0],e[i+1],e[i+2],e[i+3]);default:throw`size not valid (${t})`}else switch(t){case 1:return e[i];default:return e[i+n]}}}}}attrib_value_index(e){return this._core_geometry.is_attrib_indexed(e)?this._geometry.getAttribute(e).array[this._index]:-1}position(){const{array:e}=this._geometry.getAttribute(_);return this._position=this._position||new r.Vector3,this._position.fromArray(e,3*this._index)}set_position(e){this.set_attrib_value_vector3(_,e)}normal(){const{array:e}=this._geometry.getAttribute(c);return this._normal=this._normal||new r.Vector3,this._normal.fromArray(e,3*this._index)}set_normal(e){return this.set_attrib_value_vector3(c,e)}set_attrib_value(e,t){if(null==t)return;if(null==e)throw"Point.set_attrib_value requires a name";const n=this._geometry.getAttribute(e),s=n.array,r=n.itemSize;switch(r){case 1:s[this._index]=t;break;case 2:const e=t;s[2*this._index+0]=e.x,s[2*this._index+1]=e.y;break;case 3:if(null!=t.r){const e=t;s[3*this._index+0]=e.r,s[3*this._index+1]=e.g,s[3*this._index+2]=e.b}else{const e=t;s[3*this._index+0]=e.x,s[3*this._index+1]=e.y,s[3*this._index+2]=e.z}break;default:throw console.warn(`Point.set_attrib_value does not yet allow attrib size ${r}`),`attrib size ${r} not implemented`}}set_attrib_value_vector3(e,t){if(null==t)return;if(null==e)throw"Point.set_attrib_value requires a name";const n=this._geometry.getAttribute(e).array,s=3*this._index;n[s]=t.x,n[s+1]=t.y,n[s+2]=t.z}set_attrib_index(e,t){return this._geometry.getAttribute(e).array[this._index]=t}}t.CorePoint=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.CoreEntity=class{constructor(e){this._index=e}get index(){return this._index}}},,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3);t.CoreIterator=class{constructor(e={}){this._array_index=0,this._count=0,this._current_count_index=0,this._resolve=null,this._max_time_per_chunk=e.max_time_per_chunk||10,this._check_every_interations=e.check_every_interations||100}start_with_count(e,t){return s.__awaiter(this,void 0,void 0,(function*(){if(this._count=e,this._current_count_index=0,this._iteratee_method_count=t,this._bound_next_with_count=this.next_with_count.bind(this),this._resolve)throw"an iterator cannot be started twice";return new Promise((e,t)=>{this._resolve=e,this.next_with_count()})}))}next_with_count(){const e=performance.now();if(this._iteratee_method_count&&this._bound_next_with_count)for(;this._current_count_index<this._count;)if(this._iteratee_method_count(this._current_count_index),this._current_count_index++,this._current_count_index%this._check_every_interations==0&&performance.now()-e>this._max_time_per_chunk){setTimeout(this._bound_next_with_count,1);break}this._current_count_index>=this._count&&this._resolve&&this._resolve()}start_with_array(e,t){return s.__awaiter(this,void 0,void 0,(function*(){if(this._array=e,this._array_index=0,this._iteratee_method_array=t,this._bound_next_with_array=this.next_with_array.bind(this),this._resolve)throw"an iterator cannot be started twice";return new Promise((e,t)=>{this._resolve=e,this.next_with_array()})}))}next_with_array(){const e=performance.now();if(this._iteratee_method_array&&this._bound_next_with_array&&this._array)for(;this._current_array_element=this._array[this._array_index];)if(this._iteratee_method_array(this._current_array_element,this._array_index),this._array_index++,this._array_index%this._check_every_interations==0&&performance.now()-e>this._max_time_per_chunk){setTimeout(this._bound_next_with_array,1);break}void 0===this._current_array_element&&this._resolve&&this._resolve()}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(104),r=n(2),o=n(4),i=n(6);t.CoreGeometryUtilCircle=class{static positions(e,t,n=360){const o=s.CoreMath.degrees_to_radians(n)/t,i=[];for(let n=0;n<t;n++){const t=o*n,s=e*Math.cos(t),a=e*Math.sin(t);i.push(new r.Vector2(s,a))}return i}static create(e,t,n=360){const s=this.positions(e,t,n),r=[],a=[];let _;for(let e=0;e<s.length;e++)_=s[e],r.push(_.x),r.push(_.y),r.push(0),e>0&&(a.push(e-1),a.push(e));a.push(t-1),a.push(0);const c=new i.BufferGeometry;return c.setAttribute("position",new o.Float32BufferAttribute(r,3)),c.setIndex(a),c}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3).__importDefault(n(44)),r=n(1),o=n(2),i=n(42),a=n(15),_=n(291),c=n(227),l=n(53),u={SCALE:new r.Vector3(1,1,1),PSCALE:1,EYE:new r.Vector3(0,0,0),UP:new r.Vector3(0,1,0)},d=new r.Vector3(1,1,1),h=new o.Vector2(0,0);class p{constructor(e){this._group_wrapper=e,this._matrices={},this._is_pscale_present=this._group_wrapper.has_attrib("pscale"),this._is_scale_present=this._group_wrapper.has_attrib("scale"),this._is_normal_present=this._group_wrapper.has_attrib("normal"),this._is_up_present=this._group_wrapper.has_attrib("up"),this._do_rotate_matrices=this._is_normal_present}matrices(){return this._matrices={},this._matrices.translate=new a.Matrix4,this._matrices.rotate=new a.Matrix4,this._matrices.scale=new a.Matrix4,this._group_wrapper.points().map(e=>this._matrix_from_point(e))}_matrix_from_point(e){const t=e.position();let n=this._is_scale_present?e.attrib_value("scale"):u.SCALE;const s=this._is_pscale_present?e.attrib_value("pscale"):u.PSCALE;n=n.clone().multiplyScalar(s);const r=new a.Matrix4;r.identity();const o=this._matrices.scale;o.makeScale(n.x,n.y,n.z);const i=this._matrices.translate;if(i.makeTranslation(t.x,t.y,t.z),r.multiply(i),this._do_rotate_matrices){const t=this._matrices.rotate,n=u.EYE,s=e.attrib_value("normal").multiplyScalar(-1),o=this._is_up_present?e.attrib_value("up"):u.UP;o.normalize(),t.lookAt(n,s,o),r.multiply(t)}return r.multiply(o),r}static create_instance_buffer_geo(e,t,n){const o=t.points(),a=new _.InstancedBufferGeometry;a.copy(e);const u=o.length,m=new Float32Array(3*u),f=new Float32Array(3*u),g=new Float32Array(3*u),v=new Float32Array(4*u),y=t.has_attrib("color"),b=new r.Vector3(0,0,0),x=new i.Quaternion,T=new r.Vector3(1,1,1),C=new p(t).matrices();o.forEach((e,t)=>{const n=3*t,s=4*t;C[t].decompose(b,x,T),b.toArray(m,n),x.toArray(v,s),T.toArray(g,n),(y?e.attrib_value("color"):d).toArray(f,n)});const P=t.has_attrib("uv");if(P){const e=new Float32Array(2*u);o.forEach((t,n)=>{const s=2*n;(P?t.attrib_value("uv"):h).toArray(e,s)}),a.setAttribute("instanceUv",new c.InstancedBufferAttribute(e,2))}return a.setAttribute("instancePosition",new c.InstancedBufferAttribute(m,3)),a.setAttribute("instanceScale",new c.InstancedBufferAttribute(g,3)),a.setAttribute("instanceOrientation",new c.InstancedBufferAttribute(v,4)),a.setAttribute("instanceColor",new c.InstancedBufferAttribute(f,3)),t.attrib_names_matching_mask(n).forEach(e=>{const n=t.attrib_size(e),r=new Float32Array(u*n);o.forEach((t,o)=>{const i=t.attrib_value(e);s.default(i)?r[o]=i:i.toArray(r,o*n)}),a.setAttribute(e,new c.InstancedBufferAttribute(r,n))}),new l.CoreGeometry(a).mark_as_instance(),a}}t.CoreInstancer=p},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),r=s.__importDefault(n(21)),o=s.__importDefault(n(65)),i=s.__importDefault(n(48)),a=s.__importDefault(n(83)),_=n(96),c=n(4),l={BufferGeometry:n(6).BufferGeometry,Float32BufferAttribute:c.Float32BufferAttribute,Points:_.Points},u=n(49),d=n(53),h=n(35),p=n(855),m=n(114);t.JsonDataLoader=class{constructor(e={}){this._attribute_datas_by_name={},this._options={},this._options.data_keys_prefix=e.data_keys_prefix,this._options.skip_entries=e.skip_entries,this._options.do_convert=e.do_convert||!1,this._options.convert_to_numeric=e.convert_to_numeric}load(e,t,n,r){fetch(e).then(e=>s.__awaiter(this,void 0,void 0,(function*(){this._json=yield e.json(),null!=this._options.data_keys_prefix&&""!=this._options.data_keys_prefix&&(this._json=this.get_prefixed_json(this._json,this._options.data_keys_prefix.split(".")));const n=this.create_object();t(n)}))).catch(e=>{console.log("error",e),r(e)})}get_prefixed_json(e,t){if(0==t.length)return e;{const n=t.shift();if(n)return this.get_prefixed_json(e[n],t)}return[]}set_json(e){return this._json=e}create_object(){const e=new l.BufferGeometry,t=new d.CoreGeometry(e);if(null!=this._json){const n=this._json.length;t.init_position_attribute(n),this._find_attributes();const s=u.CoreString.attrib_names(this._options.convert_to_numeric||"");for(let n of Object.keys(this._attribute_datas_by_name)){let r=a.default(this._attribute_values_for_name(n));const o=this._attribute_datas_by_name[n],_=o.size();if(o.type()===h.CoreConstant.ATTRIB_TYPE.STRING)if(this._options.do_convert&&u.CoreString.matches_one_mask(n,s)){const t=r.map(e=>i.default(e)?parseFloat(e)||0:e);e.setAttribute(n,new l.Float32BufferAttribute(t,_))}else{const e=m.CoreAttribute.array_to_indexed_arrays(r);t.set_indexed_attribute(n,e.values,e.indices)}else{const t=r;e.setAttribute(n,new l.Float32BufferAttribute(t,_))}}}return new l.Points(e,h.CoreConstant.MATERIALS[l.Points.name])}_find_attributes(){let e;const t=u.CoreString.attrib_names(this._options.skip_entries||"");if(this._json&&null!=(e=this._json[0]))for(let n of Object.keys(e)){const s=e[n];if(this._value_has_subentries(s))for(let e of Object.keys(s)){const r=[n,e].join(":"),o=s[n];u.CoreString.matches_one_mask(r,t)||(this._attribute_datas_by_name[r]=p.CoreAttributeData.from_value(o))}else u.CoreString.matches_one_mask(n,t)||(this._attribute_datas_by_name[n]=p.CoreAttributeData.from_value(s))}}_attribute_values_for_name(e){return this._json?this._json.map(t=>{const n=e.split(":")[0],s=t[n];if(this._value_has_subentries(s)){return s[e.substring(n.length+1)]||0}return s||0}):[]}_value_has_subentries(e){return o.default(e)&&!r.default(e)}}},,function(e,t,n){"use strict";n.r(t),n.d(t,"DRACOLoader",(function(){return a}));var s=n(4),r=n(6),o=n(30),i=n(18),a=function(e){i.a.call(this,e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}};a.prototype=Object.assign(Object.create(i.a.prototype),{constructor:a,setDecoderPath:function(e){return this.decoderPath=e,this},setDecoderConfig:function(e){return this.decoderConfig=e,this},setWorkerLimit:function(e){return this.workerLimit=e,this},setVerbosity:function(){console.warn("THREE.DRACOLoader: The .setVerbosity() method has been removed.")},setDrawMode:function(){console.warn("THREE.DRACOLoader: The .setDrawMode() method has been removed.")},setSkipDequantization:function(){console.warn("THREE.DRACOLoader: The .setSkipDequantization() method has been removed.")},load:function(e,t,n,s){var r=new o.a(this.manager);r.setPath(this.path),r.setResponseType("arraybuffer"),"use-credentials"===this.crossOrigin&&r.setWithCredentials(!0),r.load(e,e=>{var n={attributeIDs:this.defaultAttributeIDs,attributeTypes:this.defaultAttributeTypes,useUniqueIDs:!1};this.decodeGeometry(e,n).then(t).catch(s)},n,s)},decodeDracoFile:function(e,t,n,s){var r={attributeIDs:n||this.defaultAttributeIDs,attributeTypes:s||this.defaultAttributeTypes,useUniqueIDs:!!n};this.decodeGeometry(e,r).then(t)},decodeGeometry:function(e,t){for(var n in t.attributeTypes){var s=t.attributeTypes[n];void 0!==s.BYTES_PER_ELEMENT&&(t.attributeTypes[n]=s.name)}var r,o=JSON.stringify(t);if(a.taskCache.has(e)){var i=a.taskCache.get(e);if(i.key===o)return i.promise;if(0===e.byteLength)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}var _=this.workerNextTaskID++,c=e.byteLength,l=this._getWorker(_,c).then(n=>(r=n,new Promise((n,s)=>{r._callbacks[_]={resolve:n,reject:s},r.postMessage({type:"decode",id:_,taskConfig:t,buffer:e},[e])}))).then(e=>this._createGeometry(e.geometry));return l.finally(()=>{r&&_&&this._releaseTask(r,_)}),a.taskCache.set(e,{key:o,promise:l}),l},_createGeometry:function(e){var t=new r.BufferGeometry;e.index&&t.setIndex(new s.BufferAttribute(e.index.array,1));for(var n=0;n<e.attributes.length;n++){var o=e.attributes[n],i=o.name,a=o.array,_=o.itemSize;t.setAttribute(i,new s.BufferAttribute(a,_))}return t},_loadLibrary:function(e,t){var n=new o.a(this.manager);return n.setPath(this.decoderPath),n.setResponseType(t),new Promise((t,s)=>{n.load(e,t,void 0,s)})},preload:function(){return this._initDecoder(),this},_initDecoder:function(){if(this.decoderPending)return this.decoderPending;var e="object"!=typeof WebAssembly||"js"===this.decoderConfig.type,t=[];return e?t.push(this._loadLibrary("draco_decoder.js","text")):(t.push(this._loadLibrary("draco_wasm_wrapper.js","text")),t.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(t).then(t=>{var n=t[0];e||(this.decoderConfig.wasmBinary=t[1]);var s=a.DRACOWorker.toString(),r=["/* draco decoder */",n,"","/* worker */",s.substring(s.indexOf("{")+1,s.lastIndexOf("}"))].join("\n");this.workerSourceURL=URL.createObjectURL(new Blob([r]))}),this.decoderPending},_getWorker:function(e,t){return this._initDecoder().then(()=>{var n;this.workerPool.length<this.workerLimit?((n=new Worker(this.workerSourceURL))._callbacks={},n._taskCosts={},n._taskLoad=0,n.postMessage({type:"init",decoderConfig:this.decoderConfig}),n.onmessage=function(e){var t=e.data;switch(t.type){case"decode":n._callbacks[t.id].resolve(t);break;case"error":n._callbacks[t.id].reject(t);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+t.type+'"')}},this.workerPool.push(n)):this.workerPool.sort((function(e,t){return e._taskLoad>t._taskLoad?-1:1}));return(n=this.workerPool[this.workerPool.length-1])._taskCosts[e]=t,n._taskLoad+=t,n})},_releaseTask:function(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]},debug:function(){console.log("Task load: ",this.workerPool.map(e=>e._taskLoad))},dispose:function(){for(var e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this}}),a.DRACOWorker=function(){var e,t;function n(e,t,n,s,r,o){var i,a,_=o.num_components(),c=n.num_points()*_;switch(r){case Float32Array:i=new e.DracoFloat32Array,t.GetAttributeFloatForAllPoints(n,o,i),a=new Float32Array(c);break;case Int8Array:i=new e.DracoInt8Array,t.GetAttributeInt8ForAllPoints(n,o,i),a=new Int8Array(c);break;case Int16Array:i=new e.DracoInt16Array,t.GetAttributeInt16ForAllPoints(n,o,i),a=new Int16Array(c);break;case Int32Array:i=new e.DracoInt32Array,t.GetAttributeInt32ForAllPoints(n,o,i),a=new Int32Array(c);break;case Uint8Array:i=new e.DracoUInt8Array,t.GetAttributeUInt8ForAllPoints(n,o,i),a=new Uint8Array(c);break;case Uint16Array:i=new e.DracoUInt16Array,t.GetAttributeUInt16ForAllPoints(n,o,i),a=new Uint16Array(c);break;case Uint32Array:i=new e.DracoUInt32Array,t.GetAttributeUInt32ForAllPoints(n,o,i),a=new Uint32Array(c);break;default:throw new Error("THREE.DRACOLoader: Unexpected attribute type.")}for(var l=0;l<c;l++)a[l]=i.GetValue(l);return e.destroy(i),{name:s,array:a,itemSize:_}}onmessage=function(s){var r=s.data;switch(r.type){case"init":e=r.decoderConfig,t=new Promise((function(t){e.onModuleLoaded=function(e){t({draco:e})},DracoDecoderModule(e)}));break;case"decode":var o=r.buffer,i=r.taskConfig;t.then(e=>{var t=e.draco,s=new t.Decoder,a=new t.DecoderBuffer;a.Init(new Int8Array(o),o.byteLength);try{var _=function(e,t,s,r){var o,i,a=r.attributeIDs,_=r.attributeTypes,c=t.GetEncodedGeometryType(s);if(c===e.TRIANGULAR_MESH)o=new e.Mesh,i=t.DecodeBufferToMesh(s,o);else{if(c!==e.POINT_CLOUD)throw new Error("THREE.DRACOLoader: Unexpected geometry type.");o=new e.PointCloud,i=t.DecodeBufferToPointCloud(s,o)}if(!i.ok()||0===o.ptr)throw new Error("THREE.DRACOLoader: Decoding failed: "+i.error_msg());var l={index:null,attributes:[]};for(var u in a){var d,h,p=self[_[u]];if(r.useUniqueIDs)h=a[u],d=t.GetAttributeByUniqueId(o,h);else{if(-1===(h=t.GetAttributeId(o,e[a[u]])))continue;d=t.GetAttribute(o,h)}l.attributes.push(n(e,t,o,u,p,d))}if(c===e.TRIANGULAR_MESH){for(var m=o.num_faces(),f=new Uint32Array(3*m),g=new e.DracoInt32Array,v=0;v<m;++v){t.GetFaceFromMesh(o,v,g);for(var y=0;y<3;++y)f[3*v+y]=g.GetValue(y)}l.index={array:f,itemSize:1},e.destroy(g)}return e.destroy(o),l}(t,s,a,i),c=_.attributes.map(e=>e.array.buffer);_.index&&c.push(_.index.array.buffer),self.postMessage({type:"decode",id:r.id,geometry:_},c)}catch(e){console.error(e),self.postMessage({type:"error",id:r.id,error:e.message})}finally{t.destroy(a),t.destroy(s)}})}}},a.taskCache=new WeakMap,a.setDecoderPath=function(){console.warn("THREE.DRACOLoader: The .setDecoderPath() method has been removed. Use instance methods.")},a.setDecoderConfig=function(){console.warn("THREE.DRACOLoader: The .setDecoderConfig() method has been removed. Use instance methods.")},a.releaseDecoderModule=function(){console.warn("THREE.DRACOLoader: The .releaseDecoderModule() method has been removed. Use instance methods.")},a.getDecoderModule=function(){console.warn("THREE.DRACOLoader: The .getDecoderModule() method has been removed. Use instance methods.")}},,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),r=n(4),o=n(53),i=s.__importDefault(n(83)),a=s.__importDefault(n(361)),_=s.__importDefault(n(355));t.CoreGeometryOperationSkin=class{constructor(e,t,n){this.geometry=e,this.geometry1=t,this.geometry0=n}process(){const e=new o.CoreGeometry(this.geometry0),t=new o.CoreGeometry(this.geometry1),n=e.segments(),s=t.segments();if(0===n.length||0===s.length)return;const c=n.length<s.length?[e,t]:[t,e],l=c[0],u=c[1],d=l.segments(),h=u.segments(),p=l.points(),m=u.points(),f=p.length,g=_.default(p,m),v=[];d.forEach((e,t)=>{const n=h[t];v.push(e[0]),v.push(e[1]),v.push(n[0]+f),v.push(e[1]),v.push(n[1]+f),v.push(n[0]+f)}),a.default(l.attrib_names(),u.attrib_names()).forEach(e=>{const t=l.attrib_size(e);let n=g.map(t=>t.attrib_value(e));t>1&&(n=i.default(n.map(e=>e.toArray()))),this.geometry.setAttribute(e,new r.Float32BufferAttribute(n,t))}),this.geometry.setIndex(v),this.geometry.computeVertexNormals()}}},,,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(414);t.PolyScene=s.PolyScene;const r=n(60);t.CoreGraphNode=r.CoreGraphNode;const o=n(81);t.TypedNode=o.TypedNode;const i=n(186);t.TypedEventNode=i.TypedEventNode;const a=n(356);t.CodeEventNode=a.CodeEventNode,n(637).AllRegister.run()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),r=n(415),o=n(416),i=n(417),a=n(528),_=n(529),c=n(532),l=n(621),u=n(622),d=n(623),h=n(624),p=n(626),m=n(630),f=n(632),g=n(634),v=n(635),y=n(636),b=n(55);t.PolyScene=class{constructor(){this._default_scene=new b.Scene,this._cameras_controller=new r.CamerasController(this),this._cooker=new o.Cooker(this),this.cook_controller=new a.CookController,this._graph=new i.CoreGraph,this._missing_expression_references_controller=new h.MissingReferencesController,this._expressions_controller=new d.ExpressionsController,this._nodes_controller=new p.NodesController(this),this._time_controller=new f.TimeController(this),this._graph.set_scene(this),this.nodes_controller.init()}get default_scene(){return this._default_scene}set_uuid(e){return this._uuid=e}get uuid(){return this._uuid}set_name(e){return this._name=e}get name(){return this._name}get cameras_controller(){return this._cameras_controller}get cooker(){return this._cooker}wait_for_cooks_completed(){return s.__awaiter(this,void 0,void 0,(function*(){return this.cook_controller.wait_for_cooks_completed()}))}get dispatch_controller(){return this._dispatch_controller=this._dispatch_controller||new _.DispatchController(this)}get events_controller(){return this._events_controller=this._events_controller||new c.EventsController(this)}get graph(){return this._graph}get lifecycle_controller(){return this._lifecycle_controller=this._lifecycle_controller||new l.LifeCycleController(this)}get loading_controller(){return this._loading_controller=this._loading_controller||new u.LoadingController(this)}get missing_expression_references_controller(){return this._missing_expression_references_controller}get expressions_controller(){return this._expressions_controller}get nodes_controller(){return this._nodes_controller}get performance(){return this._performance=this._performance||new m.CorePerformance}get time_controller(){return this._time_controller}set_frame(e){this.time_controller.set_frame(e)}get frame(){return this.time_controller.frame}get time(){return this.time_controller.time}get frame_range(){return this.time_controller.frame_range}play(){this.time_controller.play()}pause(){this.time_controller.pause()}get serializer(){return this._serializer=this._serializer||new g.PolySceneSerializer(this)}to_json(){return this.serializer.to_json()}get uniforms_controller(){return this._uniforms_controller=this._uniforms_controller||new v.UniformsController(this)}get webgl_controller(){return this._webgl_controller=this._webgl_controller||new y.WebGLController}batch_update(e){this._cooker.block(),e(),this._cooker.unblock()}node(e){return this.nodes_controller.node(e)}get root(){return this.nodes_controller.root}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.CamerasController=class{constructor(e){this.scene=e,this._master_camera_node_path=null}set_master_camera_node_path(e){this._master_camera_node_path=e}get master_camera_node_path(){return this._master_camera_node_path}get master_camera_node(){if(this.master_camera_node_path){return this.scene.node(this.master_camera_node_path)}return console.warn("master camera node not found"),this._find_any_camera()}_find_any_camera(){const e=this.scene.root;return e.nodes_by_type("perspective_camera")[0]||e.nodes_by_type("orthographic_camera")[0]}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.Cooker=class{constructor(e){this._scene=e,this._queue=new Map,this._block_level=0,this._process_item_bound=this._process_item.bind(this),this._block_level=0}block(){this._block_level+=1}unblock(){this._block_level-=1,this._block_level<0&&(this._block_level=0),this.process_queue()}get blocked(){return this._block_level>0}enqueue(e,t){this._queue.set(e.graph_node_id,t)}process_queue(){this.blocked||this._queue.forEach(this._process_item_bound)}_process_item(e,t){const n=this._scene.graph.node_from_id(t);n&&(this._queue.delete(t),n.dirty_controller.run_post_dirty_hooks(e))}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(418);t.CoreGraph=class{constructor(){this._next_id=0,this._graph=new s.Graph({directed:!0,compound:!1,multigraph:!0})}graph(){return this._graph}set_scene(e){this._scene=e}scene(){return this._scene}next_id(){return`${this._next_id+=1}`}setNode(e){this._graph.setNode(e.graph_node_id,e)}removeNode(e){this._graph.removeNode(e.graph_node_id)}nodes_from_ids(e){const t=[];for(let n of e){const e=this.node_from_id(n);e&&t.push(e)}return t}node_from_id(e){return this._graph.node(e)}connect(e,t){const n=e.graph_node_id,r=t.graph_node_id;if(this._graph.hasNode(n)&&this._graph.hasNode(r)){this._graph.setEdge(n,r);let t=!1;return!(!this._scene||this._scene.loading_controller.is_loading)&&(t=!s.alg.isAcyclic(this._graph)),t?(this._graph.removeEdge(n,r),!1):(e.dirty_controller.clear_successors_cache_with_predecessors(),!0)}return console.warn(`attempt to connect non existing node ${n} or ${r}`),!1}disconnect(e,t){if(e&&t){const n=e.graph_node_id,s=t.graph_node_id;this._graph.removeEdge(n,s),e.dirty_controller.clear_successors_cache_with_predecessors()}}disconnect_predecessors(e){const t=this.predecessors(e);for(let n of t)this.disconnect(n,e)}disconnect_successors(e){const t=this.successors(e);for(let n of t)this.disconnect(e,n)}predecessor_ids(e){return this._graph.predecessors(e)||[]}predecessors(e){const t=this.predecessor_ids(e.graph_node_id);return this.nodes_from_ids(t)}successor_ids(e){return this._graph.successors(e)||[]}successors(e){const t=this.successor_ids(e.graph_node_id)||[];return this.nodes_from_ids(t)}all_next_ids(e,t){const n=[];let s=this[t](e.graph_node_id);for(;s.length>0;){const e=[];for(let n of s)for(let s of this[t](n))e.push(s);for(let e of s)n.push(e);for(let t of e)s.push(t);s=e}return n}all_predecessor_ids(e){return this.all_next_ids(e,"predecessor_ids")}all_successor_ids(e){return this.all_next_ids(e,"successor_ids")}all_predecessors(e){const t=this.all_predecessor_ids(e);return this.nodes_from_ids(t)}all_successors(e){const t=this.all_successor_ids(e);return this.nodes_from_ids(t)}}},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3);t.CookController=class{constructor(){this._cooking_nodes_by_id=new Map,this._resolves=[]}add_node(e){this._cooking_nodes_by_id.set(e.graph_node_id,e)}remove_node(e){this._cooking_nodes_by_id.delete(e.graph_node_id),0==this._cooking_nodes_by_id.size&&this.flush()}flush(){let e;for(;e=this._resolves.pop();)e()}wait_for_cooks_completed(){return s.__awaiter(this,void 0,void 0,(function*(){return 0==this._cooking_nodes_by_id.size?void 0:new Promise((e,t)=>{this._resolves.push(e)})}))}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n(67);const s=n(67);t.DispatchController=class{constructor(e){this.scene=e}set_listener(e){this._events_listener=e}get events_listener(){return this._events_listener}dispatch(e,t,n){var s;null===(s=this._events_listener)||void 0===s||s.process_events(e,t,n)}get emit_allowed(){return this.scene.loading_controller.loaded&&null!=this._events_listener&&this.scene.loading_controller.auto_updating&&!s.POLY.player_mode()}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),r={antialias:!0};t.RenderersController=class{constructor(){this._next_renderer_id=0,this._next_env_map_id=0,this._renderers={},this._env_maps={},this._require_webgl2=!1,this._resolves=[]}set_require_webgl2(){this._require_webgl2||(this._require_webgl2=!0)}rendering_context(e){let t=null;return this._require_webgl2&&(t=this._rendering_context_webgl(e,!0)),t||(t=this._rendering_context_webgl(e,!1)),t}_rendering_context_webgl(e,t){let n=t?"webgl2":"webgl",s=e.getContext(n,r);return s||(n=t?"experimental-webgl2":"experimental-webgl",s=e.getContext(n,r)),s}register_renderer(e){if(e._polygon_id)throw new Error("render already registered");e._polygon_id=this._next_renderer_id+=1,this._renderers[e._polygon_id]=e,1==Object.keys(this._renderers).length&&this.flush_callbacks_with_renderer(e)}deregister_renderer(e){delete this._renderers[e._polygon_id],e.dispose()}first_renderer(){const e=Object.keys(this._renderers)[0];return e?this._renderers[e]:null}renderers(){return Object.values(this._renderers)}flush_callbacks_with_renderer(e){let t;for(;t=this._resolves.pop();)t(e)}wait_for_renderer(){return s.__awaiter(this,void 0,void 0,(function*(){const e=this.first_renderer();return e||new Promise((e,t)=>{this._resolves.push(e)})}))}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.NodesRegister=class{constructor(){this._node_register={},this._node_register_categories={},this._node_register_options={}}register_node(e,t,n){const s=e.node_context(),r=e.type();if(this._node_register[s]=this._node_register[s]||{},this._node_register[s][r])throw new Error(`node ${s}/${r} already registered`);this._node_register[s][r]=e,t&&(this._node_register_categories[s]=this._node_register_categories[s]||{},this._node_register_categories[s][r]=t),this._node_register_options[s]=this._node_register_options[s]||{},n&&(this._node_register_options[s][r]=n)}deregister_node(e,t){delete this._node_register[e][t],delete this._node_register_categories[e][t],delete this._node_register_options[e][t]}registered_nodes_for_context_and_parent_type(e,t){if(this._node_register[e]){return Object.values(this._node_register[e]).filter(n=>{var s;const r=this._node_register_options[e][n.type()];if(!r)return!0;{const n=r.only,s=r.except,o=`${e}/${t}`;if(n)return n.includes(o);if(s)return!s.includes(o)}return!r||(null===(s=r.only)||void 0===s?void 0:s.includes(t))})}return[]}registered_nodes(e,t){const n={},s=this.registered_nodes_for_context_and_parent_type(e,t);for(let e of s){n[e.type()]=e}return n}registered_category(e,t){return this._node_register_categories[e][t]}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(334),r=n(354);t.EventsController=class{constructor(e){this._mouse_events_controller=new r.MouseEventsController,this._controllers=[this._mouse_events_controller]}register_event_node(e){const t=this._get_controller_for_node(e);t&&t.register_node(e)}unregister_event_node(e){const t=this._get_controller_for_node(e);t&&t.unregister_node(e)}process_event(e,t,n){for(let s of this._controllers)if(s.accepts_event(e))return void s.process(e,t,n)}_get_controller_for_node(e){switch(e.type){case s.MouseEventNode.type():return this._mouse_events_controller}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.DirtyController=class{constructor(e){this.node=e,this._dirty_count=0,this._dirty=!0}get is_dirty(){return!0===this._dirty}get dirty_timestamp(){return this._dirty_timestamp}get dirty_count(){return this._dirty_count}add_post_dirty_hook(e,t){this._post_dirty_hook_names=this._post_dirty_hook_names||[],this._post_dirty_hooks=this._post_dirty_hooks||[],this._post_dirty_hook_names.includes(e)?console.warn(`hook with name ${e} already exists`,this.node):(this._post_dirty_hook_names.push(e),this._post_dirty_hooks.push(t))}remove_post_dirty_hook(e){if(this._post_dirty_hook_names&&this._post_dirty_hooks){const t=this._post_dirty_hook_names.indexOf(e);t>=0&&(this._post_dirty_hook_names.splice(t,1),this._post_dirty_hooks.splice(t,1))}}has_hook(e){return!!this._post_dirty_hook_names&&this._post_dirty_hook_names.includes(e)}remove_dirty_state(){this._dirty=!1}set_forbidden_trigger_nodes(e){this._forbidden_trigger_nodes=e.map(e=>e.graph_node_id)}set_dirty(e,t){null==t&&(t=!0),e&&this._forbidden_trigger_nodes&&this._forbidden_trigger_nodes.includes(e.graph_node_id)||(null==e&&(e=this.node),this._dirty=!0,this._dirty_timestamp=performance.now(),this._dirty_count+=1,this.run_post_dirty_hooks(e),!0===t&&this.set_successors_dirty(e))}run_post_dirty_hooks(e){if(this._post_dirty_hooks){const t=this.node.scene.cooker;if(t.blocked)t.enqueue(this.node,e);else for(let t of this._post_dirty_hooks)t(e)}}set_successors_dirty(e){this._cached_successors=this._cached_successors||this.node.graph_all_successors();for(let t of this._cached_successors)t.dirty_controller.set_dirty(e,!1)}clear_successors_cache(){this._cached_successors=void 0}clear_successors_cache_with_predecessors(){this.clear_successors_cache();for(let e of this.node.graph_all_predecessors())e.dirty_controller.clear_successors_cache()}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(2),r=n(7),o=n(61);t.UIData=class{constructor(e,t=0,n=0){this.node=e,this._position=new s.Vector2,this._width=50,this._border_radius=3,this._color=new r.Color(.75,.75,.75),this._layout_vertical=!0,this._json={x:0,y:0},this._position.x=t,this._position.y=n}set_border_radius(e){this._border_radius=e}border_radius(){return this._border_radius}set_width(e){this._width=e}width(){return this._width}set_comment(e){this._comment=e,this.node.emit(o.NodeEvent.UI_DATA_COMMENT_UPDATED)}get comment(){return this._comment}set_color(e){this._color=e}color(){return this._color}set_layout_horizontal(){this._layout_vertical=!1}is_layout_vertical(){return this._layout_vertical}copy(e){this._position.copy(e.position),this._color.copy(e.color())}get position(){return this._position}set_position(e,t=0){if(e instanceof s.Vector2)this._position.copy(e);else{const n=e;this._position.set(n,t)}this.node.emit(o.NodeEvent.UI_DATA_POSITION_UPDATED)}translate(e,t=!1){this._position.add(e),t&&(this._position.x=Math.round(this._position.x),this._position.y=Math.round(this._position.y)),this.node.emit(o.NodeEvent.UI_DATA_POSITION_UPDATED)}to_json(){return this._json.x=this._position.x,this._json.y=this._position.y,this._json.comment=this._comment,this._json}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(536),r=n(537);t.StatesController=class{constructor(e){this.node=e,this.time_dependent=new s.TimeDependentState(this.node),this.error=new r.ErrorState(this.node)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(335);class r extends s.BaseState{get active(){return this.are_params_time_dependent()||this.are_inputs_time_dependent()}are_params_time_dependent(){const e=this.node.params.names;for(let t of e){const e=this.node.params.get(t);if(e&&e.states.time_dependent.active)return!0}return!1}are_inputs_time_dependent(){const e=this.node.io.inputs.inputs();for(let t of e)if(t&&t.states.time_dependent.active)return!0;return!1}force_time_dependent(){const e=this.node.graph_predecessors().map(e=>e.graph_node_id),t=this.node.scene.time_controller.graph_node;e.includes(t.graph_node_id)||this.node.add_graph_input(t)}unforce_time_dependent(){const e=this.node.scene.time_controller.graph_node;this.node.remove_graph_input(e)}}t.TimeDependentState=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(61),r=n(335);class o extends r.BaseState{set(e){this._message!=e&&(console.warn("error",e,this.node.full_path()),this._message=e,this.on_update())}get message(){return this._message}clear(){this.set(void 0)}get active(){return null!=this._message}on_update(){null!=this._message&&this.node.set_container(null,`from error '${this._message}'`),this.node.emit(s.NodeEvent.ERROR_UPDATED)}}t.ErrorState=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(256),r=n(101);t.HierarchyParentController=class{constructor(e){this.node=e,this._parent=null}get parent(){return this._parent}set_parent(e){e!=this.node.parent_controller.parent&&(this._parent=e,this._parent&&this.node.name_controller.request_name_to_parent(s.NameController.base_name(this.node)))}is_selected(){var e,t,n;return(null===(n=null===(t=null===(e=this.parent)||void 0===e?void 0:e.children_controller)||void 0===t?void 0:t.selection)||void 0===n?void 0:n.contains(this.node))||!1}full_path(){const e=r.CoreWalker.SEPARATOR;if(null!=this._parent){const t=this._parent.full_path();return t===e?t+this.node.name:t+e+this.node.name}return e}on_set_parent(){if(this._on_set_parent_hooks)for(let e of this._on_set_parent_hooks)e()}find_node(e){if(null==e)return null;if(e===r.CoreWalker.CURRENT||e===r.CoreWalker.CURRENT_WITH_SLASH)return this.node;if(e===r.CoreWalker.PARENT||e===r.CoreWalker.PARENT_WITH_SLASH)return this.node.parent;const t=r.CoreWalker.SEPARATOR;e[0]===t&&(e=e.substring(1,e.length));const n=e.split(t);if(1===n.length){const e=n[0];return this.node.children_controller?this.node.children_controller.child_by_name(e):null}return r.CoreWalker.find_node(this.node,e)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),r=n(49),o=n(60),i=s.__importDefault(n(341)),a=s.__importDefault(n(99)),_=s.__importDefault(n(102)),c=s.__importDefault(n(255)),l=n(61),u=n(256),d=n(564),h=n(67);t.HierarchyChildrenController=class{constructor(e,t){this.node=e,this._context=t,this._children={},this._children_by_type={},this._children_and_grandchildren_by_context={},this._is_dependent_on_children=!1}get selection(){return this._selection=this._selection||new d.CoreNodeSelection(this.node)}get context(){return this._context}init(e=!1){this._children={},e&&(this._is_dependent_on_children=e,this._is_dependent_on_children&&(this._children_node=new o.CoreGraphNode(this.node.scene,"children"),this.node.add_graph_input(this._children_node)))}set_child_name(e,t){let n;if(t=(t=t.replace(/[^A-Za-z0-9]/g,"_")).replace(/^[0-9]/,"_"),null!=(n=this._children[t])){if(e.name===t&&n.graph_node_id===e.graph_node_id)return;return t=r.CoreString.increment(t),this.set_child_name(e,t)}{const n=e.name;this._children[n]&&delete this._children[n],this._children[t]=e,e.name_controller.update_name_from_parent(t),this._add_to_nodes_by_type(e),this.node.scene.nodes_controller.add_to_instanciated_node(e)}}node_context_signature(){return`${this.node.node_context()}/${this.node.type}`}available_children_classes(){return h.POLY.registered_nodes(this._context,this.node.type)}is_valid_child_type(e){return null!=this.available_children_classes()[e]}create_node(e){const t=this.available_children_classes()[e];if(null==t){const t=`child node type '${e}' not found for node '${this.node.full_path()}'. Available types are: ${Object.keys(this.available_children_classes()).join(", ")}, ${this._context}, ${this.node.type}`;throw console.error(t),t}{const n=new t(this.node.scene,`child_node_${e}`);return n.initialize_base_and_node(),this.add_node(n),n.lifecycle.set_creation_completed(),n}}add_node(e){if(e.set_parent(this.node),e.params.init(),e.parent_controller.on_set_parent(),e.name_controller.post_set_full_path(),e.children_allowed()&&e.children_controller)for(let t of e.children_controller.children())t.name_controller.post_set_full_path();return this.node.emit(l.NodeEvent.CREATED,{child_node_json:e.to_json()}),this.node.scene.lifecycle_controller.on_create_hook_allowed()&&e.lifecycle.run_on_create_hooks(),e.lifecycle.run_on_add_hooks(),this.set_child_name(e,u.NameController.base_name(e)),this.node.lifecycle.run_on_child_add_hooks(e),this._is_dependent_on_children&&this._children_node&&this._children_node.add_graph_input(e),e.require_webgl2()&&this.node.scene.webgl_controller.set_require_webgl2(),this.node.scene.missing_expression_references_controller.check_for_missing_references(e),e}remove_node(e){var t,n;if(e.parent!=this.node)return console.warn(`node ${e.name} not under parent ${this.node.full_path()}`);{e.set_successors_dirty(this.node),this._is_dependent_on_children&&this._children_node&&this._children_node.remove_graph_input(e),this.selection.contains(e)&&this.selection.remove([e]);const s=e.io.connections.first_input_connection();null===(t=e.io.connections.input_connections())||void 0===t||t.forEach(e=>{e&&e.disconnect({set_input:!0})}),null===(n=e.io.connections.output_connections())||void 0===n||n.forEach(e=>{if(e&&(e.disconnect({set_input:!0}),s)){const t=s.node_src,n=e.output_index,r=e.node_dest,o=e.input_index;r.io.inputs.set_input(o,t,n)}}),e.graph_disconnect_successors(),e.set_parent(null),delete this._children[e.name],this._remove_from_nodes_by_type(e),this.node.scene.nodes_controller.remove_from_instanciated_node(e),this.node.lifecycle.run_on_child_remove_hooks(e),e.lifecycle.run_on_delete_hooks(),e.emit(l.NodeEvent.DELETED,{parent_id:this.node.graph_node_id})}}_add_to_nodes_by_type(e){const t=e.graph_node_id,n=e.type;this._children_by_type[n]=this._children_by_type[n]||[],i.default(this._children_by_type[n],t)||this._children_by_type[n].push(t),this.add_to_children_and_grandchildren_by_context(e)}_remove_from_nodes_by_type(e){const t=e.graph_node_id,n=e.type;if(this._children_by_type[n]){const e=this._children_by_type[n].indexOf(t);e>=0&&(this._children_by_type[n].splice(e,1),0==this._children_by_type[n].length&&delete this._children_by_type[n])}this.remove_from_children_and_grandchildren_by_context(e)}add_to_children_and_grandchildren_by_context(e){var t;const n=e.graph_node_id,s=e.node_context();this._children_and_grandchildren_by_context[s]=this._children_and_grandchildren_by_context[s]||[],i.default(this._children_and_grandchildren_by_context[s],n)||this._children_and_grandchildren_by_context[s].push(n),this.node.parent&&this.node.parent.children_allowed()&&(null===(t=this.node.parent.children_controller)||void 0===t||t.add_to_children_and_grandchildren_by_context(e))}remove_from_children_and_grandchildren_by_context(e){var t;const n=e.graph_node_id,s=e.node_context();if(this._children_and_grandchildren_by_context[s]){const e=this._children_and_grandchildren_by_context[s].indexOf(n);e>=0&&(this._children_and_grandchildren_by_context[s].splice(e,1),0==this._children_and_grandchildren_by_context[s].length&&delete this._children_and_grandchildren_by_context[s])}this.node.parent&&this.node.parent.children_allowed()&&(null===(t=this.node.parent.children_controller)||void 0===t||t.remove_from_children_and_grandchildren_by_context(e))}nodes_by_type(e){const t=this._children_by_type[e]||[],n=this.node.scene.graph,s=[];return t.forEach(e=>{const t=n.node_from_id(e);t&&s.push(t)}),s}child_by_name(e){return this._children[e]}has_children_and_grandchildren_with_context(e){return null!=this._children_and_grandchildren_by_context[e]}children(){return c.default(this._children)}children_names(){return _.default(a.default(this._children))}traverse_children(e){var t;for(let n of this.children())e(n),null===(t=n.children_controller)||void 0===t||t.traverse_children(e)}}},,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),r=s.__importDefault(n(342)),o=s.__importDefault(n(327)),i=s.__importDefault(n(343)),a=n(61);t.CoreNodeSelection=class{constructor(e){this._node=e,this._node_ids=[],this._json=[]}node(){return this._node}nodes(){return this._node.scene.graph.nodes_from_ids(this._node_ids)}contains(e){return this._node_ids.includes(e.graph_node_id)}equals(e){const t=e.map(e=>e.graph_node_id).sort();return i.default(t,this._node_ids)}clear(){this._node_ids=[],this.send_update_event()}set(e){this._node_ids=[],this.add(e)}add(e){const t=e.map(e=>e.graph_node_id);this._node_ids=o.default(this._node_ids,t),this.send_update_event()}remove(e){const t=e.map(e=>e.graph_node_id);this._node_ids=r.default(this._node_ids,t),this.send_update_event()}send_update_event(){this._node.emit(a.NodeEvent.SELECTION_UPDATED)}to_json(){return this._json=this._json||[],this._json=this._node_ids.map(e=>e),this._json}}},,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.LifeCycleController=class{constructor(e){this.node=e,this._creation_completed=!1}set_creation_completed(){this._creation_completed=!0}get creation_completed(){return this.node.scene.loading_controller.loaded&&this._creation_completed}add_on_child_add_hook(e){this._on_child_add_hooks=this._on_child_add_hooks||[],this._on_child_add_hooks.push(e)}run_on_child_add_hooks(e){this.execute_hooks_with_child_node(this._on_child_add_hooks,e)}add_on_child_remove_hook(e){this._on_child_remove_hooks=this._on_child_remove_hooks||[],this._on_child_remove_hooks.push(e)}run_on_child_remove_hooks(e){this.execute_hooks_with_child_node(this._on_child_remove_hooks,e)}add_on_create_hook(e){this._on_create_hooks=this._on_create_hooks||[],this._on_create_hooks.push(e)}run_on_create_hooks(){this.execute_hooks(this._on_create_hooks)}add_on_add_hook(e){this._on_add_hooks=this._on_add_hooks||[],this._on_add_hooks.push(e)}run_on_add_hooks(){this.execute_hooks(this._on_add_hooks)}add_delete_hook(e){this._on_delete_hooks=this._on_delete_hooks||[],this._on_delete_hooks.push(e)}run_on_delete_hooks(){this.execute_hooks(this._on_delete_hooks)}execute_hooks(e){if(e)for(let t of e)t()}execute_hooks_with_child_node(e,t){if(e)for(let n of e)n(t)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),r=n(67);t.CookController=class{constructor(e){this.node=e,this._cooking=!1,this._cooks_count=0,this._max_cook_time=-1,this._cook_time_with_inputs=0,this._cook_time=0,this._cook_time_params=0,this._inputs_evaluation_required=!0}disallow_inputs_evaluation(){this._inputs_evaluation_required=!1}get is_cooking(){return!0===this._cooking}get cooks_count(){return this._cooks_count}get cook_time(){return this._cook_time}_init_cooking_state(){this._cooking=!0,this._cooking_dirty_timestamp=this.node.dirty_controller.dirty_timestamp}_init_cooking_start_time(e){null==e&&(e=this.node.scene.performance.started),e&&(this._cook_time_start=performance.now())}_start_cook_if_no_errors(e){return s.__awaiter(this,void 0,void 0,(function*(){if(this.node.states.error.active)this.end_cook();else try{yield this.node.cook(e)}catch(e){this.node.states.error.set(`node internal error: '${e}'.`),console.error(this.node.full_path(),e),this.end_cook()}}))}cook_main(){return s.__awaiter(this,void 0,void 0,(function*(){if(this.is_cooking)return;this._init_cooking_state();const e=this.node.scene.performance.started;e&&(this._cook_time_with_inputs_start=performance.now()),this.node.states.error.clear();const t=yield this.evaluate_inputs_and_params();this._init_cooking_start_time(e);const n=[];if(t){let e;for(let s=0;s<t.length;s++)e=t[s],e&&(this.node.io.inputs.input_clonable_state_with_override(s)?n.push(e.core_content_cloned()):n.push(e.core_content()))}yield this._start_cook_if_no_errors(n)}))}cook_main_without_inputs(){return s.__awaiter(this,void 0,void 0,(function*(){this.node.scene.cook_controller.add_node(this.node),this.is_cooking?console.warn("cook_main_without_inputs already cooking",this.node.full_path()):(this._init_cooking_state(),this._init_cooking_start_time(),this.node.states.error.clear(),yield this.node.params.eval_all(),yield this._start_cook_if_no_errors([]))}))}end_cook(e){this._increment_cooks_count();const t=this.node.dirty_controller.dirty_timestamp;null==t||t===this._cooking_dirty_timestamp?(this.node.remove_dirty_state(),this._terminate_cook_process()):(r.POLY.log("COOK AGAIN",t,this._cooking_dirty_timestamp,this.node.full_path()),this._cooking=!1,this.cook_main())}_terminate_cook_process(){this.is_cooking&&(this._cooking=!1,this._record_cook_time(),setTimeout(this.node.container_controller.notify_requesters.bind(this.node.container_controller),0))}_increment_cooks_count(){this.is_cooking&&null!=this._cook_time_start&&(this._cooks_count+=1)}_record_cook_time(){if(this.node.scene.performance.started){const e=performance.now();null!=this._cook_time_with_inputs_start&&(this._cook_time_with_inputs=e-this._cook_time_with_inputs_start,this._cook_time_with_inputs_start=void 0),null!=this._cook_time_params_start&&null!=this._cook_time_start&&(this._cook_time_params=this._cook_time_start-this._cook_time_params_start),null!=this._cook_time_start&&(this._cook_time=e-this._cook_time_start,this._cook_time_start=void 0),this._max_cook_time=Math.max(this._max_cook_time,this._cook_time)}this.node.scene.performance.started&&this.node.scene.performance.record_node_cook_data(this.node)}evaluate_inputs_and_params(){return s.__awaiter(this,void 0,void 0,(function*(){let e=[];return this._inputs_evaluation_required&&(e=yield this.node.io.inputs.eval_required_inputs_p()),this.node.scene.performance.started&&(this._cook_time_params_start=performance.now()),yield this.node.params.eval_all(),e}))}get cook_time_with_inputs(){return this._cook_time_with_inputs}get cook_time_params(){return this._cook_time_params}_time_with_precision(e){return Math.round(1e3*e)/1e3}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3).__importDefault(n(569)),r=n(81),o=n(93);var i;!function(e){e.SUCCESSORS="graph_successors",e.PREDECESSORS="graph_predecessors"}(i||(i={}));t.DependenciesController=class{constructor(e){this.node=e}scene_successors(){return this._find_scene_node_scene_nodes(i.SUCCESSORS)}scene_predecessors(){return this._find_scene_node_scene_nodes(i.PREDECESSORS)}_find_scene_node_scene_nodes(e){const t=this.node.params.all,n=[];for(let e of t)n.push(e);n.push(this.node);const r=n;let o=[];for(let t of r)this._find_base_nodes_from_node(t,e,o);if(e==i.SUCCESSORS)for(let e of this.param_nodes_referree())o.push(e);o=o.filter(e=>e.graph_node_id!=this.node.graph_node_id);const a=s.default(o,e=>e.graph_node_id),_=[];return Object.keys(a).forEach(e=>{_.push(a[e][0])}),_}_find_base_nodes_from_node(e,t,n){const s=e[t]();for(let e of s)e instanceof o.BaseParamClass?n.push(e.node):(i=e,("string"==typeof(a=r.BaseNodeClass)?typeof i===a:i instanceof a)?n.push(e):this._find_base_nodes_from_node(e,t,n));var i,a;return n}add_param_referree(e){this._params_referrees_by_graph_node_id=this._params_referrees_by_graph_node_id||{},this._params_referrees_by_graph_node_id[e.graph_node_id]=e}remove_param_referree(e){this._params_referrees_by_graph_node_id&&delete this._params_referrees_by_graph_node_id[e.graph_node_id]}params_referree(){const e=[];if(this._params_referrees_by_graph_node_id)for(let t of Object.keys(this._params_referrees_by_graph_node_id))e.push(this._params_referrees_by_graph_node_id[t]);return e}param_nodes_referree(){const e={};let t;for(let n of this.params_referree())t=n.node,e[t.graph_node_id]=t;const n=[];for(let t of Object.keys(e))n.push(e[t]);return n}}},,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.EmitController=class{constructor(e){this.param=e,this._blocked_emit=!1,this._blocked_parent_emit=!1,this._count_by_event_name={}}get emit_allowed(){return!0!==this._blocked_emit&&(!this.param.scene.loading_controller.is_loading&&this.param.scene.dispatch_controller.emit_allowed)}block_emit(){return this._blocked_emit=!0,this.param.is_multiple&&this.param.components&&this.param.components.forEach(e=>e.emit_controller.block_emit()),!0}unblock_emit(){return this._blocked_emit=!1,this.param.is_multiple&&this.param.components&&this.param.components.forEach(e=>e.emit_controller.unblock_emit()),!0}block_parent_emit(){return this._blocked_parent_emit=!0,!0}unblock_parent_emit(){return this._blocked_parent_emit=!1,!0}increment_count(e){this._count_by_event_name[e]=this._count_by_event_name[e]||0,this._count_by_event_name[e]+=1}events_count(e){return this._count_by_event_name[e]||0}emit(e){this.emit_allowed&&(this.param.emit(e),null!=this.param.parent_param&&!0!==this._blocked_parent_emit&&this.param.parent_param.emit(e))}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ParamSerializer=class{constructor(e){this.param=e}to_json(){const e={name:this.param.name,type:this.param.type,raw_input:this.raw_input(),value:this.value(),expression:this.expression(),graph_node_id:this.param.graph_node_id,error_message:this.error_message(),is_visible:this.is_visible(),components:void 0};return this.param.is_multiple&&this.param.components&&(e.components=this.param.components.map(e=>e.graph_node_id)),e}raw_input(){return this.param.raw_input_serialized}value(){return this.param.value_serialized}expression(){var e;return this.param.has_expression()?null===(e=this.param.expression_controller)||void 0===e?void 0:e.expression:void 0}error_message(){return this.param.states.error.message}is_visible(){return this.param.options.is_visible}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(576),r=n(577);t.StatesController=class{constructor(e){this.param=e,this.time_dependent=new s.TimeDependentState(this.param),this.error=new r.ErrorState(this.param)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.TimeDependentState=class{constructor(e){this.param=e}get active(){const e=this.param.scene.time_controller.graph_node.graph_node_id;return this.param.graph_predecessor_ids().includes(e)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(103);t.ErrorState=class{constructor(e){this.param=e}set(e){this._message!=e&&(this._message=e,this._message&&console.log(this.param.full_path(),this._message),this.param.emit_controller.emit(s.ParamEvent.ERROR_UPDATED))}get message(){return this._message}clear(){this.set(void 0)}get active(){return null!=this._message}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),r=n(60),o=n(24),i=n(345),a=n(61);t.ParamsController=class{constructor(e){this.node=e,this._param_create_mode=!1,this._params_by_name={},this._params_list=[],this._param_names=[],this._non_spare_params=[],this._spare_params=[],this._non_spare_param_names=[],this._spare_param_names=[],this._params_added_since_last_params_eval=!1}init_dependency_node(){this._params_node||(this._params_node=new r.CoreGraphNode(this.node.scene,"params"),this.node.add_graph_input(this._params_node))}init(){this.init_dependency_node(),this._param_create_mode=!0,this.init_from_params_config(),this.node.create_params(),this._post_create_params()}_post_create_params(){this._update_caches(),this.init_param_accessors(),this._param_create_mode=!1,this.run_post_create_params_hook()}update_params(e){let t=!1,n=!1;if(e.names_to_delete)for(let t of e.names_to_delete)this.has(t)&&(this.delete_param(t),n=!0);if(e.to_add)for(let n of e.to_add){this.add_param(n.type,n.name,n.init_value,n.options)&&(t=!0)}(n||t)&&(this._update_caches(),this.init_param_accessors(),this.node.emit(a.NodeEvent.PARAMS_UPDATED))}post_create_spare_params(){this._update_caches(),this.init_param_accessors()}init_from_params_config(){const e=this.node.params_config;if(e)for(let t of Object.keys(e)){const n=e[t];this.add_param(n.type,t,n.init_value,n.options)}}init_param_accessors(){let e=Object.getOwnPropertyNames(this.node.pv);this._remove_unneeded_accessors(e),e=Object.getOwnPropertyNames(this.node.pv);for(let t of this.all){const n=t.options.is_spare;(!e.includes(t.name)||n)&&(Object.defineProperty(this.node.pv,t.name,{get:()=>t.value,configurable:n}),Object.defineProperty(this.node.p,t.name,{get:()=>t,configurable:n}))}}_remove_unneeded_accessors(e){const t=this._param_names,n=[];for(let s of e)t.includes(s)||n.push(s);for(let e of n)Object.defineProperty(this.node.pv,e,{get:()=>{},configurable:!0}),Object.defineProperty(this.node.p,e,{get:()=>{},configurable:!0})}get params_node(){return this._params_node}get all(){return this._params_list}get non_spare(){return this._non_spare_params}get spare(){return this._spare_params}get names(){return this._param_names}get non_spare_names(){return this._non_spare_param_names}get spare_names(){return this._spare_param_names}set_with_type(e,t,n){const s=this.param_with_type(e,n);s?s.set(t):console.warn(`param ${e} not found with type ${n}`)}set_float(e,t){this.set_with_type(e,t,o.ParamType.FLOAT)}set_vector3(e,t){this.set_with_type(e,t,o.ParamType.VECTOR3)}has_param(e){return null!=this._params_by_name[e]}has(e){return this.has_param(e)}get(e){return this.param(e)}param_with_type(e,t){const n=this.param(e);if(n&&n.type==t)return n}get_float(e){return this.param_with_type(e,o.ParamType.FLOAT)}get_operator_path(e){return this.param_with_type(e,o.ParamType.OPERATOR_PATH)}value(e){var t;return null===(t=this.param(e))||void 0===t?void 0:t.value}value_with_type(e,t){var n;return null===(n=this.param_with_type(e,t))||void 0===n?void 0:n.value}boolean(e){return this.value_with_type(e,o.ParamType.BOOLEAN)}float(e){return this.value_with_type(e,o.ParamType.FLOAT)}integer(e){return this.value_with_type(e,o.ParamType.INTEGER)}string(e){return this.value_with_type(e,o.ParamType.STRING)}vector2(e){return this.value_with_type(e,o.ParamType.VECTOR2)}vector3(e){return this.value_with_type(e,o.ParamType.VECTOR3)}color(e){return this.value_with_type(e,o.ParamType.COLOR)}param(e){const t=this._params_by_name[e];return null!=t?t:(console.warn(`tried to access param '${e}' in node ${this.node.full_path()}, but existing params are: ${this.names} on node ${this.node.full_path()}`),null)}delete_param(e){const t=this._params_by_name[e];if(!t)throw new Error(`param '${e}' does not exist on node ${this.node.full_path()}`);if(this._params_node&&this._params_node.remove_graph_input(this._params_by_name[e]),t.set_node(null),delete this._params_by_name[e],t.is_multiple&&t.components)for(let e of t.components){const t=e.name;delete this._params_by_name[t]}}add_param(e,t,n,s={}){const r=s.spare||!1;!1!==this._param_create_mode||r||console.warn(`node ${this.node.full_path()} (${this.node.type}) param '${t}' cannot be created outside of create_params`),null==this.node.scene&&console.warn(`node ${this.node.full_path()} (${this.node.type}) has no scene assigned`);const o=i.ParamConstructorByType[e];if(null!=o){const i=this._params_by_name[t];i&&(r?i.type!=e&&this.delete_param(i.name):console.warn(`a param named ${t} already exists`,this.node));const a=new o(this.node.scene);if(a.options.set(s),a.set_name(t),a.set_init_value(n),a.init_components(),a.set(n),a.set_node(this.node),this._params_by_name[a.name]=a,a.is_multiple&&a.components)for(let e of a.components)this._params_by_name[e.name]=e;return this._params_added_since_last_params_eval=!0,a}}_update_caches(){this._params_list=Object.values(this._params_by_name),this._param_names=Object.keys(this._params_by_name),this._non_spare_params=Object.values(this._params_by_name).filter(e=>!e.options.is_spare),this._spare_params=Object.values(this._params_by_name).filter(e=>e.options.is_spare),this._non_spare_param_names=Object.values(this._params_by_name).filter(e=>!e.options.is_spare).map(e=>e.name),this._spare_param_names=Object.values(this._params_by_name).filter(e=>e.options.is_spare).map(e=>e.name)}_eval_param(e){return s.__awaiter(this,void 0,void 0,(function*(){e.is_dirty&&(yield e.compute(),e.states.error.active&&this.node.states.error.set(`param '${e.name}' error: ${e.states.error.message}`))}))}eval_params(e){return s.__awaiter(this,void 0,void 0,(function*(){const t=[];for(let n=0;n<e.length;n++)e[n].is_dirty&&t.push(this._eval_param(e[n]));yield Promise.all(t),this.node.states.error.active&&this.node.set_container(null)}))}eval_all(){return s.__awaiter(this,void 0,void 0,(function*(){this._params_node&&(this._params_node.is_dirty||this._params_added_since_last_params_eval)&&(yield this.eval_params(this._params_list),this._params_node.remove_dirty_state(),this._params_added_since_last_params_eval=!1)}))}set_post_create_params_hook(e){this._post_create_params_hook=e}add_on_scene_load_hook(e,t){this._on_scene_load_hook_names=this._on_scene_load_hook_names||[],this._on_scene_load_hooks=this._on_scene_load_hooks||[],this._on_scene_load_hook_names.includes(e)?console.warn(`hook with name ${e} already exists`,this.node):(this._on_scene_load_hook_names.push(e),this._on_scene_load_hooks.push(t))}run_post_create_params_hook(){this._post_create_params_hook&&this._post_create_params_hook()}run_on_scene_load_hooks(){if(this._on_scene_load_hooks)for(let e of this._on_scene_load_hooks)e()}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),r=s.__importDefault(n(44)),o=s.__importDefault(n(346)),i=s.__importDefault(n(48)),a=n(191),_=n(24),c=n(49);class l extends a.TypedNumericParam{static type(){return _.ParamType.BOOLEAN}get default_value_serialized(){return i.default(this.default_value)?this.default_value:this.convert(this.default_value)||!1}get raw_input_serialized(){return this._raw_input}get value_serialized(){return this.value}static are_raw_input_equal(e,t){return e==t}static are_values_equal(e,t){return e==t}convert(e){if(o.default(e))return e;if(r.default(e))return e>=1;if(i.default(e)){if(c.CoreString.is_boolean(e))return c.CoreString.to_boolean(e);if(c.CoreString.is_number(e)){return parseFloat(e)>=1}}return null}}t.BooleanParam=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),r=n(348),o=n(582),i=n(600),a=n(601),_=n(24);t.ExpressionManager=class{constructor(e){this.param=e,this.parse_completed=!1,this.parse_started=!1,this.parsed_tree=new r.ParsedTree,this.function_generator=new o.FunctionGenerator(this.param),this.dependencies_controller=new a.DependenciesController(this.param)}parse_expression(e){if(this.parse_started)throw new Error(`parse in progress for param ${this.param.full_path()}`);this.parse_started=!0,this.parse_completed=!1,this.parsed_tree=this.parsed_tree||new r.ParsedTree,this.reset(),this.param.type==_.ParamType.STRING?this.parsed_tree.parse_expression_for_string_param(e):this.parsed_tree.parse_expression(e),this.function_generator.parse_tree(this.parsed_tree),null==this.function_generator.error_message&&(this.dependencies_controller.update(this.function_generator),this.dependencies_controller.error_message?this.param.states.error.set(this.dependencies_controller.error_message):(this.parse_completed=!0,this.parse_started=!1))}compute_function(){return s.__awaiter(this,void 0,void 0,(function*(){if(!this.compute_allowed())return new Promise((e,t)=>{e(null)});try{return yield this.function_generator.eval_function()}catch(e){return new Promise((e,t)=>e())}}))}reset(){this.parse_completed=!1,this.parse_started=!1,this.dependencies_controller.reset(),this.function_generator.reset()}get is_errored(){return this.function_generator.is_errored}get error_message(){return this.function_generator.error_message}compute_allowed(){return this.function_generator.eval_allowed()}update_from_method_dependency_name_change(){this.expression_string_generator=this.expression_string_generator||new i.ExpressionStringGenerator(this.param);const e=this.expression_string_generator.parse_tree(this.parsed_tree);e?this.param.set(e):console.warn("failed to regenerate expression")}}},,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),r=n(583),o=n(584),i=n(114),a=s.__importDefault(n(48)),_={math_random:"random"},c=n(350),l=Object.keys(c.Easing),u={};["abs","acos","acosh","asin","asinh","atan","atan2","atanh","ceil","cos","cosh","exp","expm1","floor","log","log1p","log2","log10","max","min","pow","round","sign","sin","sinh","sqrt","tan","tanh"].forEach(e=>{u[e]=`Math.${e}`}),["cbrt","hypot","log10","trunc"].forEach(e=>{u[e]=`Math.${e}`}),Object.keys(_).forEach(e=>{const t=_[e];u[e]=`Math.${t}`}),["fit","fit01","fract","deg2rad","rad2deg","rand","clamp"].forEach(e=>{u[e]=`Core.Math.${e}`}),l.forEach(e=>{u[e]=`Core.Math.Easing.${e}`}),["precision"].forEach(e=>{u[e]=`Core.String.${e}`});const d={if:r.LiteralConstructsController.if},h={};["E","LN2","LN10","LOG10E","LOG2E","PI","SQRT1_2","SQRT2"].forEach(e=>{h[e]=`Math.${e}`});const p=o.MethodModule,m=n(260),f={x:0,y:1,z:2,w:3,r:0,g:1,b:2},g=n(260),v=n(599),y=n(104),b=n(49),x=n(261);class T extends g.BaseTraverser{constructor(e){super(e),this.param=e,this._attribute_requirements_controller=new v.AttributeRequirementsController,this.methods=[],this.method_index=-1,this.method_dependencies=[],this.immutable_dependencies=[]}parse_tree(e){if(this.reset(),null==e.error_message){try{if(this._attribute_requirements_controller.reset(),e.node){const t=this.traverse_node(e.node);t&&!this.is_errored&&(this.function_main_string=t)}else console.warn("no parsed_tree.node")}catch(e){console.warn(`error in expression for param ${this.param.full_path()}`),console.warn(e)}if(this.function_main_string)try{this.function=new x.AsyncFunction("Core","param","methods","_set_error_from_error",`\n\t\t\t\t\ttry {\n\t\t\t\t\t\t${this.function_body()}\n\t\t\t\t\t} catch(e) {\n\t\t\t\t\t\t_set_error_from_error(e)\n\t\t\t\t\t\treturn null;\n\t\t\t\t\t}`)}catch(e){console.warn(e),this.set_error("cannot generate function")}else this.set_error("cannot generate function body")}else this.set_error("cannot parse expression")}reset(){super.reset(),this.function_main_string=void 0,this.methods=[],this.method_index=-1,this.function=void 0,this.method_dependencies=[],this.immutable_dependencies=[]}function_body(){return this.param.options.is_expression_for_entities?`\n\t\t\tconst entities = param.expression_controller.entities;\n\t\t\tif(entities){\n\t\t\t\treturn new Promise( async (resolve, reject)=>{\n\t\t\t\t\tlet entity;\n\t\t\t\t\tconst entity_callback = param.expression_controller.entity_callback;\n\t\t\t\t\t${this._attribute_requirements_controller.assign_attributes_lines()}\n\t\t\t\t\tif( ${this._attribute_requirements_controller.attribute_presence_check_line()} ){\n\t\t\t\t\t\t${this._attribute_requirements_controller.assign_arrays_lines()}\n\t\t\t\t\t\tfor(let index=0; index < entities.length; index++){\n\t\t\t\t\t\t\tentity = entities[index];\n\t\t\t\t\t\t\tresult = ${this.function_main_string};\n\t\t\t\t\t\t\tentity_callback(entity, result);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tresolve()\n\t\t\t\t\t} else {\n\t\t\t\t\t\tconst error = new Error('attribute not found')\n\t\t\t\t\t\t_set_error_from_error(error)\n\t\t\t\t\t\treject(error)\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t}\n\t\t\treturn []`:`\n\t\t\treturn new Promise( async (resolve, reject)=>{\n\t\t\t\ttry {\n\t\t\t\t\tconst value = ${this.function_main_string}\n\t\t\t\t\tresolve(value)\n\t\t\t\t} catch(e) {\n\t\t\t\t\t_set_error_from_error(e)\n\t\t\t\t\treject()\n\t\t\t\t}\n\t\t\t})\n\t\t\t`}eval_allowed(){return null!=this.function}eval_function(){if(this.function){this.clear_error();const e={Math:y.CoreMath,String:b.CoreString};return this.function(e,this.param,this.methods,this._set_error_from_error_bound)}}traverse_CallExpression(e){const t=e.arguments.map(e=>this.traverse_node(e)),n=e.callee.name;if(n){const s=d[n];if(s)return s(t);const r=`${t.join(", ")}`,o=u[n];if(o)return`${o}(${r})`;if(p[n]){const s=e.arguments[0],o=`return ${t[0]}`;let i,a=[];try{i=new Function(o),a=i()}catch(e){}return this._create_method_and_dependencies(n,a,s),`(await methods[${this.method_index}].process_arguments([${r}]))`}}this.set_error(`unknown method: ${n}`)}traverse_BinaryExpression(e){return`(${this.traverse_node(e.left)} ${e.operator} ${this.traverse_node(e.right)})`}traverse_LogicalExpression(e){return`(${this.traverse_node(e.left)} ${e.operator} ${this.traverse_node(e.right)})`}traverse_MemberExpression(e){return`${this.traverse_node(e.object)}.${this.traverse_node(e.property)}`}traverse_UnaryExpression(e){if("@"===e.operator){let t,n,s=e.argument;switch(s.type){case"Identifier":t=s.name;break;case"MemberExpression":{const e=s,r=e.object,o=e.property;t=r.name,n=o.name;break}}if(t){if(t=i.CoreAttribute.remap_name(t),"ptnum"==t)return"((entity != null) ? entity.index : 0)";{const e=this._attribute_requirements_controller.var_attribute_size(t),s=this._attribute_requirements_controller.var_array(t);if(this._attribute_requirements_controller.add(t),n){return`${s}[entity.index*${e}+${f[n]}]`}return`${s}[entity.index*${e}]`}}return console.warn("attribute not found"),""}return`${e.operator}${this.traverse_node(e.argument)}`}traverse_Literal(e){return`${e.raw}`}traverse_Identifier(e){if(e.name[0]!=m.VARIABLE_PREFIX)return e.name;{const t=e.name.substr(1),n=h[t];if(n)return n;const s=`traverse_Identifier_${t}`;if(this[s])return this[s]();this.set_error(`identifier unknown: ${e.name}`)}}traverse_Identifier_F(){return this.immutable_dependencies.push(this.param.scene.time_controller.graph_node),"param.scene.time_controller.frame"}traverse_Identifier_FPS(){return this.immutable_dependencies.push(this.param.scene.time_controller.graph_node),"param.scene.time_controller.fps"}traverse_Identifier_T(){return this.immutable_dependencies.push(this.param.scene.time_controller.graph_node),"param.scene.time_controller.time"}traverse_Identifier_CH(){return`'${this.param.name}'`}traverse_Identifier_CEX(){return this._method_centroid("x")}traverse_Identifier_CEY(){return this._method_centroid("y")}traverse_Identifier_CEZ(){return this._method_centroid("z")}_method_centroid(e){const t=[0,`'${e}'`].join(", ");return this._create_method_and_dependencies("centroid",0),`(await methods[${this.method_index}].process_arguments([${t}]))`}_create_method_and_dependencies(e,t,n){const s=new(0,p[e])(this.param);this.method_index+=1,this.methods[this.method_index]=s;const r=s.find_dependency(t);r?(n&&r.set_jsep_node(n),this.method_dependencies.push(r)):n&&a.default(t)&&this.param.scene.missing_expression_references_controller.register(this.param,n,t)}}t.FunctionGenerator=T},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.LiteralConstructsController=class{static if(e){return`(${e[0]}) ? (${e[1]}) : (${e[2]})`}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(585),r=n(587),o=n(588),i=n(589),a=n(590),_=n(591),c=n(592),l=n(593),u=n(594),d=n(595),h=n(596),p=n(597),m=n(598);t.MethodModule={bbox:s.Bbox,ch:o.Ch,centroid:r.Centroid,cop_res:a.CopRes,local:_.Local,opdigits:c.Opdigits,point:l.Point,points_count:u.PointsCount,copy:i.Copy,str_chars_count:d.StrCharsCount,str_concat:h.StrConcat,str_index:p.StrIndex,str_sub:m.StrSub}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),r=n(62),o=n(1),i=["min","max","size","center"],a=["x","y","z"];class _ extends r.BaseMethod{static required_arguments(){return[["string","path to node"],["string","vector name, min, max, size or center"],["string","component_name, x,y or z"]]}find_dependency(e){return this.create_dependency_from_index_or_path(e)}process_arguments(e){let t=0;return new Promise((n,r)=>s.__awaiter(this,void 0,void 0,(function*(){if(3==e.length){const s=e[0],o=e[1],i=e[2];let a=null;try{a=yield this.get_referenced_node_container(s)}catch(e){r(e)}a&&(t=this._get_value_from_container(a,o,i),n(t))}else n(0)})))}_get_value_from_container(e,t,n){if(i.indexOf(t)>=0){const s=e.bounding_box();let r=new o.Vector3;switch(t){case"size":s.getSize(r);break;case"center":s.getCenter(r);break;default:r=s[t]}return a.indexOf(n)>=0?r[n]:-1}return-1}}t.Bbox=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3).__importDefault(n(44)),r=n(60);class o extends r.CoreGraphNode{constructor(e,t,n){super(e.scene,"MethodDependency"),this.param=e,this.path_argument=t,this.decomposed_path=n,this._update_from_name_change_bound=this._update_from_name_change.bind(this),this.add_post_dirty_hook("_update_from_name_change",this._update_from_name_change_bound)}_update_from_name_change(e){if(e&&this.decomposed_path){const t=e;this.decomposed_path.update_from_name_change(t);const n=this.decomposed_path.to_path(),s=this.jsep_node;s&&(s.value=`${s.value}`.replace(`${this.path_argument}`,n),s.raw=s.raw.replace(`${this.path_argument}`,n)),this.param.expression_controller&&this.param.expression_controller.update_from_method_dependency_name_change()}}reset(){this.graph_disconnect_predecessors()}listen_for_name_changes(){this.jsep_node&&this.decomposed_path&&this.decomposed_path.named_nodes.forEach(e=>{if(e){const t=e;t.name_controller&&this.add_graph_input(t.name_controller.graph_node)}})}set_jsep_node(e){this.jsep_node=e}set_resolved_graph_node(e){this.resolved_graph_node=e}set_unresolved_path(e){this.unresolved_path=e}static create(e,t,n,r){const i=s.default(t),a=new o(e,t,r);if(n)a.set_resolved_graph_node(n);else if(!i){const e=t;a.set_unresolved_path(e)}return a}}t.MethodDependency=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),r=n(62);class o extends r.BaseMethod{static required_arguments(){return[["string","path to node"],["string","component_name, x,y or z"]]}find_dependency(e){return this.create_dependency_from_index_or_path(e)}process_arguments(e){return new Promise((t,n)=>s.__awaiter(this,void 0,void 0,(function*(){if(2==e.length){const s=e[0],r=e[1];let o=null;try{o=yield this.get_referenced_node_container(s)}catch(e){n(e)}if(o){const e=o.bounding_box(),n=e.min.clone().add(e.max).multiplyScalar(.5)[r];t(null!=n?n:0)}}else t(0)})))}}t.Centroid=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),r=n(62),o=n(349);class i extends r.BaseMethod{static required_arguments(){return[["string","path to param"]]}find_dependency(e){const t=new o.DecomposedPath,n=this.get_referenced_param(e,t);return n?this.create_dependency(n,e,t):(console.warn("could not find param"),null)}process_arguments(e){return s.__awaiter(this,void 0,void 0,(function*(){let t=0;if(1==e.length){const n=e[0],s=this.get_referenced_param(n);if(s){yield s.compute();const e=s.value;null!=e&&(t=e)}}return t}))}}t.Ch=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(62),r=n(101);class o extends s.BaseMethod{static required_arguments(){return[["string","path to copy"],["integer","default value"]]}static optional_arguments(){return[["string","attribute name (optional)"]]}find_dependency(e){const t=this.find_referenced_graph_node(e);if(t&&"copy"==t.type){const n=t.stamp_node;return this.create_dependency(n,e)}return null}process_arguments(e){return new Promise((t,n)=>{if(2==e.length||3==e.length){const n=e[0],s=e[1],o=e[2],i=r.CoreWalker.find_node(this.node,n);let a;i&&"copy"==i.type&&(a=i.stamp_value(o)),null==a&&(a=s),t(a)}else t(0)})}}t.Copy=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),r=n(62);class o extends r.BaseMethod{static required_arguments(){return[["string","path to node"],["string","component_name: x or y"]]}find_dependency(e){return this.create_dependency_from_index_or_path(e)}process_arguments(e){return s.__awaiter(this,void 0,void 0,(function*(){let t=0;if(2==e.length){const n=e[0],s=e[1],r=yield this.get_referenced_node_container(n);if(r){const e=r.resolution();[0,"0","x"].includes(s)?t=e[0]:[1,"1","y"].includes(s)&&(t=e[1])}}return t}))}}t.CopRes=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(62),r=n(67);class o extends s.BaseMethod{static required_arguments(){return[["string","path"]]}process_arguments(e){return new Promise((t,n)=>{this.request_asset_url(e[0]).then(e=>{t(e)})})}request_asset_url(e){return new Promise((t,n)=>{let s;if(!r.POLY.desktop_controller().active())return t("");r.POLY.desktop_controller().add_local_path(e,this.param),s=r.POLY.desktop_controller().local_path_server_url(e),t(s)})}}t.Local=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(62),r=n(49);class o extends s.BaseMethod{static required_arguments(){return[["string","path to node"]]}find_dependency(e){const t=this.find_referenced_graph_node(e);if(t){const n=t;if(n.name_controller){const t=n.name_controller.graph_node;return this.create_dependency(t,e)}}return null}process_arguments(e){return new Promise((t,n)=>{if(1==e.length){const n=e[0],s=this.get_referenced_node(n);if(s){const e=s.name;t(r.CoreString.tail_digits(e))}else t(0)}else t(0)})}}t.Opdigits=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),r=n(62);class o extends r.BaseMethod{static required_arguments(){return[["string","path to node"],["index","point index"],["string","attribute name"]]}find_dependency(e){return this.create_dependency_from_index_or_path(e)}process_arguments(e){return new Promise((t,n)=>s.__awaiter(this,void 0,void 0,(function*(){if(3==e.length){const s=e[0],r=e[1],o=e[2];let i=null;try{i=yield this.get_referenced_node_container(s)}catch(e){n(e)}if(i){const e=this._get_value_from_container(i,r,o);t(e)}}else t(0)})))}_get_value_from_container(e,t,n){const s=e.core_content();if(s){const e=s.points()[n];return e?e.attrib_value(t):0}return null}}t.Point=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),r=n(62);class o extends r.BaseMethod{static required_arguments(){return[["string","path to node"]]}find_dependency(e){return this.create_dependency_from_index_or_path(e)}process_arguments(e){return new Promise((t,n)=>s.__awaiter(this,void 0,void 0,(function*(){if(1==e.length){const s=e[0];let r;try{r=yield this.get_referenced_node_container(s)}catch(e){return void n(e)}if(r){const e=r.points_count();t(e)}}else t(0)})))}}t.PointsCount=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),r=n(62);class o extends r.BaseMethod{static required_arguments(){return[["string","string to count characters of"]]}process_arguments(e){return s.__awaiter(this,void 0,void 0,(function*(){let t=0;if(1==e.length){t=e[0].length}return t}))}}t.StrCharsCount=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),r=n(62);class o extends r.BaseMethod{static required_arguments(){return[]}process_arguments(e){return s.__awaiter(this,void 0,void 0,(function*(){let t="";for(let n of e)null==n&&(n=""),t+=`${n}`;return t}))}}t.StrConcat=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),r=n(62);class o extends r.BaseMethod{static required_arguments(){return[["string","string to get index from"],["string","char to find index of"]]}process_arguments(e){return s.__awaiter(this,void 0,void 0,(function*(){let t=-1;if(2==e.length){const n=e[0],s=e[1];t=n.indexOf(s)}return t}))}}t.StrIndex=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),r=n(62);class o extends r.BaseMethod{static required_arguments(){return[["string","string to get range from"],["integer","range start"],["integer","range size"]]}process_arguments(e){return s.__awaiter(this,void 0,void 0,(function*(){let t="";const n=e[0],s=e[1]||0;let r=e[2]||1;return n&&(t=n.substr(s,r)),t}))}}t.StrSub=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class s{constructor(){}reset(){this._attribute_names&&this._attribute_names.clear()}assign_attributes_lines(){var e;if(this._attribute_names){const t=[];return null===(e=this._attribute_names)||void 0===e||e.forEach(e=>{t.push(s.assign_attribute_line(e))}),t.join(";\n")}return""}assign_arrays_lines(){var e;if(this._attribute_names){const t=[];return null===(e=this._attribute_names)||void 0===e||e.forEach(e=>{t.push(s.assign_item_size_line(e)),t.push(s.assign_array_line(e))}),t.join(";\n")}return""}attribute_presence_check_line(){var e;if(this._attribute_names){const t=[];return null===(e=this._attribute_names)||void 0===e||e.forEach(e=>{const n=s.var_attribute(e);t.push(n)}),t.join(" && ")}return"true"}add(e){this._attribute_names=this._attribute_names||new Set,this._attribute_names.add(e)}static assign_attribute_line(e){return`const ${this.var_attribute(e)} = entities[0].geometry().attributes['${e}']`}static assign_item_size_line(e){const t=this.var_attribute(e);return`const ${this.var_attribute_size(e)} = ${t}.itemSize`}static assign_array_line(e){const t=this.var_attribute(e);return`const ${this.var_array(e)} = ${t}.array`}static var_attribute(e){return`attrib_${e}`}static var_attribute_size(e){return`attrib_size_${e}`}static var_array(e){return`array_${e}`}var_attribute_size(e){return s.var_attribute_size(e)}var_array(e){return s.var_array(e)}}t.AttributeRequirementsController=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(260);class r extends s.BaseTraverser{constructor(e){super(e),this.param=e}parse_tree(e){if(null==e.error_message&&e.node)try{return this.traverse_node(e.node)}catch(e){this.set_error("could not traverse tree")}else this.set_error("cannot parse tree")}traverse_CallExpression(e){const t=`${e.arguments.map(e=>this.traverse_node(e)).join(", ")}`;return`${e.callee.name}(${t})`}traverse_UnaryExpression(e){return`${e.operator}${this.traverse_node(e.argument)}`}traverse_Identifier(e){return`${e.name}`}}t.ExpressionStringGenerator=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.DependenciesController=class{constructor(e){this.param=e,this.cyclic_graph_detected=!1,this.method_dependencies=[]}set_error(e){this.error_message=this.error_message||e}reset(){this.param.graph_disconnect_predecessors(),this.method_dependencies.forEach(e=>{e.reset()}),this.method_dependencies=[]}update(e){this.cyclic_graph_detected=!1,this.connect_immutable_dependencies(e),this.method_dependencies=e.method_dependencies,this.handle_method_dependencies(),this.listen_for_name_changes()}connect_immutable_dependencies(e){e.immutable_dependencies.forEach(e=>{if(0==this.cyclic_graph_detected&&0==this.param.add_graph_input(e))return this.cyclic_graph_detected=!0,this.set_error("cannot create expression, infinite graph detected"),void this.reset()})}handle_method_dependencies(){this.method_dependencies.forEach(e=>{0==this.cyclic_graph_detected&&this.handle_method_dependency(e)})}handle_method_dependency(e){const t=e.resolved_graph_node;if(t&&!this.param.add_graph_input(t))return this.cyclic_graph_detected=!0,this.set_error("cannot create expression, infinite graph detected"),void this.reset()}listen_for_name_changes(){this.method_dependencies.forEach(e=>{e.listen_for_name_changes()})}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(93),r=n(24);class o extends s.TypedParam{static type(){return r.ParamType.BUTTON}get default_value_serialized(){return this.default_value}get raw_input_serialized(){return this._raw_input}get value_serialized(){return this.value}static are_raw_input_equal(e,t){return!0}static are_values_equal(e,t){return!0}press_button(){this.options.execute_callback()}}t.ButtonParam=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),r=n(192),o=s.__importDefault(n(21)),i=n(7),a=n(24),_=["r","g","b"];class c extends r.TypedMultipleParam{constructor(){super(...arguments),this._value=new i.Color}static type(){return a.ParamType.COLOR}static get component_names(){return _}get default_value_serialized(){return o.default(this.default_value)?this.default_value:this.default_value.toArray()}get value_serialized(){return this.value.toArray()}_clone_raw_input(e){if(e instanceof i.Color)return e.clone();return[e[0],e[1],e[2]]}static are_raw_input_equal(e,t){return e instanceof i.Color?t instanceof i.Color?e.equals(t):e.r==t[0]&&e.g==t[1]&&e.b==t[2]:t instanceof i.Color?e[0]==t.r&&e[1]==t.g&&e[2]==t.b:e[0]==t[0]&&e[1]==t[1]&&e[2]==t[2]}static are_values_equal(e,t){return e.equals(t)}init_components(){super.init_components(),this.r=this.components[0],this.g=this.components[1],this.b=this.components[2]}set_value_from_components(){this._value.r=this.r.value,this._value.g=this.g.value,this._value.b=this.b.value}}t.ColorParam=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(93),r=n(24);class o extends s.TypedParam{static type(){return r.ParamType.FOLDER}get default_value_serialized(){return this.default_value}get raw_input_serialized(){return this._raw_input}get value_serialized(){return this.value}static are_raw_input_equal(e,t){return!0}static are_values_equal(e,t){return!0}}t.FolderParam=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3).__importDefault(n(44)),r=n(191),o=n(24),i=n(49);class a extends r.TypedNumericParam{static type(){return o.ParamType.INTEGER}get default_value_serialized(){return this.default_value}get raw_input_serialized(){return this.raw_input}get value_serialized(){return this.value}static are_raw_input_equal(e,t){return e==t}static are_values_equal(e,t){return e==t}static convert(e){if(s.default(e))return Math.round(e);if(i.CoreString.is_number(e)){const t=parseInt(e);if(s.default(t))return t}return null}convert(e){const t=a.convert(e);return t?this.options.ensure_in_range(t):t}}t.IntegerParam=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(14);class r{constructor(e=0,t=0){this._position=e,this._value=t}to_json(){return{position:this._position,value:this._value}}get position(){return this._position}get value(){return this._value}copy(e){this._position=e.position,this._value=e.value}clone(){const e=new r;return e.copy(this),e}is_equal(e){return this._position==e.position&&this._value==e.value}is_equal_json(e){return this._position==e.position&&this._value==e.value}from_json(e){this._position=e.position,this._value=e.value}static are_equal_json(e,t){return e.position==t.position&&e.value==t.value}static from_json(e){return new r(e.position,e.value)}}var o;t.RampPoint=r,function(e){e.LINEAR="linear"}(o=t.RampInterpolation||(t.RampInterpolation={}));class i{constructor(e=o.LINEAR,t=[]){this._interpolation=e,this._points=t,this._uuid=s.MathUtils.generateUUID()}get uuid(){return this._uuid}get interpolation(){return this._interpolation}get points(){return this._points}static from_json(e){const t=[];for(let n of e.points)t.push(r.from_json(n));return new i(e.interpolation,t)}to_json(){return{interpolation:this._interpolation,points:this._points.map(e=>e.to_json())}}clone(){const e=new i;return e.copy(this),e}copy(e){this._interpolation=e.interpolation;let t=0;for(let n of e.points){const e=this._points[t];e?e.copy(n):this._points.push(n.clone()),t+=1}}is_equal(e){if(this._interpolation!=e.interpolation)return!1;const t=e.points;if(this._points.length!=t.length)return!1;let n=0;for(let e of this._points){const s=t[n];if(!e.is_equal(s))return!1;n+=1}return!0}is_equal_json(e){if(this._interpolation!=e.interpolation)return!1;if(this._points.length!=e.points.length)return!1;let t=0;for(let n of this._points){const s=e.points[t];if(!n.is_equal_json(s))return!1;t+=1}return!0}static are_json_equal(e,t){if(e.interpolation!=t.interpolation)return!1;if(e.points.length!=t.points.length)return!1;let n=0;for(let s of e.points){const e=t.points[n];if(!r.are_equal_json(s,e))return!1;n+=1}return!0}from_json(e){this._interpolation=e.interpolation;let t=0;for(let n of e.points){const e=this._points[t];e?e.from_json(n):this._points.push(r.from_json(n)),t+=1}}}t.RampValue=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(93),r=n(24);class o extends s.TypedParam{static type(){return r.ParamType.SEPARATOR}get default_value_serialized(){return this.default_value}get raw_input_serialized(){return this._raw_input}get value_serialized(){return this.value}static are_raw_input_equal(e,t){return!0}static are_values_equal(e,t){return!0}}t.SeparatorParam=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),r=n(192),o=s.__importDefault(n(21)),i=n(2),a=n(24),_=["x","y"];class c extends r.TypedMultipleParam{constructor(){super(...arguments),this._value=new i.Vector2}static type(){return a.ParamType.VECTOR2}static get component_names(){return _}get default_value_serialized(){return o.default(this.default_value)?this.default_value:this.default_value.toArray()}get value_serialized(){return this.value.toArray()}_clone_raw_input(e){if(e instanceof i.Vector2)return e.clone();return[e[0],e[1]]}static are_raw_input_equal(e,t){return e instanceof i.Vector2?t instanceof i.Vector2?e.equals(t):e.x==t[0]&&e.y==t[1]:t instanceof i.Vector2?e[0]==t.x&&e[1]==t.y:e[0]==t[0]&&e[1]==t[1]}static are_values_equal(e,t){return e.equals(t)}init_components(){super.init_components(),this.x=this.components[0],this.y=this.components[1]}set_value_from_components(){this._value.x=this.x.value,this._value.y=this.y.value}}t.Vector2Param=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),r=n(192),o=s.__importDefault(n(21)),i=n(1),a=n(24),_=["x","y","z"];class c extends r.TypedMultipleParam{constructor(){super(...arguments),this._value=new i.Vector3}static type(){return a.ParamType.VECTOR3}static get component_names(){return _}get default_value_serialized(){return o.default(this.default_value)?this.default_value:this.default_value.toArray()}get value_serialized(){return this.value.toArray()}_clone_raw_input(e){if(e instanceof i.Vector3)return e.clone();return[e[0],e[1],e[2]]}static are_raw_input_equal(e,t){return e instanceof i.Vector3?t instanceof i.Vector3?e.equals(t):e.x==t[0]&&e.y==t[1]&&e.z==t[2]:t instanceof i.Vector3?e[0]==t.x&&e[1]==t.y&&e[2]==t.z:e[0]==t[0]&&e[1]==t[1]&&e[2]==t[2]}static are_values_equal(e,t){return e.equals(t)}init_components(){super.init_components(),this.x=this.components[0],this.y=this.components[1],this.z=this.components[2]}set_value_from_components(){this._value.x=this.x.value,this._value.y=this.y.value,this._value.z=this.z.value}}t.Vector3Param=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),r=n(192),o=s.__importDefault(n(21)),i=n(20),a=n(24),_=["x","y","z","w"];class c extends r.TypedMultipleParam{constructor(){super(...arguments),this._value=new i.Vector4}static type(){return a.ParamType.VECTOR4}static get component_names(){return _}get default_value_serialized(){return o.default(this.default_value)?this.default_value:this.default_value.toArray()}get value_serialized(){return this.value.toArray()}_clone_raw_input(e){if(e instanceof i.Vector4)return e.clone();return[e[0],e[1],e[2],e[3]]}static are_raw_input_equal(e,t){return e instanceof i.Vector4?t instanceof i.Vector4?e.equals(t):e.x==t[0]&&e.y==t[1]&&e.z==t[2]&&e.w==t[3]:t instanceof i.Vector4?e[0]==t.x&&e[1]==t.y&&e[2]==t.z&&e[3]==t.w:e[0]==t[0]&&e[1]==t[1]&&e[2]==t[2]&&e[3]==t[3]}static are_values_equal(e,t){return e.equals(t)}init_components(){super.init_components(),this.x=this.components[0],this.y=this.components[1],this.z=this.components[2],this.w=this.components[3]}set_value_from_components(){this._value.x=this.x.value,this._value.y=this.y.value,this._value.z=this.z.value,this._value.w=this.w.value}}t.Vector4Param=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ParamsValueAccessor=class{constructor(){}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ProcessingContext=class{constructor(e){this._frame=0}copy(e){this._frame=e.frame}get frame(){return this._frame}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(614),r=n(615),o=n(617);t.IOController=class{constructor(e){this.node=e,this._connections=new s.ConnectionsController(this.node)}get connections(){return this._connections}get inputs(){return this._inputs=this._inputs||new r.InputsController(this.node)}has_inputs(){return null!=this._inputs}get outputs(){return this._outputs=this._outputs||new o.OutputsController(this.node)}has_outputs(){return null!=this._outputs}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3).__importDefault(n(92));t.ConnectionsController=class{constructor(e){this._node=e,this._output_connections=new Map}init_inputs(){const e=this._node.io.inputs.max_inputs_count;this._input_connections=new Array(e)}add_input_connection(e){this._input_connections?this._input_connections[e.input_index]=e:console.warn("input connections array not initialized")}remove_input_connection(e){if(this._input_connections)if(e.input_index<this._input_connections.length){this._input_connections[e.input_index]=void 0;let t=!0;for(let n=e.input_index;n<this._input_connections.length;n++)this._input_connections[n]&&(t=!1);t&&(this._input_connections=this._input_connections.slice(0,e.input_index))}else console.warn(`attempt to remove an input connection at index ${e.input_index}`);else console.warn("input connections array not initialized")}input_connection(e){if(this._input_connections)return this._input_connections[e]}first_input_connection(){return s.default(this._input_connections)[0]}input_connections(){return this._input_connections}add_output_connection(e){const t=e.output_index,n=e.id;let s=this._output_connections.get(t);s||(s=new Map,this._output_connections.set(t,s)),s.set(n,e)}remove_output_connection(e){const t=e.output_index,n=e.id;let s=this._output_connections.get(t);s&&s.delete(n)}output_connections(){let e=[];return this._output_connections.forEach((t,n)=>{t.forEach((t,n)=>{t&&e.push(t)})}),e}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),r=s.__importDefault(n(179)),o=s.__importDefault(n(48)),i=n(616),a=n(60),_=n(61),c=n(17),l=n(193);t.InputsController=class{constructor(e){this.node=e,this._graph_node_inputs=[],this._inputs=[],this._has_named_inputs=!1,this._min_inputs_count=0,this._max_inputs_count=0,this._depends_on_inputs=!0,this._override_clonable_state=!1}set_depends_on_inputs(e){this._depends_on_inputs=e}set_min_inputs_count(e){this._min_inputs_count=e}set_max_inputs_count(e){this._max_inputs_count=e,this.init_graph_node_inputs()}named_input_connection_points_by_name(e){if(this._named_input_connection_points)for(let t of this._named_input_connection_points)if(t.name==e)return t}set_named_input_connection_points(e){this._has_named_inputs=!0,this._named_input_connection_points=e,this.set_min_inputs_count(0),this.set_max_inputs_count(e.length),this.init_graph_node_inputs(),this.node.emit(_.NodeEvent.NAMED_INPUTS_UPDATED)}get has_named_inputs(){return this._has_named_inputs}get named_input_connection_points(){return this._named_input_connection_points||[]}init_graph_node_inputs(){for(let e=0;e<this._max_inputs_count;e++)this._graph_node_inputs[e]=this._graph_node_inputs[e]||this._create_graph_node_input(e)}_create_graph_node_input(e){const t=new a.CoreGraphNode(this.node.scene,`input_${e}`);return this.node.add_graph_input(t),t}get max_inputs_count(){return this._max_inputs_count||0}input_graph_node(e){return this._graph_node_inputs[e]}set_count(e,t){null==t&&(t=e),this.set_min_inputs_count(e),this.set_max_inputs_count(t),this.init_inputs_clonable_state(),this.init_connections_controller_inputs()}init_connections_controller_inputs(){this.node.io.connections.init_inputs()}eval_required_inputs_p(){return s.__awaiter(this,void 0,void 0,(function*(){let e=[];if(this._max_inputs_count>0){const t=[];if(this.inputs().forEach((e,n)=>{e&&t.push(n)}),t.length<this._min_inputs_count)this.node.states.error.set("inputs are missing");else if(t.length>0){const n=t.map(e=>this.node.io.inputs.eval_required_input(e));e=yield Promise.all(n)}}return e}))}eval_required_input(e){return s.__awaiter(this,void 0,void 0,(function*(){const t=yield this.node.container_controller.request_input_container(e);if(t&&t.core_content());else{const t=this.input(e);if(t){const n=t.states.error.message;n&&this.node.states.error.set(`input ${e} is invalid (error: ${n})`)}}return t}))}get_named_input_index(e){if(this._named_input_connection_points)for(let t=0;t<this._named_input_connection_points.length;t++)if(this._named_input_connection_points[t].name==e)return t;return-1}get_input_index(e){if(o.default(e)){if(this.has_named_inputs)return this.get_named_input_index(e);throw new Error(`node ${this.node.full_path()} has no named inputs`)}return e}set_input(e,t,n=0){const s=this.get_input_index(e)||0;if(s<0){const t=`invalid input (${e}) for node ${this.node.full_path()}`;throw console.warn(t),new Error(t)}let r=0;if(t&&t.io.outputs.has_named_outputs&&(r=t.io.outputs.get_output_index(n),null==r||r<0))return void console.warn(`node ${t.full_path()} does not have an output named ${n}`);const o=this._graph_node_inputs[s];if(null==o){const e=`graph_input_node not found at index ${s}`;throw console.warn(e),new Error(e)}if(t&&this.node.parent!=t.parent)return;const a=this._inputs[s];let c=null,l=void 0;this.node.io.connections&&(l=this.node.io.connections.input_connection(s)),l&&(c=l.output_index),t===a&&r==c||(null!=a&&this._depends_on_inputs&&o.remove_graph_input(a),null!=t?o.add_graph_input(t)?(this._depends_on_inputs||o.remove_graph_input(t),l&&l.disconnect({set_input:!1}),this._inputs[s]=t,new i.NodeConnection(t,this.node,r,s)):console.warn(`cannot connect ${t.full_path()} to ${this.node.full_path()}`):(this._inputs[s]=null,l&&l.disconnect({set_input:!1})),this._run_on_set_input_hooks(),o.set_successors_dirty(),this.node.emit(_.NodeEvent.INPUTS_UPDATED))}remove_input(e){r.default(this.inputs(),(t,n)=>{null!=t&&null!=e&&t.graph_node_id===e.graph_node_id&&this.set_input(n,null)})}input(e){return this._inputs[e]}named_input(e){if(this.has_named_inputs){const t=this.get_input_index(e);return this._inputs[t]}return null}named_input_connection_point(e){if(this.has_named_inputs&&this._named_input_connection_points){const t=this.get_input_index(e);return this._named_input_connection_points[t]}}has_named_input(e){return this.get_named_input_index(e)>=0}has_input(e){return null!=this._inputs[e]}inputs(){return this._inputs}override_clonable_state_allowed(){let e=!1;for(let t of this.inputs_clonable_state())t==c.InputCloneMode.FROM_NODE&&(e=!0);return e}inputs_clonable_state(){return this._inputs_clonable_states=this._inputs_clonable_states||this.init_inputs_clonable_state()}input_cloned(e){return this.input_clonable_state_with_override(e)}inputs_clonable_state_with_override(){const e=[],t=this.inputs_clonable_state();for(let n=0;n<t.length;n++)e.push(this.input_clonable_state_with_override(n));return e}input_clonable_state_with_override(e){const t=this.inputs_clonable_state()[e];switch(t){case c.InputCloneMode.ALWAYS:return!0;case c.InputCloneMode.NEVER:return!1;case c.InputCloneMode.FROM_NODE:return!this._override_clonable_state}return l.TypeAssert.unreachable(t)}init_inputs_clonable_state(e=null){return e&&(this._user_inputs_clonable_states=e),this._inputs_clonable_states=this._user_inputs_clonable_states||this._default_inputs_clonale_state_values(),this._inputs_clonable_states}_default_inputs_clonale_state_values(){const e=[];for(let t=0;t<this._max_inputs_count;t++)e.push(c.InputCloneMode.ALWAYS);return e}set_override_clonable_state(e){this._override_clonable_state=e,this.node.emit(_.NodeEvent.OVERRIDE_CLONABLE_STATE_UPDATE)}override_clonable_state(){return this._override_clonable_state}add_on_set_input_hook(e,t){this._on_update_hooks=this._on_update_hooks||[],this._on_update_hook_names=this._on_update_hook_names||[],this._on_update_hook_names.includes(e)?console.warn(`hook with name ${e} already exists`,this.node):(this._on_update_hooks.push(t),this._on_update_hook_names.push(e))}_run_on_set_input_hooks(){if(this._on_update_hooks)for(let e of this._on_update_hooks)e()}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class s{constructor(e,t,n=0,r=0){this._node_src=e,this._node_dest=t,this._output_index=n,this._input_index=r,this._id=s._next_id++,this._node_src.io.connections&&this._node_dest.io.connections&&(this._node_src.io.connections.add_output_connection(this),this._node_dest.io.connections.add_input_connection(this))}get id(){return this._id}get node_src(){return this._node_src}get node_dest(){return this._node_dest}get output_index(){return this._output_index}get input_index(){return this._input_index}disconnect(e={}){this._node_src.io.connections&&this._node_dest.io.connections&&(this._node_src.io.connections.remove_output_connection(this),this._node_dest.io.connections.remove_input_connection(this)),!0===e.set_input&&this._node_dest.io.inputs.set_input(this._input_index,null)}}t.NodeConnection=s,s._next_id=0},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),r=s.__importDefault(n(44)),o=s.__importDefault(n(91)),i=s.__importDefault(n(48)),a=n(61);t.OutputsController=class{constructor(e){this.node=e,this._has_outputs=!1,this._has_named_outputs=!1}set_has_one_output(){this._has_outputs=!0}set_has_no_output(){this._has_outputs=!1}get has_outputs(){return this._has_outputs}get has_named_outputs(){return this._has_named_outputs}has_named_output(e){return this.get_named_output_index(e)>=0}get named_output_connection_points(){return this._named_output_connection_points||[]}named_output_connection(e){if(this._named_output_connection_points)return this._named_output_connection_points[e]}get_named_output_index(e){if(this._named_output_connection_points)for(let t=0;t<this._named_output_connection_points.length;t++)if(this._named_output_connection_points[t].name==e)return t;return-1}get_output_index(e){return null!=e?i.default(e)?this.has_named_outputs?this.get_named_output_index(e):(console.warn(`node ${this.node.full_path()} has no named outputs`),-1):e:-1}named_output_connection_points_by_name(e){if(this._named_output_connection_points)for(let t of this._named_output_connection_points)if(t.name==e)return t}set_named_output_connection_points(e,t=!0){this._has_named_outputs=!0,this._named_output_connection_points=e,t&&this.node.scene&&this.node.set_dirty(this.node),this.node.emit(a.NodeEvent.NAMED_OUTPUTS_UPDATED)}used_output_names(){if(this.node.io.connections){const e=o.default(this.node.io.connections.output_connections().map(e=>e?e.output_index:null)),t=[];return e.forEach(e=>{r.default(e)&&t.push(e)}),t.map(e=>this.named_output_connection_points[e].name)}return[]}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ParamsAccessor=class{constructor(){}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(115);class r extends s.TypedContainer{set_content(e){super.set_content(e)}}t.EventContainer=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.BaseEventsController=class{constructor(){this._nodes_by_graph_node_id=new Map}register_node(e){this._nodes_by_graph_node_id.set(e.graph_node_id,e)}unregister_node(e){this._nodes_by_graph_node_id.delete(e.graph_node_id)}process(e,t,n){this._nodes_by_graph_node_id.forEach(s=>s.process_event(e,t,n))}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.LifeCycleController=class{constructor(e){this.scene=e,this._lifecycle_on_create_allowed=!0}on_create_hook_allowed(){return this.scene.loading_controller.loaded&&this._lifecycle_on_create_allowed}on_create_prevent(e){this._lifecycle_on_create_allowed=!1,e(),this._lifecycle_on_create_allowed=!0}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3);t.LoadingController=class{constructor(e){this.scene=e,this._loading_state=!0,this._auto_updating=!0,this._first_object_loaded=!1}mark_as_loading(){this._set_loading_state(!0)}mark_as_loaded(){return s.__awaiter(this,void 0,void 0,(function*(){yield this._set_loading_state(!1)}))}_set_loading_state(e){return s.__awaiter(this,void 0,void 0,(function*(){this._loading_state=e,yield this.set_auto_update(!this._loading_state)}))}get is_loading(){return this._loading_state}get loaded(){return!this._loading_state}get auto_updating(){return this._auto_updating}set_auto_update(e){return s.__awaiter(this,void 0,void 0,(function*(){if(this._auto_updating!==e&&(this._auto_updating=e,this._auto_updating)){const e=this.scene.root;e&&(yield e.process_queue())}}))}on_first_object_loaded(){var e;if(!this._first_object_loaded){this._first_object_loaded=!0;const t=document.getElementById("scene_loading_container");t&&(null===(e=t.parentElement)||void 0===e||e.removeChild(t))}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ExpressionsController=class{constructor(){this._params_by_id=new Map}register_param(e){this._params_by_id.set(e.graph_node_id,e)}deregister_param(e){this._params_by_id.delete(e.graph_node_id)}regenerate_referring_expressions(e){e.name_controller.graph_node.set_successors_dirty(e)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(625),r=n(128);t.MissingReferencesController=class{constructor(){this.references=new Map}register(e,t,n){const o=new s.MissingExpressionReference(e,n);return r.MapUtils.push_on_array_at_entry(this.references,e.graph_node_id,o),o}deregister_param(e){this.references.delete(e.graph_node_id)}check_for_missing_references(e){this._check_for_missing_references_for_node(e);for(let t of e.params.all)this._check_for_missing_references_for_param(t)}_check_for_missing_references_for_node(e){const t=e.graph_node_id;this.references.forEach((n,s)=>{let r=!1;for(let t of n)t.matches_path(e.full_path())&&(r=!0,t.resolve_missing_dependencies());r&&this.references.delete(t)})}_check_for_missing_references_for_param(e){const t=e.graph_node_id;this.references.forEach((n,s)=>{let r=!1;for(let t of n)t.matches_path(e.full_path())&&(r=!0,t.resolve_missing_dependencies());r&&this.references.delete(t)})}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(101);t.MissingExpressionReference=class{constructor(e,t){this.param=e,this.path=t}matches_path(e){return s.CoreWalker.make_absolute_path(this.param.node,this.path)==e}update_from_method_dependency_name_change(){var e;null===(e=this.param.expression_controller)||void 0===e||e.update_from_method_dependency_name_change()}resolve_missing_dependencies(){const e=this.param.raw_input_serialized;this.param.set(this.param.default_value),this.param.set(e)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),r=s.__importDefault(n(355)),o=s.__importDefault(n(83)),i=s.__importDefault(n(92)),a=n(627),_=n(49);t.NodesController=class{constructor(e){this.scene=e,this._node_context_signatures={},this._instanciated_nodes_by_context_and_type={}}init(){this._root=new a.ObjectsManagerNode(this.scene),this._root.initialize_base_and_node(),this._root.init_default_scene()}get root(){return this._root}objects_from_mask(e){const t=e.split(" ");let n=this.root.children();n=n.filter(e=>_.CoreString.matches_one_mask(e.name,t));const s=n.map(e=>e.object);return i.default(s)}clear(){var e;const t=this.root.children();for(let n of t)null===(e=this.root.children_controller)||void 0===e||e.remove_node(n)}node(e){return"/"===e?this.root:this.root.node(e)}all_nodes(){let e=[this.root],t=[this.root],n=0;for(;t.length>0&&n<10;){const s=o.default(t.map(e=>e.children_allowed()?e.children():[]));e=r.default(e,s),t=s,n+=1}return o.default(e)}reset_node_context_signatures(){this._node_context_signatures={}}register_node_context_signature(e){e.children_allowed()&&e.children_controller&&(this._node_context_signatures[e.children_controller.node_context_signature()]=!0)}node_context_signatures(){return Object.keys(this._node_context_signatures).sort().map(e=>e.toLowerCase())}add_to_instanciated_node(e){const t=e.node_context(),n=e.type;this._instanciated_nodes_by_context_and_type[t]=this._instanciated_nodes_by_context_and_type[t]||{},this._instanciated_nodes_by_context_and_type[t][n]=this._instanciated_nodes_by_context_and_type[t][n]||{},this._instanciated_nodes_by_context_and_type[t][n][e.graph_node_id]=e}remove_from_instanciated_node(e){const t=e.node_context(),n=e.type;delete this._instanciated_nodes_by_context_and_type[t][n][e.graph_node_id]}instanciated_nodes(e,t){const n=[];if(this._instanciated_nodes_by_context_and_type[e]){const s=this._instanciated_nodes_by_context_and_type[e][t];if(s)for(let e of Object.keys(s))n.push(s[e])}return n}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),r=n(40),o=n(628),i=n(67),a=n(27),_=n(5);class c extends _.NodeParamsConfig{}const l=new c;class u extends o.TypedBaseManagerNode{constructor(){super(...arguments),this.params_config=l,this._object=new r.Group,this._queued_nodes_by_id={},this._queued_nodes_by_path={},this._expected_geo_nodes={},this._process_queue_start=-1,this._children_controller_context=a.NodeContext.OBJ}static type(){return"obj"}initialize_node(){var e;null===(e=this.children_controller)||void 0===e||e.init(),this.lifecycle.add_on_child_add_hook(this._on_child_add.bind(this)),this.lifecycle.add_on_child_remove_hook(this._on_child_remove.bind(this))}init_default_scene(){this._object.name="_WORLD_",this._scene.default_scene.add(this._object)}object(){return this._object}create_node(e){return super.create_node(e)}children(){return super.children()}nodes_by_type(e){return super.nodes_by_type(e)}multiple_display_flags_allowed(){return!0}add_to_queue(e){const t=e.graph_node_id;if(null==this._queued_nodes_by_id[t])return this._queued_nodes_by_id[t]=e}process_queue(){return s.__awaiter(this,void 0,void 0,(function*(){this._queued_nodes_by_path={};const e=Object.keys(this._queued_nodes_by_id);for(let t of e){const e=this._queued_nodes_by_id[t];delete this._queued_nodes_by_id[t];const n=`_____${e.render_order}__${e.full_path()}`;this._queued_nodes_by_path[n]=e}const t=Object.keys(this._queued_nodes_by_path).sort().map(e=>{const t=this._queued_nodes_by_path[e];return this.update_object(t)});this._expected_geo_nodes=this._expected_geo_nodes||(yield this.expected_loading_geo_nodes_by_id()),this._process_queue_start=performance.now(),Promise.all(t).then(()=>{i.POLY.log(`SCENE LOADED '${this.scene.name}' in ${performance.now()-this._process_queue_start}`)})}))}update_object(e){this.scene.loading_controller.auto_updating?this.add_to_scene(e):this.add_to_queue(e)}get_parent_for_node(e){if(e.attachable_to_hierarchy){const t=e.io.inputs.input(0);return t?t.children_group:this._object}return null}add_to_scene(e){if(e.attachable_to_hierarchy){const t=this.get_parent_for_node(e);t&&(e.used_in_scene?e.add_object_to_parent(t):e.remove_object_from_parent())}}remove_from_scene(e){e.remove_object_from_parent()}are_children_cooking(){const e=this.children();for(let t of e)if(t.is_display_node_cooking())return!0;return!1}expected_loading_geo_nodes_by_id(){return s.__awaiter(this,void 0,void 0,(function*(){const e=this.nodes_by_type("geo"),t={};for(let n of e){(yield n.is_displayed())&&(t[n.graph_node_id]=n)}return t}))}add_to_parent_transform(e){this.update_object(e)}remove_from_parent_transform(e){this.update_object(e)}_on_child_add(e){e&&this.update_object(e)}_on_child_remove(e){e&&this.remove_from_scene(e)}}t.ObjectsManagerNode=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(81),r=n(27),o=n(113),i=n(629);class a extends s.TypedNode{constructor(){super(...arguments),this.container_controller=new o.TypedContainerController(this,i.ManagerContainer)}static node_context(){return r.NodeContext.MANAGER}}t.TypedBaseManagerNode=a;t.BaseManagerNodeClass=class extends a{}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(115);class r extends s.TypedContainer{set_content(e){super.set_content(e)}}t.ManagerContainer=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),r=s.__importDefault(n(91)),o=s.__importDefault(n(168)),i=s.__importDefault(n(102)),a=n(631);t.CorePerformance=class{constructor(){this._started=!1,this._start_time=0,this._previous_timestamp=0,this._nodes_cook_data={},this._durations_by_name={},this._durations_count_by_name={}}profile(e,t){const n=performance.now();t();const s=performance.now()-n;console.log(`${e}: ${s}`)}start(){this._started||(this.reset(),this._started=!0,this._start_time=performance.now(),this._nodes_cook_data={},this._previous_timestamp=this._start_time)}stop(){this.reset()}reset(){this._started=!1,this._start_time=null,this._durations_by_name={},this._durations_count_by_name={},this._nodes_cook_data={}}get started(){return this._started}record_node_cook_data(e){const t=e.graph_node_id;null==this._nodes_cook_data[t]&&(this._nodes_cook_data[t]=new a.PerformanceNode(e)),this._nodes_cook_data[t].update_cook_data()}record(e){this.started||this.start();const t=performance.now();return null==this._durations_by_name[e]&&(this._durations_by_name[e]=0),this._durations_by_name[e]+=t-this._previous_timestamp,null==this._durations_count_by_name[e]&&(this._durations_count_by_name[e]=0),this._durations_count_by_name[e]+=1,this._previous_timestamp=t}print(){this.print_node_cook_data(),this.print_recordings()}print_node_cook_data(){let e=Object.values(this._nodes_cook_data);e=i.default(e,e=>-e.cook_time_total);const t=e.map(e=>e.print_object());console.log("--------------- NODES COOK TIME -----------");const n=[],s=i.default(t,e=>-e.cook_time_total);for(let e of s)n.push(e);return console.table(n),t}print_recordings(){const e=o.default(this._durations_by_name),t=o.default(this._durations_count_by_name),n=[],s={};for(let t of Object.keys(e)){const r=e[t];n.push(r),null==s[r]&&(s[r]=[]),s[r].push(t)}n.sort((e,t)=>e-t);const i=r.default(n);console.log("--------------- PERF RECORDINGS -----------");const a=[];for(let e of i){const n=s[e];for(let s of n){const n=t[s],r={duration:e,name:s,count:n,duration_per_iteration:e/n};a.push(r)}}return console.table(a),a}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.PerformanceNode=class{constructor(e){this._node=e,this._cooks_count=0,this._cook_time_total=0,this._cook_time_total_with_inputs=0,this._cook_time_total_params=0}update_cook_data(){this._cooks_count+=1,this._cook_time_total+=this._node.cook_controller.cook_time,this._cook_time_total_with_inputs+=this._node.cook_controller.cook_time_with_inputs,this._cook_time_total_params+=this._node.cook_controller.cook_time_params}get cook_time_total(){return this._cook_time_total}get cook_time_per_iteration(){return this._cooks_count>0?this._cook_time_total/this._cooks_count:0}get cook_time_total_with_inputs(){return this._cook_time_total_with_inputs}get cook_time_total_with_inputs_per_iteration(){return this._cooks_count>0?this._cook_time_total_with_inputs/this._cooks_count:0}get cook_time_total_params(){return this._cook_time_total_params}get cook_time_total_params_per_iteration(){return this._cooks_count>0?this._cook_time_total_params/this._cooks_count:0}get cooks_count(){return this._cooks_count}print_object(){return{full_path:this._node.full_path(),cooks_count:this.cooks_count,cook_time_total:this.cook_time_total,cook_time_per_iteration:this.cook_time_per_iteration,cook_time_total_with_inputs:this.cook_time_total_with_inputs,cook_time_total_with_inputs_per_iteration:this.cook_time_total_with_inputs_per_iteration,cook_time_total_params:this.cook_time_total_params,cook_time_total_params_per_iteration:this.cook_time_total_params_per_iteration}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(60),r=n(633);t.TimeController=class{constructor(e){this.scene=e,this.self=this,this._frame=1,this._time=0,this._prev_performance_now=0,this._frame_range=[1,600],this._frame_range_locked=[!0,!0],this._playing=!1,this._graph_node=new s.CoreGraphNode(e,"time controller")}get graph_node(){return this._graph_node}get frame(){return this._frame}get time(){return this._time}get frame_range(){return this._frame_range}get frame_range_locked(){return this._frame_range_locked}set_frame_range(e,t){this._frame_range[0]=Math.floor(e),this._frame_range[1]=Math.floor(t),this.scene.dispatch_controller.dispatch(this._graph_node,r.SceneEvent.FRAME_RANGE_UPDATED)}set_frame_range_locked(e,t){this._frame_range_locked[0]=e,this._frame_range_locked[1]=t,this.scene.dispatch_controller.dispatch(this._graph_node,r.SceneEvent.FRAME_RANGE_UPDATED)}set_time(e,t=!0){if(e!=this._time){if(this._time=e,t){const e=Math.floor(60*this._time);this._frame=e}this.scene.dispatch_controller.dispatch(this._graph_node,r.SceneEvent.FRAME_UPDATED),this.scene.uniforms_controller.update_time_dependent_uniform_owners(),this.scene.cooker.block(),this.graph_node.set_successors_dirty(),this.scene.cooker.unblock()}}set_frame(e,t=!0){e!=this._frame&&(e=this._ensure_frame_within_bounds(e))!=this._frame&&(this._frame=e,t&&this.set_time(this._frame/60,!1))}increment_time_if_playing(){this._playing&&(this.scene.root.are_children_cooking()||this.increment_time())}increment_time(){const e=performance.now(),t=(e-this._prev_performance_now)/1e3,n=this._time+t;this._prev_performance_now=e,this.set_time(n)}_ensure_frame_within_bounds(e){return this._frame_range_locked[0]&&e<this._frame_range[0]?this._frame_range[1]:this._frame_range_locked[1]&&e>this._frame_range[1]?this._frame_range[0]:e}get playing(){return!0===this._playing}pause(){1==this._playing&&(this._playing=!1,this.scene.dispatch_controller.dispatch(this._graph_node,r.SceneEvent.PLAY_STATE_UPDATED))}play(){!0!==this._playing&&(this._playing=!0,this._prev_performance_now=performance.now(),this.scene.dispatch_controller.dispatch(this._graph_node,r.SceneEvent.PLAY_STATE_UPDATED))}toggle_play_pause(){this.playing?this.pause():this.play()}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.FRAME_RANGE_UPDATED="scene_frame_range_updated",e.FRAME_UPDATED="scene_frame_updated",e.PLAY_STATE_UPDATED="scene_play_state_updated"}(t.SceneEvent||(t.SceneEvent={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(344);t.PolySceneSerializer=class{constructor(e){this.scene=e}to_json(e=!1){const t={},n={};for(let r of this.scene.nodes_controller.all_nodes()){const o=new s.NodeSerializer(r);t[r.graph_node_id]=o.to_json(e);const i=r.params.all;for(let e of i)n[e.graph_node_id]=e.to_json()}return{nodes_by_graph_node_id:t,params_by_graph_node_id:n}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(2);t.UniformsController=class{constructor(e){this.scene=e,this._time_dependent_uniform_owners={},this._time_dependent_uniform_owners_ids=null,this._resolution=new s.Vector2(1,1),this._resolution_dependent_uniform_owners={},this._resolution_dependent_uniform_owners_ids=[]}add_time_dependent_uniform_owner(e,t){this._time_dependent_uniform_owners[e]=t,this._update_time_dependent_uniform_owners_ids()}remove_time_dependent_uniform_owner(e){delete this._time_dependent_uniform_owners[e],this._update_time_dependent_uniform_owners_ids()}_update_time_dependent_uniform_owners_ids(){this._time_dependent_uniform_owners_ids=Object.keys(this._time_dependent_uniform_owners)}update_time_dependent_uniform_owners(){const e=this.scene.time;if(this._time_dependent_uniform_owners_ids)for(let t of this._time_dependent_uniform_owners_ids){this._time_dependent_uniform_owners[t].time.value=e}}add_resolution_dependent_uniform_owner(e,t){this._resolution_dependent_uniform_owners[e]=t,this._update_resolution_dependent_uniform_owners_ids(),this._resolution&&this.update_resolution_dependent_uniforms(t)}remove_resolution_dependent_uniform_owner(e){delete this._resolution_dependent_uniform_owners[e],this._update_resolution_dependent_uniform_owners_ids()}_update_resolution_dependent_uniform_owners_ids(){this._resolution_dependent_uniform_owners_ids=Object.keys(this._resolution_dependent_uniform_owners)}update_resolution_dependent_uniform_owners(e){this._resolution.copy(e);for(let e of this._resolution_dependent_uniform_owners_ids){const t=this._resolution_dependent_uniform_owners[e];this.update_resolution_dependent_uniforms(t)}}update_resolution_dependent_uniforms(e){e.resolution.value.x=this._resolution.x*window.devicePixelRatio,e.resolution.value.y=this._resolution.y*window.devicePixelRatio}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(67);t.WebGLController=class{constructor(){this._require_webgl2=!1}require_webgl2(){return this._require_webgl2}set_require_webgl2(){this._require_webgl2||(this._require_webgl2=!0,s.POLY.renderers_controller.set_require_webgl2())}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(638),r=n(674),o=n(677),i=n(761),a=n(785),_=n(822),c=n(67);t.AllRegister=class{static run(){s.CopRegister.run(c.POLY),r.EventRegister.run(c.POLY),o.GlRegister.run(c.POLY),i.MatRegister.run(c.POLY),a.ObjRegister.run(c.POLY),_.SopRegister.run(c.POLY)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(129),r=n(639),o=n(666),i=n(134),a=n(672),_=n(673);t.CopRegister=class{static run(e){e.register_node(r.BuilderCopNode,s.CATEGORY_COP.ADVANCED),e.register_node(o.EnvMapCopNode,s.CATEGORY_COP.INPUT),e.register_node(i.FileCopNode,s.CATEGORY_COP.INPUT),e.register_node(a.NullCopNode,s.CATEGORY_COP.MISC),e.register_node(_.SwitchCopNode,s.CATEGORY_COP.MISC)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),r=n(408),o=n(75),i=n(26),a=n(55),_=n(0),c=n(54),l=n(0),u=n(22),d=n(0),h=n(0),p=n(70),m=n(0),f=n(77),g=n(130),v=n(131),y=n(657),b=n(5),x=n(132),T=n(268),C=n(27),P=n(665);class w extends b.NodeParamsConfig{constructor(){super(...arguments),this.resolution=b.ParamConfig.VECTOR2([256,256])}}const E=new w;class O extends g.TypedCopNode{constructor(){super(...arguments),this.params_config=E,this._assembler_controller=this._create_assembler_controller(),this._texture_mesh=new u.Mesh(new c.PlaneBufferGeometry(2,2)),this._texture_material=new i.ShaderMaterial({uniforms:{},vertexShader:"\nvoid main()\t{\n\tgl_Position = vec4( position, 1.0 );\n}\n",fragmentShader:""}),this._texture_scene=new a.Scene,this._texture_camera=new f.Camera,this._children_controller_context=C.NodeContext.GL}static type(){return"builder"}_create_assembler_controller(){const e=new x.GlobalsGeometryHandler,t=new v.GlAssemblerController(this,y.ShaderAssemblerTexture);return t.set_assembler_globals_handler(e),t}get assembler_controller(){return this._assembler_controller}initialize_node(){var e;this.lifecycle.add_on_create_hook(this.assembler_controller.on_create.bind(this.assembler_controller)),null===(e=this.children_controller)||void 0===e||e.init(),this._texture_mesh.material=this._texture_material,this._texture_scene.add(this._texture_mesh),this._texture_camera.position.z=1,this.dirty_controller.add_post_dirty_hook("_reset_if_resolution_changed",this._reset_if_resolution_changed.bind(this)),this.params.set_post_create_params_hook(()=>{this._render_target=this._create_render_target(),this._renderer=this._create_renderer(this._render_target)})}create_node(e){return super.create_node(e)}children(){return super.children()}nodes_by_type(e){return super.nodes_by_type(e)}_reset_if_resolution_changed(e){e&&e.graph_node_id==this.p.resolution.graph_node_id&&this._reset()}_reset(){this._render_target=this._create_render_target(),this._renderer=this._create_renderer(this._render_target),this._pixelBuffer=this._create_pixel_buffer()}_create_pixel_buffer(){const e=this.pv.resolution.x,t=this.pv.resolution.y;return new Float32Array(e*t*4)}cook(){return s.__awaiter(this,void 0,void 0,(function*(){yield this.compile_if_required(),this.render_on_target()}))}shaders_by_name(){return{fragment:this._fragment_shader}}compile_if_required(){return s.__awaiter(this,void 0,void 0,(function*(){this.assembler_controller.compile_required()&&(yield this.run_assembler(),this.assembler_controller.post_compile())}))}run_assembler(){return s.__awaiter(this,void 0,void 0,(function*(){const e=T.GlNodeFinder.find_output_nodes(this);if(e.length>1)return void this.states.error.set("only one output node allowed");const t=e[0];if(t){this.assembler_controller.assembler.set_root_nodes([t]),yield this.assembler_controller.assembler.update_fragment_shader();const e=this.assembler_controller.assembler.fragment_shader(),n=this.assembler_controller.assembler.uniforms();e&&n&&(this._fragment_shader=e,this._uniforms=n),this.assembler_controller.assembler.uniforms_time_dependent()?this.states.time_dependent.force_time_dependent():this.states.time_dependent.unforce_time_dependent()}this._fragment_shader&&this._uniforms&&(this._texture_material.fragmentShader=this._fragment_shader,this._texture_material.uniforms=this._uniforms,this._texture_material.needsUpdate=!0,this._texture_material.uniforms.resolution={value:this.pv.resolution})}))}_create_renderer(e){const t=new r.WebGLRenderer({antialias:!0});return t.setPixelRatio(window.devicePixelRatio),t.autoClear=!1,t.setRenderTarget(e),t}render_on_target(){return s.__awaiter(this,void 0,void 0,(function*(){const e=this.pv.resolution.x,t=this.pv.resolution.y;if(!this._renderer||!this._render_target)return;this._renderer.clear(),this._renderer.render(this._texture_scene,this._texture_camera),this._pixelBuffer=this._pixelBuffer||this._create_pixel_buffer(),this._renderer.readRenderTargetPixels(this._render_target,0,0,e,t,this._pixelBuffer);const n=new p.DataTexture(this._pixelBuffer,e,t,_.RGBAFormat,h.FloatType);yield P.CoreSleep.sleep(2e3),n?this.set_texture(n):this.cook_controller.end_cook()}))}_create_render_target(){const e=m.ClampToEdgeWrapping,t=m.ClampToEdgeWrapping,n=l.NearestFilter,s=l.NearestFilter;return new o.WebGLRenderTarget(this.pv.resolution.x,this.pv.resolution.y,{wrapS:e,wrapT:t,minFilter:n,magFilter:s,format:_.RGBAFormat,type:/(iPad|iPhone|iPod)/g.test(navigator.userAgent)?d.HalfFloatType:h.FloatType,stencilBuffer:!1,depthBuffer:!1})}}t.BuilderCopNode=O},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(115);class r extends s.TypedContainer{set_content(e){super.set_content(e)}texture(){return this._content}core_content(){return this._content}core_content_cloned(){var e;console.log("clone",this._content);const t=null===(e=this._content)||void 0===e?void 0:e.clone();return t&&(t.needsUpdate=!0),t}object(){return this.texture()}infos(){if(null!=this._content)return[this._content]}resolution(){return this._content&&this._content.image?[this._content.image.width,this._content.image.height]:[-1,-1]}}t.TextureContainer=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(358),r=n(61);class o extends s.BaseFlag{constructor(){super(...arguments),this._state=!1}on_update(){this.node.emit(r.NodeEvent.FLAG_BYPASS_UPDATED),this.node.set_dirty()}}t.BypassFlag=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(358),r=n(61);class o extends s.BaseFlag{on_update(){this.node.emit(r.NodeEvent.FLAG_DISPLAY_UPDATED)}}t.DisplayFlag=o},,,,,,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),r=n(16),o=n(33),i=s.__importDefault(n(168)),a=s.__importDefault(n(21)),_=s.__importDefault(n(44));t.GlNodeSpareParamsController=class{constructor(e){this.node=e,this._allow_inputs_created_from_params=!0}disallow_inputs_created_from_params(){this._allow_inputs_created_from_params=!1}initialize_node(){this.node.params.set_post_create_params_hook(this.create_inputs_from_params.bind(this))}create_inputs_from_params(){if(!this._allow_inputs_created_from_params)return;const e=[];for(let t of this.node.params.names){let n=!0;if(this._inputless_param_names&&this._inputless_param_names.length>0&&this._inputless_param_names.includes(t)&&(n=!1),n&&this.node.params.has(t)){const n=this.node.params.get(t);if(n&&!n.parent_param){const t=r.ParamTypeToConnectionPointTypeMap[n.type];if(t){const s=new o.TypedNamedConnectionPoint(n.name,t);e.push(s)}}}}this.node.io.inputs.set_named_input_connection_points(e)}set_inputless_param_names(e){return this._inputless_param_names=e}create_spare_parameters(){const e=new Map,t=new Map,n=this.node.params.spare_names,s={};for(let r of n)if(this.node.params.has(r)){const n=this.node.params.get(r);n&&(e.set(r,n.raw_input_serialized),t.set(r,n.default_value_serialized),s.names_to_delete=s.names_to_delete||[],s.names_to_delete.push(r))}for(let e of this.node.io.inputs.named_input_connection_points){const n=e.name,r=e.param_type;let o=e.init_value;const c=t.get(n),l=this.node.gl_input_default_value(n);if(o=null!=l?l:null!=c?c:e.init_value,a.default(e.init_value)&&_.default(o)){const t=new Array(e.init_value.length);for(let e=0;e<t.length;e++)t[e]=o;o=t}null!=o&&(s.to_add=s.to_add||[],s.to_add.push({name:n,type:r,init_value:i.default(o),options:{spare:!0}}))}if(!this.node.scene.loading_controller.is_loading){this.node.params.update_params(s);for(let t of this.node.params.spare)if(!t.parent_param){const n=e.get(t.name);n&&t.set(n)}}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(265),r=n(264);t.NodeJsonExporter=class{constructor(e){this._node=e}data(){var e,t,n,s;this.is_root()||this._node.scene.nodes_controller.register_node_context_signature(this._node),this._data={type:this._node.type};const r=this.nodes_data();if(Object.keys(r).length>0){this._data.nodes=r;const t=null===(e=this._node.children_controller)||void 0===e?void 0:e.context;t&&(this._data.children_context=t)}if(this.is_root()||(this._data.params=this.params_data(),this._data.inputs=this.inputs_data()),this._node.flags&&(this._data.flags={},this._node.flags.has_bypass()&&(null===(t=this._node.flags.bypass)||void 0===t?void 0:t.active)&&(this._data.flags.bypass=this._node.flags.bypass.active),this._node.flags.has_display()&&(this._data.flags.display=null===(n=this._node.flags.display)||void 0===n?void 0:n.active)),this._node.children_allowed()){const e=null===(s=this._node.children_controller)||void 0===s?void 0:s.selection;if(e&&this._node.children().length>0){const t=[],n={};for(let t of e.nodes())n[t.graph_node_id]=!0;for(let e of this._node.children())e.graph_node_id in n&&t.push(e);this._data.selection=t.map(e=>e.name)}}if(this._node.io.inputs.override_clonable_state_allowed()){const e=this._node.io.inputs.override_clonable_state();e&&(this._data.override_clonable_state=e)}return this.add_custom(),this._data}ui_data(){const e={};if(!this.is_root()){const t=this._node.ui_data;e.pos=t.position.toArray();const n=t.comment;n&&(e.comment=s.SceneJsonExporter.sanitize_string(n))}const t=this._node.children();return t.length>0&&(e.nodes={},t.forEach(t=>{const n=r.JsonExportDispatcher.dispatch_node(t);e.nodes[t.name]=n.ui_data()})),e}is_root(){return null===this._node.parent&&this._node.graph_node_id==this._node.root.graph_node_id}inputs_data(){const e=[];return this._node.io.inputs.inputs().forEach((t,n)=>{if(t){const s=this._node.io.connections.input_connection(n);if(this._node.io.inputs.has_named_inputs){const r=this._node.io.inputs.named_input_connection_points[n].name,o=s.output_index,i=t.io.outputs.named_output_connection_points[o].name;e.push({name:r,node:t.name,output:i})}else e.push(t.name)}}),e}params_data(){const e={};for(let t of this._node.params.names){const n=this._node.params.get(t);if(n&&!n.parent_param){const t=r.JsonExportDispatcher.dispatch_param(n);if(t.required){const s=t.data();e[n.name]=s}}}return e}nodes_data(){const e={};for(let t of this._node.children()){const n=r.JsonExportDispatcher.dispatch_node(t);e[t.name]=n.data()}return e}add_custom(){}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(156);class r extends s.ParamJsonExporter{add_main(){if(!this._require_data_complex())return this._param.raw_input_serialized;this._complex_data.raw_input=this._param.raw_input_serialized}}t.ParamNumericJsonExporter=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(156),r=n(265);class o extends s.ParamJsonExporter{add_main(){let e=this._param.raw_input;if(e=r.SceneJsonExporter.sanitize_string(e),!this._require_data_complex())return e;this._complex_data.raw_input=e}}t.ParamOperatorPathJsonExporter=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(156),r=n(265);class o extends s.ParamJsonExporter{add_main(){let e=this._param.raw_input;if(e=r.SceneJsonExporter.sanitize_string(e),!this._require_data_complex())return e;this._complex_data.raw_input=e}}t.ParamStringJsonExporter=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(156);class r extends s.ParamJsonExporter{add_main(){if(!this._require_data_complex())return this._param.raw_input_serialized;this._complex_data.raw_input=this._param.raw_input_serialized}}t.ParamRampJsonExporter=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),r=n(157),o=n(28),i=s.__importDefault(n(664)),a=n(194),_=n(195),c=n(50),l=n(24),u=n(33),d=n(16),h=n(29);class p extends r.BaseGlShaderAssembler{get _template_shader(){return{fragmentShader:i.default,vertexShader:void 0,uniforms:void 0}}fragment_shader(){return this._shaders_by_name.get(c.ShaderName.FRAGMENT)}uniforms(){return this._uniforms}update_fragment_shader(){return s.__awaiter(this,void 0,void 0,(function*(){this._lines=new Map,this._shaders_by_name=new Map;for(let e of this.shader_names)if(e==c.ShaderName.FRAGMENT){const t=this._template_shader.fragmentShader;this._lines.set(e,t.split("\n"))}this._root_nodes.length>0&&(yield this.build_code_from_nodes(this._root_nodes),this._build_lines()),this._uniforms=this._uniforms||{},this.add_uniforms(this._uniforms);for(let e of this.shader_names){const t=this._lines.get(e);t&&this._shaders_by_name.set(e,t.join("\n"))}const e=this._gl_parent_node.scene,t=this._gl_parent_node.graph_node_id;this.uniforms_time_dependent()?this._uniforms&&e.uniforms_controller.add_time_dependent_uniform_owner(t,this._uniforms):e.uniforms_controller.remove_time_dependent_uniform_owner(t)}))}add_output_params(e){e.add_param(l.ParamType.COLOR,"color",[1,1,1],{hidden:!0}),e.add_param(l.ParamType.FLOAT,"alpha",1,{hidden:!0})}add_globals_params(e){e.io.outputs.set_named_output_connection_points([new u.TypedNamedConnectionPoint("gl_FragCoord",d.ConnectionPointType.VEC2),new u.TypedNamedConnectionPoint("time",d.ConnectionPointType.FLOAT)])}create_shader_configs(){return[new a.ShaderConfig(c.ShaderName.FRAGMENT,["color","alpha"],[])]}create_variable_configs(){return[new _.VariableConfig("color",{prefix:"diffuseColor.xyz = "}),new _.VariableConfig("alpha",{prefix:"diffuseColor.a = ",default:"1.0"})]}insert_define_after(e){return"// INSERT DEFINE"}insert_body_after(e){return"// INSERT BODY"}lines_to_remove(e){return["// INSERT DEFINE","// INSERT BODY"]}handle_gl_FragCoord(e,t,n){"fragment"==t&&e.push(`vec2 ${n} = vec2(gl_FragCoord.x / resolution.x, gl_FragCoord.y / resolution.y)`)}set_node_lines_output(e,t){const n=this.input_names_for_shader_name(e,t.current_shader_name);if(n)for(let s of n){if(e.io.inputs.named_input(s)){const n=e.variable_for_input(s);let r;"color"==s&&(r=`diffuseColor.xyz = ${o.ThreeToGl.any(n)}`),"alpha"==s&&(r=`diffuseColor.a = ${o.ThreeToGl.any(n)}`),r&&t.add_body_lines(e,[r])}}}set_node_lines_globals(e,t){const n=t.current_shader_name;if(!this.shader_config(n))return;const s=[],r=[];for(let t of e.io.outputs.used_output_names()){const o=e.gl_var_name(t);switch(t){case"time":r.push(new h.UniformGLDefinition(e,d.ConnectionPointType.FLOAT,t)),s.push(`float ${o} = ${t}`),this.set_uniforms_time_dependent();break;case"gl_FragCoord":this.handle_gl_FragCoord(s,n,o)}}t.add_definitions(e,r,n),t.add_body_lines(e,s)}}t.ShaderAssemblerTexture=p},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),r=s.__importDefault(n(91)),o=n(364),i=n(128),a=n(29),_=n(363),c=n(196),l=n(660),u=n(662),d=n(266);t.CodeBuilder=class{constructor(e,t){this._assembler=e,this._gl_parent_node=t,this._param_configs_controller=new c.ParamConfigsController,this._param_configs_set_allowed=!0,this._lines=new Map,this._function_declared=new Map}build_from_nodes(e){return s.__awaiter(this,void 0,void 0,(function*(){const t=new o.TypedNodeTraverser(this._assembler,this._gl_parent_node);t.traverse(e);const n=new Map;for(let e of this.shader_names())n.set(e,t.nodes_for_shader_name(e));const s=t.sorted_nodes();for(let e of this.shader_names()){const t=this._assembler.root_nodes_by_shader_name(e);for(let s of t)i.MapUtils.push_on_array_at_entry(n,e,s)}const a=new Map;for(let e of s)a.set(e.graph_node_id,!0);for(let t of e)a.get(t.graph_node_id)||(s.push(t),a.set(t.graph_node_id,!0));for(let e of s)e.reset_code();for(let e of s)yield e.params.eval_all();this._shaders_collection_controller=new l.ShadersCollectionController(this.shader_names(),this.shader_names()[0]),this.reset();for(let e of this.shader_names()){const t=r.default(n.get(e));if(this._shaders_collection_controller.set_current_shader_name(e),t)for(let e of t)this._param_configs_set_allowed&&e.set_param_configs(),e.set_lines(this._shaders_collection_controller)}this._param_configs_set_allowed&&this.set_param_configs(s),this.set_code_lines(s)}))}disallow_new_param_configs(){this._param_configs_set_allowed=!1}allow_new_param_configs(){this._param_configs_set_allowed=!0}shader_names(){return this._assembler.shader_names}reset(){for(let e of this.shader_names()){const t=new Map;this._lines.set(e,t),this._function_declared.set(e,new Map)}}param_configs(){return this._param_configs_controller.list||[]}lines(e,t){return this._lines.get(e).get(t)}all_lines(){return this._lines}set_param_configs(e){this._param_configs_controller.reset();for(let t of e){const e=t.param_configs();if(e)for(let t of e)this._param_configs_controller.push(t)}}set_code_lines(e){for(let t of this.shader_names())this.add_code_lines(e,t)}add_code_lines(e,t){this.add_definitions(e,t,a.GLDefinitionType.FUNCTION,d.LineType.FUNCTION_DECLARATION),this.add_definitions(e,t,a.GLDefinitionType.UNIFORM,d.LineType.DEFINE),this.add_definitions(e,t,a.GLDefinitionType.VARYING,d.LineType.DEFINE),this.add_definitions(e,t,a.GLDefinitionType.ATTRIBUTE,d.LineType.DEFINE),this.add_code_line_for_nodes_and_line_type(e,t,d.LineType.BODY)}add_definitions(e,t,n,s){if(!this._shaders_collection_controller)return;const r=[];for(let s of e){let e=this._shaders_collection_controller.definitions(t,s);if(e){e=e.filter(e=>e.definition_type==n);for(let t of e)r.push(t)}}if(r.length>0){const e=new _.TypedGLDefinitionCollection(r),n=e.uniq();if(e.errored)throw`code builder error: ${e.error_message}`;const o=new Map,a=new Map;for(let e of n){const t=e.node.graph_node_id;a.has(t)||a.set(t,!0),i.MapUtils.push_on_array_at_entry(o,t,e)}const c=this._lines.get(t);a.forEach((e,t)=>{const n=o.get(t);if(n){const e=n[0];if(e){const t=u.CodeFormatter.node_comment(e.node,s);i.MapUtils.push_on_array_at_entry(c,s,t);for(let e of n){const t=u.CodeFormatter.line_wrap(e.line,s);i.MapUtils.push_on_array_at_entry(c,s,t)}const r=u.CodeFormatter.post_line_separator(s);i.MapUtils.push_on_array_at_entry(c,s,r)}}})}}add_code_line_for_nodes_and_line_type(e,t,n){var s=(e=e.filter(e=>{if(this._shaders_collection_controller){const n=this._shaders_collection_controller.body_lines(t,e);return n&&n.length>0}})).length;for(let r=0;r<s;r++){const s=r==e.length-1;this.add_code_line_for_node_and_line_type(e[r],t,n,s)}}add_code_line_for_node_and_line_type(e,t,n,s){if(!this._shaders_collection_controller)return;const o=this._shaders_collection_controller.body_lines(t,e);if(o&&o.length>0){const a=this._lines.get(t),_=u.CodeFormatter.node_comment(e,n);if(i.MapUtils.push_on_array_at_entry(a,n,_),r.default(o).forEach(e=>{e=u.CodeFormatter.line_wrap(e,n),i.MapUtils.push_on_array_at_entry(a,n,e)}),n!=d.LineType.BODY||!s){const e=u.CodeFormatter.post_line_separator(n);i.MapUtils.push_on_array_at_entry(a,n,e)}}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),r=n(267),o=n(20),i=n(1),a=n(2),_=n(24),c=n(345),l=n(27),u=n(193);class d{constructor(e,t,n,s){this._type=e,this._name=t,this._default_value=n,this._uniform_name=s}static from_param(e,t){return new d(e.type,e.name,e.default_value,t)}get type(){return this._type}get name(){return this._name}get default_value(){return this._default_value}get uniform_name(){return this._uniform_name}get uniform(){return this._uniform=this._uniform||this._create_uniform()}_create_uniform(){return d.uniform_by_type(this._type)}get param_options(){const e=this._callback.bind(this);switch(this._type){case _.ParamType.OPERATOR_PATH:return{callback:e,node_selection:{context:l.NodeContext.COP}};default:return{callback:e}}}_callback(e,t){this.uniform.value=t.value}static uniform_by_type(e){switch(e){case _.ParamType.BOOLEAN:case _.ParamType.BUTTON:return{value:0};case _.ParamType.COLOR:return{value:new i.Vector3(0,0,0)};case _.ParamType.FLOAT:case _.ParamType.FOLDER:case _.ParamType.INTEGER:case _.ParamType.OPERATOR_PATH:return{value:0};case _.ParamType.RAMP:return{value:null};case _.ParamType.SEPARATOR:return{value:0};case _.ParamType.STRING:return{value:null};case _.ParamType.VECTOR2:return{value:new a.Vector2(0,0)};case _.ParamType.VECTOR3:return{value:new i.Vector3(0,0,0)};case _.ParamType.VECTOR4:return{value:new o.Vector4(0,0,0,0)}}u.TypeAssert.unreachable(e)}set_uniform_value(e){return s.__awaiter(this,void 0,void 0,(function*(){const t=this.uniform,n=e.params.get(this._name);if(n){yield n.compute();const e=n.value;if(null!=e&&this.has_value_changed(e)||this.is_video_texture())switch(this._type){case _.ParamType.OPERATOR_PATH:yield this.set_uniform_value_from_texture(n,t);break;case _.ParamType.RAMP:this.set_uniform_value_from_ramp(n,t);break;default:t.value=n.value}}}))}set_uniform_value_from_texture(e,t){return s.__awaiter(this,void 0,void 0,(function*(){const n=e.found_node();if(n){const e=(yield n.request_container()).texture();t.value=e}else t.value=null}))}set_uniform_value_from_ramp(e,t){t.value=e.ramp_texture()}has_value_changed(e){const t=c.ParamConstructorByType[this._type];if(this._cached_param_value){const n=!t.are_values_equal(e,this._cached_param_value);return n&&(this._cached_param_value=t.clone_value(e)),n}return this._cached_param_value=t.clone_value(e),!1}is_video_texture(){let e=!1;const t=this.uniform;if(t){const n=t.value;n&&(e=n.constructor==r.VideoTexture)}return e}}t.ParamConfig=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(661);t.ShadersCollectionController=class{constructor(e,t){this._shader_names=e,this._current_shader_name=t,this._lines_controller_by_shader_name=new Map;for(let e of this._shader_names)this._lines_controller_by_shader_name.set(e,new s.LinesController(e))}get shader_names(){return this._shader_names}set_current_shader_name(e){this._current_shader_name=e}get current_shader_name(){return this._current_shader_name}add_definitions(e,t,n){if(0==t.length)return;n=n||this._current_shader_name;const s=this._lines_controller_by_shader_name.get(n);s&&s.add_definitions(e,t)}definitions(e,t){const n=this._lines_controller_by_shader_name.get(e);if(n)return n.definitions(t)}add_body_lines(e,t,n){if(0==t.length)return;n=n||this._current_shader_name;const s=this._lines_controller_by_shader_name.get(n);s&&s.add_body_lines(e,t)}body_lines(e,t){const n=this._lines_controller_by_shader_name.get(e);if(n)return n.body_lines(t)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(128);t.LinesController=class{constructor(e){this._shader_name=e,this._definitions_by_node_id=new Map,this._body_lines_by_node_id=new Map}get shader_name(){return this._shader_name}add_definitions(e,t){for(let n of t)s.MapUtils.push_on_array_at_entry(this._definitions_by_node_id,e.graph_node_id,n)}definitions(e){return this._definitions_by_node_id.get(e.graph_node_id)}add_body_lines(e,t){for(let n of t)s.MapUtils.push_on_array_at_entry(this._body_lines_by_node_id,e.graph_node_id,n)}body_lines(e){return this._body_lines_by_node_id.get(e.graph_node_id)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(266),r={[s.LineType.FUNCTION_DECLARATION]:"",[s.LineType.DEFINE]:";",[s.LineType.BODY]:";"},o={[s.LineType.FUNCTION_DECLARATION]:"",[s.LineType.DEFINE]:"",[s.LineType.BODY]:"\t"};t.CodeFormatter=class{static node_comment(e,t){let n=`// ${e.full_path()}`;return t==s.LineType.BODY&&(n=`\t${n}`),n}static line_wrap(e,t){let n=!0;return 0!=e.indexOf("#if")&&0!=e.indexOf("#endif")||(n=!1),n?`${o[t]}${e}${r[t]}`:`${o[t]}${e}`}static post_line_separator(e){return e==s.LineType.BODY?"\t":""}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.TypedAssembler=class{}},function(e,t,n){"use strict";n.r(t),t.default="#include <common>\n\nuniform vec2 resolution;\n\n// INSERT DEFINE\n\nvoid main() {\n\n\tvec4 diffuseColor = vec4(1.0,0.0,1.0,1.0);\n\n\n\t// INSERT BODY\n\n\tgl_FragColor = vec4( diffuseColor );\n}"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.CoreSleep=class{static sleep(e){return new Promise((t,n)=>{setTimeout(()=>{t()},e)})}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),r=n(667),o=n(130),i=n(5),a=n(17),_=n(67);class c extends i.NodeParamsConfig{}const l=new c;class u extends o.TypedCopNode{constructor(){super(...arguments),this.params_config=l}static type(){return"env_map"}initialize_node(){this.io.inputs.set_count(1),this.io.inputs.init_inputs_clonable_state([a.InputCloneMode.NEVER])}cook(e){return s.__awaiter(this,void 0,void 0,(function*(){const t=e[0],n=yield this.convert_texture_to_env_map(t);n?this.set_texture(n):this.cook_controller.end_cook()}))}convert_texture_to_env_map(e){return s.__awaiter(this,void 0,void 0,(function*(){const t=yield _.POLY.renderers_controller.wait_for_renderer();if(t){return new r.PMREMGenerator(t).fromEquirectangular(e).texture}this.states.error.set("no renderer found to convert the texture to an env map")}))}}t.EnvMapCopNode=u},,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),r=n(267),o=n(283),i=n(0),a=n(101),_=n(130),c=n(67);var l;!function(e){e.EXR="exr",e.BASIS="basis",e.HDR="hdr"}(l||(l={}));class u{constructor(e,t){this._node=e,this._param=t}load_texture_from_url_or_op(e){return s.__awaiter(this,void 0,void 0,(function*(){let t,n=null;if("op:"==e.substring(0,3)){const s=e.substring(3);if(t=a.CoreWalker.find_node(this._node,s),t)if(t instanceof _.BaseCopNodeClass){n=(yield t.request_container()).texture()}else this._node.states.error.set("found node is not a texture node");else this._node.states.error.set(`no node found in path '${s}'`)}else n=yield this.load_url(e),n?this._param.options.texture_as_env()||(n=u.set_texture_for_mapping(n)):this._node.states.error.set(`could not load texture ${e}`);return t&&this._param.graph_predecessors()[0]!=t&&(this._param.graph_disconnect_predecessors(),this._param.add_graph_input(t)),n}))}load_url(e){return s.__awaiter(this,void 0,void 0,(function*(){return new Promise((t,n)=>s.__awaiter(this,void 0,void 0,(function*(){const s=u._ext(e);if(u.VIDEO_EXTENSIONS.includes(s)){return yield this._load_as_video(e)}this.loader_for_ext(s).then(s=>{s.load(e,t,void 0,e=>{console.warn("error",e),n()})})})))}))}loader_for_ext(e){return s.__awaiter(this,void 0,void 0,(function*(){switch(e.toLowerCase()){case l.EXR:{const{EXRLoader:e}=yield Promise.resolve().then(()=>s.__importStar(n(669)));return new e}case l.HDR:{const{RGBELoader:e}=yield Promise.resolve().then(()=>s.__importStar(n(670))),t=new e;return t.setDataType(i.UnsignedByteType),t}case l.BASIS:{const{BasisTextureLoader:e}=yield Promise.resolve().then(()=>s.__importStar(n(671))),t=new e;t.setTranscoderPath("/three/js/libs/basis/");const r=yield c.POLY.renderers_controller.wait_for_renderer();return r?t.detectSupport(r):console.warn("texture loader found no renderer for basis texture loader"),t}}return new o.TextureLoader}))}_load_as_video(e){return new Promise((t,n)=>{const s=document.createElement("video");s.setAttribute("crossOrigin","anonymous"),s.setAttribute("autoplay","true"),s.setAttribute("loop","true"),s.onloadedmetadata=function(){s.pause();const e=new r.VideoTexture(s);t(e)};const o=document.createElement("source"),i=u._ext(e);let a=u.VIDEO_SOURCE_TYPE_BY_EXT[i];a=a||u._default_video_source_type(e),o.setAttribute("type",a),o.setAttribute("src",e),s.appendChild(o)})}static _default_video_source_type(e){return`video/${this._ext(e)}`}static pixel_data(e){const t=e.image,n=document.createElement("canvas");n.width=t.width,n.height=t.height;const s=n.getContext("2d");if(s)return s.drawImage(t,0,0,t.width,t.height),s.getImageData(0,0,t.width,t.height)}static _ext(e){const t=e.split(".");return t[t.length-1].toLowerCase()}static set_texture_for_mapping(e){return e}}t.CoreTextureLoader=u,u.PARAM_DEFAULT="/examples/textures/uv.jpg",u.PARAM_ENV_DEFAULT="/examples/textures/piz_compressed.exr",u.VIDEO_EXTENSIONS=["mp4","webm","ogv"],u.VIDEO_SOURCE_TYPE_BY_EXT={ogg:'video/ogg; codecs="theora, vorbis"',ogv:'video/ogg; codecs="theora, vorbis"',mp4:'video/mp4; codecs="avc1.42E01E, mp4a.40.2"'}},,function(e,t,n){"use strict";n.r(t),n.d(t,"RGBELoader",(function(){return o}));var s=n(108),r=n(0),o=function(e){s.a.call(this,e),this.type=r.UnsignedByteType};o.prototype=Object.assign(Object.create(s.a.prototype),{constructor:o,parse:function(e){var t=function(e,t){switch(e){case 1:console.error("RGBELoader Read Error: "+(t||""));break;case 2:console.error("RGBELoader Write Error: "+(t||""));break;case 3:console.error("RGBELoader Bad File Format: "+(t||""));break;default:case 4:console.error("RGBELoader: Error: "+(t||""))}return-1},n=function(e,t,n){t=t||1024;for(var s=e.pos,r=-1,o=0,i="",a=String.fromCharCode.apply(null,new Uint16Array(e.subarray(s,s+128)));0>(r=a.indexOf("\n"))&&o<t&&s<e.byteLength;)i+=a,o+=a.length,s+=128,a+=String.fromCharCode.apply(null,new Uint16Array(e.subarray(s,s+128)));return-1<r&&(!1!==n&&(e.pos+=o+r+1),i+a.slice(0,r))},s=function(){var e=new Float32Array(1),t=new Int32Array(e.buffer);function n(n){e[0]=n;var s=t[0],r=s>>16&32768,o=s>>12&2047,i=s>>23&255;return i<103?r:i>142?(r|=31744,r|=(255==i?0:1)&&8388607&s):i<113?r|=((o|=2048)>>114-i)+(o>>113-i&1):(r|=i-112<<10|o>>1,r+=1&o)}return function(e,t,s,r){var o=e[t+3],i=Math.pow(2,o-128)/255;s[r+0]=n(e[t+0]*i),s[r+1]=n(e[t+1]*i),s[r+2]=n(e[t+2]*i)}}(),o=new Uint8Array(e);o.pos=0;var i,a,_,c,l,u,d=function(e){var s,r,o=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,i=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,a=/^\s*FORMAT=(\S+)\s*$/,_=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,c={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};if(e.pos>=e.byteLength||!(s=n(e)))return t(1,"no header found");if(!(r=s.match(/^#\?(\S+)$/)))return t(3,"bad initial token");for(c.valid|=1,c.programtype=r[1],c.string+=s+"\n";!1!==(s=n(e));)if(c.string+=s+"\n","#"!==s.charAt(0)){if((r=s.match(o))&&(c.gamma=parseFloat(r[1],10)),(r=s.match(i))&&(c.exposure=parseFloat(r[1],10)),(r=s.match(a))&&(c.valid|=2,c.format=r[1]),(r=s.match(_))&&(c.valid|=4,c.height=parseInt(r[1],10),c.width=parseInt(r[2],10)),2&c.valid&&4&c.valid)break}else c.comments+=s+"\n";return 2&c.valid?4&c.valid?c:t(3,"missing image size specifier"):t(3,"missing format specifier")}(o);if(-1!==d){var h=d.width,p=d.height,m=function(e,n,s){var r,o,i,a,_,c,l,u,d,h,p,m,f,g=n,v=s;if(g<8||g>32767||2!==e[0]||2!==e[1]||128&e[2])return new Uint8Array(e);if(g!==(e[2]<<8|e[3]))return t(3,"wrong scanline width");if(!(r=new Uint8Array(4*n*s))||!r.length)return t(4,"unable to allocate buffer space");for(o=0,i=0,u=4*g,f=new Uint8Array(4),c=new Uint8Array(u);v>0&&i<e.byteLength;){if(i+4>e.byteLength)return t(1);if(f[0]=e[i++],f[1]=e[i++],f[2]=e[i++],f[3]=e[i++],2!=f[0]||2!=f[1]||(f[2]<<8|f[3])!=g)return t(3,"bad rgbe scanline format");for(l=0;l<u&&i<e.byteLength;){if((m=(a=e[i++])>128)&&(a-=128),0===a||l+a>u)return t(3,"bad scanline data");if(m)for(_=e[i++],d=0;d<a;d++)c[l++]=_;else c.set(e.subarray(i,i+a),l),l+=a,i+=a}for(h=g,d=0;d<h;d++)p=0,r[o]=c[d+p],p+=g,r[o+1]=c[d+p],p+=g,r[o+2]=c[d+p],p+=g,r[o+3]=c[d+p],o+=4;v--}return r}(o.subarray(o.pos),h,p);if(-1!==m){switch(this.type){case r.UnsignedByteType:var f=m,g=r.RGBEFormat,v=r.UnsignedByteType;break;case r.FloatType:for(var y=m.length/4*3,b=new Float32Array(y),x=0;x<y;x++)_=b,c=3*x,l=void 0,u=void 0,l=(i=m)[(a=4*x)+3],u=Math.pow(2,l-128)/255,_[c+0]=i[a+0]*u,_[c+1]=i[a+1]*u,_[c+2]=i[a+2]*u;f=b,g=r.RGBFormat,v=r.FloatType;break;case r.HalfFloatType:y=m.length/4*3;var T=new Uint16Array(y);for(x=0;x<y;x++)s(m,4*x,T,3*x);f=T,g=r.RGBFormat,v=r.HalfFloatType;break;default:console.error("THREE.RGBELoader: unsupported type: ",this.type)}return{width:h,height:p,data:f,header:d.string,gamma:d.gamma,exposure:d.exposure,format:g,type:v}}}return null},setDataType:function(e){return this.type=e,this},load:function(e,t,n,o){return s.a.prototype.load.call(this,e,(function(e,n){switch(e.type){case r.UnsignedByteType:e.encoding=r.RGBEEncoding,e.minFilter=r.NearestFilter,e.magFilter=r.NearestFilter,e.generateMipmaps=!1,e.flipY=!0;break;case r.FloatType:case r.HalfFloatType:e.encoding=r.LinearEncoding,e.minFilter=r.LinearFilter,e.magFilter=r.LinearFilter,e.generateMipmaps=!1,e.flipY=!0}t&&t(e,n)}),n,o)}})},function(e,t,n){"use strict";n.r(t),n.d(t,"BasisTextureLoader",(function(){return a}));var s=n(121),r=n(30),o=n(0),i=n(18),a=function(e){i.a.call(this,e),this.transcoderPath="",this.transcoderBinary=null,this.transcoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.workerConfig={format:null,astcSupported:!1,bptcSupported:!1,etcSupported:!1,dxtSupported:!1,pvrtcSupported:!1}};a.prototype=Object.assign(Object.create(i.a.prototype),{constructor:a,setTranscoderPath:function(e){return this.transcoderPath=e,this},setWorkerLimit:function(e){return this.workerLimit=e,this},detectSupport:function(e){var t=this.workerConfig;if(t.astcSupported=!!e.extensions.get("WEBGL_compressed_texture_astc"),t.bptcSupported=!!e.extensions.get("EXT_texture_compression_bptc"),t.etcSupported=!!e.extensions.get("WEBGL_compressed_texture_etc1"),t.dxtSupported=!!e.extensions.get("WEBGL_compressed_texture_s3tc"),t.pvrtcSupported=!!e.extensions.get("WEBGL_compressed_texture_pvrtc")||!!e.extensions.get("WEBKIT_WEBGL_compressed_texture_pvrtc"),t.astcSupported)t.format=a.BASIS_FORMAT.cTFASTC_4x4;else if(t.bptcSupported)t.format=a.BASIS_FORMAT.cTFBC7_M5;else if(t.dxtSupported)t.format=a.BASIS_FORMAT.cTFBC3;else if(t.pvrtcSupported)t.format=a.BASIS_FORMAT.cTFPVRTC1_4_RGBA;else{if(!t.etcSupported)throw new Error("THREE.BasisTextureLoader: No suitable compressed texture format found.");t.format=a.BASIS_FORMAT.cTFETC1}return this},load:function(e,t,n,s){var o=new r.a(this.manager);o.setResponseType("arraybuffer"),o.load(e,e=>{this._createTexture(e).then(t).catch(s)},n,s)},_createTexture:function(e){var t,n,r=e.byteLength,i=this._allocateWorker(r).then(s=>(t=s,n=this.workerNextTaskID++,new Promise((s,r)=>{t._callbacks[n]={resolve:s,reject:r},t.postMessage({type:"transcode",id:n,buffer:e},[e])}))).then(e=>{var t,n=this.workerConfig,{width:r,height:i,mipmaps:_,format:c}=e;switch(c){case a.BASIS_FORMAT.cTFASTC_4x4:t=new s.a(_,r,i,o.RGBA_ASTC_4x4_Format);break;case a.BASIS_FORMAT.cTFBC7_M5:t=new s.a(_,r,i,o.RGBA_BPTC_Format);break;case a.BASIS_FORMAT.cTFBC1:case a.BASIS_FORMAT.cTFBC3:t=new s.a(_,r,i,a.DXT_FORMAT_MAP[n.format],o.UnsignedByteType);break;case a.BASIS_FORMAT.cTFETC1:t=new s.a(_,r,i,o.RGB_ETC1_Format);break;case a.BASIS_FORMAT.cTFPVRTC1_4_RGB:t=new s.a(_,r,i,o.RGB_PVRTC_4BPPV1_Format);break;case a.BASIS_FORMAT.cTFPVRTC1_4_RGBA:t=new s.a(_,r,i,o.RGBA_PVRTC_4BPPV1_Format);break;default:throw new Error("THREE.BasisTextureLoader: No supported format available.")}return t.minFilter=1===_.length?o.LinearFilter:o.LinearMipmapLinearFilter,t.magFilter=o.LinearFilter,t.generateMipmaps=!1,t.needsUpdate=!0,t});return i.finally(()=>{t&&n&&(t._taskLoad-=r,delete t._callbacks[n])}),i},_initTranscoder:function(){if(!this.transcoderPending){var e=new r.a(this.manager);e.setPath(this.transcoderPath);var t=new Promise((t,n)=>{e.load("basis_transcoder.js",t,void 0,n)}),n=new r.a(this.manager);n.setPath(this.transcoderPath),n.setResponseType("arraybuffer");var s=new Promise((e,t)=>{n.load("basis_transcoder.wasm",e,void 0,t)});this.transcoderPending=Promise.all([t,s]).then(([e,t])=>{var n=a.BasisWorker.toString(),s=["/* basis_transcoder.js */",e,"/* worker */",n.substring(n.indexOf("{")+1,n.lastIndexOf("}"))].join("\n");this.workerSourceURL=URL.createObjectURL(new Blob([s])),this.transcoderBinary=t})}return this.transcoderPending},_allocateWorker:function(e){return this._initTranscoder().then(()=>{var t;this.workerPool.length<this.workerLimit?((t=new Worker(this.workerSourceURL))._callbacks={},t._taskLoad=0,t.postMessage({type:"init",config:this.workerConfig,transcoderBinary:this.transcoderBinary}),t.onmessage=function(e){var n=e.data;switch(n.type){case"transcode":t._callbacks[n.id].resolve(n);break;case"error":t._callbacks[n.id].reject(n);break;default:console.error('THREE.BasisTextureLoader: Unexpected message, "'+n.type+'"')}},this.workerPool.push(t)):this.workerPool.sort((function(e,t){return e._taskLoad>t._taskLoad?-1:1}));return(t=this.workerPool[this.workerPool.length-1])._taskLoad+=e,t})},dispose:function(){for(var e=0;e<this.workerPool.length;e++)this.workerPool[e].terminate();return this.workerPool.length=0,this}}),a.BASIS_FORMAT={cTFETC1:0,cTFETC2:1,cTFBC1:2,cTFBC3:3,cTFBC4:4,cTFBC5:5,cTFBC7_M6_OPAQUE_ONLY:6,cTFBC7_M5:7,cTFPVRTC1_4_RGB:8,cTFPVRTC1_4_RGBA:9,cTFASTC_4x4:10,cTFATC_RGB:11,cTFATC_RGBA_INTERPOLATED_ALPHA:12,cTFRGBA32:13,cTFRGB565:14,cTFBGR565:15,cTFRGBA4444:16},a.DXT_FORMAT={COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_EXT:33778,COMPRESSED_RGBA_S3TC_DXT5_EXT:33779},a.DXT_FORMAT_MAP={},a.DXT_FORMAT_MAP[a.BASIS_FORMAT.cTFBC1]=a.DXT_FORMAT.COMPRESSED_RGB_S3TC_DXT1_EXT,a.DXT_FORMAT_MAP[a.BASIS_FORMAT.cTFBC3]=a.DXT_FORMAT.COMPRESSED_RGBA_S3TC_DXT5_EXT,a.BasisWorker=function(){var e,t,n;onmessage=function(s){var r,o,i=s.data;switch(i.type){case"init":e=i.config,r=i.transcoderBinary,t=new Promise(e=>{o={wasmBinary:r,onRuntimeInitialized:e},BASIS(o)}).then(()=>{var{BasisFile:e,initializeBasis:t}=o;n=e,t()});break;case"transcode":t.then(()=>{try{for(var{width:t,height:s,hasAlpha:r,mipmaps:o,format:a}=function(t){var s=new n(new Uint8Array(t)),r=s.getImageWidth(0,0),o=s.getImageHeight(0,0),i=s.getNumLevels(0),a=s.getHasAlpha();function _(){s.close(),s.delete()}if(!a)switch(e.format){case 9:e.format=8}if(!r||!o||!i)throw _(),new Error("THREE.BasisTextureLoader:  Invalid .basis file");if(!s.startTranscoding())throw _(),new Error("THREE.BasisTextureLoader: .startTranscoding failed");for(var c=[],l=0;l<i;l++){var u=s.getImageWidth(0,l),d=s.getImageHeight(0,l),h=new Uint8Array(s.getImageTranscodedSizeInBytes(0,l,e.format));if(!s.transcodeImage(h,0,l,e.format,0,a))throw _(),new Error("THREE.BasisTextureLoader: .transcodeImage failed.");c.push({data:h,width:u,height:d})}return _(),{width:r,height:o,hasAlpha:a,mipmaps:c,format:e.format}}(i.buffer),_=[],c=0;c<o.length;++c)_.push(o[c].data.buffer);self.postMessage({type:"transcode",id:i.id,width:t,height:s,hasAlpha:r,mipmaps:o,format:a},_)}catch(e){console.error(e),self.postMessage({type:"error",id:i.id,error:e.message})}})}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),r=n(130),o=n(5),i=n(17),a=new o.NodeParamsConfig;class _ extends r.TypedCopNode{constructor(){super(...arguments),this.params_config=a}static type(){return"null"}initialize_node(){this.io.inputs.set_count(1),this.io.inputs.init_inputs_clonable_state([i.InputCloneMode.NEVER])}cook(e){return s.__awaiter(this,void 0,void 0,(function*(){const t=e[0];this.set_texture(t)}))}}t.NullCopNode=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),r=n(130),o=n(5),i=n(17);class a extends o.NodeParamsConfig{constructor(){super(...arguments),this.input=o.ParamConfig.INTEGER(0,{range:[0,3],range_locked:[!0,!0]})}}const _=new a;class c extends r.TypedCopNode{constructor(){super(...arguments),this.params_config=_}static type(){return"switch"}initialize_node(){this.io.inputs.set_count(0,4),this.io.inputs.init_inputs_clonable_state([i.InputCloneMode.NEVER,i.InputCloneMode.NEVER,i.InputCloneMode.NEVER,i.InputCloneMode.NEVER]),this.ui_data.set_width(100),this.cook_controller.disallow_inputs_evaluation()}cook(){return s.__awaiter(this,void 0,void 0,(function*(){const e=this.pv.input;if(this.io.inputs.has_input(e)){const t=yield this.container_controller.request_input_container(e);this.set_texture(t.texture())}else this.states.error.set(`no input ${e}`)}))}}t.SwitchCopNode=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(129),r=n(675),o=n(269),i=n(356),a=n(334);t.EventRegister=class{static run(e){e.register_node(r.CameraMapControlsEventNode,s.CATEGORY_EVENT.CAMERA),e.register_node(o.CameraOrbitControlsEventNode,s.CATEGORY_EVENT.CAMERA),e.register_node(i.CodeEventNode,s.CATEGORY_EVENT.MISC),e.register_node(a.MouseEventNode,s.CATEGORY_EVENT.MISC)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),r=n(366),o=n(269);class i extends o.CameraOrbitControlsEventNode{static type(){return"camera_map_controls"}create_controls_instance(e,t){return s.__awaiter(this,void 0,void 0,(function*(){return new r.MapControls(e,t)}))}}t.CameraMapControlsEventNode=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),r=n(186);class o extends r.TypedEventNode{apply_controls(e,t){return s.__awaiter(this,void 0,void 0,(function*(){const n=yield this.create_controls_instance(e,t),s=performance.now();return n.name=`${this.full_path()}:${e.name}:${s}:${this.controls_id()}`,yield this.params.eval_all(),this.setup_controls(n),n}))}controls_id(){return JSON.stringify(this.params.all.map(e=>e.value_serialized))}}t.TypedCameraControlsEventNode=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(129),r=n(678),o=n(679),i=n(680),a=n(681),_=n(368),c=n(682),l=n(683),u=n(685),d=n(263),h=n(369),p=n(686),m=n(688),f=n(689),g=n(691),v=n(693),y=n(725),b=n(726),x=n(365),T=n(727),C=n(729),P=n(730),w=n(731),E=n(732),O=n(733),A=n(734),N=n(735),M=n(743),S=n(744),R=n(745),j=n(746),L=n(747),k=n(748),G=n(749),z=n(750),I=n(751),D=n(752),F=n(753),B=n(755),V=n(756),U=n(757),q=n(758),$=n(759),Y=n(760),H=n(27);t.GlRegister=class{static run(e){e.register_node(a.AbsGlNode,s.CATEGORY_GL.MATH),e.register_node(a.AcosGlNode,s.CATEGORY_GL.TRIGO),e.register_node(c.AddGlNode,s.CATEGORY_GL.MATH),e.register_node(u.AlignGlNode,s.CATEGORY_GL.TRIGO),e.register_node(l.AndGlNode,s.CATEGORY_GL.LOGIC),e.register_node(a.AsinGlNode,s.CATEGORY_GL.TRIGO),e.register_node(a.AtanGlNode,s.CATEGORY_GL.TRIGO),e.register_node(d.AttributeGlNode,s.CATEGORY_GL.GLOBALS,{except:[`${H.NodeContext.COP}/builder`]}),e.register_node(a.CeilGlNode,s.CATEGORY_GL.MATH),e.register_node(a.CosGlNode,s.CATEGORY_GL.TRIGO),e.register_node(h.ConstantGlNode,s.CATEGORY_GL.GLOBALS),e.register_node(p.ComplementGlNode,s.CATEGORY_GL.MATH),e.register_node(m.CrossGlNode,s.CATEGORY_GL.GEOMETRY),e.register_node(f.CycleGlNode,s.CATEGORY_GL.MATH),e.register_node(a.DegreesGlNode,s.CATEGORY_GL.CONVERSION),e.register_node(g.DiskGlNode,s.CATEGORY_GL.GEOMETRY),e.register_node(_.DistanceGlNode,s.CATEGORY_GL.GEOMETRY),e.register_node(c.DivideGlNode,s.CATEGORY_GL.MATH),e.register_node(_.DotGlNode,s.CATEGORY_GL.GEOMETRY),e.register_node(v.EasingGlNode,s.CATEGORY_GL.MATH),e.register_node(a.ExpGlNode,s.CATEGORY_GL.MATH),e.register_node(a.Exp2GlNode,s.CATEGORY_GL.MATH),e.register_node(y.FitGlNode,s.CATEGORY_GL.MATH),e.register_node(b.Fit01GlNode,s.CATEGORY_GL.MATH),e.register_node(r.FloatToIntGlNode,s.CATEGORY_GL.CONVERSION),e.register_node(o.FloatToVec2GlNode,s.CATEGORY_GL.CONVERSION),e.register_node(o.FloatToVec3GlNode,s.CATEGORY_GL.CONVERSION),e.register_node(o.FloatToVec4GlNode,s.CATEGORY_GL.CONVERSION),e.register_node(a.FloorGlNode,s.CATEGORY_GL.MATH),e.register_node(a.FractGlNode,s.CATEGORY_GL.MATH),e.register_node(x.GlobalsGlNode,s.CATEGORY_GL.GLOBALS),e.register_node(T.HsvToRgbGlNode,s.CATEGORY_GL.COLOR),e.register_node(r.IntToFloatGlNode,s.CATEGORY_GL.CONVERSION),e.register_node(a.InverseSqrtGlNode,s.CATEGORY_GL.MATH),e.register_node(C.InstanceTransformGlNode,s.CATEGORY_GL.GEOMETRY),e.register_node(P.LengthGlNode,s.CATEGORY_GL.GEOMETRY),e.register_node(w.LuminanceGlNode,s.CATEGORY_GL.COLOR),e.register_node(A.NegateGlNode,s.CATEGORY_GL.MATH),e.register_node(a.LogGlNode,s.CATEGORY_GL.MATH),e.register_node(a.Log2GlNode,s.CATEGORY_GL.MATH),e.register_node(_.MaxGlNode,s.CATEGORY_GL.MATH),e.register_node(_.MinGlNode,s.CATEGORY_GL.MATH),e.register_node(_.ModGlNode,s.CATEGORY_GL.MATH),e.register_node(E.MixGlNode,s.CATEGORY_GL.MATH),e.register_node(c.MultGlNode,s.CATEGORY_GL.MATH),e.register_node(O.MultAddGlNode,s.CATEGORY_GL.MATH),e.register_node(M.NullGlNode,s.CATEGORY_GL.UTIL),e.register_node(N.NoiseGlNode,s.CATEGORY_GL.GEOMETRY),e.register_node(a.NormalizeGlNode,s.CATEGORY_GL.MATH),e.register_node(l.OrGlNode,s.CATEGORY_GL.LOGIC),e.register_node(S.OutputGlNode,s.CATEGORY_GL.GLOBALS),e.register_node(R.ParamGlNode,s.CATEGORY_GL.GLOBALS),e.register_node(_.PowGlNode,s.CATEGORY_GL.MATH),e.register_node(L.QuatMultGlNode,s.CATEGORY_GL.QUAT),e.register_node(k.QuatFromAxisAngleGlNode,s.CATEGORY_GL.QUAT),e.register_node(G.QuatToAngleGlNode,s.CATEGORY_GL.QUAT),e.register_node(z.QuatToAxisGlNode,s.CATEGORY_GL.QUAT),e.register_node(I.RampGlNode,s.CATEGORY_GL.GLOBALS),e.register_node(D.RandomGlNode,s.CATEGORY_GL.GLOBALS),e.register_node(a.RadiansGlNode,s.CATEGORY_GL.CONVERSION),e.register_node(_.ReflectGlNode,s.CATEGORY_GL.GEOMETRY),e.register_node(j.RefractGlNode,s.CATEGORY_GL.GEOMETRY),e.register_node(F.RgbToHsvGlNode,s.CATEGORY_GL.COLOR),e.register_node(B.RotateGlNode,s.CATEGORY_GL.GEOMETRY),e.register_node(V.RoundGlNode,s.CATEGORY_GL.MATH),e.register_node(a.SignGlNode,s.CATEGORY_GL.MATH),e.register_node(a.SinGlNode,s.CATEGORY_GL.TRIGO),e.register_node(a.SqrtGlNode,s.CATEGORY_GL.MATH),e.register_node(_.StepGlNode,s.CATEGORY_GL.GEOMETRY),e.register_node(c.SubstractGlNode,s.CATEGORY_GL.MATH),e.register_node(a.TanGlNode,s.CATEGORY_GL.TRIGO),e.register_node(U.TextureGlNode,s.CATEGORY_GL.COLOR),e.register_node(q.TwoWaySwitchGlNode,s.CATEGORY_GL.TRIGO),e.register_node(i.Vec2ToFloatGlNode,s.CATEGORY_GL.CONVERSION),e.register_node(i.Vec3ToFloatGlNode,s.CATEGORY_GL.CONVERSION),e.register_node(i.Vec4ToFloatGlNode,s.CATEGORY_GL.CONVERSION),e.register_node(i.Vec4ToVectorGlNode,s.CATEGORY_GL.CONVERSION),e.register_node($.VectorAlignGlNode,s.CATEGORY_GL.GEOMETRY),e.register_node(Y.VectorAngleGlNode,s.CATEGORY_GL.GEOMETRY)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(34),r=n(28),o=n(33),i=n(16),a=n(5);class _ extends a.NodeParamsConfig{constructor(){super(...arguments),this.float=a.ParamConfig.FLOAT(0)}}const c=new _;class l extends s.TypedGlNode{constructor(){super(...arguments),this.params_config=c}static type(){return"float_to_int"}initialize_node(){this.io.outputs.set_named_output_connection_points([new o.TypedNamedConnectionPoint("int",i.ConnectionPointType.INT)])}set_lines(e){const t=this.variable_for_input("float"),n=`int ${this.gl_var_name("int")} = int(${r.ThreeToGl.float(t)})`;e.add_body_lines(this,[n])}}t.FloatToIntGlNode=l;class u extends a.NodeParamsConfig{constructor(){super(...arguments),this.int=a.ParamConfig.INTEGER(0)}}const d=new u;class h extends s.TypedGlNode{constructor(){super(...arguments),this.params_config=d}static type(){return"int_to_float"}initialize_node(){this.io.outputs.set_named_output_connection_points([new o.TypedNamedConnectionPoint("float",i.ConnectionPointType.FLOAT)])}set_lines(e){const t=this.variable_for_input("int"),n=`float ${this.gl_var_name("float")} = float(${r.ThreeToGl.int(t)})`;e.add_body_lines(this,[n])}}t.IntToFloatGlNode=h},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(34),r=n(28),o=n(33),i=n(16),a=n(5);class _ extends a.NodeParamsConfig{constructor(){super(...arguments),this.x=a.ParamConfig.FLOAT(0),this.y=a.ParamConfig.FLOAT(0)}}const c=new _;class l extends s.TypedGlNode{constructor(){super(...arguments),this.params_config=c}static type(){return"float_to_vec2"}initialize_node(){this.io.outputs.set_named_output_connection_points([new o.TypedNamedConnectionPoint(l.OUTPUT_NAME,i.ConnectionPointType.VEC2)])}set_lines(e){const t=this.variable_for_input("x"),n=this.variable_for_input("y"),s=`vec2 ${this.gl_var_name(l.OUTPUT_NAME)} = ${r.ThreeToGl.float2(t,n)}`;e.add_body_lines(this,[s])}}t.FloatToVec2GlNode=l,l.OUTPUT_NAME="vec2";class u extends a.NodeParamsConfig{constructor(){super(...arguments),this.x=a.ParamConfig.FLOAT(0),this.y=a.ParamConfig.FLOAT(0),this.z=a.ParamConfig.FLOAT(0)}}const d=new u;class h extends s.TypedGlNode{constructor(){super(...arguments),this.params_config=d}static type(){return"float_to_vec3"}initialize_node(){this.io.outputs.set_named_output_connection_points([new o.TypedNamedConnectionPoint(h.OUTPUT_NAME,i.ConnectionPointType.VEC3)])}set_lines(e){const t=this.variable_for_input("x"),n=this.variable_for_input("y"),s=this.variable_for_input("z"),o=`vec3 ${this.gl_var_name(h.OUTPUT_NAME)} = ${r.ThreeToGl.float3(t,n,s)}`;e.add_body_lines(this,[o])}}t.FloatToVec3GlNode=h,h.OUTPUT_NAME="vec3";class p extends a.NodeParamsConfig{constructor(){super(...arguments),this.x=a.ParamConfig.FLOAT(0),this.y=a.ParamConfig.FLOAT(0),this.z=a.ParamConfig.FLOAT(0),this.w=a.ParamConfig.FLOAT(0)}}const m=new p;class f extends s.TypedGlNode{constructor(){super(...arguments),this.params_config=m}static type(){return"float_to_vec4"}initialize_node(){this.io.outputs.set_named_output_connection_points([new o.TypedNamedConnectionPoint(f.OUTPUT_NAME,i.ConnectionPointType.VEC4)])}set_lines(e){const t=this.variable_for_input("x"),n=this.variable_for_input("y"),s=this.variable_for_input("z"),o=this.variable_for_input("w"),i=`vec4 ${this.gl_var_name(f.OUTPUT_NAME)} = ${r.ThreeToGl.float4(t,n,s,o)}`;e.add_body_lines(this,[i])}}t.FloatToVec4GlNode=f,f.OUTPUT_NAME="vec4"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(34),r=n(24),o=n(5),i=n(16),a=n(33);class _ extends o.NodeParamsConfig{}const c=new _;class l extends s.TypedGlNode{constructor(){super(...arguments),this.params_config=c}}function u(e,t){const n=t.components,s=t.param_type;return class extends l{static type(){return e}initialize_node(){this.io.outputs.set_named_output_connection_points(n.map(e=>new a.TypedNamedConnectionPoint(e,i.ConnectionPointType.FLOAT)))}create_params(){this.add_param(s,"vec",n.map(e=>0))}set_lines(e){const t=[],n=this.variable_for_input("vec");this.io.outputs.used_output_names().forEach(e=>{const s=this.gl_var_name(e);t.push(`float ${s} = ${n}.${e}`)}),e.add_body_lines(this,t)}}}const d=["x","y","z","w"];class h extends(u("vec2_to_float",{components:["x","y"],param_type:r.ParamType.VECTOR2})){}t.Vec2ToFloatGlNode=h;class p extends(u("vec3_to_float",{components:["x","y","z"],param_type:r.ParamType.VECTOR3})){}t.Vec3ToFloatGlNode=p;class m extends(u("vec4_to_float",{components:d,param_type:r.ParamType.VECTOR4})){}t.Vec4ToFloatGlNode=m;class f extends l{static type(){return"vec4_to_vector"}initialize_node(){this.io.outputs.set_named_output_connection_points([new a.TypedNamedConnectionPoint(f.OUTPUT_NAME_VEC3,i.ConnectionPointType.VEC3),new a.TypedNamedConnectionPoint(f.OUTPUT_NAME_W,i.ConnectionPointType.FLOAT)])}create_params(){this.add_param(r.ParamType.VECTOR4,f.INPUT_NAME_VEC4,d.map(e=>0))}set_lines(e){const t=[],n=f.INPUT_NAME_VEC4,s=f.OUTPUT_NAME_VEC3,r=f.OUTPUT_NAME_W,o=this.variable_for_input(n),i=this.io.outputs.used_output_names();if(i.indexOf(s)>=0){const e=this.gl_var_name(s);t.push(`vec3 ${e} = ${o}.xyz`)}if(i.indexOf(r)>=0){const e=this.gl_var_name(r);t.push(`float ${e} = ${o}.w`)}e.add_body_lines(this,t)}}t.Vec4ToVectorGlNode=f,f.INPUT_NAME_VEC4="vec4",f.OUTPUT_NAME_VEC3="vec3",f.OUTPUT_NAME_W="w"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(36);function r(e,t={}){const n=t.method||e,r=t.out||"val",o=t.in||"in";return class extends s.BaseNodeGlMathFunctionArg1GlNode{static type(){return e}initialize_node(){super.initialize_node(),this.gl_connections_controller.set_input_name_function(this._gl_input_name.bind(this)),this.gl_connections_controller.set_output_name_function(this._gl_output_name.bind(this))}_gl_input_name(e){return o}_gl_output_name(e){return r}gl_method_name(){return n}}}class o extends(r("abs")){}t.AbsGlNode=o;class i extends(r("acos",{out:"radians"})){}t.AcosGlNode=i;class a extends(r("asin",{out:"radians"})){}t.AsinGlNode=a;class _ extends(r("atan",{out:"radians"})){}t.AtanGlNode=_;class c extends(r("ceil")){}t.CeilGlNode=c;class l extends(r("cos",{in:"radians"})){}t.CosGlNode=l;class u extends(r("degrees",{in:"radians",out:"degrees"})){}t.DegreesGlNode=u;class d extends(r("exp")){}t.ExpGlNode=d;class h extends(r("exp2")){}t.Exp2GlNode=h;class p extends(r("floor")){}t.FloorGlNode=p;class m extends(r("fract")){}t.FractGlNode=m;class f extends(r("inverse_sqrt",{method:"inversesqrt"})){}t.InverseSqrtGlNode=f;class g extends(r("log")){}t.LogGlNode=g;class v extends(r("log2")){}t.Log2GlNode=v;class y extends(r("normalize",{out:"normalized"})){}t.NormalizeGlNode=y;class b extends(r("radians",{in:"degrees",out:"radians"})){}t.RadiansGlNode=b;class x extends(r("sign")){}t.SignGlNode=x;class T extends(r("sin",{in:"radians"})){}t.SinGlNode=T;class C extends(r("sqrt")){}t.SqrtGlNode=C;class P extends(r("tan")){}t.TanGlNode=P},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(36),r=n(16),o=n(28);function i(e,t){const n=t.in_prefix||e,i=t.out||"val",a=t.operation,_=t.allowed_in_types;return class extends s.BaseNodeGlMathFunctionArg2GlNode{static type(){return e}initialize_node(){super.initialize_node(),this.gl_connections_controller.set_input_name_function(this._gl_input_name.bind(this)),this.gl_connections_controller.set_output_name_function(this._gl_output_name.bind(this)),this.gl_connections_controller.set_expected_input_types_function(this._expected_input_types.bind(this)),this.gl_connections_controller.set_expected_output_types_function(this._expected_output_types.bind(this))}set_lines(e){const t=this.io.outputs.named_output_connection_points[0].type,n=this.io.inputs.named_input_connection_points.map((e,t)=>{const n=e.name,s=this.variable_for_input(n);if(s)return o.ThreeToGl.any(s)}).join(` ${this.gl_operation()} `),s=`${t} ${this.gl_var_name(this.gl_connections_controller.output_name(0))} = ${this.gl_method_name()}(${n})`;e.add_body_lines(this,[s])}_gl_input_name(e){return`${n}${e}`}_gl_output_name(e){return i}gl_operation(){return a}_expected_input_types(){let e=this.gl_connections_controller.first_input_connection_type();if(e&&_&&!_.includes(e)){const t=this.io.inputs.named_input_connection_points[0];t&&(e=t.type)}const t=e||r.ConnectionPointType.FLOAT,n=this.io.connections.input_connections(),s=n?Math.max(n.length+1,2):2,o=[];for(let e=0;e<s;e++)o.push(t);return o}_expected_output_types(){return[this._expected_input_types()[0]]}}}class a extends(i("add",{in_prefix:"add",out:"sum",operation:"+"})){}t.AddGlNode=a;class _ extends(i("divide",{in_prefix:"div",out:"divide",operation:"/"})){}t.DivideGlNode=_;class c extends(i("substract",{in_prefix:"sub",out:"substract",operation:"-"})){}t.SubstractGlNode=c;class l extends(i("mult",{in_prefix:"mult",out:"product",operation:"*"})){static type(){return"mult"}gl_input_default_value(e){return 1}initialize_node(){super.initialize_node(),this.gl_connections_controller.set_expected_input_types_function(this._expected_input_types.bind(this)),this.gl_connections_controller.set_expected_output_types_function(this._expected_output_types.bind(this))}_expected_output_type(){const e=this._expected_input_types();return[e[e.length-1]]}_expected_input_types(){const e=this.io.connections.input_connections();if(e){const t=e[0];if(t){const n=this.io.inputs.named_input_connection_points[t.input_index].type,s=e?e.length+1:2,o=new Array(s);if(n==r.ConnectionPointType.FLOAT){const t=e?e[1]:null;if(t){const e=this.io.inputs.named_input_connection_points[t.input_index].type;return e==r.ConnectionPointType.FLOAT?o.map(e=>n):[n,e]}return[n,n]}return o.map(()=>n)}}return[r.ConnectionPointType.FLOAT,r.ConnectionPointType.FLOAT]}}t.MultGlNode=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(684);function r(e,t){return class extends s.BaseNodeGlMathFunctionArgBoolean2GlNode{static type(){return e}initialize_node(){super.initialize_node(),this.gl_connections_controller.set_input_name_function(this._gl_input_name.bind(this)),this.gl_connections_controller.set_output_name_function(this._gl_output_name.bind(this))}boolean_operation(){return t.op}_gl_output_name(t){return e}_gl_input_name(t=0){return`${e}${t}`}}}class o extends(r("and",{op:"&&"})){}t.AndGlNode=o;class i extends(r("or",{op:"||"})){}t.OrGlNode=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(36),r=n(28),o=n(16);class i extends s.BaseNodeGlMathFunctionArg2GlNode{initialize_node(){super.initialize_node(),this.gl_connections_controller.set_expected_input_types_function(this._expected_input_types.bind(this)),this.gl_connections_controller.set_expected_output_types_function(this._expected_output_types.bind(this))}_expected_input_types(){return[o.ConnectionPointType.BOOL,o.ConnectionPointType.BOOL]}_expected_output_types(){return[o.ConnectionPointType.BOOL]}set_lines(e){const t=this.io.inputs.named_input_connection_points.map((e,t)=>{const n=e.name;return r.ThreeToGl.any(this.variable_for_input(n))}).join(` ${this.boolean_operation()} `),n=`bool ${this.gl_var_name(this.gl_connections_controller.output_name(0))} = ${t}`;e.add_body_lines(this,[n])}}t.BaseNodeGlMathFunctionArgBoolean2GlNode=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),r=n(36),o=s.__importDefault(n(95)),i=n(16),a=n(29);var _;!function(e){e.DIR="dir",e.UP="up"}(_||(_={}));const c=[_.DIR,_.UP],l={[_.DIR]:[0,0,1],[_.UP]:[0,1,0]};class u extends r.BaseNodeGlMathFunctionArg2GlNode{static type(){return"align"}initialize_node(){super.initialize_node(),this.gl_connections_controller.set_input_name_function(e=>c[e]),this.gl_connections_controller.set_expected_input_types_function(()=>[i.ConnectionPointType.VEC3,i.ConnectionPointType.VEC3]),this.gl_connections_controller.set_expected_output_types_function(()=>[i.ConnectionPointType.VEC4])}gl_input_default_value(e){return l[e]}gl_method_name(){return"align"}gl_function_definitions(){return[new a.FunctionGLDefinition(this,i.ConnectionPointType.VEC4,o.default)]}}t.AlignGlNode=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),r=n(36),o=s.__importDefault(n(687)),i=n(29),a=n(16);class _ extends r.BaseNodeGlMathFunctionArg1GlNode{static type(){return"complement"}gl_method_name(){return"complement"}gl_function_definitions(){return[new i.FunctionGLDefinition(this,this.gl_connections_controller.first_input_connection_type()||a.ConnectionPointType.FLOAT,o.default)]}}t.ComplementGlNode=_},function(e,t,n){"use strict";n.r(t),t.default="float complement(float x){return 1.0-x;}\nvec2 complement(vec2 x){return vec2(1.0-x.x, 1.0-x.y);}\nvec3 complement(vec3 x){return vec3(1.0-x.x, 1.0-x.y, 1.0-x.z);}\nvec4 complement(vec4 x){return vec4(1.0-x.x, 1.0-x.y, 1.0-x.z, 1.0-x.w);}\n"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(34),r=n(28),o=n(5),i=n(33),a=n(16);class _ extends o.NodeParamsConfig{constructor(){super(...arguments),this.x=o.ParamConfig.VECTOR3([0,0,1]),this.y=o.ParamConfig.VECTOR3([0,1,0])}}const c=new _;class l extends s.TypedGlNode{constructor(){super(...arguments),this.params_config=c}static type(){return"cross"}initialize_node(){super.initialize_node(),this.io.outputs.set_named_output_connection_points([new i.TypedNamedConnectionPoint("cross",a.ConnectionPointType.VEC3)])}set_lines(e){const t=r.ThreeToGl.float(this.variable_for_input("x")),n=r.ThreeToGl.float(this.variable_for_input("y")),s=`vec3 ${this.gl_var_name("cross")} = cross(${t}, ${n})`;e.add_body_lines(this,[s])}}t.CrossGlNode=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3).__importDefault(n(690)),r=n(370);class o extends(r.MathFunctionArg3Factory("cycle",{in:["in","min","max"],default:{max:1},functions:[s.default]})){}t.CycleGlNode=o},function(e,t,n){"use strict";n.r(t),t.default="float cycle(float val, float val_min, float val_max){\n\tif(val >= val_min && val < val_max){\n\t\treturn val;\n\t} else {\n\t\tfloat range = val_max - val_min;\n\t\tif(val >= val_max){\n\t\t\tfloat delta = (val - val_max);\n\t\t\treturn val_min + mod(delta, range);\n\t\t} else {\n\t\t\tfloat delta = (val_min - val);\n\t\t\treturn val_max - mod(delta, range);\n\t\t}\n\t}\n}"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),r=n(34),o=n(28),i=s.__importDefault(n(692)),a=n(5),_=n(16),c=n(29),l=n(33);class u extends a.NodeParamsConfig{constructor(){super(...arguments),this.position=a.ParamConfig.VECTOR2([0,0]),this.center=a.ParamConfig.VECTOR2([0,0]),this.radius=a.ParamConfig.FLOAT(1),this.feather=a.ParamConfig.FLOAT(.1)}}const d=new u;class h extends r.TypedGlNode{constructor(){super(...arguments),this.params_config=d}static type(){return"disk"}initialize_node(){super.initialize_node(),this.io.outputs.set_named_output_connection_points([new l.TypedNamedConnectionPoint("float",_.ConnectionPointType.FLOAT)])}set_lines(e){const t=o.ThreeToGl.vector2(this.variable_for_input("position")),n=o.ThreeToGl.vector2(this.variable_for_input("center")),s=o.ThreeToGl.float(this.variable_for_input("radius")),r=o.ThreeToGl.float(this.variable_for_input("feather")),a=`float ${this.gl_var_name("float")} = disk(${t}, ${n}, ${s}, ${r})`;e.add_body_lines(this,[a]),e.add_definitions(this,[new c.FunctionGLDefinition(this,_.ConnectionPointType.FLOAT,i.default)])}}t.DiskGlNode=h},function(e,t,n){"use strict";n.r(t),t.default="float disk(vec2 pos, vec2 center, float radius, float feather){\n\tfloat dist = distance(pos, center);\n\tif(feather <= 0.0){\n\t\tif(dist < radius){return 1.0;}else{return 0.0;}\n\t} else {\n\t\tfloat half_feather = feather * 0.5;\n\t\tif(dist < (radius - half_feather)){\n\t\t\treturn 1.0;\n\t\t} else {\n\t\t\tif(dist > (radius + half_feather)){\n\t\t\t\treturn 0.0;\n\t\t\t} else {\n\t\t\t\tfloat feather_start = (radius - half_feather);\n\t\t\t\tfloat blend = 1.0 - (dist - feather_start) / feather;\n\t\t\t\treturn blend;\n\t\t\t}\n\t\t}\n\t}\n}"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),r=n(34),o=n(28),i=s.__importDefault(n(694)),a=s.__importDefault(n(695)),_=s.__importDefault(n(696)),c=s.__importDefault(n(697)),l=s.__importDefault(n(698)),u=s.__importDefault(n(699)),d=s.__importDefault(n(700)),h=s.__importDefault(n(701)),p=s.__importDefault(n(702)),m=s.__importDefault(n(703)),f=s.__importDefault(n(704)),g=s.__importDefault(n(705)),v=s.__importDefault(n(706)),y=s.__importDefault(n(707)),b=s.__importDefault(n(708)),x=s.__importDefault(n(709)),T=s.__importDefault(n(710)),C=s.__importDefault(n(711)),P=s.__importDefault(n(712)),w=s.__importDefault(n(713)),E=s.__importDefault(n(714)),O=s.__importDefault(n(715)),A=s.__importDefault(n(716)),N=s.__importDefault(n(717)),M=s.__importDefault(n(718)),S=s.__importDefault(n(719)),R=s.__importDefault(n(720)),j=s.__importDefault(n(721)),L=s.__importDefault(n(722)),k=s.__importDefault(n(723)),G=s.__importDefault(n(724)),z=n(5),I=n(16),D=n(33),F=n(29),B=["back-in-out","back-in","back-out","bounce-in-out","bounce-in","bounce-out","circular-in-out","circular-in","circular-out","cubic-in-out","cubic-in","cubic-out","elastic-in-out","elastic-in","elastic-out","exponential-in-out","exponential-in","exponential-out","linear","quadratic-in-out","quadratic-in","quadratic-out","sine-in-out","sine-in","sine-out"],V={"circular-in-out":i.default,"exponential-in-out":a.default,"circular-in":_.default,"elastic-out":c.default,"cubic-in":l.default,"exponential-out":u.default,"quintic-out":d.default,"elastic-in-out":h.default,linear:p.default,"circular-out":m.default,"back-in-out":f.default,"back-in":g.default,"sine-in":v.default,"back-out":y.default,"quartic-in-out":b.default,"quadratic-in":x.default,"cubic-in-out":T.default,"elastic-in":C.default,"bounce-out":P.default,"quadratic-in-out":w.default,"exponential-in":E.default,"quintic-in-out":O.default,"sine-in-out":A.default,"cubic-out":N.default,"quadratic-out":M.default,"bounce-in-out":S.default,"quintic-in":R.default,"quartic-in":j.default,"quartic-out":L.default,"bounce-in":k.default,"sine-out":G.default},U={"bounce-in":[P.default],"bounce-in-out":[P.default]},q={"circular-in-out":"circularInOut","exponential-in-out":"exponentialInOut","circular-in":"circularIn","elastic-out":"elasticOut","cubic-in":"cubicIn","exponential-out":"exponentialOut","quintic-out":"quinticOut","elastic-in-out":"elasticInOut",linear:"linear","circular-out":"circularOut","back-in-out":"backInOut","back-in":"backIn","sine-in":"sineIn","back-out":"backOut","quartic-in-out":"quarticInOut","quadratic-in":"quadraticIn","cubic-in-out":"cubicInOut","elastic-in":"elasticIn","bounce-out":"bounceOut","quadratic-in-out":"quadraticInOut","exponential-in":"exponentialIn","quintic-in-out":"quinticInOut","sine-in-out":"sineInOut","cubic-out":"cubicOut","quadratic-out":"quadraticOut","bounce-in-out":"bounceInOut","quintic-in":"quinticIn","quartic-in":"quarticIn","quartic-out":"quarticOut","bounce-in":"bounceIn","sine-out":"sineOut"},$=B.indexOf("sine-in-out");class Y extends z.NodeParamsConfig{constructor(){super(...arguments),this.type=z.ParamConfig.INTEGER($,{menu:{entries:B.map((e,t)=>({name:e,value:t}))}}),this.input=z.ParamConfig.FLOAT(0)}}const H=new Y;class X extends r.TypedGlNode{constructor(){super(...arguments),this.params_config=H}static type(){return"easing"}initialize_node(){super.initialize_node(),this.spare_params_controller.set_inputless_param_names(["type"]),this.io.outputs.set_named_output_connection_points([new D.TypedNamedConnectionPoint("out",I.ConnectionPointType.FLOAT)])}set_lines(e){const t=B[this.pv.type],n=q[t],s=V[t];let r=[new F.FunctionGLDefinition(this,I.ConnectionPointType.FLOAT,s)];const i=(U[t]||[]).map(e=>new F.FunctionGLDefinition(this,I.ConnectionPointType.FLOAT,e));i&&(r=i.concat(r));const a=o.ThreeToGl.float(this.variable_for_input("input")),_=`float ${this.gl_var_name("out")} = ${n}(${a})`;e.add_definitions(this,r),e.add_body_lines(this,[_])}}t.EasingGlNode=X},function(e,t,n){"use strict";n.r(t),t.default="float circularInOut(float t) {\n  return t < 0.5\n    ? 0.5 * (1.0 - sqrt(1.0 - 4.0 * t * t))\n    : 0.5 * (sqrt((3.0 - 2.0 * t) * (2.0 * t - 1.0)) + 1.0);\n}\n\n"},function(e,t,n){"use strict";n.r(t),t.default="float exponentialInOut(float t) {\n  return t == 0.0 || t == 1.0\n    ? t\n    : t < 0.5\n      ? +0.5 * pow(2.0, (20.0 * t) - 10.0)\n      : -0.5 * pow(2.0, 10.0 - (t * 20.0)) + 1.0;\n}\n\n"},function(e,t,n){"use strict";n.r(t),t.default="float circularIn(float t) {\n  return 1.0 - sqrt(1.0 - t * t);\n}\n\n"},function(e,t,n){"use strict";n.r(t),t.default="#ifndef HALF_PI\n#define HALF_PI 1.5707963267948966\n#endif\n\nfloat elasticOut(float t) {\n  return sin(-13.0 * (t + 1.0) * HALF_PI) * pow(2.0, -10.0 * t) + 1.0;\n}\n\n"},function(e,t,n){"use strict";n.r(t),t.default="float cubicIn(float t) {\n  return t * t * t;\n}\n\n"},function(e,t,n){"use strict";n.r(t),t.default="float exponentialOut(float t) {\n  return t == 1.0 ? t : 1.0 - pow(2.0, -10.0 * t);\n}\n\n"},function(e,t,n){"use strict";n.r(t),t.default="float quinticOut(float t) {\n  return 1.0 - (pow(t - 1.0, 5.0));\n}\n\n"},function(e,t,n){"use strict";n.r(t),t.default="#ifndef HALF_PI\n#define HALF_PI 1.5707963267948966\n#endif\n\nfloat elasticInOut(float t) {\n  return t < 0.5\n    ? 0.5 * sin(+13.0 * HALF_PI * 2.0 * t) * pow(2.0, 10.0 * (2.0 * t - 1.0))\n    : 0.5 * sin(-13.0 * HALF_PI * ((2.0 * t - 1.0) + 1.0)) * pow(2.0, -10.0 * (2.0 * t - 1.0)) + 1.0;\n}\n\n"},function(e,t,n){"use strict";n.r(t),t.default="float linear(float t) {\n  return t;\n}\n\n"},function(e,t,n){"use strict";n.r(t),t.default="float circularOut(float t) {\n  return sqrt((2.0 - t) * t);\n}\n\n"},function(e,t,n){"use strict";n.r(t),t.default="\nfloat backInOut(float t) {\n  float f = t < 0.5\n    ? 2.0 * t\n    : 1.0 - (2.0 * t - 1.0);\n\n  float g = pow(f, 3.0) - f * sin(f * PI);\n\n  return t < 0.5\n    ? 0.5 * g\n    : 0.5 * (1.0 - g) + 0.5;\n}\n\n"},function(e,t,n){"use strict";n.r(t),t.default="\nfloat backIn(float t) {\n  return pow(t, 3.0) - t * sin(t * PI);\n}\n\n"},function(e,t,n){"use strict";n.r(t),t.default="#ifndef HALF_PI\n#define HALF_PI 1.5707963267948966\n#endif\n\nfloat sineIn(float t) {\n  return sin((t - 1.0) * HALF_PI) + 1.0;\n}\n\n"},function(e,t,n){"use strict";n.r(t),t.default="\nfloat backOut(float t) {\n  float f = 1.0 - t;\n  return 1.0 - (pow(f, 3.0) - f * sin(f * PI));\n}\n\n"},function(e,t,n){"use strict";n.r(t),t.default="float quarticInOut(float t) {\n  return t < 0.5\n    ? +8.0 * pow(t, 4.0)\n    : -8.0 * pow(t - 1.0, 4.0) + 1.0;\n}\n\n"},function(e,t,n){"use strict";n.r(t),t.default="float quadraticIn(float t) {\n  return t * t;\n}\n\n"},function(e,t,n){"use strict";n.r(t),t.default="float cubicInOut(float t) {\n  return t < 0.5\n    ? 4.0 * t * t * t\n    : 0.5 * pow(2.0 * t - 2.0, 3.0) + 1.0;\n}\n\n"},function(e,t,n){"use strict";n.r(t),t.default="#ifndef HALF_PI\n#define HALF_PI 1.5707963267948966\n#endif\n\nfloat elasticIn(float t) {\n  return sin(13.0 * t * HALF_PI) * pow(2.0, 10.0 * (t - 1.0));\n}\n\n"},function(e,t,n){"use strict";n.r(t),t.default="\nfloat bounceOut(float t) {\n  const float a = 4.0 / 11.0;\n  const float b = 8.0 / 11.0;\n  const float c = 9.0 / 10.0;\n\n  const float ca = 4356.0 / 361.0;\n  const float cb = 35442.0 / 1805.0;\n  const float cc = 16061.0 / 1805.0;\n\n  float t2 = t * t;\n\n  return t < a\n    ? 7.5625 * t2\n    : t < b\n      ? 9.075 * t2 - 9.9 * t + 3.4\n      : t < c\n        ? ca * t2 - cb * t + cc\n        : 10.8 * t * t - 20.52 * t + 10.72;\n}\n\n"},function(e,t,n){"use strict";n.r(t),t.default="float quadraticInOut(float t) {\n  float p = 2.0 * t * t;\n  return t < 0.5 ? p : -p + (4.0 * t) - 1.0;\n}\n\n"},function(e,t,n){"use strict";n.r(t),t.default="float exponentialIn(float t) {\n  return t == 0.0 ? t : pow(2.0, 10.0 * (t - 1.0));\n}\n\n"},function(e,t,n){"use strict";n.r(t),t.default="float quinticInOut(float t) {\n  return t < 0.5\n    ? +16.0 * pow(t, 5.0)\n    : -0.5 * pow(2.0 * t - 2.0, 5.0) + 1.0;\n}\n\n"},function(e,t,n){"use strict";n.r(t),t.default="\nfloat sineInOut(float t) {\n  return -0.5 * (cos(PI * t) - 1.0);\n}\n\n"},function(e,t,n){"use strict";n.r(t),t.default="float cubicOut(float t) {\n  float f = t - 1.0;\n  return f * f * f + 1.0;\n}\n\n"},function(e,t,n){"use strict";n.r(t),t.default="float quadraticOut(float t) {\n  return -t * (t - 2.0);\n}\n\n"},function(e,t,n){"use strict";n.r(t),t.default="\nfloat bounceInOut(float t) {\n  return t < 0.5\n    ? 0.5 * (1.0 - bounceOut(1.0 - t * 2.0))\n    : 0.5 * bounceOut(t * 2.0 - 1.0) + 0.5;\n}\n\n\n\n"},function(e,t,n){"use strict";n.r(t),t.default="float quinticIn(float t) {\n  return pow(t, 5.0);\n}\n\n"},function(e,t,n){"use strict";n.r(t),t.default="float quarticIn(float t) {\n  return pow(t, 4.0);\n}\n\n"},function(e,t,n){"use strict";n.r(t),t.default="float quarticOut(float t) {\n  return pow(t - 1.0, 3.0) * (1.0 - t) + 1.0;\n}\n\n"},function(e,t,n){"use strict";n.r(t),t.default="\nfloat bounceIn(float t) {\n  return 1.0 - bounceOut(1.0 - t);\n}\n\n"},function(e,t,n){"use strict";n.r(t),t.default="#ifndef HALF_PI\n#define HALF_PI 1.5707963267948966\n#endif\n\nfloat sineOut(float t) {\n  return sin(t * HALF_PI);\n}\n\n"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),r=n(36),o=s.__importDefault(n(371)),i=n(29),a=n(16),_={src_min:0,src_max:1};class c extends r.BaseNodeGlMathFunctionArg5GlNode{static type(){return"fit"}_gl_input_name(e){return["val","src_min","src_max","dest_min","dest_max"][e]}gl_input_default_value(e){return _[e]}gl_method_name(){return"fit"}gl_function_definitions(){return[new i.FunctionGLDefinition(this,a.ConnectionPointType.FLOAT,o.default)]}}t.FitGlNode=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),r=n(36),o=s.__importDefault(n(371)),i=n(29),a=n(16),_={src_min:0,src_max:1};class c extends r.BaseNodeGlMathFunctionArg3GlNode{static type(){return"fit01"}gl_input_name(e){return["val","src_min","src_max"][e]}gl_input_default_value(e){return _[e]}gl_method_name(){return"fit01"}gl_function_definitions(){return[new i.FunctionGLDefinition(this,a.ConnectionPointType.FLOAT,o.default)]}}t.Fit01GlNode=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),r=n(34),o=n(28),i=s.__importDefault(n(728)),a=n(16),_=n(33),c=n(29),l=n(5);class u extends l.NodeParamsConfig{constructor(){super(...arguments),this.hsv=l.ParamConfig.VECTOR3([1,1,1])}}const d=new u;class h extends r.TypedGlNode{constructor(){super(...arguments),this.params_config=d}static type(){return"hsv_to_rgb"}initialize_node(){super.initialize_node(),this.io.outputs.set_named_output_connection_points([new _.TypedNamedConnectionPoint("rgb",a.ConnectionPointType.VEC3)])}set_lines(e){const t=[],n=[];t.push(new c.FunctionGLDefinition(this,a.ConnectionPointType.VEC3,i.default));const s=o.ThreeToGl.vector3(this.variable_for_input(this.p.hsv.name)),r=this.gl_var_name("rgb");n.push(`vec3 ${r} = hsv2rgb(${s})`),e.add_definitions(this,t),e.add_body_lines(this,n)}}t.HsvToRgbGlNode=h},function(e,t,n){"use strict";n.r(t),t.default="// https://github.com/hughsk/glsl-hsv2rgb\n// https://stackoverflow.com/questions/15095909/from-rgb-to-hsv-in-opengl-glsl\nvec3 hsv2rgb(vec3 c) {\n\tvec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\n\tvec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\n\treturn c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\n}"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),r=n(34),o=n(28),i=s.__importDefault(n(95)),a=n(5),_=n(16),c=n(33),l=n(29),u="position",d="normal",h="instancePosition",p="instanceOrientation",m="instanceScale";class f extends a.NodeParamsConfig{constructor(){super(...arguments),this.position=a.ParamConfig.VECTOR3([0,0,0]),this.normal=a.ParamConfig.VECTOR3([0,0,1]),this.instance_position=a.ParamConfig.VECTOR3([0,0,0]),this.instance_orientation=a.ParamConfig.VECTOR4([0,0,0,0]),this.instance_scale=a.ParamConfig.VECTOR3([1,1,1])}}const g=new f;class v extends r.TypedGlNode{constructor(){super(...arguments),this.params_config=g}static type(){return"instance_transform"}initialize_node(){super.initialize_node(),this.io.outputs.set_named_output_connection_points([new c.TypedNamedConnectionPoint(this.gl_output_name_position(),_.ConnectionPointType.VEC3),new c.TypedNamedConnectionPoint(this.gl_output_name_normal(),_.ConnectionPointType.VEC3)])}set_lines(e){const t=[],n=[];n.push(new l.FunctionGLDefinition(this,_.ConnectionPointType.VEC4,i.default));const s=this.io.inputs.named_input(this.p.position.name)?o.ThreeToGl.float(this.variable_for_input(this.p.position.name)):this._default_position(),r=this.io.inputs.named_input(this.p.normal.name)?o.ThreeToGl.float(this.variable_for_input(this.p.normal.name)):this._default_normal(),a=this.io.inputs.named_input(this.p.instance_position.name)?o.ThreeToGl.float(this.variable_for_input(this.p.instance_position.name)):this._default_instance_position(e),c=this.io.inputs.named_input(this.p.instance_orientation.name)?o.ThreeToGl.float(this.variable_for_input(this.p.instance_orientation.name)):this._default_input_instance_orientation(e),u=this.io.inputs.named_input(this.p.instance_scale.name)?o.ThreeToGl.float(this.variable_for_input(this.p.instance_scale.name)):this._default_input_instance_scale(e),d=this.gl_var_name(this.gl_output_name_position()),h=this.gl_var_name(this.gl_output_name_normal());t.push(`vec3 ${d} = vec3(${s})`),t.push(`${d} *= ${u}`),t.push(`${d} = rotate_with_quat( ${d}, ${c} )`),t.push(`${d} += ${a}`),t.push(`vec3 ${h} = vec3(${r})`),t.push(`${h} = rotate_with_quat( ${h}, ${c} )`),e.add_body_lines(this,t),e.add_definitions(this,n)}gl_output_name_position(){return"position"}gl_output_name_normal(){return"normal"}_default_position(){return u}_default_normal(){return d}_default_instance_position(e){var t,n;return null===(n=null===(t=this.material_node)||void 0===t?void 0:t.assembler_controller.assembler.globals_handler)||void 0===n?void 0:n.read_attribute(this,_.ConnectionPointType.VEC3,h,e)}_default_input_instance_orientation(e){var t,n;return null===(n=null===(t=this.material_node)||void 0===t?void 0:t.assembler_controller.assembler.globals_handler)||void 0===n?void 0:n.read_attribute(this,_.ConnectionPointType.VEC4,p,e)}_default_input_instance_scale(e){var t,n;return null===(n=null===(t=this.material_node)||void 0===t?void 0:t.assembler_controller.assembler.globals_handler)||void 0===n?void 0:n.read_attribute(this,_.ConnectionPointType.VEC3,m,e)}}t.InstanceTransformGlNode=v},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(36),r=n(16);class o extends s.BaseNodeGlMathFunctionArg1GlNode{static type(){return"length"}initialize_node(){super.initialize_node(),this.gl_connections_controller.set_input_name_function(this._gl_input_name.bind(this)),this.gl_connections_controller.set_expected_output_types_function(this._expected_output_types.bind(this))}_gl_input_name(e){return["x"][e]}gl_method_name(){return"length"}_expected_output_types(){return[r.ConnectionPointType.FLOAT]}}t.LengthGlNode=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(34),r=n(16),o=n(33),i=n(28),a=n(5);class _ extends a.NodeParamsConfig{constructor(){super(...arguments),this.hsv=a.ParamConfig.VECTOR3([1,1,1])}}const c=new _;class l extends s.TypedGlNode{constructor(){super(...arguments),this.params_config=c}static type(){return"luminance"}initialize_node(){super.initialize_node(),this.io.outputs.set_named_output_connection_points([new o.TypedNamedConnectionPoint("lum",r.ConnectionPointType.FLOAT)])}set_lines(e){const t=i.ThreeToGl.vector3(this.variable_for_input("color")),n=`float ${this.gl_var_name("lum")} = linearToRelativeLuminance(${t})`;e.add_body_lines(this,[n])}}t.LuminanceGlNode=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(36),r=n(16);class o extends s.BaseGlMathFunctionGlNode{static type(){return"mix"}initialize_node(){super.initialize_node(),this.gl_connections_controller.set_input_name_function(e=>["value0","value1","blend"][e]),this.gl_connections_controller.set_output_name_function(this._gl_output_name.bind(this)),this.gl_connections_controller.set_expected_input_types_function(this._expected_input_types.bind(this)),this.gl_connections_controller.set_expected_output_types_function(this._expected_output_types.bind(this))}_gl_output_name(){return"mix"}_expected_input_types(){const e=this.gl_connections_controller.first_input_connection_type()||r.ConnectionPointType.FLOAT;return[e,e,r.ConnectionPointType.FLOAT]}_expected_output_types(){return[this._expected_input_types()[0]]}}t.MixGlNode=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(36),r=n(28),o={mult:1};var i;!function(e){e.VALUE="value",e.PRE_ADD="pre_add",e.MULT="mult",e.POST_ADD="post_add"}(i||(i={}));class a extends s.BaseNodeGlMathFunctionArg4GlNode{static type(){return"mult_add"}_gl_input_name(e){return[i.VALUE,i.PRE_ADD,i.MULT,i.POST_ADD][e]}gl_input_default_value(e){return o[e]}set_lines(e){const t=r.ThreeToGl.any(this.variable_for_input(i.VALUE)),n=r.ThreeToGl.any(this.variable_for_input(i.PRE_ADD)),s=r.ThreeToGl.any(this.variable_for_input(i.MULT)),o=r.ThreeToGl.any(this.variable_for_input(i.POST_ADD)),a=this._expected_output_types()[0],_=this.io.outputs.named_output_connection_points[0].name,c=`${a} ${this.gl_var_name(_)} = (${s}*(${t} + ${n})) + ${o}`;e.add_body_lines(this,[c])}}t.MultAddGlNode=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(36),r=n(28);class o extends s.BaseNodeGlMathFunctionArg1GlNode{static type(){return"negate"}initialize_node(){super.initialize_node(),this.gl_connections_controller.set_input_name_function(e=>["in"][e])}_gl_input_name(e){return["in"][e]}set_lines(e){const t=r.ThreeToGl.any(this.variable_for_input(this._gl_input_name(0))),n=`${this.io.inputs.named_input_connection_points[0].type} ${this.gl_var_name(this.gl_connections_controller.output_name(0))} = -1.0 * ${t}`;e.add_body_lines(this,[n])}}t.NegateGlNode=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),r=s.__importDefault(n(82)),o=n(34),i=n(33),a=n(133),_=s.__importDefault(n(736)),c=s.__importDefault(n(737)),l=s.__importDefault(n(738)),u=s.__importDefault(n(739)),d=s.__importDefault(n(740)),h=s.__importDefault(n(741)),p=s.__importDefault(n(742)),m=n(16);var f;!function(e){e.CLASSIC_PERLIN_2D="Classic Perlin 2D",e.CLASSIC_PERLIN_3D="Classic Perlin 3D",e.CLASSIC_PERLIN_4D="Classic Perlin 4D",e.NOISE_2D="noise2D",e.NOISE_3D="noise3D",e.NOISE_4D="noise4D"}(f||(f={}));const g=[f.CLASSIC_PERLIN_2D,f.CLASSIC_PERLIN_3D,f.CLASSIC_PERLIN_4D,f.NOISE_2D,f.NOISE_3D,f.NOISE_4D],v={[f.CLASSIC_PERLIN_2D]:c.default,[f.CLASSIC_PERLIN_3D]:l.default,[f.CLASSIC_PERLIN_4D]:u.default,[f.NOISE_2D]:d.default,[f.NOISE_3D]:h.default,[f.NOISE_4D]:p.default},y={[f.CLASSIC_PERLIN_2D]:m.ConnectionPointType.VEC2,[f.CLASSIC_PERLIN_3D]:m.ConnectionPointType.VEC3,[f.CLASSIC_PERLIN_4D]:m.ConnectionPointType.VEC4,[f.NOISE_2D]:m.ConnectionPointType.VEC2,[f.NOISE_3D]:m.ConnectionPointType.VEC3,[f.NOISE_4D]:m.ConnectionPointType.VEC4},b={[f.CLASSIC_PERLIN_2D]:m.ConnectionPointType.FLOAT,[f.CLASSIC_PERLIN_3D]:m.ConnectionPointType.FLOAT,[f.CLASSIC_PERLIN_4D]:m.ConnectionPointType.FLOAT,[f.NOISE_2D]:m.ConnectionPointType.FLOAT,[f.NOISE_3D]:m.ConnectionPointType.FLOAT,[f.NOISE_4D]:m.ConnectionPointType.FLOAT},x={[f.CLASSIC_PERLIN_2D]:"cnoise",[f.CLASSIC_PERLIN_3D]:"cnoise",[f.CLASSIC_PERLIN_4D]:"cnoise",[f.NOISE_2D]:"snoise",[f.NOISE_3D]:"snoise",[f.NOISE_4D]:"snoise"};var T;!function(e){e[e.NoChange=0]="NoChange",e[e.Float=1]="Float",e[e.Vec2=2]="Vec2",e[e.Vec3=3]="Vec3",e[e.Vec4=4]="Vec4"}(T||(T={}));const C=[T.NoChange,T.Float,T.Vec2,T.Vec3,T.Vec4],P={[T.NoChange]:"Same as noise",[T.Float]:"Float",[T.Vec2]:"Vec2",[T.Vec3]:"Vec3",[T.Vec4]:"Vec4"},w={[T.NoChange]:m.ConnectionPointType.FLOAT,[T.Float]:m.ConnectionPointType.FLOAT,[T.Vec2]:m.ConnectionPointType.VEC2,[T.Vec3]:m.ConnectionPointType.VEC3,[T.Vec4]:m.ConnectionPointType.VEC4},E=["x","y","z","w"],O=g.indexOf(f.NOISE_3D),A=T.NoChange,N={amp:1,freq:1};var M;!function(e){e.AMP="amp",e.POSITION="position",e.FREQ="freq",e.OFFSET="offset"}(M||(M={}));const S=n(5),R=n(28),j=n(29);class L extends S.NodeParamsConfig{constructor(){super(...arguments),this.type=S.ParamConfig.INTEGER(O,{menu:{entries:g.map((e,t)=>({name:`${e} (output: ${b[e]})`,value:t}))}}),this.output_type=S.ParamConfig.INTEGER(A,{menu:{entries:C.map(e=>{const t=C[e];return{name:P[t],value:t}})}}),this.octaves=S.ParamConfig.INTEGER(3,{range:[1,10],range_locked:[!0,!1]}),this.amp_attenuation=S.ParamConfig.FLOAT(.5,{range:[0,1]}),this.freq_increase=S.ParamConfig.FLOAT(2,{range:[0,10]}),this.separator=S.ParamConfig.SEPARATOR()}}const k=new L;class G extends o.TypedGlNode{constructor(){super(...arguments),this.params_config=k,this.gl_connections_controller=new a.GlConnectionsController(this)}static type(){return"noise"}initialize_node(){super.initialize_node(),this.gl_connections_controller.initialize_node(),this.spare_params_controller.set_inputless_param_names(["octaves","amp_attenuation","freq_increase"]),this.io.outputs.set_named_output_connection_points([new i.TypedNamedConnectionPoint("noise",m.ConnectionPointType.FLOAT)]),this.gl_connections_controller.set_expected_input_types_function(this._expected_input_types.bind(this)),this.gl_connections_controller.set_expected_output_types_function(this._expected_output_types.bind(this))}_gl_input_name(e){return[M.AMP,M.POSITION,M.FREQ,M.OFFSET][e]}gl_input_default_value(e){return N[e]}_expected_input_types(){const e=g[this.pv.type],t=y[e];return[t,t,t,t]}_expected_output_types(){const e=g[this.pv.type],t=C[this.pv.output_type];return t==T.NoChange?[b[e]]:[w[t]]}set_lines(e){const t=[],n=[],s=g[this.pv.type],o=v[s],i=b[s];t.push(new j.FunctionGLDefinition(this,i,_.default)),t.push(new j.FunctionGLDefinition(this,i,o)),t.push(new j.FunctionGLDefinition(this,i,this.fbm_function()));const a=this._expected_output_types()[0];if(a==i){const e=this.single_noise_line();n.push(e)}else{const e=m.ConnectionPointComponentsCountMap[a],t=[],o=this.gl_var_name("noise");for(let i=0;i<e;i++){const e=E[i];t.push(`${o}${e}`);const a=y[s],_=m.ConnectionPointComponentsCountMap[a],c=`${a}(${r.default(_).map(e=>R.ThreeToGl.float(1e3*i)).join(", ")})`,l=this.single_noise_line(e,e,c);n.push(l)}const i=`vec${e} ${o} = vec${e}(${t.join(", ")})`;n.push(i)}e.add_definitions(this,t),e.add_body_lines(this,n)}fbm_method_name(){const e=g[this.pv.type];return`fbm_${x[e]}_${this.name}`}fbm_function(){const e=g[this.pv.type],t=x[e],n=y[e];return`\nfloat ${this.fbm_method_name()} (in ${n} st) {\n\tfloat value = 0.0;\n\tfloat amplitude = 1.0;\n\tfor (int i = 0; i < ${R.ThreeToGl.int(this.pv.octaves)}; i++) {\n\t\tvalue += amplitude * ${t}(st);\n\t\tst *= ${R.ThreeToGl.float(this.pv.freq_increase)};\n\t\tamplitude *= ${R.ThreeToGl.float(this.pv.amp_attenuation)};\n\t}\n\treturn value;\n}\n`}single_noise_line(e,t,n){const s=g[this.pv.type],r=this.fbm_method_name(),o=R.ThreeToGl.any(this.variable_for_input(M.AMP)),i=R.ThreeToGl.any(this.variable_for_input(M.POSITION)),a=R.ThreeToGl.any(this.variable_for_input(M.FREQ));let _=R.ThreeToGl.any(this.variable_for_input(M.OFFSET));n&&(_=`(${_}+${n})`);const c=[`(${i}*${a})+${_}`].join(", "),l=this.gl_var_name("noise"),u=`${o}*${r}(${c})`;if(t)return`float ${l}${e} = (${u}).${t}`;return`${b[s]} ${l} = ${u}`}}t.NoiseGlNode=G},function(e,t,n){"use strict";n.r(t),t.default="// Modulo 289 without a division (only multiplications)\nfloat mod289(float x) {\n  return x - floor(x * (1.0 / 289.0)) * 289.0;\n}\nvec2 mod289(vec2 x) {\n  return x - floor(x * (1.0 / 289.0)) * 289.0;\n}\nvec3 mod289(vec3 x) {\n  return x - floor(x * (1.0 / 289.0)) * 289.0;\n}\nvec4 mod289(vec4 x) {\n  return x - floor(x * (1.0 / 289.0)) * 289.0;\n}\n// Modulo 7 without a division\nvec3 mod7(vec3 x) {\n  return x - floor(x * (1.0 / 7.0)) * 7.0;\n}\n\n// Permutation polynomial: (34x^2 + x) mod 289\nfloat permute(float x) {\n     return mod289(((x*34.0)+1.0)*x);\n}\nvec3 permute(vec3 x) {\n  return mod289((34.0 * x + 1.0) * x);\n}\nvec4 permute(vec4 x) {\n     return mod289(((x*34.0)+1.0)*x);\n}\n\nfloat taylorInvSqrt(float r)\n{\n  return 1.79284291400159 - 0.85373472095314 * r;\n}\nvec4 taylorInvSqrt(vec4 r)\n{\n  return 1.79284291400159 - 0.85373472095314 * r;\n}\n\nvec2 fade(vec2 t) {\n  return t*t*t*(t*(t*6.0-15.0)+10.0);\n}\nvec3 fade(vec3 t) {\n  return t*t*t*(t*(t*6.0-15.0)+10.0);\n}\nvec4 fade(vec4 t) {\n  return t*t*t*(t*(t*6.0-15.0)+10.0);\n}"},function(e,t,n){"use strict";n.r(t),t.default='//\n// GLSL textureless classic 2D noise "cnoise",\n// with an RSL-style periodic variant "pnoise".\n// Author:  Stefan Gustavson (stefan.gustavson@liu.se)\n// Version: 2011-08-22\n//\n// Many thanks to Ian McEwan of Ashima Arts for the\n// ideas for permutation and gradient selection.\n//\n// Copyright (c) 2011 Stefan Gustavson. All rights reserved.\n// Distributed under the MIT license. See LICENSE file.\n// https://github.com/stegu/webgl-noise\n//\n\n\n// Classic Perlin noise\nfloat cnoise(vec2 P)\n{\n  vec4 Pi = floor(P.xyxy) + vec4(0.0, 0.0, 1.0, 1.0);\n  vec4 Pf = fract(P.xyxy) - vec4(0.0, 0.0, 1.0, 1.0);\n  Pi = mod289(Pi); // To avoid truncation effects in permutation\n  vec4 ix = Pi.xzxz;\n  vec4 iy = Pi.yyww;\n  vec4 fx = Pf.xzxz;\n  vec4 fy = Pf.yyww;\n\n  vec4 i = permute(permute(ix) + iy);\n\n  vec4 gx = fract(i * (1.0 / 41.0)) * 2.0 - 1.0 ;\n  vec4 gy = abs(gx) - 0.5 ;\n  vec4 tx = floor(gx + 0.5);\n  gx = gx - tx;\n\n  vec2 g00 = vec2(gx.x,gy.x);\n  vec2 g10 = vec2(gx.y,gy.y);\n  vec2 g01 = vec2(gx.z,gy.z);\n  vec2 g11 = vec2(gx.w,gy.w);\n\n  vec4 norm = taylorInvSqrt(vec4(dot(g00, g00), dot(g01, g01), dot(g10, g10), dot(g11, g11)));\n  g00 *= norm.x;  \n  g01 *= norm.y;  \n  g10 *= norm.z;  \n  g11 *= norm.w;  \n\n  float n00 = dot(g00, vec2(fx.x, fy.x));\n  float n10 = dot(g10, vec2(fx.y, fy.y));\n  float n01 = dot(g01, vec2(fx.z, fy.z));\n  float n11 = dot(g11, vec2(fx.w, fy.w));\n\n  vec2 fade_xy = fade(Pf.xy);\n  vec2 n_x = mix(vec2(n00, n01), vec2(n10, n11), fade_xy.x);\n  float n_xy = mix(n_x.x, n_x.y, fade_xy.y);\n  return 2.3 * n_xy;\n}\n\n// Classic Perlin noise, periodic variant\nfloat pnoise(vec2 P, vec2 rep)\n{\n  vec4 Pi = floor(P.xyxy) + vec4(0.0, 0.0, 1.0, 1.0);\n  vec4 Pf = fract(P.xyxy) - vec4(0.0, 0.0, 1.0, 1.0);\n  Pi = mod(Pi, rep.xyxy); // To create noise with explicit period\n  Pi = mod289(Pi);        // To avoid truncation effects in permutation\n  vec4 ix = Pi.xzxz;\n  vec4 iy = Pi.yyww;\n  vec4 fx = Pf.xzxz;\n  vec4 fy = Pf.yyww;\n\n  vec4 i = permute(permute(ix) + iy);\n\n  vec4 gx = fract(i * (1.0 / 41.0)) * 2.0 - 1.0 ;\n  vec4 gy = abs(gx) - 0.5 ;\n  vec4 tx = floor(gx + 0.5);\n  gx = gx - tx;\n\n  vec2 g00 = vec2(gx.x,gy.x);\n  vec2 g10 = vec2(gx.y,gy.y);\n  vec2 g01 = vec2(gx.z,gy.z);\n  vec2 g11 = vec2(gx.w,gy.w);\n\n  vec4 norm = taylorInvSqrt(vec4(dot(g00, g00), dot(g01, g01), dot(g10, g10), dot(g11, g11)));\n  g00 *= norm.x;  \n  g01 *= norm.y;  \n  g10 *= norm.z;  \n  g11 *= norm.w;  \n\n  float n00 = dot(g00, vec2(fx.x, fy.x));\n  float n10 = dot(g10, vec2(fx.y, fy.y));\n  float n01 = dot(g01, vec2(fx.z, fy.z));\n  float n11 = dot(g11, vec2(fx.w, fy.w));\n\n  vec2 fade_xy = fade(Pf.xy);\n  vec2 n_x = mix(vec2(n00, n01), vec2(n10, n11), fade_xy.x);\n  float n_xy = mix(n_x.x, n_x.y, fade_xy.y);\n  return 2.3 * n_xy;\n}\n'},function(e,t,n){"use strict";n.r(t),t.default='//\n// GLSL textureless classic 3D noise "cnoise",\n// with an RSL-style periodic variant "pnoise".\n// Author:  Stefan Gustavson (stefan.gustavson@liu.se)\n// Version: 2011-10-11\n//\n// Many thanks to Ian McEwan of Ashima Arts for the\n// ideas for permutation and gradient selection.\n//\n// Copyright (c) 2011 Stefan Gustavson. All rights reserved.\n// Distributed under the MIT license. See LICENSE file.\n// https://github.com/stegu/webgl-noise\n//\n\n// Classic Perlin noise\nfloat cnoise(vec3 P)\n{\n  vec3 Pi0 = floor(P); // Integer part for indexing\n  vec3 Pi1 = Pi0 + vec3(1.0); // Integer part + 1\n  Pi0 = mod289(Pi0);\n  Pi1 = mod289(Pi1);\n  vec3 Pf0 = fract(P); // Fractional part for interpolation\n  vec3 Pf1 = Pf0 - vec3(1.0); // Fractional part - 1.0\n  vec4 ix = vec4(Pi0.x, Pi1.x, Pi0.x, Pi1.x);\n  vec4 iy = vec4(Pi0.yy, Pi1.yy);\n  vec4 iz0 = Pi0.zzzz;\n  vec4 iz1 = Pi1.zzzz;\n\n  vec4 ixy = permute(permute(ix) + iy);\n  vec4 ixy0 = permute(ixy + iz0);\n  vec4 ixy1 = permute(ixy + iz1);\n\n  vec4 gx0 = ixy0 * (1.0 / 7.0);\n  vec4 gy0 = fract(floor(gx0) * (1.0 / 7.0)) - 0.5;\n  gx0 = fract(gx0);\n  vec4 gz0 = vec4(0.5) - abs(gx0) - abs(gy0);\n  vec4 sz0 = step(gz0, vec4(0.0));\n  gx0 -= sz0 * (step(0.0, gx0) - 0.5);\n  gy0 -= sz0 * (step(0.0, gy0) - 0.5);\n\n  vec4 gx1 = ixy1 * (1.0 / 7.0);\n  vec4 gy1 = fract(floor(gx1) * (1.0 / 7.0)) - 0.5;\n  gx1 = fract(gx1);\n  vec4 gz1 = vec4(0.5) - abs(gx1) - abs(gy1);\n  vec4 sz1 = step(gz1, vec4(0.0));\n  gx1 -= sz1 * (step(0.0, gx1) - 0.5);\n  gy1 -= sz1 * (step(0.0, gy1) - 0.5);\n\n  vec3 g000 = vec3(gx0.x,gy0.x,gz0.x);\n  vec3 g100 = vec3(gx0.y,gy0.y,gz0.y);\n  vec3 g010 = vec3(gx0.z,gy0.z,gz0.z);\n  vec3 g110 = vec3(gx0.w,gy0.w,gz0.w);\n  vec3 g001 = vec3(gx1.x,gy1.x,gz1.x);\n  vec3 g101 = vec3(gx1.y,gy1.y,gz1.y);\n  vec3 g011 = vec3(gx1.z,gy1.z,gz1.z);\n  vec3 g111 = vec3(gx1.w,gy1.w,gz1.w);\n\n  vec4 norm0 = taylorInvSqrt(vec4(dot(g000, g000), dot(g010, g010), dot(g100, g100), dot(g110, g110)));\n  g000 *= norm0.x;\n  g010 *= norm0.y;\n  g100 *= norm0.z;\n  g110 *= norm0.w;\n  vec4 norm1 = taylorInvSqrt(vec4(dot(g001, g001), dot(g011, g011), dot(g101, g101), dot(g111, g111)));\n  g001 *= norm1.x;\n  g011 *= norm1.y;\n  g101 *= norm1.z;\n  g111 *= norm1.w;\n\n  float n000 = dot(g000, Pf0);\n  float n100 = dot(g100, vec3(Pf1.x, Pf0.yz));\n  float n010 = dot(g010, vec3(Pf0.x, Pf1.y, Pf0.z));\n  float n110 = dot(g110, vec3(Pf1.xy, Pf0.z));\n  float n001 = dot(g001, vec3(Pf0.xy, Pf1.z));\n  float n101 = dot(g101, vec3(Pf1.x, Pf0.y, Pf1.z));\n  float n011 = dot(g011, vec3(Pf0.x, Pf1.yz));\n  float n111 = dot(g111, Pf1);\n\n  vec3 fade_xyz = fade(Pf0);\n  vec4 n_z = mix(vec4(n000, n100, n010, n110), vec4(n001, n101, n011, n111), fade_xyz.z);\n  vec2 n_yz = mix(n_z.xy, n_z.zw, fade_xyz.y);\n  float n_xyz = mix(n_yz.x, n_yz.y, fade_xyz.x); \n  return 2.2 * n_xyz;\n}\n\n// Classic Perlin noise, periodic variant\nfloat pnoise(vec3 P, vec3 rep)\n{\n  vec3 Pi0 = mod(floor(P), rep); // Integer part, modulo period\n  vec3 Pi1 = mod(Pi0 + vec3(1.0), rep); // Integer part + 1, mod period\n  Pi0 = mod289(Pi0);\n  Pi1 = mod289(Pi1);\n  vec3 Pf0 = fract(P); // Fractional part for interpolation\n  vec3 Pf1 = Pf0 - vec3(1.0); // Fractional part - 1.0\n  vec4 ix = vec4(Pi0.x, Pi1.x, Pi0.x, Pi1.x);\n  vec4 iy = vec4(Pi0.yy, Pi1.yy);\n  vec4 iz0 = Pi0.zzzz;\n  vec4 iz1 = Pi1.zzzz;\n\n  vec4 ixy = permute(permute(ix) + iy);\n  vec4 ixy0 = permute(ixy + iz0);\n  vec4 ixy1 = permute(ixy + iz1);\n\n  vec4 gx0 = ixy0 * (1.0 / 7.0);\n  vec4 gy0 = fract(floor(gx0) * (1.0 / 7.0)) - 0.5;\n  gx0 = fract(gx0);\n  vec4 gz0 = vec4(0.5) - abs(gx0) - abs(gy0);\n  vec4 sz0 = step(gz0, vec4(0.0));\n  gx0 -= sz0 * (step(0.0, gx0) - 0.5);\n  gy0 -= sz0 * (step(0.0, gy0) - 0.5);\n\n  vec4 gx1 = ixy1 * (1.0 / 7.0);\n  vec4 gy1 = fract(floor(gx1) * (1.0 / 7.0)) - 0.5;\n  gx1 = fract(gx1);\n  vec4 gz1 = vec4(0.5) - abs(gx1) - abs(gy1);\n  vec4 sz1 = step(gz1, vec4(0.0));\n  gx1 -= sz1 * (step(0.0, gx1) - 0.5);\n  gy1 -= sz1 * (step(0.0, gy1) - 0.5);\n\n  vec3 g000 = vec3(gx0.x,gy0.x,gz0.x);\n  vec3 g100 = vec3(gx0.y,gy0.y,gz0.y);\n  vec3 g010 = vec3(gx0.z,gy0.z,gz0.z);\n  vec3 g110 = vec3(gx0.w,gy0.w,gz0.w);\n  vec3 g001 = vec3(gx1.x,gy1.x,gz1.x);\n  vec3 g101 = vec3(gx1.y,gy1.y,gz1.y);\n  vec3 g011 = vec3(gx1.z,gy1.z,gz1.z);\n  vec3 g111 = vec3(gx1.w,gy1.w,gz1.w);\n\n  vec4 norm0 = taylorInvSqrt(vec4(dot(g000, g000), dot(g010, g010), dot(g100, g100), dot(g110, g110)));\n  g000 *= norm0.x;\n  g010 *= norm0.y;\n  g100 *= norm0.z;\n  g110 *= norm0.w;\n  vec4 norm1 = taylorInvSqrt(vec4(dot(g001, g001), dot(g011, g011), dot(g101, g101), dot(g111, g111)));\n  g001 *= norm1.x;\n  g011 *= norm1.y;\n  g101 *= norm1.z;\n  g111 *= norm1.w;\n\n  float n000 = dot(g000, Pf0);\n  float n100 = dot(g100, vec3(Pf1.x, Pf0.yz));\n  float n010 = dot(g010, vec3(Pf0.x, Pf1.y, Pf0.z));\n  float n110 = dot(g110, vec3(Pf1.xy, Pf0.z));\n  float n001 = dot(g001, vec3(Pf0.xy, Pf1.z));\n  float n101 = dot(g101, vec3(Pf1.x, Pf0.y, Pf1.z));\n  float n011 = dot(g011, vec3(Pf0.x, Pf1.yz));\n  float n111 = dot(g111, Pf1);\n\n  vec3 fade_xyz = fade(Pf0);\n  vec4 n_z = mix(vec4(n000, n100, n010, n110), vec4(n001, n101, n011, n111), fade_xyz.z);\n  vec2 n_yz = mix(n_z.xy, n_z.zw, fade_xyz.y);\n  float n_xyz = mix(n_yz.x, n_yz.y, fade_xyz.x); \n  return 2.2 * n_xyz;\n}\n'},function(e,t,n){"use strict";n.r(t),t.default='//\n// GLSL textureless classic 4D noise "cnoise",\n// with an RSL-style periodic variant "pnoise".\n// Author:  Stefan Gustavson (stefan.gustavson@liu.se)\n// Version: 2011-08-22\n//\n// Many thanks to Ian McEwan of Ashima Arts for the\n// ideas for permutation and gradient selection.\n//\n// Copyright (c) 2011 Stefan Gustavson. All rights reserved.\n// Distributed under the MIT license. See LICENSE file.\n// https://github.com/stegu/webgl-noise\n//\n\n\n\n// Classic Perlin noise\nfloat cnoise(vec4 P)\n{\n  vec4 Pi0 = floor(P); // Integer part for indexing\n  vec4 Pi1 = Pi0 + 1.0; // Integer part + 1\n  Pi0 = mod289(Pi0);\n  Pi1 = mod289(Pi1);\n  vec4 Pf0 = fract(P); // Fractional part for interpolation\n  vec4 Pf1 = Pf0 - 1.0; // Fractional part - 1.0\n  vec4 ix = vec4(Pi0.x, Pi1.x, Pi0.x, Pi1.x);\n  vec4 iy = vec4(Pi0.yy, Pi1.yy);\n  vec4 iz0 = vec4(Pi0.zzzz);\n  vec4 iz1 = vec4(Pi1.zzzz);\n  vec4 iw0 = vec4(Pi0.wwww);\n  vec4 iw1 = vec4(Pi1.wwww);\n\n  vec4 ixy = permute(permute(ix) + iy);\n  vec4 ixy0 = permute(ixy + iz0);\n  vec4 ixy1 = permute(ixy + iz1);\n  vec4 ixy00 = permute(ixy0 + iw0);\n  vec4 ixy01 = permute(ixy0 + iw1);\n  vec4 ixy10 = permute(ixy1 + iw0);\n  vec4 ixy11 = permute(ixy1 + iw1);\n\n  vec4 gx00 = ixy00 * (1.0 / 7.0);\n  vec4 gy00 = floor(gx00) * (1.0 / 7.0);\n  vec4 gz00 = floor(gy00) * (1.0 / 6.0);\n  gx00 = fract(gx00) - 0.5;\n  gy00 = fract(gy00) - 0.5;\n  gz00 = fract(gz00) - 0.5;\n  vec4 gw00 = vec4(0.75) - abs(gx00) - abs(gy00) - abs(gz00);\n  vec4 sw00 = step(gw00, vec4(0.0));\n  gx00 -= sw00 * (step(0.0, gx00) - 0.5);\n  gy00 -= sw00 * (step(0.0, gy00) - 0.5);\n\n  vec4 gx01 = ixy01 * (1.0 / 7.0);\n  vec4 gy01 = floor(gx01) * (1.0 / 7.0);\n  vec4 gz01 = floor(gy01) * (1.0 / 6.0);\n  gx01 = fract(gx01) - 0.5;\n  gy01 = fract(gy01) - 0.5;\n  gz01 = fract(gz01) - 0.5;\n  vec4 gw01 = vec4(0.75) - abs(gx01) - abs(gy01) - abs(gz01);\n  vec4 sw01 = step(gw01, vec4(0.0));\n  gx01 -= sw01 * (step(0.0, gx01) - 0.5);\n  gy01 -= sw01 * (step(0.0, gy01) - 0.5);\n\n  vec4 gx10 = ixy10 * (1.0 / 7.0);\n  vec4 gy10 = floor(gx10) * (1.0 / 7.0);\n  vec4 gz10 = floor(gy10) * (1.0 / 6.0);\n  gx10 = fract(gx10) - 0.5;\n  gy10 = fract(gy10) - 0.5;\n  gz10 = fract(gz10) - 0.5;\n  vec4 gw10 = vec4(0.75) - abs(gx10) - abs(gy10) - abs(gz10);\n  vec4 sw10 = step(gw10, vec4(0.0));\n  gx10 -= sw10 * (step(0.0, gx10) - 0.5);\n  gy10 -= sw10 * (step(0.0, gy10) - 0.5);\n\n  vec4 gx11 = ixy11 * (1.0 / 7.0);\n  vec4 gy11 = floor(gx11) * (1.0 / 7.0);\n  vec4 gz11 = floor(gy11) * (1.0 / 6.0);\n  gx11 = fract(gx11) - 0.5;\n  gy11 = fract(gy11) - 0.5;\n  gz11 = fract(gz11) - 0.5;\n  vec4 gw11 = vec4(0.75) - abs(gx11) - abs(gy11) - abs(gz11);\n  vec4 sw11 = step(gw11, vec4(0.0));\n  gx11 -= sw11 * (step(0.0, gx11) - 0.5);\n  gy11 -= sw11 * (step(0.0, gy11) - 0.5);\n\n  vec4 g0000 = vec4(gx00.x,gy00.x,gz00.x,gw00.x);\n  vec4 g1000 = vec4(gx00.y,gy00.y,gz00.y,gw00.y);\n  vec4 g0100 = vec4(gx00.z,gy00.z,gz00.z,gw00.z);\n  vec4 g1100 = vec4(gx00.w,gy00.w,gz00.w,gw00.w);\n  vec4 g0010 = vec4(gx10.x,gy10.x,gz10.x,gw10.x);\n  vec4 g1010 = vec4(gx10.y,gy10.y,gz10.y,gw10.y);\n  vec4 g0110 = vec4(gx10.z,gy10.z,gz10.z,gw10.z);\n  vec4 g1110 = vec4(gx10.w,gy10.w,gz10.w,gw10.w);\n  vec4 g0001 = vec4(gx01.x,gy01.x,gz01.x,gw01.x);\n  vec4 g1001 = vec4(gx01.y,gy01.y,gz01.y,gw01.y);\n  vec4 g0101 = vec4(gx01.z,gy01.z,gz01.z,gw01.z);\n  vec4 g1101 = vec4(gx01.w,gy01.w,gz01.w,gw01.w);\n  vec4 g0011 = vec4(gx11.x,gy11.x,gz11.x,gw11.x);\n  vec4 g1011 = vec4(gx11.y,gy11.y,gz11.y,gw11.y);\n  vec4 g0111 = vec4(gx11.z,gy11.z,gz11.z,gw11.z);\n  vec4 g1111 = vec4(gx11.w,gy11.w,gz11.w,gw11.w);\n\n  vec4 norm00 = taylorInvSqrt(vec4(dot(g0000, g0000), dot(g0100, g0100), dot(g1000, g1000), dot(g1100, g1100)));\n  g0000 *= norm00.x;\n  g0100 *= norm00.y;\n  g1000 *= norm00.z;\n  g1100 *= norm00.w;\n\n  vec4 norm01 = taylorInvSqrt(vec4(dot(g0001, g0001), dot(g0101, g0101), dot(g1001, g1001), dot(g1101, g1101)));\n  g0001 *= norm01.x;\n  g0101 *= norm01.y;\n  g1001 *= norm01.z;\n  g1101 *= norm01.w;\n\n  vec4 norm10 = taylorInvSqrt(vec4(dot(g0010, g0010), dot(g0110, g0110), dot(g1010, g1010), dot(g1110, g1110)));\n  g0010 *= norm10.x;\n  g0110 *= norm10.y;\n  g1010 *= norm10.z;\n  g1110 *= norm10.w;\n\n  vec4 norm11 = taylorInvSqrt(vec4(dot(g0011, g0011), dot(g0111, g0111), dot(g1011, g1011), dot(g1111, g1111)));\n  g0011 *= norm11.x;\n  g0111 *= norm11.y;\n  g1011 *= norm11.z;\n  g1111 *= norm11.w;\n\n  float n0000 = dot(g0000, Pf0);\n  float n1000 = dot(g1000, vec4(Pf1.x, Pf0.yzw));\n  float n0100 = dot(g0100, vec4(Pf0.x, Pf1.y, Pf0.zw));\n  float n1100 = dot(g1100, vec4(Pf1.xy, Pf0.zw));\n  float n0010 = dot(g0010, vec4(Pf0.xy, Pf1.z, Pf0.w));\n  float n1010 = dot(g1010, vec4(Pf1.x, Pf0.y, Pf1.z, Pf0.w));\n  float n0110 = dot(g0110, vec4(Pf0.x, Pf1.yz, Pf0.w));\n  float n1110 = dot(g1110, vec4(Pf1.xyz, Pf0.w));\n  float n0001 = dot(g0001, vec4(Pf0.xyz, Pf1.w));\n  float n1001 = dot(g1001, vec4(Pf1.x, Pf0.yz, Pf1.w));\n  float n0101 = dot(g0101, vec4(Pf0.x, Pf1.y, Pf0.z, Pf1.w));\n  float n1101 = dot(g1101, vec4(Pf1.xy, Pf0.z, Pf1.w));\n  float n0011 = dot(g0011, vec4(Pf0.xy, Pf1.zw));\n  float n1011 = dot(g1011, vec4(Pf1.x, Pf0.y, Pf1.zw));\n  float n0111 = dot(g0111, vec4(Pf0.x, Pf1.yzw));\n  float n1111 = dot(g1111, Pf1);\n\n  vec4 fade_xyzw = fade(Pf0);\n  vec4 n_0w = mix(vec4(n0000, n1000, n0100, n1100), vec4(n0001, n1001, n0101, n1101), fade_xyzw.w);\n  vec4 n_1w = mix(vec4(n0010, n1010, n0110, n1110), vec4(n0011, n1011, n0111, n1111), fade_xyzw.w);\n  vec4 n_zw = mix(n_0w, n_1w, fade_xyzw.z);\n  vec2 n_yzw = mix(n_zw.xy, n_zw.zw, fade_xyzw.y);\n  float n_xyzw = mix(n_yzw.x, n_yzw.y, fade_xyzw.x);\n  return 2.2 * n_xyzw;\n}\n\n// Classic Perlin noise, periodic version\nfloat pnoise(vec4 P, vec4 rep)\n{\n  vec4 Pi0 = mod(floor(P), rep); // Integer part modulo rep\n  vec4 Pi1 = mod(Pi0 + 1.0, rep); // Integer part + 1 mod rep\n  Pi0 = mod289(Pi0);\n  Pi1 = mod289(Pi1);\n  vec4 Pf0 = fract(P); // Fractional part for interpolation\n  vec4 Pf1 = Pf0 - 1.0; // Fractional part - 1.0\n  vec4 ix = vec4(Pi0.x, Pi1.x, Pi0.x, Pi1.x);\n  vec4 iy = vec4(Pi0.yy, Pi1.yy);\n  vec4 iz0 = vec4(Pi0.zzzz);\n  vec4 iz1 = vec4(Pi1.zzzz);\n  vec4 iw0 = vec4(Pi0.wwww);\n  vec4 iw1 = vec4(Pi1.wwww);\n\n  vec4 ixy = permute(permute(ix) + iy);\n  vec4 ixy0 = permute(ixy + iz0);\n  vec4 ixy1 = permute(ixy + iz1);\n  vec4 ixy00 = permute(ixy0 + iw0);\n  vec4 ixy01 = permute(ixy0 + iw1);\n  vec4 ixy10 = permute(ixy1 + iw0);\n  vec4 ixy11 = permute(ixy1 + iw1);\n\n  vec4 gx00 = ixy00 * (1.0 / 7.0);\n  vec4 gy00 = floor(gx00) * (1.0 / 7.0);\n  vec4 gz00 = floor(gy00) * (1.0 / 6.0);\n  gx00 = fract(gx00) - 0.5;\n  gy00 = fract(gy00) - 0.5;\n  gz00 = fract(gz00) - 0.5;\n  vec4 gw00 = vec4(0.75) - abs(gx00) - abs(gy00) - abs(gz00);\n  vec4 sw00 = step(gw00, vec4(0.0));\n  gx00 -= sw00 * (step(0.0, gx00) - 0.5);\n  gy00 -= sw00 * (step(0.0, gy00) - 0.5);\n\n  vec4 gx01 = ixy01 * (1.0 / 7.0);\n  vec4 gy01 = floor(gx01) * (1.0 / 7.0);\n  vec4 gz01 = floor(gy01) * (1.0 / 6.0);\n  gx01 = fract(gx01) - 0.5;\n  gy01 = fract(gy01) - 0.5;\n  gz01 = fract(gz01) - 0.5;\n  vec4 gw01 = vec4(0.75) - abs(gx01) - abs(gy01) - abs(gz01);\n  vec4 sw01 = step(gw01, vec4(0.0));\n  gx01 -= sw01 * (step(0.0, gx01) - 0.5);\n  gy01 -= sw01 * (step(0.0, gy01) - 0.5);\n\n  vec4 gx10 = ixy10 * (1.0 / 7.0);\n  vec4 gy10 = floor(gx10) * (1.0 / 7.0);\n  vec4 gz10 = floor(gy10) * (1.0 / 6.0);\n  gx10 = fract(gx10) - 0.5;\n  gy10 = fract(gy10) - 0.5;\n  gz10 = fract(gz10) - 0.5;\n  vec4 gw10 = vec4(0.75) - abs(gx10) - abs(gy10) - abs(gz10);\n  vec4 sw10 = step(gw10, vec4(0.0));\n  gx10 -= sw10 * (step(0.0, gx10) - 0.5);\n  gy10 -= sw10 * (step(0.0, gy10) - 0.5);\n\n  vec4 gx11 = ixy11 * (1.0 / 7.0);\n  vec4 gy11 = floor(gx11) * (1.0 / 7.0);\n  vec4 gz11 = floor(gy11) * (1.0 / 6.0);\n  gx11 = fract(gx11) - 0.5;\n  gy11 = fract(gy11) - 0.5;\n  gz11 = fract(gz11) - 0.5;\n  vec4 gw11 = vec4(0.75) - abs(gx11) - abs(gy11) - abs(gz11);\n  vec4 sw11 = step(gw11, vec4(0.0));\n  gx11 -= sw11 * (step(0.0, gx11) - 0.5);\n  gy11 -= sw11 * (step(0.0, gy11) - 0.5);\n\n  vec4 g0000 = vec4(gx00.x,gy00.x,gz00.x,gw00.x);\n  vec4 g1000 = vec4(gx00.y,gy00.y,gz00.y,gw00.y);\n  vec4 g0100 = vec4(gx00.z,gy00.z,gz00.z,gw00.z);\n  vec4 g1100 = vec4(gx00.w,gy00.w,gz00.w,gw00.w);\n  vec4 g0010 = vec4(gx10.x,gy10.x,gz10.x,gw10.x);\n  vec4 g1010 = vec4(gx10.y,gy10.y,gz10.y,gw10.y);\n  vec4 g0110 = vec4(gx10.z,gy10.z,gz10.z,gw10.z);\n  vec4 g1110 = vec4(gx10.w,gy10.w,gz10.w,gw10.w);\n  vec4 g0001 = vec4(gx01.x,gy01.x,gz01.x,gw01.x);\n  vec4 g1001 = vec4(gx01.y,gy01.y,gz01.y,gw01.y);\n  vec4 g0101 = vec4(gx01.z,gy01.z,gz01.z,gw01.z);\n  vec4 g1101 = vec4(gx01.w,gy01.w,gz01.w,gw01.w);\n  vec4 g0011 = vec4(gx11.x,gy11.x,gz11.x,gw11.x);\n  vec4 g1011 = vec4(gx11.y,gy11.y,gz11.y,gw11.y);\n  vec4 g0111 = vec4(gx11.z,gy11.z,gz11.z,gw11.z);\n  vec4 g1111 = vec4(gx11.w,gy11.w,gz11.w,gw11.w);\n\n  vec4 norm00 = taylorInvSqrt(vec4(dot(g0000, g0000), dot(g0100, g0100), dot(g1000, g1000), dot(g1100, g1100)));\n  g0000 *= norm00.x;\n  g0100 *= norm00.y;\n  g1000 *= norm00.z;\n  g1100 *= norm00.w;\n\n  vec4 norm01 = taylorInvSqrt(vec4(dot(g0001, g0001), dot(g0101, g0101), dot(g1001, g1001), dot(g1101, g1101)));\n  g0001 *= norm01.x;\n  g0101 *= norm01.y;\n  g1001 *= norm01.z;\n  g1101 *= norm01.w;\n\n  vec4 norm10 = taylorInvSqrt(vec4(dot(g0010, g0010), dot(g0110, g0110), dot(g1010, g1010), dot(g1110, g1110)));\n  g0010 *= norm10.x;\n  g0110 *= norm10.y;\n  g1010 *= norm10.z;\n  g1110 *= norm10.w;\n\n  vec4 norm11 = taylorInvSqrt(vec4(dot(g0011, g0011), dot(g0111, g0111), dot(g1011, g1011), dot(g1111, g1111)));\n  g0011 *= norm11.x;\n  g0111 *= norm11.y;\n  g1011 *= norm11.z;\n  g1111 *= norm11.w;\n\n  float n0000 = dot(g0000, Pf0);\n  float n1000 = dot(g1000, vec4(Pf1.x, Pf0.yzw));\n  float n0100 = dot(g0100, vec4(Pf0.x, Pf1.y, Pf0.zw));\n  float n1100 = dot(g1100, vec4(Pf1.xy, Pf0.zw));\n  float n0010 = dot(g0010, vec4(Pf0.xy, Pf1.z, Pf0.w));\n  float n1010 = dot(g1010, vec4(Pf1.x, Pf0.y, Pf1.z, Pf0.w));\n  float n0110 = dot(g0110, vec4(Pf0.x, Pf1.yz, Pf0.w));\n  float n1110 = dot(g1110, vec4(Pf1.xyz, Pf0.w));\n  float n0001 = dot(g0001, vec4(Pf0.xyz, Pf1.w));\n  float n1001 = dot(g1001, vec4(Pf1.x, Pf0.yz, Pf1.w));\n  float n0101 = dot(g0101, vec4(Pf0.x, Pf1.y, Pf0.z, Pf1.w));\n  float n1101 = dot(g1101, vec4(Pf1.xy, Pf0.z, Pf1.w));\n  float n0011 = dot(g0011, vec4(Pf0.xy, Pf1.zw));\n  float n1011 = dot(g1011, vec4(Pf1.x, Pf0.y, Pf1.zw));\n  float n0111 = dot(g0111, vec4(Pf0.x, Pf1.yzw));\n  float n1111 = dot(g1111, Pf1);\n\n  vec4 fade_xyzw = fade(Pf0);\n  vec4 n_0w = mix(vec4(n0000, n1000, n0100, n1100), vec4(n0001, n1001, n0101, n1101), fade_xyzw.w);\n  vec4 n_1w = mix(vec4(n0010, n1010, n0110, n1110), vec4(n0011, n1011, n0111, n1111), fade_xyzw.w);\n  vec4 n_zw = mix(n_0w, n_1w, fade_xyzw.z);\n  vec2 n_yzw = mix(n_zw.xy, n_zw.zw, fade_xyzw.y);\n  float n_xyzw = mix(n_yzw.x, n_yzw.y, fade_xyzw.x);\n  return 2.2 * n_xyzw;\n}\n'},function(e,t,n){"use strict";n.r(t),t.default="//\n// Description : Array and textureless GLSL 2D simplex noise function.\n//      Author : Ian McEwan, Ashima Arts.\n//  Maintainer : stegu\n//     Lastmod : 20110822 (ijm)\n//     License : Copyright (C) 2011 Ashima Arts. All rights reserved.\n//               Distributed under the MIT License. See LICENSE file.\n//               https://github.com/ashima/webgl-noise\n//               https://github.com/stegu/webgl-noise\n// \n\n\nfloat snoise(vec2 v)\n  {\n  const vec4 C = vec4(0.211324865405187,  // (3.0-sqrt(3.0))/6.0\n                      0.366025403784439,  // 0.5*(sqrt(3.0)-1.0)\n                     -0.577350269189626,  // -1.0 + 2.0 * C.x\n                      0.024390243902439); // 1.0 / 41.0\n// First corner\n  vec2 i  = floor(v + dot(v, C.yy) );\n  vec2 x0 = v -   i + dot(i, C.xx);\n\n// Other corners\n  vec2 i1;\n  //i1.x = step( x0.y, x0.x ); // x0.x > x0.y ? 1.0 : 0.0\n  //i1.y = 1.0 - i1.x;\n  i1 = (x0.x > x0.y) ? vec2(1.0, 0.0) : vec2(0.0, 1.0);\n  // x0 = x0 - 0.0 + 0.0 * C.xx ;\n  // x1 = x0 - i1 + 1.0 * C.xx ;\n  // x2 = x0 - 1.0 + 2.0 * C.xx ;\n  vec4 x12 = x0.xyxy + C.xxzz;\n  x12.xy -= i1;\n\n// Permutations\n  i = mod289(i); // Avoid truncation effects in permutation\n  vec3 p = permute( permute( i.y + vec3(0.0, i1.y, 1.0 ))\n\t\t+ i.x + vec3(0.0, i1.x, 1.0 ));\n\n  vec3 m = max(0.5 - vec3(dot(x0,x0), dot(x12.xy,x12.xy), dot(x12.zw,x12.zw)), 0.0);\n  m = m*m ;\n  m = m*m ;\n\n// Gradients: 41 points uniformly over a line, mapped onto a diamond.\n// The ring size 17*17 = 289 is close to a multiple of 41 (41*7 = 287)\n\n  vec3 x = 2.0 * fract(p * C.www) - 1.0;\n  vec3 h = abs(x) - 0.5;\n  vec3 ox = floor(x + 0.5);\n  vec3 a0 = x - ox;\n\n// Normalise gradients implicitly by scaling m\n// Approximation of: m *= inversesqrt( a0*a0 + h*h );\n  m *= 1.79284291400159 - 0.85373472095314 * ( a0*a0 + h*h );\n\n// Compute final noise value at P\n  vec3 g;\n  g.x  = a0.x  * x0.x  + h.x  * x0.y;\n  g.yz = a0.yz * x12.xz + h.yz * x12.yw;\n  return 130.0 * dot(m, g);\n}\n"},function(e,t,n){"use strict";n.r(t),t.default="//\n// Description : Array and textureless GLSL 2D/3D/4D simplex \n//               noise functions.\n//      Author : Ian McEwan, Ashima Arts.\n//  Maintainer : stegu\n//     Lastmod : 20110822 (ijm)\n//     License : Copyright (C) 2011 Ashima Arts. All rights reserved.\n//               Distributed under the MIT License. See LICENSE file.\n//               https://github.com/ashima/webgl-noise\n//               https://github.com/stegu/webgl-noise\n// \n\n\n\nfloat snoise(vec3 v)\n  { \n  const vec2  C = vec2(1.0/6.0, 1.0/3.0) ;\n  const vec4  D = vec4(0.0, 0.5, 1.0, 2.0);\n\n// First corner\n  vec3 i  = floor(v + dot(v, C.yyy) );\n  vec3 x0 =   v - i + dot(i, C.xxx) ;\n\n// Other corners\n  vec3 g = step(x0.yzx, x0.xyz);\n  vec3 l = 1.0 - g;\n  vec3 i1 = min( g.xyz, l.zxy );\n  vec3 i2 = max( g.xyz, l.zxy );\n\n  //   x0 = x0 - 0.0 + 0.0 * C.xxx;\n  //   x1 = x0 - i1  + 1.0 * C.xxx;\n  //   x2 = x0 - i2  + 2.0 * C.xxx;\n  //   x3 = x0 - 1.0 + 3.0 * C.xxx;\n  vec3 x1 = x0 - i1 + C.xxx;\n  vec3 x2 = x0 - i2 + C.yyy; // 2.0*C.x = 1/3 = C.y\n  vec3 x3 = x0 - D.yyy;      // -1.0+3.0*C.x = -0.5 = -D.y\n\n// Permutations\n  i = mod289(i); \n  vec4 p = permute( permute( permute( \n             i.z + vec4(0.0, i1.z, i2.z, 1.0 ))\n           + i.y + vec4(0.0, i1.y, i2.y, 1.0 )) \n           + i.x + vec4(0.0, i1.x, i2.x, 1.0 ));\n\n// Gradients: 7x7 points over a square, mapped onto an octahedron.\n// The ring size 17*17 = 289 is close to a multiple of 49 (49*6 = 294)\n  float n_ = 0.142857142857; // 1.0/7.0\n  vec3  ns = n_ * D.wyz - D.xzx;\n\n  vec4 j = p - 49.0 * floor(p * ns.z * ns.z);  //  mod(p,7*7)\n\n  vec4 x_ = floor(j * ns.z);\n  vec4 y_ = floor(j - 7.0 * x_ );    // mod(j,N)\n\n  vec4 x = x_ *ns.x + ns.yyyy;\n  vec4 y = y_ *ns.x + ns.yyyy;\n  vec4 h = 1.0 - abs(x) - abs(y);\n\n  vec4 b0 = vec4( x.xy, y.xy );\n  vec4 b1 = vec4( x.zw, y.zw );\n\n  //vec4 s0 = vec4(lessThan(b0,0.0))*2.0 - 1.0;\n  //vec4 s1 = vec4(lessThan(b1,0.0))*2.0 - 1.0;\n  vec4 s0 = floor(b0)*2.0 + 1.0;\n  vec4 s1 = floor(b1)*2.0 + 1.0;\n  vec4 sh = -step(h, vec4(0.0));\n\n  vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;\n  vec4 a1 = b1.xzyw + s1.xzyw*sh.zzww ;\n\n  vec3 p0 = vec3(a0.xy,h.x);\n  vec3 p1 = vec3(a0.zw,h.y);\n  vec3 p2 = vec3(a1.xy,h.z);\n  vec3 p3 = vec3(a1.zw,h.w);\n\n//Normalise gradients\n  vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));\n  p0 *= norm.x;\n  p1 *= norm.y;\n  p2 *= norm.z;\n  p3 *= norm.w;\n\n// Mix final noise value\n  vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);\n  m = m * m;\n  return 42.0 * dot( m*m, vec4( dot(p0,x0), dot(p1,x1), \n                                dot(p2,x2), dot(p3,x3) ) );\n  }\n"},function(e,t,n){"use strict";n.r(t),t.default="//\n// Description : Array and textureless GLSL 2D/3D/4D simplex \n//               noise functions.\n//      Author : Ian McEwan, Ashima Arts.\n//  Maintainer : stegu\n//     Lastmod : 20110822 (ijm)\n//     License : Copyright (C) 2011 Ashima Arts. All rights reserved.\n//               Distributed under the MIT License. See LICENSE file.\n//               https://github.com/ashima/webgl-noise\n//               https://github.com/stegu/webgl-noise\n// \n\n\n\n\n\n\n\nvec4 grad4(float j, vec4 ip)\n  {\n  const vec4 ones = vec4(1.0, 1.0, 1.0, -1.0);\n  vec4 p,s;\n\n  p.xyz = floor( fract (vec3(j) * ip.xyz) * 7.0) * ip.z - 1.0;\n  p.w = 1.5 - dot(abs(p.xyz), ones.xyz);\n  s = vec4(lessThan(p, vec4(0.0)));\n  p.xyz = p.xyz + (s.xyz*2.0 - 1.0) * s.www; \n\n  return p;\n  }\n\t\t\t\t\t\t\n// (sqrt(5) - 1)/4 = F4, used once below\n#define F4 0.309016994374947451\n\nfloat snoise(vec4 v)\n  {\n  const vec4  C = vec4( 0.138196601125011,  // (5 - sqrt(5))/20  G4\n                        0.276393202250021,  // 2 * G4\n                        0.414589803375032,  // 3 * G4\n                       -0.447213595499958); // -1 + 4 * G4\n\n// First corner\n  vec4 i  = floor(v + dot(v, vec4(F4)) );\n  vec4 x0 = v -   i + dot(i, C.xxxx);\n\n// Other corners\n\n// Rank sorting originally contributed by Bill Licea-Kane, AMD (formerly ATI)\n  vec4 i0;\n  vec3 isX = step( x0.yzw, x0.xxx );\n  vec3 isYZ = step( x0.zww, x0.yyz );\n//  i0.x = dot( isX, vec3( 1.0 ) );\n  i0.x = isX.x + isX.y + isX.z;\n  i0.yzw = 1.0 - isX;\n//  i0.y += dot( isYZ.xy, vec2( 1.0 ) );\n  i0.y += isYZ.x + isYZ.y;\n  i0.zw += 1.0 - isYZ.xy;\n  i0.z += isYZ.z;\n  i0.w += 1.0 - isYZ.z;\n\n  // i0 now contains the unique values 0,1,2,3 in each channel\n  vec4 i3 = clamp( i0, 0.0, 1.0 );\n  vec4 i2 = clamp( i0-1.0, 0.0, 1.0 );\n  vec4 i1 = clamp( i0-2.0, 0.0, 1.0 );\n\n  //  x0 = x0 - 0.0 + 0.0 * C.xxxx\n  //  x1 = x0 - i1  + 1.0 * C.xxxx\n  //  x2 = x0 - i2  + 2.0 * C.xxxx\n  //  x3 = x0 - i3  + 3.0 * C.xxxx\n  //  x4 = x0 - 1.0 + 4.0 * C.xxxx\n  vec4 x1 = x0 - i1 + C.xxxx;\n  vec4 x2 = x0 - i2 + C.yyyy;\n  vec4 x3 = x0 - i3 + C.zzzz;\n  vec4 x4 = x0 + C.wwww;\n\n// Permutations\n  i = mod289(i); \n  float j0 = permute( permute( permute( permute(i.w) + i.z) + i.y) + i.x);\n  vec4 j1 = permute( permute( permute( permute (\n             i.w + vec4(i1.w, i2.w, i3.w, 1.0 ))\n           + i.z + vec4(i1.z, i2.z, i3.z, 1.0 ))\n           + i.y + vec4(i1.y, i2.y, i3.y, 1.0 ))\n           + i.x + vec4(i1.x, i2.x, i3.x, 1.0 ));\n\n// Gradients: 7x7x6 points over a cube, mapped onto a 4-cross polytope\n// 7*7*6 = 294, which is close to the ring size 17*17 = 289.\n  vec4 ip = vec4(1.0/294.0, 1.0/49.0, 1.0/7.0, 0.0) ;\n\n  vec4 p0 = grad4(j0,   ip);\n  vec4 p1 = grad4(j1.x, ip);\n  vec4 p2 = grad4(j1.y, ip);\n  vec4 p3 = grad4(j1.z, ip);\n  vec4 p4 = grad4(j1.w, ip);\n\n// Normalise gradients\n  vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));\n  p0 *= norm.x;\n  p1 *= norm.y;\n  p2 *= norm.z;\n  p3 *= norm.w;\n  p4 *= taylorInvSqrt(dot(p4,p4));\n\n// Mix contributions from the five corners\n  vec3 m0 = max(0.6 - vec3(dot(x0,x0), dot(x1,x1), dot(x2,x2)), 0.0);\n  vec2 m1 = max(0.6 - vec2(dot(x3,x3), dot(x4,x4)            ), 0.0);\n  m0 = m0 * m0;\n  m1 = m1 * m1;\n  return 49.0 * ( dot(m0*m0, vec3( dot( p0, x0 ), dot( p1, x1 ), dot( p2, x2 )))\n               + dot(m1*m1, vec2( dot( p3, x3 ), dot( p4, x4 ) ) ) ) ;\n\n  }\n"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(36),r=n(28);class o extends s.BaseNodeGlMathFunctionArg1GlNode{static type(){return"null"}set_lines(e){const t=r.ThreeToGl.any(this.variable_for_input("in")),n=`${this.io.inputs.named_input_connection_points[0].type} ${this.gl_var_name("value")} = ${t}`;e.add_body_lines(this,[n])}}t.NullGlNode=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(34),r=n(5);class o extends r.NodeParamsConfig{}const i=new o;class a extends s.TypedGlNode{constructor(){super(...arguments),this.params_config=i}static type(){return"output"}initialize_node(){super.initialize_node(),this.add_post_dirty_hook("_set_mat_to_recompile",this._set_mat_to_recompile.bind(this))}create_params(){var e;null===(e=this.material_node)||void 0===e||e.assembler_controller.add_output_params(this)}set_lines(e){var t;null===(t=this.material_node)||void 0===t||t.assembler_controller.assembler.set_node_lines_output(this,e)}}t.OutputGlNode=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),r=n(34),o=n(16),i=s.__importDefault(n(21)),a=n(5),_=n(24),c=n(29),l=n(196),u=n(133);class d extends a.NodeParamsConfig{constructor(){super(...arguments),this.name=a.ParamConfig.STRING(""),this.type=a.ParamConfig.INTEGER(o.ConnectionPointTypes.indexOf(o.ConnectionPointType.FLOAT),{menu:{entries:o.ConnectionPointTypes.map((e,t)=>({name:e,value:t}))}}),this.as_color=a.ParamConfig.BOOLEAN(0,{visible_if:{type:o.ConnectionPointTypes.indexOf(o.ConnectionPointType.VEC3)}})}}const h=new d;class p extends r.TypedGlNode{constructor(){super(...arguments),this.params_config=h,this._allow_inputs_created_from_params=!1,this._on_create_set_name_if_none_bound=this._on_create_set_name_if_none.bind(this),this.gl_connections_controller=new u.GlConnectionsController(this)}static type(){return"param"}initialize_node(){this.add_post_dirty_hook("_set_mat_to_recompile",this._set_mat_to_recompile.bind(this)),this.lifecycle.add_on_create_hook(this._on_create_set_name_if_none_bound),this.gl_connections_controller.initialize_node(),this.gl_connections_controller.set_expected_input_types_function(()=>[]),this.gl_connections_controller.set_expected_output_types_function(()=>[o.ConnectionPointTypes[this.pv.type]])}set_lines(e){const t=[],n=o.ConnectionPointTypes[this.pv.type],s=this.uniform_name();t.push(new c.UniformGLDefinition(this,n,s)),e.add_definitions(this,t)}set_param_configs(){const e=o.ConnectionPointTypes[this.pv.type],t=o.ConnectionPointInitValueMap[e];let n=o.ConnectionPointTypeToParamTypeMap[e];this._param_configs_controller=this._param_configs_controller||new l.ParamConfigsController,this._param_configs_controller.reset(),n==_.ParamType.VECTOR3&&this.p.as_color.value&&i.default(t)&&3==t.length?this._param_configs_controller.create_and_push(_.ParamType.COLOR,this.pv.name,t,this.uniform_name()):this._param_configs_controller.create_and_push(n,this.pv.name,t,this.uniform_name())}uniform_name(){const e=this.io.outputs.named_output_connection_points[0];return this.gl_var_name(e.name)}_on_create_set_name_if_none(){""==this.pv.name&&this.p.name.set(this.name)}}t.ParamGlNode=p},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(36),r=n(16);class o extends s.BaseGlMathFunctionGlNode{static type(){return"refract"}initialize_node(){super.initialize_node(),this.gl_connections_controller.set_input_name_function(e=>["I","N","eta"][e]),this.gl_connections_controller.set_output_name_function(e=>"refract"),this.gl_connections_controller.set_expected_input_types_function(this._expected_input_types.bind(this)),this.gl_connections_controller.set_expected_output_types_function(this._expected_output_types.bind(this))}gl_method_name(){return"refract"}_expected_input_types(){const e=this.gl_connections_controller.first_input_connection_type()||r.ConnectionPointType.VEC3;return[e,e,r.ConnectionPointType.FLOAT]}_expected_output_types(){return[this._expected_input_types()[0]]}}t.RefractGlNode=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),r=n(36),o=s.__importDefault(n(95)),i=n(16),a=n(29);class _ extends r.BaseNodeGlMathFunctionArg1GlNode{static type(){return"quat_mult"}initialize_node(){super.initialize_node(),this.gl_connections_controller.set_input_name_function(e=>["quat0","quat1"][e]),this.gl_connections_controller.set_expected_input_types_function(()=>[i.ConnectionPointType.VEC4,i.ConnectionPointType.VEC4]),this.gl_connections_controller.set_expected_output_types_function(()=>[i.ConnectionPointType.VEC4])}gl_method_name(){return"quat_mult"}gl_function_definitions(){return[new a.FunctionGLDefinition(this,i.ConnectionPointType.VEC4,o.default)]}}t.QuatMultGlNode=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),r=n(36),o=s.__importDefault(n(95)),i=n(16),a=n(29);var _;!function(e){e.AXIS="axis",e.ANGLE="angle"}(_||(_={}));const c=[_.AXIS,_.ANGLE],l={[_.AXIS]:[0,0,1],[_.ANGLE]:0};class u extends r.BaseNodeGlMathFunctionArg2GlNode{static type(){return"quat_from_axis_angle"}initialize_node(){super.initialize_node(),this.gl_connections_controller.set_input_name_function(e=>c[e]),this.gl_connections_controller.set_expected_input_types_function(()=>[i.ConnectionPointType.VEC3,i.ConnectionPointType.FLOAT]),this.gl_connections_controller.set_expected_output_types_function(()=>[i.ConnectionPointType.VEC4])}gl_input_default_value(e){return l[e]}gl_method_name(){return"quat_from_axis_angle"}gl_function_definitions(){return[new a.FunctionGLDefinition(this,i.ConnectionPointType.VEC4,o.default)]}}t.QuatFromAxisAngleGlNode=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),r=n(36),o=s.__importDefault(n(95)),i=n(16),a=n(29);class _ extends r.BaseNodeGlMathFunctionArg1GlNode{static type(){return"quat_to_angle"}initialize_node(){super.initialize_node(),this.gl_connections_controller.set_input_name_function(e=>["quat"][e]),this.gl_connections_controller.set_expected_input_types_function(()=>[i.ConnectionPointType.VEC4]),this.gl_connections_controller.set_expected_output_types_function(()=>[i.ConnectionPointType.FLOAT])}gl_method_name(){return"quat_to_angle"}gl_function_definitions(){return[new a.FunctionGLDefinition(this,i.ConnectionPointType.FLOAT,o.default)]}}t.QuatToAngleGlNode=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),r=n(36),o=s.__importDefault(n(95)),i=n(16),a=n(29);class _ extends r.BaseNodeGlMathFunctionArg1GlNode{static type(){return"quat_to_axis"}initialize_node(){super.initialize_node(),this.gl_connections_controller.set_input_name_function(e=>["quat"][e]),this.gl_connections_controller.set_expected_input_types_function(()=>[i.ConnectionPointType.VEC4]),this.gl_connections_controller.set_expected_output_types_function(()=>[i.ConnectionPointType.VEC3])}gl_method_name(){return"quat_to_axis"}gl_function_definitions(){return[new a.FunctionGLDefinition(this,i.ConnectionPointType.VEC3,o.default)]}}t.QuatToAxisGlNode=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(34),r=n(16),o=n(33),i=n(29),a=n(155),_=n(196),c=n(24),l=n(5);class u extends l.NodeParamsConfig{constructor(){super(...arguments),this.name=l.ParamConfig.STRING("ramp"),this.input=l.ParamConfig.FLOAT(0)}}const d=new u;class h extends s.TypedGlNode{constructor(){super(...arguments),this.params_config=d}static type(){return"ramp"}initialize(){super.initialize_node(),this.io.outputs.set_named_output_connection_points([new o.TypedNamedConnectionPoint("val",r.ConnectionPointType.FLOAT)])}set_lines(e){const t=r.ConnectionPointType.FLOAT,n=this._uniform_name(),s=this.gl_var_name("val"),o=new i.UniformGLDefinition(this,r.ConnectionPointType.SAMPLER_2D,n);e.add_definitions(this,[o]);const a=this.variable_for_input(this.p.input.name),_=`${t} ${s} = texture2D(${this._uniform_name()}, vec2(${a}, 0.0)).x`;e.add_body_lines(this,[_])}set_param_configs(){this._param_configs_controller=this._param_configs_controller||new _.ParamConfigsController,this._param_configs_controller.reset(),this._param_configs_controller.create_and_push(c.ParamType.RAMP,this.pv.name,a.RampParam.DEFAULT_VALUE,this._uniform_name())}_uniform_name(){return"ramp_texture_"+this.gl_var_name("val")}}t.RampGlNode=h},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(34),r=n(28),o=n(5),i=n(16),a=n(33);class _ extends o.NodeParamsConfig{constructor(){super(...arguments),this.seed=o.ParamConfig.VECTOR2([1,1])}}const c=new _;class l extends s.TypedGlNode{constructor(){super(...arguments),this.params_config=c}static type(){return"random"}initialize_node(){super.initialize_node(),this.io.outputs.set_named_output_connection_points([new a.TypedNamedConnectionPoint("rand",i.ConnectionPointType.FLOAT)])}set_lines(e){const t=r.ThreeToGl.vector2(this.variable_for_input("vec2")),n=`float ${this.gl_var_name("float")} = rand(${t})`;e.add_body_lines(this,[n])}}t.RandomGlNode=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),r=n(34),o=n(28),i=s.__importDefault(n(754)),a=n(5),_=n(16),c=n(29),l=n(33);class u extends a.NodeParamsConfig{constructor(){super(...arguments),this.rgb=a.ParamConfig.VECTOR3([1,1,1])}}const d=new u;class h extends r.TypedGlNode{constructor(){super(...arguments),this.params_config=d}static type(){return"rgb_to_hsv"}initialize_node(){super.initialize_node(),this.io.outputs.set_named_output_connection_points([new l.TypedNamedConnectionPoint("hsv",_.ConnectionPointType.VEC3)])}set_lines(e){const t=[],n=[];t.push(new c.FunctionGLDefinition(this,_.ConnectionPointType.VEC3,i.default));const s=o.ThreeToGl.vector3(this.variable_for_input("rgb")),r=this.gl_var_name("hsv");n.push(`vec3 ${r} = rgb2hsv(${s})`),e.add_definitions(this,t),e.add_body_lines(this,n)}}t.RgbToHsvGlNode=h},function(e,t,n){"use strict";n.r(t),t.default="// https://stackoverflow.com/questions/15095909/from-rgb-to-hsv-in-opengl-glsl\nvec3 rgb2hsv(vec3 c)\n{\n\tvec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\n\tvec4 p = mix(vec4(c.bg, K.wz), vec4(c.gb, K.xy), step(c.b, c.g));\n\tvec4 q = mix(vec4(p.xyw, c.r), vec4(c.r, p.yzx), step(p.x, c.r));\n\n\tfloat d = q.x - min(q.w, q.y);\n\tfloat e = 1.0e-10;\n\treturn vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);\n}"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),r=n(367),o=s.__importDefault(n(95)),i=n(29),a=n(16);var _;!function(e){e[e.AXIS=0]="AXIS",e[e.QUAT=1]="QUAT"}(_||(_={}));const c=[_.AXIS,_.QUAT],l={[_.AXIS]:"from axis + angle",[_.QUAT]:"from quaternion"},u={[_.AXIS]:["vector","axis","angle"],[_.QUAT]:["vector","quat"]},d={[_.AXIS]:"rotate_with_axis_angle",[_.QUAT]:"rotate_with_quat"},h={[_.AXIS]:[a.ConnectionPointType.VEC3,a.ConnectionPointType.VEC3,a.ConnectionPointType.FLOAT],[_.QUAT]:[a.ConnectionPointType.VEC3,a.ConnectionPointType.VEC4]},p={vector:[0,0,1],axis:[0,1,0]},m=n(5),f=n(28);class g extends m.NodeParamsConfig{constructor(){super(...arguments),this.signature=m.ParamConfig.INTEGER(_.AXIS,{menu:{entries:c.map((e,t)=>({name:l[e],value:t}))}})}}const v=new g;class y extends r.BaseAdaptiveGlNode{constructor(){super(...arguments),this.params_config=v}static type(){return"rotate"}initialize_node(){super.initialize_node(),this.gl_connections_controller.set_expected_input_types_function(this._expected_input_types.bind(this)),this.gl_connections_controller.set_expected_output_types_function(this._expected_output_types.bind(this)),this.gl_connections_controller.set_input_name_function(this._gl_input_name.bind(this))}_gl_input_name(e){const t=c[this.pv.signature];return u[t][e]}gl_input_default_value(e){return p[e]}gl_method_name(){const e=c[this.pv.signature];return d[e]}_expected_input_types(){const e=c[this.pv.signature];return h[e]}_expected_output_types(){return[a.ConnectionPointType.VEC3]}gl_function_definitions(){const e=this._expected_output_types()[0];return[new i.FunctionGLDefinition(this,e,o.default)]}set_lines(e){const t=this.io.outputs.named_output_connection_points[0].type,n=this.io.inputs.named_input_connection_points.map((e,t)=>{const n=e.name;return f.ThreeToGl.any(this.variable_for_input(n))}).join(", "),s=`${t} ${this.gl_var_name(this.gl_connections_controller.output_name(0))} = ${this.gl_method_name()}(${n})`;e.add_body_lines(this,[s]),e.add_definitions(this,this.gl_function_definitions())}}t.RotateGlNode=y},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(36),r=n(28),o=n(16),i=["x","y","z","w"];class a extends s.BaseNodeGlMathFunctionArg1GlNode{static type(){return"round"}set_lines(e){const t=this.io.inputs.named_input_connection_points[0],n=r.ThreeToGl.vector2(this.variable_for_input(t.name)),s=this.io.outputs.named_output_connection_points[0],a=this.gl_var_name(s.name),_=[];if(1==o.ConnectionPointComponentsCountMap[s.type])_.push(`${s.type} ${a} = ${this._simple_line(n)}`);else{const e=i.map(e=>this._simple_line(`${n}.${e}`));_.push(`${s.type} ${a} = ${s.type}(${e.join(",")})`)}e.add_body_lines(this,_)}_simple_line(e){return`sign(${e})*floor(abs(${e})+0.5)`}}t.RoundGlNode=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(34),r=n(134),o=n(33),i=n(16),a=n(28),_=n(29),c=n(196),l=n(24),u=n(5);class d extends u.NodeParamsConfig{constructor(){super(...arguments),this.param_name=u.ParamConfig.STRING("texture_map"),this.default_value=u.ParamConfig.STRING(r.FileCopNode.DEFAULT_NODE_PATH.UV),this.uv=u.ParamConfig.VECTOR2([0,0])}}const h=new d;class p extends s.TypedGlNode{constructor(){super(...arguments),this.params_config=h}static type(){return"texture"}initialize_node(){super.initialize_node(),this.io.outputs.set_named_output_connection_points([new o.TypedNamedConnectionPoint(p.OUTPUT_NAME,i.ConnectionPointType.VEC4)])}set_lines(e){const t=a.ThreeToGl.vector2(this.variable_for_input(this.p.uv.name)),n=this.gl_var_name(p.OUTPUT_NAME),s=this._uniform_name(),r=new _.UniformGLDefinition(this,i.ConnectionPointType.SAMPLER_2D,s),o=`vec4 ${n} = texture2D(${s}, ${t})`;e.add_definitions(this,[r]),e.add_body_lines(this,[o])}set_param_configs(){this._param_configs_controller=this._param_configs_controller||new c.ParamConfigsController,this._param_configs_controller.reset(),this._param_configs_controller.create_and_push(l.ParamType.OPERATOR_PATH,this.pv.param_name,this.pv.default_value,this._uniform_name())}_uniform_name(){return this.gl_var_name(this.pv.param_name)}}t.TextureGlNode=p,p.OUTPUT_NAME="rgba"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(34),r=n(28),o=n(133);var i;!function(e){e.CONDITION="condition",e.IF_TRUE="if_true",e.IF_FALSE="if_false"}(i||(i={}));const a=[i.CONDITION,i.IF_TRUE,i.IF_FALSE],_=n(16);class c extends s.ParamlessTypedGlNode{constructor(){super(...arguments),this.gl_connections_controller=new o.GlConnectionsController(this)}static type(){return"two_way_switch"}initialize_node(){super.initialize_node(),this.gl_connections_controller.initialize_node(),this.gl_connections_controller.set_expected_input_types_function(this._expected_input_types.bind(this)),this.gl_connections_controller.set_expected_output_types_function(this._expected_output_types.bind(this)),this.gl_connections_controller.set_input_name_function(this._gl_input_name.bind(this)),this.gl_connections_controller.set_output_name_function(this._gl_output_name.bind(this))}_gl_input_name(e){return a[e]}_gl_output_name(){return"value"}_expected_input_types(){const e=this.io.connections.input_connection(1)||this.io.connections.input_connection(2),t=e?this.gl_connections_controller.connection_type_from_connection(e):_.ConnectionPointType.FLOAT;return[_.ConnectionPointType.BOOL,t,t]}_expected_output_types(){return[this._expected_input_types()[1]]}set_lines(e){const t=[],n=this.gl_var_name("value"),s=r.ThreeToGl.bool(this.variable_for_input(i.CONDITION)),o=r.ThreeToGl.any(this.variable_for_input(i.IF_TRUE)),a=r.ThreeToGl.any(this.variable_for_input(i.IF_FALSE)),_=this._expected_output_types()[1];t.push(`${_} ${n}`),t.push(`if(${s}){`),t.push(`${n} = ${o}`),t.push("} else {"),t.push(`${n} = ${a}`),t.push("}"),e.add_body_lines(this,t)}}t.TwoWaySwitchGlNode=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3).__importDefault(n(95)),r=n(370),o=n(16),i={start:[0,0,1],end:[1,0,0],up:[0,1,0]};class a extends(r.MathFunctionArg3Factory("vector_align",{in:["start","end","up"],method:"vector_align_with_up",functions:[s.default]})){_expected_input_types(){const e=o.ConnectionPointType.VEC3;return[e,e,e]}_expected_output_types(){return[o.ConnectionPointType.VEC4]}gl_input_default_value(e){return i[e]}}t.VectorAlignGlNode=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3).__importDefault(n(95)),r=n(368),o=n(16),i={start:[0,0,1],end:[1,0,0]};class a extends(r.MathFunctionArg2Factory("vector_angle",{in:["start","end"],method:"vector_angle",functions:[s.default]})){_expected_input_types(){const e=o.ConnectionPointType.VEC3;return[e,e]}_expected_output_types(){return[o.ConnectionPointType.FLOAT]}gl_input_default_value(e){return i[e]}}t.VectorAngleGlNode=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(129),r=n(762),o=n(764),i=n(770),a=n(771),_=n(373),c=n(773),l=n(777),u=n(375);t.MatRegister=class{static run(e){e.register_node(r.MeshBasicMatNode,s.CATEGORY_MAT.MESH),e.register_node(o.MeshBasicBuilderMatNode,s.CATEGORY_MAT.ADVANCED),e.register_node(i.MeshLambertMatNode,s.CATEGORY_MAT.MESH),e.register_node(a.MeshLambertBuilderMatNode,s.CATEGORY_MAT.ADVANCED),e.register_node(_.MeshStandardMatNode,s.CATEGORY_MAT.MESH),e.register_node(c.MeshStandardBuilderMatNode,s.CATEGORY_MAT.ADVANCED),e.register_node(l.PointsMatNode,s.CATEGORY_MAT.POINTS),e.register_node(u.PointsBuilderMatNode,s.CATEGORY_MAT.ADVANCED)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),r=n(56),o=n(0),i=n(68),a=n(5),_=n(197),c=n(105),l=n(116),u=n(117),d=n(118);class h extends(d.TextureAlphaMapParamConfig(u.TextureMapParamConfig(l.SkinningParamConfig(c.SideParamConfig(_.ColorParamConfig(a.NodeParamsConfig)))))){}const p=new h;class m extends i.TypedMatNode{constructor(){super(...arguments),this.params_config=p,this.texture_map_controller=new u.TextureMapController(this,{direct_params:!0}),this.texture_alpha_map_controller=new d.TextureAlphaMapController(this,{direct_params:!0})}static type(){return"mesh_basic"}create_material(){return new r.MeshBasicMaterial({vertexColors:!1,side:o.FrontSide,color:16777215,opacity:1})}initialize_node(){this.params.set_post_create_params_hook(()=>{this.texture_map_controller.initialize_node(),this.texture_alpha_map_controller.initialize_node()})}cook(){return s.__awaiter(this,void 0,void 0,(function*(){_.ColorsController.update(this),c.SideController.update(this),l.SkinningController.update(this),this.texture_map_controller.update(),this.texture_alpha_map_controller.update(),this.set_material(this.material)}))}}t.MeshBasicMatNode=m},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(115);class r extends s.TypedContainer{set_content(e){super.set_content(e)}set_material(e){null!=this._content&&this._content.dispose(),this.set_content(e)}has_material(){return this.has_content()}material(){return this.content()}}t.MaterialContainer=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),r=n(5),o=n(198),i=n(105),a=n(116),_=n(117),c=n(118),l=n(765),u=n(199),d=n(131);class h extends(c.TextureAlphaMapParamConfig(_.TextureMapParamConfig(a.SkinningParamConfig(i.SideParamConfig(o.ColorParamConfig(r.NodeParamsConfig)))))){}const p=new h;class m extends u.TypedBuilderMatNode{constructor(){super(...arguments),this.params_config=p,this.texture_map_controller=new _.TextureMapController(this,{uniforms:!0}),this.texture_alpha_map_controller=new c.TextureAlphaMapController(this,{uniforms:!0})}static type(){return"mesh_basic_builder"}initialize_node(){this.params.set_post_create_params_hook(()=>{this.texture_map_controller.initialize_node(),this.texture_alpha_map_controller.initialize_node()})}_create_assembler_controller(){return new d.GlAssemblerController(this,l.ShaderAssemblerBasic)}cook(){return s.__awaiter(this,void 0,void 0,(function*(){yield this.compile_if_required(),o.ColorsController.update(this),i.SideController.update(this),a.SkinningController.update(this),yield _.TextureMapController.update(this),yield c.TextureAlphaMapController.update(this),this.set_material(this.material)}))}}t.MeshBasicBuilderMatNode=m},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(23),r=n(26),o=n(37),i=n(271);class a extends i.ShaderAssemblerMesh{get _template_shader(){const e=o.ShaderLib.basic;return{vertexShader:e.vertexShader,fragmentShader:e.fragmentShader,uniforms:e.uniforms}}create_material(){const e=this._template_shader,t=new r.ShaderMaterial({lights:!1,uniforms:s.UniformsUtils.clone(e.uniforms),vertexShader:e.vertexShader,fragmentShader:e.fragmentShader});return this._add_custom_materials(t),t}}t.ShaderAssemblerBasic=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(23),r=n(26),o=n(37),i=n(0),a=n(0),_=n(106),c=n(50),l=new Map([[c.ShaderName.VERTEX,"#include <begin_vertex>"],[c.ShaderName.FRAGMENT,"vec4 diffuseColor = vec4( 1.0 );"]]);class u extends _.ShaderAssemblerMaterial{get _template_shader(){const e=o.ShaderLib.distanceRGBA;return{vertexShader:e.vertexShader,fragmentShader:e.fragmentShader,uniforms:e.uniforms}}insert_body_after(e){return l.get(e)}create_material(){const e=this._template_shader;return new r.ShaderMaterial({defines:{DEPTH_PACKING:[i.RGBADepthPacking,a.BasicDepthPacking][0]},uniforms:s.UniformsUtils.clone(e.uniforms),vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})}}t.ShaderAssemblerCustomMeshDistance=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(23),r=n(26),o=n(37),i=n(0),a=n(0),_=n(106),c=n(50),l=new Map([[c.ShaderName.VERTEX,"#include <begin_vertex>"],[c.ShaderName.FRAGMENT,"vec4 diffuseColor = vec4( 1.0 );"]]);class u extends _.ShaderAssemblerMaterial{get _template_shader(){const e=o.ShaderLib.depth;return{vertexShader:e.vertexShader,fragmentShader:e.fragmentShader,uniforms:e.uniforms}}insert_body_after(e){return l.get(e)}create_material(){const e=this._template_shader;return new r.ShaderMaterial({defines:{DEPTH_PACKING:[i.RGBADepthPacking,a.BasicDepthPacking][0]},uniforms:s.UniformsUtils.clone(e.uniforms),vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})}}t.ShaderAssemblerCustomMeshDepth=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),r=n(23),o=n(26),i=n(106),a=s.__importDefault(n(769)),_=s.__importDefault(n(372)),c=n(50),l=new Map([[c.ShaderName.VERTEX,"// INSERT DEFINES"]]),u=new Map([[c.ShaderName.VERTEX,"// INSERT BODY"]]);class d extends i.ShaderAssemblerMaterial{get _template_shader(){return{vertexShader:a.default,fragmentShader:_.default,uniforms:{mNear:{value:0},mFar:{value:10}}}}insert_define_after(e){return l.get(e)}insert_body_after(e){return u.get(e)}create_material(){const e=this._template_shader;return new o.ShaderMaterial({uniforms:r.UniformsUtils.clone(e.uniforms),vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})}}t.ShaderAssemblerCustomMeshDepthDOF=d},function(e,t,n){"use strict";n.r(t),t.default="#include <common>\n\nvarying float vViewZDepth;\n\n// INSERT DEFINES\n\n\n\nvoid main() {\n\n\t// INSERT BODY\n\n\n\t#include <project_vertex>\n\n\tvViewZDepth = - mvPosition.z;\n}"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),r=n(159),o=n(0),i=n(68),a=n(5),_=n(197),c=n(105),l=n(116),u=n(117),d=n(118);class h extends(d.TextureAlphaMapParamConfig(u.TextureMapParamConfig(l.SkinningParamConfig(c.SideParamConfig(_.ColorParamConfig(a.NodeParamsConfig)))))){}const p=new h;class m extends i.TypedMatNode{constructor(){super(...arguments),this.params_config=p,this.texture_map_controller=new u.TextureMapController(this,{direct_params:!0}),this.texture_alpha_map_controller=new d.TextureAlphaMapController(this,{direct_params:!0})}static type(){return"mesh_lambert"}create_material(){return new r.MeshLambertMaterial({vertexColors:!1,side:o.FrontSide,color:16777215,opacity:1})}initialize_node(){this.params.set_post_create_params_hook(()=>{this.texture_map_controller.initialize_node(),this.texture_alpha_map_controller.initialize_node()})}cook(){return s.__awaiter(this,void 0,void 0,(function*(){_.ColorsController.update(this),c.SideController.update(this),l.SkinningController.update(this),this.texture_map_controller.update(),this.texture_alpha_map_controller.update(),this.set_material(this.material)}))}}t.MeshLambertMatNode=m},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),r=n(5),o=n(198),i=n(105),a=n(116),_=n(117),c=n(118),l=n(199),u=n(131),d=n(772);class h extends(c.TextureAlphaMapParamConfig(_.TextureMapParamConfig(a.SkinningParamConfig(i.SideParamConfig(o.ColorParamConfig(r.NodeParamsConfig)))))){}const p=new h;class m extends l.TypedBuilderMatNode{constructor(){super(...arguments),this.params_config=p,this.texture_map_controller=new _.TextureMapController(this,{uniforms:!0}),this.texture_alpha_map_controller=new c.TextureAlphaMapController(this,{uniforms:!0})}static type(){return"mesh_lambert_builder"}initialize_node(){this.params.set_post_create_params_hook(()=>{this.texture_map_controller.initialize_node(),this.texture_alpha_map_controller.initialize_node()})}_create_assembler_controller(){return new u.GlAssemblerController(this,d.ShaderAssemblerLambert)}cook(){return s.__awaiter(this,void 0,void 0,(function*(){yield this.compile_if_required(),o.ColorsController.update(this),i.SideController.update(this),a.SkinningController.update(this),yield _.TextureMapController.update(this),yield c.TextureAlphaMapController.update(this),this.set_material(this.material)}))}}t.MeshLambertBuilderMatNode=m},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(23),r=n(26),o=n(37),i=n(271);class a extends i.ShaderAssemblerMesh{get _template_shader(){const e=o.ShaderLib.lambert;return{vertexShader:e.vertexShader,fragmentShader:e.fragmentShader,uniforms:e.uniforms}}create_material(){const e=this._template_shader,t=new r.ShaderMaterial({lights:!0,uniforms:s.UniformsUtils.clone(e.uniforms),vertexShader:e.vertexShader,fragmentShader:e.fragmentShader});return this._add_custom_materials(t),t}}t.ShaderAssemblerLambert=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),r=n(5),o=n(198),i=n(105),a=n(116),_=n(117),c=n(118),l=n(374),u=n(199),d=n(131),h=n(774),p=n(373);class m extends(l.TextureEnvMapParamConfig(c.TextureAlphaMapParamConfig(_.TextureMapParamConfig(a.SkinningParamConfig(i.SideParamConfig(o.ColorParamConfig(r.NodeParamsConfig))))))){constructor(){super(...arguments),this.metalness=r.ParamConfig.FLOAT(p.SHADER_DEFAULTS.metalness,{cook:!1,callback:(e,t)=>g._update_metalness(e)}),this.roughness=r.ParamConfig.FLOAT(p.SHADER_DEFAULTS.roughness,{cook:!1,callback:(e,t)=>g._update_roughness(e)})}}const f=new m;class g extends u.TypedBuilderMatNode{constructor(){super(...arguments),this.params_config=f,this.texture_map_controller=new _.TextureMapController(this,{uniforms:!0}),this.texture_alpha_map_controller=new c.TextureAlphaMapController(this,{uniforms:!0}),this.texture_env_map_controller=new l.TextureEnvMapController(this,{uniforms:!0,direct_params:!0,define:!1})}static type(){return"mesh_standard_builder"}initialize_node(){this.params.set_post_create_params_hook(()=>{this.texture_map_controller.initialize_node(),this.texture_alpha_map_controller.initialize_node(),this.texture_env_map_controller.initialize_node()})}_create_assembler_controller(){return new d.GlAssemblerController(this,h.ShaderAssemblerStandard)}cook(){return s.__awaiter(this,void 0,void 0,(function*(){yield this.compile_if_required(),o.ColorsController.update(this),i.SideController.update(this),a.SkinningController.update(this),yield _.TextureMapController.update(this),yield c.TextureAlphaMapController.update(this),yield l.TextureEnvMapController.update(this),this._material&&(this._material.uniforms.envMapIntensity.value=this.pv.env_map_intensity,g._update_metalness(this),g._update_roughness(this)),this.set_material(this.material)}))}static _update_metalness(e){e.material.uniforms.metalness.value=e.pv.metalness}static _update_roughness(e){e.material.uniforms.roughness.value=e.pv.roughness}}t.MeshStandardBuilderMatNode=g},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),r=n(23),o=n(26),i=n(37),a=n(271),_=n(157),c=n(194),l=n(195),u=s.__importDefault(n(775)),d=s.__importDefault(n(776)),h=n(50),p=n(24);class m extends a.ShaderAssemblerMesh{is_physical(){return!1}get _template_shader(){const e=this.is_physical()?i.ShaderLib.physical:i.ShaderLib.standard;return{vertexShader:e.vertexShader,fragmentShader:e.fragmentShader,uniforms:e.uniforms}}create_material(){const e=this._template_shader,t={lights:!0,extensions:{derivatives:!0},uniforms:r.UniformsUtils.clone(e.uniforms),vertexShader:e.vertexShader,fragmentShader:e.fragmentShader},n=new o.ShaderMaterial(t);return n.onBeforeCompile=function(e){e.fragmentShader=e.fragmentShader.replace("#include <metalnessmap_fragment>",u.default),e.fragmentShader=e.fragmentShader.replace("#include <roughnessmap_fragment>",d.default)},this._add_custom_materials(n),n}add_output_params(e){_.BaseGlShaderAssembler.add_output_params(e),e.add_param(p.ParamType.FLOAT,"metalness",1),e.add_param(p.ParamType.FLOAT,"roughness",1)}create_shader_configs(){return[new c.ShaderConfig(h.ShaderName.VERTEX,["position","normal","uv"],[]),new c.ShaderConfig(h.ShaderName.FRAGMENT,["color","alpha","metalness","roughness"],[h.ShaderName.VERTEX])]}create_variable_configs(){return _.BaseGlShaderAssembler.create_variable_configs().concat([new l.VariableConfig("metalness",{default:"1.0",prefix:"float POLY_metalness = "}),new l.VariableConfig("roughness",{default:"1.0",prefix:"float POLY_roughness = "})])}}t.ShaderAssemblerStandard=m},function(e,t,n){"use strict";n.r(t),t.default="float metalnessFactor = metalness * POLY_metalness;\n\n#ifdef USE_METALNESSMAP\n\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\n\t// reads channel B, compatible with a combined OcclusionRoughnessMetallic (RGB) texture\n\tmetalnessFactor *= texelMetalness.b;\n\n#endif\n"},function(e,t,n){"use strict";n.r(t),t.default="float roughnessFactor = roughness * POLY_roughness;\n\n#ifdef USE_ROUGHNESSMAP\n\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\n\t// reads channel G, compatible with a combined OcclusionRoughnessMetallic (RGB) texture\n\troughnessFactor *= texelRoughness.g;\n\n#endif\n"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),r=n(71),o=n(0),i=n(68),a=n(197),_=n(105),c=n(5);function l(e){return class extends e{constructor(){super(...arguments),this.size=c.ParamConfig.FLOAT(1),this.size_attenuation=c.ParamConfig.BOOLEAN(1)}}}t.PointsParamConfig=l;class u extends(_.SideParamConfig(a.ColorParamConfig(l(c.NodeParamsConfig)))){}const d=new u;class h extends i.TypedMatNode{constructor(){super(...arguments),this.params_config=d}static type(){return"points"}create_material(){return new r.PointsMaterial({vertexColors:!1,side:o.FrontSide,color:16777215,opacity:1})}cook(){return s.__awaiter(this,void 0,void 0,(function*(){a.ColorsController.update(this),_.SideController.update(this),this.material.size=this.pv.size,this.material.sizeAttenuation=this.pv.size_attenuation,this.set_material(this.material)}))}}t.PointsMatNode=h},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(23),r=n(26),o=n(37),i=n(106),a=n(194),_=n(195),c=n(157),l=n(779),u=n(781),d=n(783),h=n(24),p=n(33),m=n(16),f=n(50),g=new Map([[f.ShaderName.VERTEX,["#include <begin_vertex>","gl_PointSize = size;"]],[f.ShaderName.FRAGMENT,[]]]),v=new Map;v.set(i.CustomMaterialName.DISTANCE,u.ShaderAssemblerCustomPointsDistance),v.set(i.CustomMaterialName.DEPTH,l.ShaderAssemblerCustomPointsDepth),v.set(i.CustomMaterialName.DEPTH_DOF,d.ShaderAssemblerCustomPointsDepthDOF);class y extends i.ShaderAssemblerMaterial{custom_assembler_class_by_custom_name(){return v}get _template_shader(){const e=o.ShaderLib.points;return{vertexShader:e.vertexShader,fragmentShader:e.fragmentShader,uniforms:e.uniforms}}create_material(){const e=this._template_shader,t=new r.ShaderMaterial({transparent:!0,fog:!0,defines:{USE_SIZEATTENUATION:1},uniforms:s.UniformsUtils.clone(e.uniforms),vertexShader:e.vertexShader,fragmentShader:e.fragmentShader});return this._add_custom_materials(t),t}add_output_params(e){c.BaseGlShaderAssembler.add_output_params(e),e.add_param(h.ParamType.FLOAT,"gl_PointSize",1)}create_globals_node_output_connections(){return c.BaseGlShaderAssembler.create_globals_node_output_connections().concat([new p.TypedNamedConnectionPoint("gl_PointCoord",m.ConnectionPointType.VEC2)])}create_shader_configs(){return[new a.ShaderConfig(f.ShaderName.VERTEX,["position","normal","uv","gl_PointSize"],[]),new a.ShaderConfig(f.ShaderName.FRAGMENT,["color","alpha"],[f.ShaderName.VERTEX])]}create_variable_configs(){return c.BaseGlShaderAssembler.create_variable_configs().concat([new _.VariableConfig("gl_PointSize",{default:"1.0",prefix:"gl_PointSize = ",suffix:" * size * 10.0"})])}lines_to_remove(e){return g.get(e)}}t.ShaderAssemblerPoints=y},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),r=n(23),o=n(26),i=n(37),a=n(0),_=n(0),c=n(106),l=s.__importDefault(n(780)),u=n(50),d=new Map([[u.ShaderName.VERTEX,"// INSERT DEFINES"]]),h=new Map([[u.ShaderName.VERTEX,"// INSERT BODY"]]);class p extends c.ShaderAssemblerMaterial{get _template_shader(){const e=i.ShaderLib.depth,t=r.UniformsUtils.clone(e.uniforms);return t.size={value:1},t.scale={value:1},{vertexShader:l.default,fragmentShader:e.fragmentShader,uniforms:t}}insert_define_after(e){return d.get(e)}insert_body_after(e){return h.get(e)}create_material(){const e=this._template_shader;return new o.ShaderMaterial({defines:{USE_SIZEATTENUATION:1,DEPTH_PACKING:[a.RGBADepthPacking,_.BasicDepthPacking][0]},uniforms:r.UniformsUtils.clone(e.uniforms),vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})}}t.ShaderAssemblerCustomPointsDepth=p},function(e,t,n){"use strict";n.r(t),t.default="uniform float size;\nuniform float scale;\n#include <common>\n#include <clipping_planes_pars_vertex>\nvarying float vViewZDepth;\n\n// INSERT DEFINES\n\n\n\nvoid main() {\n\n\t// INSERT BODY\n\n\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\n\tvViewZDepth = - mvPosition.z;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\n}\n\n\n"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),r=n(23),o=n(26),i=n(37),a=n(0),_=n(0),c=n(106),l=s.__importDefault(n(782)),u=n(50),d=new Map([[u.ShaderName.VERTEX,"// INSERT DEFINES"]]),h=new Map([[u.ShaderName.VERTEX,"// INSERT BODY"]]);class p extends c.ShaderAssemblerMaterial{get _template_shader(){const e=i.ShaderLib.distanceRGBA,t=r.UniformsUtils.clone(e.uniforms);return t.size={value:1},t.scale={value:1},{vertexShader:l.default,fragmentShader:e.fragmentShader,uniforms:t}}insert_define_after(e){return d.get(e)}insert_body_after(e){return h.get(e)}create_material(){const e=this._template_shader;return new o.ShaderMaterial({defines:{USE_SIZEATTENUATION:1,DEPTH_PACKING:[a.RGBADepthPacking,_.BasicDepthPacking][0]},uniforms:r.UniformsUtils.clone(e.uniforms),vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})}}t.ShaderAssemblerCustomPointsDistance=p},function(e,t,n){"use strict";n.r(t),t.default="uniform float size;\nuniform float scale;\n#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <clipping_planes_pars_vertex>\nvarying float vViewZDepth;\n\n// INSERT DEFINES\n\n\n\nvoid main() {\n\n\t// INSERT BODY\n\n\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\tvWorldPosition = worldPosition.xyz;\n}\n\n// #define DISTANCE\n// varying vec3 vWorldPosition;\n// #include <common>\n// #include <uv_pars_vertex>\n// #include <displacementmap_pars_vertex>\n// #include <morphtarget_pars_vertex>\n// #include <skinning_pars_vertex>\n// #include <clipping_planes_pars_vertex>\n// void main() {\n// \t#include <uv_vertex>\n// \t#include <skinbase_vertex>\n// \t#ifdef USE_DISPLACEMENTMAP\n// \t\t#include <beginnormal_vertex>\n// \t\t#include <morphnormal_vertex>\n// \t\t#include <skinnormal_vertex>\n// \t#endif\n// \t#include <begin_vertex>\n// \t#include <morphtarget_vertex>\n// \t#include <skinning_vertex>\n// \t#include <displacementmap_vertex>\n// \t#include <project_vertex>\n// \t#include <worldpos_vertex>\n// \t#include <clipping_planes_vertex>\n// \tvWorldPosition = worldPosition.xyz;\n// }\n\n\n"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),r=n(23),o=n(26),i=n(106),a=s.__importDefault(n(784)),_=s.__importDefault(n(372)),c=n(50),l=new Map([[c.ShaderName.VERTEX,"// INSERT DEFINES"]]),u=new Map([[c.ShaderName.VERTEX,"// INSERT BODY"]]);class d extends i.ShaderAssemblerMaterial{get _template_shader(){return{vertexShader:a.default,fragmentShader:_.default,uniforms:{size:{value:1},scale:{value:1},mNear:{value:0},mFar:{value:10}}}}insert_define_after(e){return l.get(e)}insert_body_after(e){return u.get(e)}create_material(){const e=this._template_shader;return new o.ShaderMaterial({depthTest:!0,defines:{USE_SIZEATTENUATION:1},uniforms:r.UniformsUtils.clone(e.uniforms),vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})}}t.ShaderAssemblerCustomPointsDepthDOF=d},function(e,t,n){"use strict";n.r(t),t.default="uniform float size;\nuniform float scale;\n#include <common>\n\nvarying float vViewZDepth;\n\n// INSERT DEFINES\n\n\n\nvoid main() {\n\n\t// INSERT BODY\n\n\n\t#include <project_vertex>\n\n\tvViewZDepth = - mvPosition.z;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\n}\n\n"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(129),r=n(786),o=n(788),i=n(790),a=n(792),_=n(794),c=n(796),l=n(798),u=n(799),d=n(800),h=n(801),p=n(802),m=n(804),f=n(806),g=n(807),v=n(808),y=n(819);t.ObjRegister=class{static run(e){e.register_node(r.AmbientLightObjNode,s.CATEGORY_OBJ.LIGHT),e.register_node(o.AreaLightObjNode,s.CATEGORY_OBJ.LIGHT),e.register_node(i.DirectionalLightObjNode,s.CATEGORY_OBJ.LIGHT),e.register_node(a.HemisphereLightObjNode,s.CATEGORY_OBJ.LIGHT),e.register_node(_.PointLightObjNode,s.CATEGORY_OBJ.LIGHT),e.register_node(c.SpotLightObjNode,s.CATEGORY_OBJ.LIGHT),e.register_node(l.EventsObjNode,s.CATEGORY_OBJ.MANAGER),e.register_node(u.MaterialsObjNode,s.CATEGORY_OBJ.MANAGER),e.register_node(d.CopObjNode,s.CATEGORY_OBJ.MANAGER),e.register_node(h.PostProcessObjNode,s.CATEGORY_OBJ.MANAGER),e.register_node(p.GeoObjNode,s.CATEGORY_OBJ.GEOMETRY),e.register_node(m.NullObjNode,s.CATEGORY_OBJ.GEOMETRY),e.register_node(g.SceneObjNode,s.CATEGORY_OBJ.MISC),e.register_node(v.OrthographicCameraObjNode,s.CATEGORY_OBJ.CAMERA),e.register_node(y.PerspectiveCameraObjNode,s.CATEGORY_OBJ.CAMERA),e.register_node(f.FogObjNode,s.CATEGORY_OBJ.MISC)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(284),r=n(272),o=n(5);class i extends o.NodeParamsConfig{constructor(){super(...arguments),this.color=o.ParamConfig.COLOR([1,1,1]),this.intensity=o.ParamConfig.FLOAT(1)}}const a=new i;class _ extends r.TypedLightObjNode{constructor(){super(...arguments),this.params_config=a}static type(){return"ambient_light"}create_light(){return new s.AmbientLight}initialize_node(){this.io.inputs.set_count(0,1)}update_light_params(){this.light.color=this.pv.color,this.light.intensity=this.pv.intensity}}t.AmbientLightObjNode=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(115);class r extends s.TypedContainer{set_content(e){super.set_content(e)}set_object(e){return this.set_content(e)}has_object(){return this.has_content()}object(){return this.content()}}t.ObjectContainer=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),r=n(285),o=n(789),i=n(200),a=n(84),_=n(5);function c(e){return class extends e{constructor(){super(...arguments),this.color=_.ParamConfig.COLOR([1,1,1]),this.intensity=_.ParamConfig.FLOAT(1,{range:[0,10]}),this.width=_.ParamConfig.FLOAT(1,{range:[0,10]}),this.height=_.ParamConfig.FLOAT(1,{range:[0,10]})}}}t.AreaLightParamConfig=c;class l extends(c(a.TransformedParamConfig(_.NodeParamsConfig))){}const u=new l;class d extends i.BaseLightTransformedObjNode{constructor(){super(...arguments),this.params_config=u}static type(){return"area_light"}create_light(){return new r.RectAreaLight(16777215,1,1,1)}update_light_params(){this.light.color=this.pv.color,this.light.intensity=this.pv.intensity,this.light.width=this.pv.width,this.light.height=this.pv.height}cook(){return s.__awaiter(this,void 0,void 0,(function*(){o.RectAreaLightUniformsLib.initialized||(o.RectAreaLightUniformsLib.init(),o.RectAreaLightUniformsLib.initialized=!0),this.transform_controller.update(),this.update_light_params(),this.update_shadow_params(),this.cook_controller.end_cook()}))}}t.AreaLightObjNode=d},,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(162),r=n(791),o=n(5),i=n(202),a=n(200),_=n(84);function c(e){return class extends e{constructor(){super(...arguments),this.light=o.ParamConfig.FOLDER(),this.color=o.ParamConfig.COLOR([1,1,1]),this.intensity=o.ParamConfig.FLOAT(1),this.distance=o.ParamConfig.FLOAT(100,{range:[0,100]}),this.cast_shadows=o.ParamConfig.BOOLEAN(1),this.shadow_res=o.ParamConfig.VECTOR2([1024,1024]),this.shadow_bias=o.ParamConfig.FLOAT(.001),this.show_helper=o.ParamConfig.BOOLEAN(1),this.helper_size=o.ParamConfig.FLOAT(1,{visible_if:{show_helper:1}})}}}t.DirectionalLightParamConfig=c;class l extends(c(_.TransformedParamConfig(o.NodeParamsConfig))){}const u=new l;class d extends a.BaseLightTransformedObjNode{constructor(){super(...arguments),this.params_config=u,this._helper_controller=new i.HelperController(this,r.DirectionalLightHelper,"DirectionalLightHelper")}static type(){return"directional_light"}initialize_node(){this._helper_controller.initialize_node()}create_light(){const e=new s.DirectionalLight;return e.castShadow=!0,e.shadow.bias=-.001,e.shadow.mapSize.x=1024,e.shadow.mapSize.y=1024,e.shadow.camera.near=.1,this._target_target=e.target,this._target_target.name="DirectionalLight Default Target",this.object.add(this._target_target),e}update_light_params(){this.light.color=this.pv.color,this.light.intensity=this.pv.intensity,this.light.shadow.camera.far=this.pv.distance,this._helper_controller.update()}update_shadow_params(){this.light.castShadow=this.pv.cast_shadows,this.light.shadow.mapSize.copy(this.pv.shadow_res),this.light.shadow.bias=this.pv.shadow_bias,this.light.shadow.camera.updateProjectionMatrix()}}t.DirectionalLightObjNode=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(4),r=n(6),o=n(41),i=n(201),a=n(76);class _ extends i.BaseLightHelper{constructor(){super(...arguments),this._square=new a.Line,this._line_material=new o.LineBasicMaterial({fog:!1})}build_helper(){const e=new r.BufferGeometry;e.setAttribute("position",new s.Float32BufferAttribute([-1,1,0,1,1,0,1,-1,0,-1,-1,0,-1,1,0],3)),this._square.geometry=e,this._square.material=this._line_material,this._square.rotateX(.5*Math.PI),this.object.add(this._square)}update(){this._object.scale.setScalar(this.node.pv.helper_size),this._line_material.color.copy(this.node.light.color)}}t.DirectionalLightHelper=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(286),r=n(793),o=n(272),i=n(5),a=n(202);class _ extends i.NodeParamsConfig{constructor(){super(...arguments),this.sky_color=i.ParamConfig.COLOR([.2,.7,1]),this.ground_color=i.ParamConfig.COLOR([.1,.1,.25]),this.intensity=i.ParamConfig.FLOAT(1),this.position=i.ParamConfig.VECTOR3([0,1,0]),this.show_helper=i.ParamConfig.BOOLEAN(1),this.helper_size=i.ParamConfig.FLOAT(1,{visible_if:{show_helper:1}})}}const c=new _;class l extends o.TypedLightObjNode{constructor(){super(...arguments),this.params_config=c,this._helper_controller=new a.HelperController(this,r.HemisphereLightHelper,"HemisphereLightHelper")}static type(){return"hemisphere_light"}create_light(){return new s.HemisphereLight}initialize_node(){this.io.inputs.set_count(0,1),this._helper_controller.initialize_node()}update_light_params(){this.light.color=this.pv.sky_color,this.light.groundColor=this.pv.ground_color,this.light.position.copy(this.pv.position),this.light.intensity=this.pv.intensity,this._helper_controller.update()}}t.HemisphereLightObjNode=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(7),r=n(203),o=n(4),i=n(42),a=n(1),_=n(201);class c extends _.BaseLightHelper{constructor(){super(...arguments),this._geometry=new r.OctahedronBufferGeometry(1),this._quat=new i.Quaternion,this._default_position=new a.Vector3(0,1,0),this._color1=new s.Color,this._color2=new s.Color}build_helper(){this._geometry.rotateZ(.5*Math.PI),this._material.vertexColors=!0;const e=this._geometry.getAttribute("position"),t=new Float32Array(3*e.count);this._geometry.setAttribute("color",new o.BufferAttribute(t,3)),this._object.geometry=this._geometry,this._object.material=this._material}update(){if(!this.node.pv.position)return;this._object.position.copy(this.node.pv.position).multiplyScalar(-1),this._quat.setFromUnitVectors(this._default_position,this.node.pv.position),this._object.setRotationFromQuaternion(this._quat),this._object.scale.setScalar(this.node.pv.helper_size);const e=this._geometry.getAttribute("color");this._color1.copy(this.node.light.color),this._color2.copy(this.node.light.groundColor);for(let t=0,n=e.count;t<n;t++){const s=t<n/2?this._color1:this._color2;e.setXYZ(t,s.r,s.g,s.b)}e.needsUpdate=!0}}t.HemisphereLightHelper=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(163),r=n(795),o=n(200),i=n(84),a=n(5),_=n(202);class c extends(i.TransformedParamConfig(a.NodeParamsConfig)){constructor(){super(...arguments),this.light=a.ParamConfig.FOLDER(),this.color=a.ParamConfig.COLOR([1,1,1]),this.intensity=a.ParamConfig.FLOAT(1),this.decay=a.ParamConfig.FLOAT(.1),this.distance=a.ParamConfig.FLOAT(100),this.cast_shadows=a.ParamConfig.BOOLEAN(1),this.shadow_res=a.ParamConfig.VECTOR2([1024,1024],{visible_if:{cast_shadows:1}}),this.shadow_bias=a.ParamConfig.FLOAT(.001,{visible_if:{cast_shadows:1}}),this.shadow_near=a.ParamConfig.FLOAT(1,{visible_if:{cast_shadows:1}}),this.shadow_far=a.ParamConfig.FLOAT(100,{visible_if:{cast_shadows:1}}),this.show_helper=a.ParamConfig.BOOLEAN(1),this.helper_size=a.ParamConfig.FLOAT(1,{visible_if:{show_helper:1}})}}const l=new c;class u extends o.BaseLightTransformedObjNode{constructor(){super(...arguments),this.params_config=l,this._helper_controller=new _.HelperController(this,r.PointLightHelper,"PointLightHelper")}static type(){return"point_light"}initialize_node(){this._helper_controller.initialize_node()}create_light(){const e=new s.PointLight;return e.castShadow=!0,e.shadow.bias=-.001,e.shadow.mapSize.x=1024,e.shadow.mapSize.y=1024,e.shadow.camera.near=.1,e}update_light_params(){this.light.color=this.pv.color,this.light.intensity=this.pv.intensity,this.light.decay=this.pv.decay,this.light.distance=this.pv.distance,this._helper_controller.update()}update_shadow_params(){this.light.castShadow=this.pv.cast_shadows,this.light.shadow.mapSize.copy(this.pv.shadow_res),this.light.shadow.camera.near=this.pv.shadow_near,this.light.shadow.camera.far=this.pv.shadow_far,this.light.shadow.bias=this.pv.shadow_bias}}t.PointLightObjNode=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(160),r=n(201);class o extends r.BaseLightHelper{build_helper(){this._object.geometry=new s.SphereBufferGeometry(1,4,2),this._object.material=this._material}update(){this._object.scale.setScalar(this.node.pv.helper_size),this._material.color.copy(this.node.light.color)}}t.PointLightHelper=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(164),r=n(200),o=n(84),i=n(5),a=n(202),_=n(797);class c extends(o.TransformedParamConfig(i.NodeParamsConfig)){constructor(){super(...arguments),this.light=i.ParamConfig.FOLDER(),this.color=i.ParamConfig.COLOR([1,1,1]),this.intensity=i.ParamConfig.FLOAT(1),this.angle=i.ParamConfig.FLOAT(45,{range:[0,180]}),this.penumbra=i.ParamConfig.FLOAT(.1),this.decay=i.ParamConfig.FLOAT(.1,{range:[0,1]}),this.distance=i.ParamConfig.FLOAT(100,{range:[0,100]}),this.cast_shadows=i.ParamConfig.BOOLEAN(1),this.shadow_res=i.ParamConfig.VECTOR2([1024,1024]),this.shadow_bias=i.ParamConfig.FLOAT(.001),this.show_helper=i.ParamConfig.BOOLEAN(1),this.helper_size=i.ParamConfig.FLOAT(1,{visible_if:{show_helper:1}})}}const l=new c;class u extends r.BaseLightTransformedObjNode{constructor(){super(...arguments),this.params_config=l,this._helper_controller=new a.HelperController(this,_.SpotLightHelper,"SpotLightHelper")}static type(){return"spot_light"}initialize_node(){this._helper_controller.initialize_node()}create_light(){const e=new s.SpotLight;return e.castShadow=!0,e.shadow.bias=-.001,e.shadow.mapSize.x=1024,e.shadow.mapSize.y=1024,e.shadow.camera.near=.1,this._target_target=e.target,this._target_target.name="SpotLight Default Target",this.object.add(this._target_target),e}update_light_params(){this.light.color=this.pv.color,this.light.intensity=this.pv.intensity,this.light.angle=this.pv.angle*(Math.PI/180),this.light.penumbra=this.pv.penumbra,this.light.decay=this.pv.decay,this.light.distance=this.pv.distance,this._helper_controller.update()}update_shadow_params(){this.light.castShadow=this.pv.cast_shadows,this.light.shadow.mapSize.copy(this.pv.shadow_res),this.light.shadow.bias=this.pv.shadow_bias}}t.SpotLightObjNode=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(201),r=n(6),o=n(4),i=n(41),a=n(57);class _ extends s.BaseLightHelper{constructor(){super(...arguments),this._cone=new a.LineSegments,this._line_material=new i.LineBasicMaterial({fog:!1})}build_helper(){const e=new r.BufferGeometry,t=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let e=0,n=1,s=32;e<s;e++,n++){const r=e/s*Math.PI*2,o=n/s*Math.PI*2;t.push(Math.cos(r),Math.sin(r),1,Math.cos(o),Math.sin(o),1)}e.setAttribute("position",new o.Float32BufferAttribute(t,3)),this._cone.geometry=e,this._cone.material=this._line_material,this._cone.rotateX(.5*Math.PI),this.object.add(this._cone)}update(){const e=(this.node.light.distance?this.node.light.distance:1e3)*this.node.pv.helper_size,t=e*Math.tan(this.node.light.angle);this._cone.scale.set(t,t,e),this._line_material.color.copy(this.node.light.color)}}t.SpotLightHelper=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(204),r=n(27),o=n(69);class i extends s.BaseManagerObjNode{constructor(){super(...arguments),this.render_order=o.ObjNodeRenderOrder.EVENT,this._children_controller_context=r.NodeContext.EVENT}static type(){return"events"}initialize_node(){var e;null===(e=this.children_controller)||void 0===e||e.init()}create_node(e){return super.create_node(e)}children(){return super.children()}nodes_by_type(e){return super.nodes_by_type(e)}}t.EventsObjNode=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(204),r=n(27),o=n(69);class i extends s.BaseManagerObjNode{constructor(){super(...arguments),this.render_order=o.ObjNodeRenderOrder.MAT,this._children_controller_context=r.NodeContext.MAT}static type(){return"materials"}initialize_node(){var e;null===(e=this.children_controller)||void 0===e||e.init()}create_node(e){return super.create_node(e)}children(){return super.children()}nodes_by_type(e){return super.nodes_by_type(e)}}t.MaterialsObjNode=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(204),r=n(27);class o extends s.BaseManagerObjNode{constructor(){super(...arguments),this._children_controller_context=r.NodeContext.COP}static type(){return"cop"}initialize_node(){var e;null===(e=this.children_controller)||void 0===e||e.init()}create_node(e){return super.create_node(e)}children(){return super.children()}nodes_by_type(e){return super.nodes_by_type(e)}}t.CopObjNode=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(204),r=n(27);class o extends s.BaseManagerObjNode{constructor(){super(...arguments),this._children_controller_context=r.NodeContext.POST}static type(){return"post_process"}initialize_node(){var e;null===(e=this.children_controller)||void 0===e||e.init()}}t.PostProcessObjNode=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(69),r=n(40),o=n(803),i=n(27),a=n(84),_=n(94),c=n(5);class l extends(a.TransformedParamConfig(c.NodeParamsConfig)){constructor(){super(...arguments),this.display=c.ParamConfig.BOOLEAN(1)}}const u=new l;class d extends s.TypedObjNode{constructor(){super(...arguments),this.params_config=u,this.transform_controller=new a.TransformController(this),this._display_node_controller=new o.DisplayNodeController(this),this.flags=new _.FlagsControllerD(this),this._sop_group=this._create_sop_group(),this._children_controller_context=i.NodeContext.SOP,this._on_create_bound=this._on_create.bind(this),this._on_child_add_bound=this._on_child_add.bind(this)}static type(){return"geo"}get display_node_controller(){return this._display_node_controller}_create_sop_group(){return new r.Group}get sop_group(){return this._sop_group}set_sop_group_name(){this._sop_group.name=`${this.full_path()}:sop_group`}initialize_node(){var e;null===(e=this.children_controller)||void 0===e||e.init(),this.lifecycle.add_on_create_hook(this._on_create_bound),this.lifecycle.add_on_child_add_hook(this._on_child_add_bound),this.display_node_controller.initialize_node(),this.transform_controller.initialize_node(),this.object.add(this.sop_group),this.name_controller.add_post_set_full_path_hook(this.set_sop_group_name.bind(this)),this._create_sop_group()}create_object(){return new r.Group}request_display_node(){this.scene.loading_controller.auto_updating}is_display_node_cooking(){if(this.flags.display.active){const e=this._display_node_controller.display_node;return!!e&&e.is_dirty}return!1}create_node(e){return super.create_node(e)}children(){return super.children()}nodes_by_type(e){return super.nodes_by_type(e)}_on_create(){this.create_node("text")}_on_child_add(e){var t,n;this.scene.loading_controller.loaded&&1==this.children().length&&(null===(n=null===(t=e.flags)||void 0===t?void 0:t.display)||void 0===n||n.set(!0))}cook(){this.transform_controller.update(),this.object.visible=this.pv.display,this.cook_controller.end_cook()}}t.GeoObjNode=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),r=n(60);t.DisplayNodeController=class{constructor(e){this.node=e,this._children_uuids_dict={},this._children_length=0,this._request_display_node_container_bound=this.request_display_node_container.bind(this),this._graph_node=new r.CoreGraphNode(e.scene,"DisplayNodeController"),this._graph_node.dirty_controller.add_post_dirty_hook("_request_display_node_container",this._request_display_node_container_bound)}get display_node(){return this._display_node}set_parent_object(e){this._parent_object=e}get parent_object(){return this._parent_object||this.node.object}initialize_node(){this.set_parent_object(this.node.sop_group),this.node.flags.display.add_hook(()=>{this.node.sop_group.visible=this.used_in_scene,this.node.flags.display.active&&this.request_display_node_container()}),this.node.lifecycle.add_on_child_add_hook(e=>{var t,n;this._display_node||null===(n=null===(t=e.flags)||void 0===t?void 0:t.display)||void 0===n||n.set(!0)})}set_display_node(e){return s.__awaiter(this,void 0,void 0,(function*(){if(this._display_node!=e){const t=this._display_node;t&&(t.flags.display.set(!1),this._graph_node.remove_graph_input(t),this.remove_children()),this._display_node=e,this._display_node&&this._graph_node.add_graph_input(this._display_node),this.request_display_node_container()}}))}remove_children(){let e;for(;e=this.parent_object.children.pop();)this.parent_object.remove(e)}get used_in_scene(){return this.node.used_in_scene&&this.node.flags.display.active&&1==this.node.pv.display}request_display_node_container(){return s.__awaiter(this,void 0,void 0,(function*(){if(this.node.scene.loading_controller.loaded&&this.used_in_scene&&this._display_node){const e=(yield this._display_node.request_container()).core_content();if(e){const t=e.objects();let n=t.length!=this._children_length;if(!n)for(let e of t)e.uuid in this._children_uuids_dict||(n=!0);if(n){this.remove_children(),this._children_uuids_dict={};for(let e of t)this.parent_object.add(e),this._children_uuids_dict[e.uuid]=!0;this._children_length=t.length}}else this.remove_children(),this._children_uuids_dict={},this._children_length=0}}))}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(69),r=n(40),o=n(84),i=n(94),a=n(805),_=n(5);class c extends(o.TransformedParamConfig(_.NodeParamsConfig)){}const l=new c;class u extends s.TypedObjNode{constructor(){super(...arguments),this.params_config=l,this.transform_controller=new o.TransformController(this),this.flags=new i.FlagsControllerD(this),this._helper=new a.AxesHelper(1)}static type(){return"null"}create_object(){return new r.Group}initialize_node(){this.transform_controller.initialize_node(),this.object.add(this._helper),this.flags.display.add_hook(()=>{this._helper.visible=this.flags.display.active})}cook(){this.transform_controller.update(),this.cook_controller.end_cook()}}t.NullObjNode=u},,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(69),r=n(287),o=n(288),i={color:new(n(7).Color)(1,1,1),near:0,far:100,density:25e-5},a=n(5),_=n(94);class c extends a.NodeParamsConfig{constructor(){super(...arguments),this.color=a.ParamConfig.COLOR(i.color.toArray()),this.exponential=a.ParamConfig.BOOLEAN(0),this.density=a.ParamConfig.FLOAT(1),this.near=a.ParamConfig.FLOAT(0,{range:[0,100]}),this.far=a.ParamConfig.FLOAT(100,{range:[0,100]})}}const l=new c;class u extends s.TypedObjNode{constructor(){super(...arguments),this.params_config=l,this.flags=new _.FlagsControllerD(this),this.render_order=s.ObjNodeRenderOrder.MANAGER,this._attachable_to_hierarchy=!1}initialize_node(){this._linear_fog=new o.Fog(i.color.getHex(),i.near,i.far),this._linear_fogexp2=new r.FogExp2(i.color.getHex(),i.density)}static type(){return"fog"}cook(){let e;this.pv.exponential?(this._linear_fogexp2.density=this.pv.density,e=this._linear_fogexp2):(this._linear_fog.near=this.pv.near,this._linear_fog.far=this.pv.far,e=this._linear_fog),e.color.copy(this.pv.color),this.scene.default_scene.fog=e,this.cook_controller.end_cook()}}t.FogObjNode=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(69),r=n(55),o=n(5);class i extends o.NodeParamsConfig{constructor(){super(...arguments),this.bg_color=o.ParamConfig.COLOR([0,0,0])}}const a=new i;class _ extends s.TypedObjNode{constructor(){super(...arguments),this.params_config=a}static type(){return"scene"}create_object(){return new r.Scene}initialize_node(){super.initialize_node(),this.io.outputs.set_has_one_output()}cook(){this.cook_controller.end_cook()}}t.SceneObjNode=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(63),r=n(376),o=n(818),i=-.5,a=.5,_=.5,c=-.5,l=n(5),u=n(206),d=n(135),h=n(205),p=n(84);function m(e){return class extends e{constructor(){super(...arguments),this.size=l.ParamConfig.FLOAT(1)}}}t.OrthographicCameraObjParamConfigMixin=m;class f extends(u.CameraPostProcessParamConfig(d.CameraBackgroundParamConfig(p.TransformedParamConfig(h.LayerParamConfig(m(r.CameraTransformParamConfig(l.NodeParamsConfig))))))){}const g=new f;class v extends r.TypedCameraObjNode{constructor(){super(...arguments),this.params_config=g}get background_controller_constructor(){return o.OrthographicCameraBackgroundController}static type(){return"orthographic_camera"}create_object(){return new s.OrthographicCamera(2*i,2*a,2*_,2*c,r.BASE_CAMERA_DEFAULT.near,r.BASE_CAMERA_DEFAULT.far)}update_camera(){this._update_for_aspect_ratio()}_update_for_aspect_ratio(){if(this._aspect){const e=this.pv.size||1,t=e*this._aspect,n=1;this._object.left=i*t*n,this._object.right=a*t*n,this._object.top=_*e*n,this._object.bottom=c*e*n,this._object.updateProjectionMatrix()}}}t.OrthographicCameraObjNode=v},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),r=n(810),o=n(269);t.ControlsController=class{constructor(e){this.node=e,this._applied_controls_by_element_id={},this._controls_node=null}controls_param(){return this.node.params.has("controls")?this.node.params.get("controls"):null}controls_node(){return s.__awaiter(this,void 0,void 0,(function*(){const e=this.node.p.controls,t=e.raw_input;if(t&&""!=t){e.is_dirty&&(yield e.compute());const t=e.found_node();if(t){if(t instanceof o.CameraOrbitControlsEventNode)return t;this.node.states.error.set("found node is not of a camera control type")}else this.node.states.error.set("no node has been found")}return null}))}update_controls(){return s.__awaiter(this,void 0,void 0,(function*(){const e=yield this.controls_node();e&&this._controls_node!=e&&this.dispose_control_refs(),this._controls_node=e}))}apply_controls(e){return s.__awaiter(this,void 0,void 0,(function*(){const t=yield this.controls_node();if(t){const n=t.controls_id();let s=!1;if(this._applied_controls_by_element_id[e.id]&&this._applied_controls_by_element_id[e.id][n]&&(s=!0),!s){this._applied_controls_by_element_id[e.id]=this._applied_controls_by_element_id[e.id]||{},this._applied_controls_by_element_id[e.id][n]=!0;const s=yield t.apply_controls(this.node.object,e),o=new r.CameraControlsConfig(this.node.graph_node_id,t,s);return t.set_from_camera_node(s,this.node),this.set_controls_events(s),o}}}))}dispose_control_refs(){this._applied_controls_by_element_id={}}dispose_controls(e){return s.__awaiter(this,void 0,void 0,(function*(){delete this._applied_controls_by_element_id[e.id]}))}set_controls_events(e){this.controls_start_listener=()=>{this.on_controls_start(e)},this.controls_end_listener=()=>{this.on_controls_end(e)},e.addEventListener("start",this.controls_start_listener),e.addEventListener("end",this.controls_end_listener)}on_controls_start(e){}on_controls_end(e){if(e.target){const t=e.target.toArray();this.node.params.set_vector3("target",t)}this.node.update_transform_params_from_object()}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.CameraControlsConfig=class{constructor(e,t,n){this._camera_node_id=e,this._controls_node=t,this._controls=n}get camera_node_id(){return this._camera_node_id}get controls(){return this._controls}get controls_node(){return this._controls_node}is_equal(e){return e.camera_node_id==this._camera_node_id&&e.controls_node.graph_node_id==this._controls_node.graph_node_id}}},function(e,t,n){"use strict";n.r(t),n.d(t,"RenderPass",(function(){return r}));var s=n(72),r=function(e,t,n,r,o){s.a.call(this),this.scene=e,this.camera=t,this.overrideMaterial=n,this.clearColor=r,this.clearAlpha=void 0!==o?o:0,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1};r.prototype=Object.assign(Object.create(s.a.prototype),{constructor:r,render:function(e,t,n){var s,r,o,i=e.autoClear;e.autoClear=!1,void 0!==this.overrideMaterial&&(o=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),this.clearColor&&(s=e.getClearColor().getHex(),r=e.getClearAlpha(),e.setClearColor(this.clearColor,this.clearAlpha)),this.clearDepth&&e.clearDepth(),e.setRenderTarget(this.renderToScreen?null:n),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),e.render(this.scene,this.camera),this.clearColor&&e.setClearColor(s,r),void 0!==this.overrideMaterial&&(this.scene.overrideMaterial=o),e.autoClear=i}})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(813);class r extends s.BaseViewer{constructor(e,t,n){super(e,t,n),this._scene=t,this.do_render=!0,this._animate_method=this.animate.bind(this),this._canvas=document.createElement("canvas"),this._canvas.id=`canvas_id_${Math.random()}`.replace(".","_"),this._canvas.style.display="block",this._canvas.style.outline="none",this._container.appendChild(this._canvas),this._container.classList.add("CoreThreejsViewer"),this._container.style.height="100%",this._set_events()}_build(){this._init_display(),this.activate()}dispose(){this._cancel_animate(),this.controls_controller.dispose_controls()}_set_events(){this.events_controller.init(),this.webgl_controller.init(),window.onresize=()=>{this.cameras_controller.on_resize()}}_init_display(){var e;if(!this._canvas)return;this.cameras_controller.compute_size_and_aspect();const t=this.cameras_controller.size;null===(e=this.cameras_controller.camera_node)||void 0===e||e.post_process_controller.create_renderer(this._canvas,t),this.cameras_controller.prepare_current_camera(),this.animate()}animate(){var e;this.do_render&&(this._scene.time_controller.increment_time_if_playing(),this.render(),null===(e=this._controls_controller)||void 0===e||e.update(),this._request_animation_frame_id=requestAnimationFrame(this._animate_method))}_cancel_animate(){var e;this.do_render=!1,this._request_animation_frame_id&&cancelAnimationFrame(this._request_animation_frame_id),this._canvas&&(null===(e=this.cameras_controller.camera_node)||void 0===e||e.post_process_controller.delete_renderer(this._canvas))}render(){if(this.cameras_controller.camera_node&&this._canvas){const e=this.cameras_controller.size,t=this.cameras_controller.aspect;this.cameras_controller.camera_node.post_process_controller.render(this._canvas,e,t)}else console.warn("no camera to render with")}}t.ThreejsViewer=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),r=n(814),o=n(815),i=n(816),a=n(817);t.BaseViewer=class{constructor(e,t,n){this._container=e,this._scene=t,this._active=!1,this._display_scene=this._scene.default_scene,this._init_from_scene(n).then(()=>{this._build()})}get active(){return this._active}activate(){this._active=!0}deactivate(){this._active=!1}get cameras_controller(){return this._cameras_controller=this._cameras_controller||new r.CamerasController(this)}get controls_controller(){return this._controls_controller=this._controls_controller||new o.ControlsController(this)}get events_controller(){return this._events_controller=this._events_controller||new i.EventsController(this)}get webgl_controller(){return this._webgl_controller=this._webgl_controller||new a.WebGLController(this)}get container(){return this._container}get scene(){return this._scene}get canvas(){return this._canvas}_init_from_scene(e){return s.__awaiter(this,void 0,void 0,(function*(){yield this.cameras_controller.set_camera_node(e||this._scene.cameras_controller.master_camera_node)}))}reset_container_class(){this.container.classList.remove("hovered")}set_container_class_hovered(){this.container.classList.add("hovered")}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),r=n(2),o=n(60);t.CamerasController=class{constructor(e){this.viewer=e,this._camera_node=null,this._size=new r.Vector2(100,100),this._aspect=1}set_camera_node(e){return s.__awaiter(this,void 0,void 0,(function*(){this._camera_node&&e.graph_node_id==this._camera_node.graph_node_id||(this._camera_node=e,this._update_graph_node(),yield this.viewer.controls_controller.create_controls())}))}_update_graph_node(){if(!this._camera_node)return;const e=this._camera_node.params.get_operator_path("controls");e&&(this._graph_node=this._graph_node||this._create_graph_node(),this._graph_node&&(this._graph_node.graph_disconnect_predecessors(),this._graph_node.add_graph_input(e)))}_create_graph_node(){if(!this._camera_node)return;const e=new o.CoreGraphNode(this._camera_node.scene,"viewer-controls");return e.add_post_dirty_hook("this.viewer.controls_controller",()=>s.__awaiter(this,void 0,void 0,(function*(){yield this.viewer.controls_controller.create_controls()}))),e}get camera_node(){return this._camera_node}get size(){return this._size}get aspect(){return this._aspect}on_resize(){var e;this.viewer.canvas&&(this.compute_size_and_aspect(),null===(e=this._camera_node)||void 0===e||e.post_process_controller.set_renderer_size(this.viewer.canvas,this._size),this.update_camera_aspect())}compute_size_and_aspect(){var e;this._update_size(),null===(e=this._camera_node)||void 0===e||e.scene.uniforms_controller.update_resolution_dependent_uniform_owners(this._size),this._aspect=this._get_aspect()}_update_size(){this._size.x=this.viewer.container.offsetWidth,this._size.y=this.viewer.container.offsetHeight}_get_aspect(){return this._size.x/this._size.y}update_camera_aspect(){var e;null===(e=this._camera_node)||void 0===e||e.setup_for_aspect_ratio(this._aspect)}prepare_current_camera(){return s.__awaiter(this,void 0,void 0,(function*(){this._camera_node&&(yield this._camera_node.request_container(),yield this._update_from_camera_container())}))}_update_from_camera_container(){return s.__awaiter(this,void 0,void 0,(function*(){this.update_camera_aspect(),yield this.viewer.controls_controller.create_controls()}))}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3);t.ControlsController=class{constructor(e){this.viewer=e,this._active=!1,this._controls=null,this._bound_on_controls_start=this._on_controls_start.bind(this),this._bound_on_controls_end=this._on_controls_end.bind(this)}get active(){return this._active}get camera_node(){return this.viewer.cameras_controller.camera_node}get controls(){return this._controls}create_controls(){var e;return s.__awaiter(this,void 0,void 0,(function*(){if(this.dispose_controls(),!this.viewer.canvas)return;const t=yield null===(e=this.camera_node)||void 0===e?void 0:e.controls_controller.apply_controls(this.viewer.canvas);t&&(this._controls=t.controls,this._controls&&(this.viewer.active?(this._controls.addEventListener("start",this._bound_on_controls_start),this._controls.addEventListener("end",this._bound_on_controls_end)):this.dispose_controls()))}))}update(){this._controls&&this._controls.update()}dispose_controls(){var e;this._controls&&(this.viewer.canvas&&(null===(e=this.camera_node)||void 0===e||e.controls_controller.dispose_controls(this.viewer.canvas)),this._bound_on_controls_start&&this._controls.removeEventListener("start",this._bound_on_controls_start),this._bound_on_controls_end&&this._controls.removeEventListener("end",this._bound_on_controls_end),this._controls.dispose(),this._controls=null)}_on_controls_start(){this._active=!0}_on_controls_end(){this._active=!1}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.EventsController=class{constructor(e){this.viewer=e,this._bound_on_mousedown=this._on_mousedown.bind(this),this._bound_on_mousemove=this._on_mousemove.bind(this),this._bound_on_mouseup=this._on_mouseup.bind(this)}get camera_node(){return this.viewer.cameras_controller.camera_node}get canvas(){return this.viewer.canvas}init(){this.canvas&&(this._bound_on_mousedown&&this.canvas.removeEventListener("mousedown",this._bound_on_mousedown),this._bound_on_mousemove&&this.canvas.removeEventListener("mousemove",this._bound_on_mousemove),this._bound_on_mouseup&&this.canvas.removeEventListener("mouseup",this._bound_on_mouseup),this._bound_on_mousedown=this._bound_on_mousedown||this._on_mousedown.bind(this),this._bound_on_mousemove=this._bound_on_mousemove||this._on_mousemove.bind(this),this._bound_on_mouseup=this._bound_on_mouseup||this._on_mouseup.bind(this),this.canvas.addEventListener("mousedown",this._bound_on_mousedown),this.canvas.addEventListener("mousemove",this._bound_on_mousemove),this.canvas.addEventListener("mouseup",this._bound_on_mouseup),this.canvas.addEventListener("touchstart",this._bound_on_mousedown,!1),this.canvas.addEventListener("touchmove",this._bound_on_mousemove,!1),this.canvas.addEventListener("touchend",this._bound_on_mouseup,!1),this.canvas.addEventListener("touchcancel",this._bound_on_mouseup,!1))}_on_mousedown(e){this.viewer.scene.events_controller.process_event(e,this.canvas,this.camera_node)}_on_mousemove(e){this.viewer.scene.events_controller.process_event(e,this.canvas,this.camera_node)}_on_mouseup(e){this.viewer.scene.events_controller.process_event(e,this.canvas,this.camera_node)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.WebGLController=class{constructor(e){this.viewer=e}init(){const e=this.viewer.canvas;e&&(e.onwebglcontextlost=this._on_webglcontextlost.bind(this),e.onwebglcontextrestored=this._on_webglcontextrestored.bind(this))}_on_webglcontextlost(){console.warn("context lost at frame",this.viewer.scene.frame),this.request_animation_frame_id?cancelAnimationFrame(this.request_animation_frame_id):console.warn("request_animation_frame_id not initialized"),console.warn("not canceled",this.request_animation_frame_id)}_on_webglcontextrestored(){console.log("context restored")}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),r=n(135),o=s.__importDefault(n(154));class i extends r.BaseBackgroundController{update_screen_quad(){const e=this.screen_quad;let t=this.node.params.float("size"),n=t;const s=this.node.params.float("far");!s||o.default(t)||o.default(n)||(e.scale.x=t,e.scale.y=n,e.position.z=-.9999*s)}}t.OrthographicCameraBackgroundController=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(46),r=n(376),o=n(820),i=50,a=n(5),_=n(206),c=n(135),l=n(205),u=n(84);function d(e){return class extends e{constructor(){super(...arguments),this.fov=a.ParamConfig.FLOAT(i,{range:[0,100]})}}}t.PerspectiveCameraObjParamConfigMixin=d;class h extends(_.CameraPostProcessParamConfig(c.CameraBackgroundParamConfig(u.TransformedParamConfig(l.LayerParamConfig(d(r.CameraTransformParamConfig(a.NodeParamsConfig))))))){}const p=new h;class m extends r.TypedCameraObjNode{constructor(){super(...arguments),this.params_config=p}static type(){return"perspective_camera"}get background_controller_constructor(){return o.PerspectiveCameraBackgroundController}create_object(){return new s.PerspectiveCamera(i,1,r.BASE_CAMERA_DEFAULT.near,r.BASE_CAMERA_DEFAULT.far)}update_camera(){this._object.fov!=this.pv.fov&&(this._object.fov=this.pv.fov,this._object.updateProjectionMatrix()),this._update_for_aspect_ratio()}_update_for_aspect_ratio(){this._aspect&&(this._object.aspect=this._aspect,this._object.updateProjectionMatrix())}}t.PerspectiveCameraObjNode=m},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),r=n(135),o=n(1),i=s.__importDefault(n(154)),a=s.__importDefault(n(207)),_={bl:{x:-1,y:-1},br:{x:1,y:-1},tl:{x:-1,y:1},tr:{x:1,y:1}},c=["bl","br","tl","tr"];class l extends r.BaseBackgroundController{constructor(){super(...arguments),this._bg_corner={bl:new o.Vector3,br:new o.Vector3,tl:new o.Vector3,tr:new o.Vector3},this._bg_center=new o.Vector3}update_screen_quad(){const e=this.screen_quad;for(let e of c)this._update_corner_vector(this._bg_corner[e],_[e]);let t=this._bg_corner.bl.distanceTo(this._bg_corner.br),n=this._bg_corner.bl.distanceTo(this._bg_corner.tl);this._bg_center.x=a.default(c.map(e=>this._bg_corner[e].x))/4,this._bg_center.y=a.default(c.map(e=>this._bg_corner[e].y))/4,this._bg_center.z=a.default(c.map(e=>this._bg_corner[e].z))/4;const s=this.node.params.float("far"),r=this.node.params.float("background_ratio");if(s&&!i.default(t)&&!i.default(n)){const o=s/this._bg_center.distanceTo(this.node.object.position),i=r||1;n=t>n?t/i:t*i,e.scale.x=t*o,e.scale.y=n*o,e.position.z=-.9999*s}}_update_corner_vector(e,t){this._bg_raycaster.setFromCamera(t,this.node.object),e.copy(this._bg_raycaster.ray.direction).multiplyScalar(this.node.params.float("far")).add(this._bg_raycaster.ray.origin)}}t.PerspectiveCameraBackgroundController=l},,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(129),r=n(823),o=n(827),i=n(828),a=n(829),_=n(830),c=n(831),l=n(832),u=n(833),d=n(836),h=n(837),p=n(838),m=n(839),f=n(843),g=n(844),v=n(845),y=n(846),b=n(847),x=n(848),T=n(849),C=n(851),P=n(852),w=n(854),E=n(856),O=n(857),A=n(858),N=n(859),M=n(860),S=n(863),R=n(864),j=n(866),L=n(867),k=n(868),G=n(869),z=n(870),I=n(871),D=n(872),F=n(873),B=n(875),V=n(876),U=n(877),q=n(878),$=n(971),Y=n(980),H=n(981),X=n(982),W=n(983),J=n(984),K=n(985),Z=n(986),Q=n(987),ee=n(988),te=n(990),ne=n(991),se=n(992),re=n(996),oe=n(997),ie=n(998),ae=n(999),_e=n(1e3);t.SopRegister=class{static run(e){e.register_node(r.AddSopNode,s.CATEGORY_SOP.INPUT),e.register_node(o.AnimationCopySopNode,s.CATEGORY_SOP.ANIMATION),e.register_node(i.AnimationMixerSopNode,s.CATEGORY_SOP.ANIMATION),e.register_node(a.AttribAddMultSopNode,s.CATEGORY_SOP.ATTRIBUTE),e.register_node(_.AttribCopySopNode,s.CATEGORY_SOP.ATTRIBUTE),e.register_node(c.AttribCreateSopNode,s.CATEGORY_SOP.ATTRIBUTE),e.register_node(l.AttribDeleteSopNode,s.CATEGORY_SOP.ATTRIBUTE),e.register_node(u.AttribNormalizeSopNode,s.CATEGORY_SOP.ATTRIBUTE),e.register_node(d.AttribPromoteSopNode,s.CATEGORY_SOP.ATTRIBUTE),e.register_node(h.AttribRemapSopNode,s.CATEGORY_SOP.ATTRIBUTE),e.register_node(p.AttribRenameSopNode,s.CATEGORY_SOP.ATTRIBUTE),e.register_node(m.AttribTransferSopNode,s.CATEGORY_SOP.ATTRIBUTE),e.register_node(f.BboxScatterSopNode,s.CATEGORY_SOP.MODIFIER),e.register_node(g.BlendSopNode,s.CATEGORY_SOP.MODIFIER),e.register_node(v.BoxSopNode,s.CATEGORY_SOP.PRIMITIVES),e.register_node(y.CacheSopNode,s.CATEGORY_SOP.MISC),e.register_node(x.CodeSopNode,s.CATEGORY_SOP.ADVANCED),e.register_node(b.CircleSopNode,s.CATEGORY_SOP.PRIMITIVES),e.register_node(T.ColorSopNode,s.CATEGORY_SOP.MODIFIER),e.register_node(C.ConeSopNode,s.CATEGORY_SOP.PRIMITIVES),e.register_node(P.CopySopNode,s.CATEGORY_SOP.MODIFIER),e.register_node(w.DataSopNode,s.CATEGORY_SOP.INPUT),e.register_node(E.DataUrlSopNode,s.CATEGORY_SOP.INPUT),e.register_node(O.DelaySopNode,s.CATEGORY_SOP.MISC),e.register_node(A.DeleteSopNode,s.CATEGORY_SOP.MODIFIER),e.register_node(N.FaceSopNode,s.CATEGORY_SOP.MODIFIER),e.register_node(M.FileSopNode,s.CATEGORY_SOP.INPUT),e.register_node(S.FuseSopNode,s.CATEGORY_SOP.MODIFIER),e.register_node(R.HexagonsSopNode,s.CATEGORY_SOP.PRIMITIVES),e.register_node(j.HierarchySopNode,s.CATEGORY_SOP.MISC),e.register_node(L.InstanceSopNode,s.CATEGORY_SOP.RENDER),e.register_node(k.JitterSopNode,s.CATEGORY_SOP.MODIFIER),e.register_node(G.LayerSopNode,s.CATEGORY_SOP.MODIFIER),e.register_node(z.LineSopNode,s.CATEGORY_SOP.PRIMITIVES),e.register_node(I.MaterialSopNode,s.CATEGORY_SOP.RENDER),e.register_node(D.MergeSopNode,s.CATEGORY_SOP.MISC),e.register_node(F.NoiseSopNode,s.CATEGORY_SOP.MISC),e.register_node(B.NormalsSopNode,s.CATEGORY_SOP.MODIFIER),e.register_node(V.NullSopNode,s.CATEGORY_SOP.MODIFIER),e.register_node(U.ObjectMergeSopNode,s.CATEGORY_SOP.INPUT),e.register_node(q.OcclusionSopNode,s.CATEGORY_SOP.RENDER),e.register_node($.ParticlesSystemGpuSopNode,s.CATEGORY_SOP.DYNAMICS),e.register_node(Y.PeakSopNode,s.CATEGORY_SOP.MODIFIER),e.register_node(H.PlaneSopNode,s.CATEGORY_SOP.PRIMITIVES),e.register_node(X.PointSopNode,s.CATEGORY_SOP.MODIFIER),e.register_node(W.PolywireSopNode,s.CATEGORY_SOP.MODIFIER),e.register_node(J.RaySopNode,s.CATEGORY_SOP.MODIFIER),e.register_node(K.ResampleSopNode,s.CATEGORY_SOP.MODIFIER),e.register_node(Z.ScatterSopNode,s.CATEGORY_SOP.MODIFIER),e.register_node(ee.SkinSopNode,s.CATEGORY_SOP.MODIFIER),e.register_node(Q.ShadowsSopNode,s.CATEGORY_SOP.MODIFIER),e.register_node(te.SphereSopNode,s.CATEGORY_SOP.PRIMITIVES),e.register_node(ne.SwitchSopNode,s.CATEGORY_SOP.MISC),e.register_node(se.TextSopNode,s.CATEGORY_SOP.PRIMITIVES),e.register_node(re.TorusSopNode,s.CATEGORY_SOP.PRIMITIVES),e.register_node(oe.TorusKnotSopNode,s.CATEGORY_SOP.PRIMITIVES),e.register_node(ie.TransformSopNode,s.CATEGORY_SOP.MODIFIER),e.register_node(ae.TubeSopNode,s.CATEGORY_SOP.PRIMITIVES),e.register_node(_e.UvProjectSopNode,s.CATEGORY_SOP.MODIFIER)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3).__importDefault(n(208)),r=n(6),o=n(4),i=n(13),a=n(35),_=n(5);class c extends _.NodeParamsConfig{constructor(){super(...arguments),this.create_point=_.ParamConfig.BOOLEAN(1),this.points_count=_.ParamConfig.INTEGER(1,{range:[1,100],range_locked:[!0,!1],visible_if:{create_point:!0}}),this.position=_.ParamConfig.VECTOR3([0,0,0],{visible_if:{create_point:!0}}),this.open=_.ParamConfig.BOOLEAN(0),this.connect_to_last_point=_.ParamConfig.BOOLEAN(0)}}const l=new c;class u extends i.TypedSopNode{constructor(){super(...arguments),this.params_config=l}static type(){return"add"}static displayed_input_names(){return["geometry to create polygons from (optional)"]}initialize_node(){this.io.inputs.set_count(0,1)}cook(e){this._objects=[],this._create_point(),this.set_objects(this._objects)}_create_point(){if(this.pv.create_point){const e=new r.BufferGeometry,t=[];s.default(this.pv.points_count,e=>{this.pv.position.toArray(t,3*e)}),e.setAttribute("position",new o.BufferAttribute(new Float32Array(t),3));const n=this.create_object(e,a.CoreConstant.OBJECT_TYPE.POINTS);this._objects&&this._objects.push(n)}}}t.AddSopNode=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3).__importDefault(n(207)),r=n(1),o=n(2),i=n(98),a=n(379),_=n(104);t.CoreFace=class{constructor(e,t){this._core_geometry=e,this._index=t,this._geometry=this._core_geometry.geometry()}get index(){return this._index}get points(){return this._points=this._points||this._get_points()}_get_points(){var e;const t=(null===(e=this._geometry.index)||void 0===e?void 0:e.array)||[],n=3*this._index;return[new a.CorePoint(this._core_geometry,t[n+0]),new a.CorePoint(this._core_geometry,t[n+1]),new a.CorePoint(this._core_geometry,t[n+2])]}get positions(){return this._positions=this._positions||this._get_positions()}_get_positions(){const e=this.points;return[e[0].position(),e[1].position(),e[2].position()]}get triangle(){return this._triangle=this._triangle||this._get_triangle()}_get_triangle(){const e=this.positions;return new i.Triangle(e[0],e[1],e[2])}get deltas(){return this._deltas=this._deltas||this._get_deltas()}_get_deltas(){return[this.positions[1].clone().sub(this.positions[0]),this.positions[2].clone().sub(this.positions[0])]}get area(){return this.triangle.getArea()}center(e){const t=this.positions;return e.x=(t[0].x+t[1].x+t[2].x)/3,e.y=(t[0].y+t[1].y+t[2].y)/3,e.z=(t[0].z+t[1].z+t[2].z)/3,e}random_position(e){let t=[_.CoreMath.rand_float(e),_.CoreMath.rand_float(6541*e)];return t[0]+t[1]>1&&(t[0]=1-t[0],t[1]=1-t[1]),this.positions[0].clone().add(this.deltas[0].clone().multiplyScalar(t[0])).add(this.deltas[1].clone().multiplyScalar(t[1]))}attrib_value_at_position(e,t){const n=new r.Vector3;this.triangle.getBarycoord(t,n);const s=n.toArray(),o=this._geometry.attributes[e].itemSize,i=this.points.map(t=>t.attrib_value(e));let a,_,c=0;switch(o){case 1:_=0;for(let e of i)_+=e*s[c],c++;a=_;break;default:for(let e of i){const t=e.multiplyScalar(s[c]);_?_.add(t):_=t,c++}a=_}return a}static interpolated_value(e,t,n,i){const a=[t.a,t.b,t.c],_=e.getAttribute("position").array,c=a.map(e=>new r.Vector3(_[3*e+0],_[3*e+1],_[3*e+2])),l=i.itemSize,u=i.array;let d=[];switch(l){case 1:d=a.map(e=>u[e]);break;case 2:d=a.map(e=>new o.Vector2(u[2*e+0],u[2*e+1]));break;case 3:d=a.map(e=>new r.Vector3(u[3*e+0],u[3*e+1],u[3*e+2]))}const h=a.map((e,t)=>n.distanceTo(c[t])),p=s.default([h[0]*h[1],h[0]*h[2],h[1]*h[2]]),m=[h[1]*h[2]/p,h[0]*h[2]/p,h[0]*h[1]/p];let f;switch(l){case 1:f=s.default(a.map((e,t)=>m[t]*d[t]));break;default:var g=a.map((e,t)=>d[t].multiplyScalar(m[t]));f=null;for(let e of g)f?f.add(e):f=e}return f}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(97);t.MonkeyPatcher=class{static patch(e){Object.assign(e,{clone:function(){return new s.InterleavedBufferAttribute(e.data.clone(),e.itemSize,e.offset,e.normalized)}})}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(115),r=n(53);class o extends s.TypedContainer{set_objects(e){}core_content_cloned(){if(this._content)return this._content.clone()}set_content(e){super.set_content(e)}first_object(){if(this._content)return this._content.objects()[0]}first_geometry(){const e=this.first_object();return e?e.geometry:null}objects_count(){return this._content?this._content.objects().length:0}objects_visible_count(){let e=0;return this._content&&(e=this._content.objects().filter(e=>e.visible).length),e}objects_count_by_type(){const e={},t=this._content;if(this._content&&t)for(let n of t.core_objects()){const t=n.human_type();null==e[t]&&(e[t]=0),e[t]+=1}return e}objects_names_by_type(){const e={},t=this._content;if(this._content&&t)for(let n of t.core_objects()){const t=n.human_type();e[t]=e[t]||[],e[t].push(n.name())}return e}vertex_attribute_names(){let e=[];const t=this.first_geometry();return t&&(e=Object.keys(t.attributes)),e}vertex_attribute_sizes_by_name(){let e={};const t=this.first_geometry();return t&&Object.keys(t.attributes).forEach(n=>{const s=t.attributes[n];e[n]=s.itemSize}),e}vertex_attribute_types_by_name(){let e={};const t=this.first_geometry();if(t){const n=new r.CoreGeometry(t);Object.keys(t.attributes).forEach(t=>{e[t]=n.attrib_type(t)})}return e}object_attribute_names(){let e=[];const t=this.first_object();return t&&(e=Object.keys(t.userData.attributes||{})),e}points_count(){return this._content?this._content.points_count():0}bounding_box(){return this._content.bounding_box()}center(){return this._content.center()}size(){return this._content.size()}}t.GeometryContainer=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(13),r=n(5),o=n(17);class i extends r.NodeParamsConfig{}const a=new i;class _ extends s.TypedSopNode{constructor(){super(...arguments),this.params_config=a}static type(){return"animation_copy"}static displayed_input_names(){return["geometry to copy animation to","geometry to copy animation from"]}initialize_node(){this.io.inputs.set_count(2),this.io.inputs.init_inputs_clonable_state([o.InputCloneMode.FROM_NODE,o.InputCloneMode.NEVER])}cook(e){const t=e[0],n=e[1].objects()[0],s=t.objects()[0],r=n.animations;r?(s.animations=r.map(e=>e.clone()),this.set_core_group(t)):this.states.error.set("no animation found")}}t.AnimationCopySopNode=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),r=n(13),o=s.__importDefault(n(21)),i=n(1005),a=n(17),_=n(24),c=n(61),l=n(5);class u extends l.NodeParamsConfig{constructor(){super(...arguments),this.time=l.ParamConfig.FLOAT("$T",{range:[0,10]}),this.prepare=l.ParamConfig.BUTTON(null,{callback:(e,t)=>{h.PARAM_CALLBACK_prepare(e,t)}})}}const d=new u;class h extends r.TypedSopNode{constructor(){super(...arguments),this.params_config=d,this._previous_time=null,this._mixer=null,this._actions_by_name={},this._values_by_param_name={}}static type(){return"animation_mixer"}static displayed_input_names(){return["geometry to be animated"]}initialize_node(){this.io.inputs.set_count(1),this.io.inputs.init_inputs_clonable_state([a.InputCloneMode.FROM_NODE])}cook(e){this._mixer?(this._update_mixer(),this.cook_controller.end_cook()):this.create_mixer(e[0])}create_mixer(e){this._animation_target=e.objects()[0],this._mixer=new i.AnimationMixer(this._animation_target),this._remove_spare_params(),this._actions_by_name={},this._animation_target.animations&&this._animation_target.animations.forEach((e,t)=>{const n=e.name;let s=this._values_by_param_name[n];null==s&&(s=0==t?1:0);const r=this.add_param(_.ParamType.FLOAT,n,s,{spare:!0});if(r){const e=this._values_by_param_name[n];e&&r.set(e)}if(this._mixer){const t=this._mixer.clipAction(e);this._actions_by_name[e.name]=t}}),this.emit(c.NodeEvent.PARAMS_UPDATED),Object.keys(this._actions_by_name).forEach(e=>{this._actions_by_name[e].play()});const t={};this._animation_target.traverse(e=>{const n=e;n.material&&(o.default(n.material)||(t[n.material.uuid]=n.material))}),Object.keys(t).forEach(e=>{const n=t[e];n.skinning=!0,n.morphTargets=!0}),this._previous_time=null,this._update_mixer(),this._update_mixer_weights(),this.set_object(this._animation_target)}_remove_spare_params(){this._values_by_param_name={};const e=this.params.spare_names,t=[];e.forEach(e=>{const n=this.params.get_float(e);n&&(this._values_by_param_name[e]=n.value,t.push(e))}),t.length>0&&this.params.update_params({names_to_delete:t})}_update_mixer(){this.pv.time!=this._previous_time?this._update_mixer_time():this._update_mixer_weights()}_update_mixer_time(){const e=this.pv.time-(this._previous_time||0);this._mixer&&this._mixer.update(e),this._previous_time=this.pv.time}_update_mixer_weights(){for(let e of Object.keys(this._actions_by_name)){const t=this._actions_by_name[e],n=this.params.get_float(e).value;null!=n&&t.setEffectiveWeight(n)}}static PARAM_CALLBACK_prepare(e,t){e.prepare_animation_mixer()}prepare_animation_mixer(){return s.__awaiter(this,void 0,void 0,(function*(){this._mixer=null;const e=yield this.io.inputs.eval_required_input(0);this.create_mixer(e.core_content_cloned()),this.set_dirty()}))}}t.AnimationMixerSopNode=h},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(13),r=n(5),o=n(17);class i extends r.NodeParamsConfig{constructor(){super(...arguments),this.name=r.ParamConfig.STRING(""),this.pre_add=r.ParamConfig.FLOAT(0,{range:[0,1]}),this.mult=r.ParamConfig.FLOAT(1,{range:[0,1]}),this.post_add=r.ParamConfig.FLOAT(0,{range:[0,1]})}}const a=new i;class _ extends s.TypedSopNode{constructor(){super(...arguments),this.params_config=a}static type(){return"attrib_add_mult"}initialize_node(){this.io.inputs.set_count(1),this.io.inputs.init_inputs_clonable_state([o.InputCloneMode.FROM_NODE])}cook(e){const t=e[0],n=t.attrib_names_matching_mask(this.pv.name);for(let e of n){const n=t.geometries();for(let t of n)this._update_attrib(e,t)}this.set_core_group(t)}_update_attrib(e,t){const n=t.getAttribute(e);if(n){const e=n.array,t=this.pv.pre_add,s=this.pv.mult,r=this.pv.post_add;for(let n=0;n<e.length;n++){const o=e[n];e[n]=(o+t)*s+r}this.io.inputs.input_cloned(0)||(n.needsUpdate=!0)}}}t.AttribAddMultSopNode=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(13),r=n(5),o=n(17),i=n(4);class a extends r.NodeParamsConfig{constructor(){super(...arguments),this.name=r.ParamConfig.STRING(""),this.tnew_name=r.ParamConfig.BOOLEAN(0),this.new_name=r.ParamConfig.STRING("",{visible_if:{tnew_name:1}})}}const _=new a;class c extends s.TypedSopNode{constructor(){super(...arguments),this.params_config=_}static type(){return"attrib_copy"}static displayed_input_names(){return["geometry to copy attributes to","geometry to copy attributes from"]}initialize_node(){this.io.inputs.set_count(2),this.io.inputs.init_inputs_clonable_state([o.InputCloneMode.FROM_NODE,o.InputCloneMode.NEVER])}create_params(){}cook(e){const t=e[0],n=e[1],s=n.attrib_names_matching_mask(this.pv.name);for(let e of s)this.copy_vertex_attribute_between_core_groups(t,n,e);return this.set_core_group(t)}copy_vertex_attribute_between_core_groups(e,t,n){const s=t.objects(),r=e.objects();if(r.length>s.length)this.states.error.set("second input does not have enough objects to copy attributes from");else for(let e=0;e<r.length;e++){const t=r[e].geometry,s=r[e].geometry;this.copy_vertex_attribute_between_geometries(t,s,n)}}copy_vertex_attribute_between_geometries(e,t,n){const s=t.getAttribute(n);if(s){const r=s.itemSize,o=t.getAttribute("position").array.length/3,a=e.getAttribute("position").array.length/3;a>o&&this.states.error.set("not enough points in second input");const _=s.array.slice(0,a*r),c=this.pv.tnew_name?this.pv.new_name:n;e.setAttribute(c,new i.Float32BufferAttribute(_,r))}else this.states.error.set(`attribute '${n}' does not exist on second input`)}}t.AttribCopySopNode=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),r=s.__importDefault(n(188)),o=n(13),i=n(35),a=n(114),_=n(17),c=n(5);class l extends c.NodeParamsConfig{constructor(){super(...arguments),this.group=c.ParamConfig.STRING(""),this.class=c.ParamConfig.INTEGER(i.AttribClass.VERTEX,{menu:{entries:i.AttribClassMenuEntries}}),this.type=c.ParamConfig.INTEGER(i.AttribType.NUMERIC,{menu:{entries:i.AttribTypeMenuEntries}}),this.name=c.ParamConfig.STRING("new_attrib"),this.size=c.ParamConfig.INTEGER(1,{range:[1,4],range_locked:[!0,!0],visible_if:{type:i.CoreConstant.ATTRIB_TYPE.NUMERIC}}),this.value1=c.ParamConfig.FLOAT(0,{visible_if:{type:i.CoreConstant.ATTRIB_TYPE.NUMERIC,size:1},expression:{for_entities:!0}}),this.value2=c.ParamConfig.VECTOR2([0,0],{visible_if:{type:i.CoreConstant.ATTRIB_TYPE.NUMERIC,size:2},expression:{for_entities:!0}}),this.value3=c.ParamConfig.VECTOR3([0,0,0],{visible_if:{type:i.CoreConstant.ATTRIB_TYPE.NUMERIC,size:3},expression:{for_entities:!0}}),this.value4=c.ParamConfig.VECTOR4([0,0,0,0],{visible_if:{type:i.CoreConstant.ATTRIB_TYPE.NUMERIC,size:4},expression:{for_entities:!0}}),this.string=c.ParamConfig.STRING("",{visible_if:{type:i.CoreConstant.ATTRIB_TYPE.STRING},expression:{for_entities:!0}})}}const u=new l;class d extends o.TypedSopNode{constructor(){super(...arguments),this.params_config=u,this._x_arrays_by_geometry_uuid={},this._y_arrays_by_geometry_uuid={},this._z_arrays_by_geometry_uuid={},this._w_arrays_by_geometry_uuid={}}static type(){return"attrib_create"}initialize_node(){this.io.inputs.set_count(1),this.io.inputs.init_inputs_clonable_state([_.InputCloneMode.FROM_NODE])}cook(e){const t=e[0];if(this.pv.name&&""!=r.default(this.pv.name))switch(this.pv.class){case i.AttribClass.VERTEX:this.add_point_attribute(t);break;case i.AttribClass.OBJECT:this.add_object_attribute(t)}else this.states.error.set("attribute name is not valid")}add_point_attribute(e){return s.__awaiter(this,void 0,void 0,(function*(){const t=e.core_objects();for(let e=0;e<t.length;e++){const n=t[e];switch(this.pv.type){case i.CoreConstant.ATTRIB_TYPE.NUMERIC:yield this.add_numeric_attribute_to_points(n);break;case i.CoreConstant.ATTRIB_TYPE.STRING:yield this.add_string_attribute_to_points(n)}}this.set_core_group(e)}))}add_object_attribute(e){return s.__awaiter(this,void 0,void 0,(function*(){const t=e.core_objects_from_group(this.pv.group);switch(this.pv.type){case i.CoreConstant.ATTRIB_TYPE.NUMERIC:yield this.add_numeric_attribute_to_object(t);break;case i.CoreConstant.ATTRIB_TYPE.STRING:yield this.add_string_attribute_to_object(t)}this.set_core_group(e)}))}add_numeric_attribute_to_points(e){return s.__awaiter(this,void 0,void 0,(function*(){const t=e.core_geometry(),n=e.points_from_group(this.pv.group),s=[this.p.value1,this.p.value2,this.p.value3,this.p.value4][this.pv.size-1];if(s.has_expression()){t.has_attrib(this.pv.name)||t.add_numeric_attrib(this.pv.name,this.pv.size,s.value);const e=t.geometry(),r=e.getAttribute(this.pv.name).array;if(1==this.pv.size)this.p.value1.expression_controller&&(yield this.p.value1.expression_controller.compute_expression_for_points(n,(e,t)=>{r[e.index*this.pv.size+0]=t}));else{let t=[this.p.value2,this.p.value3,this.p.value4][this.pv.size-2].components;const s=new Array(t.length);let o;const i=[this._x_arrays_by_geometry_uuid,this._y_arrays_by_geometry_uuid,this._z_arrays_by_geometry_uuid,this._w_arrays_by_geometry_uuid];for(let a=0;a<t.length;a++)if(o=t[a],o.has_expression()&&o.expression_controller)s[a]=this._init_array_if_required(e,i[a],n.length),yield o.expression_controller.compute_expression_for_points(n,(e,t)=>{s[a][e.index]=t});else{const e=o.value;for(let t of n)r[t.index*this.pv.size+a]=e}for(let e=0;e<s.length;e++){const t=s[e];if(t)for(let n=0;n<t.length;n++)r[n*this.pv.size+e]=t[n]}}}else e.add_numeric_vertex_attrib(this.pv.name,this.pv.size,s.value)}))}add_numeric_attribute_to_object(e){return s.__awaiter(this,void 0,void 0,(function*(){const t=[this.p.value1,this.p.value2,this.p.value3,this.p.value4][this.pv.size-1];if(t.has_expression())if(1==this.pv.size)this.p.value1.expression_controller&&(yield this.p.value1.expression_controller.compute_expression_for_objects(e,(e,t)=>{e.set_attrib_value(this.pv.name,t)}));else{let t=[this.p.value2,this.p.value3,this.p.value4][this.pv.size-2].components,n={};for(let t of e)n[t.index]=[];for(let s=0;s<t.length;s++){const r=t[s];if(r.has_expression()&&r.expression_controller)yield r.expression_controller.compute_expression_for_objects(e,(e,t)=>{n[e.index][s]=t});else for(let t of e)n[t.index][s]=r.value}for(let t=0;t<e.length;t++){const s=e[t],r=n[s.index];s.set_attrib_value(this.pv.name,r)}}else for(let n of e)n.set_attrib_value(this.pv.name,t.value)}))}add_string_attribute_to_points(e){return s.__awaiter(this,void 0,void 0,(function*(){const t=e.points_from_group(this.pv.group),n=this.p.string,s=[];n.has_expression()&&n.expression_controller?yield n.expression_controller.compute_expression_for_points(t,(e,t)=>{s[e.index]=t}):s.push(n.value);const r=a.CoreAttribute.array_to_indexed_arrays(s);e.core_geometry().set_indexed_attribute(this.pv.name,r.values,r.indices)}))}add_string_attribute_to_object(e){return s.__awaiter(this,void 0,void 0,(function*(){const t=this.p.string;if(t.has_expression()&&t.expression_controller)yield t.expression_controller.compute_expression_for_objects(e,(e,t)=>{e.set_attrib_value(this.pv.name,t)});else for(let n of e)n.set_attrib_value(this.pv.name,t.value)}))}_init_array_if_required(e,t,n){const s=e.uuid,r=t[s];return r?r.length<n&&(t[s]=new Array(n)):t[s]=new Array(n),t[s]}}t.AttribCreateSopNode=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(13),r=n(273),o=n(53),i=n(35),a=n(17),_=n(5);class c extends _.NodeParamsConfig{constructor(){super(...arguments),this.class=_.ParamConfig.INTEGER(i.AttribClass.VERTEX,{menu:{entries:i.AttribClassMenuEntries}}),this.name=_.ParamConfig.STRING("")}}const l=new c;class u extends s.TypedSopNode{constructor(){super(...arguments),this.params_config=l}static type(){return"attrib_delete"}static displayed_input_names(){return["geometry to delete attributes from"]}initialize_node(){this.io.inputs.set_count(1),this.io.inputs.init_inputs_clonable_state([a.InputCloneMode.FROM_NODE])}cook(e){const t=e[0],n=t.attrib_names_matching_mask(this.pv.name);for(let e of n)switch(this.pv.class){case i.AttribClass.VERTEX:this.delete_vertex_attribute(t,e);case i.AttribClass.OBJECT:this.delete_object_attribute(t,e)}this.set_core_group(t)}delete_vertex_attribute(e,t){for(let n of e.objects())n.traverse(e=>{const n=e;if(n.geometry){new o.CoreGeometry(n.geometry).delete_attribute(t)}})}delete_object_attribute(e,t){for(let n of e.objects()){let e=0;n.traverse(n=>{const s=n;new r.CoreObject(s,e).delete_attribute(t),e++})}}}t.AttribDeleteSopNode=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),r=n(13),o=n(1),i=s.__importDefault(n(209)),a=s.__importDefault(n(275)),_=s.__importDefault(n(44)),c=n(17),l=n(5);class u extends l.NodeParamsConfig{constructor(){super(...arguments),this.name=l.ParamConfig.STRING(""),this.change_name=l.ParamConfig.BOOLEAN(!1),this.new_name=l.ParamConfig.STRING("",{visible_if:{change_name:1}})}}const d=new u;class h extends r.TypedSopNode{constructor(){super(...arguments),this.params_config=d}static type(){return"attrib_normalize"}initialize_node(){this.io.inputs.set_count(1),this.io.inputs.init_inputs_clonable_state([c.InputCloneMode.FROM_NODE])}cook(e){const t=e[0];this._normalize_attribute(t),this.set_core_group(t)}_normalize_attribute(e){const t=e.points();if(0===t.length)return;if(""===this.pv.name)return;const n=t[0].attrib_size(this.pv.name),s=t.map(e=>e.attrib_value(this.pv.name));let r,c,l=[];switch(n){case 1:if(r=a.default(s),c=i.default(s),_.default(r)&&_.default(c))for(let e of s){const t=c>r?(e-r)/(c-r):1;l.push(t)}break;case 3:if(r=new o.Vector3(a.default(s.map(e=>e.x)),a.default(s.map(e=>e.y)),a.default(s.map(e=>e.z))),c=new o.Vector3(i.default(s.map(e=>e.x)),i.default(s.map(e=>e.y)),i.default(s.map(e=>e.z))),r instanceof o.Vector3&&c instanceof o.Vector3)for(let e of s){const t=new o.Vector3((e.x-r.x)/(c.x-r.x),(e.y-r.y)/(c.y-r.y),(e.z-r.z)/(c.z-r.z));l.push(t)}}let u=this.pv.name;this.pv.change_name&&(u=this.pv.new_name,e.has_attrib(u)||e.add_numeric_vertex_attrib(u,n,0)),l.forEach((e,n)=>{t[n].set_attrib_value(u,e)})}}t.AttribNormalizeSopNode=h},,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),r=s.__importDefault(n(209)),o=s.__importDefault(n(275)),i=n(17),a=n(13),_=n(35),c=n(49);var l;!function(e){e[e.MIN=0]="MIN",e[e.MAX=1]="MAX",e[e.FIRST_FOUND=3]="FIRST_FOUND"}(l=t.AttribPromoteMode||(t.AttribPromoteMode={}));const u=[{name:"min",value:l.MIN},{name:"max",value:l.MAX},{name:"first_found",value:l.FIRST_FOUND}],d=n(5);class h extends d.NodeParamsConfig{constructor(){super(...arguments),this.class_from=d.ParamConfig.INTEGER(_.AttribClass.VERTEX,{menu:{entries:_.AttribClassMenuEntries}}),this.class_to=d.ParamConfig.INTEGER(_.AttribClass.OBJECT,{menu:{entries:_.AttribClassMenuEntries}}),this.mode=d.ParamConfig.INTEGER(l.MIN,{menu:{entries:u}}),this.name=d.ParamConfig.STRING("")}}const p=new h;class m extends a.TypedSopNode{constructor(){super(...arguments),this.params_config=p,this._values_per_attrib_name={},this._filtered_values_per_attrib_name={}}static type(){return"attrib_promote"}initialize_node(){this.io.inputs.set_count(1),this.io.inputs.init_inputs_clonable_state([i.InputCloneMode.FROM_NODE])}create_params(){}cook(e){this._core_group=e[0],this._values_per_attrib_name={},this._filtered_values_per_attrib_name={};for(let e of this._core_group.core_objects())this._core_object=e,this.find_values(),this.filter_values(),this.set_values();this.set_core_group(this._core_group)}find_values(){const e=c.CoreString.attrib_names(this.pv.name);for(let t of e)switch(this.pv.class_from){case _.AttribClass.VERTEX:return this.find_values_from_points(t);case _.AttribClass.OBJECT:return this.find_values_from_object(t)}}find_values_from_points(e){if(this._core_object){const t=this._core_object.points();this._values_per_attrib_name[e]=t.map(t=>t.attrib_value(e))}}find_values_from_object(e){this._values_per_attrib_name[e]=[],this._core_object&&this._values_per_attrib_name[e].push(this._core_object.attrib_value(e))}filter_values(){const e=Object.keys(this._values_per_attrib_name);for(let t of e){const e=this._values_per_attrib_name[t];switch(this.pv.mode){case l.MIN:this._filtered_values_per_attrib_name[t]=o.default(e);break;case l.MAX:this._filtered_values_per_attrib_name[t]=r.default(e);break;case l.FIRST_FOUND:this._filtered_values_per_attrib_name[t]=e[0]}}}set_values(){const e=Object.keys(this._filtered_values_per_attrib_name);for(let t of e){const e=this._filtered_values_per_attrib_name[t];if(null!=e)switch(this.pv.class_to){case _.AttribClass.VERTEX:this.set_values_to_points(t,e);break;case _.AttribClass.OBJECT:this.set_values_to_object(t,e)}}}set_values_to_points(e,t){if(this._core_group&&this._core_object){if(!this._core_group.has_attrib(e)){const n=1;this._core_group.add_numeric_vertex_attrib(e,n,t)}this._core_object.points().forEach(n=>n.set_attrib_value(e,t))}}set_values_to_object(e,t){var n;null===(n=this._core_object)||void 0===n||n.set_attrib_value(e,t)}}t.AttribPromoteSopNode=m},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),r=s.__importDefault(n(209)),o=s.__importDefault(n(275)),i=s.__importDefault(n(102)),a=s.__importDefault(n(91)),_=s.__importDefault(n(44)),c=n(1),l=n(13),u=n(5);class d extends u.NodeParamsConfig{constructor(){super(...arguments),this.name=u.ParamConfig.STRING(),this.ramp=u.ParamConfig.RAMP(),this.change_name=u.ParamConfig.BOOLEAN(0),this.new_name=u.ParamConfig.STRING("",{visible_if:{change_name:1}})}}const h=new d;class p extends l.TypedSopNode{constructor(){super(...arguments),this.params_config=h}static type(){return"attrib_remap"}initialize_node(){this.io.inputs.set_count(1)}cook(e){const t=e[0];this._remap_attribute(t),this.set_core_group(t)}_remap_attribute(e){const t=e.points();if(0===t.length)return;if(""===this.pv.name)return;const n=t[0].attrib_size(this.pv.name),s=t.map(e=>e.attrib_value(this.pv.name));let l,u,d=new Array(t.length);switch(n){case 1:if(this.pv.only_integer_values){const e=a.default(i.default(s)),t={};e.forEach((e,n)=>t[e]=n),d=s.map(e=>t[e])}else if(l=o.default(s),u=r.default(s),_.default(l)&&_.default(u))for(let e=0;e<s.length;e++){const t=s[e],n=u>l?(t-l)/(u-l):1;d[e]=n}break;case 3:if(l=new c.Vector3(o.default(s.map(e=>e.x)),o.default(s.map(e=>e.y)),o.default(s.map(e=>e.z))),u=new c.Vector3(r.default(s.map(e=>e.x)),r.default(s.map(e=>e.y)),r.default(s.map(e=>e.z))),l instanceof c.Vector3&&u instanceof c.Vector3)for(let e=0;e<s.length;e++){const t=s[e],n=new c.Vector3((t.x-l.x)/(u.x-l.x),(t.y-l.y)/(u.y-l.y),(t.z-l.z)/(u.z-l.z));d[e]=n}}let h=this.pv.name;this.pv.change_name&&(h=this.pv.new_name,e.has_attrib(h)||e.add_numeric_vertex_attrib(h,n,0)),d.forEach((e,n)=>{t[n].set_attrib_value(h,e)})}}t.AttribRemapSopNode=p},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(13),r=n(5),o=n(35),i=n(17);class a extends r.NodeParamsConfig{constructor(){super(...arguments),this.class=r.ParamConfig.INTEGER(o.AttribClass.VERTEX,{menu:{entries:o.AttribClassMenuEntries}}),this.old_name=r.ParamConfig.STRING(),this.new_name=r.ParamConfig.STRING()}}const _=new a;class c extends s.TypedSopNode{constructor(){super(...arguments),this.params_config=_}static type(){return"attrib_rename"}initialize_node(){this.io.inputs.set_count(1),this.io.inputs.init_inputs_clonable_state([i.InputCloneMode.FROM_NODE])}cook(e){const t=e[0];t.rename_attrib(this.pv.old_name,this.pv.new_name,this.pv.class),this.set_core_group(t)}}t.AttribRenameSopNode=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),r=n(13),o=n(840),i=n(841),a=n(382),_=n(5),c=n(17);class l extends _.NodeParamsConfig{constructor(){super(...arguments),this.src_group=_.ParamConfig.STRING(),this.dest_group=_.ParamConfig.STRING(),this.name=_.ParamConfig.STRING(),this.max_samples_count=_.ParamConfig.INTEGER(1,{range:[1,10],range_locked:[!0,!1]}),this.distance_threshold=_.ParamConfig.FLOAT(1),this.blend_width=_.ParamConfig.FLOAT(0)}}const u=new l;class d extends r.TypedSopNode{constructor(){super(...arguments),this.params_config=u}static type(){return"attrib_transfer"}static displayed_input_names(){return["geometry to transfer attributes to","geometry to transfer attributes from"]}initialize_node(){this.io.inputs.set_count(2),this.io.inputs.init_inputs_clonable_state([c.InputCloneMode.FROM_NODE,c.InputCloneMode.NEVER])}cook(e){return s.__awaiter(this,void 0,void 0,(function*(){this._core_group_dest=e[0];const t=this._core_group_dest.points_from_group(this.pv.dest_group);this._core_group_src=e[1],this._attrib_names=this._core_group_src.attrib_names_matching_mask(this.pv.name),this._error_if_attribute_not_found_on_second_input(),this._build_octree_if_required(this._core_group_src),this._add_attribute_if_required(),yield this._transfer_attributes(t),this.set_core_group(this._core_group_dest)}))}_error_if_attribute_not_found_on_second_input(){for(let e of this._attrib_names)this._core_group_src.has_attrib(e)||this.states.error.set(`attribute '${e}' not found on second input`)}_build_octree_if_required(e){const t=null==this._octree_timestamp||this._octree_timestamp!==e.timestamp();if(this._prev_param_src_group!==this.pv.src_group||t){this._octree_timestamp=e.timestamp(),this._prev_param_src_group=this.pv.src_group;const t=this._core_group_src.points_from_group(this.pv.src_group);this._octree=new i.CoreOctree(this._core_group_src.bounding_box()),this._octree.set_points(t)}}_add_attribute_if_required(){this._attrib_names.forEach(e=>{if(!this._core_group_dest.has_attrib(e)){const t=this._core_group_src.attrib_size(e);this._core_group_dest.add_numeric_vertex_attrib(e,t,0)}})}_transfer_attributes(e){return s.__awaiter(this,void 0,void 0,(function*(){const t=new a.CoreIterator;yield t.start_with_array(e,this._transfer_attributes_for_point.bind(this))}))}_transfer_attributes_for_point(e){var t;const n=this.pv.distance_threshold+this.pv.blend_width,s=(null===(t=this._octree)||void 0===t?void 0:t.find_points(e.position(),n,this.pv.max_samples_count))||[];for(let t of this._attrib_names)this._interpolate_points(e,s,t)}_interpolate_points(e,t,n){let s;s=o.CoreInterpolate.perform(e,t,n,this.pv.distance_threshold,this.pv.blend_width),null!=s&&e.set_attrib_value(n,s)}}t.AttribTransferSopNode=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),r=s.__importDefault(n(209)),o=s.__importDefault(n(207));t.CoreInterpolate=class{static perform(e,t,n,s,r){switch(t.length){case 0:return 0;case 1:return this._interpolate_with_1_point(e,t[0],n,s,r);default:return this._interpolate_with_multiple_points(e,t,n,s,r)}}static _interpolate_with_1_point(e,t,n,s,r){const o=e.position(),i=t.position(),a=o.distanceTo(i),_=t.attrib_value(n);return this._weighted_value_from_distance(e,_,n,a,s,r)}static _weight_from_distance(e,t,n){return(e-t)/n}static _weighted_value_from_distance(e,t,n,s,r,o){if(s<=r)return t;{const i=e.attrib_value(n),a=this._weight_from_distance(s,r,o);return a*i+(1-a)*t}}static _interpolate_with_multiple_points(e,t,n,s,o){const i=t.map(t=>this._interpolate_with_1_point(e,t,n,s,o));return r.default(i)||0}static weights(e,t){switch(t.length){case 1:return 1;case 2:return this._weights_from_2(e,t);default:return t=t.slice(0,3),this._weights_from_3(e,t)}}static _weights_from_2(e,t){const n=t.map(t=>e.distanceTo(t)),s=o.default(n);return[n[1]/s,n[0]/s]}static _weights_from_3(e,t){const n=t.map(t=>e.distanceTo(t)),s=o.default([n[0]*n[1],n[0]*n[2],n[1]*n[2]]);return[n[1]*n[2]/s,n[0]*n[2]/s,n[0]*n[1]/s]}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),r=n(45),o=s.__importDefault(n(102)),i=n(842);t.CoreOctree=class{constructor(e){this._root=new i.OctreeNode(e)}set_points(e){this._root.set_points(e)}traverse(e){this._root.traverse(e)}find_points(e,t,n){const s=new r.Sphere(e,t);let i=[];return this._root.intersects_sphere(s)&&this._root.points_in_sphere(s,i),null==n||i.length>n&&(i=o.default(i,t=>t.position().distanceTo(e)),i=i.slice(0,n)),i}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),r=n(58),o=s.__importDefault(n(83));class i{constructor(e,t=0){this._bbox=e,this._level=t,this._leaves_by_octant={},this._points_by_octant_id={},this._leaves=[],this._bounding_boxes_by_octant={},this._bounding_boxes_by_octant_prepared=!1,this._center=this._bbox.max.clone().add(this._bbox.min).multiplyScalar(.5)}level(){return this._level}traverse(e){e(this),Object.values(this._leaves_by_octant).forEach(t=>{t.traverse(e)})}intersects_sphere(e){return!!this._bbox&&this._bbox.intersectsSphere(e)}points_in_sphere(e,t){if(0==this._leaves.length){o.default(Object.values(this._points_by_octant_id)).filter(t=>e.containsPoint(t.position())).forEach(e=>{t.push(e)})}else{this._leaves.filter(t=>t.intersects_sphere(e)).forEach(n=>n.points_in_sphere(e,t))}}bounding_box(){return this._bbox}set_points(e){this._points_by_octant_id={};for(let t of e)this.add_point(t);const t=Object.keys(this._points_by_octant_id);t.length>1&&t.forEach(e=>{this.create_leaf(e)})}create_leaf(e){const t=this._leaf_bbox(e),n=new i(t,this._level+1);this._leaves_by_octant[e]=n,this._leaves.push(n),n.set_points(this._points_by_octant_id[e])}add_point(e){const t=this._octant_id(e.position());null==this._points_by_octant_id[t]&&(this._points_by_octant_id[t]=[]),this._points_by_octant_id[t].push(e)}_octant_id(e){return`${e.x>this._center.x?1:0}${e.y>this._center.y?1:0}${e.z>this._center.z?1:0}`}_leaf_bbox(e){return this._bounding_boxes_by_octant_prepared||(this._prepare_leaves_bboxes(),this._bounding_boxes_by_octant_prepared=!0),this._bounding_boxes_by_octant[e]}_bbox_center(e,t,n){const s=this._bbox.min.clone();return e&&(s.x=this._bbox.max.x),t&&(s.y=this._bbox.max.y),n&&(s.z=this._bbox.max.z),s.clone().add(this._center).multiplyScalar(.5)}_prepare_leaves_bboxes(){const e=[];e.push(this._bbox_center(0,0,0)),e.push(this._bbox_center(0,0,1)),e.push(this._bbox_center(0,1,0)),e.push(this._bbox_center(0,1,1)),e.push(this._bbox_center(1,0,0)),e.push(this._bbox_center(1,0,1)),e.push(this._bbox_center(1,1,0)),e.push(this._bbox_center(1,1,1));const t=this._bbox.max.clone().sub(this._bbox.min).multiplyScalar(.25);for(let n of e){const e=this._octant_id(n),s=new r.Box3(n.clone().sub(t),n.clone().add(t));this._bounding_boxes_by_octant[e]=s}}}t.OctreeNode=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),r=n(6),o=n(4),i=s.__importDefault(n(82)),a=n(13),_=n(35),c=n(5);class l extends c.NodeParamsConfig{constructor(){super(...arguments),this.step_size=c.ParamConfig.FLOAT(.1)}}const u=new l;class d extends a.TypedSopNode{constructor(){super(...arguments),this.params_config=u}static type(){return"bbox_scatter"}static displayed_input_names(){return["geometry to create points from"]}initialize_node(){this.io.inputs.set_count(1)}cook(e){const t=e[0],n=this.pv.step_size,s=t.bounding_box(),a={x:i.default(s.min.x,s.max.x,n),y:i.default(s.min.y,s.max.y,n),z:i.default(s.min.z,s.max.z,n)},c=[];a.x.forEach(e=>{a.y.forEach(t=>{a.z.forEach(n=>{c.push(e),c.push(t),c.push(n)})})});const l=new r.BufferGeometry;l.setAttribute("position",new o.BufferAttribute(new Float32Array(c),3)),this.set_geometry(l,_.CoreConstant.OBJECT_TYPE.POINTS)}}t.BboxScatterSopNode=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(13),r=n(5),o=n(17);class i extends r.NodeParamsConfig{constructor(){super(...arguments),this.attrib_name=r.ParamConfig.STRING(),this.blend=r.ParamConfig.FLOAT(.5,{range:[0,1],range_locked:[!0,!0]})}}const a=new i;class _ extends s.TypedSopNode{constructor(){super(...arguments),this.params_config=a}static type(){return"blend"}static displayed_input_names(){return["geometry to blend from","geometry to blend to"]}initialize_node(){this.io.inputs.set_count(2),this.io.inputs.init_inputs_clonable_state([o.InputCloneMode.FROM_NODE,o.InputCloneMode.NEVER])}cook(e){const t=e[0],n=e[1],s=t.objects(),r=n.objects();let o,i;for(let e=0;e<s.length;e++)o=s[e],i=r[e],this.blend(o,i,this.pv.blend);this.set_core_group(t)}blend(e,t,n){const s=e.geometry,r=t.geometry;if(null==s||null==r)return;const o=s.getAttribute(this.pv.attrib_name),i=r.getAttribute(this.pv.attrib_name);if(null==o||null==i)return;const a=o.array,_=i.array;let c,l;for(let e=0;e<a.length;e++)c=a[e],l=_[e],null!=l&&(a[e]=(1-n)*c+n*l);s.computeVertexNormals()}}t.BlendSopNode=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(13),r=n(85),o=n(136),i=n(17),a=n(5);class _ extends a.NodeParamsConfig{constructor(){super(...arguments),this.size=a.ParamConfig.FLOAT(1),this.divisions=a.ParamConfig.INTEGER(1,{range:[1,10],range_locked:[!0,!1]}),this.center=a.ParamConfig.VECTOR3([0,0,0])}}const c=new _;class l extends s.TypedSopNode{constructor(){super(...arguments),this.params_config=c,this._core_transform=new r.CoreTransform}static type(){return"box"}static displayed_input_names(){return["geometry to create bounding box from (optional)"]}initialize_node(){this.io.inputs.set_count(0,1),this.io.inputs.init_inputs_clonable_state([i.InputCloneMode.NEVER])}cook(e){const t=e[0];t?this._cook_with_input(t):this._cook_without_input()}_cook_without_input(){const e=this.pv.divisions,t=this.pv.size,n=new o.BoxBufferGeometry(t,t,t,e,e,e);n.translate(this.pv.center.x,this.pv.center.y,this.pv.center.z),n.computeVertexNormals(),this.set_geometry(n)}_cook_with_input(e){const t=this.pv.divisions,n=e.bounding_box(),s=n.max.clone().sub(n.min),r=n.max.clone().add(n.min).multiplyScalar(.5),i=new o.BoxBufferGeometry(s.x,s.y,s.z,t,t,t),a=this._core_transform.translation_matrix(r);i.applyMatrix4(a),this.set_geometry(i)}}t.BoxSopNode=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),r=n(409),o=n(13),i=n(5);class a extends i.NodeParamsConfig{constructor(){super(...arguments),this.cache=i.ParamConfig.STRING("",{hidden:!0}),this.reset=i.ParamConfig.BUTTON(null,{callback:(e,t)=>{c.PARAM_CALLBACK_reset(e,t)}})}}const _=new a;class c extends o.TypedSopNode{constructor(){super(...arguments),this.params_config=_}static type(){return"cache"}static displayed_input_names(){return["geometry to cache"]}initialize_node(){this.io.inputs.set_count(0,1)}cook(e){const t=""==this.pv.cache||null==this.pv.cache,n=e[0];if(t&&n){const e=[];for(let t of n.objects())e.push(t.toJSON());this.set_core_group(n),this.p.cache.set(JSON.stringify(e))}else if(this.pv.cache){const e=new r.ObjectLoader,t=JSON.parse(this.pv.cache),n=[];for(let s of t){const t=e.parse(s);n.push(t)}this.set_objects(n)}else this.set_objects([])}static PARAM_CALLBACK_reset(e,t){e.param_callback_PARAM_CALLBACK_reset()}param_callback_PARAM_CALLBACK_reset(){return s.__awaiter(this,void 0,void 0,(function*(){this.p.cache.set(""),this.request_container()}))}}t.CacheSopNode=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(1),r=n(216),o=n(13),i=n(383),a=n(35),_=n(85),c=new s.Vector3(0,0,1),l=n(5);class u extends l.NodeParamsConfig{constructor(){super(...arguments),this.radius=l.ParamConfig.FLOAT(1),this.segments=l.ParamConfig.INTEGER(12,{range:[1,50],range_locked:[!0,!1]}),this.open=l.ParamConfig.BOOLEAN(1),this.arc_angle=l.ParamConfig.FLOAT(360,{range:[0,360],range_locked:[!1,!1],visible_if:{open:1}}),this.direction=l.ParamConfig.VECTOR3([0,1,0])}}const d=new u;class h extends o.TypedSopNode{constructor(){super(...arguments),this.params_config=d,this._core_transform=new _.CoreTransform}static type(){return"circle"}initialize_node(){}cook(){this.pv.open?this._create_circle():this._create_disk()}_create_circle(){const e=i.CoreGeometryUtilCircle.create(this.pv.radius,this.pv.segments,this.pv.arc_angle);this._core_transform.rotate_geometry(e,c,this.pv.direction),this.set_geometry(e,a.ObjectType.LINE_SEGMENTS)}_create_disk(){const e=new r.CircleBufferGeometry(this.pv.radius,this.pv.segments);this._core_transform.rotate_geometry(e,c,this.pv.direction),this.set_geometry(e)}}t.CircleSopNode=h},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(13),r=n(17),o=n(259),i=n(261),a=n(5),_=n(357);class c extends a.NodeParamsConfig{constructor(){super(...arguments),this.code_typescript=a.ParamConfig.STRING("const core_group = core_groups[0];\nconst object = core_group.objects()[0];\nobject.position.y = -1;\nnode.set_core_group(core_groups[0]);\n\n\n",{label:!1,language:o.StringParamLanguage.TYPESCRIPT}),this.code_javascript=a.ParamConfig.STRING("",{hidden:!0})}}const l=new c;class u extends s.TypedSopNode{constructor(){super(...arguments),this.params_config=l}static type(){return"code"}initialize_node(){this.io.inputs.set_count(0,4),this.ui_data.set_width(100),this.io.inputs.init_inputs_clonable_state([r.InputCloneMode.FROM_NODE])}cook(e){this._compile_if_required(),this._function?this._function(this,this.scene,e):this.set_core_group(e[0])}_compile_if_required(){this._function&&this._last_compiled_code==this.pv.code_javascript||this._compile()}_compile(){try{this._function=new i.AsyncFunction("node","scene","core_groups",`try {\n\t\t\t\t\t${_.TranspiledFilter.filter(this.pv.code_javascript)}\n\t\t\t\t} catch(e) {\n\t\t\t\t\tthis.states.error.set(e)\n\t\t\t\t}`),this._last_compiled_code=this.pv.code_javascript}catch(e){console.warn(e),this.states.error.set(`cannot generate function (${e})`),this._function=void 0}}}t.CodeSopNode=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),r=n(7),o=n(850),i=n(13),a=n(17),_=new r.Color(1,1,1),c=n(5);class l extends c.NodeParamsConfig{constructor(){super(...arguments),this.from_attribute=c.ParamConfig.BOOLEAN(0),this.attrib_name=c.ParamConfig.STRING("",{visible_if:{from_attribute:1}}),this.color=c.ParamConfig.COLOR([1,1,1],{visible_if:{from_attribute:0},expression:{for_entities:!0}}),this.as_hsv=c.ParamConfig.BOOLEAN(0,{visible_if:{from_attribute:0}})}}const u=new l;class d extends i.TypedSopNode{constructor(){super(...arguments),this.params_config=u,this._r_arrays_by_geometry_uuid={},this._g_arrays_by_geometry_uuid={},this._b_arrays_by_geometry_uuid={}}static type(){return"color"}static displayed_input_names(){return["geometry to update color of"]}initialize_node(){this.io.inputs.set_count(1),this.io.inputs.init_inputs_clonable_state([a.InputCloneMode.FROM_NODE])}cook(e){return s.__awaiter(this,void 0,void 0,(function*(){const t=e[0],n=t.core_objects();for(let e of n)if(this.pv.from_attribute)this._set_from_attribute(e);else{this.p.color.has_expression()?yield this._eval_expressions(e):this._eval_simple_values(e)}if(!this.io.inputs.input_cloned(0)){const e=t.geometries();for(let t of e)t.getAttribute("color").needsUpdate=!0}this.set_core_group(t)}))}_set_from_attribute(e){const t=e.core_geometry();this._create_init_color(t,_);const n=t.points(),s=t.attrib_size(this.pv.attrib_name),r=t.geometry(),o=r.getAttribute(this.pv.attrib_name).array,i=r.getAttribute("color").array;switch(s){case 1:for(let e=0;e<n.length;e++){const t=3*e;i[t+0]=o[e],i[t+1]=1-o[e],i[t+2]=0}break;case 2:for(let e=0;e<n.length;e++){const t=3*e,n=2*e;i[t+0]=o[n+0],i[t+1]=o[n+1],i[t+2]=0}break;case 3:for(let e=0;e<o.length;e++)i[e]=o[e];break;case 4:for(let e=0;e<n.length;e++){const t=3*e,n=4*e;i[t+0]=o[n+0],i[t+1]=o[n+1],i[t+2]=o[n+2]}}}_create_init_color(e,t){e.has_attrib("color")||e.add_numeric_attrib("color",3,_)}_eval_simple_values(e){const t=e.core_geometry();let n;this._create_init_color(t,_),this.pv.as_hsv?(n=new r.Color,o.CoreColor.set_hsv(this.pv.color.r,this.pv.color.g,this.pv.color.b,n)):n=this.pv.color,t.add_numeric_attrib("color",3,n)}_eval_expressions(e){return s.__awaiter(this,void 0,void 0,(function*(){const t=e.points(),n=e.object(),s=e.core_geometry();this._create_init_color(s,_);const i=n.geometry;if(i){const e=i.getAttribute("color").array,n=yield this._update_from_param(i,e,t,0),s=yield this._update_from_param(i,e,t,1),a=yield this._update_from_param(i,e,t,2);if(n&&this._commit_tmp_values(n,e,0),s&&this._commit_tmp_values(s,e,1),a&&this._commit_tmp_values(a,e,2),this.pv.as_hsv){let n,s=new r.Color,i=new r.Color;for(let r of t)n=3*r.index,s.fromArray(e,n),o.CoreColor.set_hsv(s.r,s.g,s.b,i),i.toArray(e,n)}}}))}_update_from_param(e,t,n,r){return s.__awaiter(this,void 0,void 0,(function*(){const s=this.p.color.components[r],o=[this.pv.color.r,this.pv.color.g,this.pv.color.b][r],i=[this._r_arrays_by_geometry_uuid,this._g_arrays_by_geometry_uuid,this._b_arrays_by_geometry_uuid][r];let a;if(s.has_expression()&&s.expression_controller)a=this._init_array_if_required(e,i,n.length),yield s.expression_controller.compute_expression_for_points(n,(e,t)=>{a[e.index]=t});else for(let e of n)t[3*e.index+r]=o;return a}))}_init_array_if_required(e,t,n){const s=e.uuid,r=t[s];return r?r.length<n&&(t[s]=new Array(n)):t[s]=new Array(n),t[s]}_commit_tmp_values(e,t,n){for(let s=0;s<e.length;s++)t[3*s+n]=e[s]}}t.ColorSopNode=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(14);t.CoreColor=class{static set_hsv(e,t,n,r){e=s.MathUtils.euclideanModulo(e,1),t=s.MathUtils.clamp(t,0,1),n=s.MathUtils.clamp(n,0,1),r.setHSL(e,t*n/((e=(2-t)*n)<1?e:2-e),.5*e)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(13),r=n(1),o=n(215),i=n(85),a=new r.Vector3(0,1,0),_=n(5);class c extends _.NodeParamsConfig{constructor(){super(...arguments),this.radius=_.ParamConfig.FLOAT(1,{range:[0,1]}),this.height=_.ParamConfig.FLOAT(1,{range:[0,1]}),this.segments_radial=_.ParamConfig.INTEGER(12,{range:[3,20],range_locked:[!0,!1]}),this.segments_height=_.ParamConfig.INTEGER(1,{range:[1,20],range_locked:[!0,!1]}),this.cap=_.ParamConfig.BOOLEAN(1),this.theta_start=_.ParamConfig.FLOAT(1,{range:[0,1]}),this.theta_length=_.ParamConfig.FLOAT("2*$PI",{range:[0,1]}),this.center=_.ParamConfig.VECTOR3([0,0,0]),this.direction=_.ParamConfig.VECTOR3([0,0,1])}}const l=new c;class u extends s.TypedSopNode{constructor(){super(...arguments),this.params_config=l,this._core_transform=new i.CoreTransform}static type(){return"cone"}cook(){const e=new o.ConeBufferGeometry(this.pv.radius,this.pv.height,this.pv.segments_radial,this.pv.segments_height,!this.pv.cap,this.pv.theta_start,this.pv.theta_length);this._core_transform.rotate_geometry(e,a,this.pv.direction),e.translate(this.pv.center.x,this.pv.center.y,this.pv.center.z),this.set_geometry(e)}}t.ConeSopNode=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),r=s.__importDefault(n(92)),o=n(13),i=n(273),a=n(384),_=n(49),c=n(853),l=n(5),u=n(17);class d extends l.NodeParamsConfig{constructor(){super(...arguments),this.count=l.ParamConfig.INTEGER(1,{range:[1,20],range_locked:[!0,!1]}),this.transform_only=l.ParamConfig.BOOLEAN(0),this.copy_attributes=l.ParamConfig.BOOLEAN(0),this.attributes_to_copy=l.ParamConfig.STRING("",{visible_if:{copy_attributes:!0}}),this.use_copy_expr=l.ParamConfig.BOOLEAN(0)}}const h=new d;class p extends o.TypedSopNode{constructor(){super(...arguments),this.params_config=h,this._attribute_names_to_copy=[],this._objects=[]}static type(){return"copy"}static displayed_input_names(){return["geometry to be copied","points to copy to"]}initialize_node(){this.io.inputs.set_count(1,2),this.io.inputs.init_inputs_clonable_state([u.InputCloneMode.ALWAYS,u.InputCloneMode.NEVER])}cook(){return s.__awaiter(this,void 0,void 0,(function*(){let e;const t=yield this.container_controller.request_input_container(0);if(null!=t&&null!=(e=t.core_content()))if(this.io.inputs.has_input(1)){let t;const n=yield this.container_controller.request_input_container(1);null!=n&&null!=(t=n.core_content())?yield this.cook_with_template(e,t):this.states.error.set("second input required")}else this.cook_without_template(e);else this.states.error.set("first input required")}))}cook_with_template(e,t){return s.__awaiter(this,void 0,void 0,(function*(){this._objects=[];const n=t.points();let s=new a.CoreInstancer(t).matrices();this._attribute_names_to_copy=_.CoreString.attrib_names(this.pv.attributes_to_copy).filter(e=>t.has_attrib(e)),yield this._copy_moved_objects_on_template_points(e,s,n),this.set_objects(this._objects)}))}_copy_moved_objects_on_template_points(e,t,n){return s.__awaiter(this,void 0,void 0,(function*(){for(let s=0;s<n.length;s++)yield this._copy_moved_object_on_template_point(e,t,n,s)}))}_copy_moved_object_on_template_point(e,t,n,r){return new Promise((o,i)=>s.__awaiter(this,void 0,void 0,(function*(){const s=t[r],i=n[r];return this.stamp_node.set_point(i),(yield this._get_moved_objects_for_template_point(e,r)).forEach(e=>(this.pv.copy_attributes&&this._copy_attributes_from_template(e,i),this.pv.transform_only?e.applyMatrix4(s):e.geometry.applyMatrix4(s),this._objects.push(e))),o()})))}_get_moved_objects_for_template_point(e,t){return new Promise((n,o)=>s.__awaiter(this,void 0,void 0,(function*(){if(yield this._stamp_instance_group_if_required(e)){const s=this.pv.transform_only?r.default([e.objects()[t]]):e.clone().objects();n(s)}else n([])})))}_stamp_instance_group_if_required(e){return new Promise((t,n)=>s.__awaiter(this,void 0,void 0,(function*(){if(this.pv.use_copy_expr){const e=yield this.container_controller.request_input_container(0);let n;e&&null!=(n=e.core_content())?t(n):(this.states.error.set(`input failed for index ${this.stamp_value()}`),t())}else t(e)})))}_copy_moved_objects_for_each_instance(e){return s.__awaiter(this,void 0,void 0,(function*(){for(let t=0;t<this.pv.count;t++)yield this._copy_moved_objects_for_instance(e,t)}))}_copy_moved_objects_for_instance(e,t){return new Promise((n,r)=>s.__awaiter(this,void 0,void 0,(function*(){this.stamp_node.set_global_index(t);const s=yield this._stamp_instance_group_if_required(e);s&&s.objects().forEach(e=>{const t=i.CoreObject.clone(e);this._objects.push(t)}),n()})))}cook_without_template(e){this._objects=[],this._copy_moved_objects_for_each_instance(e).then(()=>{this.set_objects(this._objects)})}_copy_attributes_from_template(e,t){this._attribute_names_to_copy.forEach((n,s)=>{const r=t.attrib_value(n);new i.CoreObject(e,s).add_attribute(n,r)})}stamp_value(e){return this.stamp_node.value(e)}get stamp_node(){return this._stamp_node=this._stamp_node||this.create_stamp_node()}create_stamp_node(){const e=new c.CopyStamp(this.scene);return this.dirty_controller.set_forbidden_trigger_nodes([e]),e}}t.CopySopNode=p},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(60);class r extends s.CoreGraphNode{constructor(e){super(e,"CopyStamp"),this._global_index=0}set_point(e){this._point=e,this.set_dirty(),this.remove_dirty_state()}set_global_index(e){this._global_index=e,this.set_dirty(),this.remove_dirty_state()}value(e){return this._point?e?this._point.attrib_value(e):this._point.index:this._global_index}}t.CopyStamp=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(13),r=n(385),o=JSON.stringify([{value:-40},{value:-30},{value:-20},{value:-10},{value:0},{value:10},{value:20},{value:30},{value:40},{value:50},{value:60},{value:70},{value:80}]),i=n(5);class a extends i.NodeParamsConfig{constructor(){super(...arguments),this.data=i.ParamConfig.STRING(o)}}const _=new a;class c extends s.TypedSopNode{constructor(){super(...arguments),this.params_config=_}static type(){return"data"}cook(){let e=null;try{e=JSON.parse(this.pv.data)}catch(e){this.states.error.set("could not parse json")}if(e){const t=new r.JsonDataLoader;t.set_json(e);const n=t.create_object();this.set_object(n)}else this.cook_controller.end_cook()}}t.DataSopNode=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),r=s.__importDefault(n(21)),o=s.__importDefault(n(48)),i=n(35);t.CoreAttributeData=class{constructor(e,t){this._size=e,this._type=t}size(){return this._size}type(){return this._type}static from_value(e){const t=o.default(e)?i.CoreConstant.ATTRIB_TYPE.STRING:i.CoreConstant.ATTRIB_TYPE.NUMERIC;return new this(r.default(e)?e.length:1,t)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),r=n(13),o=n(385),i=n(5);class a extends i.NodeParamsConfig{constructor(){super(...arguments),this.url=i.ParamConfig.STRING("/examples/sop/data_url/basic.json"),this.json_data_keys_prefix=i.ParamConfig.STRING(""),this.skip_entries=i.ParamConfig.STRING(""),this.convert=i.ParamConfig.BOOLEAN(0),this.convert_to_numeric=i.ParamConfig.STRING("",{visible_if:{convert:1}}),this.reload=i.ParamConfig.BUTTON(null,{callback:(e,t)=>{c.PARAM_CALLBACK_reload(e,t)}})}}const _=new a;class c extends r.TypedSopNode{constructor(){super(...arguments),this.params_config=_}static type(){return"data_url"}cook(){return s.__awaiter(this,void 0,void 0,(function*(){new o.JsonDataLoader({data_keys_prefix:this.pv.json_data_keys_prefix,skip_entries:this.pv.skip_entries,do_convert:this.pv.convert,convert_to_numeric:this.pv.convert_to_numeric}).load(this.pv.url,this._on_load.bind(this),void 0,this._on_error.bind(this))}))}_on_load(e){this.set_objects([e])}_on_error(e){this.states.error.set(`could not load geometry from ${this.pv.url} (${e})`),this.cook_controller.end_cook()}static PARAM_CALLBACK_reload(e,t){e.param_callback_reload()}param_callback_reload(){this.p.url.set_dirty()}}t.DataUrlSopNode=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(13),r=n(5),o=n(17);class i extends r.NodeParamsConfig{constructor(){super(...arguments),this.duration=r.ParamConfig.INTEGER(1e3)}}const a=new i;class _ extends s.TypedSopNode{constructor(){super(...arguments),this.params_config=a}static type(){return"delay"}initialize_node(){this.io.inputs.set_count(1),this.io.inputs.init_inputs_clonable_state([o.InputCloneMode.ALWAYS])}cook(e){const t=e[0];setTimeout(()=>{this.set_core_group(t)},this.pv.duration)}}t.DelaySopNode=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),r=n(58),o=s.__importDefault(n(48)),i=s.__importDefault(n(179)),a=n(13),_=n(49),c=n(35),l=n(53),u=n(17);var d;!function(e){e[e["=="]=0]="==",e[e["<"]=1]="<",e[e["<="]=2]="<=",e[e[">="]=3]=">=",e[e[">"]=4]=">",e[e["!="]=5]="!="}(d||(d={}));const h=[{name:"==",value:d["=="]},{name:"<",value:d["<"]},{name:"<=",value:d["<="]},{name:">=",value:d[">="]},{name:">",value:d[">"]},{name:"!=",value:d["!="]}],p=n(5);class m extends p.NodeParamsConfig{constructor(){super(...arguments),this.class=p.ParamConfig.INTEGER(c.AttribClass.VERTEX,{menu:{entries:c.AttribClassMenuEntries}}),this.invert=p.ParamConfig.BOOLEAN(0),this.hide_objects=p.ParamConfig.BOOLEAN(0),this.by_object_type=p.ParamConfig.BOOLEAN(0),this.object_type=p.ParamConfig.INTEGER(c.ObjectTypes.indexOf(c.ObjectType.MESH),{menu:{entries:c.ObjectTypeMenuEntries},visible_if:{by_object_type:!0}}),this.by_expression=p.ParamConfig.BOOLEAN(0),this.expression=p.ParamConfig.BOOLEAN("@ptnum==0",{visible_if:{by_expression:!0},expression:{for_entities:!0}}),this.by_attrib=p.ParamConfig.BOOLEAN(0),this.attrib_name=p.ParamConfig.STRING("",{visible_if:{by_attrib:!0}}),this.attrib_string=p.ParamConfig.STRING("",{visible_if:{by_attrib:!0}}),this.attrib_numeric=p.ParamConfig.VECTOR4([0,0,0,0],{visible_if:{by_attrib:!0}}),this.attrib_comparison_operator=p.ParamConfig.INTEGER(d["=="],{menu:{entries:h},visible_if:{by_attrib:!0}}),this.by_bbox=p.ParamConfig.BOOLEAN(0),this.bbox_size=p.ParamConfig.VECTOR3([1,1,1],{visible_if:{by_bbox:!0}}),this.bbox_center=p.ParamConfig.VECTOR3([0,0,0],{visible_if:{by_bbox:!0}}),this.by_visible=p.ParamConfig.BOOLEAN(0),this.keep_points=p.ParamConfig.BOOLEAN(1,{visible_if:{class:c.AttribClass.OBJECT}})}}const f=new m;class g extends a.TypedSopNode{constructor(){super(...arguments),this.params_config=f,this._marked_for_deletion_per_object_index=new Map}static type(){return"delete"}static displayed_input_names(){return["geometry to delete from"]}initialize_node(){this.io.inputs.set_count(1),this.io.inputs.init_inputs_clonable_state([u.InputCloneMode.FROM_NODE])}cook(e){return s.__awaiter(this,void 0,void 0,(function*(){const t=e[0];switch(this._bbox_cache=void 0,this.pv.class){case c.AttribClass.VERTEX:yield this._eval_for_points(t);break;case c.AttribClass.OBJECT:yield this._eval_for_objects(t)}}))}_eval_for_objects(e){return s.__awaiter(this,void 0,void 0,(function*(){const t=[],n=e.core_objects();this._marked_for_deletion_per_object_index=new Map;for(let e of n)this._marked_for_deletion_per_object_index.set(e.index,!1);let s,r;this.pv.by_expression&&(yield this._eval_expressions_for_objects(n)),this.pv.by_object_type&&this._eval_type_for_objects(n),this.pv.by_attrib&&""!==this.pv.attrib_name&&this._eval_attrib_for_objects(n),this.pv.invert&&this._marked_for_deletion_per_object_index.forEach((e,t)=>{this._marked_for_deletion_per_object_index.set(t,!e)});const o=[];this._marked_for_deletion_per_object_index.forEach((e,i)=>{s=n[i],r=s.object(),this.pv.hide_objects?(t.push(r),e&&(r.visible=!1)):(e||t.push(r),e&&o.push(this._point_object(s)))});for(let e of o)t.push(e);this.set_objects(t)}))}_eval_for_points(e){return s.__awaiter(this,void 0,void 0,(function*(){const t=e.core_objects();let n;for(let e=0;e<t.length;e++){n=t[e];let s=n.core_geometry();if(s){let e=s.points_from_geometry();const t=e.length;if(this.pv.by_expression&&(e=yield this._eval_expressions_for_points(e)),this.pv.by_attrib&&""!==this.pv.attrib_name&&(e=this._eval_attrib_for_points(e)),this.pv.by_bbox&&(e=this._eval_bbox_for_points(e)),e.length!=t){const t=n.object();s.geometry().dispose(),e.length>0?t.geometry=l.CoreGeometry.geometry_from_points(e,t.constructor):null!=t.parent&&t.parent.remove(t)}}}this.set_core_group(e)}))}_eval_expressions_for_points(e){return s.__awaiter(this,void 0,void 0,(function*(){const t=[],n=this.p.expression;if(this.p.expression.has_expression()&&n.expression_controller)yield n.expression_controller.compute_expression_for_points(e,(e,n)=>{let s=!n;this.pv.invert&&(s=!s),s&&t.push(e)});else{let n=!this.pv.expression;this.pv.invert&&(n=!n);for(let s=0;s<e.length;s++)n&&t.push(e[s])}return console.log(t),t}))}_eval_expressions_for_objects(e){return s.__awaiter(this,void 0,void 0,(function*(){const t=this.p.expression;if(t.has_expression()&&t.expression_controller)yield t.expression_controller.compute_expression_for_objects(e,(e,t)=>{this._marked_for_deletion_per_object_index.get(e.index)||this._marked_for_deletion_per_object_index.set(e.index,t)});else for(let n of e)this._marked_for_deletion_per_object_index.set(n.index,t.value)}))}_eval_attrib_for_points(e){const t=[];if(e.length>0){const n=e[0].attrib_value(this.pv.attrib_name);(o.default(n)?_.CoreString.attrib_names(this.pv.attrib_string):[this.pv.attrib_numeric.x]).forEach(n=>e.forEach(e=>{const s=e.attrib_value(this.pv.attrib_name);let r=!this._comparison(s,n);if(this.pv.invert&&(r=!r),r)return t.push(e)}))}return t}_comparison(e,t){switch(this.pv.attrib_ComparisonOperator){case d["=="]:return e===t;case d["<="]:return e<=t;case d["<"]:return e<t;case d[">"]:return e>t;case d[">="]:return e>=t;case d["!="]:return e!==t}}_eval_type_for_objects(e){const t=c.ObjectTypes[this.pv.object_type];for(let n of e){if(!this._marked_for_deletion_per_object_index.get(n.index)){n.object().constructor.name===t&&this._marked_for_deletion_per_object_index.set(n.index,!0)}}}_eval_attrib_for_objects(e){for(let t of e){if(!this._marked_for_deletion_per_object_index.get(t.index)){const e=t.attrib_value(this.pv.attrib_name);e===(o.default(e)?this.pv.attrib_string:this.pv.attrib_float)&&this._marked_for_deletion_per_object_index.set(t.index,!0)}}}_eval_bbox_for_points(e){const t=[];return i.default(e,(e,n)=>{const s=this._bbox.containsPoint(e.position());if(this.pv.invert?s:!s)return t.push(e)}),t}get _bbox(){return null!=this._bbox_cache?this._bbox_cache:this._bbox_cache=new r.Box3(this.pv.bbox_center.clone().sub(this.pv.bbox_size.clone().multiplyScalar(.5)),this.pv.bbox_center.clone().add(this.pv.bbox_size.clone().multiplyScalar(.5)))}_point_object(e){const t=e.points(),n=l.CoreGeometry.geometry_from_points(t,e.object().constructor);return this.create_object(n,c.ObjectType.POINTS)}}t.DeleteSopNode=g},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),r=n(1),o=n(4),i=s.__importDefault(n(82)),a=s.__importDefault(n(208)),_=s.__importDefault(n(378)),c=n(13),l=n(17),u=n(5);class d extends u.NodeParamsConfig{constructor(){super(...arguments),this.make_faces_unique=u.ParamConfig.BOOLEAN(0),this.add_face_center_attribute=u.ParamConfig.BOOLEAN(0,{visible_if:{make_faces_unique:1}}),this.add_face_id=u.ParamConfig.BOOLEAN(0,{visible_if:{make_faces_unique:1}}),this.transform=u.ParamConfig.BOOLEAN(0,{visible_if:{make_faces_unique:1}}),this.scale=u.ParamConfig.FLOAT(1,{visible_if:{make_faces_unique:1,transform:1}})}}const h=new d;class p extends c.TypedSopNode{constructor(){super(...arguments),this.params_config=h}static type(){return"face"}initialize_node(){this.io.inputs.set_count(1),this.io.inputs.init_inputs_clonable_state([l.InputCloneMode.FROM_NODE])}cook(e){const t=e[0];this.pv.make_faces_unique&&(this._make_faces_unique(t),this.pv.add_face_center_attribute&&this._add_face_center_attribute(t),this.pv.add_face_id&&this._add_face_id(t),this.pv.transform&&this._transform_faces(t)),this.set_core_group(t)}_make_faces_unique(e){var t;for(let n of e.objects())if(n.isMesh){const e=n.geometry,s=_.default((null===(t=e.index)||void 0===t?void 0:t.array)||[],3),r=3*s.length;for(let t of Object.keys(e.attributes)){const n=e.attributes[t],i=n.itemSize,_=new Float32Array(r*i);let c=0;s.forEach(e=>{e.forEach(e=>{a.default(i,t=>{const s=n.array[e*i+t];_[c]=s,c+=1})})}),e.setAttribute(t,new o.BufferAttribute(_,i))}const c=i.default(r);e.setIndex(c)}}_add_face_center_attribute(e){const t=new r.Vector3;let n,s,o,i;e.core_objects().forEach(e=>{const r=e.object(),a=e.core_geometry();if(r.isMesh){n=a.faces(),a.has_attrib("face_center")||a.add_numeric_attrib("face_center",3,-1);for(let e=0;e<n.length;e++){s=n[e],s.center(t),o=s.points;for(let e=0;e<o.length;e++)i=o[e],i.set_attrib_value("face_center",t)}}})}_add_face_id(e){e.core_objects().forEach(e=>{const t=e.object(),n=e.core_geometry();if(t.isMesh){const e=n.faces();n.has_attrib("face_id")||n.add_numeric_attrib("face_id",1,-1);for(let t=0;t<e.length;t++){const n=e[t].points;for(let e=0;e<n.length;e++){n[e].set_attrib_value("face_id",t)}}}})}_transform_faces(e){const t=new r.Vector3,n=new r.Vector3,s=this.pv.scale;let o,i,a,_;e.core_objects().forEach(e=>{const r=e.object(),c=e.core_geometry();if(r.isMesh){o=c.faces(),c.has_attrib("position")||c.add_numeric_attrib("position",3,-1);for(let e=0;e<o.length;e++){i=o[e],i.center(t),a=i.points;for(let e=0;e<a.length;e++){_=a[e];const r=_.position();n.x=r.x*s+t.x*(1-s),n.y=r.y*s+t.y*(1-s),n.z=r.z*s+t.z*(1-s),_.set_attrib_value("position",n)}}}})}}t.FaceSopNode=p},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3).__importDefault(n(83)),r=n(13),o=n(861),i=n(5);class a extends i.NodeParamsConfig{constructor(){super(...arguments),this.url=i.ParamConfig.STRING("",{desktop_browse:{file_type:"geometry"},always_reference_asset:!0}),this.reload=i.ParamConfig.BUTTON(null,{callback:(e,t)=>{c.PARAM_CALLBACK_reload(e)}})}}const _=new a;class c extends r.TypedSopNode{constructor(){super(...arguments),this.params_config=_}static type(){return"file"}initialize_node(){}cook(){new o.CoreLoaderGeometry(this.pv.url).load(this._on_load.bind(this),this._on_error.bind(this))}_on_load(e){console.log("objects",e),e=s.default(e),this.set_objects(e)}_on_error(e){this.states.error.set(`could not load geometry from ${this.pv.url} (${e})`)}static PARAM_CALLBACK_reload(e){e.param_callback_reload()}param_callback_reload(){this.p.url.set_dirty()}}t.FileSopNode=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),r=n(409),o=n(10),i=n(6),a=n(22),_=n(159);t.CoreLoaderGeometry=class{constructor(e){this.url=e;const t=this.url.split(".");this.ext=t[t.length-1].toLowerCase(),"zip"===this.ext&&(this.ext=t[t.length-2])}load(e,t){this.load_auto().then(t=>{e(t)}).catch(e=>{t(e)})}load_auto(){return new Promise((e,t)=>s.__awaiter(this,void 0,void 0,(function*(){const n=this.url;if("json"==this.ext)fetch(n).then(t=>s.__awaiter(this,void 0,void 0,(function*(){const n=yield t.json();(new r.ObjectLoader).parse(n,t=>{e(this.on_load_success(t.children[0]))})}))).catch(e=>{t(e)});else{const s=yield this.loader_for_ext();if(s)s.load(n,t=>{console.log(t),this.on_load_success(t).then(t=>{e(t)})},void 0,e=>{t(e)});else{const e=`format not supported (${this.ext})`;t(e)}}})))}on_load_success(e){return s.__awaiter(this,void 0,void 0,(function*(){if(e instanceof o.Object3D)switch(this.ext){case"gltf":case"glb":return this.on_load_succes_gltf(e);case"obj":case"json":default:return[e]}if(e instanceof i.BufferGeometry)switch(this.ext){case"drc":return this.on_load_succes_drc(e);default:return[new a.Mesh(e)]}switch(this.ext){case"gltf":case"glb":return this.on_load_succes_gltf(e);default:return[]}return[]}))}on_load_succes_gltf(e){const t=e.scene;return t.animations=e.animations,console.log("[scene]",[t]),[t]}on_load_succes_drc(e){const t=new _.MeshLambertMaterial;return[new a.Mesh(e,t)]}loader_for_ext(){return s.__awaiter(this,void 0,void 0,(function*(){switch(this.ext.toLowerCase()){case"gltf":return this.loader_for_gltf();case"glb":return this.loader_for_glb();case"drc":return this.loader_for_drc();case"obj":return this.loader_for_obj()}}))}loader_for_gltf(){return s.__awaiter(this,void 0,void 0,(function*(){const{GLTFLoader:e}=yield Promise.resolve().then(()=>s.__importStar(n(386)));return new e}))}loader_for_glb(){return s.__awaiter(this,void 0,void 0,(function*(){const{GLTFLoader:e}=yield Promise.resolve().then(()=>s.__importStar(n(386))),{DRACOLoader:t}=yield Promise.resolve().then(()=>s.__importStar(n(387))),r=new e,o=new t;return o.setDecoderPath("/three/js/libs/draco/gltf/"),o.setDecoderConfig({type:"js"}),r.setDRACOLoader(o),r}))}loader_for_drc(){return s.__awaiter(this,void 0,void 0,(function*(){const{DRACOLoader:e}=yield Promise.resolve().then(()=>s.__importStar(n(387))),t=new e;return t.setDecoderPath("/three/js/libs/draco/"),t.setDecoderConfig({type:"js"}),t}))}loader_for_obj(){return s.__awaiter(this,void 0,void 0,(function*(){const{OBJLoader:e}=yield Promise.resolve().then(()=>s.__importStar(n(862)));return new e}))}}},function(e,t,n){"use strict";n.r(t),n.d(t,"OBJLoader",(function(){return m}));var s=n(6),r=n(30),o=n(4),i=n(40),a=n(41),_=n(57),c=n(18),l=n(9),u=n(22),d=n(226),h=n(96),p=n(71),m=function(){var e=/^[og]\s*(.+)?/,t=/^mtllib /,n=/^usemtl /,m=/^usemap /;function f(){var e={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materials:{},materialLibraries:[],startObject:function(e,t){if(this.object&&!1===this.object.fromDeclaration)return this.object.name=e,void(this.object.fromDeclaration=!1!==t);var n=this.object&&"function"==typeof this.object.currentMaterial?this.object.currentMaterial():void 0;if(this.object&&"function"==typeof this.object._finalize&&this.object._finalize(!0),this.object={name:e||"",fromDeclaration:!1!==t,geometry:{vertices:[],normals:[],colors:[],uvs:[]},materials:[],smooth:!0,startMaterial:function(e,t){var n=this._finalize(!1);n&&(n.inherited||n.groupCount<=0)&&this.materials.splice(n.index,1);var s={index:this.materials.length,name:e||"",mtllib:Array.isArray(t)&&t.length>0?t[t.length-1]:"",smooth:void 0!==n?n.smooth:this.smooth,groupStart:void 0!==n?n.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(e){var t={index:"number"==typeof e?e:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return t.clone=this.clone.bind(t),t}};return this.materials.push(s),s},currentMaterial:function(){if(this.materials.length>0)return this.materials[this.materials.length-1]},_finalize:function(e){var t=this.currentMaterial();if(t&&-1===t.groupEnd&&(t.groupEnd=this.geometry.vertices.length/3,t.groupCount=t.groupEnd-t.groupStart,t.inherited=!1),e&&this.materials.length>1)for(var n=this.materials.length-1;n>=0;n--)this.materials[n].groupCount<=0&&this.materials.splice(n,1);return e&&0===this.materials.length&&this.materials.push({name:"",smooth:this.smooth}),t}},n&&n.name&&"function"==typeof n.clone){var s=n.clone(0);s.inherited=!0,this.object.materials.push(s)}this.objects.push(this.object)},finalize:function(){this.object&&"function"==typeof this.object._finalize&&this.object._finalize(!0)},parseVertexIndex:function(e,t){var n=parseInt(e,10);return 3*(n>=0?n-1:n+t/3)},parseNormalIndex:function(e,t){var n=parseInt(e,10);return 3*(n>=0?n-1:n+t/3)},parseUVIndex:function(e,t){var n=parseInt(e,10);return 2*(n>=0?n-1:n+t/2)},addVertex:function(e,t,n){var s=this.vertices,r=this.object.geometry.vertices;r.push(s[e+0],s[e+1],s[e+2]),r.push(s[t+0],s[t+1],s[t+2]),r.push(s[n+0],s[n+1],s[n+2])},addVertexPoint:function(e){var t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addVertexLine:function(e){var t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addNormal:function(e,t,n){var s=this.normals,r=this.object.geometry.normals;r.push(s[e+0],s[e+1],s[e+2]),r.push(s[t+0],s[t+1],s[t+2]),r.push(s[n+0],s[n+1],s[n+2])},addColor:function(e,t,n){var s=this.colors,r=this.object.geometry.colors;r.push(s[e+0],s[e+1],s[e+2]),r.push(s[t+0],s[t+1],s[t+2]),r.push(s[n+0],s[n+1],s[n+2])},addUV:function(e,t,n){var s=this.uvs,r=this.object.geometry.uvs;r.push(s[e+0],s[e+1]),r.push(s[t+0],s[t+1]),r.push(s[n+0],s[n+1])},addUVLine:function(e){var t=this.uvs;this.object.geometry.uvs.push(t[e+0],t[e+1])},addFace:function(e,t,n,s,r,o,i,a,_){var c=this.vertices.length,l=this.parseVertexIndex(e,c),u=this.parseVertexIndex(t,c),d=this.parseVertexIndex(n,c);if(this.addVertex(l,u,d),this.colors.length>0&&this.addColor(l,u,d),void 0!==s&&""!==s){var h=this.uvs.length;l=this.parseUVIndex(s,h),u=this.parseUVIndex(r,h),d=this.parseUVIndex(o,h),this.addUV(l,u,d)}if(void 0!==i&&""!==i){var p=this.normals.length;l=this.parseNormalIndex(i,p),u=i===a?l:this.parseNormalIndex(a,p),d=i===_?l:this.parseNormalIndex(_,p),this.addNormal(l,u,d)}},addPointGeometry:function(e){this.object.geometry.type="Points";for(var t=this.vertices.length,n=0,s=e.length;n<s;n++)this.addVertexPoint(this.parseVertexIndex(e[n],t))},addLineGeometry:function(e,t){this.object.geometry.type="Line";for(var n=this.vertices.length,s=this.uvs.length,r=0,o=e.length;r<o;r++)this.addVertexLine(this.parseVertexIndex(e[r],n));var i=0;for(o=t.length;i<o;i++)this.addUVLine(this.parseUVIndex(t[i],s))}};return e.startObject("",!1),e}function g(e){c.a.call(this,e),this.materials=null}return g.prototype=Object.assign(Object.create(c.a.prototype),{constructor:g,load:function(e,t,n,s){var o=this,i=new r.a(o.manager);i.setPath(this.path),i.load(e,(function(e){t(o.parse(e))}),n,s)},setMaterials:function(e){return this.materials=e,this},parse:function(r){var c=new f;-1!==r.indexOf("\r\n")&&(r=r.replace(/\r\n/g,"\n")),-1!==r.indexOf("\\\n")&&(r=r.replace(/\\\n/g,""));for(var g=r.split("\n"),v="",y="",b=[],x="function"==typeof"".trimLeft,T=0,C=g.length;T<C;T++)if(v=g[T],0!==(v=x?v.trimLeft():v.trim()).length&&"#"!==(y=v.charAt(0)))if("v"===y){var P=v.split(/\s+/);switch(P[0]){case"v":c.vertices.push(parseFloat(P[1]),parseFloat(P[2]),parseFloat(P[3])),P.length>=7&&c.colors.push(parseFloat(P[4]),parseFloat(P[5]),parseFloat(P[6]));break;case"vn":c.normals.push(parseFloat(P[1]),parseFloat(P[2]),parseFloat(P[3]));break;case"vt":c.uvs.push(parseFloat(P[1]),parseFloat(P[2]))}}else if("f"===y){for(var w=v.substr(1).trim().split(/\s+/),E=[],O=0,A=w.length;O<A;O++){var N=w[O];if(N.length>0){var M=N.split("/");E.push(M)}}var S=E[0];for(O=1,A=E.length-1;O<A;O++){var R=E[O],j=E[O+1];c.addFace(S[0],R[0],j[0],S[1],R[1],j[1],S[2],R[2],j[2])}}else if("l"===y){var L=v.substring(1).trim().split(" "),k=[],G=[];if(-1===v.indexOf("/"))k=L;else for(var z=0,I=L.length;z<I;z++){var D=L[z].split("/");""!==D[0]&&k.push(D[0]),""!==D[1]&&G.push(D[1])}c.addLineGeometry(k,G)}else if("p"===y){var F=v.substr(1).trim().split(" ");c.addPointGeometry(F)}else if(null!==(b=e.exec(v))){var B=(" "+b[0].substr(1).trim()).substr(1);c.startObject(B)}else if(n.test(v))c.object.startMaterial(v.substring(7).trim(),c.materialLibraries);else if(t.test(v))c.materialLibraries.push(v.substring(7).trim());else if(m.test(v))console.warn('THREE.OBJLoader: Rendering identifier "usemap" not supported. Textures must be defined in MTL files.');else if("s"===y){if((b=v.split(" ")).length>1){var V=b[1].trim().toLowerCase();c.object.smooth="0"!==V&&"off"!==V}else c.object.smooth=!0;(ne=c.object.currentMaterial())&&(ne.smooth=c.object.smooth)}else{if("\0"===v)continue;console.warn('THREE.OBJLoader: Unexpected line: "'+v+'"')}c.finalize();var U=new i.Group;U.materialLibraries=[].concat(c.materialLibraries);for(T=0,C=c.objects.length;T<C;T++){var q=c.objects[T],$=q.geometry,Y=q.materials,H="Line"===$.type,X="Points"===$.type,W=!1;if(0!==$.vertices.length){var J=new s.BufferGeometry;J.setAttribute("position",new o.Float32BufferAttribute($.vertices,3)),$.normals.length>0?J.setAttribute("normal",new o.Float32BufferAttribute($.normals,3)):J.computeVertexNormals(),$.colors.length>0&&(W=!0,J.setAttribute("color",new o.Float32BufferAttribute($.colors,3))),$.uvs.length>0&&J.setAttribute("uv",new o.Float32BufferAttribute($.uvs,2));for(var K,Z=[],Q=0,ee=Y.length;Q<ee;Q++){var te=(oe=Y[Q]).name+"_"+oe.smooth+"_"+W,ne=c.materials[te];if(null!==this.materials)if(ne=this.materials.create(oe.name),!H||!ne||ne instanceof a.LineBasicMaterial){if(X&&ne&&!(ne instanceof p.PointsMaterial)){var se=new p.PointsMaterial({size:10,sizeAttenuation:!1});l.Material.prototype.copy.call(se,ne),se.color.copy(ne.color),se.map=ne.map,ne=se}}else{var re=new a.LineBasicMaterial;l.Material.prototype.copy.call(re,ne),re.color.copy(ne.color),ne=re}void 0===ne&&((ne=H?new a.LineBasicMaterial:X?new p.PointsMaterial({size:1,sizeAttenuation:!1}):new d.a).name=oe.name,ne.flatShading=!oe.smooth,ne.vertexColors=W,c.materials[te]=ne),Z.push(ne)}if(Z.length>1){for(Q=0,ee=Y.length;Q<ee;Q++){var oe=Y[Q];J.addGroup(oe.groupStart,oe.groupCount,Q)}K=H?new _.LineSegments(J,Z):X?new h.Points(J,Z):new u.Mesh(J,Z)}else K=H?new _.LineSegments(J,Z[0]):X?new h.Points(J,Z[0]):new u.Mesh(J,Z[0]);K.name=q.name,U.add(K)}}return U}}),g}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(13),r=n(53),o=n(1),i=n(5),a=n(17);class _ extends i.NodeParamsConfig{constructor(){super(...arguments),this.dist=i.ParamConfig.FLOAT(.1,{range:[0,1],range_locked:[!0,!1]})}}const c=new _;class l extends s.TypedSopNode{constructor(){super(...arguments),this.params_config=c}static type(){return"fuse"}static displayed_input_names(){return["points to fuse together"]}initialize_node(){this.io.inputs.set_count(1),this.io.inputs.init_inputs_clonable_state([a.InputCloneMode.FROM_NODE])}cook(e){const t=e[0],n=[];let s;for(let e of t.core_objects())s=this._fuse_core_object(e),s&&n.push(s);this.set_objects(n)}_fuse_core_object(e){const t=e.object();if(!t)return;const n=e.points(),s=this.pv.dist,i={};for(let e of n){const t=e.position(),n=new o.Vector3(Math.round(t.x/s),Math.round(t.y/s),Math.round(t.z/s)).toArray().join("-");i[n]=i[n]||[],i[n].push(e)}const a=[];return Object.keys(i).forEach(e=>{a.push(i[e][0])}),t.geometry.dispose(),a.length>0?(t.geometry=r.CoreGeometry.geometry_from_points(a,t.constructor),t):void 0}}t.FuseSopNode=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(1),r=n(13),o=n(85),i=n(35),a=n(865),_=new s.Vector3(0,1,0),c=n(5);class l extends c.NodeParamsConfig{constructor(){super(...arguments),this.size=c.ParamConfig.VECTOR2([1,1]),this.hexagon_radius=c.ParamConfig.FLOAT(.1),this.direction=c.ParamConfig.VECTOR3([0,1,0]),this.points_only=c.ParamConfig.BOOLEAN(0)}}const u=new l;class d extends r.TypedSopNode{constructor(){super(...arguments),this.params_config=u,this._core_transform=new o.CoreTransform}static type(){return"hexagons"}initialize_node(){}cook(){const e=new a.CoreGeometryOperationHexagon(this.pv.size,this.pv.hexagon_radius,this.pv.points_only).process();this._core_transform.rotate_geometry(e,_,this.pv.direction),this.pv.points_only?this.set_geometry(e,i.CoreConstant.OBJECT_TYPE.POINTS):this.set_geometry(e)}}t.HexagonsSopNode=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),r=n(2),o=n(6),i={BufferAttribute:n(4).BufferAttribute,BufferGeometry:o.BufferGeometry,Vector2:r.Vector2},a=s.__importDefault(n(83));t.CoreGeometryOperationHexagon=class{constructor(e,t,n){this._param_size=e,this._param_hexagon_radius=t,this._param_points_only=n}process(){const e=this._param_hexagon_radius,t=.5*e,n=e,s=Math.cos(Math.PI/6)*this._param_hexagon_radius,r=Math.floor(this._param_size.x/n),o=Math.floor(this._param_size.y/s);let _=[],c=[];for(let e=0;e<o;e++)for(let o=0;o<r;o++)_.push([-.5*this._param_size.x+o*n+(e%2==0?t:0),0,-.5*this._param_size.y+e*s]),this._param_points_only||e>=1&&(0==o||o==r-1?0==o?c.push([o+1+(e-1)*r,o+(e-1)*r,o+e*r]):c.push([o+e*r,o+(e-1)*r,o-1+e*r]):(c.push([o+e*r,o+(e-1)*r,o-1+e*r]),c.push([o+e*r,o+1+(e-1)*r,o+(e-1)*r])));_=a.default(_);const l=new i.BufferGeometry;return l.setAttribute("position",new i.BufferAttribute(new Float32Array(_),3)),this._param_points_only||(c=a.default(c),l.setIndex(c),l.computeVertexNormals()),l}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(10),r={Group:n(40).Group,Object3D:s.Object3D},o=n(13);var i;!function(e){e.ADD_PARENT="add_parent",e.REMOVE_PARENT="remove_parent"}(i=t.HierarchyMode||(t.HierarchyMode={})),t.HIERARCHY_MODES=[i.ADD_PARENT,i.REMOVE_PARENT];const a=n(5);class _ extends a.NodeParamsConfig{constructor(){super(...arguments),this.mode=a.ParamConfig.INTEGER(0,{menu:{entries:t.HIERARCHY_MODES.map((e,t)=>({name:e,value:t}))}}),this.levels=a.ParamConfig.INTEGER(1,{range:[0,5]})}}const c=new _;class l extends o.TypedSopNode{constructor(){super(...arguments),this.params_config=c}static type(){return"hierarchy"}static displayed_input_names(){return["geometry to add or remove parents to/from"]}initialize_node(){this.io.inputs.set_count(1)}cook(e){const n=e[0];if(t.HIERARCHY_MODES[this.pv.mode]==i.ADD_PARENT){const e=this._add_parent_to_core_group(n);this.set_objects(e)}else{const e=this._remove_parent_from_core_group(n);this.set_objects(e)}}_add_parent_to_core_group(e){if(0==this.pv.levels)return e.objects();{const t=[];let n;for(let s of e.objects())n=this._add_parent_to_object(s),n&&t.push(n);return t}}_add_parent_to_object(e){let t=new r.Group;if(t.add(e),this.pv.levels>0)for(let e=0;e<this.pv.levels-1;e++)t=this._add_new_parent(t);return t}_add_new_parent(e){const t=new r.Group;return t.add(e),t}_remove_parent_from_core_group(e){if(0==this.pv.levels)return e.objects();{const t=[];for(let n of e.objects()){const e=this._remove_parent_from_object(n);for(let n of e)t.push(n)}return t}}_remove_parent_from_object(e){let t=e.children;for(let e=0;e<this.pv.levels-1;e++)t=this._get_children_from_objects(t);return t}_get_children_from_objects(e){let t;const n=[];for(;t=e.pop();)if(t.children)for(let e of t.children)n.push(e);return n}}t.HierarchySopNode=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),r=n(13),o=n(384),i=n(161),a=n(17),_=n(132),c=n(27),l=n(5),u=n(35);class d extends l.NodeParamsConfig{constructor(){super(...arguments),this.attributes_to_copy=l.ParamConfig.STRING("instance*"),this.apply_material=l.ParamConfig.BOOLEAN(1),this.material=l.ParamConfig.OPERATOR_PATH("",{visible_if:{apply_material:1},node_selection:{context:c.NodeContext.MAT},dependent_on_found_node:!1})}}const h=new d;class p extends r.TypedSopNode{constructor(){super(...arguments),this.params_config=h,this._on_create_bound=this._on_create.bind(this)}static type(){return"instance"}static displayed_input_names(){return["geometry to be instanciated","points to instance to"]}initialize_node(){super.initialize_node(),this.lifecycle.add_on_create_hook(this._on_create_bound),this.io.inputs.set_count(2),this.io.inputs.init_inputs_clonable_state([a.InputCloneMode.ALWAYS,a.InputCloneMode.NEVER])}cook(e){return s.__awaiter(this,void 0,void 0,(function*(){const t=e[0];this._geometry=void 0;const n=t.objects()[0];if(n){const t=n.geometry;if(t){const n=e[1];this._create_instance(t,n)}}if(this._geometry){const e=u.ObjectTypeByObject(n);if(e){const t=this.create_object(this._geometry,e);this.pv.apply_material&&(yield this._apply_material(t)),this.set_object(t)}else this.cook_controller.end_cook()}else this.cook_controller.end_cook()}))}_apply_material(e){return s.__awaiter(this,void 0,void 0,(function*(){const t=this.p.material.found_node();if(t)if(t.node_context()==c.NodeContext.MAT){const n=t;this._globals_handler=this._globals_handler||new _.GlobalsGeometryHandler;const s=n;s.assembler_controller&&s.assembler_controller.set_assembler_globals_handler(this._globals_handler);const r=(yield n.request_container()).material();r&&(e.material=r,i.CoreMaterial.apply_custom_materials(e,r))}else this.states.error.set("found node is not a material");else this.states.error.set("material node invalid")}))}_create_instance(e,t){this._geometry=o.CoreInstancer.create_instance_buffer_geo(e,t,this.pv.attributes_to_copy)}_on_create(){const e=this.scene.root;let t;const n=e.node("MAT");n&&"materials"==n.type?t=n:(t=e.create_node("materials"),t.set_name("MAT"));const s=t.node("mesh_lambert_builder1")||((e,t)=>{const n=e.create_node("mesh_lambert_builder");n.set_name(t);const s=n.create_node("instance_transform");let r=n.node("output1");return r||(r=n.create_node("output")),r.set_input("position",s,"position"),r.set_input("normal",s,"normal"),n})(t,"mesh_lambert_builder1");this.p.material.set(s.full_path())}}t.InstanceSopNode=p},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s={Vector3:n(1).Vector3},r=n(104),o=n(13),i=n(5),a=n(17);class _ extends i.NodeParamsConfig{constructor(){super(...arguments),this.amount=i.ParamConfig.FLOAT(1),this.seed=i.ParamConfig.INTEGER(1,{range:[0,100]})}}const c=new _;class l extends o.TypedSopNode{constructor(){super(...arguments),this.params_config=c}static type(){return"jitter"}static displayed_input_names(){return["geometry to jitter points of"]}initialize_node(){this.io.inputs.set_count(1),this.io.inputs.init_inputs_clonable_state([a.InputCloneMode.FROM_NODE])}cook(e){const t=e[0];t.points().forEach((e,t)=>{const n=new s.Vector3(2*(r.CoreMath.rand(75*t+764+this.pv.seed)-.5),2*(r.CoreMath.rand(5678*t+3653+this.pv.seed)-.5),2*(r.CoreMath.rand(657*t+48464+this.pv.seed)-.5));n.normalize(),n.multiplyScalar(this.pv.amount);const o=e.position().clone().add(n);e.set_position(o)}),this.set_core_group(t)}}t.JitterSopNode=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(13),r=n(5),o=n(17);class i extends r.NodeParamsConfig{constructor(){super(...arguments),this.layer=r.ParamConfig.INTEGER(0,{range:[0,31],range_locked:[!0,!0]})}}const a=new i;class _ extends s.TypedSopNode{constructor(){super(...arguments),this.params_config=a}static type(){return"layer"}static displayed_input_names(){return["objects to change layers of"]}initialize_node(){this.io.inputs.set_count(1),this.io.inputs.init_inputs_clonable_state([o.InputCloneMode.FROM_NODE])}cook(e){const t=e[0];for(let e of t.objects())e.layers.set(this.pv.layer);this.set_core_group(t)}}t.LayerSopNode=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),r=n(4),o=n(6),i=s.__importDefault(n(208)),a=n(13),_=n(35),c=n(5);class l extends c.NodeParamsConfig{constructor(){super(...arguments),this.length=c.ParamConfig.FLOAT(1,{range:[0,10]}),this.points_count=c.ParamConfig.INTEGER(1,{range:[2,100],range_locked:[!0,!1]}),this.origin=c.ParamConfig.VECTOR3([0,0,0]),this.direction=c.ParamConfig.VECTOR3([0,1,0])}}const u=new l;class d extends a.TypedSopNode{constructor(){super(...arguments),this.params_config=u}static type(){return"line"}initialize_node(){}cook(){const e=Math.max(2,this.pv.points_count),t=new Array(3*e),n=new Array(e),s=this.pv.direction.clone().normalize().multiplyScalar(this.pv.length);i.default(e,r=>{const o=r/(e-1),i=s.clone().multiplyScalar(o);i.add(this.pv.origin),i.toArray(t,3*r),r>0&&(n[2*(r-1)]=r-1,n[2*(r-1)+1]=r)});const a=new o.BufferGeometry;a.setAttribute("position",new r.Float32BufferAttribute(t,3)),a.setIndex(n),this.set_geometry(a,_.CoreConstant.OBJECT_TYPE.LINE_SEGMENTS)}}t.LineSopNode=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),r=n(13),o=n(161),i=n(132),a=n(17),_=n(27),c=n(26),l=n(5);class u extends l.NodeParamsConfig{constructor(){super(...arguments),this.group=l.ParamConfig.STRING(""),this.material=l.ParamConfig.OPERATOR_PATH("/MAT/mesh_standard1",{node_selection:{context:_.NodeContext.MAT},dependent_on_found_node:!1}),this.apply_to_children=l.ParamConfig.BOOLEAN(0)}}const d=new u;class h extends r.TypedSopNode{constructor(){super(...arguments),this.params_config=d,this._globals_handler=new i.GlobalsGeometryHandler}static type(){return"material"}static displayed_input_names(){return["objects to assign material to"]}initialize_node(){this.io.inputs.set_count(1),this.io.inputs.init_inputs_clonable_state([a.InputCloneMode.FROM_NODE])}cook(e){return s.__awaiter(this,void 0,void 0,(function*(){const t=e[0],n=this.p.material.found_node();if(n)if(n.node_context()!=_.NodeContext.MAT)this.states.error.set("node is not a material");else{const e=n,s=e.material;if(s instanceof c.ShaderMaterial){n.assembler_controller.set_assembler_globals_handler(this._globals_handler)}if(yield e.request_container(),s){for(let e of t.objects_from_group(this.pv.group))this.pv.apply_to_children?e.traverse(e=>{this.apply_material(e,s)}):this.apply_material(e,s);this.set_core_group(t)}else this.states.error.set(`material invalid. (error: '${e.states.error.message}')`)}else this.states.error.set(`node '${this.pv.material}' not found`)}))}apply_material(e,t){e.material=t,o.CoreMaterial.apply_custom_materials(e,t)}}t.MaterialSopNode=h},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(13),r=n(53),o=n(35),i="geometry to merge",a=n(5);class _ extends a.NodeParamsConfig{constructor(){super(...arguments),this.compact=a.ParamConfig.BOOLEAN(1)}}const c=new _;class l extends s.TypedSopNode{constructor(){super(...arguments),this.params_config=c}static type(){return"merge"}static displayed_input_names(){return[i,i,i,i]}initialize_node(){this.io.inputs.set_count(1,4),this.ui_data.set_width(100)}cook(e){let t=[];for(let n of e)if(n){const e=n.objects();for(let n of e)n.traverse(e=>{t.push(e)})}this.pv.compact&&(t=this._make_compact(t)),this.set_objects(t)}_make_compact(e){const t={[o.ObjectType.MESH]:[],[o.ObjectType.POINTS]:[],[o.ObjectType.LINE_SEGMENTS]:[]},n=[];for(let n of e)n.traverse(e=>{const n=e;n.geometry&&(n.isMesh?t[o.ObjectType.MESH].push(n):n.isLineSegments?t[o.ObjectType.LINE_SEGMENTS].push(n):n.isPoints&&t[o.ObjectType.POINTS].push(n))});for(let e of Object.keys(t)){const s=t[e],o=[];for(let e of s){const t=e.geometry;t.applyMatrix4(e.matrix),o.push(t)}const i=r.CoreGeometry.merge_geometries(o);if(i){const t=this.create_object(i,e);n.push(t)}}return n}}t.MergeSopNode=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),r=n(1),o=n(2),i=n(13),a=n(104),_=n(17),c=n(193),l=n(874);var u;!function(e){e.ADD="add",e.SET="set",e.MULT="mult",e.SUBSTRACT="substract",e.DIVIDE="divide"}(u||(u={}));const d=[u.ADD,u.SET,u.MULT,u.SUBSTRACT,u.DIVIDE],h=n(5);class p extends h.NodeParamsConfig{constructor(){super(...arguments),this.amount=h.ParamConfig.FLOAT(1),this.freq=h.ParamConfig.VECTOR3([1,1,1]),this.offset=h.ParamConfig.VECTOR3([0,0,0]),this.octaves=h.ParamConfig.INTEGER(3,{range:[1,8],range_locked:[!0,!1]}),this.amp_attenuation=h.ParamConfig.FLOAT(.5,{range:[0,1]}),this.freq_increase=h.ParamConfig.FLOAT(2,{range:[0,10]}),this.seed=h.ParamConfig.INTEGER(0,{range:[0,100]}),this.separator=h.ParamConfig.SEPARATOR(),this.use_normals=h.ParamConfig.BOOLEAN(0),this.attrib_name=h.ParamConfig.STRING("position"),this.operation=h.ParamConfig.INTEGER(d.indexOf(u.ADD),{menu:{entries:d.map(e=>({name:e,value:d.indexOf(e)}))}}),this.compute_normals=h.ParamConfig.BOOLEAN(1)}}const m=new p;class f extends i.TypedSopNode{constructor(){super(...arguments),this.params_config=m,this._simplex_by_seed=new Map,this._rest_points=[]}static type(){return"noise"}static displayed_input_names(){return["geometry to add noise to","rest geometry"]}initialize_node(){this.io.inputs.set_count(1,2),this.io.inputs.init_inputs_clonable_state([_.InputCloneMode.FROM_NODE,_.InputCloneMode.NEVER])}cook(e){return s.__awaiter(this,void 0,void 0,(function*(){const t=e[0],n=e[1],s=t.points();n&&(null!=this._rest_core_group_timestamp&&this._rest_core_group_timestamp==n.timestamp()||(this._rest_points=n.points(),this._rest_core_group_timestamp=n.timestamp()));const i=this._get_simplex(),a=this.pv.use_normals&&t.has_attrib("normal"),_=t.attrib_size(this.pv.attrib_name);for(let e=0;e<s.length;e++){const t=s[e];let l=n?this._rest_points[e]:t;const h=l.attrib_value(this.pv.attrib_name),p=l.position().add(this.pv.offset).multiply(this.pv.freq);let m=(()=>{if(a){const e=l.attrib_value("normal"),t=this.pv.amount*this._fbm(i,p.x,p.y,p.z);return e.clone().multiplyScalar(t)}return new r.Vector3(this.pv.amount*this._fbm(i,p.x+545,p.y+125454,p.z+2142),this.pv.amount*this._fbm(i,p.x-425,p.y-25746,p.z+95242),this.pv.amount*this._fbm(i,p.x+765132,p.y+21,p.z-9245))})();m=(()=>{switch(_){case 1:return m.x;case 2:return new o.Vector2(m.x,m.y);case 3:return m}})();const f=(()=>{const e=d[this.pv.operation];switch(_){case 1:switch(e){case u.ADD:return h+m;case u.SET:return m;case u.MULT:return h*m;case u.DIVIDE:return h/m;case u.SUBSTRACT:return h-m}c.TypeAssert.unreachable(e);break;default:switch(e){case u.ADD:return h.add(m);case u.SET:return m;case u.MULT:return h.multiply(m);case u.DIVIDE:return h.divide(m);case u.SUBSTRACT:return h.sub(m)}c.TypeAssert.unreachable(e)}})();t.set_attrib_value(this.pv.attrib_name,f)}if(!this.io.inputs.input_cloned(0))for(let e of t.geometries())e.getAttribute(this.pv.attrib_name).needsUpdate=!0;this.pv.compute_normals&&t.compute_vertex_normals(),this.set_core_group(t)}))}_fbm(e,t,n,s){let r=0,o=1;for(let i=0;i<this.pv.octaves;i++)r+=o*e.noise3d(t,n,s),t*=this.pv.freq_increase,n*=this.pv.freq_increase,s*=this.pv.freq_increase,o*=this.pv.amp_attenuation;return r}_get_simplex(){const e=this._simplex_by_seed.get(this.pv.seed);if(e)return e;{const e=this._create_simplex();return this._simplex_by_seed.set(this.pv.seed,e),e}}_create_simplex(){const e=this.pv.seed,t={random:function(){return a.CoreMath.rand_float(e)}},n=new l.SimplexNoise(t);return this._simplex_by_seed.delete(e),n}}t.NoiseSopNode=f},function(e,t,n){"use strict";n.r(t),n.d(t,"SimplexNoise",(function(){return s}));var s=function(e){null==e&&(e=Math),this.grad3=[[1,1,0],[-1,1,0],[1,-1,0],[-1,-1,0],[1,0,1],[-1,0,1],[1,0,-1],[-1,0,-1],[0,1,1],[0,-1,1],[0,1,-1],[0,-1,-1]],this.grad4=[[0,1,1,1],[0,1,1,-1],[0,1,-1,1],[0,1,-1,-1],[0,-1,1,1],[0,-1,1,-1],[0,-1,-1,1],[0,-1,-1,-1],[1,0,1,1],[1,0,1,-1],[1,0,-1,1],[1,0,-1,-1],[-1,0,1,1],[-1,0,1,-1],[-1,0,-1,1],[-1,0,-1,-1],[1,1,0,1],[1,1,0,-1],[1,-1,0,1],[1,-1,0,-1],[-1,1,0,1],[-1,1,0,-1],[-1,-1,0,1],[-1,-1,0,-1],[1,1,1,0],[1,1,-1,0],[1,-1,1,0],[1,-1,-1,0],[-1,1,1,0],[-1,1,-1,0],[-1,-1,1,0],[-1,-1,-1,0]],this.p=[];for(var t=0;t<256;t++)this.p[t]=Math.floor(256*e.random());this.perm=[];for(t=0;t<512;t++)this.perm[t]=this.p[255&t];this.simplex=[[0,1,2,3],[0,1,3,2],[0,0,0,0],[0,2,3,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,3,0],[0,2,1,3],[0,0,0,0],[0,3,1,2],[0,3,2,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,3,2,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,0,3],[0,0,0,0],[1,3,0,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,3,0,1],[2,3,1,0],[1,0,2,3],[1,0,3,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,3,1],[0,0,0,0],[2,1,3,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,1,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,0,1,2],[3,0,2,1],[0,0,0,0],[3,1,2,0],[2,1,0,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,1,0,2],[0,0,0,0],[3,2,0,1],[3,2,1,0]]};s.prototype.dot=function(e,t,n){return e[0]*t+e[1]*n},s.prototype.dot3=function(e,t,n,s){return e[0]*t+e[1]*n+e[2]*s},s.prototype.dot4=function(e,t,n,s,r){return e[0]*t+e[1]*n+e[2]*s+e[3]*r},s.prototype.noise=function(e,t){var n,s,r=(e+t)*(.5*(Math.sqrt(3)-1)),o=Math.floor(e+r),i=Math.floor(t+r),a=(3-Math.sqrt(3))/6,_=(o+i)*a,c=e-(o-_),l=t-(i-_);c>l?(n=1,s=0):(n=0,s=1);var u=c-n+a,d=l-s+a,h=c-1+2*a,p=l-1+2*a,m=255&o,f=255&i,g=this.perm[m+this.perm[f]]%12,v=this.perm[m+n+this.perm[f+s]]%12,y=this.perm[m+1+this.perm[f+1]]%12,b=.5-c*c-l*l,x=.5-u*u-d*d,T=.5-h*h-p*p;return 70*((b<0?0:(b*=b)*b*this.dot(this.grad3[g],c,l))+(x<0?0:(x*=x)*x*this.dot(this.grad3[v],u,d))+(T<0?0:(T*=T)*T*this.dot(this.grad3[y],h,p)))},s.prototype.noise3d=function(e,t,n){var s,r,o,i,a,_,c=(e+t+n)*(1/3),l=Math.floor(e+c),u=Math.floor(t+c),d=Math.floor(n+c),h=1/6,p=(l+u+d)*h,m=e-(l-p),f=t-(u-p),g=n-(d-p);m>=f?f>=g?(s=1,r=0,o=0,i=1,a=1,_=0):m>=g?(s=1,r=0,o=0,i=1,a=0,_=1):(s=0,r=0,o=1,i=1,a=0,_=1):f<g?(s=0,r=0,o=1,i=0,a=1,_=1):m<g?(s=0,r=1,o=0,i=0,a=1,_=1):(s=0,r=1,o=0,i=1,a=1,_=0);var v=m-s+h,y=f-r+h,b=g-o+h,x=m-i+2*h,T=f-a+2*h,C=g-_+2*h,P=m-1+.5,w=f-1+.5,E=g-1+.5,O=255&l,A=255&u,N=255&d,M=this.perm[O+this.perm[A+this.perm[N]]]%12,S=this.perm[O+s+this.perm[A+r+this.perm[N+o]]]%12,R=this.perm[O+i+this.perm[A+a+this.perm[N+_]]]%12,j=this.perm[O+1+this.perm[A+1+this.perm[N+1]]]%12,L=.6-m*m-f*f-g*g,k=.6-v*v-y*y-b*b,G=.6-x*x-T*T-C*C,z=.6-P*P-w*w-E*E;return 32*((L<0?0:(L*=L)*L*this.dot3(this.grad3[M],m,f,g))+(k<0?0:(k*=k)*k*this.dot3(this.grad3[S],v,y,b))+(G<0?0:(G*=G)*G*this.dot3(this.grad3[R],x,T,C))+(z<0?0:(z*=z)*z*this.dot3(this.grad3[j],P,w,E)))},s.prototype.noise4d=function(e,t,n,s){var r,o,i,a,_,c,l,u,d,h,p,m,f=this.grad4,g=this.simplex,v=this.perm,y=(Math.sqrt(5)-1)/4,b=(5-Math.sqrt(5))/20,x=(e+t+n+s)*y,T=Math.floor(e+x),C=Math.floor(t+x),P=Math.floor(n+x),w=Math.floor(s+x),E=(T+C+P+w)*b,O=e-(T-E),A=t-(C-E),N=n-(P-E),M=s-(w-E),S=(O>A?32:0)+(O>N?16:0)+(A>N?8:0)+(O>M?4:0)+(A>M?2:0)+(N>M?1:0),R=O-(r=g[S][0]>=3?1:0)+b,j=A-(o=g[S][1]>=3?1:0)+b,L=N-(i=g[S][2]>=3?1:0)+b,k=M-(a=g[S][3]>=3?1:0)+b,G=O-(_=g[S][0]>=2?1:0)+2*b,z=A-(c=g[S][1]>=2?1:0)+2*b,I=N-(l=g[S][2]>=2?1:0)+2*b,D=M-(u=g[S][3]>=2?1:0)+2*b,F=O-(d=g[S][0]>=1?1:0)+3*b,B=A-(h=g[S][1]>=1?1:0)+3*b,V=N-(p=g[S][2]>=1?1:0)+3*b,U=M-(m=g[S][3]>=1?1:0)+3*b,q=O-1+4*b,$=A-1+4*b,Y=N-1+4*b,H=M-1+4*b,X=255&T,W=255&C,J=255&P,K=255&w,Z=v[X+v[W+v[J+v[K]]]]%32,Q=v[X+r+v[W+o+v[J+i+v[K+a]]]]%32,ee=v[X+_+v[W+c+v[J+l+v[K+u]]]]%32,te=v[X+d+v[W+h+v[J+p+v[K+m]]]]%32,ne=v[X+1+v[W+1+v[J+1+v[K+1]]]]%32,se=.6-O*O-A*A-N*N-M*M,re=.6-R*R-j*j-L*L-k*k,oe=.6-G*G-z*z-I*I-D*D,ie=.6-F*F-B*B-V*V-U*U,ae=.6-q*q-$*$-Y*Y-H*H;return 27*((se<0?0:(se*=se)*se*this.dot4(f[Z],O,A,N,M))+(re<0?0:(re*=re)*re*this.dot4(f[Q],R,j,L,k))+(oe<0?0:(oe*=oe)*oe*this.dot4(f[ee],G,z,I,D))+(ie<0?0:(ie*=ie)*ie*this.dot4(f[te],F,B,V,U))+(ae<0?0:(ae*=ae)*ae*this.dot4(f[ne],q,$,Y,H)))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),r=n(13),o=n(17),i=n(5);class a extends i.NodeParamsConfig{constructor(){super(...arguments),this.edit=i.ParamConfig.BOOLEAN(0),this.update_x=i.ParamConfig.BOOLEAN(0,{visible_if:{edit:1}}),this.x=i.ParamConfig.FLOAT("@N.x",{visible_if:{update_x:1,edit:1},expression:{for_entities:!0}}),this.update_y=i.ParamConfig.BOOLEAN(0,{visible_if:{edit:1}}),this.y=i.ParamConfig.FLOAT("@N.y",{visible_if:{update_y:1,edit:1},expression:{for_entities:!0}}),this.update_z=i.ParamConfig.BOOLEAN(0,{visible_if:{edit:1}}),this.z=i.ParamConfig.FLOAT("@N.z",{visible_if:{update_z:1,edit:1},expression:{for_entities:!0}}),this.recompute=i.ParamConfig.BOOLEAN(0,{visible_if:{edit:0}}),this.invert=i.ParamConfig.BOOLEAN(0)}}const _=new a;class c extends r.TypedSopNode{constructor(){super(...arguments),this.params_config=_}static type(){return"normals"}static displayed_input_names(){return["geometry to update normals of"]}initialize_node(){this.io.inputs.set_count(1),this.io.inputs.init_inputs_clonable_state([o.InputCloneMode.FROM_NODE])}cook(e){return s.__awaiter(this,void 0,void 0,(function*(){const t=e[0];this.pv.edit?yield this._eval_expressions_for_core_group(t):t.compute_vertex_normals(),this.pv.invert&&this._invert_normals(t),this.set_core_group(t)}))}_eval_expressions_for_core_group(e){return s.__awaiter(this,void 0,void 0,(function*(){const t=e.core_objects();for(let e=0;e<t.length;e++)yield this._eval_expressions_for_core_object(t[e])}))}_eval_expressions_for_core_object(e){return s.__awaiter(this,void 0,void 0,(function*(){const t=e.object().geometry,n=e.points(),s=t.getAttribute("normal").array;if(this.pv.update_x)if(this.p.x.has_expression()&&this.p.x.expression_controller)yield this.p.x.expression_controller.compute_expression_for_points(n,(e,t)=>{s[3*e.index+0]=t});else{let e;for(let t=0;t<n.length;t++)e=n[t],s[3*e.index+0]=this.pv.x}if(this.pv.update_y)if(this.p.y.has_expression()&&this.p.y.expression_controller)yield this.p.y.expression_controller.compute_expression_for_points(n,(e,t)=>{s[3*e.index+1]=t});else{let e;for(let t=0;t<n.length;t++)e=n[t],s[3*e.index+1]=this.pv.y}if(this.pv.update_z)if(this.p.z.has_expression()&&this.p.z.expression_controller)yield this.p.z.expression_controller.compute_expression_for_points(n,(e,t)=>{s[3*e.index+2]=t});else{let e;for(let t=0;t<n.length;t++)e=n[t],s[3*e.index+2]=this.pv.z}}))}_invert_normals(e){for(let t of e.core_objects()){const e=t.core_geometry().geometry().attributes.normal;if(e){const t=e.array;for(let e=0;e<t.length;e++)t[e]*=-1}}}}t.NormalsSopNode=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(13),r=n(5),o=n(17);class i extends r.NodeParamsConfig{}const a=new i;class _ extends s.TypedSopNode{constructor(){super(...arguments),this.params_config=a}static type(){return"null"}initialize_node(){this.io.inputs.set_count(0,1),this.io.inputs.init_inputs_clonable_state([o.InputCloneMode.FROM_NODE]),this.ui_data.set_border_radius(1e3)}cook(e){const t=e[0];t?this.set_core_group(t):this.set_objects([])}}t.NullSopNode=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),r=n(13),o=n(27),i=n(5);class a extends i.NodeParamsConfig{constructor(){super(...arguments),this.geometry=i.ParamConfig.OPERATOR_PATH("",{node_selection:{context:o.NodeContext.SOP}})}}const _=new a;class c extends r.TypedSopNode{constructor(){super(...arguments),this.params_config=_}static type(){return"object_merge"}initialize_node(){}cook(e){return s.__awaiter(this,void 0,void 0,(function*(){const e=this.p.geometry.found_node();if(e)if(e.node_context()==o.NodeContext.SOP){const t=yield e.request_container();this.import_input(e,t)}else this.states.error.set("found node is not a geometry");else this.states.error.set(`node not found at path '${this.pv.geometry}'`)}))}import_input(e,t){let n;null!=(n=t.core_content_cloned())?this.set_core_group(n):this.states.error.set("invalid target")}}t.ObjectMergeSopNode=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),r=s.__importDefault(n(879)),o={Float32BufferAttribute:n(4).Float32BufferAttribute},i=n(13),a=n(17),_=n(5);class c extends _.NodeParamsConfig{constructor(){super(...arguments),this.attrib_name=_.ParamConfig.STRING("occlusion"),this.samples=_.ParamConfig.INTEGER(256,{range:[1,256],range_locked:[!0,!1]}),this.sep=_.ParamConfig.SEPARATOR(),this.buffer_resolution=_.ParamConfig.INTEGER(512),this.bias=_.ParamConfig.FLOAT(.01)}}const l=new c;class u extends i.TypedSopNode{constructor(){super(...arguments),this.params_config=l}static type(){return"occlusion"}initialize_node(){this.io.inputs.set_count(1),this.io.inputs.init_inputs_clonable_state([a.InputCloneMode.FROM_NODE])}cook(e){return s.__awaiter(this,void 0,void 0,(function*(){const t=e[0],n=t.core_objects();for(let e of n)yield this._process_occlusion_on_object(e);this.set_core_group(t)}))}_process_occlusion_on_object(e){var t;return s.__awaiter(this,void 0,void 0,(function*(){const n=e.core_geometry().geometry(),s=n.attributes.position.array,i=n.attributes.normal.array,a=null===(t=n.getIndex())||void 0===t?void 0:t.array,_=r.default(s,{cells:a,normals:i,resolution:this.pv.buffer_resolution,bias:this.pv.bias});for(let e=0;e<this.pv.samples;e++)_.sample();const c=_.report();n.setAttribute(this.pv.attrib_name,new o.Float32BufferAttribute(c,1)),_.dispose()}))}}t.OcclusionSopNode=u},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),r=n(13),o=n(972),i=n(279),a=n(17),_=n(27),c=n(131),l=n(977),u=n(978),d=n(5),h=n(268),p=n(375),m=n(369);class f extends d.NodeParamsConfig{constructor(){super(...arguments),this.start_frame=d.ParamConfig.FLOAT(1,{range:[1,100]}),this.auto_textures_size=d.ParamConfig.BOOLEAN(1),this.max_textures_size=d.ParamConfig.VECTOR2([1024,1024],{visible_if:{auto_textures_size:1}}),this.textures_size=d.ParamConfig.VECTOR2([64,64],{visible_if:{auto_textures_size:0}}),this.reset=d.ParamConfig.BUTTON(null,{callback:(e,t)=>{v.PARAM_CALLBACK_reset(e)}}),this.material=d.ParamConfig.OPERATOR_PATH("",{node_selection:{context:_.NodeContext.MAT},dependent_on_found_node:!1})}}const g=new f;class v extends r.TypedSopNode{constructor(){super(...arguments),this.params_config=g,this._assembler_controller=new c.GlAssemblerController(this,o.ShaderAssemblerParticles),this.gpu_controller=new u.ParticlesSystemGpuComputeController(this),this.render_controller=new l.ParticlesSystemGpuRenderController(this),this._reset_material_if_dirty_bound=this._reset_material_if_dirty.bind(this),this._children_controller_context=_.NodeContext.GL,this._on_create_prepare_material_bound=this._on_create_prepare_material.bind(this)}static type(){return"particles_system_gpu"}get assembler_controller(){return this._assembler_controller}static require_webgl2(){return!0}static PARAM_CALLBACK_reset(e){e.PARAM_CALLBACK_reset()}PARAM_CALLBACK_reset(){this.gpu_controller.reset_gpu_compute_and_set_dirty()}static displayed_input_names(){return["points to emit particles from"]}initialize_node(){var e;this.io.inputs.set_count(1),this.io.inputs.init_inputs_clonable_state([a.InputCloneMode.NEVER]),this.add_post_dirty_hook("_reset_material_if_dirty",this._reset_material_if_dirty_bound),this.lifecycle.add_on_create_hook(this.assembler_controller.on_create.bind(this.assembler_controller)),this.lifecycle.add_on_create_hook(this._on_create_prepare_material_bound),null===(e=this.children_controller)||void 0===e||e.init()}create_node(e){return super.create_node(e)}children(){return super.children()}nodes_by_type(e){return super.nodes_by_type(e)}_reset_material_if_dirty(){return s.__awaiter(this,void 0,void 0,(function*(){this.p.material.is_dirty&&(this.render_controller.reset_render_material(),this.is_on_frame_start()||(yield this.render_controller.init_render_material()))}))}is_on_frame_start(){return this.scene.frame==this.pv.start_frame}cook(e){return s.__awaiter(this,void 0,void 0,(function*(){this.gpu_controller.set_restart_not_required();const t=e[0];console.log("particles cook"),yield this.compile_if_required(),this.is_on_frame_start()&&this.gpu_controller.reset_particle_groups(),this.gpu_controller.initialized||(yield this.gpu_controller.init(t)),this.render_controller.initialized||(this.render_controller.init_core_group(t),yield this.render_controller.init_render_material()),this.gpu_controller.restart_simulation_if_required(),this.gpu_controller.compute_similation_if_required(),this.is_on_frame_start()?this.set_core_group(t):this.cook_controller.end_cook()}))}compile_if_required(){return s.__awaiter(this,void 0,void 0,(function*(){this.assembler_controller.compile_required()&&(yield this.run_assembler())}))}run_assembler(){return s.__awaiter(this,void 0,void 0,(function*(){const e=this._find_root_nodes();if(console.log("root_nodes",e),e.length>0){const t=new i.GlobalsTextureHandler(i.GlobalsTextureHandler.PARTICLE_SIM_UV);this.assembler_controller.set_assembler_globals_handler(t),this.assembler_controller.assembler.set_root_nodes(e),yield this.assembler_controller.assembler.compile(),yield this.assembler_controller.post_compile()}const t=this.assembler_controller.assembler.shaders_by_name();this.gpu_controller.set_shaders_by_name(t),this.render_controller.set_shaders_by_name(t),this.gpu_controller.reset_gpu_compute(),this.gpu_controller.reset_particle_groups(),yield this.assembler_controller.assign_uniform_values()}))}_find_root_nodes(){const e=h.GlNodeFinder.find_attribute_export_nodes(this),t=h.GlNodeFinder.find_output_nodes(this);if(t.length>1)return this.states.error.set("only one output node is allowed"),[];const n=t[0];return n&&e.push(n),e}_on_create_prepare_material(){const e=this.scene.root.nodes_by_type("materials")[0]||this.scene.root.create_node("materials");e.set_name("MAT");const t=e.node("points_particles")||((e,t)=>{let n=e.node("points_builder1");n&&n.type==p.PointsBuilderMatNode.type()||(n=e.create_node("points_builder")),n.set_name(t);let s=n.node("constant");s&&s.type==m.ConstantGlNode.type()||(s=n.create_node("constant"),s.set_name("constant_point_size")),s.p.float.set(4);const r=n.node("output1");return r&&r.set_input("gl_PointSize",s,m.ConstantGlNode.OUTPUT_NAME),n})(e,"points_particles");if(t){const e=t.full_path();this.p.material.raw_input!=e&&this.p.material.set(e)}}}t.ParticlesSystemGpuSopNode=v},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),r=n(157),o=s.__importDefault(n(973)),i=n(974),a=n(28),_=n(364),c=n(24),l=n(33),u=n(16),d=n(29);class h extends r.BaseGlShaderAssembler{get _template_shader(){}_template_shader_for_shader_name(e){return o.default}compile(){return s.__awaiter(this,void 0,void 0,(function*(){yield this.setup_shader_names_and_variables(),yield this.update_shaders()}))}root_nodes_by_shader_name(e){var t;const n=[];for(let s of this._root_nodes)switch(s.type){case"output":n.push(s);break;case"attribute":{const r=s.attribute_name,o=null===(t=this._texture_allocations_controller)||void 0===t?void 0:t.variable(r);if(o&&o.allocation){o.allocation.shader_name==e&&n.push(s)}break}}return n}leaf_nodes_by_shader_name(e){var t;const n=[];for(let s of this._leaf_nodes)switch(s.type){case"globals":n.push(s);break;case"attribute":{const r=s.attribute_name,o=null===(t=this._texture_allocations_controller)||void 0===t?void 0:t.variable(r);if(o&&o.allocation){o.allocation.shader_name==e&&n.push(s)}break}}return n}setup_shader_names_and_variables(){var e;return s.__awaiter(this,void 0,void 0,(function*(){const t=new _.TypedNodeTraverser(this,this._gl_parent_node);this._leaf_nodes=t.leaves_from_nodes(this._root_nodes);for(let e of this._root_nodes)yield e.params.eval_all();for(let e of this._leaf_nodes)yield e.params.eval_all();console.log("root and leaf:",this._root_nodes,this._leaf_nodes),this._texture_allocations_controller=new i.TextureAllocationsController,this._texture_allocations_controller.allocate_connections_from_root_nodes(this._root_nodes,this._leaf_nodes),this.globals_handler&&(null===(e=this.globals_handler)||void 0===e||e.set_texture_allocations_controller(this._texture_allocations_controller)),this._reset_shader_configs()}))}update_shaders(){return s.__awaiter(this,void 0,void 0,(function*(){this._shaders_by_name=new Map,this._lines=new Map,console.log("this.shader_names",this.shader_names);for(let e of this.shader_names){const t=this._template_shader_for_shader_name(e);this._lines.set(e,t.split("\n"))}this._root_nodes.length>0&&(yield this.build_code_from_nodes(this._root_nodes),this._build_lines());for(let e of this.shader_names){const t=this._lines.get(e);t&&(console.log(e,t.join("\n")),this._shaders_by_name.set(e,t.join("\n")))}}))}add_output_params(e){e.add_param(c.ParamType.VECTOR3,"position",[0,0,0]),e.add_param(c.ParamType.VECTOR3,"velocity",[0,0,0])}add_globals_params(e){e.io.outputs.set_named_output_connection_points([new l.TypedNamedConnectionPoint("position",u.ConnectionPointType.VEC3),new l.TypedNamedConnectionPoint("velocity",u.ConnectionPointType.VEC3),new l.TypedNamedConnectionPoint("time",u.ConnectionPointType.FLOAT)])}allow_attribute_exports(){return!0}get texture_allocations_controller(){return this._texture_allocations_controller=this._texture_allocations_controller||new i.TextureAllocationsController}create_shader_configs(){var e;return(null===(e=this._texture_allocations_controller)||void 0===e?void 0:e.create_shader_configs())||[]}create_variable_configs(){return[]}get shader_names(){return this.texture_allocations_controller.shader_names()||[]}input_names_for_shader_name(e,t){return this.texture_allocations_controller.input_names_for_shader_name(e,t)||[]}insert_define_after(e){return"// INSERT DEFINE"}insert_body_after(e){return"// INSERT BODY"}lines_to_remove(e){return["// INSERT DEFINE","// INSERT BODY"]}add_export_body_line(e,t,n,s,r){var o;if(n){const n=e.variable_for_input(t),i=a.ThreeToGl.vector3(n);if(i){const t=this.texture_allocations_controller.variable(s),n=r.current_shader_name;if(t&&(null===(o=t.allocation)||void 0===o?void 0:o.shader_name)==n){const s=`gl_FragColor.${t.component} = ${i}`;r.add_body_lines(e,[s],n)}}}}set_node_lines_output(e,t){const n=t.current_shader_name,s=this.texture_allocations_controller.input_names_for_shader_name(e,n);if(s)for(let n of s){const s=e.io.inputs.named_input(n);if(s){const r=n;this.add_export_body_line(e,n,s,r,t)}}}set_node_lines_attribute(e,t){var n,s;if(e.is_importing){const r=e.gl_type(),o=e.attribute_name,i=null===(n=this.globals_handler)||void 0===n?void 0:n.read_attribute(e,r,o,t),a=e.gl_var_name(e.output_name),_=`${r} ${a} = ${i}`;t.add_body_lines(e,[_]);const c=this.texture_allocations_controller.variable(o),l=t.current_shader_name;if(c&&(null===(s=c.allocation)||void 0===s?void 0:s.shader_name)==l){const n=this.texture_allocations_controller.variable(o);if(n){const s=`gl_FragColor.${n.component} = ${a}`;t.add_body_lines(e,[s])}}}if(e.is_exporting){const n=e.connected_input_node();if(n){const s=e.attribute_name;this.add_export_body_line(e,e.input_name,n,s,t)}}}set_node_lines_globals(e,t){for(let n of e.io.outputs.used_output_names())switch(n){case"time":this._handle_globals_time(e,n,t);break;default:this._handle_globals_default(e,n,t)}}_handle_globals_time(e,t,n){const s=new d.UniformGLDefinition(e,u.ConnectionPointType.FLOAT,t);n.add_definitions(e,[s]);const r=`float ${e.gl_var_name(t)} = ${t}`;n.add_body_lines(e,[r]),this.set_uniforms_time_dependent()}_handle_globals_default(e,t,n){var s;const r=e.io.outputs.named_output_connection_points_by_name(t);if(r){const o=r.type,i=null===(s=this.globals_handler)||void 0===s?void 0:s.read_attribute(e,o,t,n),a=`${o} ${e.gl_var_name(t)} = ${i}`;n.add_body_lines(e,[a])}}}t.ShaderAssemblerParticles=h},function(e,t,n){"use strict";n.r(t),t.default="#include <common>\n\n// INSERT DEFINE\n\nvoid main() {\n\n\tvec2 particleUV = (gl_FragCoord.xy / resolution.xy);\n\n\t// INSERT BODY\n\n}"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),r=s.__importDefault(n(83)),o=s.__importDefault(n(91)),i=s.__importDefault(n(102)),a=s.__importDefault(n(341)),_=n(975),c=n(976),l=n(50),u=n(16);t.TextureAllocationsController=class{constructor(){this._allocations=[],this._next_allocation_index=0}allocate_connections_from_root_nodes(e,t){const n=[];for(let t of e){const e=t.graph_node_id;switch(t.type){case"output":for(let s of t.io.inputs.named_input_connection_points){if(t.io.inputs.named_input(s.name)){const t=new c.TextureVariable(s.name,u.ConnectionPointComponentsCountMap[s.type]);t.add_graph_node_id(e),n.push(t)}}break;case"attribute":{const s=t,r=s.connected_input_node(),o=s.connected_input_connection_point();if(r&&o){const t=new c.TextureVariable(s.attribute_name,u.ConnectionPointComponentsCountMap[o.type]);t.add_graph_node_id(e),n.push(t)}break}}}for(let e of t){const t=e.graph_node_id;switch(e.type){case"globals":{const s=e,r=["position","normal","color","uv"];for(let e of s.io.outputs.used_output_names()){if(r.includes(e)){const r=s.io.outputs.named_output_connection_points_by_name(e);if(r){const s=r.type,o=new c.TextureVariable(e,u.ConnectionPointComponentsCountMap[s]);o.add_graph_node_id(t),n.push(o)}}}break}case"attribute":{const s=e,r=s.output_connection_point();if(r){const e=new c.TextureVariable(s.attribute_name,u.ConnectionPointComponentsCountMap[r.type]);e.add_graph_node_id(t),n.push(e)}break}}}this.allocate_variables(n)}allocate_variables(e){const t=i.default(e,e=>-e.size);for(let e of t)this.allocate_variable(e)}allocate_variable(e){var t;let n=this.has_variable(e.name);if(n){const n=this.variables().filter(t=>t.name==e.name)[0];null===(t=e.graph_node_ids)||void 0===t||t.forEach((e,t)=>{n.add_graph_node_id(t)})}else{if(!n)for(let t of this._allocations)!n&&t.has_space_for_variable(e)&&(t.add_variable(e),n=!0);if(!n){const t=new _.TextureAllocation(this.next_allocation_name());this._allocations.push(t),t.add_variable(e)}}}next_allocation_name(){const e=l.ParticleShaderNames[this._next_allocation_index];return this._next_allocation_index+=1,e}shader_names(){const e=this._allocations.map(e=>e.shader_name);return o.default(e)}create_shader_configs(){return[]}allocation_for_shader_name(e){return this._allocations.filter(t=>t.shader_name==e)[0]}input_names_for_shader_name(e,t){const n=this.allocation_for_shader_name(t);if(n)return n.input_names_for_node(e)}variable(e){for(let t of this._allocations){const n=t.variable(e);if(n)return n}}variables(){return r.default(this._allocations.map(e=>e.variables||[]))}has_variable(e){const t=this.variables().map(e=>e.name);return a.default(t,e)}to_json(e){return this._allocations.map(t=>({[t.texture_name]:t.to_json(e)}))}print(e){console.log(JSON.stringify(this.to_json(e),[""],2))}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.TextureAllocation=class{constructor(e){this._shader_name=e,this._size=0}add_variable(e){this._variables=this._variables||[],this._variables.push(e),e.set_position(this._size),e.set_allocation(this),this._size+=e.size}has_space_for_variable(e){return this._size+e.size<=4}get shader_name(){return this._shader_name}get texture_name(){return`texture_${this._shader_name}`}get variables(){return this._variables}variables_for_input_node(e){var t;return null===(t=this._variables)||void 0===t?void 0:t.filter(t=>{var n;return(null===(n=t.graph_node_ids)||void 0===n?void 0:n.has(e.graph_node_id))||!1})}input_names_for_node(e){var t;return null===(t=this.variables_for_input_node(e))||void 0===t?void 0:t.map(e=>e.name)}variable(e){if(this._variables)for(let t of this._variables)if(t.name==e)return t}to_json(e){var t;return null===(t=this._variables)||void 0===t?void 0:t.map(t=>t.to_json(e))}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.TextureVariable=class{constructor(e,t){if(this._name=e,this._size=t,this._position=-1,!e)throw"TextureVariable requires a name"}set_allocation(e){this._allocation=e}get allocation(){return this._allocation}get graph_node_ids(){return this._graph_node_ids}add_graph_node_id(e){this._graph_node_ids=this._graph_node_ids||new Map,this._graph_node_ids.set(e,!0)}get name(){return this._name}get size(){return this._size}set_position(e){this._position=e}get position(){return this._position}get component(){return"xyzw".split("").splice(this._position,this._size).join("")}to_json(e){const t=[];return this._graph_node_ids&&this._graph_node_ids.forEach((n,s)=>{const r=e.graph.node_from_id(s).name;t.push(r)}),{name:this.name,nodes:t.sort()}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),r=s.__importDefault(n(190)),o=n(279),i=n(161);t.ParticlesSystemGpuRenderController=class{constructor(e){this.node=e,this._particles_group_objects=[]}set_shaders_by_name(e){this._shaders_by_name=e,this.reset_render_material()}assign_render_material(){if(this._render_material){for(let e of this._particles_group_objects){const t=e;t.geometry&&(t.material=this._render_material,i.CoreMaterial.apply_custom_materials(t,this._render_material),t.matrixAutoUpdate=!1,t.updateMatrix())}this._render_material.needsUpdate=!0,this.update_render_material_uniforms()}}update_render_material_uniforms(){var e;this._render_material&&(null===(e=this._shaders_by_name)||void 0===e||e.forEach((e,t)=>{var n;const s=null===(n=this.node.gpu_controller.getCurrentRenderTarget(t))||void 0===n?void 0:n.texture;if(s){const e=`texture_${t}`;this._render_material&&(this._render_material.uniforms[e].value=s,i.CoreMaterial.assign_custom_uniforms(this._render_material,e,s))}}))}reset_render_material(){this._render_material=void 0,this._particles_group_objects=[]}get initialized(){return null!=this._render_material}init_core_group(e){for(let t of e.objects())this._particles_group_objects.push(t)}init_render_material(){var e;return s.__awaiter(this,void 0,void 0,(function*(){if(this._render_material)return;this.node.p.material.is_dirty&&(yield this.node.p.material.compute());const t=this.node.p.material.found_node();if(t){const e=this.node.assembler_controller.assembler.texture_allocations_controller.to_json(this.node.scene),n=new o.GlobalsTextureHandler(o.GlobalsTextureHandler.UV_VARYING);n.set_texture_allocations_controller(this.node.assembler_controller.assembler.texture_allocations_controller),t.assembler_controller.set_assembler_globals_handler(n),this._texture_allocations_json&&JSON.stringify(this._texture_allocations_json)==JSON.stringify(e)||(this._texture_allocations_json=r.default(e),t.set_dirty());const s=yield t.request_container();this._render_material=s.material()}else this.node.states.error.set("render material not valid");if(this._render_material){const t=this._render_material.uniforms;null===(e=this._shaders_by_name)||void 0===e||e.forEach((e,n)=>{const s=`texture_${n}`,r={value:null};t[s]=r,this._render_material&&i.CoreMaterial.init_custom_material_uniforms(this._render_material,s,r)})}this.assign_render_material()}))}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),r=n(2),o=n(14),i=n(227),a=n(4),_=n(104),c=n(279),l=n(979),u=n(67);t.ParticlesSystemGpuComputeController=class{constructor(e){this.node=e,this._simulation_restart_required=!1,this._points=[],this.variables_by_name=new Map,this._created_textures_by_name=new Map,this._used_textures_size=new r.Vector2}set_shaders_by_name(e){this._shaders_by_name=e,this.reset_gpu_compute()}init(e){return s.__awaiter(this,void 0,void 0,(function*(){this.init_particle_group_points(e),yield this.create_gpu_compute()}))}getCurrentRenderTarget(e){var t;const n=this.variables_by_name.get(e);if(n)return null===(t=this._gpu_compute)||void 0===t?void 0:t.getCurrentRenderTarget(n)}init_particle_group_points(e){this.reset_gpu_compute(),e&&(this._particles_core_group=e,this._points=this._get_points()||[])}compute_similation_if_required(){const e=this.node.scene.frame,t=this.node.pv.start_frame;e>=t&&(null==this._last_simulated_frame&&(this._last_simulated_frame=t-1),e>this._last_simulated_frame&&this._compute_simulation(e-this._last_simulated_frame))}_compute_simulation(e=1){if(this._gpu_compute){this.update_simulation_material_uniforms();for(let t=0;t<e;t++)this._gpu_compute.compute();this.node.render_controller.update_render_material_uniforms(),this._last_simulated_frame=this.node.scene.frame}}create_gpu_compute(){var e,t;return s.__awaiter(this,void 0,void 0,(function*(){if(this.node.pv.auto_textures_size){const e=_.CoreMath.nearestPower2(Math.sqrt(this._points.length));this._used_textures_size.x=Math.min(e,this.node.pv.max_textures_size.x),this._used_textures_size.y=Math.min(e,this.node.pv.max_textures_size.y)}else{if(!o.MathUtils.isPowerOfTwo(this.node.pv.textures_size.x)||!o.MathUtils.isPowerOfTwo(this.node.pv.textures_size.y))return void this.node.states.error.set("texture size must be a power of 2");const e=this.node.pv.textures_size.x*this.node.pv.textures_size.y;if(this._points.length>e)return void this.node.states.error.set(`max particles is set to (${this.node.pv.textures_size.x}x${this.node.pv.textures_size.y}=) ${e}`);this._used_textures_size.copy(this.node.pv.textures_size)}this.node.states.time_dependent.force_time_dependent(),this._init_particles_uvs(),this.node.render_controller.reset_render_material();const n=yield u.POLY.renderers_controller.wait_for_renderer();n?this._renderer=n:this.node.states.error.set("no renderer found");const s=new l.GPUComputationRenderer(this._used_textures_size.x,this._used_textures_size.y,this._renderer);if(this._gpu_compute=s,!this._gpu_compute)return void this.node.states.error.set("failed to create the GPUComputationRenderer");this._last_simulated_frame=void 0,this.variables_by_name.forEach((e,t)=>{e.renderTargets[0].dispose(),e.renderTargets[1].dispose(),this.variables_by_name.delete(t)});const r=[];null===(e=this._shaders_by_name)||void 0===e||e.forEach((e,t)=>{if(this._gpu_compute){const n=this._gpu_compute.addVariable(`texture_${t}`,e,this._created_textures_by_name.get(t));this.variables_by_name.set(t,n),r.push(n)}}),null===(t=this.variables_by_name)||void 0===t||t.forEach((e,t)=>{this._gpu_compute&&this._gpu_compute.setVariableDependencies(e,r)}),this._create_texture_render_targets(),this._fill_textures(),this.create_simulation_material_uniforms();var i=this._gpu_compute.init();null!==i&&(console.error(i),this.node.states.error.set(i))}))}create_simulation_material_uniforms(){this.variables_by_name.forEach((e,t)=>{const n=e.material.uniforms;n.frame={value:this.node.scene.frame};for(let e of this.node.assembler_controller.assembler.param_configs())n[e.uniform_name]=e.uniform})}update_simulation_material_uniforms(){this.variables_by_name.forEach((e,t)=>{e.material.uniforms.frame.value=this.node.scene.frame})}_init_particles_uvs(){var e=new Float32Array(2*this._points.length);let t=0;for(var n=0,s=0;s<this._used_textures_size.x;s++)for(var r=0;r<this._used_textures_size.y&&(e[t++]=r/(this._used_textures_size.x-1),e[t++]=s/(this._used_textures_size.y-1),!((n+=2)>=e.length));r++);const o=c.GlobalsTextureHandler.UV_ATTRIB;if(this._particles_core_group)for(let t of this._particles_core_group.core_geometries()){const n=t.geometry(),s=t.marked_as_instance()?i.InstancedBufferAttribute:a.BufferAttribute;n.setAttribute(o,new s(e,2))}}created_textures_by_name(){return this._created_textures_by_name}_fill_textures(){this._created_textures_by_name.forEach((e,t)=>{const n=this.node.assembler_controller.assembler.texture_allocations_controller.allocation_for_shader_name(t);if(!n)return;const s=n.variables;if(!s)return;const r=e.image.data;for(let e of s){const t=e.position;let n=e.name;const s=this._points[0];if(s){if(s.has_attrib(n)){const e=s.attrib_size(n);let o=t;for(let t of this._points){if(1==e){const e=t.attrib_value(n);r[o]=e}else t.attrib_value(n).toArray(r,o);o+=4}}}}})}reset_gpu_compute(){this._gpu_compute=void 0,this._simulation_restart_required=!0}set_restart_not_required(){this._simulation_restart_required=!1}reset_gpu_compute_and_set_dirty(){this.reset_gpu_compute(),this.node.set_dirty()}reset_particle_groups(){this._particles_core_group=void 0}get initialized(){return null!=this._particles_core_group&&null!=this._gpu_compute}_create_texture_render_targets(){this._created_textures_by_name.forEach((e,t)=>{e.dispose()}),this._created_textures_by_name.clear(),this.variables_by_name.forEach((e,t)=>{this._gpu_compute&&this._created_textures_by_name.set(t,this._gpu_compute.createTexture())})}restart_simulation_if_required(){this._simulation_restart_required&&this._restart_simulation()}_restart_simulation(){this._last_simulated_frame=void 0,this._create_texture_render_targets(),this._get_points()&&(this._fill_textures(),this.variables_by_name.forEach((e,t)=>{const n=this._created_textures_by_name.get(t);this._gpu_compute&&n&&(this._gpu_compute.renderTexture(n,e.renderTargets[0]),this._gpu_compute.renderTexture(n,e.renderTargets[1]))}))}_get_points(){if(!this._particles_core_group)return;let e=this._particles_core_group.core_geometries();const t=e[0];if(t){const n=t.marked_as_instance(),s=[];for(let t of e)t.marked_as_instance()==n&&s.push(t);const r=[];for(let e of s)for(let t of e.points())r.push(t);return r}return[]}}},function(e,t,n){"use strict";n.r(t),n.d(t,"GPUComputationRenderer",(function(){return u}));var s=n(77),r=n(0),o=n(70),i=n(22),a=n(54),_=n(55),c=n(26),l=n(75),u=function(e,t,n){this.variables=[],this.currentTextureIndex=0;var u=new _.Scene,d=new s.Camera;d.position.z=1;var h={passThruTexture:{value:null}},p=g("uniform sampler2D passThruTexture;\n\nvoid main() {\n\n\tvec2 uv = gl_FragCoord.xy / resolution.xy;\n\n\tgl_FragColor = texture2D( passThruTexture, uv );\n\n}\n",h),m=new i.Mesh(new a.PlaneBufferGeometry(2,2),p);function f(n){n.defines.resolution="vec2( "+e.toFixed(1)+", "+t.toFixed(1)+" )"}function g(e,t){t=t||{};var n=new c.ShaderMaterial({uniforms:t,vertexShader:"void main()\t{\n\n\tgl_Position = vec4( position, 1.0 );\n\n}\n",fragmentShader:e});return f(n),n}u.add(m),this.addVariable=function(e,t,n){var s={name:e,initialValueTexture:n,material:this.createShaderMaterial(t),dependencies:null,renderTargets:[],wrapS:null,wrapT:null,minFilter:r.NearestFilter,magFilter:r.NearestFilter};return this.variables.push(s),s},this.setVariableDependencies=function(e,t){e.dependencies=t},this.init=function(){if(!n.capabilities.isWebGL2&&!n.extensions.get("OES_texture_float"))return"No OES_texture_float support for float textures.";if(0===n.capabilities.maxVertexTextures)return"No support for vertex shader textures.";for(var s=0;s<this.variables.length;s++){var r=this.variables[s];r.renderTargets[0]=this.createRenderTarget(e,t,r.wrapS,r.wrapT,r.minFilter,r.magFilter),r.renderTargets[1]=this.createRenderTarget(e,t,r.wrapS,r.wrapT,r.minFilter,r.magFilter),this.renderTexture(r.initialValueTexture,r.renderTargets[0]),this.renderTexture(r.initialValueTexture,r.renderTargets[1]);var o=r.material.uniforms;if(null!==r.dependencies)for(var i=0;i<r.dependencies.length;i++){var a=r.dependencies[i];if(a.name!==r.name){for(var _=!1,c=0;c<this.variables.length;c++)if(a.name===this.variables[c].name){_=!0;break}if(!_)return"Variable dependency not found. Variable="+r.name+", dependency="+a.name}o[a.name]={value:null}}}return this.currentTextureIndex=0,null},this.compute=function(){for(var e=this.currentTextureIndex,t=0===this.currentTextureIndex?1:0,n=0,s=this.variables.length;n<s;n++){var r=this.variables[n];if(null!==r.dependencies)for(var o=r.material.uniforms,i=0,a=r.dependencies.length;i<a;i++){var _=r.dependencies[i];o[_.name].value=_.renderTargets[e].texture}this.doRenderTarget(r.material,r.renderTargets[t])}this.currentTextureIndex=t},this.getCurrentRenderTarget=function(e){return e.renderTargets[this.currentTextureIndex]},this.getAlternateRenderTarget=function(e){return e.renderTargets[0===this.currentTextureIndex?1:0]},this.addResolutionDefine=f,this.createShaderMaterial=g,this.createRenderTarget=function(n,s,o,i,a,_){return n=n||e,s=s||t,o=o||r.ClampToEdgeWrapping,i=i||r.ClampToEdgeWrapping,a=a||r.NearestFilter,_=_||r.NearestFilter,new l.WebGLRenderTarget(n,s,{wrapS:o,wrapT:i,minFilter:a,magFilter:_,format:r.RGBAFormat,type:/(iPad|iPhone|iPod)/g.test(navigator.userAgent)?r.HalfFloatType:r.FloatType,stencilBuffer:!1,depthBuffer:!1})},this.createTexture=function(){var n=new Float32Array(e*t*4);return new o.DataTexture(n,e,t,r.RGBAFormat,r.FloatType)},this.renderTexture=function(e,t){h.passThruTexture.value=e,this.doRenderTarget(p,t),h.passThruTexture.value=null},this.doRenderTarget=function(e,t){var s=n.getRenderTarget();m.material=e,n.setRenderTarget(t),n.render(u,d),m.material=p,n.setRenderTarget(s)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(53),r=n(13),o=n(17),i=n(5);class a extends i.NodeParamsConfig{constructor(){super(...arguments),this.amount=i.ParamConfig.FLOAT(1,{range:[-1,1]})}}const _=new a;class c extends r.TypedSopNode{constructor(){super(...arguments),this.params_config=_}static type(){return"peak"}initialize_node(){this.io.inputs.set_count(1),this.io.inputs.init_inputs_clonable_state([o.InputCloneMode.FROM_NODE])}cook(e){const t=e[0];let n,r;for(let e of t.objects())e.traverse(e=>{let t;if(null!=(t=e.geometry)){for(r of(n=new s.CoreGeometry(t),n.points())){const e=r.normal(),t=r.position().clone().add(e.multiplyScalar(this.pv.amount));r.set_position(t)}if(!this.io.inputs.input_cloned(0)){n.geometry().getAttribute("position").needsUpdate=!0}}});this.set_core_group(t)}}t.PeakSopNode=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(1),r=n(2),o=n(54),i=n(13),a=n(85),_=n(17),c=new s.Vector3(0,0,1),l=new s.Vector3(0,0,1),u=new s.Vector3(0,1,0),d=n(5);class h extends d.NodeParamsConfig{constructor(){super(...arguments),this.size=d.ParamConfig.VECTOR2([1,1]),this.use_segments_count=d.ParamConfig.BOOLEAN(0),this.step_size=d.ParamConfig.FLOAT(1,{visible_if:{use_segments_count:0}}),this.segments=d.ParamConfig.VECTOR2([1,1],{visible_if:{use_segments_count:1}}),this.direction=d.ParamConfig.VECTOR3([0,1,0]),this.center=d.ParamConfig.VECTOR3([0,0,0])}}const p=new h;class m extends i.TypedSopNode{constructor(){super(...arguments),this.params_config=p,this._core_transform=new a.CoreTransform}static type(){return"plane"}static displayed_input_names(){return["geometry to create plane from (optional)"]}initialize_node(){this.io.inputs.set_count(0,1),this.io.inputs.init_inputs_clonable_state([_.InputCloneMode.NEVER])}cook(e){const t=e[0];t?this._cook_with_input(t):this._cook_without_input()}_cook_without_input(){const e=this._create_plane(this.pv.size);this._core_transform.rotate_geometry(e,c,this.pv.direction);const t=this._core_transform.translation_matrix(this.pv.center);e.applyMatrix4(t),this.set_geometry(e)}_cook_with_input(e){const t=e.bounding_box(),n=new s.Vector3;t.getSize(n);const o=new s.Vector3;t.getCenter(o);const i=new r.Vector2(n.x,n.z),a=this._create_plane(i);this._core_transform.rotate_geometry(a,l,u);const _=this._core_transform.translation_matrix(o);a.applyMatrix4(_),this.set_geometry(a)}_create_plane(e){let t;return e=e.clone(),this.pv.use_segments_count?t={x:Math.floor(this.pv.segments.x),y:Math.floor(this.pv.segments.y)}:(t={x:Math.floor(e.x/this.pv.step_size),y:Math.floor(e.y/this.pv.step_size)},e.x=t.x*this.pv.step_size,e.y=t.y*this.pv.step_size),new o.PlaneBufferGeometry(e.x,e.y,t.x,t.y)}}t.PlaneSopNode=m},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),r=n(13),o=n(17),i=n(5);class a extends i.NodeParamsConfig{constructor(){super(...arguments),this.update_x=i.ParamConfig.BOOLEAN(0),this.x=i.ParamConfig.FLOAT("@P.x",{visible_if:{update_x:1},expression:{for_entities:!0}}),this.update_y=i.ParamConfig.BOOLEAN(0),this.y=i.ParamConfig.FLOAT("@P.y",{visible_if:{update_y:1},expression:{for_entities:!0}}),this.update_z=i.ParamConfig.BOOLEAN(0),this.z=i.ParamConfig.FLOAT("@P.z",{visible_if:{update_z:1},expression:{for_entities:!0}}),this.update_normals=i.ParamConfig.BOOLEAN(1)}}const _=new a;class c extends r.TypedSopNode{constructor(){super(...arguments),this.params_config=_,this._x_arrays_by_geometry_uuid=new Map,this._y_arrays_by_geometry_uuid=new Map,this._z_arrays_by_geometry_uuid=new Map}static type(){return"point"}static displayed_input_names(){return["points to move"]}initialize_node(){this.io.inputs.set_count(1),this.io.inputs.init_inputs_clonable_state([o.InputCloneMode.FROM_NODE])}cook(e){return s.__awaiter(this,void 0,void 0,(function*(){const t=e[0];yield this._eval_expressions_for_core_group(t)}))}_eval_expressions_for_core_group(e){return s.__awaiter(this,void 0,void 0,(function*(){const t=e.core_objects();for(let e=0;e<t.length;e++)yield this._eval_expressions_for_core_object(t[e]);this.pv.update_normals&&e.compute_vertex_normals();const n=e.geometries();for(let e of n)e.computeBoundingBox();if(!this.io.inputs.input_cloned(0)){const t=e.geometries();for(let e of t){e.getAttribute("position").needsUpdate=!0}}this.set_core_group(e)}))}_eval_expressions_for_core_object(e){return s.__awaiter(this,void 0,void 0,(function*(){const t=e.object().geometry,n=e.points(),s=t.getAttribute("position").array,r=yield this._update_from_param(t,s,n,this.p.update_x,this.p.x,this.pv.x,this._x_arrays_by_geometry_uuid,0),o=yield this._update_from_param(t,s,n,this.p.update_y,this.p.y,this.pv.y,this._y_arrays_by_geometry_uuid,1),i=yield this._update_from_param(t,s,n,this.p.update_z,this.p.z,this.pv.z,this._z_arrays_by_geometry_uuid,2);r&&this._commit_tmp_values(r,s,0),o&&this._commit_tmp_values(o,s,1),i&&this._commit_tmp_values(i,s,2)}))}_update_from_param(e,t,n,r,o,i,a,_){return s.__awaiter(this,void 0,void 0,(function*(){const t=r,s=o;let c=this._init_array_if_required(e,a,n.length,_);if(t.value)if(s.has_expression()&&s.expression_controller)yield s.expression_controller.compute_expression_for_points(n,(e,t)=>{c[e.index]=t});else{let e;for(let t=0;t<n.length;t++)e=n[t],c[e.index]=i}return c}))}_init_array_if_required(e,t,n,s){const r=e.uuid,o=t.get(r);if(o){if(o.length<n){const o=this._array_for_component(e,n,s);return t.set(r,o),o}return o}{const o=this._array_for_component(e,n,s);return t.set(r,o),o}}_array_for_component(e,t,n){const s=new Array(t),r=e.getAttribute("position").array;for(let e=0;e<s.length;e++)s[e]=r[3*e+n];return s}_commit_tmp_values(e,t,n){for(let s=0;s<e.length;s++)t[3*s+n]=e[s]}}t.PointSopNode=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(13),r=n(53),o=n(85),i=n(383),a=n(280),_=n(407),c=n(1),l=n(57),u=n(6),d=n(17),h=new c.Vector3(0,0,0),p=new c.Vector3(1,1,1),m=n(5);class f extends m.NodeParamsConfig{constructor(){super(...arguments),this.radius=m.ParamConfig.FLOAT(1),this.segments_radial=m.ParamConfig.INTEGER(8,{range:[3,20],range_locked:[!0,!1]}),this.closed=m.ParamConfig.BOOLEAN(0)}}const g=new f;class v extends s.TypedSopNode{constructor(){super(...arguments),this.params_config=g,this._core_transform=new o.CoreTransform,this._geometries=[]}static type(){return"polywire"}static displayed_input_names(){return["lines to create tubes from"]}initialize_node(){this.io.inputs.set_count(1),this.io.inputs.init_inputs_clonable_state([d.InputCloneMode.NEVER])}cook(e){const t=e[0];this._geometries=[];for(let e of t.objects())e instanceof l.LineSegments&&this._create_tube(e);const n=r.CoreGeometry.merge_geometries(this._geometries);for(let e of this._geometries)e.dispose();if(n){const e=this.create_object(n);this.set_object(e)}else this.set_objects([])}_create_tube(e){var t;const n=e.geometry,s=new r.CoreGeometry(n).points(),o=null===(t=n.getIndex())||void 0===t?void 0:t.array,i=a.CoreGeometryUtilCurve.accumulated_curve_point_indices(o);for(let e of i){const t=e.map(e=>s[e]);this._create_tube_from_points(t)}}_create_tube_from_points(e){if(e.length<=1)return;const t=e.map(e=>e.attrib_value("position")),n=i.CoreGeometryUtilCircle.create(this.pv.radius,this.pv.segments_radial),s=[];for(let e of t){const t=e,r=this._core_transform.matrix(t,h,p,1),o=n.clone();o.applyMatrix4(r),s.push(o)}for(let e=0;e<s.length;e++)if(e>0){const t=s[e],n=s[e-1],r=this._skin(n,t);this._geometries.push(r)}}_skin(e,t){const n=new u.BufferGeometry;return new _.CoreGeometryOperationSkin(n,e,t).process(),n}}t.PolywireSopNode=v},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(262),r=n(56),o=n(0),i=n(13),a=n(17),_=new r.MeshBasicMaterial({side:o.DoubleSide}),c=n(5);class l extends c.NodeParamsConfig{constructor(){super(...arguments),this.use_normals=c.ParamConfig.BOOLEAN(1),this.direction=c.ParamConfig.VECTOR3([0,-1,0],{visible_if:{use_normals:0}}),this.transfer_face_normals=c.ParamConfig.BOOLEAN(1)}}const u=new l;class d extends i.TypedSopNode{constructor(){super(...arguments),this.params_config=u,this._bound_assign_mat=this._assign_double_sided_material_to_object.bind(this),this._raycaster=new s.Raycaster}static type(){return"ray"}static double_sided_material(){return _}static displayed_input_names(){return["geometry to move","geometry to ray onto"]}initialize_node(){this.io.inputs.set_count(2),this.io.inputs.init_inputs_clonable_state([a.InputCloneMode.FROM_NODE,a.InputCloneMode.ALWAYS])}create_params(){}cook(e){const t=e[0],n=e[1];this.ray(t,n)}ray(e,t){let n,s;this._assign_double_sided_material_to_core_group(t);for(let r of e.points())n=this.pv.use_normals?r.normal():this.pv.direction,this._raycaster.set(r.position(),n),s=this._raycaster.intersectObjects(t.objects(),!0)[0],s&&(r.set_position(s.point),this.pv.transfer_face_normals&&s.face&&r.set_normal(s.face.normal));this.set_core_group(e)}_assign_double_sided_material_to_core_group(e){for(let t of e.objects())t.traverse(this._bound_assign_mat)}_assign_double_sided_material_to_object(e){e.material=d.double_sided_material()}}t.RaySopNode=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),r=n(57),o=n(4),i=n(6),a=n(276),_=n(274),c=s.__importDefault(n(83)),l=s.__importDefault(n(324)),u=n(13),d=n(35),h=n(280),p=n(53);var m,f;!function(e){e.POINTS_COUNT="points_count",e.SEGMENT_LENGTH="segment_length"}(m=t.METHOD||(t.METHOD={})),t.METHODS=[m.POINTS_COUNT,m.SEGMENT_LENGTH],function(e){e.CENTRIPETAL="centripetal",e.CHORDAL="chordal",e.CATMULLROM="catmullrom"}(f=t.CURVE_TYPE||(t.CURVE_TYPE={})),t.CURVE_TYPES=[f.CENTRIPETAL,f.CHORDAL,f.CATMULLROM];const g=n(5),v=n(193);class y extends g.NodeParamsConfig{constructor(){super(...arguments),this.method=g.ParamConfig.INTEGER(t.METHODS.indexOf(m.POINTS_COUNT),{menu:{entries:t.METHODS.map((e,t)=>({name:e,value:t}))}}),this.curve_type=g.ParamConfig.INTEGER(t.CURVE_TYPES.indexOf(f.CATMULLROM),{range:[0,2],range_locked:[!0,!0],menu:{entries:t.CURVE_TYPES.map((e,t)=>({name:e,value:t}))}}),this.tension=g.ParamConfig.FLOAT(.01,{range:[0,1],range_locked:[!0,!0]}),this.points_count=g.ParamConfig.INTEGER(100,{visible_if:{method:t.METHODS.indexOf(m.POINTS_COUNT)}}),this.segment_length=g.ParamConfig.FLOAT(1,{visible_if:{method:t.METHODS.indexOf(m.SEGMENT_LENGTH)}})}}const b=new y;class x extends u.TypedSopNode{constructor(){super(...arguments),this.params_config=b}static type(){return"resample"}initialize_node(){this.io.inputs.set_count(1)}cook(e){const t=e[0],n=[];if(this.pv.points_count>=2){const e=t.core_objects();for(let t=0;t<e.length;t++){const s=e[t].object();if(s instanceof r.LineSegments){const e=this._resample(s);n.push(e)}}}this.set_objects(n)}_resample(e){var t;const n=e.geometry,s=new p.CoreGeometry(n).points(),r=null===(t=n.getIndex())||void 0===t?void 0:t.array,o=h.CoreGeometryUtilCurve.accumulated_curve_point_indices(r),i=[];for(let e=0;e<o.length;e++){const t=o[e].map(e=>s[e]),n=this._create_curve_from_points(t);n&&i.push(n)}const a=_.BufferGeometryUtils.mergeBufferGeometries(i);return this.create_object(a,d.CoreConstant.OBJECT_TYPE.LINE_SEGMENTS)}_create_curve_from_points(e){if(e.length<=1)return;const n=l.default(e,e=>e.attrib_value("position")),s=t.CURVE_TYPES[this.pv.curve_type],r=this.pv.tension,_=new a.CatmullRomCurve3(n,!1,s,r),u=this._get_points_from_curve(_);let d=[];const h=[];for(let e=0;e<u.length;e++){const t=u[e].toArray();d.push(t),e>0&&(h.push(e-1),h.push(e))}d=c.default(d);const p=new i.BufferGeometry;return p.setAttribute("position",new o.Float32BufferAttribute(d,3)),p.setIndex(h),p}_get_points_from_curve(e){const n=t.METHODS[this.pv.method];switch(n){case m.POINTS_COUNT:return e.getSpacedPoints(Math.max(2,this.pv.points_count));case m.SEGMENT_LENGTH:var s=e.getLength(),r=0!==this.pv.segment_length?1+s/this.pv.segment_length:2;return r=Math.max(2,r),e.getSpacedPoints(r)}v.TypeAssert.unreachable(n)}}t.ResampleSopNode=x},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),r=n(6),o={BufferAttribute:n(4).BufferAttribute,BufferGeometry:r.BufferGeometry},i=s.__importDefault(n(82)),a=s.__importDefault(n(44)),_=s.__importDefault(n(102)),c=n(13),l=n(35),u=n(104),d=n(382),h=n(5),p=n(17);class m extends h.NodeParamsConfig{constructor(){super(...arguments),this.points_count=h.ParamConfig.INTEGER(100,{range:[0,100],range_locked:[!0,!1]}),this.seed=h.ParamConfig.INTEGER(0,{range:[0,100],range_locked:[!1,!1]}),this.transfer_attributes=h.ParamConfig.BOOLEAN(0),this.attributes_to_transfer=h.ParamConfig.STRING("normal",{visible_if:{transfer_attributes:1}}),this.add_id_attribute=h.ParamConfig.BOOLEAN(1)}}const f=new m;class g extends c.TypedSopNode{constructor(){super(...arguments),this.params_config=f}static type(){return"scatter"}static displayed_input_names(){return["geometry to scatter points onto"]}initialize_node(){this.io.inputs.set_count(1),this.io.inputs.init_inputs_clonable_state([p.InputCloneMode.NEVER])}cook(e){return s.__awaiter(this,void 0,void 0,(function*(){const t=e[0];let n=t.faces();const s=[];let r=0;const c=new Map;for(let e of n){const t=e.area;c.set(e.index,t)}const h=_.default(n,e=>c.get(e.index));let p=0;for(let e of h)r+=c.get(e.index),s[p]=r,p++;const m=[];let f=[];this.pv.transfer_attributes&&(f=t.attrib_names_matching_mask(this.pv.attributes_to_transfer));const g=new Map,v=new Map;for(let e of f)g.set(e,[]),v.set(e,t.attrib_size(e));const y=new d.CoreIterator;yield y.start_with_count(this.pv.points_count,e=>{const t=u.CoreMath.rand_float(this.pv.seed+e)*r;for(let e=0;e<s.length;e++){if(t<=s[e]){const n=h[e],s=n.random_position(t);s.toArray(m,m.length);for(let e of f){const t=n.attrib_value_at_position(e,s);a.default(t)?g.get(e).push(t):t.toArray(g.get(e),g.get(e).length)}break}}});const b=new o.BufferGeometry;b.setAttribute("position",new o.BufferAttribute(new Float32Array(m),3));for(let e of f)b.setAttribute(e,new o.BufferAttribute(new Float32Array(g.get(e)),v.get(e)));if(this.pv.add_id_attribute){const e=i.default(this.pv.points_count);b.setAttribute("id",new o.BufferAttribute(new Float32Array(e),1))}this.set_geometry(b,l.CoreConstant.OBJECT_TYPE.POINTS)}))}}t.ScatterSopNode=g},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),r=n(13),o=n(17),i=n(5);class a extends i.NodeParamsConfig{constructor(){super(...arguments),this.cast_shadow=i.ParamConfig.BOOLEAN(1),this.receive_shadow=i.ParamConfig.BOOLEAN(1),this.apply_to_children=i.ParamConfig.BOOLEAN(0)}}const _=new a;class c extends r.TypedSopNode{constructor(){super(...arguments),this.params_config=_}static type(){return"shadows"}static displayed_input_names(){return["objects to change shadows properties of"]}initialize_node(){this.io.inputs.set_count(1),this.io.inputs.init_inputs_clonable_state([o.InputCloneMode.FROM_NODE])}cook(e){return s.__awaiter(this,void 0,void 0,(function*(){const t=e[0];for(let e of t.objects())this.pv.apply_to_children?e.traverse(e=>{e.castShadow=this.pv.cast_shadow,e.receiveShadow=this.pv.receive_shadow}):(e.castShadow=this.pv.cast_shadow,e.receiveShadow=this.pv.receive_shadow);console.log(t.objects()),this.set_core_group(t)}))}}t.ShadowsSopNode=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),r=n(6),o=s.__importDefault(n(102)),i=s.__importDefault(n(989)),a=s.__importDefault(n(92)),_=n(13),c=n(280),l=n(407),u=n(5);class d extends u.NodeParamsConfig{}const h=new d;class p extends _.TypedSopNode{constructor(){super(...arguments),this.params_config=h}static type(){return"skin"}static displayed_input_names(){return["lines to create polygons from","if used, lines from both inputs will be used"]}initialize_node(){this.io.inputs.set_count(1,2)}cook(e){switch(a.default(this.io.inputs.inputs()).length){case 1:return this.process_one_input(e);case 2:return this.process_two_inputs(e);default:return this.states.error.set("inputs count not valid")}}process_one_input(e){const t=e[0],n=this._get_line_segments(t),s=[];if(n){const e=n[0];if(e){const t=c.CoreGeometryUtilCurve.line_segment_to_geometries(e.geometry);t.forEach((e,n)=>{if(n>0){const r=t[n-1],o=this._skin(r,e);s.push(o)}})}}this.set_geometries(s)}process_two_inputs(e){const t=e[0],n=e[1],s=this._get_line_segments(t),r=this._get_line_segments(n),a=i.default(o.default([s,r],e=>e.length)),_=a[0],c=a[1],l=[];_.forEach((e,t)=>{const n=c[t];if(null!=e&&null!=n){const t=e.geometry,s=n.geometry,r=this._skin(t,s);l.push(r)}}),this.set_geometries(l)}_get_line_segments(e){return e.objects().filter(e=>e.isLineSegments)}_skin(e,t){const n=new r.BufferGeometry;return new l.CoreGeometryOperationSkin(n,e,t).process(),n}}t.SkinSopNode=p},,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(160),r=n(210),o=n(13);var i;!function(e){e.DEFAULT="default",e.ISOCAHEDRON="isocahedron"}(i||(i={}));const a={default:0,isocahedron:1},_=[i.DEFAULT,i.ISOCAHEDRON],c=n(5),l=n(17);class u extends c.NodeParamsConfig{constructor(){super(...arguments),this.type=c.ParamConfig.INTEGER(a.default,{menu:{entries:_.map(e=>({name:e,value:a[e]}))}}),this.radius=c.ParamConfig.FLOAT(1,{visible_if:{type:a.default}}),this.resolution=c.ParamConfig.VECTOR2([8,6],{visible_if:{type:a.default}}),this.open=c.ParamConfig.BOOLEAN(0,{visible_if:{type:a.default}}),this.angle_range_x=c.ParamConfig.VECTOR2([0,"$PI*2"],{visible_if:{type:a.default,open:!0}}),this.angle_range_y=c.ParamConfig.VECTOR2([0,"$PI*2"],{visible_if:{type:a.default,open:!0}}),this.detail=c.ParamConfig.INTEGER(1,{range:[0,5],range_locked:[!0,!1],visible_if:{type:a.isocahedron}}),this.center=c.ParamConfig.VECTOR3([0,0,0])}}const d=new u;class h extends o.TypedSopNode{constructor(){super(...arguments),this.params_config=d}static type(){return"sphere"}initialize_node(){this.io.inputs.set_count(0,1),this.io.inputs.init_inputs_clonable_state([l.InputCloneMode.NEVER])}cook(e){const t=e[0];t?this._cook_with_input(t):this._cook_without_input()}_cook_without_input(){const e=this._create_required_geometry();e.translate(this.pv.center.x,this.pv.center.y,this.pv.center.z),this.set_geometry(e)}_cook_with_input(e){const t=e.bounding_box(),n=t.max.clone().sub(t.min),s=t.max.clone().add(t.min).multiplyScalar(.5),r=this._create_required_geometry();r.translate(this.pv.center.x,this.pv.center.y,this.pv.center.z),r.translate(s.x,s.y,s.z),r.scale(n.x,n.y,n.z),this.set_geometry(r)}_create_required_geometry(){return this.pv.type==a.default?this._create_default_sphere():this._create_default_isocahedron()}_create_default_sphere(){return this.pv.open?new s.SphereBufferGeometry(this.pv.radius,this.pv.resolution.x,this.pv.resolution.y,this.pv.angle_range_x.x,this.pv.angle_range_x.y,this.pv.angle_range_y.x,this.pv.angle_range_y.y):new s.SphereBufferGeometry(this.pv.radius,this.pv.resolution.x,this.pv.resolution.y)}_create_default_isocahedron(){return new r.IcosahedronBufferGeometry(this.pv.radius,this.pv.detail)}}t.SphereSopNode=h},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),r=n(13),o="geometry to switch to",i=n(5),a=n(17);class _ extends i.NodeParamsConfig{constructor(){super(...arguments),this.input=i.ParamConfig.INTEGER(0,{range:[0,3],range_locked:[!0,!0]})}}const c=new _;class l extends r.TypedSopNode{constructor(){super(...arguments),this.params_config=c}static type(){return"switch"}static displayed_input_names(){return[o,o,o,o]}initialize_node(){this.io.inputs.set_count(0,4),this.io.inputs.init_inputs_clonable_state([a.InputCloneMode.NEVER,a.InputCloneMode.NEVER,a.InputCloneMode.NEVER,a.InputCloneMode.NEVER]),this.ui_data.set_width(100),this.cook_controller.disallow_inputs_evaluation()}cook(){return s.__awaiter(this,void 0,void 0,(function*(){const e=this.pv.input;if(this.io.inputs.has_input(e)){const t=yield this.container_controller.request_input_container(e);this.set_core_group(t.core_content())}else this.states.error.set(`no input ${e}`)}))}}t.SwitchSopNode=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),r=s.__importDefault(n(82)),o=n(13),i=n(35),a=n(213),_=n(6),c=n(214),l=n(1006),u=n(4),d=n(274);var h=n(1002);var p;!function(e){e.MESH="mesh",e.FLAT="flat",e.LINE="line",e.STROKE="stroke"}(p=t.TEXT_TYPE||(t.TEXT_TYPE={})),t.TEXT_TYPES=[p.MESH,p.FLAT,p.LINE,p.STROKE];const m=n(5);class f extends m.NodeParamsConfig{constructor(){super(...arguments),this.font=m.ParamConfig.STRING(""),this.text=m.ParamConfig.STRING("polygonjs",{multiline:!0}),this.type=m.ParamConfig.INTEGER(0,{menu:{entries:t.TEXT_TYPES.map((e,t)=>({name:e,value:t}))}}),this.size=m.ParamConfig.FLOAT(1,{range:[0,1],range_locked:[!0,!1]}),this.extrude=m.ParamConfig.FLOAT(.1,{visible_if:{type:t.TEXT_TYPES.indexOf(p.MESH)}}),this.segments=m.ParamConfig.INTEGER(1,{range:[1,20],range_locked:[!0,!1],visible_if:{type:t.TEXT_TYPES.indexOf(p.MESH)}}),this.stroke_width=m.ParamConfig.FLOAT(.02,{visible_if:{type:t.TEXT_TYPES.indexOf(p.STROKE)}})}}const g=new f;class v extends o.TypedSopNode{constructor(){super(...arguments),this.params_config=g,this._font_loader=new l.FontLoader,this._loaded_fonts={}}static type(){return"text"}initialize_node(){}cook(){return s.__awaiter(this,void 0,void 0,(function*(){try{this._loaded_fonts[this.pv.font]=this._loaded_fonts[this.pv.font]||(yield this._load_url(this.pv.font))}catch(e){return void this.states.error.set(`count not load font (${this.pv.font})`)}const e=this._loaded_fonts[this.pv.font];if(e)switch(t.TEXT_TYPES[this.pv.type]){case p.MESH:return this._create_geometry_from_type_mesh(e);case p.FLAT:return this._create_geometry_from_type_flat(e);case p.LINE:return this._create_geometry_from_type_line(e);case p.STROKE:return this._create_geometry_from_type_stroke(e);default:console.warn("type is not valid")}}))}_create_geometry_from_type_mesh(e){const t=this.displayed_text(),n={font:e,size:this.pv.size,height:this.pv.extrude,curveSegments:this.pv.segments};try{const e=new a.TextBufferGeometry(t,n);if(!e.index){const t=e.getAttribute("position").array;e.setIndex(r.default(t.length/3))}this.set_geometry(e)}catch(e){this.states.error.set("failed to generate geometry. Try to remove some characters")}}_create_geometry_from_type_flat(e){const t=this._get_shapes(e);if(t){var n=new c.ShapeBufferGeometry(t);this.set_geometry(n)}}_create_geometry_from_type_line(e){const t=this.shapes_from_font(e);if(t){const e=[],n=[];let s=0;for(let r=0;r<t.length;r++){const o=t[r].getPoints();for(let t=0;t<o.length;t++){const r=o[t];e.push(r.x),e.push(r.y),e.push(0),n.push(s),t>0&&t<o.length-1&&n.push(s),s+=1}}const r=new _.BufferGeometry;r.setAttribute("position",new u.Float32BufferAttribute(e,3)),r.setIndex(n),this.set_geometry(r,i.CoreConstant.OBJECT_TYPE.LINE_SEGMENTS)}}_create_geometry_from_type_stroke(e){return s.__awaiter(this,void 0,void 0,(function*(){const t=this.shapes_from_font(e);if(t){this._svg_loader=this._svg_loader||(yield this._load_svg_loader());var n=this._svg_loader.getStrokeStyle(this.pv.stroke_width,"white","miter","butt",4);const e=[];for(let s=0;s<t.length;s++){const r=t[s].getPoints(),o=12,i=.001,a=this._svg_loader.pointsToStroke(r,n,o,i);e.push(a)}const s=d.BufferGeometryUtils.mergeBufferGeometries(e);this.set_geometry(s)}}))}shapes_from_font(e){const t=this._get_shapes(e);if(t){const e=[];for(let n=0;n<t.length;n++){const s=t[n];if(s.holes&&s.holes.length>0)for(let t=0;t<s.holes.length;t++){const n=s.holes[t];e.push(n)}}return t.push.apply(t,e),t}}_get_shapes(e){const t=this.displayed_text();try{return e.generateShapes(t,this.pv.size)}catch(e){this.states.error.set("failed to generate geometry. Try to remove some characters")}}displayed_text(){return this.pv.text||""}_load_url(e){""===e&&(e="/fonts/droid_sans_regular.typeface.json");const t=e.split("?")[0].split("."),n=t[t.length-1];switch(e=`${e}?${Date.now()}`,n){case"ttf":return this._load_ttf(e);case"json":return this._load_json(e);default:return null}}_load_ttf(e){return new Promise((t,n)=>s.__awaiter(this,void 0,void 0,(function*(){this._ttf_loader=this._ttf_loader||(yield this._load_ttf_loader()),window.opentype=h,this._ttf_loader.load(e,e=>{const n=this._font_loader.parse(e);t(n)},void 0,()=>{n()})})))}_load_json(e){return new Promise((t,n)=>{this._font_loader.load(e,e=>{t(e)},void 0,()=>{n()})})}_load_ttf_loader(){return s.__awaiter(this,void 0,void 0,(function*(){const{TTFLoader:e}=yield Promise.resolve().then(()=>s.__importStar(n(994)));return new e}))}_load_svg_loader(){return s.__awaiter(this,void 0,void 0,(function*(){const{SVGLoader:e}=yield Promise.resolve().then(()=>s.__importStar(n(995)));return e}))}}t.TextSopNode=v},,function(e,t,n){"use strict";n.r(t),n.d(t,"TTFLoader",(function(){return o}));var s=n(30),r=n(18),o=function(e){r.a.call(this,e),this.reversed=!1};o.prototype=Object.assign(Object.create(r.a.prototype),{constructor:o,load:function(e,t,n,r){var o=this,i=new s.a(this.manager);i.setPath(this.path),i.setResponseType("arraybuffer"),i.load(e,(function(e){t(o.parse(e))}),n,r)},parse:function(e){function t(e){var t,n=[];e.forEach((function(e){"m"===e.type.toLowerCase()?(t=[e],n.push(t)):"z"!==e.type.toLowerCase()&&t.push(e)}));var s=[];return n.forEach((function(e){var t={type:"m",x:e[e.length-1].x,y:e[e.length-1].y};s.push(t);for(var n=e.length-1;n>0;n--){var r=e[n];t={type:r.type};void 0!==r.x2&&void 0!==r.y2?(t.x1=r.x2,t.y1=r.y2,t.x2=r.x1,t.y2=r.y1):void 0!==r.x1&&void 0!==r.y1&&(t.x1=r.x1,t.y1=r.y1),t.x=e[n-1].x,t.y=e[n-1].y,s.push(t)}})),s}return"undefined"==typeof opentype?(console.warn("THREE.TTFLoader: The loader requires opentype.js. Make sure it's included before using the loader."),null):function(e,n){for(var s=Math.round,r={},o=1e5/(72*(e.unitsPerEm||2048)),i=e.encoding.cmap.glyphIndexMap,a=Object.keys(i),_=0;_<a.length;_++){var c=a[_],l=e.glyphs.glyphs[i[c]];if(void 0!==c){var u={ha:s(l.advanceWidth*o),x_min:s(l.xMin*o),x_max:s(l.xMax*o),o:""};n&&(l.path.commands=t(l.path.commands)),l.path.commands.forEach((function(e){"c"===e.type.toLowerCase()&&(e.type="b"),u.o+=e.type.toLowerCase()+" ",void 0!==e.x&&void 0!==e.y&&(u.o+=s(e.x*o)+" "+s(e.y*o)+" "),void 0!==e.x1&&void 0!==e.y1&&(u.o+=s(e.x1*o)+" "+s(e.y1*o)+" "),void 0!==e.x2&&void 0!==e.y2&&(u.o+=s(e.x2*o)+" "+s(e.y2*o)+" ")})),r[String.fromCodePoint(l.unicode)]=u}}return{glyphs:r,familyName:e.getEnglishName("fullName"),ascender:s(e.ascender*o),descender:s(e.descender*o),underlinePosition:e.tables.post.underlinePosition,underlineThickness:e.tables.post.underlineThickness,boundingBox:{xMin:e.tables.head.xMin,xMax:e.tables.head.xMax,yMin:e.tables.head.yMin,yMax:e.tables.head.yMax},resolution:1e3,original_font_information:e.tables.name}}(opentype.parse(e),this.reversed)}})},,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(212),r=n(13),o=n(5);class i extends o.NodeParamsConfig{constructor(){super(...arguments),this.radius=o.ParamConfig.FLOAT(1,{range:[0,1]}),this.radius_tube=o.ParamConfig.FLOAT(1,{range:[0,1]}),this.segments_radial=o.ParamConfig.INTEGER(20,{range:[1,50],range_locked:[!0,!1]}),this.segments_tube=o.ParamConfig.INTEGER(12,{range:[1,50],range_locked:[!0,!1]})}}const a=new i;class _ extends r.TypedSopNode{constructor(){super(...arguments),this.params_config=a}static type(){return"torus"}initialize_node(){}cook(){const e=this.pv.radius,t=this.pv.radius_tube,n=this.pv.segments_radial,r=this.pv.segments_tube,o=new s.TorusBufferGeometry(e,t,n,r);this.set_geometry(o)}}t.TorusSopNode=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s={TorusKnotBufferGeometry:n(211).TorusKnotBufferGeometry},r=n(13),o=n(5);class i extends o.NodeParamsConfig{constructor(){super(...arguments),this.radius=o.ParamConfig.FLOAT(1),this.radius_tube=o.ParamConfig.FLOAT(1),this.segments_radial=o.ParamConfig.INTEGER(64,{range:[1,128]}),this.segments_tube=o.ParamConfig.INTEGER(8,{range:[1,32]}),this.p=o.ParamConfig.INTEGER(2,{range:[1,10]}),this.q=o.ParamConfig.INTEGER(3,{range:[1,10]})}}const a=new i;class _ extends r.TypedSopNode{constructor(){super(...arguments),this.params_config=a}static type(){return"torus_knot"}initialize_node(){}cook(){const e=this.pv.radius,t=this.pv.radius_tube,n=this.pv.segments_radial,r=this.pv.segments_tube,o=this.pv.p,i=this.pv.q,a=new s.TorusKnotBufferGeometry(e,t,n,r,o,i);this.set_geometry(a)}}t.TorusKnotSopNode=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(13),r=n(377),o=n(85),i=n(17),a=n(5);class _ extends a.NodeParamsConfig{constructor(){super(...arguments),this.group=a.ParamConfig.STRING(""),this.t=a.ParamConfig.VECTOR3([0,0,0]),this.r=a.ParamConfig.VECTOR3([0,0,0]),this.s=a.ParamConfig.VECTOR3([1,1,1]),this.scale=a.ParamConfig.FLOAT(1),this.look_at=a.ParamConfig.OPERATOR_PATH(""),this.up=a.ParamConfig.VECTOR3([0,1,0]),this.pivot=a.ParamConfig.VECTOR3([0,0,0])}}const c=new _;class l extends s.TypedSopNode{constructor(){super(...arguments),this.params_config=c,this._core_transform=new o.CoreTransform}static type(){return"transform"}static displayed_input_names(){return["geometry to transform"]}initialize_node(){this.io.inputs.set_count(1),this.io.inputs.init_inputs_clonable_state([i.InputCloneMode.FROM_NODE])}cook(e){const t=e[0].objects(),n=this._core_transform.matrix(this.pv.t,this.pv.r,this.pv.s,this.pv.scale);if(""===this.pv.group)for(let e of t){let t;null!=(t=e.geometry)?(t.translate(-this.pv.pivot.x,-this.pv.pivot.y,-this.pv.pivot.z),t.applyMatrix4(n),t.translate(this.pv.pivot.x,this.pv.pivot.y,this.pv.pivot.z)):e.applyMatrix4(n)}else{const e=r.CoreGroup.from_objects(t).points_from_group(this.pv.group);for(let t of e){const e=t.position().sub(this.pv.pivot);e.applyMatrix4(n),t.set_position(e.add(this.pv.pivot))}}this.set_objects(t)}}t.TransformSopNode=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(13),r=n(1),o=n(86),i=n(85),a=new r.Vector3(0,1,0),_=n(5);class c extends _.NodeParamsConfig{constructor(){super(...arguments),this.radius=_.ParamConfig.FLOAT(1,{range:[0,1]}),this.height=_.ParamConfig.FLOAT(1,{range:[0,1]}),this.segments_radial=_.ParamConfig.INTEGER(12,{range:[3,20],range_locked:[!0,!1]}),this.segments_height=_.ParamConfig.INTEGER(1,{range:[1,20],range_locked:[!0,!1]}),this.cap=_.ParamConfig.BOOLEAN(1),this.center=_.ParamConfig.VECTOR3([0,0,0]),this.direction=_.ParamConfig.VECTOR3([0,0,1])}}const l=new c;class u extends s.TypedSopNode{constructor(){super(...arguments),this.params_config=l,this._core_transform=new i.CoreTransform}static type(){return"tube"}cook(){const e=new o.CylinderBufferGeometry(this.pv.radius,this.pv.radius,this.pv.height,this.pv.segments_radial,this.pv.segments_height,!this.pv.cap);this._core_transform.rotate_geometry(e,a,this.pv.direction),e.translate(this.pv.center.x,this.pv.center.y,this.pv.center.z),this.set_geometry(e)}}t.TubeSopNode=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(13),r=n(1001),o=n(5),i=n(17),a=n(27);class _ extends o.NodeParamsConfig{constructor(){super(...arguments),this.camera=o.ParamConfig.OPERATOR_PATH("/perspective_camera1",{node_selection:{context:a.NodeContext.OBJ}})}}const c=new _;class l extends s.TypedSopNode{constructor(){super(...arguments),this.params_config=c,this._camera_controller=new r.CameraController(this._update_uvs_from_camera.bind(this))}static type(){return"uv_project"}initialize_node(){this.io.inputs.set_count(1),this.io.inputs.init_inputs_clonable_state([i.InputCloneMode.FROM_NODE])}cook(e){this._processed_core_group=e[0];const t=this.p.camera.found_node();null!=t?(this._camera_object=t.object,this._camera_controller.set_target(this._camera_object)):(this._camera_object=void 0,this._camera_controller.remove_target()),this.set_core_group(this._processed_core_group)}_update_uvs_from_camera(e){if(this._processed_core_group&&this.parent){const e=this._processed_core_group.points(),t=this.parent.object.matrixWorld;e.forEach(e=>{const n=e.position(),s=this._vector_in_camera_space(n,t);if(s){const t={x:1-(.5*s[0]+.5),y:.5*s[1]+.5};e.set_attrib_value("uv",t)}})}}_vector_in_camera_space(e,t){if(this._camera_object)return e.applyMatrix4(t),e.project(this._camera_object).toArray()}}t.UvProjectSopNode=l},function(e,t,n){"use strict";var s;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.CHANGE="change",e.MOVEEND="moveend"}(s||(s={}));t.CameraController=class{constructor(e){this._callback=e,this._update_always=!0,this._listener_added=!1,this._listener=this._execute_callback.bind(this)}remove_target(){this.set_target(void 0)}set_target(e){e||this._remove_camera_event();const t=this._target;this._target=e,null!=this._target&&this._execute_callback(),(null!=this._target?this._target.uuid:void 0)!==(null!=t?t.uuid:void 0)&&this._add_camera_event()}set_update_always(e){this._remove_camera_event(),this._update_always=e,this._add_camera_event()}_current_event_name(){return this._update_always?s.CHANGE:s.MOVEEND}_add_camera_event(){this._listener_added||null!=this._target&&(this._target.addEventListener(this._current_event_name(),this._listener),this._listener_added=!0)}_remove_camera_event(){!0===this._listener_added&&null!=this._target&&(this._target.removeEventListener(this._current_event_name(),this._listener),this._listener_added=!1)}_execute_callback(){null!=this._target&&this._callback(this._target)}}},,,function(e,t,n){"use strict";n.r(t),n.d(t,"EffectComposer",(function(){return g})),n.d(t,"Pass",(function(){return x}));var s=n(410),r=n(0),o=n(22),i=n(63),a=n(54),_=n(2),c=n(75),l={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float opacity;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","\tvec4 texel = texture2D( tDiffuse, vUv );","\tgl_FragColor = opacity * texel;","}"].join("\n")},u=n(26),d=n(23),h=n(72),p=function(e,t){h.a.call(this),this.textureID=void 0!==t?t:"tDiffuse",e instanceof u.ShaderMaterial?(this.uniforms=e.uniforms,this.material=e):e&&(this.uniforms=d.UniformsUtils.clone(e.uniforms),this.material=new u.ShaderMaterial({defines:Object.assign({},e.defines),uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),this.fsQuad=new h.a.FullScreenQuad(this.material)};p.prototype=Object.assign(Object.create(h.a.prototype),{constructor:p,render:function(e,t,n){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=n.texture),this.fsQuad.material=this.material,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),this.fsQuad.render(e))}});var m=function(e,t){h.a.call(this),this.scene=e,this.camera=t,this.clear=!0,this.needsSwap=!1,this.inverse=!1};m.prototype=Object.assign(Object.create(h.a.prototype),{constructor:m,render:function(e,t,n){var s,r,o=e.getContext(),i=e.state;i.buffers.color.setMask(!1),i.buffers.depth.setMask(!1),i.buffers.color.setLocked(!0),i.buffers.depth.setLocked(!0),this.inverse?(s=0,r=1):(s=1,r=0),i.buffers.stencil.setTest(!0),i.buffers.stencil.setOp(o.REPLACE,o.REPLACE,o.REPLACE),i.buffers.stencil.setFunc(o.ALWAYS,s,4294967295),i.buffers.stencil.setClear(r),i.buffers.stencil.setLocked(!0),e.setRenderTarget(n),this.clear&&e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(t),this.clear&&e.clear(),e.render(this.scene,this.camera),i.buffers.color.setLocked(!1),i.buffers.depth.setLocked(!1),i.buffers.stencil.setLocked(!1),i.buffers.stencil.setFunc(o.EQUAL,1,4294967295),i.buffers.stencil.setOp(o.KEEP,o.KEEP,o.KEEP),i.buffers.stencil.setLocked(!0)}});var f=function(){h.a.call(this),this.needsSwap=!1};f.prototype=Object.create(h.a.prototype),Object.assign(f.prototype,{render:function(e){e.state.buffers.stencil.setLocked(!1),e.state.buffers.stencil.setTest(!1)}});var g=function(e,t){if(this.renderer=e,void 0===t){var n={minFilter:r.LinearFilter,magFilter:r.LinearFilter,format:r.RGBAFormat,stencilBuffer:!1},o=e.getSize(new _.Vector2);this._pixelRatio=e.getPixelRatio(),this._width=o.width,this._height=o.height,(t=new c.WebGLRenderTarget(this._width*this._pixelRatio,this._height*this._pixelRatio,n)).texture.name="EffectComposer.rt1"}else this._pixelRatio=1,this._width=t.width,this._height=t.height;this.renderTarget1=t,this.renderTarget2=t.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],void 0===l&&console.error("THREE.EffectComposer relies on CopyShader"),void 0===p&&console.error("THREE.EffectComposer relies on ShaderPass"),this.copyPass=new p(l),this.clock=new s.a};Object.assign(g.prototype,{swapBuffers:function(){var e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e},addPass:function(e){this.passes.push(e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)},insertPass:function(e,t){this.passes.splice(t,0,e)},isLastEnabledPass:function(e){for(var t=e+1;t<this.passes.length;t++)if(this.passes[t].enabled)return!1;return!0},render:function(e){void 0===e&&(e=this.clock.getDelta());var t,n,s=this.renderer.getRenderTarget(),r=!1,o=this.passes.length;for(n=0;n<o;n++)if(!1!==(t=this.passes[n]).enabled){if(t.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(n),t.render(this.renderer,this.writeBuffer,this.readBuffer,e,r),t.needsSwap){if(r){var i=this.renderer.getContext(),a=this.renderer.state.buffers.stencil;a.setFunc(i.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,e),a.setFunc(i.EQUAL,1,4294967295)}this.swapBuffers()}void 0!==m&&(t instanceof m?r=!0:t instanceof f&&(r=!1))}this.renderer.setRenderTarget(s)},reset:function(e){if(void 0===e){var t=this.renderer.getSize(new _.Vector2);this._pixelRatio=this.renderer.getPixelRatio(),this._width=t.width,this._height=t.height,(e=this.renderTarget1.clone()).setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2},setSize:function(e,t){this._width=e,this._height=t;var n=this._width*this._pixelRatio,s=this._height*this._pixelRatio;this.renderTarget1.setSize(n,s),this.renderTarget2.setSize(n,s);for(var r=0;r<this.passes.length;r++)this.passes[r].setSize(n,s)},setPixelRatio:function(e){this._pixelRatio=e,this.setSize(this._width,this._height)}});var v,y,b,x=function(){this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1};Object.assign(x.prototype,{setSize:function(){},render:function(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}}),x.FullScreenQuad=(v=new i.OrthographicCamera(-1,1,1,-1,0,1),y=new a.PlaneBufferGeometry(2,2),b=function(e){this._mesh=new o.Mesh(y,e)},Object.defineProperty(b.prototype,"material",{get:function(){return this._mesh.material},set:function(e){this._mesh.material=e}}),Object.assign(b.prototype,{dispose:function(){this._mesh.geometry.dispose()},render:function(e){e.render(this._mesh,v)}}),b)}]);
//# sourceMappingURL=polygonjs-engine.js.map