(window.webpackJsonpPOLY=window.webpackJsonpPOLY||[]).push([["Mat"],{333:function(e,t,n){"use strict";var a;n.d(t,"b",(function(){return a})),n.d(t,"a",(function(){return s})),function(e){e.VERTEX="vertex",e.FRAGMENT="fragment",e.LEAVES_FROM_NODES_SHADER="leaves_from_nodes_shader",e.PARTICLES_0="particles_0",e.PARTICLES_1="particles_1",e.PARTICLES_2="particles_2",e.PARTICLES_3="particles_3",e.PARTICLES_4="particles_4",e.PARTICLES_5="particles_5",e.PARTICLES_6="particles_6",e.PARTICLES_7="particles_7",e.PARTICLES_8="particles_8",e.PARTICLES_9="particles_9"}(a||(a={}));const s=[a.PARTICLES_0,a.PARTICLES_1,a.PARTICLES_2,a.PARTICLES_3,a.PARTICLES_4,a.PARTICLES_5,a.PARTICLES_6,a.PARTICLES_7,a.PARTICLES_8,a.PARTICLES_9]},335:function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var a=n(373);function s(e){this.manager=void 0!==e?e:a.a,this.crossOrigin="anonymous",this.path="",this.resourcePath=""}Object.assign(s.prototype,{load:function(){},parse:function(){},setCrossOrigin:function(e){return this.crossOrigin=e,this},setPath:function(e){return this.path=e,this},setResourcePath:function(e){return this.resourcePath=e,this}})},339:function(e,t,n){"use strict";n.d(t,"a",(function(){return d}));var a=n(1),s=n(58),i=(n(330),n(39));class r extends i.b{set_content(e){super.set_content(e)}set_material(e){null!=this._content&&this._content.dispose(),this.set_content(e)}has_material(){return this.has_content()}material(){return this.content()}}var o=n(35),_=n(37);class d extends s.b{constructor(){super(...arguments),this.container_controller=new _.a(this,r),this._cook_main_without_inputs_when_dirty_bound=this._cook_main_without_inputs_when_dirty.bind(this)}static node_context(){return o.a.MAT}initialize_base_node(){super.initialize_base_node(),this.name_controller.add_post_set_full_path_hook(this.set_material_name.bind(this)),this.add_post_dirty_hook("_cook_main_without_inputs_when_dirty",this._cook_main_without_inputs_when_dirty_bound)}node_sibbling(e){return super.node_sibbling(e)}_cook_main_without_inputs_when_dirty(){return Object(a.a)(this,void 0,void 0,(function*(){yield this.cook_controller.cook_main_without_inputs()}))}set_material_name(){this._material&&(this._material.name=this.full_path())}get material(){return this._material=this._material||this.create_material()}set_material(e){this.set_container(e)}add_render_hook(e){}}},344:function(e,t,n){"use strict";n.d(t,"a",(function(){return a})),n.d(t,"b",(function(){return u}));var a,s=n(1),i=n(366),r=n(332),o=n(333),_=n(331),d=n(45),l=n(119),h=n(336),c=n(388);!function(e){e.DISTANCE="customDistanceMaterial",e.DEPTH="customDepthMaterial",e.DEPTH_DOF="customDepthDOFMaterial"}(a||(a={}));class u extends i.a{constructor(){super(...arguments),this._assemblers_by_custom_name=new Map}create_material(){return new h.a}custom_assembler_class_by_custom_name(){}_add_custom_materials(e){const t=this.custom_assembler_class_by_custom_name();t&&t.forEach((t,n)=>{this._add_custom_material(e,n,t)})}_add_custom_material(e,t,n){let a=this._assemblers_by_custom_name.get(t);a||(a=new n(this._gl_parent_node),this._assemblers_by_custom_name.set(t,a)),e.custom_materials=e.custom_materials||{},e.custom_materials[t]=a.create_material()}compile_custom_materials(e){return Object(s.a)(this,void 0,void 0,(function*(){const t=this.custom_assembler_class_by_custom_name();t&&t.forEach((t,n)=>Object(s.a)(this,void 0,void 0,(function*(){if(this._code_builder){let a=this._assemblers_by_custom_name.get(n);a||(a=new t(this._gl_parent_node),this._assemblers_by_custom_name.set(n,a)),a.set_root_nodes(this._root_nodes),a.set_param_configs_owner(this._code_builder),a.set_shader_configs(this.shader_configs),a.set_variable_configs(this.variable_configs());const s=e.custom_materials[n];s&&(yield a.compile_material(s))}})))}))}compile_material(e){return Object(s.a)(this,void 0,void 0,(function*(){if(!this.compile_allowed())return;const t=c.a.find_output_nodes(this._gl_parent_node);t.length>1&&this._gl_parent_node.states.error.set("only one output node allowed"),this.set_root_nodes(t),yield this._update_shaders();const n=this._shaders_by_name.get(o.b.VERTEX),a=this._shaders_by_name.get(o.b.FRAGMENT);n&&a&&(e.vertexShader=n,e.fragmentShader=a,this.add_uniforms(e.uniforms),e.needsUpdate=!0);const s=this._gl_parent_node.scene;this.uniforms_time_dependent()?s.uniforms_controller.add_time_dependent_uniform_owner(e.uuid,e.uniforms):s.uniforms_controller.remove_time_dependent_uniform_owner(e.uuid),e.custom_materials&&(yield this.compile_custom_materials(e))}))}_update_shaders(){return Object(s.a)(this,void 0,void 0,(function*(){this._shaders_by_name=new Map,this._lines=new Map;for(let e of this.shader_names){const t=this._template_shader_for_shader_name(e);t&&this._lines.set(e,t.split("\n"))}this._root_nodes.length>0&&(yield this.build_code_from_nodes(this._root_nodes),this._build_lines());for(let e of this.shader_names){const t=this._lines.get(e);t&&this._shaders_by_name.set(e,t.join("\n"))}}))}shadow_assembler_class_by_custom_name(){return{}}add_output_body_line(e,t,n){var a;const s=e.io.inputs.named_input(n),i=e.variable_for_input(n),o=this.variable_config(n);let _=null;if(s)_=r.a.vector3(i);else if(o.default_from_attribute()){const s=e.io.inputs.named_input_connection_points_by_name(n);if(s){const i=s.type,r=null===(a=this.globals_handler)||void 0===a?void 0:a.read_attribute(e,i,n,t);r&&(_=r)}}else{const e=o.default();e&&(_=e)}if(_){const n=o.prefix(),a=o.suffix(),s=o.if_condition();s&&t.add_body_lines(e,[`#if ${s}`]),t.add_body_lines(e,[`${n}${_}${a}`]),s&&t.add_body_lines(e,["#endif"])}}set_node_lines_output(e,t){var n;const a=t.current_shader_name,s=null===(n=this.shader_config(a))||void 0===n?void 0:n.input_names();if(s)for(let n of s)this.add_output_body_line(e,t,n)}set_node_lines_attribute(e,t){var n;const a=e.gl_type(),s=null===(n=this.globals_handler)||void 0===n?void 0:n.read_attribute(e,a,e.attribute_name,t),i=e.gl_var_name(e.output_name);t.add_body_lines(e,[`${a} ${i} = ${s}`])}handle_gl_FragCoord(e,t,n){t==o.b.FRAGMENT&&e.push(`vec4 ${n} = gl_FragCoord`)}handle_resolution(e,t,n){t==o.b.FRAGMENT&&e.push(`vec2 ${n} = resolution`)}set_node_lines_globals(e,t){var n;const a=[],s=t.current_shader_name,i=this.shader_config(s);if(!i)return;const r=i.dependencies(),h=new Map,c=new Map;let u,p;for(let i of e.io.outputs.used_output_names()){const m=e.gl_var_name(i),f=t.current_shader_name;switch(i){case"time":u=new _.d(e,d.c.FLOAT,i),f&&l.a.push_on_array_at_entry(h,f,u),p=`float ${m} = ${i}`;for(let e of r)l.a.push_on_array_at_entry(h,e,u),l.a.push_on_array_at_entry(c,e,p);a.push(p),this.set_uniforms_time_dependent();break;case"gl_FragCoord":this.handle_gl_FragCoord(a,s,m);break;case"resolution":this.handle_resolution(a,s,m),u=new _.d(e,d.c.VEC2,i),f&&l.a.push_on_array_at_entry(h,f,u);for(let e of r)l.a.push_on_array_at_entry(h,e,u);this.set_resolution_dependent();break;case"gl_PointCoord":s==o.b.FRAGMENT&&a.push(`vec2 ${m} = gl_PointCoord`);break;default:null===(n=this.globals_handler)||void 0===n||n.handle_globals_node(e,i,t)}}h.forEach((n,a)=>{t.add_definitions(e,n,a)}),c.forEach((n,a)=>{t.add_body_lines(e,n,a)}),t.add_body_lines(e,a)}}},345:function(e,t,n){"use strict";n.d(t,"a",(function(){return d}));var a=n(385),s=n(359),i=n(331),r=n(119),o=n(333);const _={position:"vec3( position )"};class d extends a.a{handle_globals_node(e,t,n){var a;const s=e.io.outputs.named_output_connection_points_by_name(t);if(!s)return;const r=e.gl_var_name(t),o=s.type,_=new i.e(e,o,r);n.add_definitions(e,[_]);const d=null===(a=e.material_node)||void 0===a?void 0:a.assembler_controller.assembler;if(!d)return;const l=d.shader_config(n.current_shader_name);if(!l)return;const h=l.dependencies(),c=`${r} = ${o}(${t})`;for(let t of h)n.add_definitions(e,[_],t),n.add_body_lines(e,[c],t);0==h.length&&n.add_body_lines(e,[c])}static variable_config_default(e){return _[e]}variable_config_default(e){return d.variable_config_default(e)}read_attribute(e,t,n,a){return d.read_attribute(e,t,n,a)}static read_attribute(e,t,n,a){var _;d.PRE_DEFINED_ATTRIBUTES.indexOf(n)<0&&a.add_definitions(e,[new i.a(e,t,n)],o.b.VERTEX);const l=a.current_shader_name;switch(l){case o.b.VERTEX:return n;case o.b.FRAGMENT:{if(!(e instanceof s.a))return;const d="varying_"+e.gl_var_name(e.output_name),h=new i.e(e,t,d),c=new Map;c.set(o.b.FRAGMENT,[]);const u=new Map;u.set(o.b.FRAGMENT,[]),r.a.push_on_array_at_entry(c,l,h);const p=`${d} = ${t}(${n})`,m=null===(_=e.material_node)||void 0===_?void 0:_.assembler_controller.assembler.shader_config(l);if(m){const t=m.dependencies();for(let e of t)r.a.push_on_array_at_entry(c,e,h),r.a.push_on_array_at_entry(u,e,p);c.forEach((t,n)=>{a.add_definitions(e,t,n)}),u.forEach((t,n)=>{a.add_body_lines(e,t,n)})}return d}}}handle_attribute_node(e,t,n,a){return d.read_attribute(e,t,n,a)}}d.PRE_DEFINED_ATTRIBUTES=["position","color","normal","uv","uv2","morphTarget0","morphTarget1","morphTarget2","morphTarget3","skinIndex","skinWeight"],d.IF_RULE={uv:"defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )"}},346:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var a=n(4),s=n(83);function i(e,t,n,i,r,o,_,d,l){s.a.call(this,e,t,n,i,r,o,_,d,l),this.format=void 0!==_?_:a.dc,this.minFilter=void 0!==o?o:a.R,this.magFilter=void 0!==r?r:a.R,this.generateMipmaps=!1}i.prototype=Object.assign(Object.create(s.a.prototype),{constructor:i,isVideoTexture:!0,update:function(){var e=this.image;e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}})},349:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var a={enabled:!1,files:{},add:function(e,t){!1!==this.enabled&&(this.files[e]=t)},get:function(e){if(!1!==this.enabled)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}}},354:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));class a{constructor(e){this.node=e}add_params(){}update(){}get material(){return this.node.material}}},355:function(e,t,n){"use strict";n.d(t,"b",(function(){return _})),n.d(t,"a",(function(){return d}));var a=n(354),s=n(4),i=n(330),r=n(339),o=n(44);function _(e){return class extends e{constructor(){super(...arguments),this.double_sided=o.b.BOOLEAN(0),this.front=o.b.BOOLEAN(1,{visible_if:{double_sided:!1}})}}}i.a;_(o.a);r.a;class d extends a.a{static update(e){const t=e.pv.front?s.E:s.h,n=e.pv.double_sided?s.w:t;n!=e.material.side&&(e.material.side=n,e.material.needsUpdate=!0)}}},360:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));class a{constructor(e,t,n){this._name=e,this._input_names=t,this._dependencies=n}name(){return this._name}input_names(){return this._input_names}dependencies(){return this._dependencies}}},361:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));class a{constructor(e,t={}){this._name=e,this._options=t}name(){return this._name}default_from_attribute(){return this._options.default_from_attribute||!1}default(){return this._options.default}if_condition(){return this._options.if}prefix(){return this._options.prefix||""}suffix(){return this._options.suffix||""}}},362:function(e,t,n){"use strict";n.d(t,"b",(function(){return o})),n.d(t,"a",(function(){return _}));var a=n(354),s=n(330),i=n(44),r=n(339);function o(e){return class extends e{constructor(){super(...arguments),this.skinning=i.b.BOOLEAN(0)}}}s.a;o(i.a);r.a;class _ extends a.a{static update(e){const t=e.pv.skinning;t!=e.material.skinning&&(e.material.skinning=t,e.material.needsUpdate=!0)}}},363:function(e,t,n){"use strict";n.d(t,"b",(function(){return d})),n.d(t,"a",(function(){return l}));var a=n(1),s=n(330),i=n(351),r=n(339),o=n(389),_=n(44);function d(e){return class extends e{constructor(){super(...arguments),this.use_map=_.b.BOOLEAN(0,Object(o.b)(l)),this.map=_.b.OPERATOR_PATH(i.a.DEFAULT_NODE_PATH.UV,Object(o.c)(l,"use_map"))}}}s.a;d(_.a);r.a;class l extends o.a{constructor(e,t){super(e,t)}initialize_node(){this.add_hooks(this.node.p.use_map,this.node.p.map)}update(){return Object(a.a)(this,void 0,void 0,(function*(){this._update(this.node.material,"map",this.node.p.use_map,this.node.p.map)}))}static update(e){return Object(a.a)(this,void 0,void 0,(function*(){e.texture_map_controller.update()}))}}},364:function(e,t,n){"use strict";n.d(t,"b",(function(){return d})),n.d(t,"a",(function(){return l}));var a=n(1),s=n(330),i=n(351),r=n(339),o=n(389),_=n(44);function d(e){return class extends e{constructor(){super(...arguments),this.use_alpha_map=_.b.BOOLEAN(0,Object(o.b)(l)),this.alpha_map=_.b.OPERATOR_PATH(i.a.DEFAULT_NODE_PATH.UV,Object(o.c)(l,"use_alpha_map"))}}}s.a;d(_.a);r.a;class l extends o.a{constructor(e,t){super(e,t)}initialize_node(){this.add_hooks(this.node.p.use_alpha_map,this.node.p.alpha_map)}update(){return Object(a.a)(this,void 0,void 0,(function*(){this._update(this.node.material,"alphaMap",this.node.p.use_alpha_map,this.node.p.alpha_map)}))}static update(e){return Object(a.a)(this,void 0,void 0,(function*(){e.texture_alpha_map_controller.update()}))}}},365:function(e,t,n){"use strict";n.d(t,"a",(function(){return T}));var a=n(1),s=n(397),i=n.n(s),r=n(384),o=n.n(r),_=n(137),d=n.n(_),l=n(12),h=n(58),c=n(345),u=n(15);class p{constructor(e){this._scene=e,this._data={}}data(){this._scene.nodes_controller.reset_node_context_signatures();const e=S.dispatch_node(this._scene.root),t=e.data(),n=e.ui_data();return this._data={properties:{frame:this._scene.frame||1,frame_range:this._scene.frame_range,frame_range_locked:this._scene.time_controller.frame_range_locked,master_camera_node_path:this._scene.cameras_controller.master_camera_node_path},root:t,ui:n},this._data}static sanitize_string(e){return e=e.replace(/'/g,"'"),e=u.a.escape_line_breaks(e)}}class m{constructor(e){this._node=e}data(){var e,t,n,a;this.is_root()||this._node.scene.nodes_controller.register_node_context_signature(this._node),this._data={type:this._node.type};const s=this.nodes_data();if(Object.keys(s).length>0){this._data.nodes=s;const t=null===(e=this._node.children_controller)||void 0===e?void 0:e.context;t&&(this._data.children_context=t)}if(this.is_root()||(this._data.params=this.params_data(),this._data.inputs=this.inputs_data()),this._node.flags&&(this._data.flags={},this._node.flags.has_bypass()&&(null===(t=this._node.flags.bypass)||void 0===t?void 0:t.active)&&(this._data.flags.bypass=this._node.flags.bypass.active),this._node.flags.has_display()&&(this._data.flags.display=null===(n=this._node.flags.display)||void 0===n?void 0:n.active)),this._node.children_allowed()){const e=null===(a=this._node.children_controller)||void 0===a?void 0:a.selection;if(e&&this._node.children().length>0){const t=[],n={};for(let t of e.nodes())n[t.graph_node_id]=!0;for(let e of this._node.children())e.graph_node_id in n&&t.push(e);this._data.selection=t.map(e=>e.name)}}if(this._node.io.inputs.override_clonable_state_allowed()){const e=this._node.io.inputs.override_clonable_state();e&&(this._data.override_clonable_state=e)}return this.add_custom(),this._data}ui_data(){const e={};if(!this.is_root()){const t=this._node.ui_data;e.pos=t.position.toArray();const n=t.comment;n&&(e.comment=p.sanitize_string(n))}const t=this._node.children();return t.length>0&&(e.nodes={},t.forEach(t=>{const n=S.dispatch_node(t);e.nodes[t.name]=n.ui_data()})),e}is_root(){return null===this._node.parent&&this._node.graph_node_id==this._node.root.graph_node_id}inputs_data(){const e=[];return this._node.io.inputs.inputs().forEach((t,n)=>{if(t){const a=this._node.io.connections.input_connection(n);if(this._node.io.inputs.has_named_inputs){const s=this._node.io.inputs.named_input_connection_points[n].name,i=a.output_index,r=t.io.outputs.named_output_connection_points[i].name;e.push({name:s,node:t.name,output:r})}else e.push(t.name)}}),e}params_data(){const e={};for(let t of this._node.params.names){const n=this._node.params.get(t);if(n&&!n.parent_param){const t=S.dispatch_param(n);if(t.required){const a=t.data();e[n.name]=a}}}return e}nodes_data(){const e={};for(let t of this._node.children()){const n=S.dispatch_node(t);e[t.name]=n.data()}return e}add_custom(){}}class f{constructor(e){this._param=e,this._complex_data={}}get required(){const e=this._param.options.is_spare&&!this._param.parent_param,t=!this._param.is_default;return e||t}data(){if(this._param.parent_param)throw console.warn("no component should be saved"),"no component should be saved";return this._require_data_complex()?this._data_complex():this._data_simple()}_data_simple(){return this._param.raw_input_serialized}_data_complex(){if(this._complex_data={},this._param.options.is_spare&&!this._param.parent_param&&(this._complex_data.type=this._param.type,this._complex_data.default_value=this._param.default_value_serialized,this._complex_data.raw_input=this._param.raw_input_serialized,this._complex_data.options=this._param.options.current),this._param.is_default||this.add_main(),this._param.options.has_options_overridden){const e={},t=this._param.options.overridden_options;for(let n of Object.keys(t)){const a=t[n];e[n]=JSON.stringify(a)}this._complex_data.overriden_options=e}return this._complex_data}_require_data_complex(){return!!this._param.options.is_spare||!!this._param.options.has_options_overridden}add_main(){}}class b extends f{add_main(){if(!this._require_data_complex())return this._param.raw_input_serialized;this._complex_data.raw_input=this._param.raw_input_serialized}}class v extends f{add_main(){let e=this._param.raw_input;if(e=p.sanitize_string(e),!this._require_data_complex())return e;this._complex_data.raw_input=e}}class g extends f{add_main(){let e=this._param.raw_input;if(e=p.sanitize_string(e),!this._require_data_complex())return e;this._complex_data.raw_input=e}}class y extends f{add_main(){if(!this._require_data_complex())return this._param.raw_input_serialized;this._complex_data.raw_input=this._param.raw_input_serialized}}var E=n(43),x=n(139),w=n(67),O=n(28);class S{static dispatch_node(e){return new m(e)}static dispatch_param(e){return e instanceof E.a?new b(e):e instanceof x.a?new v(e):e instanceof w.a?new g(e):e instanceof O.a?new y(e):new f(e)}}h.b;class T{constructor(e,t){this.node=e,this._globals_handler=new c.a,this._compile_required=!0,this._deleted_params_data=new Map,this._assembler=new t(this.node)}set_assembler_globals_handler(e){(this._globals_handler?this._globals_handler.id():null)!=(e?e.id():null)&&(this._globals_handler=e,this.set_compilation_required_and_dirty(),this._assembler.reset_configs())}get assembler(){return this._assembler}get globals_handler(){return this._globals_handler}add_output_params(e){this._assembler.add_output_params(e)}add_globals_params(e){this._assembler.add_globals_params(e)}allow_attribute_exports(){return this._assembler.allow_attribute_exports()}on_create(){const e=this.node.create_node("globals"),t=this.node.create_node("output");e.ui_data.set_position(new l.a(-200,0)),t.ui_data.set_position(new l.a(200,0))}set_compilation_required(e=!0){this._compile_required=e}set_compilation_required_and_dirty(e){this.set_compilation_required(),this.node.set_dirty(e)}compile_required(){return this._compile_required}post_compile(){return Object(a.a)(this,void 0,void 0,(function*(){this.create_spare_parameters(),this.set_compilation_required(!1)}))}assign_uniform_values(){return Object(a.a)(this,void 0,void 0,(function*(){if(this._assembler)for(let e of this._assembler.param_configs())yield e.set_uniform_value(this.node)}))}create_spare_parameters(){const e=this.node.params.spare_names,t=this._assembler.param_configs(),n=t.map(e=>e.name),a=d()(n,e),s=d()(e,n),r={},_=this.node.params.names,l=o()(a,_);if(l.length>0){const e=`${this.node.full_path()} attempts to create spare params called '${l.join(", ")}' with same name as params`;console.warn(e),this.node.states.error.set(e)}s.forEach(e=>{const t=this.node.params.get(e);if(t){const e=S.dispatch_param(t);if(e.required){const n=e.data();this._deleted_params_data.set(t.name,n)}}r.names_to_delete=r.names_to_delete||[],r.names_to_delete.push(e)});for(let e of t)if(a.indexOf(e.name)>=0){const t=i()(e.param_options,{spare:!0,cook:!0});r.to_add=r.to_add||[],r.to_add.push({name:e.name,type:e.type,init_value:e.default_value,options:t})}this.node.params.update_params(r)}}},366:function(e,t,n){"use strict";n.d(t,"a",(function(){return I}));var a,s=n(1),i=n(12);!function(e){e.FUNCTION_DECLARATION="function_declaration",e.DEFINE="define",e.BODY="body"}(a||(a={}));var r=n(360),o=n(361),_=n(30),d=n.n(_),l=n(386),h=n(119),c=n(331),u=n(371),p=n(376);class m{constructor(e){this._shader_name=e,this._definitions_by_node_id=new Map,this._body_lines_by_node_id=new Map}get shader_name(){return this._shader_name}add_definitions(e,t){for(let n of t)h.a.push_on_array_at_entry(this._definitions_by_node_id,e.graph_node_id,n)}definitions(e){return this._definitions_by_node_id.get(e.graph_node_id)}add_body_lines(e,t){for(let n of t)h.a.push_on_array_at_entry(this._body_lines_by_node_id,e.graph_node_id,n)}body_lines(e){return this._body_lines_by_node_id.get(e.graph_node_id)}}class f{constructor(e,t){this._shader_names=e,this._current_shader_name=t,this._lines_controller_by_shader_name=new Map;for(let e of this._shader_names)this._lines_controller_by_shader_name.set(e,new m(e))}get shader_names(){return this._shader_names}set_current_shader_name(e){this._current_shader_name=e}get current_shader_name(){return this._current_shader_name}add_definitions(e,t,n){if(0==t.length)return;n=n||this._current_shader_name;const a=this._lines_controller_by_shader_name.get(n);a&&a.add_definitions(e,t)}definitions(e,t){const n=this._lines_controller_by_shader_name.get(e);if(n)return n.definitions(t)}add_body_lines(e,t,n){if(0==t.length)return;n=n||this._current_shader_name;const a=this._lines_controller_by_shader_name.get(n);a&&a.add_body_lines(e,t)}body_lines(e,t){const n=this._lines_controller_by_shader_name.get(e);if(n)return n.body_lines(t)}}const b={[a.FUNCTION_DECLARATION]:"",[a.DEFINE]:";",[a.BODY]:";"},v={[a.FUNCTION_DECLARATION]:"",[a.DEFINE]:"",[a.BODY]:"\t"};class g{static node_comment(e,t){let n=`// ${e.full_path()}`;return t==a.BODY&&(n=`\t${n}`),n}static line_wrap(e,t){let n=!0;return 0!=e.indexOf("#if")&&0!=e.indexOf("#endif")||(n=!1),n?`${v[t]}${e}${b[t]}`:`${v[t]}${e}`}static post_line_separator(e){return e==a.BODY?"\t":""}}class y{constructor(e,t){this._assembler=e,this._gl_parent_node=t,this._param_configs_controller=new p.a,this._param_configs_set_allowed=!0,this._lines=new Map,this._function_declared=new Map}build_from_nodes(e){return Object(s.a)(this,void 0,void 0,(function*(){const t=new l.a(this._assembler,this._gl_parent_node);t.traverse(e);const n=new Map;for(let e of this.shader_names())n.set(e,t.nodes_for_shader_name(e));const a=t.sorted_nodes();for(let e of this.shader_names()){const t=this._assembler.root_nodes_by_shader_name(e);for(let a of t)h.a.push_on_array_at_entry(n,e,a)}const s=new Map;for(let e of a)s.set(e.graph_node_id,!0);for(let t of e)s.get(t.graph_node_id)||(a.push(t),s.set(t.graph_node_id,!0));for(let e of a)e.reset_code();for(let e of a)yield e.params.eval_all();this._shaders_collection_controller=new f(this.shader_names(),this.shader_names()[0]),this.reset();for(let e of this.shader_names()){const t=d()(n.get(e));if(this._shaders_collection_controller.set_current_shader_name(e),t)for(let e of t)this._param_configs_set_allowed&&e.set_param_configs(),e.set_lines(this._shaders_collection_controller)}this._param_configs_set_allowed&&this.set_param_configs(a),this.set_code_lines(a)}))}disallow_new_param_configs(){this._param_configs_set_allowed=!1}allow_new_param_configs(){this._param_configs_set_allowed=!0}shader_names(){return this._assembler.shader_names}reset(){for(let e of this.shader_names()){const t=new Map;this._lines.set(e,t),this._function_declared.set(e,new Map)}}param_configs(){return this._param_configs_controller.list||[]}lines(e,t){return this._lines.get(e).get(t)}all_lines(){return this._lines}set_param_configs(e){this._param_configs_controller.reset();for(let t of e){const e=t.param_configs();if(e)for(let t of e)this._param_configs_controller.push(t)}}set_code_lines(e){for(let t of this.shader_names())this.add_code_lines(e,t)}add_code_lines(e,t){this.add_definitions(e,t,c.c.FUNCTION,a.FUNCTION_DECLARATION),this.add_definitions(e,t,c.c.UNIFORM,a.DEFINE),this.add_definitions(e,t,c.c.VARYING,a.DEFINE),this.add_definitions(e,t,c.c.ATTRIBUTE,a.DEFINE),this.add_code_line_for_nodes_and_line_type(e,t,a.BODY)}add_definitions(e,t,n,a){if(!this._shaders_collection_controller)return;const s=[];for(let a of e){let e=this._shaders_collection_controller.definitions(t,a);if(e){e=e.filter(e=>e.definition_type==n);for(let t of e)s.push(t)}}if(s.length>0){const e=new u.a(s),n=e.uniq();if(e.errored)throw`code builder error: ${e.error_message}`;const i=new Map,r=new Map;for(let e of n){const t=e.node.graph_node_id;r.has(t)||r.set(t,!0),h.a.push_on_array_at_entry(i,t,e)}const o=this._lines.get(t);r.forEach((e,t)=>{const n=i.get(t);if(n){const e=n[0];if(e){const t=g.node_comment(e.node,a);h.a.push_on_array_at_entry(o,a,t);for(let e of n){const t=g.line_wrap(e.line,a);h.a.push_on_array_at_entry(o,a,t)}const s=g.post_line_separator(a);h.a.push_on_array_at_entry(o,a,s)}}})}}add_code_line_for_nodes_and_line_type(e,t,n){var a=(e=e.filter(e=>{if(this._shaders_collection_controller){const n=this._shaders_collection_controller.body_lines(t,e);return n&&n.length>0}})).length;for(let s=0;s<a;s++){const a=s==e.length-1;this.add_code_line_for_node_and_line_type(e[s],t,n,a)}}add_code_line_for_node_and_line_type(e,t,n,s){if(!this._shaders_collection_controller)return;const i=this._shaders_collection_controller.body_lines(t,e);if(i&&i.length>0){const r=this._lines.get(t),o=g.node_comment(e,n);if(h.a.push_on_array_at_entry(r,n,o),d()(i).forEach(e=>{e=g.line_wrap(e,n),h.a.push_on_array_at_entry(r,n,e)}),n!=a.BODY||!s){const e=g.post_line_separator(n);h.a.push_on_array_at_entry(r,n,e)}}}}var E=n(345);var x=n(333),w=n(0),O=n(118),S=n(45),T=n(387),M=n(359);const A=new Map([[x.b.VERTEX,"#include <common>"],[x.b.FRAGMENT,"#include <common>"]]),N=new Map([[x.b.VERTEX,"#include <color_vertex>"],[x.b.FRAGMENT,"vec4 diffuseColor = vec4( diffuse, opacity );"]]),R=new Map([[x.b.VERTEX,["#include <begin_vertex>","#include <beginnormal_vertex>"]],[x.b.FRAGMENT,[]]]);class I extends class{}{constructor(e){super(),this._gl_parent_node=e,this._shaders_by_name=new Map,this._lines=new Map,this._root_nodes=[],this._leaf_nodes=[],this._uniforms_time_dependent=!1,this._resolution_dependent=!1}compile(){return Object(s.a)(this,void 0,void 0,(function*(){}))}_template_shader_for_shader_name(e){var t,n;switch(e){case x.b.VERTEX:return null===(t=this._template_shader)||void 0===t?void 0:t.vertexShader;case x.b.FRAGMENT:return null===(n=this._template_shader)||void 0===n?void 0:n.fragmentShader}}get globals_handler(){return this._gl_parent_node.assembler_controller.globals_handler}compile_allowed(){return null!=this._gl_parent_node.assembler_controller.globals_handler}shaders_by_name(){return this._shaders_by_name}_build_lines(){for(let e of this.shader_names){const t=this._template_shader_for_shader_name(e);t&&this._replace_template(t,e)}}set_root_nodes(e){this._root_nodes=e}get _template_shader(){}add_uniforms(e){for(let t of this.param_configs())e[t.uniform_name]=t.uniform;this.uniforms_time_dependent()&&(e.time={value:this._gl_parent_node.scene.time}),this.resolution_dependent()&&(e.resolution={value:new i.a(1e3,1e3)})}root_nodes_by_shader_name(e){const t=[];for(let e of this._root_nodes)switch(e.type){case"output":t.push(e)}return t}leaf_nodes_by_shader_name(e){const t=[];for(let e of this._leaf_nodes)switch(e.type){case T.a.type():t.push(e);break;case M.a.type():}return t}set_node_lines_globals(e,t){}set_node_lines_output(e,t){}set_node_lines_attribute(e,t){}get code_builder(){return this._code_builder=this._code_builder||new y(this,this._gl_parent_node)}build_code_from_nodes(e){return Object(s.a)(this,void 0,void 0,(function*(){yield this.code_builder.build_from_nodes(e)}))}allow_new_param_configs(){this.code_builder.allow_new_param_configs()}disallow_new_param_configs(){this.code_builder.disallow_new_param_configs()}builder_param_configs(){return this.code_builder.param_configs()}builder_lines(e,t){return this.code_builder.lines(e,t)}all_builder_lines(){return this.code_builder.all_lines()}param_configs(){return(this._param_config_owner||this.code_builder).param_configs()}set_param_configs_owner(e){this._param_config_owner=e,this._param_config_owner?this.code_builder.disallow_new_param_configs():this.code_builder.allow_new_param_configs()}static add_output_params(e){e.params.add_param(w.a.VECTOR3,"position",[0,0,0],{hidden:!0}),e.params.add_param(w.a.VECTOR3,"normal",[0,0,0],{hidden:!0}),e.params.add_param(w.a.COLOR,"color",[1,1,1],{hidden:!0}),e.params.add_param(w.a.FLOAT,"alpha",1,{hidden:!0}),e.params.add_param(w.a.VECTOR2,"uv",[0,0],{hidden:!0})}add_output_params(e){I.add_output_params(e)}static create_globals_node_output_connections(){return[new O.a("position",S.c.VEC3),new O.a("normal",S.c.VEC3),new O.a("color",S.c.VEC3),new O.a("uv",S.c.VEC2),new O.a("gl_FragCoord",S.c.VEC4),new O.a("resolution",S.c.VEC2),new O.a("time",S.c.FLOAT)]}create_globals_node_output_connections(){return I.create_globals_node_output_connections()}add_globals_params(e){e.io.outputs.set_named_output_connection_points(this.create_globals_node_output_connections())}allow_attribute_exports(){return!1}reset_configs(){this._reset_shader_configs(),this._reset_variable_configs(),this._reset_uniforms_time_dependency(),this._reset_resolution_dependency()}get shader_configs(){return this._shader_configs=this._shader_configs||this.create_shader_configs()}set_shader_configs(e){this._shader_configs=e}get shader_names(){var e;return(null===(e=this.shader_configs)||void 0===e?void 0:e.map(e=>e.name()))||[]}_reset_shader_configs(){this._shader_configs=void 0}create_shader_configs(){return[new r.a(x.b.VERTEX,["position","normal","uv"],[]),new r.a(x.b.FRAGMENT,["color","alpha"],[x.b.VERTEX])]}shader_config(e){var t;return null===(t=this.shader_configs)||void 0===t?void 0:t.filter(t=>t.name()==e)[0]}variable_configs(){return this._variable_configs=this._variable_configs||this.create_variable_configs()}set_variable_configs(e){this._variable_configs=e}variable_config(e){return this.variable_configs().filter(t=>t.name()==e)[0]}static create_variable_configs(){return[new o.a("position",{default_from_attribute:!0,prefix:"vec3 transformed = "}),new o.a("normal",{default_from_attribute:!0,prefix:"vec3 objectNormal = "}),new o.a("color",{prefix:"diffuseColor.xyz = "}),new o.a("alpha",{prefix:"diffuseColor.a = "}),new o.a("uv",{prefix:"vUv = ",if:E.a.IF_RULE.uv})]}create_variable_configs(){return I.create_variable_configs()}_reset_variable_configs(){this._variable_configs=void 0,this.variable_configs()}input_names_for_shader_name(e,t){var n;return(null===(n=this.shader_config(t))||void 0===n?void 0:n.input_names())||[]}_reset_uniforms_time_dependency(){this._uniforms_time_dependent=!1}set_uniforms_time_dependent(){this._uniforms_time_dependent=!0}uniforms_time_dependent(){return this._uniforms_time_dependent}_reset_resolution_dependency(){this._resolution_dependent=!1}set_resolution_dependent(){this._resolution_dependent=!0}resolution_dependent(){return this._resolution_dependent}insert_define_after(e){return A.get(e)}insert_body_after(e){return N.get(e)}lines_to_remove(e){return R.get(e)}_replace_template(e,t){const n=this.builder_lines(t,a.FUNCTION_DECLARATION),s=this.builder_lines(t,a.DEFINE),i=this.builder_lines(t,a.BODY);let r=e.split("\n");const o=[],_=this.insert_define_after(t),d=this.insert_body_after(t),l=this.lines_to_remove(t);let h=!1,c=!1;for(let e of r){1==h&&(n&&this._insert_lines(o,n),s&&this._insert_lines(o,s),h=!1),1==c&&(i&&this._insert_lines(o,i),c=!1);let t=!1;if(l)for(let n of l)e.indexOf(n)>=0&&(t=!0);t?(o.push("// removed:"),o.push(`//${e}`)):o.push(e),_&&e.indexOf(_)>=0&&(h=!0),d&&e.indexOf(d)>=0&&(c=!0)}this._lines.set(t,o)}_insert_lines(e,t){if(t.length>0){for(let t=0;t<3;t++)e.push("");for(let n of t)e.push(n);for(let t=0;t<3;t++)e.push("")}}get_custom_materials(){return Object(s.a)(this,void 0,void 0,(function*(){return new Map}))}}},369:function(e,t,n){var a=n(86),s=n(60);e.exports=function(e,t,n){(void 0===n||s(e[t],n))&&(void 0!==n||t in e)||a(e,t,n)}},370:function(e,t){e.exports=function(e,t){if(("constructor"!==t||"function"!=typeof e[t])&&"__proto__"!=t)return e[t]}},372:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var a=n(349),s=n(335);function i(e){s.a.call(this,e)}i.prototype=Object.assign(Object.create(s.a.prototype),{constructor:i,load:function(e,t,n,s){void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);var i=this,r=a.a.get(e);if(void 0!==r)return i.manager.itemStart(e),setTimeout((function(){t&&t(r),i.manager.itemEnd(e)}),0),r;var o=document.createElementNS("http://www.w3.org/1999/xhtml","img");function _(){o.removeEventListener("load",_,!1),o.removeEventListener("error",d,!1),a.a.add(e,this),t&&t(this),i.manager.itemEnd(e)}function d(t){o.removeEventListener("load",_,!1),o.removeEventListener("error",d,!1),s&&s(t),i.manager.itemError(e),i.manager.itemEnd(e)}return o.addEventListener("load",_,!1),o.addEventListener("error",d,!1),"data:"!==e.substr(0,5)&&void 0!==this.crossOrigin&&(o.crossOrigin=this.crossOrigin),i.manager.itemStart(e),o.src=e,o}})},373:function(e,t,n){"use strict";function a(e,t,n){var a=this,s=!1,i=0,r=0,o=void 0,_=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=n,this.itemStart=function(e){r++,!1===s&&void 0!==a.onStart&&a.onStart(e,i,r),s=!0},this.itemEnd=function(e){i++,void 0!==a.onProgress&&a.onProgress(e,i,r),i===r&&(s=!1,void 0!==a.onLoad&&a.onLoad())},this.itemError=function(e){void 0!==a.onError&&a.onError(e)},this.resolveURL=function(e){return o?o(e):e},this.setURLModifier=function(e){return o=e,this},this.addHandler=function(e,t){return _.push(e,t),this},this.removeHandler=function(e){var t=_.indexOf(e);return-1!==t&&_.splice(t,2),this},this.getHandler=function(e){for(var t=0,n=_.length;t<n;t+=2){var a=_[t],s=_[t+1];if(a.global&&(a.lastIndex=0),a.test(e))return s}return null}}n.d(t,"a",(function(){return s})),n.d(t,"b",(function(){return a}));var s=new a},374:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var a=n(330),s=n(24);function i(e){a.a.call(this),this.type="PointsMaterial",this.color=new s.a(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.morphTargets=!1,this.setValues(e)}i.prototype=Object.create(a.a.prototype),i.prototype.constructor=i,i.prototype.isPointsMaterial=!0,i.prototype.copy=function(e){return a.a.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.morphTargets=e.morphTargets,this}},379:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var a=n(4),s=n(372),i=n(83),r=n(335);function o(e){r.a.call(this,e)}o.prototype=Object.assign(Object.create(r.a.prototype),{constructor:o,load:function(e,t,n,r){var o=new i.a,_=new s.a(this.manager);return _.setCrossOrigin(this.crossOrigin),_.setPath(this.path),_.load(e,(function(n){o.image=n;var s=e.search(/\.jpe?g($|\?)/i)>0||0===e.search(/^data\:image\/jpeg/);o.format=s?a.dc:a.Db,o.needsUpdate=!0,void 0!==t&&t(o)}),n,r),o}})},380:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var a=n(4),s=n(330),i=n(12),r=n(24);function o(e){s.a.call(this),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new r.a(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new r.a(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=a.Qc,this.normalScale=new i.a(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.vertexTangents=!1,this.setValues(e)}o.prototype=Object.create(s.a.prototype),o.prototype.constructor=o,o.prototype.isMeshStandardMaterial=!0,o.prototype.copy=function(e){return s.a.prototype.copy.call(this,e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.vertexTangents=e.vertexTangents,this}},384:function(e,t,n){var a=n(46),s=n(403),i=n(84),r=n(404),o=i((function(e){var t=a(e,r);return t.length&&t[0]===e[0]?s(t):[]}));e.exports=o},385:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));class a{constructor(){this._id=a.__next_id++}id(){return this._id}handle_globals_node(e,t,n){}}a.__next_id=0},386:function(e,t,n){"use strict";n.d(t,"a",(function(){return d}));var a=n(27),s=n.n(a),i=n(30),r=n.n(i),o=n(119),_=n(333);class d{constructor(e,t){this._assembler=e,this._gl_parent_node=t,this._leaves_graph_id=new Map,this._graph_ids_by_shader_name=new Map,this._outputs_by_graph_id=new Map,this._depth_by_graph_id=new Map,this._graph_id_by_depth=new Map,this._graph=this._gl_parent_node.scene.graph}reset(){this._leaves_graph_id.clear(),this._outputs_by_graph_id.clear(),this._depth_by_graph_id.clear(),this._graph_id_by_depth.clear(),this.shader_names().forEach(e=>{this._graph_ids_by_shader_name.set(e,new Map)})}shader_names(){return this._assembler.shader_names}input_names_for_shader_name(e,t){return this._assembler.input_names_for_shader_name(e,t)}traverse(e){this.reset();for(let e of this.shader_names())this._leaves_graph_id.set(e,new Map);for(let t of this.shader_names()){this._shader_name=t;for(let t of e)this.find_leaves_from_root_node(t),this.set_nodes_depth()}this._depth_by_graph_id.forEach((e,t)=>{null!=e&&o.a.push_on_array_at_entry(this._graph_id_by_depth,e,t)})}leaves_from_nodes(e){var t;this._shader_name=_.b.LEAVES_FROM_NODES_SHADER,this._graph_ids_by_shader_name.set(this._shader_name,new Map),this._leaves_graph_id.set(this._shader_name,new Map);for(let t of e)this.find_leaves(t);const n=[];return null===(t=this._leaves_graph_id.get(this._shader_name))||void 0===t||t.forEach((e,t)=>{n.push(t)}),this._graph.nodes_from_ids(n)}nodes_for_shader_name(e){const t=[];this._graph_id_by_depth.forEach((e,n)=>{t.push(n)}),t.sort((e,t)=>e-t);const n=[];return t.forEach(t=>{const a=this._graph_id_by_depth.get(t);a&&a.forEach(t=>{var a;if(null===(a=this._graph_ids_by_shader_name.get(e))||void 0===a?void 0:a.get(t)){const e=this._graph.node_from_id(t);n.push(e)}})}),n}sorted_nodes(){const e=[];this._graph_id_by_depth.forEach((t,n)=>{e.push(n)}),e.sort((e,t)=>e-t);const t=[];return e.forEach(e=>{const n=this._graph_id_by_depth.get(e);if(n)for(let e of n){const n=this._graph.node_from_id(e);n&&t.push(n)}}),t}find_leaves_from_root_node(e){var t;null===(t=this._graph_ids_by_shader_name.get(this._shader_name))||void 0===t||t.set(e.graph_node_id,!0);const n=this.input_names_for_shader_name(e,this._shader_name);if(n)for(let t of n){const n=e.io.inputs.named_input(t);n&&(o.a.push_on_array_at_entry(this._outputs_by_graph_id,n.graph_node_id,e.graph_node_id),this.find_leaves(n))}this._outputs_by_graph_id.forEach((e,t)=>{this._outputs_by_graph_id.set(t,r()(e))})}find_leaves(e){var t;null===(t=this._graph_ids_by_shader_name.get(this._shader_name))||void 0===t||t.set(e.graph_node_id,!0);const n=s()(e.io.inputs.inputs()),a=r()(n.map(e=>e.graph_node_id)).map(e=>this._graph.node_from_id(e));if(a.length>0)for(let t of a)o.a.push_on_array_at_entry(this._outputs_by_graph_id,t.graph_node_id,e.graph_node_id),this.find_leaves(t);else this._leaves_graph_id.get(this._shader_name).set(e.graph_node_id,!0)}set_nodes_depth(){this._leaves_graph_id.forEach((e,t)=>{e.forEach((e,t)=>{this.set_node_depth(t)})})}set_node_depth(e,t=0){const n=this._depth_by_graph_id.get(e);null!=n?this._depth_by_graph_id.set(e,Math.max(n,t)):this._depth_by_graph_id.set(e,t);const a=this._outputs_by_graph_id.get(e);a&&a.forEach(e=>{this.set_node_depth(e,t+1)})}}},388:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));class a{static find_output_nodes(e){return e.nodes_by_type("output")}static find_attribute_export_nodes(e){return e.nodes_by_type("attribute").filter(e=>e.is_exporting)}}},389:function(e,t,n){"use strict";n.d(t,"b",(function(){return r})),n.d(t,"c",(function(){return o})),n.d(t,"a",(function(){return _}));var a=n(1),s=n(354),i=(n(351),n(44),n(35));function r(e){return{cook:!1,callback:(t,n)=>{e.update(t)}}}function o(e,t){return{visible_if:{[t]:1},node_selection:{context:i.a.COP},cook:!1,callback:(t,n)=>{e.update(t)}}}class _ extends s.a{constructor(e,t){super(e),this.node=e,this._update_options=t,null==this._update_options.define&&(this._update_options.define=!0)}add_hooks(e,t){e.add_post_dirty_hook("TextureController",()=>{this.update()}),t.add_post_dirty_hook("TextureController",()=>{this.update()})}static update(e){}_update(e,t,n,s){return Object(a.a)(this,void 0,void 0,(function*(){if(this._update_options.uniforms){const a=e,i=t;yield this._update_texture_on_uniforms(a,i,n,s)}if(this._update_options.direct_params){const a=e,i=t;yield this._update_texture_on_material(a,i,n,s)}}))}_update_texture_on_uniforms(e,t,n,s){return Object(a.a)(this,void 0,void 0,(function*(){this._update_required_attribute(e,e.uniforms,t,n,s,this._apply_texture_on_uniforms.bind(this),this._remove_texture_from_uniforms.bind(this))}))}_apply_texture_on_uniforms(e,t,n,a){const s=null!=t[n]&&null!=t[n].value;let i=!1;if(s){t[n].value.uuid!=a.uuid&&(i=!0)}if(!s||i){if(t[n].value=a,this._do_update_define()){const t=this._define_name(`${n}`);e.defines[t]=1}e.defines.USE_UV=1,e.needsUpdate=!0}}_remove_texture_from_uniforms(e,t,n){if(t[n].value){if(t[n].value=null,this._do_update_define()){const t=this._define_name(`${n}`);delete e.defines[t]}e.needsUpdate=!0}}_define_name(e){return"USE_"+e.replace("_","").toUpperCase()}_update_texture_on_material(e,t,n,s){return Object(a.a)(this,void 0,void 0,(function*(){this._update_required_attribute(e,e,t,n,s,this._apply_texture_on_material.bind(this),this._remove_texture_from_material.bind(this))}))}_apply_texture_on_material(e,t,n,a){const s=null!=t[n];let i=!1;if(s){t[n].uuid!=a.uuid&&(i=!0)}s&&!i||(t[n]=a,e.needsUpdate=!0)}_remove_texture_from_material(e,t,n){t[n]&&(t[n]=null,e.needsUpdate=!0)}_update_required_attribute(e,t,n,s,r,o,_){return Object(a.a)(this,void 0,void 0,(function*(){if(s.is_dirty&&(yield s.compute()),s.value){r.is_dirty&&(yield r.compute());const a=r.found_node();if(a)if(a.node_context()==i.a.COP){const s=a,i=(yield s.request_container()).texture();if(i)return void o(e,t,n,i);this.node.states.error.set("found node has no texture")}else this.node.states.error.set("found map node is not a COP node");else this.node.states.error.set(`could not find map node ${r.name} with path ${r.value}`)}_(e,t,n)}))}_do_update_define(){return null==this._update_options.define||this._update_options.define}}},390:function(e,t,n){"use strict";n.d(t,"a",(function(){return o})),n.d(t,"b",(function(){return _}));var a=n(354),s=n(339),i=n(330),r=n(44);function o(e){return class extends e{constructor(){super(...arguments),this.transparent=r.b.BOOLEAN(0),this.opacity=r.b.FLOAT(1),this.alpha_test=r.b.FLOAT(0),this.use_fog=r.b.BOOLEAN(0)}}}i.a;o(r.a);s.a;class _ extends a.a{static update(e){const t=e.material,n=e.pv;t.uniforms.opacity&&(t.uniforms.opacity.value=n.opacity),t.transparent=n.transparent||n.opacity<1,t.depthTest=!0,t.alphaTest=n.alpha_test,t.fog=n.use_fog}}},391:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var a=n(1),s=n(339),i=n(35);class r extends s.a{constructor(){super(...arguments),this._children_controller_context=i.a.GL}initialize_base_node(){var e;super.initialize_base_node(),this.lifecycle.add_on_create_hook(this.assembler_controller.on_create.bind(this.assembler_controller)),null===(e=this.children_controller)||void 0===e||e.init()}create_material(){return this.assembler_controller.assembler.create_material()}get assembler_controller(){return this._assembler_controller=this._assembler_controller||this._create_assembler_controller()}create_node(e){return super.create_node(e)}children(){return super.children()}nodes_by_type(e){return super.nodes_by_type(e)}compile_if_required(){return Object(a.a)(this,void 0,void 0,(function*(){this.assembler_controller.compile_required()&&this._compile()}))}_compile(){return Object(a.a)(this,void 0,void 0,(function*(){this.material&&(yield this.assembler_controller.assembler.compile_material(this.material),yield this.assembler_controller.post_compile())}))}}},392:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var a=n(330),s=n(4),i=n(24);function r(e){a.a.call(this),this.type="MeshLambertMaterial",this.color=new i.a(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new i.a(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=s.jb,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}r.prototype=Object.create(a.a.prototype),r.prototype.constructor=r,r.prototype.isMeshLambertMaterial=!0,r.prototype.copy=function(e){return a.a.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this}},397:function(e,t,n){var a=n(398),s=n(402)((function(e,t,n){a(e,t,n)}));e.exports=s},398:function(e,t,n){var a=n(85),s=n(369),i=n(187),r=n(399),o=n(17),_=n(123),d=n(370);e.exports=function e(t,n,l,h,c){t!==n&&i(n,(function(i,_){if(c||(c=new a),o(i))r(t,n,_,l,e,h,c);else{var u=h?h(d(t,_),i,_+"",t,n,c):void 0;void 0===u&&(u=i),s(t,_,u)}}),_)}},399:function(e,t,n){var a=n(369),s=n(184),i=n(185),r=n(131),o=n(186),_=n(63),d=n(3),l=n(124),h=n(48),c=n(61),u=n(17),p=n(400),m=n(64),f=n(370),b=n(401);e.exports=function(e,t,n,v,g,y,E){var x=f(e,n),w=f(t,n),O=E.get(w);if(O)a(e,n,O);else{var S=y?y(x,w,n+"",e,t,E):void 0,T=void 0===S;if(T){var M=d(w),A=!M&&h(w),N=!M&&!A&&m(w);S=w,M||A||N?d(x)?S=x:l(x)?S=r(x):A?(T=!1,S=s(w,!0)):N?(T=!1,S=i(w,!0)):S=[]:p(w)||_(w)?(S=x,_(x)?S=b(x):u(x)&&!c(x)||(S=o(w))):T=!1}T&&(E.set(w,S),g(S,w,v,y,E),E.delete(w)),a(e,n,S)}}},400:function(e,t,n){var a=n(26),s=n(87),i=n(18),r=Function.prototype,o=Object.prototype,_=r.toString,d=o.hasOwnProperty,l=_.call(Object);e.exports=function(e){if(!i(e)||"[object Object]"!=a(e))return!1;var t=s(e);if(null===t)return!0;var n=d.call(t,"constructor")&&t.constructor;return"function"==typeof n&&n instanceof n&&_.call(n)==l}},401:function(e,t,n){var a=n(62),s=n(123);e.exports=function(e){return a(e,s(e))}},402:function(e,t,n){var a=n(84),s=n(128);e.exports=function(e){return a((function(t,n){var a=-1,i=n.length,r=i>1?n[i-1]:void 0,o=i>2?n[2]:void 0;for(r=e.length>3&&"function"==typeof r?(i--,r):void 0,o&&s(n[0],n[1],o)&&(r=i<3?void 0:r,i=1),t=Object(t);++a<i;){var _=n[a];_&&e(t,_,a,r)}return t}))}},403:function(e,t,n){var a=n(88),s=n(132),i=n(133),r=n(46),o=n(49),_=n(89),d=Math.min;e.exports=function(e,t,n){for(var l=n?i:s,h=e[0].length,c=e.length,u=c,p=Array(c),m=1/0,f=[];u--;){var b=e[u];u&&t&&(b=r(b,o(t))),m=d(b.length,m),p[u]=!n&&(t||h>=120&&b.length>=120)?new a(u&&b):void 0}b=e[0];var v=-1,g=p[0];e:for(;++v<h&&f.length<m;){var y=b[v],E=t?t(y):y;if(y=n||0!==y?y:0,!(g?_(g,E):l(f,E,n))){for(u=c;--u;){var x=p[u];if(!(x?_(x,E):l(e[u],E,n)))continue e}g&&g.push(E),f.push(y)}}return f}},404:function(e,t,n){var a=n(124);e.exports=function(e){return a(e)?e:[]}},414:function(e,t,n){"use strict";t.a="uniform float mNear;\nuniform float mFar;\n\nvarying float vViewZDepth;\n\nvoid main() {\n\n\tfloat color = 1.0 - smoothstep( mNear, mFar, vViewZDepth );\n\tgl_FragColor = vec4( vec3( color ), 1.0 );\n\n}\n"},452:function(e,t,n){"use strict";n.d(t,"a",(function(){return k}));var a=n(1),s=n(44),i=n(390),r=n(355),o=n(362),_=n(363),d=n(364),l=n(338),h=n(336),c=n(342),u=n(344),p=n(360),m=n(361),f=n(366),b=n(4),v=n(333);const g=new Map([[v.b.VERTEX,"// INSERT DEFINES"]]),y=new Map([[v.b.VERTEX,"// INSERT BODY"]]);class E extends u.b{get _template_shader(){const e=c.a.depth,t=l.a.clone(e.uniforms);return t.size={value:1},t.scale={value:1},{vertexShader:"uniform float size;\nuniform float scale;\n#include <common>\n#include <clipping_planes_pars_vertex>\nvarying float vViewZDepth;\n\n// INSERT DEFINES\n\n\n\nvoid main() {\n\n\t// INSERT BODY\n\n\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\n\tvViewZDepth = - mvPosition.z;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\n}\n\n\n",fragmentShader:e.fragmentShader,uniforms:t}}insert_define_after(e){return g.get(e)}insert_body_after(e){return y.get(e)}create_material(){const e=this._template_shader;return new h.a({defines:{USE_SIZEATTENUATION:1,DEPTH_PACKING:[b.Cb,b.i][0]},uniforms:l.a.clone(e.uniforms),vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})}}const x=new Map([[v.b.VERTEX,"// INSERT DEFINES"]]),w=new Map([[v.b.VERTEX,"// INSERT BODY"]]);class O extends u.b{get _template_shader(){const e=c.a.distanceRGBA,t=l.a.clone(e.uniforms);return t.size={value:1},t.scale={value:1},{vertexShader:"uniform float size;\nuniform float scale;\n#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <clipping_planes_pars_vertex>\nvarying float vViewZDepth;\n\n// INSERT DEFINES\n\n\n\nvoid main() {\n\n\t// INSERT BODY\n\n\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\tvWorldPosition = worldPosition.xyz;\n}\n\n// #define DISTANCE\n// varying vec3 vWorldPosition;\n// #include <common>\n// #include <uv_pars_vertex>\n// #include <displacementmap_pars_vertex>\n// #include <morphtarget_pars_vertex>\n// #include <skinning_pars_vertex>\n// #include <clipping_planes_pars_vertex>\n// void main() {\n// \t#include <uv_vertex>\n// \t#include <skinbase_vertex>\n// \t#ifdef USE_DISPLACEMENTMAP\n// \t\t#include <beginnormal_vertex>\n// \t\t#include <morphnormal_vertex>\n// \t\t#include <skinnormal_vertex>\n// \t#endif\n// \t#include <begin_vertex>\n// \t#include <morphtarget_vertex>\n// \t#include <skinning_vertex>\n// \t#include <displacementmap_vertex>\n// \t#include <project_vertex>\n// \t#include <worldpos_vertex>\n// \t#include <clipping_planes_vertex>\n// \tvWorldPosition = worldPosition.xyz;\n// }\n\n\n",fragmentShader:e.fragmentShader,uniforms:t}}insert_define_after(e){return x.get(e)}insert_body_after(e){return w.get(e)}create_material(){const e=this._template_shader;return new h.a({defines:{USE_SIZEATTENUATION:1,DEPTH_PACKING:[b.Cb,b.i][0]},uniforms:l.a.clone(e.uniforms),vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})}}var S=n(414);const T=new Map([[v.b.VERTEX,"// INSERT DEFINES"]]),M=new Map([[v.b.VERTEX,"// INSERT BODY"]]);class A extends u.b{get _template_shader(){return{vertexShader:"uniform float size;\nuniform float scale;\n#include <common>\n\nvarying float vViewZDepth;\n\n// INSERT DEFINES\n\n\n\nvoid main() {\n\n\t// INSERT BODY\n\n\n\t#include <project_vertex>\n\n\tvViewZDepth = - mvPosition.z;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\n}\n\n",fragmentShader:S.a,uniforms:{size:{value:1},scale:{value:1},mNear:{value:0},mFar:{value:10}}}}insert_define_after(e){return T.get(e)}insert_body_after(e){return M.get(e)}create_material(){const e=this._template_shader;return new h.a({depthTest:!0,defines:{USE_SIZEATTENUATION:1},uniforms:l.a.clone(e.uniforms),vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})}}var N=n(0),R=n(118),I=n(45);const P=new Map([[v.b.VERTEX,["#include <begin_vertex>","gl_PointSize = size;"]],[v.b.FRAGMENT,[]]]),j=new Map;j.set(u.a.DISTANCE,O),j.set(u.a.DEPTH,E),j.set(u.a.DEPTH_DOF,A);class L extends u.b{custom_assembler_class_by_custom_name(){return j}get _template_shader(){const e=c.a.points;return{vertexShader:e.vertexShader,fragmentShader:e.fragmentShader,uniforms:e.uniforms}}create_material(){const e=this._template_shader,t=new h.a({transparent:!0,fog:!0,defines:{USE_SIZEATTENUATION:1},uniforms:l.a.clone(e.uniforms),vertexShader:e.vertexShader,fragmentShader:e.fragmentShader});return this._add_custom_materials(t),t}add_output_params(e){f.a.add_output_params(e),e.add_param(N.a.FLOAT,"gl_PointSize",1)}create_globals_node_output_connections(){return f.a.create_globals_node_output_connections().concat([new R.a("gl_PointCoord",I.c.VEC2)])}create_shader_configs(){return[new p.a(v.b.VERTEX,["position","normal","uv","gl_PointSize"],[]),new p.a(v.b.FRAGMENT,["color","alpha"],[v.b.VERTEX])]}create_variable_configs(){return f.a.create_variable_configs().concat([new m.a("gl_PointSize",{default:"1.0",prefix:"gl_PointSize = ",suffix:" * size * 10.0"})])}lines_to_remove(e){return P.get(e)}}var D=n(391),C=n(365);class F extends(Object(d.b)(Object(_.b)(Object(o.b)(Object(r.b)(Object(i.a)(s.a)))))){}const z=new F;class k extends D.a{constructor(){super(...arguments),this.params_config=z}static type(){return"points_builder"}initialize_node(){}_create_assembler_controller(){return new C.a(this,L)}cook(){return Object(a.a)(this,void 0,void 0,(function*(){yield this.compile_if_required(),i.b.update(this),r.a.update(this),o.a.update(this),this.set_material(this.material)}))}}},618:function(e,t,n){"use strict";n.r(t),n.d(t,"MatRegister",(function(){return ge}));var a=n(352),s=n(1),i=n(367),r=n(4),o=n(339),_=n(44),d=n(354),l=n(330);function h(e){return class extends e{constructor(){super(...arguments),this.color=_.b.COLOR([1,1,1]),this.use_vertex_colors=_.b.BOOLEAN(0),this.transparent=_.b.BOOLEAN(0),this.opacity=_.b.FLOAT(1),this.alpha_test=_.b.FLOAT(0),this.use_fog=_.b.BOOLEAN(0)}}}l.a;h(_.a);o.a;class c extends d.a{static update(e){const t=e.material,n=e.pv;t.color.copy(n.color);const a=n.use_vertex_colors;a!=t.vertexColors&&(t.vertexColors=a,t.needsUpdate=!0),t.opacity=n.opacity,t.transparent=n.transparent||n.opacity<1,t.depthTest=!0,t.alphaTest=n.alpha_test,t.fog=n.use_fog}}var u=n(355),p=n(362),m=n(363),f=n(364);class b extends(Object(f.b)(Object(m.b)(Object(p.b)(Object(u.b)(h(_.a)))))){}const v=new b;class g extends o.a{constructor(){super(...arguments),this.params_config=v,this.texture_map_controller=new m.a(this,{direct_params:!0}),this.texture_alpha_map_controller=new f.a(this,{direct_params:!0})}static type(){return"mesh_basic"}create_material(){return new i.a({vertexColors:!1,side:r.E,color:16777215,opacity:1})}initialize_node(){this.params.set_post_create_params_hook(()=>{this.texture_map_controller.initialize_node(),this.texture_alpha_map_controller.initialize_node()})}cook(){return Object(s.a)(this,void 0,void 0,(function*(){c.update(this),u.a.update(this),p.a.update(this),this.texture_map_controller.update(),this.texture_alpha_map_controller.update(),this.set_material(this.material)}))}}var y=n(390),E=n(338),x=n(336),w=n(342),O=n(344),S=n(333);const T=new Map([[S.b.VERTEX,"#include <begin_vertex>"],[S.b.FRAGMENT,"vec4 diffuseColor = vec4( 1.0 );"]]);class M extends O.b{get _template_shader(){const e=w.a.distanceRGBA;return{vertexShader:e.vertexShader,fragmentShader:e.fragmentShader,uniforms:e.uniforms}}insert_body_after(e){return T.get(e)}create_material(){const e=this._template_shader;return new x.a({defines:{DEPTH_PACKING:[r.Cb,r.i][0]},uniforms:E.a.clone(e.uniforms),vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})}}const A=new Map([[S.b.VERTEX,"#include <begin_vertex>"],[S.b.FRAGMENT,"vec4 diffuseColor = vec4( 1.0 );"]]);class N extends O.b{get _template_shader(){const e=w.a.depth;return{vertexShader:e.vertexShader,fragmentShader:e.fragmentShader,uniforms:e.uniforms}}insert_body_after(e){return A.get(e)}create_material(){const e=this._template_shader;return new x.a({defines:{DEPTH_PACKING:[r.Cb,r.i][0]},uniforms:E.a.clone(e.uniforms),vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})}}var R=n(414);const I=new Map([[S.b.VERTEX,"// INSERT DEFINES"]]),P=new Map([[S.b.VERTEX,"// INSERT BODY"]]);class j extends O.b{get _template_shader(){return{vertexShader:"#include <common>\n\nvarying float vViewZDepth;\n\n// INSERT DEFINES\n\n\n\nvoid main() {\n\n\t// INSERT BODY\n\n\n\t#include <project_vertex>\n\n\tvViewZDepth = - mvPosition.z;\n}",fragmentShader:R.a,uniforms:{mNear:{value:0},mFar:{value:10}}}}insert_define_after(e){return I.get(e)}insert_body_after(e){return P.get(e)}create_material(){const e=this._template_shader;return new x.a({uniforms:E.a.clone(e.uniforms),vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})}}const L=new Map([]);L.set(O.a.DISTANCE,M),L.set(O.a.DEPTH,N),L.set(O.a.DEPTH_DOF,j);class D extends O.b{custom_assembler_class_by_custom_name(){return L}}class C extends D{get _template_shader(){const e=w.a.basic;return{vertexShader:e.vertexShader,fragmentShader:e.fragmentShader,uniforms:e.uniforms}}create_material(){const e=this._template_shader,t=new x.a({lights:!1,uniforms:E.a.clone(e.uniforms),vertexShader:e.vertexShader,fragmentShader:e.fragmentShader});return this._add_custom_materials(t),t}}var F=n(391),z=n(365);class k extends(Object(f.b)(Object(m.b)(Object(p.b)(Object(u.b)(Object(y.a)(_.a)))))){}const U=new k;class V extends F.a{constructor(){super(...arguments),this.params_config=U,this.texture_map_controller=new m.a(this,{uniforms:!0}),this.texture_alpha_map_controller=new f.a(this,{uniforms:!0})}static type(){return"mesh_basic_builder"}initialize_node(){this.params.set_post_create_params_hook(()=>{this.texture_map_controller.initialize_node(),this.texture_alpha_map_controller.initialize_node()})}_create_assembler_controller(){return new z.a(this,C)}cook(){return Object(s.a)(this,void 0,void 0,(function*(){yield this.compile_if_required(),y.b.update(this),u.a.update(this),p.a.update(this),yield m.a.update(this),yield f.a.update(this),this.set_material(this.material)}))}}var B=n(392);class $ extends(Object(f.b)(Object(m.b)(Object(p.b)(Object(u.b)(h(_.a)))))){}const G=new $;class q extends o.a{constructor(){super(...arguments),this.params_config=G,this.texture_map_controller=new m.a(this,{direct_params:!0}),this.texture_alpha_map_controller=new f.a(this,{direct_params:!0})}static type(){return"mesh_lambert"}create_material(){return new B.a({vertexColors:!1,side:r.E,color:16777215,opacity:1})}initialize_node(){this.params.set_post_create_params_hook(()=>{this.texture_map_controller.initialize_node(),this.texture_alpha_map_controller.initialize_node()})}cook(){return Object(s.a)(this,void 0,void 0,(function*(){c.update(this),u.a.update(this),p.a.update(this),this.texture_map_controller.update(),this.texture_alpha_map_controller.update(),this.set_material(this.material)}))}}class H extends D{get _template_shader(){const e=w.a.lambert;return{vertexShader:e.vertexShader,fragmentShader:e.fragmentShader,uniforms:e.uniforms}}create_material(){const e=this._template_shader,t=new x.a({lights:!0,uniforms:E.a.clone(e.uniforms),vertexShader:e.vertexShader,fragmentShader:e.fragmentShader});return this._add_custom_materials(t),t}}class X extends(Object(f.b)(Object(m.b)(Object(p.b)(Object(u.b)(Object(y.a)(_.a)))))){}const Y=new X;class Z extends F.a{constructor(){super(...arguments),this.params_config=Y,this.texture_map_controller=new m.a(this,{uniforms:!0}),this.texture_alpha_map_controller=new f.a(this,{uniforms:!0})}static type(){return"mesh_lambert_builder"}initialize_node(){this.params.set_post_create_params_hook(()=>{this.texture_map_controller.initialize_node(),this.texture_alpha_map_controller.initialize_node()})}_create_assembler_controller(){return new z.a(this,H)}cook(){return Object(s.a)(this,void 0,void 0,(function*(){yield this.compile_if_required(),y.b.update(this),u.a.update(this),p.a.update(this),yield m.a.update(this),yield f.a.update(this),this.set_material(this.material)}))}}var W=n(380),K=n(351),J=n(389);function Q(e){return class extends e{constructor(){super(...arguments),this.use_env_map=_.b.BOOLEAN(0,Object(J.b)(ee)),this.env_map=_.b.OPERATOR_PATH(K.a.DEFAULT_NODE_PATH.ENV_MAP,Object(J.c)(ee,"use_env_map")),this.env_map_intensity=_.b.FLOAT(1,{visible_if:{use_env_map:1}})}}}l.a;Q(_.a);o.a;class ee extends J.a{constructor(e,t){super(e,t)}initialize_node(){this.add_hooks(this.node.p.use_env_map,this.node.p.env_map)}update(){return Object(s.a)(this,void 0,void 0,(function*(){this._update(this.node.material,"envMap",this.node.p.use_env_map,this.node.p.env_map)}))}static update(e){return Object(s.a)(this,void 0,void 0,(function*(){e.texture_env_map_controller.update()}))}}const te=1,ne=.5;class ae extends(Q(Object(f.b)(Object(m.b)(Object(p.b)(Object(u.b)(h(_.a))))))){constructor(){super(...arguments),this.metalness=_.b.FLOAT(te),this.roughness=_.b.FLOAT(ne)}}const se=new ae;class ie extends o.a{constructor(){super(...arguments),this.params_config=se,this.texture_map_controller=new m.a(this,{direct_params:!0}),this.texture_alpha_map_controller=new f.a(this,{direct_params:!0}),this.texture_env_map_controller=new ee(this,{direct_params:!0})}static type(){return"mesh_standard"}create_material(){return new W.a({vertexColors:!1,side:r.E,color:16777215,opacity:1,metalness:1,roughness:0})}initialize_node(){this.params.set_post_create_params_hook(()=>{this.texture_map_controller.initialize_node(),this.texture_alpha_map_controller.initialize_node(),this.texture_env_map_controller.initialize_node()})}cook(){return Object(s.a)(this,void 0,void 0,(function*(){c.update(this),u.a.update(this),p.a.update(this),this.texture_map_controller.update(),this.texture_alpha_map_controller.update(),this.texture_env_map_controller.update(),this._material&&(this._material.envMapIntensity=this.pv.env_map_intensity,this._material.roughness=this.pv.roughness,this._material.metalness=this.pv.metalness),this.set_material(this.material)}))}}var re=n(366),oe=n(360),_e=n(361),de=n(0);class le extends D{is_physical(){return!1}get _template_shader(){const e=this.is_physical()?w.a.physical:w.a.standard;return{vertexShader:e.vertexShader,fragmentShader:e.fragmentShader,uniforms:e.uniforms}}create_material(){const e=this._template_shader,t={lights:!0,extensions:{derivatives:!0},uniforms:E.a.clone(e.uniforms),vertexShader:e.vertexShader,fragmentShader:e.fragmentShader},n=new x.a(t);return n.onBeforeCompile=function(e){e.fragmentShader=e.fragmentShader.replace("#include <metalnessmap_fragment>","float metalnessFactor = metalness * POLY_metalness;\n\n#ifdef USE_METALNESSMAP\n\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\n\t// reads channel B, compatible with a combined OcclusionRoughnessMetallic (RGB) texture\n\tmetalnessFactor *= texelMetalness.b;\n\n#endif\n"),e.fragmentShader=e.fragmentShader.replace("#include <roughnessmap_fragment>","float roughnessFactor = roughness * POLY_roughness;\n\n#ifdef USE_ROUGHNESSMAP\n\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\n\t// reads channel G, compatible with a combined OcclusionRoughnessMetallic (RGB) texture\n\troughnessFactor *= texelRoughness.g;\n\n#endif\n")},this._add_custom_materials(n),n}add_output_params(e){re.a.add_output_params(e),e.add_param(de.a.FLOAT,"metalness",1),e.add_param(de.a.FLOAT,"roughness",1)}create_shader_configs(){return[new oe.a(S.b.VERTEX,["position","normal","uv"],[]),new oe.a(S.b.FRAGMENT,["color","alpha","metalness","roughness"],[S.b.VERTEX])]}create_variable_configs(){return re.a.create_variable_configs().concat([new _e.a("metalness",{default:"1.0",prefix:"float POLY_metalness = "}),new _e.a("roughness",{default:"1.0",prefix:"float POLY_roughness = "})])}}class he extends(Q(Object(f.b)(Object(m.b)(Object(p.b)(Object(u.b)(Object(y.a)(_.a))))))){constructor(){super(...arguments),this.metalness=_.b.FLOAT(te,{cook:!1,callback:(e,t)=>ue._update_metalness(e)}),this.roughness=_.b.FLOAT(ne,{cook:!1,callback:(e,t)=>ue._update_roughness(e)})}}const ce=new he;class ue extends F.a{constructor(){super(...arguments),this.params_config=ce,this.texture_map_controller=new m.a(this,{uniforms:!0}),this.texture_alpha_map_controller=new f.a(this,{uniforms:!0}),this.texture_env_map_controller=new ee(this,{uniforms:!0,direct_params:!0,define:!1})}static type(){return"mesh_standard_builder"}initialize_node(){this.params.set_post_create_params_hook(()=>{this.texture_map_controller.initialize_node(),this.texture_alpha_map_controller.initialize_node(),this.texture_env_map_controller.initialize_node()})}_create_assembler_controller(){return new z.a(this,le)}cook(){return Object(s.a)(this,void 0,void 0,(function*(){yield this.compile_if_required(),y.b.update(this),u.a.update(this),p.a.update(this),yield m.a.update(this),yield f.a.update(this),yield ee.update(this),this._material&&(this._material.uniforms.envMapIntensity.value=this.pv.env_map_intensity,ue._update_metalness(this),ue._update_roughness(this)),this.set_material(this.material)}))}static _update_metalness(e){e.material.uniforms.metalness.value=e.pv.metalness}static _update_roughness(e){e.material.uniforms.roughness.value=e.pv.roughness}}var pe=n(374);class me extends(Object(u.b)(h(function(e){return class extends e{constructor(){super(...arguments),this.size=_.b.FLOAT(1),this.size_attenuation=_.b.BOOLEAN(1)}}}(_.a)))){}const fe=new me;class be extends o.a{constructor(){super(...arguments),this.params_config=fe}static type(){return"points"}create_material(){return new pe.a({vertexColors:!1,side:r.E,color:16777215,opacity:1})}cook(){return Object(s.a)(this,void 0,void 0,(function*(){c.update(this),u.a.update(this),this.material.size=this.pv.size,this.material.sizeAttenuation=this.pv.size_attenuation,this.set_material(this.material)}))}}var ve=n(452);class ge{static run(e){e.register_node(g,a.d.MESH),e.register_node(V,a.d.ADVANCED),e.register_node(q,a.d.MESH),e.register_node(Z,a.d.ADVANCED),e.register_node(ie,a.d.MESH),e.register_node(ue,a.d.ADVANCED),e.register_node(be,a.d.POINTS),e.register_node(ve.a,a.d.ADVANCED)}}}}]);
//# sourceMappingURL=Mat.bundle.js.map