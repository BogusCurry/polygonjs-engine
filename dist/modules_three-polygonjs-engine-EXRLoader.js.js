(window.webpackJsonp=window.webpackJsonp||[]).push([[1],{667:function(e,r,n){"use strict";n.r(r),n.d(r,"EXRLoader",(function(){return o}));var a=n(108),t=n(0),i=n(289),o=function(e){a.a.call(this,e),this.type=t.FloatType};o.prototype=Object.assign(Object.create(a.a.prototype),{constructor:o,parse:function(e){const r={l:0,c:0,lc:0};function n(e,n,a,t,i){for(;a<e;)n=n<<8|R(t,i),a+=8;a-=e,r.l=n>>a&(1<<e)-1,r.c=n,r.lc=a}const a=new Array(59);function o(e,t,i,o,l,f,u){for(var c=i,v=0,s=0;l<=f;l++){if(c.value-i.value>o)return!1;n(6,v,s,e,c);var h=r.l;if(v=r.c,s=r.lc,u[l]=h,63==h){if(c.value-i.value>o)throw"Something wrong with hufUnpackEncTable";n(8,v,s,e,c);var p=r.l+6;if(v=r.c,s=r.lc,l+p>f+1)throw"Something wrong with hufUnpackEncTable";for(;p--;)u[l++]=0;l--}else if(h>=59){if(l+(p=h-59+2)>f+1)throw"Something wrong with hufUnpackEncTable";for(;p--;)u[l++]=0;l--}}!function(e){for(var r=0;r<=58;++r)a[r]=0;for(r=0;r<65537;++r)a[e[r]]+=1;var n=0;for(r=58;r>0;--r){var t=n+a[r]>>1;a[r]=n,n=t}for(r=0;r<65537;++r){var i=e[r];i>0&&(e[r]=i|a[i]++<<6)}}(u)}function l(e){return 63&e}function f(e){return e>>6}const u={c:0,lc:0};function c(e,r,n,a){e=e<<8|R(n,a),r+=8,u.c=e,u.lc=r}const v={c:0,lc:0};function s(e,r,n,a,t,i,o,l,f,s){if(e==r){a<8&&(c(n,a,t,o),n=u.c,a=u.lc);var h=n>>(a-=8);h=new Uint8Array([h])[0];if(f.value+h>s)return!1;for(var p=l[f.value-1];h-- >0;)l[f.value++]=p}else{if(!(f.value<s))return!1;l[f.value++]=e}v.c=n,v.lc=a}function h(e){var r=function(e){return 65535&e}(e);return r>32767?r-65536:r}const p={a:0,b:0};function w(e,r){var n=h(e),a=h(r),t=n+(1&a)+(a>>1),i=t,o=t-a;p.a=i,p.b=o}function y(e,r,n,a,t,i){for(var o,l=n>t?t:n,f=1;f<=l;)f<<=1;for(o=f>>=1,f>>=1;f>=1;){for(var u,c,v,s,h=0,y=h+i*(t-o),d=i*f,S=i*o,g=a*f,O=a*o;h<=y;h+=S){for(var b=h,E=h+a*(n-o);b<=E;b+=O){var I=b+g,R=(M=b+d)+g;w(r[b+e],r[M+e]),u=p.a,v=p.b,w(r[I+e],r[R+e]),c=p.a,s=p.b,w(u,c),r[b+e]=p.a,r[I+e]=p.b,w(v,s),r[M+e]=p.a,r[R+e]=p.b}if(n&f){var M=b+d;w(r[b+e],r[M+e]),u=p.a,r[M+e]=p.b,r[b+e]=u}}if(t&f)for(b=h,E=h+a*(n-o);b<=E;b+=O){I=b+g;w(r[b+e],r[I+e]),u=p.a,r[I+e]=p.b,r[b+e]=u}o=f,f>>=1}return h}function d(e,r,n,a,t,i,h){var p=n.value,w=I(r,n),y=I(r,n);n.value+=4;var d=I(r,n);if(n.value+=4,w<0||w>=65537||y<0||y>=65537)throw"Something wrong with HUF_ENCSIZE";var S=new Array(65537),g=new Array(16384);if(function(e){for(var r=0;r<16384;r++)e[r]={},e[r].len=0,e[r].lit=0,e[r].p=null}(g),o(e,0,n,a-(n.value-p),w,y,S),d>8*(a-(n.value-p)))throw"Something wrong with hufUncompress";!function(e,r,n,a){for(;r<=n;r++){var t=f(e[r]),i=l(e[r]);if(t>>i)throw"Invalid table entry";if(i>14){if((v=a[t>>i-14]).len)throw"Invalid table entry";if(v.lit++,v.p){var o=v.p;v.p=new Array(v.lit);for(var u=0;u<v.lit-1;++u)v.p[u]=o[u]}else v.p=new Array(1);v.p[v.lit-1]=r}else if(i){var c=0;for(u=1<<14-i;u>0;u--){var v;if((v=a[(t<<14-i)+c]).len||v.p)throw"Invalid table entry";v.len=i,v.lit=r,c++}}}}(S,w,y,g),function(e,r,n,a,t,i,o,h,p,w){for(var y=0,d=0,S=h,g=Math.trunc(t.value+(i+7)/8);t.value<g;)for(c(y,d,n,t),y=u.c,d=u.lc;d>=14;){if((I=r[y>>d-14&16383]).len)d-=I.len,s(I.lit,o,y,d,n,0,t,p,w,S),y=v.c,d=v.lc;else{if(!I.p)throw"hufDecode issues";var O;for(O=0;O<I.lit;O++){for(var b=l(e[I.p[O]]);d<b&&t.value<g;)c(y,d,n,t),y=u.c,d=u.lc;if(d>=b&&f(e[I.p[O]])==(y>>d-b&(1<<b)-1)){d-=b,s(I.p[O],o,y,d,n,0,t,p,w,S),y=v.c,d=v.lc;break}}if(O==I.lit)throw"hufDecode issues"}}var E=8-i&7;for(y>>=E,d-=E;d>0;){var I;if(!(I=r[y<<14-d&16383]).len)throw"hufDecode issues";d-=I.len,s(I.lit,o,y,d,n,0,t,p,w,S),y=v.c,d=v.lc}}(S,g,e,0,n,d,y,h,t,i)}function S(e){for(var r=1;r<e.length;r++){var n=e[r-1]+e[r]-128;e[r]=n}}function g(e,r){for(var n=0,a=Math.floor((e.length+1)/2),t=0,i=e.length-1;!(t>i||(r[t++]=e[n++],t>i));)r[t++]=e[a++]}function O(e){var r=e.array.slice(e.offset.value,e.offset.value+e.size);void 0===i.a&&console.error("THREE.EXRLoader: External library Inflate.min.js required, obtain or import from https://github.com/imaya/zlib.js");var n=new i.a.Inflate(r,{resize:!0,verify:!0}),a=new Uint8Array(n.decompress().buffer),t=new Uint8Array(a.length);return S(a),g(a,t),new DataView(t.buffer)}function b(e,r){for(var n=new Uint8Array(e),a=0;0!=n[r.value+a];)a+=1;var t=(new TextDecoder).decode(n.slice(r.value,r.value+a));return r.value=r.value+a+1,t}function E(e,r){var n=e.getUint32(0,!0);return r.value=r.value+8,n}function I(e,r){var n=e.getUint32(r.value,!0);return r.value=r.value+4,n}function R(e,r){var n=e[r.value];return r.value=r.value+1,n}function M(e,r){var n=e.getUint8(r.value);return r.value=r.value+1,n}function P(e,r){var n=e.getFloat32(r.value,!0);return r.value+=4,n}function m(e,r){var n=e.getUint16(r.value,!0);return r.value+=2,n}function A(e,r,n,a,t){if("string"===a||"stringvector"===a||"iccProfile"===a)return function(e,r,n){var a=(new TextDecoder).decode(new Uint8Array(e).slice(r.value,r.value+n));return r.value=r.value+n,a}(r,n,t);if("chlist"===a)return function(e,r,n,a){for(var t=n.value,i=[];n.value<t+a-1;){var o=b(r,n),l=I(e,n),f=M(e,n);n.value+=3;var u=I(e,n),c=I(e,n);i.push({name:o,pixelType:l,pLinear:f,xSampling:u,ySampling:c})}return n.value+=1,i}(e,r,n,t);if("chromaticities"===a)return function(e,r){return{redX:P(e,r),redY:P(e,r),greenX:P(e,r),greenY:P(e,r),blueX:P(e,r),blueY:P(e,r),whiteX:P(e,r),whiteY:P(e,r)}}(e,n);if("compression"===a)return function(e,r){return["NO_COMPRESSION","RLE_COMPRESSION","ZIPS_COMPRESSION","ZIP_COMPRESSION","PIZ_COMPRESSION","PXR24_COMPRESSION","B44_COMPRESSION","B44A_COMPRESSION","DWAA_COMPRESSION","DWAB_COMPRESSION"][M(e,r)]}(e,n);if("box2i"===a)return function(e,r){return{xMin:I(e,r),yMin:I(e,r),xMax:I(e,r),yMax:I(e,r)}}(e,n);if("lineOrder"===a)return function(e,r){return["INCREASING_Y"][M(e,r)]}(e,n);if("float"===a)return P(e,n);if("v2f"===a)return function(e,r){return[P(e,r),P(e,r)]}(e,n);if("int"===a)return I(e,n);throw"Cannot parse value for unsupported type: "+a}var N=new DataView(e),U=new Uint8Array(e),C={};N.getUint32(0,!0),N.getUint8(4,!0),N.getUint8(5,!0);for(var _={value:8},T=!0;T;){var x=b(e,_);if(0==x)T=!1;else{var F=A(N,e,_,b(e,_),I(N,_));C[x]=F}}var k,L,D,z,Z=C.dataWindow.yMax+1;switch(C.compression){case"NO_COMPRESSION":L=1,k=function(e){return new DataView(e.array.buffer,e.offset.value,e.size)};break;case"RLE_COMPRESSION":L=1,k=function(e){var r=e.viewer.buffer.slice(e.offset.value,e.offset.value+e.size),n=new Uint8Array(function(e){for(var r=e.byteLength,n=new Array,a=0,t=new DataView(e);r>0;){var i=t.getInt8(a++);if(i<0){r-=(l=-i)+1;for(var o=0;o<l;o++)n.push(t.getUint8(a++))}else{var l=i;r-=2;var f=t.getUint8(a++);for(o=0;o<l+1;o++)n.push(f)}}return n}(r)),a=new Uint8Array(n.length);return S(n),g(n,a),new DataView(a.buffer)};break;case"ZIPS_COMPRESSION":L=1,k=O;break;case"ZIP_COMPRESSION":L=16,k=O;break;case"PIZ_COMPRESSION":L=32,k=function(e){var r=e.viewer,n={value:e.offset.value},a=e.width*L*(2*C.channels.length),t=new Uint16Array(a),i=new Uint8Array(8192),o=m(r,n),l=m(r,n);if(l>=8192)throw"Something is wrong with PIZ_COMPRESSION BITMAP_SIZE";if(o<=l)for(var f=0;f<l-o+1;f++)i[f+o]=M(r,n);var u=new Uint16Array(65536);!function(e,r){for(var n=0,a=0;a<65536;++a)(0==a||e[a>>3]&1<<(7&a))&&(r[n++]=a);for(var t=n-1;n<65536;)r[n++]=0}(i,u);var c=I(r,n);d(e.array,r,n,c,t,{value:0},a);var v=new Array(e.channels),s=0;for(f=0;f<e.channels;f++)v[f]={},v[f].start=s,v[f].end=v[f].start,v[f].nx=e.width,v[f].ny=e.lines,v[f].size=1,s+=v[f].nx*v[f].ny*v[f].size;var h=0;for(f=0;f<e.channels;f++)for(var p=0;p<v[f].size;++p)h+=y(p+h,t,v[f].nx,v[f].size,v[f].ny,v[f].nx*v[f].size);!function(e,r,n){for(var a=0;a<n;++a)r[a]=e[r[a]]}(u,t,s);for(var w=new Uint8Array(t.buffer.byteLength),S=0,g=2*e.width,O=0;O<e.lines;O++)for(var b=0;b<e.channels;b++){var E=v[b],R=new Uint8Array(t.buffer,2*E.end+O*g,g);w.set(R,S),S+=g}return new DataView(w.buffer)};break;default:throw"EXRLoader.parse: "+C.compression+" is unsupported"}var X=C.channels[0].pixelType;if(1===X)switch(this.type){case t.FloatType:z=function(e,r){return n=m(e,r),t=1023&n,(n>>15?-1:1)*((a=(31744&n)>>10)?31===a?t?NaN:1/0:Math.pow(2,a-15)*(1+t/1024):t/1024*6103515625e-14);var n,a,t},D=2;break;case t.HalfFloatType:z=m,D=2}else{if(2!==X)throw"EXRLoader.parse: unsupported pixelType "+X+" for "+C.compression+".";switch(this.type){case t.FloatType:z=P,D=4;break;case t.HalfFloatType:throw"EXRLoader.parse: unsupported HalfFloatType texture for FloatType image file."}}for(var H=Z/L,W=0;W<H;W++)E(N,_);var B=C.dataWindow.xMax-C.dataWindow.xMin+1,V=C.dataWindow.yMax-C.dataWindow.yMin+1,Y=B*V*4;switch(this.type){case t.FloatType:var j=new Float32Array(Y);C.channels.length<4&&j.fill(1,0,Y);break;case t.HalfFloatType:j=new Uint16Array(Y);C.channels.length<4&&j.fill(15360,0,Y);break;default:console.error("THREE.EXRLoader: unsupported type: ",this.type)}var G={R:0,G:1,B:2,A:3},J={array:U,viewer:N,offset:_,channels:C.channels.length,width:B,lines:L,size:0};if("NO_COMPRESSION"===C.compression||"ZIP_COMPRESSION"===C.compression||"ZIPS_COMPRESSION"===C.compression||"RLE_COMPRESSION"===C.compression||"PIZ_COMPRESSION"===C.compression)for(var q,K={value:0},Q=0;Q<V/L;Q++){I(N,_),Y=I(N,_),J.offset=_,J.size=Y,q=k(J),_.value+=Y;for(var $=0;$<L;$++){var ee=$+Q*L;if(ee>=V)break;for(var re=0;re<C.channels.length;re++)for(var ne=G[C.channels[re].name],ae=0;ae<B;ae++){var te=$*(C.channels.length*B)+re*B+ae;K.value=te*D;var ie=z(q,K);j[4*B*(V-1-ee)+4*ae+ne]=ie}}}return{header:C,width:B,height:V,data:j,format:t.RGBAFormat,type:this.type}},setDataType:function(e){return this.type=e,this},load:function(e,r,n,i){return a.a.prototype.load.call(this,e,(function(e,n){switch(e.type){case t.FloatType:case t.HalfFloatType:e.encoding=t.LinearEncoding,e.minFilter=t.LinearFilter,e.magFilter=t.LinearFilter,e.generateMipmaps=!1,e.flipY=!1}r&&r(e,n)}),n,i)}})}}]);
//# sourceMappingURL=modules_three-polygonjs-engine-EXRLoader.js.js.map