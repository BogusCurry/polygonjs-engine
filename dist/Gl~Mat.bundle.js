(window.webpackJsonpPOLY=window.webpackJsonpPOLY||[]).push([["Gl~Mat"],{331:function(t,e,n){"use strict";n.d(e,"c",(function(){return s})),n.d(e,"a",(function(){return a})),n.d(e,"b",(function(){return o})),n.d(e,"d",(function(){return _})),n.d(e,"e",(function(){return u}));var s,i=n(371);!function(t){t.ATTRIBUTE="attribute",t.FUNCTION="function",t.UNIFORM="uniform",t.VARYING="varying"}(s||(s={}));class r{constructor(t,e,n,s){this._definition_type=t,this._data_type=e,this._node=n,this._name=s}get definition_type(){return this._definition_type}get data_type(){return this._data_type}get node(){return this._node}get name(){return this._name}collection_instance(){return new i.a}}class a extends r{constructor(t,e,n){super(s.ATTRIBUTE,e,t,n),this._node=t,this._data_type=e,this._name=n}get line(){return`attribute ${this.data_type} ${this.name}`}}class o extends r{constructor(t,e,n){super(s.FUNCTION,e,t,n),this._node=t,this._data_type=e,this._name=n}get line(){return this.name}}class _ extends r{constructor(t,e,n){super(s.UNIFORM,e,t,n),this._node=t,this._data_type=e,this._name=n}get line(){return`uniform ${this.data_type} ${this.name}`}}class u extends r{constructor(t,e,n){super(s.VARYING,e,t,n),this._node=t,this._data_type=e,this._name=n}get line(){return`varying ${this.data_type} ${this.name}`}}},332:function(t,e,n){"use strict";n.d(e,"a",(function(){return c}));var s=n(15),i=n(9),r=n.n(i),a=n(66),o=n.n(a),_=n(5),u=n.n(_);class c{static any(t){if(u()(t))return t;if(o()(t))return`${t}`;if(r()(t))return`${s.a.ensure_float(t)}`;{const e=t.toArray().map(t=>`${s.a.ensure_float(t)}`);return`${`vec${e.length}`}(${e.join(", ")})`}}static vector3(t){if(u()(t))return t;return`vec3(${t.toArray().map(t=>`${s.a.ensure_float(t)}`).join(", ")})`}static vector2(t){if(u()(t))return t;return`vec2(${t.toArray().map(t=>`${s.a.ensure_float(t)}`).join(", ")})`}static vector3_float(t,e){return u()(e)||(e=s.a.ensure_float(e)),`vec4(${this.vector3(t)}, ${e})`}static float4(t,e,n,i){return u()(t)||(t=s.a.ensure_float(t)),u()(e)||(e=s.a.ensure_float(e)),u()(n)||(n=s.a.ensure_float(n)),u()(i)||(i=s.a.ensure_float(i)),`vec4(${t}, ${e}, ${n}, ${i})`}static float3(t,e,n){return u()(t)||(t=s.a.ensure_float(t)),u()(e)||(e=s.a.ensure_float(e)),u()(n)||(n=s.a.ensure_float(n)),`vec3(${t}, ${e}, ${n})`}static float2(t,e){return u()(t)||(t=s.a.ensure_float(t)),u()(e)||(e=s.a.ensure_float(e)),`vec2(${t}, ${e})`}static float(t){return u()(t)||(t=s.a.ensure_float(t)),`${t}`}static int(t){return`${t}`}static bool(t){return`${t}`}}},334:function(t,e,n){"use strict";n.d(e,"b",(function(){return f})),n.d(e,"a",(function(){return b}));var s=n(58),i=n(332),r=n(35),a=n(44),o=n(45),_=n(118),u=n(65),c=n.n(u),l=n(3),p=n.n(l),d=n(9),h=n.n(d);class m{constructor(t){this.node=t,this._allow_inputs_created_from_params=!0}disallow_inputs_created_from_params(){this._allow_inputs_created_from_params=!1}initialize_node(){this.node.params.set_post_create_params_hook(this.create_inputs_from_params.bind(this))}create_inputs_from_params(){if(!this._allow_inputs_created_from_params)return;const t=[];for(let e of this.node.params.names){let n=!0;if(this._inputless_param_names&&this._inputless_param_names.length>0&&this._inputless_param_names.includes(e)&&(n=!1),n&&this.node.params.has(e)){const n=this.node.params.get(e);if(n&&!n.parent_param){const e=o.f[n.type];if(e){const s=new _.a(n.name,e);t.push(s)}}}}this.node.io.inputs.set_named_input_connection_points(t)}set_inputless_param_names(t){return this._inputless_param_names=t}create_spare_parameters(){const t=new Map,e=new Map,n=this.node.params.spare_names,s={};for(let i of n)if(this.node.params.has(i)){const n=this.node.params.get(i);n&&(t.set(i,n.raw_input_serialized),e.set(i,n.default_value_serialized),s.names_to_delete=s.names_to_delete||[],s.names_to_delete.push(i))}for(let t of this.node.io.inputs.named_input_connection_points){const n=t.name,i=t.param_type;let r=t.init_value;const a=e.get(n),o=this.node.gl_input_default_value(n);if(r=null!=o?o:null!=a?a:t.init_value,p()(t.init_value)&&h()(r)){const e=new Array(t.init_value.length);for(let t=0;t<e.length;t++)e[t]=r;r=e}null!=r&&(s.to_add=s.to_add||[],s.to_add.push({name:n,type:i,init_value:c()(r),options:{spare:!0}}))}if(!this.node.scene.loading_controller.is_loading){this.node.params.update_params(s);for(let e of this.node.params.spare)if(!e.parent_param){const n=t.get(e.name);n&&e.set(n)}}}}class f extends s.b{constructor(){super(...arguments),this.spare_params_controller=new m(this)}static node_context(){return r.a.GL}initialize_base_node(){this.io.connections.init_inputs(),this.ui_data.set_layout_horizontal(),this.io.outputs.set_named_output_connection_points([]),this.spare_params_controller.initialize_node()}node_sibbling(t){return super.node_sibbling(t)}cook(){console.warn("gl nodes should never cook")}_set_mat_to_recompile(){var t;null===(t=this.material_node)||void 0===t||t.assembler_controller.set_compilation_required_and_dirty(this)}get material_node(){var t;if(this.parent)return this.parent.type==this.type?null===(t=this.parent)||void 0===t?void 0:t.material_node:this.parent}gl_var_name(t){return`v_POLY_${this.name}_${t}`}variable_for_input(t){var e;const n=this.io.inputs.get_input_index(t),s=this.io.connections.input_connection(n);if(s){const e=s.node_src,n=e.io.outputs.named_output_connection_points[s.output_index];if(n){const t=n.name;return e.gl_var_name(t)}throw console.warn(`no output called '${t}' for gl node ${e.full_path()}`),"variable_for_input ERROR"}return i.a.any(null===(e=this.params.get(t))||void 0===e?void 0:e.value)}set_lines(t){}reset_code(){var t;null===(t=this._param_configs_controller)||void 0===t||t.reset()}set_param_configs(){}param_configs(){var t;return null===(t=this._param_configs_controller)||void 0===t?void 0:t.list}gl_input_default_value(t){return null}}class v extends a.a{}const g=new v;class b extends f{constructor(){super(...arguments),this.params_config=g}}},343:function(t,e,n){"use strict";n.d(e,"b",(function(){return c})),n.d(e,"a",(function(){return l})),n.d(e,"c",(function(){return p}));class s{constructor(t){this.node=t,this._state=!0,this._hooks=null}add_hook(t){this._hooks=this._hooks||[],this._hooks.push(t)}on_update(){}set(t){this._state!=t&&(this._state=t,this.on_update(),this.run_hooks())}get active(){return this._state}toggle(){this.set(!this._state)}run_hooks(){if(this._hooks)for(let t of this._hooks)t()}}var i=n(7);class r extends s{constructor(){super(...arguments),this._state=!1}on_update(){this.node.emit(i.a.FLAG_BYPASS_UPDATED),this.node.set_dirty()}}class a extends s{on_update(){this.node.emit(i.a.FLAG_DISPLAY_UPDATED)}}class o{constructor(t){this.node=t}has_display(){return!1}has_bypass(){return!1}}function _(t){return class extends t{constructor(){super(...arguments),this.display=new a(this.node)}has_display(){return!0}}}function u(t){return class extends t{constructor(){super(...arguments),this.bypass=new r(this.node)}has_bypass(){return!0}}}class c extends(_(o)){}class l extends(u(o)){}class p extends(u(_(o))){}},347:function(t,e,n){"use strict";n.d(e,"b",(function(){return m})),n.d(e,"a",(function(){return f}));var s=n(58),i=n(39);class r extends i.b{set_content(t){super.set_content(t)}texture(){return this._content}core_content(){return this._content}core_content_cloned(){var t;console.log("clone",this._content);const e=null===(t=this._content)||void 0===t?void 0:t.clone();return e&&(e.needsUpdate=!0),e}object(){return this.texture()}infos(){if(null!=this._content)return[this._content]}resolution(){return this._content&&this._content.image?[this._content.image.width,this._content.image.height]:[-1,-1]}}var a=n(37),o=n(35),_=n(343),u=n(122),c=n(4);const l=["input texture","input texture","input texture","input texture"];for(var p=new Uint16Array(32),d=0;d<32;d++)p[d]=28898;const h=new u.a(p,32,1,c.cb,c.I);class m extends s.b{constructor(t){super(t,"BaseCopNode"),this.container_controller=new a.a(this,r),this.flags=new _.a(this)}static node_context(){return o.a.COP}static displayed_input_names(){return l}initialize_base_node(){this.io.outputs.set_has_one_output()}node_sibbling(t){return super.node_sibbling(t)}set_texture(t){t.name=this.full_path(),this.set_container(t)}clear_texture(){this.set_container(h)}}class f extends m{}},348:function(t,e,n){"use strict";n.d(e,"a",(function(){return r}));var s=n(45),i=n(118);class r{constructor(t){this.node=t,this._input_name_function=t=>`in${t}`,this._output_name_function=t=>0==t?"val":`val${t}`,this._expected_input_types_function=()=>{const t=this.first_input_connection_type()||s.c.FLOAT;return[t,t]},this._expected_output_types_function=()=>[this._expected_input_types_function()[0]],this._update_signature_if_required_bound=this.update_signature_if_required.bind(this),this._initialized=!1}set_input_name_function(t){this._input_name_function=t}set_output_name_function(t){this._output_name_function=t}set_expected_input_types_function(t){this._expected_input_types_function=t}set_expected_output_types_function(t){this._expected_output_types_function=t}output_name(t){return this._output_name_function(t)}initialize_node(){this._initialized?console.warn("already initialized",this.node):(this._initialized=!0,this.node.io.inputs.add_on_set_input_hook("_update_signature_if_required",this._update_signature_if_required_bound),this.node.params.add_on_scene_load_hook("_update_signature_if_required",this._update_signature_if_required_bound),this.node.params.set_post_create_params_hook(this._update_signature_if_required_bound),this.node.add_post_dirty_hook("_update_signature_if_required",this._update_signature_if_required_bound))}update_signature_if_required(t){this.node.lifecycle.creation_completed&&this._connections_match_inputs()||(this.update_connection_types(),this.node.remove_dirty_state(),this.make_successors_update_signatures())}make_successors_update_signatures(){for(let t of this.node.graph_all_successors()){const e=t;e.gl_connections_controller&&e.gl_connections_controller.update_signature_if_required(this.node)}}update_connection_types(){const t=this._expected_input_types_function(),e=this._expected_output_types_function(),n=t.map((t,e)=>new i.a(this._input_name_function(e),t)),s=e.map((t,e)=>new i.a(this._output_name_function(e),t));this.node.io.inputs.set_named_input_connection_points(n),this.node.io.outputs.set_named_output_connection_points(s,!1),this.node.spare_params_controller.create_spare_parameters()}_connections_match_inputs(){const t=this.node.io.inputs.named_input_connection_points.map(t=>t.type),e=this.node.io.outputs.named_output_connection_points.map(t=>t.type),n=this._expected_input_types_function(),s=this._expected_output_types_function();if(n.length!=t.length)return!1;if(s.length!=e.length)return!1;for(let e=0;e<t.length;e++)if(t[e]!=n[e])return!1;for(let t=0;t<e.length;t++)if(e[t]!=s[t])return!1;return!0}first_input_connection_type(){const t=this.node.io.connections.input_connections();if(t){const e=t[0];if(e)return this.connection_type_from_connection(e)}}connection_type_from_connection(t){const e=t.node_src,n=t.output_index;return e.io.outputs.named_output_connection_points[n].type}}},351:function(t,e,n){"use strict";n.d(e,"a",(function(){return x}));var s,i=n(1),r=n(346),a=n(4),o=n(347),_=n(379),u=n(6),c=n(11);!function(t){t.EXR="exr",t.BASIS="basis",t.HDR="hdr"}(s||(s={}));class l{constructor(t,e){this._node=t,this._param=e}load_texture_from_url_or_op(t){return Object(i.a)(this,void 0,void 0,(function*(){let e,n=null;if("op:"==t.substring(0,3)){const s=t.substring(3);if(e=u.a.find_node(this._node,s),e)if(e instanceof o.a){n=(yield e.request_container()).texture()}else this._node.states.error.set("found node is not a texture node");else this._node.states.error.set(`no node found in path '${s}'`)}else n=yield this.load_url(t),n?this._param.options.texture_as_env()||(n=l.set_texture_for_mapping(n)):this._node.states.error.set(`could not load texture ${t}`);return e&&this._param.graph_predecessors()[0]!=e&&(this._param.graph_disconnect_predecessors(),this._param.add_graph_input(e)),n}))}load_url(t){return Object(i.a)(this,void 0,void 0,(function*(){return new Promise((e,n)=>Object(i.a)(this,void 0,void 0,(function*(){const s=l._ext(t);if(l.VIDEO_EXTENSIONS.includes(s)){return yield this._load_as_video(t)}this.loader_for_ext(s).then(s=>{s.load(t,e,void 0,t=>{console.warn("error",t),n()})})})))}))}loader_for_ext(t){return Object(i.a)(this,void 0,void 0,(function*(){switch(t.toLowerCase()){case s.EXR:{const{EXRLoader:t}=yield n.e(2).then(n.bind(null,621));return new t}case s.HDR:{const{RGBELoader:t}=yield n.e(3).then(n.bind(null,610)),e=new t;return e.setDataType(a.Wc),e}case s.BASIS:{const{BasisTextureLoader:t}=yield n.e(4).then(n.bind(null,622)),e=new t;e.setTranscoderPath("/three/js/libs/basis/");const s=yield c.a.instance().renderers_controller.wait_for_renderer();return s?e.detectSupport(s):console.warn("texture loader found no renderer for basis texture loader"),e}}return new _.a}))}_load_as_video(t){return new Promise((e,n)=>{const s=document.createElement("video");s.setAttribute("crossOrigin","anonymous"),s.setAttribute("autoplay","true"),s.setAttribute("loop","true"),s.onloadedmetadata=function(){s.pause();const t=new r.a(s);e(t)};const i=document.createElement("source"),a=l._ext(t);let o=l.VIDEO_SOURCE_TYPE_BY_EXT[a];o=o||l._default_video_source_type(t),i.setAttribute("type",o),i.setAttribute("src",t),s.appendChild(i)})}static _default_video_source_type(t){return`video/${this._ext(t)}`}static pixel_data(t){const e=t.image,n=document.createElement("canvas");n.width=e.width,n.height=e.height;const s=n.getContext("2d");if(s)return s.drawImage(e,0,0,e.width,e.height),s.getImageData(0,0,e.width,e.height)}static _ext(t){const e=t.split(".");return e[e.length-1].toLowerCase()}static set_texture_for_mapping(t){return t}}l.PARAM_DEFAULT="/examples/textures/uv.jpg",l.PARAM_ENV_DEFAULT="/examples/textures/piz_compressed.exr",l.VIDEO_EXTENSIONS=["mp4","webm","ogv"],l.VIDEO_SOURCE_TYPE_BY_EXT={ogg:'video/ogg; codecs="theora, vorbis"',ogv:'video/ogg; codecs="theora, vorbis"',mp4:'video/mp4; codecs="avc1.42E01E, mp4a.40.2"'};var p=n(0),d=n(7),h=n(44);const m=[{UVMapping:a.Uc},{CubeReflectionMapping:a.m},{CubeRefractionMapping:a.n},{EquirectangularReflectionMapping:a.A},{EquirectangularRefractionMapping:a.B},{SphericalReflectionMapping:a.Ic},{CubeUVReflectionMapping:a.o},{CubeUVRefractionMapping:a.p}],f=[{ClampToEdgeWrapping:a.l},{RepeatWrapping:a.rc},{MirroredRepeatWrapping:a.gb}],v=[{LinearFilter:a.R},{NearestFilter:a.kb}],g=[{NearestFilter:a.kb},{NearestMipMapNearestFilter:a.mb},{NearestMipMapLinearFilter:a.lb},{LinearFilter:a.R},{LinearMipMapNearestFilter:a.T},{LinearMipMapLinearFilter:a.S}],b=["mapping","wrapS","wrapT","minFilter","magFilter"],y={mapping:"mapping",wrapS:"wrap_s",wrapT:"wrap_t",minFilter:"min_filter",magFilter:"mag_filter"};class E extends h.a{constructor(){super(...arguments),this.url=h.b.STRING(l.PARAM_DEFAULT,{desktop_browse:{file_type:"texture"}}),this.reload=h.b.BUTTON(null,{callback:(t,e)=>{x.PARAM_CALLBACK_reload(t,e)}}),this.mapping=h.b.INTEGER(a.Uc,{menu:{entries:m.map(t=>({name:Object.keys(t)[0],value:Object.values(t)[0]}))}}),this.wrap_s=h.b.INTEGER(Object.values(f[0])[0],{menu:{entries:f.map(t=>({name:Object.keys(t)[0],value:Object.values(t)[0]}))}}),this.wrap_t=h.b.INTEGER(Object.values(f[0])[0],{menu:{entries:f.map(t=>({name:Object.keys(t)[0],value:Object.values(t)[0]}))}}),this.mag_filter=h.b.INTEGER(Object.values(v[0])[0],{menu:{entries:v.map(t=>({name:Object.keys(t)[0],value:Object.values(t)[0]}))}}),this.min_filter=h.b.INTEGER(Object.values(g[0])[0],{menu:{entries:g.map(t=>({name:Object.keys(t)[0],value:Object.values(t)[0]}))}})}}const A=new E;class x extends o.b{constructor(){super(...arguments),this.params_config=A}static type(){return"file"}cook(){return Object(i.a)(this,void 0,void 0,(function*(){this._is_static_image_url(this.pv.url)?yield this.cook_for_image():yield this.cook_for_video()}))}_is_static_image_url(t){return!0}cook_for_image(){return Object(i.a)(this,void 0,void 0,(function*(){const t=yield this._load_texture(this.pv.url);t?(this._update_texture_params(t),this.set_texture(t)):this.clear_texture()}))}cook_for_video(){return Object(i.a)(this,void 0,void 0,(function*(){if(this._param_url_changed()){const t=yield this._load_texture(this.pv.url);t&&this._add_video_spare_params_if_required(t),this._previous_param_url=this.pv.url,this._set_video_current_time(),t?(this._update_texture_params(t),this.set_texture(t)):this.cook_controller.end_cook()}}))}resolved_url(){return this.pv.url}_update_texture_params(t){for(let e of b){const n=y[e],s=this.params.float(n);null!=s&&t&&t[e]!=s&&(t[e]=s,t.needsUpdate=!0)}}static PARAM_CALLBACK_reload(t,e){t.param_callback_reload()}param_callback_reload(){this._previous_param_url=void 0,this.p.url.set_successors_dirty()}_set_video_current_time(){this._video&&this.params.has("video_time")&&(this._video.currentTime=this.params.float("video_time"))}_add_video_spare_params_if_required(t){if(t){if(t.constructor==r.a){if(this._video=t.image,this._video&&!this.params.has_param(x.VIDEO_TIME_PARAM_NAME)){const t=this._video.duration;this.add_param(p.a.FLOAT,x.VIDEO_TIME_PARAM_NAME,"$T",{spare:!0,cook:!0,range:[0,t],range_locked:[!0,!0]}),this.emit(d.a.PARAMS_UPDATED)}}else this._remove_spare_params()}else this._remove_spare_params()}_remove_spare_params(){this.params.has_param(x.VIDEO_TIME_PARAM_NAME)&&this.params.update_params({names_to_delete:[x.VIDEO_TIME_PARAM_NAME]})}_param_url_changed(){return this._previous_param_url!=this.pv.url}_load_texture(t){return Object(i.a)(this,void 0,void 0,(function*(){let e=null;const n=this.params.get("url");if(t&&n){this._texture_loader=this._texture_loader||new l(this,n);try{e=yield this._texture_loader.load_texture_from_url_or_op(t)}catch(t){}e||this.states.error.set(`could not load texture '${t}'`)}else this.states.error.set("not url given to Mat/Base._load_texture");return e}))}}x.VIDEO_TIME_PARAM_NAME="video_time",x.DEFAULT_NODE_PATH={UV:"/COP/file_uv",ENV_MAP:"/COP/env_map"}},352:function(t,e,n){"use strict";n.d(e,"e",(function(){return s})),n.d(e,"a",(function(){return i})),n.d(e,"b",(function(){return r})),n.d(e,"c",(function(){return a})),n.d(e,"d",(function(){return o})),n.d(e,"f",(function(){return _}));const s={LIGHT:"lights",MANAGER:"managers",GEOMETRY:"geometries",CAMERA:"cameras",MISC:"misc"},i={INPUT:"inputs",ADVANCED:"advanced",MISC:"misc"},r={CAMERA:"cameras",MISC:"misc"},a={COLOR:"color",CONVERSION:"conversion",DYNAMICS:"dynamics",GEOMETRY:"geometry",GLOBALS:"globals",LOGIC:"logic",MATH:"math",QUAT:"quat",TRIGO:"trigo",UTIL:"util",INSTANCE:"instance"},o={ADVANCED:"advanced",MESH:"meshes",POINTS:"points",LINE:"lines",VOLUME:"volumes",INSTANCE:"instances"},_={ADVANCED:"advanced",ANIMATION:"animation",ATTRIBUTE:"attributes",DYNAMICS:"dynamics",INPUT:"inputs",MISC:"misc",MODIFIER:"modifiers",PRIMITIVES:"primitives",RENDER:"render"}},359:function(t,e,n){"use strict";n.d(e,"a",(function(){return d}));var s=n(129),i=n.n(s),r=n(334),a=n(45),o=n(0),_=n(348),u=n(44);const c=[a.c.FLOAT,a.c.VEC2,a.c.VEC3,a.c.VEC4];class l extends u.a{constructor(){super(...arguments),this.name=u.b.STRING(""),this.type=u.b.INTEGER(0,{menu:{entries:c.map((t,e)=>({name:t,value:e}))}})}}const p=new l;class d extends r.b{constructor(){super(...arguments),this.params_config=p,this._on_create_set_name_if_none_bound=this._on_create_set_name_if_none.bind(this),this.gl_connections_controller=new _.a(this)}static type(){return"attribute"}initialize_node(){this.add_post_dirty_hook("_set_mat_to_recompile",this._set_mat_to_recompile_if_is_exporting.bind(this)),this.lifecycle.add_on_create_hook(this._on_create_set_name_if_none_bound),this.gl_connections_controller.initialize_node(),this.gl_connections_controller.set_expected_input_types_function(()=>[]),this.gl_connections_controller.set_expected_output_types_function(()=>[c[this.pv.type]])}create_params(){var t;(null===(t=this.material_node)||void 0===t?void 0:t.assembler_controller.allow_attribute_exports())&&this.add_param(o.a.BOOLEAN,"export_when_connected",0)}get input_name(){return d.INPUT_NAME}get output_name(){return d.OUTPUT_NAME}set_lines(t){var e;null===(e=this.material_node)||void 0===e||e.assembler_controller.assembler.set_node_lines_attribute(this,t)}get attribute_name(){return i()(this.pv.name)}gl_type(){return this.io.outputs.named_output_connection_points[0].type}connected_input_node(){return this.io.inputs.named_input(d.INPUT_NAME)}connected_input_connection_point(){return this.io.inputs.named_input_connection_point(d.INPUT_NAME)}output_connection_point(){return this.io.outputs.named_output_connection_points_by_name(this.input_name)}get is_importing(){return this.io.outputs.used_output_names().length>0}get is_exporting(){if(this.pv.export_when_connected){return null!=this.io.inputs.named_input(d.INPUT_NAME)}return!1}_set_mat_to_recompile_if_is_exporting(){this.is_exporting&&this._set_mat_to_recompile()}_on_create_set_name_if_none(){""==this.pv.name&&this.p.name.set(this.name)}}d.INPUT_NAME="export",d.OUTPUT_NAME="val"},371:function(t,e,n){"use strict";n.d(e,"a",(function(){return s}));class s{constructor(t=[]){this._definitions=t,this._errored=!1}get errored(){return this._errored}get error_message(){return this._error_message}uniq(){const t=new Map,e=[];for(let n of this._definitions)if(!this._errored){const s=n.name,i=t.get(s);i?i.data_type!=n.data_type&&(this._errored=!0,this._error_message=`attempt to create ${n.name} with types ${n.data_type}`,console.warn("emitting error message",this._error_message)):(t.set(s,n),e.push(s))}const n=[];for(let s of e){const e=t.get(s);e&&n.push(e)}return n}}},376:function(t,e,n){"use strict";n.d(e,"a",(function(){return d}));var s=n(1),i=n(346),r=n(36),a=n(2),o=n(12),_=n(0),u=n(141),c=n(35),l=n(130);class p{constructor(t,e,n,s){this._type=t,this._name=e,this._default_value=n,this._uniform_name=s}static from_param(t,e){return new p(t.type,t.name,t.default_value,e)}get type(){return this._type}get name(){return this._name}get default_value(){return this._default_value}get uniform_name(){return this._uniform_name}get uniform(){return this._uniform=this._uniform||this._create_uniform()}_create_uniform(){return p.uniform_by_type(this._type)}get param_options(){const t=this._callback.bind(this);switch(this._type){case _.a.OPERATOR_PATH:return{callback:t,node_selection:{context:c.a.COP}};default:return{callback:t}}}_callback(t,e){this.uniform.value=e.value}static uniform_by_type(t){switch(t){case _.a.BOOLEAN:case _.a.BUTTON:return{value:0};case _.a.COLOR:return{value:new a.a(0,0,0)};case _.a.FLOAT:case _.a.FOLDER:case _.a.INTEGER:case _.a.OPERATOR_PATH:return{value:0};case _.a.RAMP:return{value:null};case _.a.SEPARATOR:return{value:0};case _.a.STRING:return{value:null};case _.a.VECTOR2:return{value:new o.a(0,0)};case _.a.VECTOR3:return{value:new a.a(0,0,0)};case _.a.VECTOR4:return{value:new r.a(0,0,0,0)}}l.a.unreachable(t)}set_uniform_value(t){return Object(s.a)(this,void 0,void 0,(function*(){const e=this.uniform,n=t.params.get(this._name);if(n){yield n.compute();const t=n.value;if(null!=t&&this.has_value_changed(t)||this.is_video_texture())switch(this._type){case _.a.OPERATOR_PATH:yield this.set_uniform_value_from_texture(n,e);break;case _.a.RAMP:this.set_uniform_value_from_ramp(n,e);break;default:e.value=n.value}}}))}set_uniform_value_from_texture(t,e){return Object(s.a)(this,void 0,void 0,(function*(){const n=t.found_node();if(n){const t=(yield n.request_container()).texture();e.value=t}else e.value=null}))}set_uniform_value_from_ramp(t,e){e.value=t.ramp_texture()}has_value_changed(t){const e=u.a[this._type];if(this._cached_param_value){const n=!e.are_values_equal(t,this._cached_param_value);return n&&(this._cached_param_value=e.clone_value(t)),n}return this._cached_param_value=e.clone_value(t),!1}is_video_texture(){let t=!1;const e=this.uniform;if(e){const n=e.value;n&&(t=n.constructor==i.a)}return t}}class d{constructor(){this._param_configs=[]}reset(){this._param_configs=[]}push(t){this._param_configs.push(t)}create_and_push(t,e,n,s){const i=new p(t,e,n,s);this._param_configs.push(i)}get list(){return this._param_configs}}},387:function(t,e,n){"use strict";n.d(e,"a",(function(){return o}));var s=n(334),i=n(44);class r extends i.a{}const a=new r;class o extends s.b{constructor(){super(...arguments),this.params_config=a}static type(){return"globals"}create_params(){var t;null===(t=this.material_node)||void 0===t||t.assembler_controller.add_globals_params(this)}set_lines(t){var e,n;null===(n=null===(e=this.material_node)||void 0===e?void 0:e.assembler_controller)||void 0===n||n.assembler.set_node_lines_globals(this,t)}}}}]);
//# sourceMappingURL=Gl~Mat.bundle.js.map