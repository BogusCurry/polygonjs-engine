(window.webpackJsonpPOLY=window.webpackJsonpPOLY||[]).push([["Event"],{352:function(e,t,n){"use strict";n.d(t,"e",(function(){return o})),n.d(t,"a",(function(){return a})),n.d(t,"b",(function(){return s})),n.d(t,"c",(function(){return i})),n.d(t,"d",(function(){return r})),n.d(t,"f",(function(){return c}));const o={LIGHT:"lights",MANAGER:"managers",GEOMETRY:"geometries",CAMERA:"cameras",MISC:"misc"},a={INPUT:"inputs",ADVANCED:"advanced",MISC:"misc"},s={CAMERA:"cameras",MISC:"misc"},i={COLOR:"color",CONVERSION:"conversion",DYNAMICS:"dynamics",GEOMETRY:"geometry",GLOBALS:"globals",LOGIC:"logic",MATH:"math",QUAT:"quat",TRIGO:"trigo",UTIL:"util",INSTANCE:"instance"},r={ADVANCED:"advanced",MESH:"meshes",POINTS:"points",LINE:"lines",VOLUME:"volumes",INSTANCE:"instances"},c={ADVANCED:"advanced",ANIMATION:"animation",ATTRIBUTE:"attributes",DYNAMICS:"dynamics",INPUT:"inputs",MISC:"misc",MODIFIER:"modifiers",PRIMITIVES:"primitives",RENDER:"render"}},412:function(e,t,n){"use strict";n.d(t,"b",(function(){return u})),n.d(t,"a",(function(){return l}));var o=n(59),a=n(4),s=n(21),i=n(434),r=n(12),c=n(2),u=function(e,t){var n,o,u,l,p;void 0===t&&console.warn('THREE.OrbitControls: The second parameter "domElement" is now mandatory.'),t===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),this.object=e,this.domElement=t,this.enabled=!0,this.target=new c.a,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!1,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.enableKeys=!0,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={LEFT:a.db.ROTATE,MIDDLE:a.db.DOLLY,RIGHT:a.db.PAN},this.touches={ONE:a.Pc.ROTATE,TWO:a.Pc.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=function(){return f.phi},this.getAzimuthalAngle=function(){return f.theta},this.saveState=function(){m.target0.copy(m.target),m.position0.copy(m.object.position),m.zoom0=m.object.zoom},this.reset=function(){m.target.copy(m.target0),m.object.position.copy(m.position0),m.object.zoom=m.zoom0,m.object.updateProjectionMatrix(),m.dispatchEvent(d),m.update(),_=v.NONE},this.update=(n=new c.a,o=(new s.a).setFromUnitVectors(e.up,new c.a(0,1,0)),u=o.clone().inverse(),l=new c.a,p=new s.a,function(){var e=m.object.position;return n.copy(e).sub(m.target),n.applyQuaternion(o),f.setFromVector3(n),m.autoRotate&&_===v.NONE&&I(2*Math.PI/60/60*m.autoRotateSpeed),m.enableDamping?(f.theta+=E.theta*m.dampingFactor,f.phi+=E.phi*m.dampingFactor):(f.theta+=E.theta,f.phi+=E.phi),f.theta=Math.max(m.minAzimuthAngle,Math.min(m.maxAzimuthAngle,f.theta)),f.phi=Math.max(m.minPolarAngle,Math.min(m.maxPolarAngle,f.phi)),f.makeSafe(),f.radius*=O,f.radius=Math.max(m.minDistance,Math.min(m.maxDistance,f.radius)),!0===m.enableDamping?m.target.addScaledVector(T,m.dampingFactor):m.target.add(T),n.setFromSpherical(f),n.applyQuaternion(u),e.copy(m.target).add(n),m.object.lookAt(m.target),!0===m.enableDamping?(E.theta*=1-m.dampingFactor,E.phi*=1-m.dampingFactor,T.multiplyScalar(1-m.dampingFactor)):(E.set(0,0,0),T.set(0,0,0)),O=1,!!(y||l.distanceToSquared(m.object.position)>g||8*(1-p.dot(m.object.quaternion))>g)&&(m.dispatchEvent(d),l.copy(m.object.position),p.copy(m.object.quaternion),y=!1,!0)}),this.dispose=function(){m.domElement.removeEventListener("contextmenu",ae,!1),m.domElement.removeEventListener("mousedown",W,!1),m.domElement.removeEventListener("wheel",Q,!1),m.domElement.removeEventListener("touchstart",te,!1),m.domElement.removeEventListener("touchend",oe,!1),m.domElement.removeEventListener("touchmove",ne,!1),document.removeEventListener("mousemove",$,!1),document.removeEventListener("mouseup",J,!1),m.domElement.removeEventListener("keydown",ee,!1)};var m=this,d={type:"change"},h={type:"start"},b={type:"end"},v={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},_=v.NONE,g=1e-6,f=new i.a,E=new i.a,O=1,T=new c.a,y=!1,A=new r.a,P=new r.a,N=new r.a,L=new r.a,w=new r.a,R=new r.a,M=new r.a,j=new r.a,C=new r.a;function S(){return Math.pow(.95,m.zoomSpeed)}function I(e){E.theta-=e}function x(e){E.phi-=e}var D,Y=(D=new c.a,function(e,t){D.setFromMatrixColumn(t,0),D.multiplyScalar(-e),T.add(D)}),k=function(){var e=new c.a;return function(t,n){!0===m.screenSpacePanning?e.setFromMatrixColumn(n,1):(e.setFromMatrixColumn(n,0),e.crossVectors(m.object.up,e)),e.multiplyScalar(t),T.add(e)}}(),H=function(){var e=new c.a;return function(t,n){var o=m.domElement;if(m.object.isPerspectiveCamera){var a=m.object.position;e.copy(a).sub(m.target);var s=e.length();s*=Math.tan(m.object.fov/2*Math.PI/180),Y(2*t*s/o.clientHeight,m.object.matrix),k(2*n*s/o.clientHeight,m.object.matrix)}else m.object.isOrthographicCamera?(Y(t*(m.object.right-m.object.left)/m.object.zoom/o.clientWidth,m.object.matrix),k(n*(m.object.top-m.object.bottom)/m.object.zoom/o.clientHeight,m.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),m.enablePan=!1)}}();function z(e){m.object.isPerspectiveCamera?O/=e:m.object.isOrthographicCamera?(m.object.zoom=Math.max(m.minZoom,Math.min(m.maxZoom,m.object.zoom*e)),m.object.updateProjectionMatrix(),y=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),m.enableZoom=!1)}function F(e){m.object.isPerspectiveCamera?O*=e:m.object.isOrthographicCamera?(m.object.zoom=Math.max(m.minZoom,Math.min(m.maxZoom,m.object.zoom/e)),m.object.updateProjectionMatrix(),y=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),m.enableZoom=!1)}function B(e){A.set(e.clientX,e.clientY)}function X(e){L.set(e.clientX,e.clientY)}function U(e){if(1==e.touches.length)A.set(e.touches[0].pageX,e.touches[0].pageY);else{var t=.5*(e.touches[0].pageX+e.touches[1].pageX),n=.5*(e.touches[0].pageY+e.touches[1].pageY);A.set(t,n)}}function Z(e){if(1==e.touches.length)L.set(e.touches[0].pageX,e.touches[0].pageY);else{var t=.5*(e.touches[0].pageX+e.touches[1].pageX),n=.5*(e.touches[0].pageY+e.touches[1].pageY);L.set(t,n)}}function G(e){var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY,o=Math.sqrt(t*t+n*n);M.set(0,o)}function V(e){if(1==e.touches.length)P.set(e.touches[0].pageX,e.touches[0].pageY);else{var t=.5*(e.touches[0].pageX+e.touches[1].pageX),n=.5*(e.touches[0].pageY+e.touches[1].pageY);P.set(t,n)}N.subVectors(P,A).multiplyScalar(m.rotateSpeed);var o=m.domElement;I(2*Math.PI*N.x/o.clientHeight),x(2*Math.PI*N.y/o.clientHeight),A.copy(P)}function K(e){if(1==e.touches.length)w.set(e.touches[0].pageX,e.touches[0].pageY);else{var t=.5*(e.touches[0].pageX+e.touches[1].pageX),n=.5*(e.touches[0].pageY+e.touches[1].pageY);w.set(t,n)}R.subVectors(w,L).multiplyScalar(m.panSpeed),H(R.x,R.y),L.copy(w)}function q(e){var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY,o=Math.sqrt(t*t+n*n);j.set(0,o),C.set(0,Math.pow(j.y/M.y,m.zoomSpeed)),z(C.y),M.copy(j)}function W(e){if(!1!==m.enabled){var t;switch(e.preventDefault(),m.domElement.focus?m.domElement.focus():window.focus(),e.button){case 0:t=m.mouseButtons.LEFT;break;case 1:t=m.mouseButtons.MIDDLE;break;case 2:t=m.mouseButtons.RIGHT;break;default:t=-1}switch(t){case a.db.DOLLY:if(!1===m.enableZoom)return;!function(e){M.set(e.clientX,e.clientY)}(e),_=v.DOLLY;break;case a.db.ROTATE:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===m.enablePan)return;X(e),_=v.PAN}else{if(!1===m.enableRotate)return;B(e),_=v.ROTATE}break;case a.db.PAN:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===m.enableRotate)return;B(e),_=v.ROTATE}else{if(!1===m.enablePan)return;X(e),_=v.PAN}break;default:_=v.NONE}_!==v.NONE&&(document.addEventListener("mousemove",$,!1),document.addEventListener("mouseup",J,!1),m.dispatchEvent(h))}}function $(e){if(!1!==m.enabled)switch(e.preventDefault(),_){case v.ROTATE:if(!1===m.enableRotate)return;!function(e){P.set(e.clientX,e.clientY),N.subVectors(P,A).multiplyScalar(m.rotateSpeed);var t=m.domElement;I(2*Math.PI*N.x/t.clientHeight),x(2*Math.PI*N.y/t.clientHeight),A.copy(P),m.update()}(e);break;case v.DOLLY:if(!1===m.enableZoom)return;!function(e){j.set(e.clientX,e.clientY),C.subVectors(j,M),C.y>0?z(S()):C.y<0&&F(S()),M.copy(j),m.update()}(e);break;case v.PAN:if(!1===m.enablePan)return;!function(e){w.set(e.clientX,e.clientY),R.subVectors(w,L).multiplyScalar(m.panSpeed),H(R.x,R.y),L.copy(w),m.update()}(e)}}function J(e){!1!==m.enabled&&(document.removeEventListener("mousemove",$,!1),document.removeEventListener("mouseup",J,!1),m.dispatchEvent(b),_=v.NONE)}function Q(e){!1===m.enabled||!1===m.enableZoom||_!==v.NONE&&_!==v.ROTATE||(e.preventDefault(),e.stopPropagation(),m.dispatchEvent(h),function(e){e.deltaY<0?F(S()):e.deltaY>0&&z(S()),m.update()}(e),m.dispatchEvent(b))}function ee(e){!1!==m.enabled&&!1!==m.enableKeys&&!1!==m.enablePan&&function(e){var t=!1;switch(e.keyCode){case m.keys.UP:H(0,m.keyPanSpeed),t=!0;break;case m.keys.BOTTOM:H(0,-m.keyPanSpeed),t=!0;break;case m.keys.LEFT:H(m.keyPanSpeed,0),t=!0;break;case m.keys.RIGHT:H(-m.keyPanSpeed,0),t=!0}t&&(e.preventDefault(),m.update())}(e)}function te(e){if(!1!==m.enabled){switch(e.preventDefault(),e.touches.length){case 1:switch(m.touches.ONE){case a.Pc.ROTATE:if(!1===m.enableRotate)return;U(e),_=v.TOUCH_ROTATE;break;case a.Pc.PAN:if(!1===m.enablePan)return;Z(e),_=v.TOUCH_PAN;break;default:_=v.NONE}break;case 2:switch(m.touches.TWO){case a.Pc.DOLLY_PAN:if(!1===m.enableZoom&&!1===m.enablePan)return;!function(e){m.enableZoom&&G(e),m.enablePan&&Z(e)}(e),_=v.TOUCH_DOLLY_PAN;break;case a.Pc.DOLLY_ROTATE:if(!1===m.enableZoom&&!1===m.enableRotate)return;!function(e){m.enableZoom&&G(e),m.enableRotate&&U(e)}(e),_=v.TOUCH_DOLLY_ROTATE;break;default:_=v.NONE}break;default:_=v.NONE}_!==v.NONE&&m.dispatchEvent(h)}}function ne(e){if(!1!==m.enabled)switch(e.preventDefault(),e.stopPropagation(),_){case v.TOUCH_ROTATE:if(!1===m.enableRotate)return;V(e),m.update();break;case v.TOUCH_PAN:if(!1===m.enablePan)return;K(e),m.update();break;case v.TOUCH_DOLLY_PAN:if(!1===m.enableZoom&&!1===m.enablePan)return;!function(e){m.enableZoom&&q(e),m.enablePan&&K(e)}(e),m.update();break;case v.TOUCH_DOLLY_ROTATE:if(!1===m.enableZoom&&!1===m.enableRotate)return;!function(e){m.enableZoom&&q(e),m.enableRotate&&V(e)}(e),m.update();break;default:_=v.NONE}}function oe(e){!1!==m.enabled&&(m.dispatchEvent(b),_=v.NONE)}function ae(e){!1!==m.enabled&&e.preventDefault()}m.domElement.addEventListener("contextmenu",ae,!1),m.domElement.addEventListener("mousedown",W,!1),m.domElement.addEventListener("wheel",Q,!1),m.domElement.addEventListener("touchstart",te,!1),m.domElement.addEventListener("touchend",oe,!1),m.domElement.addEventListener("touchmove",ne,!1),m.domElement.addEventListener("keydown",ee,!1),-1===m.domElement.tabIndex&&(m.domElement.tabIndex=0),this.update()};u.prototype=Object.create(o.a.prototype),u.prototype.constructor=u;var l=function(e,t){u.call(this,e,t),this.mouseButtons.LEFT=a.db.PAN,this.mouseButtons.RIGHT=a.db.ROTATE,this.touches.ONE=a.Pc.PAN,this.touches.TWO=a.Pc.DOLLY_ROTATE};l.prototype=Object.create(o.a.prototype),l.prototype.constructor=l},429:function(e,t,n){"use strict";n.d(t,"a",(function(){return l}));var o=n(1),a=n(135);class s extends a.a{apply_controls(e,t){return Object(o.a)(this,void 0,void 0,(function*(){const n=yield this.create_controls_instance(e,t),o=performance.now();return n.name=`${this.full_path()}:${e.name}:${o}:${this.controls_id()}`,yield this.params.eval_all(),this.setup_controls(n),n}))}controls_id(){return JSON.stringify(this.params.all.map(e=>e.value_serialized))}}var i=n(412),r=n(44);class c extends r.a{constructor(){super(...arguments),this.allow_pan=r.b.BOOLEAN(1),this.allow_rotate=r.b.BOOLEAN(1),this.allow_zoom=r.b.BOOLEAN(1),this.tdamping=r.b.BOOLEAN(1),this.damping=r.b.FLOAT(.1,{visible_if:{tdamping:!0}}),this.screen_space_panning=r.b.BOOLEAN(1),this.rotate_speed=r.b.FLOAT(.5),this.min_distance=r.b.FLOAT(1,{range:[0,100],range_locked:[!0,!1]}),this.max_distance=r.b.FLOAT(50,{range:[0,100],range_locked:[!0,!1]}),this.polar_angle_range=r.b.VECTOR2([0,"$PI"])}}const u=new c;class l extends s{constructor(){super(...arguments),this.params_config=u}static type(){return"camera_orbit_controls"}create_controls_instance(e,t){return Object(o.a)(this,void 0,void 0,(function*(){return new i.b(e,t)}))}setup_controls(e){e.enablePan=this.pv.allow_pan,e.enableRotate=this.pv.allow_rotate,e.enableZoom=this.pv.allow_zoom,e.enableDamping=this.pv.tdamping,e.dampingFactor=this.pv.damping,e.rotateSpeed=this.pv.rotate_speed,e.screenSpacePanning=this.pv.screen_space_panning,e.minDistance=this.pv.min_distance,e.maxDistance=this.pv.max_distance,e.minPolarAngle=this.pv.polar_angle_range.x,e.maxPolarAngle=this.pv.polar_angle_range.y,e.enableKeys=!1}set_from_camera_node(e,t){const n=t.params.vector3("target");e.target.copy(n)}}},435:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));class o{static filter(e){const t=e.split("\n"),n=[];for(let e of t)e.match(/import {.*} from '.*'/)||(e=e.replace("export ","return "),n.push(e));return n.join("\n")}}},620:function(e,t,n){"use strict";n.r(t),n.d(t,"EventRegister",(function(){return N}));var o=n(352),a=n(1),s=n(412),i=n(429);class r extends i.a{static type(){return"camera_map_controls"}create_controls_instance(e,t){return Object(a.a)(this,void 0,void 0,(function*(){return new s.a(e,t)}))}}var c=n(135),u=n(118),l=n(45),p=n(143),m=n(110),d=n(44),h=n(435),b=n(12),v=n(413),_=n(507);class g{constructor(e){this.node=e,this.raycaster=new v.a,this.mouse=new b.a,this.initialize_processor()}process_event(e,t,n){e instanceof MouseEvent?this.process_mouse_event(e,t,n):e instanceof KeyboardEvent&&this.process_keyboard_event(e,t,n)}process_mouse_event(e,t,n){}process_keyboard_event(e,t,n){}set_node(e){this.node=e}initialize_processor(){}_set_mouse_from_event_and_canvas(e,t){this.mouse.x=e.offsetX/t.offsetWidth*2-1,this.mouse.y=-e.offsetY/t.offsetHeight*2+1}}class f extends d.a{constructor(){super(...arguments),this.code_typescript=d.b.STRING("\nimport {BaseMouseEventProcessor, BaseCameraObjNodeType} from 'polygonjs-engine'\nexport class EventProcessor extends BaseMouseEventProcessor {\n\tinitialize_processor(){\n\t}\n\tprocess_mouse_event(event: MouseEvent, canvas: HTMLCanvasElement, camera_node: BaseCameraObjNodeType){\n\t\tthis._set_mouse_from_event_and_canvas(event, canvas);\n\t\tconsole.log(this.node.scene.time);\n\t\tconsole.log(\"processing event\", this.mouse.x, this.mouse.y);\n\t}\n}\n\n\n\n\n",{label:!1,language:m.b.TYPESCRIPT}),this.code_javascript=d.b.STRING("",{hidden:!0})}}const E=new f;class O extends c.a{constructor(){super(...arguments),this.params_config=E}static type(){return"code"}initialize_node(){this.io.inputs.set_named_input_connection_points([new u.a("trigger",l.c.BOOL)])}process_event(e,t,n){this._compile_if_required(),this._processor&&this._processor.process_event(e,t,n)}_compile_if_required(){this._processor&&this._last_compiled_code==this.pv.code_javascript||this._compile()}_compile(){try{const e=`try {\n\t\t\t\t${h.a.filter(this.pv.code_javascript)}\n\t\t\t} catch(e) {\n\t\t\t\tthis.states.error.set(e)\n\t\t\t}`;console.log("function_body"),console.log(e);const t=new p.a("BaseMouseEventProcessor","THREE",e)(g,_);t?(this._processor=new t(this),this._last_compiled_code=this.pv.code_javascript):(this.states.error.set("cannot generate function"),this._processor=void 0)}catch(e){console.warn(e),this.states.error.set(`cannot generate function (${e})`),this._processor=void 0}}}var T=n(177);class y extends d.a{}const A=new y;class P extends c.a{constructor(){super(...arguments),this.params_config=A}static type(){return"pass"}initialize_node(){this.io.inputs.set_named_input_connection_points([0,1,2,3].map(e=>new u.a(`trigger${e}`,l.c.BOOL))),this.io.outputs.set_named_output_connection_points([new u.a("event",l.c.BOOL)])}process_event(e,t,n){const o=this.io.connections.output_connections().map(e=>e.node_dest);for(let a of o)a.process_event(e,t,n)}}class N{static run(e){e.register_node(r,o.b.CAMERA),e.register_node(i.a,o.b.CAMERA),e.register_node(O,o.b.MISC),e.register_node(T.a,o.b.MISC),e.register_node(P,o.b.MISC)}}}}]);
//# sourceMappingURL=Event.bundle.js.map